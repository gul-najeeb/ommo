/*! For license information please see index.js.LICENSE.txt */
(()=>{"use strict";var __webpack_modules__={606:(module,__unused_webpack___webpack_exports__,__webpack_require__)=>{module=__webpack_require__.hmd(module),function(){var m,ba=[];function ca(t){return function(){return ba[t].apply(this,arguments)}}function da(t,e){return ba[t]=e}function ea(t){var e=0;return function(){return e<t.length?{done:!1,value:t[e++]}:{done:!0}}}function fa(t){var e="undefined"!=typeof Symbol&&Symbol.iterator&&t[Symbol.iterator];return e?e.call(t):{next:ea(t)}}function ha(t){for(var e,r=[];!(e=t.next()).done;)r.push(e.value);return r}function ia(t){t=["object"==typeof globalThis&&globalThis,t,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof global&&global];for(var e=0;e<t.length;++e){var r=t[e];if(r&&r.Math==Math)return r}throw Error("Cannot find global object")}var ja=ia(this),ka="function"==typeof Object.defineProperties?Object.defineProperty:function(t,e,r){return t==Array.prototype||t==Object.prototype||(t[e]=r.value),t},pa;function la(t,e){if(e)t:{var r=ja;t=t.split(".");for(var i=0;i<t.length-1;i++){var n=t[i];if(!(n in r))break t;r=r[n]}(e=e(i=r[t=t[t.length-1]]))!=i&&null!=e&&ka(r,t,{configurable:!0,writable:!0,value:e})}}function ma(t){return(t={next:t})[Symbol.iterator]=function(){return this},t}function na(t,e){t instanceof String&&(t+="");var r=0,i=!1,n={next:function(){if(!i&&r<t.length){var n=r++;return{value:e(n,t[n]),done:!1}}return i=!0,{done:!0,value:void 0}}};return n[Symbol.iterator]=function(){return n},n}function oa(t,e,r){t instanceof String&&(t=String(t));for(var i=t.length,n=0;n<i;n++){var o=t[n];if(e.call(r,o,n,t))return{Hu:n,Hx:o}}return{Hu:-1,Hx:void 0}}if(la("Symbol",(function(t){function e(t,e){this.Rx=t,ka(this,"description",{configurable:!0,writable:!0,value:e})}if(t)return t;e.prototype.toString=function(){return this.Rx};var r="jscomp_symbol_"+(1e9*Math.random()>>>0)+"_",i=0;return function t(n){if(this instanceof t)throw new TypeError("Symbol is not a constructor");return new e(r+(n||"")+"_"+i++,n)}})),la("Symbol.iterator",(function(t){if(t)return t;t=Symbol("Symbol.iterator");for(var e="Array Int8Array Uint8Array Uint8ClampedArray Int16Array Uint16Array Int32Array Uint32Array Float32Array Float64Array".split(" "),r=0;r<e.length;r++){var i=ja[e[r]];"function"==typeof i&&"function"!=typeof i.prototype[t]&&ka(i.prototype,t,{configurable:!0,writable:!0,value:function(){return ma(ea(this))}})}return t})),la("globalThis",(function(t){return t||ja})),la("Array.prototype.keys",(function(t){return t||function(){return na(this,(function(t){return t}))}})),la("Array.prototype.find",(function(t){return t||function(t,e){return oa(this,t,e).Hx}})),"function"==typeof Object.setPrototypeOf)pa=Object.setPrototypeOf;else{var qa;t:{var ra={a:!0},sa={};try{sa.__proto__=ra,qa=sa.a;break t}catch(a){}qa=!1}pa=qa?function(t,e){if(t.__proto__=e,t.__proto__!==e)throw new TypeError(t+" is not extensible");return t}:null}var ta=pa;la("Object.setPrototypeOf",(function(t){return t||ta})),la("Array.prototype.entries",(function(t){return t||function(){return na(this,(function(t,e){return[t,e]}))}})),la("Object.values",(function(t){return t||function(t){var e,r=[];for(e in t)Object.prototype.hasOwnProperty.call(t,e)&&r.push(t[e]);return r}})),la("Object.is",(function(t){return t||function(t,e){return t===e?0!==t||1/t==1/e:t!=t&&e!=e}})),la("Array.prototype.includes",(function(t){return t||function(t,e){var r=this;r instanceof String&&(r=String(r));var i=r.length;for(0>(e=e||0)&&(e=Math.max(e+i,0));e<i;e++){var n=r[e];if(n===t||Object.is(n,t))return!0}return!1}})),la("String.prototype.includes",(function(t){return t||function(t,e){if(null==this)throw new TypeError("The 'this' value for String.prototype.includes must not be null or undefined");if(t instanceof RegExp)throw new TypeError("First argument to String.prototype.includes must not be a regular expression");return-1!==(this+"").indexOf(t,e||0)}})),la("Promise",(function(t){function e(t){this.s=0,this.rf=void 0,this.Uh=[],this.Xu=!1;var e=this.ap();try{t(e.resolve,e.reject)}catch(t){e.reject(t)}}function r(){this.Ie=null}function i(t){return t instanceof e?t:new e((function(e){e(t)}))}if(t)return t;r.prototype.ft=function(t){if(null==this.Ie){this.Ie=[];var e=this;this.gt((function(){e.bz()}))}this.Ie.push(t)};var n=ja.setTimeout;r.prototype.gt=function(t){n(t,0)},r.prototype.bz=function(){for(;this.Ie&&this.Ie.length;){var t=this.Ie;this.Ie=[];for(var e=0;e<t.length;++e){var r=t[e];t[e]=null;try{r()}catch(t){this.oy(t)}}}this.Ie=null},r.prototype.oy=function(t){this.gt((function(){throw t}))},e.prototype.ap=function(){function t(t){return function(i){r||(r=!0,t.call(e,i))}}var e=this,r=!1;return{resolve:t(this.RC),reject:t(this.zr)}},e.prototype.RC=function(t){if(t===this)this.zr(new TypeError("A Promise cannot resolve to itself"));else if(t instanceof e)this.gD(t);else{t:switch(typeof t){case"object":var r=null!=t;break t;case"function":r=!0;break t;default:r=!1}r?this.QC(t):this.au(t)}},e.prototype.QC=function(t){var e=void 0;try{e=t.then}catch(t){return void this.zr(t)}"function"==typeof e?this.hD(e,t):this.au(t)},e.prototype.zr=function(t){this.ax(2,t)},e.prototype.au=function(t){this.ax(1,t)},e.prototype.ax=function(t,e){if(0!=this.s)throw Error("Cannot settle("+t+", "+e+"): Promise already settled in state"+this.s);this.s=t,this.rf=e,2===this.s&&this.UC(),this.dz()},e.prototype.UC=function(){var t=this;n((function(){if(t.PB()){var e=ja.console;void 0!==e&&e.error(t.rf)}}),1)},e.prototype.PB=function(){if(this.Xu)return!1;var t=ja.CustomEvent,e=ja.Event,r=ja.dispatchEvent;return void 0===r||("function"==typeof t?t=new t("unhandledrejection",{cancelable:!0}):"function"==typeof e?t=new e("unhandledrejection",{cancelable:!0}):(t=ja.document.createEvent("CustomEvent")).initCustomEvent("unhandledrejection",!1,!0,t),t.promise=this,t.reason=this.rf,r(t))},e.prototype.dz=function(){if(null!=this.Uh){for(var t=0;t<this.Uh.length;++t)o.ft(this.Uh[t]);this.Uh=null}};var o=new r;return e.prototype.gD=function(t){var e=this.ap();t.Jl(e.resolve,e.reject)},e.prototype.hD=function(t,e){var r=this.ap();try{t.call(e,r.resolve,r.reject)}catch(t){r.reject(t)}},e.prototype.then=function(t,r){function i(t,e){return"function"==typeof t?function(e){try{n(t(e))}catch(t){o(t)}}:e}var n,o,a=new e((function(t,e){n=t,o=e}));return this.Jl(i(t,n),i(r,o)),a},e.prototype.catch=function(t){return this.then(void 0,t)},e.prototype.Jl=function(t,e){function r(){switch(i.s){case 1:t(i.rf);break;case 2:e(i.rf);break;default:throw Error("Unexpected state: "+i.s)}}var i=this;null==this.Uh?o.ft(r):this.Uh.push(r),this.Xu=!0},e.resolve=i,e.reject=function(t){return new e((function(e,r){r(t)}))},e.race=function(t){return new e((function(e,r){for(var n=fa(t),o=n.next();!o.done;o=n.next())i(o.value).Jl(e,r)}))},e.all=function(t){var r=fa(t),n=r.next();return n.done?i([]):new e((function(t,e){function o(e){return function(r){a[e]=r,0==--s&&t(a)}}var a=[],s=0;do{a.push(void 0),s++,i(n.value).Jl(o(a.length-1),e),n=r.next()}while(!n.done)}))},e})),la("Object.entries",(function(t){return t||function(t){var e,r=[];for(e in t)Object.prototype.hasOwnProperty.call(t,e)&&r.push([e,t[e]]);return r}}));var ua="function"==typeof Object.assign?Object.assign:function(t,e){for(var r=1;r<arguments.length;r++){var i=arguments[r];if(i)for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(t[n]=i[n])}return t};function va(t){return t||Array.prototype.fill}la("Object.assign",(function(t){return t||ua})),la("Array.prototype.fill",(function(t){return t||function(t,e,r){var i=this.length||0;for(0>e&&(e=Math.max(0,i+e)),(null==r||r>i)&&(r=i),0>(r=Number(r))&&(r=Math.max(0,i+r)),e=Number(e||0);e<r;e++)this[e]=t;return this}})),la("Int8Array.prototype.fill",va),la("Uint8Array.prototype.fill",va),la("Uint8ClampedArray.prototype.fill",va),la("Int16Array.prototype.fill",va),la("Uint16Array.prototype.fill",va),la("Int32Array.prototype.fill",va),la("Uint32Array.prototype.fill",va),la("Float32Array.prototype.fill",va),la("Float64Array.prototype.fill",va),la("Math.log2",(function(t){return t||function(t){return Math.log(t)/Math.LN2}})),la("Array.prototype.findIndex",(function(t){return t||function(t,e){return oa(this,t,e).Hu}}));var wa=this||self;function xa(t,e,r,i){t=t.split("."),i=i||wa,t[0]in i||void 0===i.execScript||i.execScript("var "+t[0]);for(var n;t.length&&(n=t.shift());)if(t.length||void 0===e)i=i[n]&&i[n]!==Object.prototype[n]?i[n]:i[n]={};else if(!r&&ya(e)&&ya(i[n]))for(var o in e)e.hasOwnProperty(o)&&(i[n][o]=e[o]);else i[n]=e}function za(){}function Aa(t){var e=typeof t;return"object"!=e?e:t?Array.isArray(t)?"array":e:"null"}function Ca(t){var e=Aa(t);return"array"==e||"object"==e&&"number"==typeof t.length}function ya(t){var e=typeof t;return"object"==e&&null!=t||"function"==e}function Da(t){return Object.prototype.hasOwnProperty.call(t,Ea)&&t[Ea]||(t[Ea]=++Fa)}var Ea="closure_uid_"+(1e9*Math.random()>>>0),Fa=0;function Ga(t,e,r){return t.call.apply(t.bind,arguments)}function Ha(t,e,r){if(!t)throw Error();if(2<arguments.length){var i=Array.prototype.slice.call(arguments,2);return function(){var r=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(r,i),t.apply(e,r)}}return function(){return t.apply(e,arguments)}}function Ia(t,e,r){return(Ia=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?Ga:Ha).apply(null,arguments)}function Ja(t,e){var r=Array.prototype.slice.call(arguments,1);return function(){var e=r.slice();return e.push.apply(e,arguments),t.apply(this,e)}}function t(t,e){xa(t,e,!0,void 0)}function u(t,e){function r(){}r.prototype=e.prototype,t.g=e.prototype,t.prototype=new r,t.prototype.constructor=t,t.VD=function(t,r,i){for(var n=Array(arguments.length-2),o=2;o<arguments.length;o++)n[o-2]=arguments[o];return e.prototype[r].apply(t,n)}}function Ka(t,e){if(Error.captureStackTrace)Error.captureStackTrace(this,Ka);else{var r=Error().stack;r&&(this.stack=r)}t&&(this.message=String(t)),e&&(this.XD=e)}u(Ka,Error),Ka.prototype.name="CustomError";var Ma=Array.prototype.indexOf?function(t,e){return Array.prototype.indexOf.call(t,e,void 0)}:function(t,e){if("string"==typeof t)return"string"!=typeof e||1!=e.length?-1:t.indexOf(e,0);for(var r=0;r<t.length;r++)if(r in t&&t[r]===e)return r;return-1};function Na(t,e){for(var r in t)if(e.call(void 0,t[r],r,t))return!0;return!1}function Oa(t){for(var e in t)return!1;return!0}function Qa(t){var e,r={};for(e in t)r[e]=t[e];return r}var Ra="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function Sa(t,e){for(var r,i,n=1;n<arguments.length;n++){for(r in i=arguments[n])t[r]=i[r];for(var o=0;o<Ra.length;o++)r=Ra[o],Object.prototype.hasOwnProperty.call(i,r)&&(t[r]=i[r])}}function Ua(){return Object.create(x,void 0)}var z=Ia,Va=String,Wa=globalThis.Object.freeze||function(t){return t};function Xa(t){for(var e,r=Object.keys(t),i=r.length;i--;)ya(e=t[r[i]])&&Xa(e);return Wa(t)}function Ya(t){var e=Aa(t);if("object"==e||"array"==e){if(Za(t.clone))return t.clone();for(var r in e="array"==e?[]:{},t)t.hasOwnProperty(r)&&(e[r]=Ya(t[r]));return e}return t}var A=[].pop(),x=/x/.exec(""),$a="prototype constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function B(t,e,r,i,n){if(!(e=t instanceof e)&&r)throw new C(r,i,ab(n)?n:t);return e}function bb(t,e){if(!0===(B(t,e)&&t.constructor===e))throw new TypeError("Illegal constructor "+cb(e))}function Za(t){return"function"==Aa(t)}function db(t,e,r,i,n){if(!(e=eb(t)===e)&&r)throw new C(r,i,ab(n)?n:t);return e}function fb(t,e,r,i){return db(t,"Array",e,r,i)}function ab(t){return t!==A}function gb(t){return"string"==typeof t}t("H.lang.isArray",fb),t("H.lang.isString",gb);var hb=parseInt,ib=parseFloat,D=isNaN;function jb(t){return t===+t}function kb(t){return!D(+t)}function eb(t){var e=Object[$a[0]][$a[6]].call(t).match(/^\[object (\w+)\]$/);return e?e[1]:typeof t}t("H.lang.isNumber",jb),t("H.lang.isInteger",Number.isInteger?Number.isInteger:function(t){return"number"==typeof t&&0==t%1});var lb=[];function mb(t){0>lb.indexOf(t)&&lb.push(t)}function cb(t,e,r,i){var n,o="",a=2>arguments.length;return a&&(e={H:globalThis.H},r="",i=lb.slice()),nb(e,!0,(function(e,a){try{if(a=ob(e,n=e[a]),!(ya(n)&&n.window===n&&n.self===n||ya(n)&&0<n.nodeType&&Za(n.cloneNode))&&ya(n)){if(n===t)return o=r+"."+a,!0;if(0>i.indexOf(n)&&(i.push(n),o=cb(t,n,r+"."+a,i)))return!0}}catch(t){}})),a&&(o=o?o.substr(1).replace("."+$a[0]+".","#"):"~"+(Za(t)?pb(t)+"()":eb(t))),o}function ob(t,e){var r=[];return nb(t,!1,(function(t,i){t[i]===e&&r.push(i)})),r.sort(qb)[0]}function qb(t,e){return e.length-t.length}mb(lb);var rb=Object[$a[0]][$a[2]];function nb(t,e,r){var i;if(t){for(n in t)if((!e||rb.call(t,n))&&r(t,n,!0))return;for(i=$a.length;i--;){var n=$a[i];if((!e||rb.call(t,n))&&r(t,n,!1))break}}}function pb(t){return(t=/^\s*function ([^\( ]+)/.exec(t))?t[1]:"anonymous"}function sb(t,e,r){r[e]="#"+e}var tb=!!globalThis.__karma__,xb,yb,zb,Db;function ub(){throw Error("unimplemented method")}function C(t,e,r){var i,n=arguments.length;(e=e!==A?+e:e)!==A&&((i=/^.*?\(([^\)]+)/.exec((""+t).replace(/(\/\*([\s\S]*?)\*\/)|(\/\/(.*)$)/gm,"")))?(i=i[1].replace(/\s+/g,""),i=Va(i).split(","!==A?",":" ")):i=[],i.forEach(sb),i=i[e]||"#"+e);var o=t?cb(t):"";return n=2<n?Va(r):"",(i||n)&&(o+=" (Argument "+(i||"")+(n?" "+n:"")+")"),n=Error(o),Object.setPrototypeOf(n,C.prototype),n}function wb(t,e){var r=[];return t&&r.push(cb(t)),1<arguments.length&&r.push(""+e),r=Error(r.join(" ")),Object.setPrototypeOf(r,wb.prototype),r}function Ab(t){wa.setTimeout((function(){throw t}),0)}function Bb(t){return Bb[" "](t),t}function Cb(t,e){return-1!=t.indexOf(e)}u(C,Error),t("H.lang.InvalidArgumentError",C),C.prototype.name="InvalidArgumentError",u(wb,Error),t("H.lang.IllegalOperationError",wb),wb.prototype.name="IllegalOperationError",Bb[" "]=za;t:{var Eb=wa.navigator;if(Eb){var Fb=Eb.userAgent;if(Fb){Db=Fb;break t}}Db=""}var Gb=Cb(Db,"Gecko")&&!(Cb(Db.toLowerCase(),"webkit")&&!Cb(Db,"Edge"))&&!(Cb(Db,"Trident")||Cb(Db,"MSIE"))&&!Cb(Db,"Edge"),Hb=Cb(Db.toLowerCase(),"webkit")&&!Cb(Db,"Edge"),Jb;function Ib(){var t=document,e="IFRAME";return"application/xhtml+xml"===t.contentType&&(e=e.toLowerCase()),t.createElement(e)}function Kb(){var t=wa.MessageChannel;if(void 0===t&&"undefined"!=typeof window&&window.postMessage&&window.addEventListener&&!Cb(Db,"Presto")&&(t=function(){var t=Ib();t.style.display="none",document.documentElement.appendChild(t);var e=t.contentWindow;(t=e.document).open(),t.close();var r="callImmediate"+Math.random(),i="file:"==e.location.protocol?"*":e.location.protocol+"//"+e.location.host;t=Ia((function(t){"*"!=i&&t.origin!=i||t.data!=r||this.port1.onmessage()}),this),e.addEventListener("message",t,!1),this.port1={},this.port2={postMessage:function(){e.postMessage(r,i)}}}),void 0!==t&&!Cb(Db,"Trident")&&!Cb(Db,"MSIE")){var e=new t,r={},i=r;return e.port1.onmessage=function(){if(void 0!==r.next){var t=(r=r.next).lt;r.lt=null,t()}},function(t){i.next={lt:t},i=i.next,e.port2.postMessage(0)}}return function(t){wa.setTimeout(t,0)}}function Lb(t,e){this.rB=100,this.Jy=t,this.Ag=e,this.an=0,this.zm=null}function Mb(){this.no=this.Gi=null}Lb.prototype.get=function(){if(0<this.an){this.an--;var t=this.zm;this.zm=t.next,t.next=null}else t=this.Jy();return t},Lb.prototype.put=function(t){this.Ag(t),this.an<this.rB&&(this.an++,t.next=this.zm,this.zm=t)},Mb.prototype.add=function(t,e){var r=Nb.get();r.set(t,e),this.no?this.no.next=r:this.Gi=r,this.no=r},Mb.prototype.remove=function(){var t=null;return this.Gi&&(t=this.Gi,this.Gi=this.Gi.next,this.Gi||(this.no=null),t.next=null),t};var Nb=new Lb((function(){return new Ob}),(function(t){return t.reset()})),Qb;function Ob(){this.next=this.scope=this.tp=null}function Pb(t,e){Qb||Rb(),Sb||(Qb(),Sb=!0),Tb.add(t,e)}function Rb(){if(wa.Promise&&wa.Promise.resolve){var t=wa.Promise.resolve(void 0);Qb=function(){t.then(Ub)}}else Qb=function(){var t=Ub;"function"!=typeof wa.setImmediate||wa.Window&&wa.Window.prototype&&!Cb(Db,"Edge")&&wa.Window.prototype.setImmediate==wa.setImmediate?(Jb||(Jb=Kb()),Jb(t)):wa.setImmediate(t)}}Ob.prototype.set=function(t,e){this.tp=t,this.scope=e,this.next=null},Ob.prototype.reset=function(){this.next=this.scope=this.tp=null};var Sb=!1,Tb=new Mb;function Ub(){for(var t;t=Tb.remove();){try{t.tp.call(t.scope)}catch(t){Ab(t)}Nb.put(t)}Sb=!1}function Vb(t){if(this.s=Wb,this.rf=void 0,this.Yg=this.Le=this.pg=null,this.tm=this.op=!1,t!=za)try{var e=this;t.call(void 0,(function(t){Xb(e,Yb,t)}),(function(t){Xb(e,Zb,t)}))}catch(t){Xb(this,Zb,t)}}var Wb=0,Yb=2,Zb=3;function $b(){this.next=this.context=this.Th=this.nk=this.Ff=null,this.Cl=!1}$b.prototype.reset=function(){this.context=this.Th=this.nk=this.Ff=null,this.Cl=!1};var ac=new Lb((function(){return new $b}),(function(t){t.reset()}));function bc(t,e,r){var i=ac.get();return i.nk=t,i.Th=e,i.context=r,i}function cc(t){if(t instanceof Vb)return t;var e=new Vb(za);return Xb(e,Yb,t),e}function dc(t){return new Vb((function(e,r){r(t)}))}function ec(){var t,e;return new fc(new Vb((function(r,i){t=r,e=i})),t,e)}function kc(t,e){if(t.s==Wb)if(t.pg){var r=t.pg;if(r.Le){for(var i=0,n=null,o=null,a=r.Le;a&&(a.Cl||(i++,a.Ff==t&&(n=a),!(n&&1<i)));a=a.next)n||(o=a);n&&(r.s==Wb&&1==i?kc(r,e):(o?((i=o).next==r.Yg&&(r.Yg=i),i.next=i.next.next):lc(r),mc(r,n,Zb,e)))}t.pg=null}else Xb(t,Zb,e)}function nc(t,e){t.Le||t.s!=Yb&&t.s!=Zb||oc(t),t.Yg?t.Yg.next=e:t.Le=e,t.Yg=e}function gc(t,e,r,i){var n=bc(null,null,null);return n.Ff=new Vb((function(t,o){n.nk=e?function(r){try{var n=e.call(i,r);t(n)}catch(t){o(t)}}:t,n.Th=r?function(e){try{var n=r.call(i,e);void 0===n&&e instanceof hc?o(e):t(n)}catch(t){o(t)}}:o})),n.Ff.pg=t,nc(t,n),n.Ff}function Xb(t,e,r){if(t.s==Wb){t===r&&(e=Zb,r=new TypeError("Promise cannot resolve to itself")),t.s=1;t:{var i=r,n=t.FD,o=t.GD;if(i instanceof Vb){nc(i,bc(n||za,o||null,t));var a=!0}else{if(i)try{var s=!!i.$goog_Thenable}catch(t){s=!1}else s=!1;if(s)i.then(n,o,t),a=!0;else{if(ya(i))try{var l=i.then;if("function"==typeof l){pc(i,l,n,o,t),a=!0;break t}}catch(e){o.call(t,e),a=!0;break t}a=!1}}}a||(t.rf=r,t.s=e,t.pg=null,oc(t),e!=Zb||r instanceof hc||qc(t,r))}}function pc(t,e,r,i,n){function o(t){a||(a=!0,i.call(n,t))}var a=!1;try{e.call(t,(function(t){a||(a=!0,r.call(n,t))}),o)}catch(t){o(t)}}function oc(t){t.op||(t.op=!0,Pb(t.cz,t))}function lc(t){var e=null;return t.Le&&(e=t.Le,t.Le=e.next,e.next=null),t.Le||(t.Yg=null),e}function mc(t,e,r,i){if(r==Zb&&e.Th&&!e.Cl)for(;t&&t.tm;t=t.pg)t.tm=!1;if(e.Ff)e.Ff.pg=null,rc(e,r,i);else try{e.Cl?e.nk.call(e.context):rc(e,r,i)}catch(t){sc.call(null,t)}ac.put(e)}function rc(t,e,r){e==Yb?t.nk.call(t.context,r):t.Th&&t.Th.call(t.context,r)}function qc(t,e){t.tm=!0,Pb((function(){t.tm&&sc.call(null,e)}))}Vb.prototype.then=function(t,e,r){return gc(this,"function"==typeof t?t:null,"function"==typeof e?e:null,r)},Vb.prototype.$goog_Thenable=!0,Vb.prototype.cancel=function(t){if(this.s==Wb){var e=new hc(t);Pb((function(){kc(this,e)}),this)}},Vb.prototype.FD=function(t){this.s=Wb,Xb(this,Yb,t)},Vb.prototype.GD=function(t){this.s=Wb,Xb(this,Zb,t)},Vb.prototype.cz=function(){for(var t;t=lc(this);)mc(this,t,this.s,this.rf);this.op=!1};var sc=Ab;function hc(t){Ka.call(this,t)}function fc(t,e,r){this.promise=t,this.resolve=e,this.reject=r}function tc(){}function uc(t,e,r){this.type=t,this.data=e,this.Er=ec(),this.resolve=z(this.resolve,this),this.reject=z(this.reject,this),this.priority=vc,r!==A&&(this.priority=r),this.Fp().add(this)}u(hc,Ka),hc.prototype.name="cancel",t("H.util.ICancelable",tc),tc.prototype.cancel=function(){},tc.prototype.cancel=tc.prototype.cancel;var vc=1,wc={PD:0,SD:vc,ND:2};function xc(t){var e;for(e in this.ug={},wc)this.ug[wc[e]]=[];this.Ik=t,this.Ik.addEventListener("allocatable",z(this.St,this))}m=uc.prototype,m.then=function(t,e,r){return this.Er.promise.then(t,e,r)},m.resolve=function(t){this.state=3,this.Er.resolve(t)},m.reject=function(t){this.state=5,this.Er.reject(t)},m.state=0,m.cancel=function(){3>this.state&&(this.Wi(),this.Fp().remove(this),this.state=4)},uc.prototype.cancel=uc.prototype.cancel,t("H.util.JobManager",xc);var yc=Object.keys(wc).map((function(t){return wc[t]})).sort().reverse();function zc(t){t&&"function"==typeof t.l&&t.l()}function Ac(){0!=Bc&&(Dc[Da(this)]=this),this.jh=this.jh,this.fe=this.fe}xc.prototype.add=function(t){B(t,uc,this.add,0),this.ug[t.priority].push(t),this.St()},xc.prototype.contains=function(t){return-1<this.ug[t.priority].indexOf(t)},xc.prototype.remove=function(t){var e=t.priority,r=this.ug[e].indexOf(t);return-1<r?(this.ug[e].splice(r,1),!0):(t.Ds&&this.Ik.$l(t.Ds),!1)},xc.prototype.St=function(){yc.forEach((function(t){this.ug[t]=this.ug[t].filter((function(t){var e;if((e=this.Ik.Eo(t))===x)return!0;var r=z(this.Ik.$l,this.Ik,e,t);t.Ds=e,t.then(r,r),t.state=t.Rt(e)?1:5}),this)}),this)};var Bc=0,Dc={};Ac.prototype.jh=!1,Ac.prototype.l=function(){if(!this.jh&&(this.jh=!0,this.disposeInternal(),0!=Bc)){var t=Da(this);if(0!=Bc&&this.fe&&0<this.fe.length)throw Error(this+" did not empty its onDisposeCallbacks queue. This probably means it overrode dispose() or disposeInternal() without calling the superclass' method.");delete Dc[t]}},Ac.prototype.bc=function(t,e){this.jh?void 0!==e?t.call(e):t():(this.fe||(this.fe=[]),this.fe.push(void 0!==e?Ia(t,e):t))},Ac.prototype.disposeInternal=function(){if(this.fe)for(;this.fe.length;)this.fe.shift()()};var Ec=function(){if(!wa.addEventListener||!Object.defineProperty)return!1;var t=!1,e=Object.defineProperty({},"passive",{get:function(){t=!0}});try{wa.addEventListener("test",za,e),wa.removeEventListener("test",za,e)}catch(t){}return t}();function Fc(t,e){this.type=t,this.currentTarget=this.target=e,this.defaultPrevented=this.yk=!1}function Gc(t,e){Fc.call(this,t?t.type:""),this.relatedTarget=this.currentTarget=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=this.offsetY=this.offsetX=0,this.key="",this.charCode=this.keyCode=0,this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.uj=null,t&&this.Em(t,e)}Fc.prototype.stopPropagation=function(){this.yk=!0},Fc.prototype.preventDefault=function(){this.defaultPrevented=!0},u(Gc,Fc);var Hc={2:"touch",3:"pen",4:"mouse"};Gc.prototype.Em=function(t,e){var r=this.type=t.type,i=t.changedTouches&&t.changedTouches.length?t.changedTouches[0]:null;if(this.target=t.target||t.srcElement,this.currentTarget=e,e=t.relatedTarget){if(Gb){t:{try{Bb(e.nodeName);var n=!0;break t}catch(t){}n=!1}n||(e=null)}}else"mouseover"==r?e=t.fromElement:"mouseout"==r&&(e=t.toElement);this.relatedTarget=e,i?(this.clientX=void 0!==i.clientX?i.clientX:i.pageX,this.clientY=void 0!==i.clientY?i.clientY:i.pageY,this.screenX=i.screenX||0,this.screenY=i.screenY||0):(this.offsetX=Hb||void 0!==t.offsetX?t.offsetX:t.layerX,this.offsetY=Hb||void 0!==t.offsetY?t.offsetY:t.layerY,this.clientX=void 0!==t.clientX?t.clientX:t.pageX,this.clientY=void 0!==t.clientY?t.clientY:t.pageY,this.screenX=t.screenX||0,this.screenY=t.screenY||0),this.button=t.button,this.keyCode=t.keyCode||0,this.key=t.key||"",this.charCode=t.charCode||("keypress"==r?t.keyCode:0),this.ctrlKey=t.ctrlKey,this.altKey=t.altKey,this.shiftKey=t.shiftKey,this.metaKey=t.metaKey,this.pointerId=t.pointerId||0,this.pointerType="string"==typeof t.pointerType?t.pointerType:Hc[t.pointerType]||"",this.state=t.state,this.uj=t,t.defaultPrevented&&Gc.g.preventDefault.call(this)},Gc.prototype.stopPropagation=function(){Gc.g.stopPropagation.call(this),this.uj.stopPropagation?this.uj.stopPropagation():this.uj.cancelBubble=!0},Gc.prototype.preventDefault=function(){Gc.g.preventDefault.call(this);var t=this.uj;t.preventDefault?t.preventDefault():t.returnValue=!1};var Ic="closure_listenable_"+(1e6*Math.random()|0);function Jc(t){return!(!t||!t[Ic])}var Kc=0;function Mc(t,e,r,i,n){this.listener=t,this.proxy=null,this.src=e,this.type=r,this.capture=!!i,this.vm=n,this.key=++Kc,this.ii=this.Il=!1}function Nc(t){t.ii=!0,t.listener=null,t.proxy=null,t.src=null,t.vm=null}function Oc(t){this.src=t,this.pb={},this.ol=0}function Qc(t,e){var r=e.type;if(!(r in t.pb))return!1;var i,n=t.pb[r],o=Ma(n,e);return(i=0<=o)&&Array.prototype.splice.call(n,o,1),i&&(Nc(e),0==t.pb[r].length&&(delete t.pb[r],t.ol--)),i}function Pc(t,e,r,i){for(var n=0;n<t.length;++n){var o=t[n];if(!o.ii&&o.listener==e&&o.capture==!!r&&o.vm==i)return n}return-1}m=Oc.prototype,m.add=function(t,e,r,i,n){var o=t.toString();(t=this.pb[o])||(t=this.pb[o]=[],this.ol++);var a=Pc(t,e,i,n);return-1<a?(e=t[a],r||(e.Il=!1)):((e=new Mc(e,this.src,o,!!i,n)).Il=r,t.push(e)),e},m.remove=function(t,e,r,i){if(!((t=t.toString())in this.pb))return!1;var n=this.pb[t];return-1<(e=Pc(n,e,r,i))&&(Nc(n[e]),Array.prototype.splice.call(n,e,1),0==n.length&&(delete this.pb[t],this.ol--),!0)},m.ia=function(t){t=t&&t.toString();var e,r=0;for(e in this.pb)if(!t||e==t){for(var i=this.pb[e],n=0;n<i.length;n++)++r,Nc(i[n]);delete this.pb[e],this.ol--}return r},m.Jp=function(t,e,r,i){var n=-1;return(t=this.pb[t.toString()])&&(n=Pc(t,e,r,i)),-1<n?t[n]:null},m.bq=function(t,e){var r=void 0!==t,i=r?t.toString():"",n=void 0!==e;return Na(this.pb,(function(t){for(var o=0;o<t.length;++o)if(!(r&&t[o].type!=i||n&&t[o].capture!=e))return!0;return!1}))};var Rc="closure_lm_"+(1e6*Math.random()|0),Sc={},Tc=0;function Uc(t,e,r,i,n){if(i&&i.once)return Vc(t,e,r,i,n);if(Array.isArray(e)){for(var o=0;o<e.length;o++)Uc(t,e[o],r,i,n);return null}return r=Wc(r),Jc(t)?t.rd.add(String(e),r,!1,ya(i)?!!i.capture:!!i,n):Xc(t,e,r,!1,i,n)}function Xc(t,e,r,i,n,o){if(!e)throw Error("Invalid event type");var a=ya(n)?!!n.capture:!!n,s=Yc(t);if(s||(t[Rc]=s=new Oc(t)),(r=s.add(e,r,i,a,o)).proxy)return r;if(i=Zc(),r.proxy=i,i.src=t,i.listener=r,t.addEventListener)Ec||(n=a),void 0===n&&(n=!1),t.addEventListener(e.toString(),i,n);else if(t.attachEvent)t.attachEvent($c(e.toString()),i);else{if(!t.addListener||!t.removeListener)throw Error("addEventListener and attachEvent are unavailable.");t.addListener(i)}return Tc++,r}function Zc(){var t=ad;return function e(r){return t.call(e.src,e.listener,r)}}function Vc(t,e,r,i,n){if(Array.isArray(e)){for(var o=0;o<e.length;o++)Vc(t,e[o],r,i,n);return null}return r=Wc(r),Jc(t)?t.rd.add(String(e),r,!0,ya(i)?!!i.capture:!!i,n):Xc(t,e,r,!0,i,n)}function bd(t,e,r,i,n){if(Array.isArray(e)){for(var o=0;o<e.length;o++)bd(t,e[o],r,i,n);return null}return i=ya(i)?!!i.capture:!!i,r=Wc(r),Jc(t)?t.rd.remove(String(e),r,i,n):!!t&&!(!(t=Yc(t))||!(e=t.Jp(e,r,i,n)))&&cd(e)}function cd(t){if("number"==typeof t||!t||t.ii)return!1;var e=t.src;if(Jc(e))return Qc(e.rd,t);var r=t.type,i=t.proxy;return e.removeEventListener?e.removeEventListener(r,i,t.capture):e.detachEvent?e.detachEvent($c(r),i):e.addListener&&e.removeListener&&e.removeListener(i),Tc--,(r=Yc(e))?(Qc(r,t),0==r.ol&&(r.src=null,e[Rc]=null)):Nc(t),!0}function $c(t){return t in Sc?Sc[t]:Sc[t]="on"+t}function dd(t,e){var r=t.listener,i=t.vm||t.src;return t.Il&&cd(t),r.call(i,e)}function ad(t,e){return!!t.ii||dd(t,new Gc(e,this))}function Yc(t){return(t=t[Rc])instanceof Oc?t:null}var ed="__closure_events_fn_"+(1e9*Math.random()>>>0);function Wc(t){return"function"==typeof t?t:(t[ed]||(t[ed]=function(e){return t.handleEvent(e)}),t[ed])}function fd(t,e,r){fd.g.constructor.call(this,t,r),this.message=e}function E(){Ac.call(this),this.rd=new Oc(this),this.hy=this,this.er=null}function gd(t){var e=(t=t||{}).callback;this.Wb=t.label,Za(e)&&(this.callback=e),this.ub=!!t.disabled,gd.g.constructor.call(this)}t("H.util.Event",Fc),Fc.prototype.stopPropagation=Fc.prototype.stopPropagation,Fc.prototype.stopPropagation=Fc.prototype.stopPropagation,Fc.prototype.CAPTURING_PHASE=1,Fc.prototype.CAPTURING_PHASE=Fc.prototype.CAPTURING_PHASE,Fc.prototype.AT_TARGET=2,Fc.prototype.AT_TARGET=Fc.prototype.AT_TARGET,Fc.prototype.BUBBLING_PHASE=3,Fc.prototype.BUBBLING_PHASE=Fc.prototype.BUBBLING_PHASE,Fc.prototype.eventPhase=0,Fc.prototype.eventPhase=Fc.prototype.eventPhase,u(fd,Fc),t("H.util.ErrorEvent",fd),u(E,Ac),E.prototype[Ic]=!0,m=E.prototype,m.Jb=function(){return this.er},m.ea=function(t){this.er=t},m.addEventListener=function(t,e,r,i){Uc(this,t,e,r,i)},m.removeEventListener=function(t,e,r,i){bd(this,t,e,r,i)},m.dispatchEvent=function(t){var e,r=this.Jb();if(r)for(e=[];r;r=r.Jb())e.push(r);r=this.hy;var i=t.type||t;if("string"==typeof t)t=new Fc(t,r);else if(t instanceof Fc)t.target=t.target||r;else{var n=t;Sa(t=new Fc(i,r),n)}if(n=!0,e)for(var o=e.length-1;!t.yk&&0<=o;o--){var a=t.currentTarget=e[o];n=a.Lf(i,!0,t)&&n}if(t.yk||(n=(a=t.currentTarget=r).Lf(i,!0,t)&&n,t.yk||(n=a.Lf(i,!1,t)&&n)),e)for(o=0;!t.yk&&o<e.length;o++)n=(a=t.currentTarget=e[o]).Lf(i,!1,t)&&n;return n},m.disposeInternal=function(){E.g.disposeInternal.call(this),this.rd&&this.rd.ia(void 0),this.er=null},m.Lf=function(t,e,r){if(!(t=this.rd.pb[String(t)]))return!0;t=t.concat();for(var i=!0,n=0;n<t.length;++n){var o=t[n];if(o&&!o.ii&&o.capture==e){var a=o.listener,s=o.vm||o.src;o.Il&&Qc(this.rd,o),i=!1!==a.call(s,r)&&i}}return i&&!r.defaultPrevented},m.Jp=function(t,e,r,i){return this.rd.Jp(String(t),e,r,i)},m.bq=function(t,e){return this.rd.bq(void 0!==t?String(t):void 0,e)},t("H.util.EventTarget",E),E.prototype.ea=E.prototype.ea,E.prototype.setParentEventTarget=E.prototype.ea,E.prototype.Jb=E.prototype.Jb,E.prototype.getParentEventTarget=E.prototype.Jb,E.prototype.addEventListener=E.prototype.addEventListener,E.prototype.addEventListener=E.prototype.addEventListener,E.prototype.removeEventListener=E.prototype.removeEventListener,E.prototype.removeEventListener=E.prototype.removeEventListener,E.prototype.dispatchEvent=E.prototype.dispatchEvent,E.prototype.dispatchEvent=E.prototype.dispatchEvent,E.prototype.l=E.prototype.l,E.prototype.dispose=E.prototype.l,E.prototype.bc=E.prototype.bc,E.prototype.addOnDisposeCallback=E.prototype.bc,E.prototype.hz=E.prototype.Lf,E.prototype.Lf=function(t,e,r){var i,n,o=!0,a=r[r.currentTarget===r.target?"AT_TARGET":e?"CAPTURING_PHASE":(i=!0,"BUBBLING_PHASE")];return(!i||"pointerenter"!==(n=r.type)&&"pointerleave"!==n)&&(r.eventPhase=a,o=E.prototype.hz.apply(this,arguments),i&&this.Jb&&null===this.Jb()&&delete r.eventPhase),o},E.prototype.Xw=function(t){for(var e,r=this;r&&(e=r.Jb())&&e!==t;)r=e;e||r.ea(t)},E.prototype.setRootParentEventTarget=E.prototype.Xw,u(gd,E),t("H.util.ContextItem",gd),gd.prototype.Gp=function(){return this.Wb},gd.prototype.getLabel=gd.prototype.Gp,gd.prototype.xe=function(t){return this.Wb!==t&&(this.Wb=t,this.dispatchEvent("update")),this},gd.prototype.setLabel=gd.prototype.xe,gd.prototype.mq=function(){return this.ub},gd.prototype.isDisabled=gd.prototype.mq,gd.prototype.wa=function(t){return t!==this.ub&&(this.ub=t,this.dispatchEvent("update")),this},gd.prototype.setDisabled=gd.prototype.wa;var hd=new gd;function id(t,e,r){id.g.constructor.call(this,t,r),this.data=e}gd.SEPARATOR=hd,u(id,Fc),t("H.util.DataEvent",id);var jd=Math,kd=jd.min,ld=jd.max,md=jd.round,nd=jd.floor,od=jd.ceil,pd=jd.abs,qd=jd.log,rd=jd.sqrt,sd=jd.pow,td=jd.exp,ud=jd.sin,vd=jd.asin,wd=jd.cos,xd=jd.tan,yd=jd.atan,zd=jd.atan2,Ad=jd.LN2,Bd=jd.PI,Cd=Bd/2,Dd=Bd/4,Ed=2*Bd,Fd=3*Bd,Gd=Bd/180,Hd=180/Bd,Id=1/0,Jd=sd(-2,53),Kd=Kd||function(t){return qd(t)/Ad};function Ld(t,e){var r;return 0>(r=t%e)==0>e?r:r+e}function Md(t,e,r){return e-=r=r||0,(t-=r)-nd(t/e)*e+r}function Nd(t,e,r){return(t-=0)>r?r:t<e?e:t}function Od(t,e,r,i){return(i-=0)||(i=0),e<r?t>=e-i&&t<=r+i:t>=r-i&&t<=e+i}t("H.math.normalize",Md),t("H.math.clamp",Nd);var Pd={NONE:0,VERTEX:1,EDGE:2,SURFACE:3};function Qd(t,e,r,i,n,o){var a=r.length,s=a,l=r[0],u=0,c=0,h=0;i=i/2||0;var p=o||2;o=p*(n?0:1)+1;for(var f=p-2;1!=u&&s>o;){s-=f;var d=r[--s];p=r[--s];var y=r[s?s-f-1:(a+(s-f-1))%a],g=r[s?s-f-2:(a+(s-f-2))%a];p>=t-i&&p<=t+i&&d>=e-i&&d<=e+i||g>=t-i&&g<=t+i&&y>=e-i&&y<=e+i?u=1:u||p!==t?!u&&Od(t,p,g,i)&&((p<t&&g>t||p>t&&g<t)&&(c+=(l=d+(t-p)/(g-p)*(y-d))>e,h+=l<e),u=Od(e,d,y,i)&&rd(sd((t-g)*(d-y)-(e-y)*(p-g),2)/(sd(p-g,2)+sd(d-y,2)))<=i?2:0):(g===t&&(d<e&&y>e||d>e&&y<e)||(l<=t&&g>t||l>=t&&g<t)&&(d>=e?++c:++h),u=Od(e,d,y,i)&&rd(sd((t-g)*(d-y)-(e-y)*(p-g),2)/(sd(p-g,2)+sd(d-y,2)))<=i?2:0),l=p}return!u&&n&&0!==h&&0!=c%2&&(u=3),u}function Rd(t,e){return Qd(t.x,t.y,e,0,!0)!==Pd.NONE}function Sd(t){for(var e=t.length,r=new Float64Array(2*e),i=e&&ab(t[0].x);e--;){var n=t[e],o=e<<1;r[o]=i?n.x:n[0],r[o+1]=i?n.y:n[1]}return r}function Td(t,e,r){var i=[],n=arguments.length;return t&&i.push(cb(t)),1<n&&(n=2<n&&fb(r)?" out of ["+r[0]+"..."+r[1]+"]":"",i.push("("+e+n+")")),i=Error(i.join(" ")),Object.setPrototypeOf(i,Td.prototype),i}function Ud(t){if(globalThis.document){var e=document.createElement("canvas");return e.width=e.height=1,e.getContext("2d",{$D:t})}return null}function Vd(){return window.devicePixelRatio||1}t("H.math.CoverType",Pd),t("H.math.isPointInsidePolygon",Rd),t("H.math.flatten",Sd),u(Td,Error),t("H.lang.OutOfRangeError",Td),Td.prototype.name="OutOfRangeError",t("H.util.getPixelRatio",Vd);var Wd=/^rgba\(([^,]+),([^,]+),([^,]+),([^)]+)\)$/;function Xd(t){var e=Yd[t],r=globalThis.RegExp;return e||(globalThis.Uint8ClampedArray||(globalThis.Uint8ClampedArray=function(t){return t instanceof Number?Array(t):t.map((function(t){return Nd(md(t),0,255)}))}),"none"===t?e=new Uint8ClampedArray([0,0,0,0]):(Zd.fillStyle="black",Zd.fillStyle=t,Wd.test(Zd.fillStyle)?e=new Uint8ClampedArray([r.$1,r.$2,r.$3,255*r.$4]):(Zd.clearRect(0,0,1,1),Zd.fillRect(0,0,1,1),e=Zd.getImageData(0,0,1,1).data)),Yd[t]=e),e}function $d(t){return"none"!==t&&0<Xd(t)[3]}var Yd=Ua(),ae=!!globalThis.VBArray;function be(t,e){return t!==A?t:e}function ce(t){return/^<svg/.test(t)?"data:image/svg+xml;charset=utf-8,"+encodeURIComponent(t):t}function de(t){this.Ad=0<+t?jd.round(t):0}t("H.util.eval",(function(a){return eval(a)})),t("H.util.provide",(function(t){var e=wa.$jscomp;if(e&&"function"==typeof e.Dz&&e.Dz())throw Error("goog.provide cannot be used within a module.");xa(t,void 0,void 0)})),de.prototype.next=function(t){if(9007199254740992===this.Ad)throw new Td(t,this.Ad,[0,9007199254740991]);return this.Ad++};var ee=new de,fe=z(ee.next,ee);function ge(){return!0}function he(){return!1}function ie(){}var je=Wa([]),ke=Wa({});function le(t){return"CANVAS"===t.tagName?[t]:t.getElementsByTagName("CANVAS")}function me(t,e,r){var i;if(e=t.ownerDocument===e?t.cloneNode(!0):e.importNode(t,!0),r)for(t=le(t),i=(r=le(e)).length;i--;)r[i].getContext("2d").drawImage(t[i],0,0);return e}var Zd=Ud(!0),ne=Ud(!1);function oe(t){var e=t.complete,r=0<t.naturalWidth;if(e&&!r&&ae)try{ne.drawImage(t,0,0),r=!0}catch(t){}return e&&r}var pe=globalThis.BlobBuilder||globalThis.WebKitBlobBuilder||globalThis.MozBlobBuilder;function qe(t,e){if(e=e||"",pe){var r=new pe;r.append(t),t=r.getBlob(e)}else t=new Blob([t],{type:e});return t}var re=globalThis.navigator;function se(t,e,r){var i=Nd(+t,-90,90);if(e&&D(i))throw new C(e,r,t);return i}function te(t,e,r){var i=+t;if((-180>i||180<i)&&(i=Ld(i+180,360)-180),e&&D(i))throw new C(e,r,t);return i}function ue(t,e,r){var i;if(t!==A&&D(i=+t)&&e)throw new C(e,r,t);return i}function ve(t,e){return 0>t!=0>e&&180<pd(e-t)}function we(){bb(this,we)}function xe(t,e,r){this.lat=se(t,xe,0),this.lng=te(e,xe,1),r!==A&&(this.alt=ue(r,xe,2))}function ye(t,e,r){var i=ya(t)&&!(D(t.lat=se(t.lat))||D(t.lng=te(t.lng))||t.alt!==A&&D(t.alt=ue(t.alt)));if(!i&&e)throw new C(e,r,t);return i}function ze(t){if(!t)throw new C(ze,0,t);return new xe(t.lat,t.lng,t.alt)}function I(t,e,r,i){Ae(this,se(t,I,0),te(e,I,1),se(r,I,2),te(i,I,3))}function Ae(t,e,r,i,n){return t.W=r,t.ca=n,e<i&&(r=e,e=i,i=r),t.fa=e,t.ga=i,t.ll=t.Ri=t.Ef=null,t}function Ce(t,e){return(t=e-t)+(0>t?360:0)}function Be(t,e){return(t+=e/2)-(180<t?360:0)}function De(t,e,r,i,n,o,a,s,l){r=kd(r,a),t=ld(t,n);var u=Be(e,n=Ce(e,i)),c=Be(o,a=Ce(o,s))-u;if(180>(c+=0>c-1e-6?360:0)-1e-6){u=e;var h=s}else c=360-c,u=o,h=i;return 360<=(c=c+n/2+a/2)+5e-7?(u=-180,h=180):c-5e-7<n?(u=e,h=i):c-5e-7<a&&(u=o,h=s),l?Ae(l,t,u,r,h):new I(t,u,r,h)}function Ee(t,e,r){return r||(ye(t,Ee,0),ye(e,Ee,1)),new I(t.lat,t.lng,e.lat,e.lng)}function Fe(t,e){var r=1,i=t.length,n=null;if(!Ca(t))throw new C(Fe,0,t);if(0<i){var o=t[0];for(n=Ee(o,o,e);r<i;r++)o=t[r],n.df(o.lat,o.lng,e,n)}return n}function Ge(t,e){var r,i=3,n=t.length;if(!(e||t&&null!=t.length))throw new C(Ge,0,t);if(0<n)for(r=new I(t[0],t[1],t[0],t[1]);i<n;i+=3)r.df(t[i],t[i+1],e,r);return r}function He(t,e){var r,i=1,n=t.length;if(e&&(!t||null==t.length))throw new C(He,0,t);if(0<n)for(r=new I(t[0].fa,t[0].W,t[0].ga,t[0].ca);i<n;i++)r.zd(t[i],e,r);return r}yb=/Edge\/\d+/.test(re.appVersion),zb=/(A|a)ndroid/.test(re.appVersion),t("H.geo.isDBC",ve),t("H.geo.AbstractGeometry",we),we.prototype.getBoundingBox=we.prototype.C,we.prototype.equals=we.prototype.da,we.prototype.ac="",we.prototype.Kc="",we.prototype.toString=function(){return this.yf([this.ac.toUpperCase()," "]).join("")},we.prototype.toString=we.prototype.toString,we.prototype.ze=function(){return{type:this.Kc,coordinates:this.xf()}},we.prototype.toGeoJSON=we.prototype.ze,we.prototype.P=function(){return{type:this.ac,coordinates:this.Rd(),boundingBox:this.C().P()}},we.prototype.forWorkerMessage=we.prototype.P,u(xe,we),t("H.geo.Point",xe),xe.prototype.da=function(t){return this===t||!!t&&this.lat===t.lat&&this.lng===t.lng&&(this.alt||0)===(t.alt||0)},xe.prototype.equals=xe.prototype.da,xe.prototype.kb=function(t){if(this===t||this.lat===t.lat&&this.lng===t.lng)t=0;else{var e=this.lat*Gd,r=t.lat*Gd;t=12742001.58*vd(kd(1,rd(sd(ud((e-r)/2),2)+wd(e)*wd(r)*sd(ud((this.lng*Gd-t.lng*Gd)/2),2))))}return t},xe.prototype.distance=xe.prototype.kb,xe.prototype.mo=function(t,e,r){var i;if(r){if(i=e/6371000.79){e=t*Gd,t=Gd*this.lat;var n=ud(t);r=ud(i);var o=wd(i);i=Gd*this.lng;var a=wd(t);t=vd(a*wd(e)*r+n*o),e=(i+(e=zd(ud(e)*a*r,o-n*ud(t)))+Bd)%(2*Bd)-Bd,n=new xe(t*Hd,(540+(e*=Hd))%360-180)}return n||this}return 0==(90+(t=(t%360+360)%360))%180?(t=this.lng+e/(6371000.79*Ed*wd(this.lat*Gd))*(270===t?-360:360),new xe(this.lat,(t+540)%360-180)):((e/=6371000.79)&&(t*=Gd,n=this.lat*Gd,r=this.lng*Gd,o=(i=n+e*wd(t))-n,a=qd(xd(i/2+Dd)/xd(n/2+Dd)),a=D(o/a)?wd(n):o/a,t=e*ud(t)/a,pd(i)>Cd&&(i=0<i?Bd-i:-(Bd+i)),i=new xe(i*Hd,((r+t+Fd+(pd(n+o)>Cd?Bd:0))%Ed-Bd)*Hd)),i||this)},xe.prototype.walk=xe.prototype.mo,xe.prototype.C=function(){return new I(this.lat,this.lng,this.lat,this.lng)},xe.prototype.getBoundingBox=xe.prototype.C,xe.validate=ye,xe.fromIPoint=ze,m=xe.prototype,m.ac="Point",m.yf=function(t){return t.push("(",this.lng," ",this.lat,")"),t},m.Kc="Point",m.xf=function(){return[this.lng,this.lat,this.alt||0]},m.Rd=function(){return[this.lat,this.lng,this.alt||0]},u(I,we),t("H.geo.Rect",I),I.prototype.ac="Polygon",I.prototype.yf=function(t){var e=this.fa,r=this.W,i=this.ga,n=this.ca;return t.push("(","(",r," ",e,",",n," ",e,",",n," ",i,",",r," ",i,",",r," ",e,")",")"),t},I.prototype.da=function(t){var e=this===t;return!e&&B(t,I)&&(e=this.fa===t.fa&&this.W===t.W&&this.ga===t.ga&&this.ca===t.ca),e},I.prototype.equals=I.prototype.da,I.prototype.clone=function(){return new I(this.fa,this.W,this.ga,this.ca)},I.prototype.clone=I.prototype.clone,I.prototype.Oc=function(){return this.ll||(this.ll=new xe(this.fa,this.W)),this.ll},I.prototype.getTopLeft=I.prototype.Oc,I.prototype.Mc=function(){return this.Ri||(this.Ri=new xe(this.ga,this.ca)),this.Ri},I.prototype.getBottomRight=I.prototype.Mc,I.prototype.JA=function(){return this.fa},I.prototype.getTop=I.prototype.JA,I.prototype.xz=function(){return this.ga},I.prototype.getBottom=I.prototype.xz,I.prototype.dA=function(){return this.W},I.prototype.getLeft=I.prototype.dA,I.prototype.zA=function(){return this.ca},I.prototype.getRight=I.prototype.zA,I.prototype.wb=function(){return this.Ef||(this.Ef=new xe(this.ga+(this.fa-this.ga)/2,Be(this.W,this.oc()))),this.Ef},I.prototype.getCenter=I.prototype.wb,I.prototype.oc=function(){return Ce(this.W,this.ca)},I.prototype.getWidth=I.prototype.oc,I.prototype.yh=function(){return this.fa-this.ga},I.prototype.getHeight=I.prototype.yh,I.prototype.qc=function(){return this.W>this.ca},I.prototype.isCDB=I.prototype.qc,I.prototype.Im=function(){return!this.oc()&&!this.yh()},I.prototype.isEmpty=I.prototype.Im,I.prototype.C=function(){return new I(this.fa,this.W,this.ga,this.ca)},I.prototype.getBoundingBox=I.prototype.C,I.prototype.Pl=function(t,e,r){var i=this.wb();return r||(t=se(t,this.Pl,0),e=te(e,this.Pl,1)),(t=(e=this.df(t,e,r)).wb()).lat===i.lat&&t.lng===i.lng&&this.yh()===e.yh()&&this.oc()===e.oc()},I.prototype.containsLatLng=I.prototype.Pl,I.prototype.Gf=function(t,e){return e||ye(t,this.Gf,0),this.Pl(t.lat,t.lng,e)},I.prototype.containsPoint=I.prototype.Gf,I.prototype.Vo=function(t,e){var r=this.wb();if(!e&&!B(t,I))throw new C(this.Vo,0,t);return(t=(e=this.zd(t,e)).wb()).lat===r.lat&&t.lng===r.lng&&this.yh()===e.yh()&&this.oc()===e.oc()},I.prototype.containsRect=I.prototype.Vo,I.prototype.df=function(t,e,r,i){if(!r){if(D(t=se(t)))throw new C(this.df,0,t);if(D(e=te(e)))throw new C(this.df,1,e)}return De(this.fa,this.W,this.ga,this.ca,t,e,t,e,i)},I.prototype.mergeLatLng=I.prototype.df,I.prototype.yv=function(t,e,r){return e||ye(t,this.yv,0),this.df(t.lat,t.lng,e,r)},I.prototype.mergePoint=I.prototype.yv,I.prototype.zd=function(t,e,r){if(!e&&!B(t,I))throw new C(this.zd,0,t);return De(this.fa,this.W,this.ga,this.ca,t.fa,t.W,t.ga,t.ca,r)},I.prototype.mergeRect=I.prototype.zd,I.prototype.de=function(t,e,r,i,n,o){return n||(t=se(t,this.de,0),e=te(e,this.de,1),r=se(r,this.de,2),i=te(i,this.de,3)),De(this.fa,this.W,this.ga,this.ca,t,e,r,i,o)},I.prototype.mergeTopLeftBottomRight=I.prototype.de,I.prototype.Wf=function(t,e){var r=this.W<=this.ca,i=t.W<=t.ca,n=this.W<t.ca,o=t.W<this.ca;if(!e&&!B(t,I))throw new C(this.Wf,0,t);return this.ga<=t.fa&&t.ga<=this.fa&&(!r&&(!i||n||o)||!i&&(n||o)||n&&o)},I.prototype.intersects=I.prototype.Wf,I.merge=De,I.fromPoints=Ee,I.coverPoints=Fe,I.coverLatLngAlts=Ge,I.coverRects=He,I.prototype.Iw=function(t,e){var r=this.W,i=this.fa,n=this.ca,o=this.ga,a=this.wb().lng;ye(t,this.Iw,0);var s=t.lat-o-(i-o)/2,l=t.lng-a;return t=-180>(t=r+(0>(l=180<l||-180>l?-(a+t.lng):l)?2*l:0))?360+t:t,n=180<(n+=0<l?2*l:0)?n-360:n,90<=(i=0<s?i+2*s:i)&&(i=90),-90>=(o=0>s?o+2*s:o)&&(o=-90),e?Ae(e,i,t,o,n):new I(i,t,o,n)},I.prototype.resizeToCenter=I.prototype.Iw,I.prototype.Kc="Polygon",I.prototype.xf=function(){return[[this.W,this.fa,0],[this.ca,this.fa,0],[this.ca,this.ga,0],[this.W,this.ga,0],[this.W,this.fa,0]]},I.prototype.P=function(){return this.Rd()},I.prototype.Rd=function(){return[this.fa,this.W,this.ga,this.ca]};var Ie=[62,-1,-1,52,53,54,55,56,57,58,59,60,61,-1,-1,-1,-1,-1,-1,-1,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,-1,-1,-1,-1,63,-1,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51],Je="undefined"!=typeof BigInt?BigInt:Number;function Ke(t){var e=Je(0),r=Je(0),i=[];if(t.split("").forEach((function(t){t=Je(Ie[t.charCodeAt(0)-45]),e|=(t&Je(31))<<r,(t&Je(32))===Je(0)?(i.push(e),e=Je(0),r=Je(0)):r+=Je(5)})),0<r)throw Error("Invalid encoding");return i}function Le(t){return t&Je(1)&&(t=~t),+(t>>=Je(1)).toString()}function Me(t){var e=void 0===t.precision?5:t.precision,r=void 0===t.hl?0:t.hl,i=void 0===t.il?0:t.il;t=t.kr;var n=Math.pow(10,e),o=Math.pow(10,i);if(0>e||15<e)throw Error("precision out of range. Should be between 0 and 15");if(0>i||15<i)throw Error("thirdDimPrecision out of range. Should be between 0 and 15");if(0>r||7<r||4===r||5===r)throw Error("thirdDim should be between 0, 1, 2, 3, 6 or 7");e=Ne(1)+Ne(i<<7|r<<4|e);var a=[],s=Je(0),l=Je(0),u=Je(0);return t.forEach((function(t){var e=Je(Math.round(t[0]*n));a.push(Oe(e-s)),s=e,e=Je(Math.round(t[1]*n)),a.push(Oe(e-l)),l=e,r&&(t=Je(Math.round(t[2]*o)),a.push(Oe(t-u)),u=t)})),[].concat(e instanceof Array?e:ha(fa(e)),a instanceof Array?a:ha(fa(a))).join("")}function Ne(t){var e="";for(t=Je(t);31<t;)e+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_"[t&Je(31)|Je(32)],t>>=Je(5);return e+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_"[t]}function Oe(t){var e=0>(t=Je(t));return t<<=Je(1),e&&(t=~t),Ne(t)}function Pe(t){return Me({kr:t.polyline,precision:t.precision,hl:t.thirdDim,il:t.thirdDimPrecision})}function Qe(t){if(1!=+(t=Ke(t))[0].toString())throw Error("Invalid format version");var e=+t[1].toString();e={precision:15&e,hl:e>>4&7,il:e>>7&15};for(var r=Math.pow(10,e.precision),i=Math.pow(10,e.il),n=e.hl,o=0,a=0,s=0,l=[],u=2;u<t.length;){var c=Le(t[u+1])/r;o+=Le(t[u])/r,a+=c,n?(s+=Le(t[u+2])/i,l.push([o,a,s]),u+=3):(l.push([o,a]),u+=2)}if(u!==t.length)throw Error("Invalid encoding. Premature ending reached");return{polyline:(t=Object.assign({},e,{kr:l})).kr,precision:t.precision,thirdDim:t.hl,thirdDimPrecision:t.il}}function Re(t,e,r,i,n,o){bb(this,Re),this.Ph=t||10,this.xj=null,this.Yi=i||0,this.Zi=n||0,this.Bk=e||1,this.Ck=r||1,this.Lx=!!o,this.flush()}function Se(t){var e=t.xj;if(t.Lx&&!e){var r=t.head;(r.entries||r[0]||r[1]||r[2]||r[3])&&(e=Te([e=[r],e,e,e],[r[6],r[7],r[4],r[5]]),t.xj=e)}return e}function Te(t,e){var r,i,n,o,a=0;for(r=3;0<=r;r--){var s=r+4,l=0<r%3,u=[],c=e[r],h=t[r];for(i=h.length;i--;){var p=h[i];if(n=p.entries)for(o=n.length;o--;){var f=n[o].Of(r);(l?f>c:f<c)&&(c=f)}for(o=4;o--;)(n=p[o])&&(l?n[s]>c:n[s]<c)&&u.push(n)}a+=u.length,e[r]=c,t[r]=u}return a&&(e=Te(t,e)),e}function Ue(t,e,r){var i,n;if(t.Lx&&(i=t.xj))for(n=3;0<=n;n--){var o=e.Of(n);if(n%3?o>=i[n]:o<=i[n]){if(!r){t.xj=null;break}i[n]=o}}}function We(t,e,r,i,n,o,a,s,l){var u,c=e.entries,h=e[7],p=e[4],f=e[5],d=e[6],y=e[8],g=e[9];if(c){var v=c.length;if(n>p||i>h||a<d||o<f)for(;v--;)p=(h=c[v]).Of(3),f=h.Of(0),d=h.Of(1),h.Of(2)>=n&&d>=i&&(f<a||s&&f==a)&&(p<o||l&&p==o)&&r.push(h);else for(;v--;)r.push(c[v])}(o>y||l&&o==y)&&(n<g&&(u=e[1])&&We(t,u,r,i,n,o,a,s,l),(a>g||s&&a==g)&&(u=e[3])&&We(t,u,r,i,n,o,a,s,l)),i<y&&(n<g&&(u=e[0])&&We(t,u,r,i,n,o,a,s,l),(a>g||s&&a==g)&&(u=e[2])&&We(t,u,r,i,n,o,a,s,l))}t("H.util.flexiblePolyline.encode",Pe),t("H.util.flexiblePolyline.decode",Qe),m=Re.prototype,m.remove=function(t){var e,r,i,n=!1;return t&&(e=t.node)&&e.nl===this&&(r=e.entries)&&0<=(i=r.indexOf(t))&&(r.splice(i,1),this.Ll(e),Ue(this,t,!1),n=!0),n},m.flush=function(){var t=new Ve(A,NaN,this.Yi-this.Bk,this.Zi-this.Ck,this.Yi+this.Bk,this.Zi+this.Ck);t.nl=this,this.head=this.root=t,this.xj=null},m.ld=function(t){var e,r=this.head;if(t){var i=t;if(i!==r)for(r=i;i=i.parent;)(i.entries||1<i.hb)&&(r=i)}else for(;!r.entries&&2>(e=r.hb)&&e;)r=i;this.head=r},m.ob=function(t,e,r,i,n,o){var a=[],s=this.head,l=this.root;return t<=s[5]&&e<=s[6]&&(n?r>=s[7]:r>s[7])&&(o?i>=s[4]:i>s[4])&&We(this,s,a,t,e,r,i,o||i>=l[6],n||r>=l[5]),a},m.Ae=ca(1);var Xe=0;function Ve(t,e,r,i,n,o){this.Co=e,t&&(this.parent=t,this.nl=t.nl,1&e?(r=t[8],n=t[5]):(r=t[7],n=t[8]),2&e?(i=t[9],o=t[6]):(i=t[4],o=t[9])),this[7]=r,this[5]=n,this[8]=(r+n)/2,this[4]=i,this[6]=o,this[9]=(i+o)/2}function Ye(t,e,r,i,n){var o=t[5],a=t[6];return t[7]<=e&&t[4]<=r&&(o>i||o===i&&o===t.nl.root[5])&&(a>n||a===n&&a===t.nl.root[6])}function Ze(t,e,r,i,n,o){Ze.g.constructor.apply(this,arguments)}function $e(t,e,r,i,n){if(Ye(t.root,e,r,i,n))return t.Vb(t.root,e,r,i,n,t.Ph);throw Error("Coordinates out of bounds")}function af(t,e,r,i){this.id=Xe++,this[0]=e,this[1]=r,this[2]=i,this[3]=t}function bf(t){this.Be=new Ze(+t||10,180,90,0,0,!0),this.Kl=[],this.kq=!1,this.Df=this.Mg=this.J=null}function cf(t,e,r,i,n,o,a){var s,l=(t=t.Kl).length,u=[];if(l){var c=r+360;for(s=n+360;l--;){var h=t[l];(df(h,e,r,i,n,o,a)||df(h,e,c,i,s,o,a))&&u.push(h)}}return u}function df(t,e,r,i,n,o,a){var s=t[3],l=t[0],u=t[1];return t=t[2],(o?l<=i:l<i)&&(a?s<=n:s<n)&&t>=e&&u>=r}function ef(t,e){var r,i,n;if(r=e.length){var o=t.length;for(i={};o--;)i[t[o].id]=1;for(;r--;)(n=e[r]).id in i||t.push(n)}}function J(t){J.g.constructor.call(this),t&&ff(t,J,0),this.S=t||[],this.jd=gf(this,0,this.S.length)}function gf(t,e,r){t=t.S;var i=0;for(e=ld(e,0),r=kd(r,t.length),r-=2,e+=1;e<r;)i+=ve(t[e],t[e+=3]);return i}function hf(t,e,r,i,n){var o=t.S.length;e=se(e,n),r=te(r,n),t.S.push(se(e,n),te(r,n),i===A?0:ue(i,n)),o&&(t.jd+=ve(t.S[o-2],r)),delete t.J,delete t.ur}function ff(t,e,r){for(var i,n=t.length,o=!(n%3);o&&n;)o=!(D(t[--n]=ue((i=t[n])===A?0:i))||D(t[--n]=te(t[n]))||D(t[--n]=se(t[n])));if(!o&&e)throw new C(e,r,t)}function jf(t){var e=new J,r=0,i=t.length;if(i%2)throw new C(jf,0,t);for(;r<i;)hf(e,t[r++],t[r++],0,jf);return e}function kf(t,e){return t.to-e.to}function lf(t,e){var r,i=t.S,n=-2,o=[],a=t.ur;if(!a){a=t.ur=new bf;var s=0,l=t.S,u=l.length;for(r=0;r<u;r+=3){var c=l[r],h=l[r+1];if(r){var p=a.Ou(p,f,c,h);p.to=s++}p=c;var f=h}}for(l=(a=a.Fm(e).sort(kf)).length,e=0;e<l;e++){if(u=3*(s=(s=a[e]).to),s>n+1){var d=[i[u],i[u+1]];o.push(d)}n=s,d.push(i[u+3],i[u+4])}if(t.jd){for(i=[],n=o.length,e=0;e<n;e++)if(a=(d=o[e]).length){for(l=[],t=0;t<a;t+=2)s=d[t],u=d[t+1],l.push(s,u),r=d[t-1],t&&ve(u,r)&&(i.push(l),r+=0>r?360:-360,(l=[]).push(d[t-2],r,s,u));i.push(l)}o=i}return o}function mf(t){var e=Qe(t);t=e.polyline;var r=e.thirdDim;if(e=2===r||3===r,r=0===r,!t)throw new C(mf,0,"data");if(e||r){r=t.length;for(var i=Array(3*r),n=0,o=0;n<r;n++){var a=t[n];i[o++]=a[0],i[o++]=a[1],i[o++]=e?a[2]:0}}if(!i)throw new C(mf,0,"only ABSENT, ALTITUDE or ELEVATION are supported as type of the 3rd dimension");return new J(i)}function K(t,e){this.x=+t,this.y=+e}function nf(t){if(!t)throw Error("invalid argument");return t instanceof K?t:new K(t.x,t.y)}function of(t,e,r,i,n,o){var a,s,l,u,c=t.length;if(c)for(a=[];c--;){var h=t[c],p=h.length,f=0;for(l=1;l<p;l++)if(u=pf(h[l-1],h[l],r,e,i,n)){var d=u[0],y=u[1];f&&f.da(d)?s.push(y):a.push(s=u),f=y,o&&(l=p,c=0)}}else a=t;return a}function pf(t,e,r,i,n,o){var a=t.x;t=-t.y;var s=e.x;if(e=-e.y,r=-r,o=-o,a>s){if(s>n||a<i)return;var l=a,u=t;a=s,t=e,s=l,e=u,l=1}else if(a>n||s<i)return;if(t>e){if(e>r||t<o)return;var c=1;t=-t,e=-e,u=o,o=-r,r=-u}else if(t>r||e<o)return;if(a<i){if((t+=(i-a)*(e-t)/(s-a))>r)return;a=i}if(t<o){if((a+=(o-t)*(s-a)/(e-t))>n)return;t=o}return s>n&&(e=t+(n-a)*(e-t)/(s-a),s=n),e>r&&(s=a+(r-t)*(s-a)/(e-t),e=r),c&&(t=-t,e=-e),l?[new K(s,-e),new K(a,-t)]:[new K(a,-t),new K(s,-e)]}function qf(t,e,r){var i,n;t=rf(t,!0),e=rf(e,!1);var o={},a=i=1;switch(~~(1*(r||0))){case 1:a=i=0;break;case 2:i=0,a=1;break;case 3:i=1,a=0}r=i;var s=a;if(e&&t){for(e.kj=new sf(e.x,e.y,null,tf(e)),t.kj=new sf(t.x,t.y,null,tf(t)),a=e;a.next;a=a.next)if(!a.ob)for(i=t;i.next;i=i.next)if(!i.ob){var l=uf(a.next),u=uf(i.next);if(n=vf(a,l,i,u,o)){n=o.ly;var c=o.my,h=o.JD,p=o.KD;wf(n=new sf(h,p,null,null,null,null,!0,0,0,n),a,l),wf(l=new sf(h,p,null,null,null,null,!0,0,0,c),i,u),n.Mq=l,l.Mq=n}}for(o=Rd(e,xf(t)),r&&(o=!o),a=e;a;a=a.next)a.ob&&(a.nq=o,o=!o);for(o=Rd(t,xf(e)),s&&(o=!o),i=t;i.next;i=i.next)i.ob&&(i.nq=o,o=!o);for(yf(e),yf(t);(t=zf(e))!=e;){for(r=null;!t.ko;t=t.Mq){for(o=t.nq;(r=new sf(t.x,t.y,r)).artificial=t.ob||t.Uu,t.ko=1,t=o?t.next:t.Dd;)if(t.ob){t.ko=1;break}if(!t)break}r.Nq=f||null;var f=r}return f}}function sf(t,e,r,i,n,o,a,s,l,u){this.x=t,this.y=e,this.next=r||null,this.Dd=i||null,this.Nq=n||null,this.Mq=o||null,this.ob=!!a,this.nq=!!s,this.ko=l||0,this.alpha=u||0,i&&(i.next=this),r&&(r.Dd=this),this.Uu=!1,this.kj=null}function uf(t){for(;t&&t.ob;)t=t.next;return t}function tf(t){if(t)for(;t.next;)t=t.next;return t}function zf(t){var e=t;if(e)do{e=e.next}while(e!=t&&(!e.ob||e.ob&&e.ko));return e}function yf(t){var e=tf(t);e.Dd.next=t,t.Dd=e.Dd}function vf(t,e,r,i,n,o){var a,s=e.x-t.x,l=e.y-t.y,u=i.x-r.x,c=i.y-r.y,h=s*c-l*u;return h?(u=((r.x-t.x)*c-(r.y-t.y)*u)/h,h=(l*(r.x-t.x)-s*(r.y-t.y))/h,0>u||1<u||0>h||1<h?0:(0===u?a=t:1===u?a=e:0===h?a=r:1===h&&(a=i),a&&!o?(a.x+=2480549651603763e-20,a.y+=7321997314118067e-20,a.kj&&(a.kj.x=a.x,a.kj.y=a.y),vf(t,e,r,i,n)):(n.JD=t.x+u*s,n.KD=t.y+u*l,n.ly=u,n.my=h,1))):0}function xf(t){for(var e=[];t;)e.push(t.x,t.y),t=t.next;return e}function wf(t,e,r){for(e=e.next;e!==r&&e.alpha<=t.alpha;)e=e.next;t.next=e,t.Dd=e.Dd,t.next.Dd=t,t.Dd.next=t}function rf(t,e){for(var r,i=null,n=0,o=t.length;n<o;n++)(r=new sf(t[n].x,t[n].y,i)).Uu=e,(r.next=i)&&(i.Dd=r),i=r;return i}function L(t,e){var r;if(L.g.constructor.call(this),B(t,J,L,0),e!==A&&fb(e,L,1)){for(r=0;r<e.length;r++)B(e[r],J,L,1,"index "+r);this.cb=e}else this.cb=[];this.Fb=t,this.Tj=[]}function Af(t){var e=L,r=J,i=t.fa,n=t.W,o=t.ga,a=t.ca;return n=[i,n,A,i,a,A,o,a,A,o,n,A],180<=t.oc()&&(n.splice(9,0,o,t=t.wb().lng,A),n.splice(3,0,i,t,A)),new e(new r(n))}m=Ve.prototype,m.hb=0,m.th=function(t){return this[t]||(++this.hb,this[t]=new Ve(this,t))},m.removeChild=function(t){var e=t.Co;this[e]===t&&(delete this[e],delete t.parent,--this.hb)},m.Ae=ca(0),m.Qg=function(t){(this.entries||(this.entries=[])).push(t),t.node=this},u(Ze,Re),Ze.prototype.Ll=function(t){for(var e,r,i=this.head;t&&!((e=t.entries)&&e.length||(e&&delete t.entries,t.hb||!(r=t.parent)));)r.removeChild(t),i===t&&(i=r),t=r;this.head!==i&&(this.head=i,this.ld())},Ze.prototype.Ou=function(t,e,r,i){if(t>r){var n=t;t=r,r=n}return e>i&&(n=e,e=i,i=n),$e(this,t,e,r,i)},Ze.prototype.Zd=function(t,e){return $e(this,t,e,t,e)},Ze.prototype.Vb=function(t,e,r,i,n,o){var a=t[8],s=t[9],l=0,u=0;return o&&(i<a||(l=+(e>=a)))&&(n<s||(u=+(r>=s)))?e=this.Vb(t.th(l|u<<1),e,r,i,n,o-1):(t.Qg(e=new af(e,r,i,n)),Ue(this,e,!0),this.ld(t)),e},af.prototype.Of=function(t){return this[t]},t("H.geo.QuadTree",bf),m=bf.prototype,m.jc=0,m.qc=function(){return this.kq},m.C=function(){var t,e;if(!this.J){var r,i,n,o=[];if(!this.Mg&&(t=Se(this.Be))&&(this.Mg=new I(-t[0],t[3],-t[2],t[1])),(e=this.Mg)&&o.push(e),!this.Df&&(n=(i=this.Kl).length)){t=90;var a=360,s=-90;for(r=0;n--;){var l=i[n];t=kd(t,l[0]),a=kd(a,l[3]),s=ld(s,l[2]),r=ld(r,l[1])}this.Df=new I(-t,a,-s,r-360)}(e=this.Df)&&o.push(e),(e=o[0])&&(o[1]&&(e=e.zd(o[1],!0)),this.J=e)}return this.J},m.Vb=function(t,e,r,i,n){return n?(n=new af(i,-t,e+360,-r),this.Kl.push(n),this.kq=!0,this.Df&&this.Df.de(t,e,r,i,!0,this.Df)):(n=$e(this.Be,e,-t,i,-r),this.Mg&&this.Mg.de(t,e,r,i,!0,this.Mg)),++this.jc,this.J=null,n},m.Zd=function(t){var e=t.lng;return t=t.lat,this.Vb(t,e,t,e,!1)},m.Mu=function(t){var e=t.Oc(),r=t.Mc();return(t=t.qc())?this.Vb(e.lat,r.lng,r.lat,e.lng,t):this.Vb(e.lat,e.lng,r.lat,r.lng,t)},bf.prototype.insertBoundingBox=bf.prototype.Mu,bf.prototype.Ou=function(t,e,r,i){if(e<i)var n=e;else n=i,i=e;return t<r?e=r:(e=t,t=r),this.Vb(e,n,t,i,180<i-n)},bf.prototype.remove=function(t){var e;if(t.node){var r=this.Be.remove(t);this.Mg=null}else(r=0<=(t=(e=this.Kl).indexOf(t)))&&(e.splice(t,1),this.kq=0<e.length,this.Df=null);return r&&(--this.jc,this.J=null),r},bf.prototype.remove=bf.prototype.remove,bf.prototype.Fm=function(t,e,r){var i=this.Be,n=t.Oc(),o=t.Mc(),a=-n.lat;n=n.lng;var s=-o.lat;return o=o.lng,!e&&a===s||!r&&n===o?t=[]:t.qc()?(ef(t=i.ob(-180,a,o,s,r,e),i.ob(n,a,180,s,!1,e)),ef(t,cf(this,a,o,s,n+360,e,r))):ef(t=i.ob(n,a,o,s,r,e),cf(this,a,n,s,o,e,r)),t},bf.prototype.intersectBoundingBox=bf.prototype.Fm,u(J,we),t("H.geo.LineString",J),J.prototype.tr=function(t,e,r){hf(this,t,e,r,this.tr)},J.prototype.pushLatLngAlt=J.prototype.tr,J.prototype.Yk=function(t,e,r){r&&ff(r,this.Yk,2),void 0===e&&(e=this.S.length),e&&(this.jd-=gf(this,t-3,t+e+3));var i=r?this.S.splice.apply(this.S,[t,e].concat(r)):this.S.splice(t,e);return r&&(this.jd+=gf(this,t-3,t+r.length+3)),e&&!r&&(this.jd+=gf(this,t-3,t-3)),delete this.J,delete this.ur,i},J.prototype.spliceLatLngAlts=J.prototype.Yk,J.prototype.Nu=function(t,e,r,i){this.Yk(t,0,[e,r,i])},J.prototype.insertLatLngAlt=J.prototype.Nu,J.prototype.zw=function(t){this.Yk(t,3)},J.prototype.removeLatLngAlt=J.prototype.zw,J.prototype.tg=function(t){hf(this,t.lat,t.lng,t.alt,this.tg)},J.prototype.pushPoint=J.prototype.tg,J.prototype.Zd=function(t,e){this.Nu(3*t,e.lat,e.lng,e.alt)},J.prototype.insertPoint=J.prototype.Zd,J.prototype.Ek=function(t){this.zw(3*t)},J.prototype.removePoint=J.prototype.Ek,J.prototype.wj=function(t,e){var r=this.S,i=3*t;t=r[i];var n=r[i+1];return r=r[i+2],e&&(e.lat=t,e.lng=n,e.alt=r),e||new xe(t,n,r)},J.prototype.extractPoint=J.prototype.wj,J.prototype.Zy=function(t,e,r){var i=this.S;e=e||0,r=be(r,i.length/3);for(var n=3*e;e<r;)t(i[n++],i[n++],i[n++],e++)},J.prototype.eachLatLngAlt=J.prototype.Zy,J.isDBC=ve,J.prototype.Cp=function(t){var e=this.jd;return t&&(e+=ve((t=this.S)[t.length-2],t[1])),e},J.prototype.getDBCs=J.prototype.Cp,J.prototype.Mj=function(){return this.S.length/3},J.prototype.getPointCount=J.prototype.Mj,J.prototype.aA=function(){return this.S},J.prototype.getLatLngAltArray=J.prototype.aA,J.prototype.J=x,J.prototype.C=function(){var t;if(!(t=this.J)){var e,r,i=(t=this.S).length,n=3,o=x;if(3<=i){var a=e=t[0],s=r=t[1];for(o=new I(a,s,e,r);n<i;n+=3){if(a=t[n-3],s=t[n-2],e=t[n],s>(r=t[n+1])&&180<r-s||s<r&&-180>s-r||r<s&&180>pd(r-s)){var l=s;s=r,r=l}a<e&&(l=a,a=e,e=l),De(o.fa,o.W,o.ga,o.ca,a,s,e,r,o)}}t=this.J=o}return t},J.prototype.getBoundingBox=J.prototype.C,J.prototype.VA=function(){return this.J!==x},J.prototype.hasBoundingBox=J.prototype.VA,J.fromLatLngArray=jf,J.prototype.da=function(t){var e,r=this===t;if(!r&&(r=B(t,J))){var i=this.S;for(t=t.S,r=(e=i.length)===t.length;r&&e--;)r=i[e]==t[e]}return r},J.prototype.equals=J.prototype.da,m=J.prototype,m.ac="LineString",m.yf=function(t,e){var r,i=this.S,n=i.length;if(n){for(t.push("("),r=0;r<n;r+=3)r&&t.push(","),t.push(i[r+1]," ",i[r]);e&&(i[0]!==i[n-3]||i[1]!==i[n-2])&&t.push(",",i[1]," ",i[0]),t.push(")")}else t.push("EMPTY");return t},m.Kc="LineString",m.xf=function(){var t,e=[],r=this.S,i=r.length;for(t=0;t<i;t+=3)e.push([r[t+1],r[t],r[t+2]]);return e},m.Rd=function(){var t,e=this.S;if(this.C().qc()){var r=1;for(t=(e=e.slice()).length;r<t;r+=3)0>e[r]&&(e[r]+=360)}return e},m.zD=function(t){t=void 0===t?5:t;for(var e=this.S,r=e.length,i=[],n=0;n<r;n+=3)i.push([e[n],e[n+1],e[n+2]]);return Pe({polyline:i,precision:t,thirdDim:2,thirdDimPrecision:t})},J.prototype.toFlexiblePolyline=J.prototype.zD,J.fromFlexiblePolyline=mf,t("H.math.Point",K),K.prototype.set=K,K.prototype.set=K.prototype.set,K.prototype.clone=function(t){return t?(t.x=this.x,t.y=this.y):t=new K(this.x,this.y),t},K.prototype.clone=K.prototype.clone,K.prototype.add=function(t){return this.x+=t.x,this.y+=t.y,this},K.prototype.add=K.prototype.add,K.prototype.sub=function(t){return this.x-=t.x,this.y-=t.y,this},K.prototype.sub=K.prototype.sub,K.prototype.scale=function(t,e){return this.x*=t,this.y*=void 0===e?t:e,this},K.prototype.scale=K.prototype.scale,K.prototype.round=function(){return this.x=md(this.x),this.y=md(this.y),this},K.prototype.round=K.prototype.round,K.prototype.floor=function(){return this.x=nd(this.x),this.y=nd(this.y),this},K.prototype.floor=K.prototype.floor,K.prototype.ceil=function(){return this.x=od(this.x),this.y=od(this.y),this},K.prototype.ceil=K.prototype.ceil,K.prototype.da=function(t){return!(!t||this.x!==t.x||this.y!==t.y)},K.prototype.equals=K.prototype.da,K.prototype.ou=function(t,e){var r=e.x-t.x,i=e.y-t.y,n=t;return(r||i)&&(n=0>=(n=((this.x-t.x)*r+(this.y-t.y)*i)/(r*r+i*i))?t:1<=n?e:new K(t.x+n*r,t.y+n*i)),n},K.prototype.getNearest=K.prototype.ou,K.prototype.kb=function(t){return rd(sd(this.x-t.x,2)+sd(this.y-t.y,2))},K.prototype.distance=K.prototype.kb,K.fromIPoint=nf,t("H.math.clipping.clipStrips",of),t("H.math.clipping.clipPolygon",qf),u(L,we),t("H.geo.Polygon",L),L.fromRect=Af;var Bf={NORTH:90,SOUTH:-90};function Cf(t,e){var r,i,n;return(n=t.C())&&((r=t.Cp(!0))&&(i=t.Mj())&&(n=n.zd(Fe([t.wj(0),t.wj(i-1)],!0),!0)),360===n.oc()&&1==r%2&&(n=n.df(e,0))),n}function Df(t,e,r,i){var n=t.cb,o=Ef.bind(null,e,r);return Qd(e,r,t.Fb.S,0,!0,3)!==Pd.NONE&&(void 0!==i&&!i||!n.some(o))}function Ef(t,e,r){return Qd(t,e,r.S,0,!0,3)===Pd.SURFACE}function Ff(t,e){e=e.S,t=t.Fb.S;var r,i,n=e.length-3,o=t.length-3,a={};for(r=0;r<n;r+=3){var s=e[r],l=e[r+1],u=e[r+3],c=e[r+4];for(i=0;i<o;i+=3){var h=t[i],p=t[i+1],f=t[i+3],d=t[i+4];if(vf(new sf(l,s),new sf(c,u),new sf(p,h),new sf(d,f),a,!0))return!0}}return!1}function Gf(t,e){var r=e.Fb,i=e.cb,n=i.length,o=r.S,a=o.length,s=t.Fb.S,l=s.length;if(Ff(t,r))return!0;for(r=0;r<a;r+=3)if(Df(t,o[r],o[r+1]))return!0;for(r=0;r<l;r+=3)if(Df(e,s[r],s[r+1]))return!0;for(r=0;r<n;r++)if(Ff(t,i[r]))return!0;return!1}function Hf(t,e,r){this.paths=this.Tc=t,e!==A&&(this.interiorsIndex=this.Uj=e),r!==A&&(this.outlinesIndex=this.sn=r)}L.Direction=Bf,L.prototype.kf=Bf.NORTH,L.prototype.Ww=function(t){return this.kf!==t&&(this.J=x,this.Tj.length=0,this.kf=t),this},L.prototype.setPoleCovering=L.prototype.Ww,L.prototype.rA=function(){return this.kf},L.prototype.getPoleCovering=L.prototype.rA,L.prototype.Nz=function(){return this.Fb},L.prototype.getExterior=L.prototype.Nz,L.prototype.Tw=function(t){if(!B(t,J))throw new C(this.Tw,0,t);this.Fb=t,this.J=x},L.prototype.setExterior=L.prototype.Tw,L.prototype.Yz=function(){return this.cb},L.prototype.getInteriors=L.prototype.Yz,L.prototype.fo=function(t,e,r){var i,n=arguments.length;for(i=2;i<n;i++)B(arguments[i],J,this.fo,i);var o=this.cb.splice.apply(this.cb,arguments);for(i=2;i<n;i++)arguments[i]=A;return this.Tj.splice.apply(this.Tj,arguments),o},L.prototype.spliceInteriors=L.prototype.fo,L.prototype.DC=function(t){return this.fo(t,1)[0]},L.prototype.removeInteriorAt=L.prototype.DC,L.prototype.CC=function(t){return 0>(t=this.cb.indexOf(t))?A:this.fo(t,1)[0]},L.prototype.removeInterior=L.prototype.CC,L.prototype.vw=function(t){if(!B(t,J))throw new C(this.vw,0,t);this.cb.push(t)},L.prototype.pushInterior=L.prototype.vw,L.prototype.C=function(){var t=this.J;return t||(this.J=t=Cf(this.Fb,this.kf)),t},L.prototype.getBoundingBox=L.prototype.C,m=L.prototype,m.du=function(t){var e=this.cb.length;if(0>t||t>=e)throw new Td(this.du,t,[0,e-1]);return(e=this.Tj[t])||(this.Tj[t]=e=Cf(this.cb[t],this.kf)),e},m.ac="Polygon",m.yf=function(t){var e,r=this.cb,i=r.length;if(this.Fb.Mj()){for(t.push("("),this.Fb.yf(t,!0),e=0;e<i;e++)r[e].Mj()&&(t.push(","),r[e].yf(t,!0));t.push(")")}else t.push("EMPTY");return t},m.Kc="Polygon",m.xf=function(){var t,e=[],r=this.cb,i=this.Fb.xf();for(i[0].toString()!==i[i.length-1].toString()&&i.push(i[0]),e.push(i),t=0;t<r.length;t++)(i=r[t].xf())[0].toString()!==i[i.length-1].toString()&&i.push(i[0]),e.push(i);return e},m.P=function(){var t=L.g.P.call(this);return this.C().qc()&&(t.type="Multi"+t.type),t},m.Rd=function(){var t=[],e=this.cb,r=e.length;for(t.push(this.Fb.Rd());r--;)t[r+1]=e[r].Rd();return this.C().qc()?[t]:t},m.da=function(t){var e=!1;if(B(t,L)){var r=t.cb,i=this.cb.length;e=r.length;var n=0;for(e=this.Fb.da(t.Fb)&&i===e;e&&n<i;)e=e&&this.cb[n].da(r[n]),n++}return e},L.prototype.equals=L.prototype.da,Hf.prototype.Uj=Id,Hf.prototype.interiorsIndex=Hf.prototype.Uj,Hf.prototype.sn=Id,Hf.prototype.outlinesIndex=Hf.prototype.sn;var If=Xa(new Hf([])),Jf=Wa([]);function Kf(){}t("H.map.provider.Invalidations",Kf),Kf.MARK_INITIAL=Jd,Kf.prototype.update=function(t,e){e!==Lf.NONE&&(this.Md=t,e&Lf.SPATIAL&&(this.ex=t),e&Lf.VISUAL&&(this.Jx=t),e&Lf.ADD&&(this.$s=t),e&Lf.REMOVE&&(this.Aw=t),e&Lf.Z_ORDER&&(this.Nx=t),e&Lf.VOLATILITY&&(this.Kx=t))},Kf.prototype.update=Kf.prototype.update,Kf.prototype.hA=function(){return this.Md},Kf.prototype.getMark=Kf.prototype.hA,Kf.prototype.Md=Jd,Kf.prototype.dB=function(t){return this.Md>t},Kf.prototype.isAny=Kf.prototype.dB,Kf.prototype.Jx=Jd,Kf.prototype.Kh=function(t){return this.Jx>t},Kf.prototype.isVisual=Kf.prototype.Kh,Kf.prototype.ex=Jd,Kf.prototype.sq=function(t){return this.ex>t},Kf.prototype.isSpatial=Kf.prototype.sq,Kf.prototype.$s=Jd,Kf.prototype.Ru=function(t){return this.$s>t},Kf.prototype.isAdd=Kf.prototype.Ru,Kf.prototype.Aw=Jd,Kf.prototype.Km=function(t){return this.Aw>t},Kf.prototype.isRemove=Kf.prototype.Km,Kf.prototype.Nx=Jd,Kf.prototype.uq=function(t){return this.Nx>t},Kf.prototype.isZOrder=Kf.prototype.uq,Kf.prototype.Kx=Jd,Kf.prototype.iB=function(t){return this.Kx>t},Kf.prototype.isVolatility=Kf.prototype.iB;var Lf={NONE:0,VISUAL:1,SPATIAL:2,ADD:4,REMOVE:8,Z_ORDER:16,VOLATILITY:32};function Mf(t){var e;if(t){var r=B(t,Mf);for(e in t)if(e in this){var i=t[e];i!==this[e]&&("fillColor"===e||0<(i=+i))&&(this[e]=i)}(t=r?t.Pc:!!($d(this.fillColor)&&this.width&&this.width))||(this.Pc=t)}Wa(this)}function M(t){var e;if(t){var r=Nf;for(e=B(t,M);r--;){var i=Of[r];if(t.hasOwnProperty(i)){var n=t[i];if(e)this[i]=n;else{if((n=Pf[r](n))===Qf)throw new C(M,0,i+": "+t[i]);n!==this[i]&&n!==A&&(this[i]=n)}}}(r=e?t.Xj:this.lineWidth&&$d(this.strokeColor))||(this.Xj=r),(r=e?t.Pc:$d(this.fillColor))||(this.Pc=r),(r=e?t.Vj:"none"!==this.strokeColor&&this.lineWidth)||(this.Vj=r)}Wa(this)}Kf.Flag=Lf,t("H.map.ArrowStyle",Mf),Mf.prototype.Pc=!0,Mf.prototype.fillColor="rgba(255,255,255,.75)",Mf.prototype.width=1.2,Mf.prototype.length=1.6,Mf.prototype.frequency=5,Mf.prototype.eu=function(){return new Mf(this)},Mf.prototype.da=function(t){var e=this===t;return!e&&t&&(e=t.width===this.width&&t.fillColor===this.fillColor&&t.length===this.length&&t.frequency===this.frequency),e},Mf.prototype.equals=Mf.prototype.da,t("H.map.SpatialStyle",M),M.prototype.Pc=!0,M.prototype.Xj=!0,M.prototype.Vj=!0;var Of="strokeColor fillColor lineWidth lineCap lineJoin miterLimit lineDash lineDashOffset lineDashImage lineHeadCap lineTailCap".split(" ");M.prototype.strokeColor="rgba(0,85,170,.6)",M.prototype.strokeColor=M.prototype.strokeColor,M.prototype.fillColor="rgba(0,85,170,.4)",M.prototype.fillColor=M.prototype.fillColor,M.prototype.lineWidth=2,M.prototype.lineWidth=M.prototype.lineWidth,M.prototype.lineCap="round",M.prototype.lineCap=M.prototype.lineCap,M.prototype.lineJoin="miter",M.prototype.lineJoin=M.prototype.lineJoin,M.prototype.miterLimit=1,M.prototype.miterLimit=M.prototype.miterLimit,M.prototype.sB=je,M.prototype.lineDash=M.prototype.sB,M.prototype.lineDashOffset=0,M.prototype.lineDashOffset=M.prototype.lineDashOffset,M.prototype.tB=A,M.prototype.lineDashImage=M.prototype.tB,M.prototype.uB=A,M.prototype.lineHeadCap=M.prototype.uB,M.prototype.vB=A,M.prototype.lineTailCap=M.prototype.vB;var Nf=Of.length;M.prototype.da=function(t){var e=this===t;if(!e&&t){for(e=0;e<Nf;e++){var r=Of[e];if(this[r]!==t[r])break}e=e===Nf}return e},M.prototype.equals=M.prototype.da,M.prototype.fu=function(t){if(t){var e={};Sa(e,this,t)}else e=this;return new M(e)},M.prototype.getCopy=M.prototype.fu;var Qf=Wa({}),Pf=[function(t){return t?Va(t):Qf},function(t){return t?Va(t):Qf},function(t){return 0<=t&&100>=t?+t:Qf},function(t){return"butt"===(t=Va(t))||"square"===t||"round"===t||"arrow-head"===t||"arrow-tail"===t?t:Qf},function(t){return"round"===t||"bevel"===t||"miter"===t?t:Qf},function(t){return 0<t&&100>=t?+t:Qf},function(t){return t&&t.every&&t.every(kb)?t:Qf},function(t){return D(+t)?Qf:+t},function(t){return t===A||t instanceof HTMLImageElement||t instanceof HTMLCanvasElement||Object.values(Rf).includes(t)?t:Qf},function(t){return ab(t)?Pf[3](t):A},function(t){return ab(t)?Pf[3](t):A}],Sf=new Image;Sf.src="data:image/svg+xml;base64,"+btoa('<svg width="128" height="128" viewBox="0 0 128 128" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:svg="http://www.w3.org/2000/svg"><g id="arrow"><path style="fill:#ff0000" d="M 0,0 32,64 2,128 128,64 Z"/></g></svg> ');var Tf=new Image;Tf.src="data:image/svg+xml;base64,"+btoa('<svg width="128" height="128" viewBox="0 0 128 128" xmlns="http://www.w3.org/2000/svg"><circle style="fill:#ffffff" cx="64" cy="64" r="64" /></svg>');var Rf={ARROW:Sf,CIRCLE:Tf};M.DashImage=Rf,M.MAX_LINE_WIDTH=100;var Uf=new M;M.DEFAULT_STYLE=Uf;var Vf="fillColor strokeColor lineWidth lineCap lineJoin miterLimit lineDashOffset lineDash lineTailCap lineHeadCap".split(" ");function Wf(t){Wf.g.constructor.call(this),void 0!==t&&(this.data=t)}function N(t){if(bb(this,N),N.g.constructor.call(this,t?t.data:A),this.Rj=Xf.next(),t){var e="min";jb(t[e])&&(this.zb=t[e]),jb(t[e="max"])&&(this.Qc=t[e]),(e="visibility")in t&&(this.Ld=!!t[e]),(e="volatility")in t&&(this.lo=!!t[e]),(e="zIndex")in t&&(this.Hi=+t[e]||0),(e="provider")in t&&!B(t[e],P)&&(this.D=t[e],this.ra(Lf.ADD))}}M.prototype.P=function(){for(var t,e={},r=Vf.length;r--;)e[t=Vf[r]]=this[t];return e},M.prototype.forWorkerMessage=M.prototype.P,u(Wf,E),t("H.map.Feature",Wf),Wf.prototype.getData=function(){return this.data},Wf.prototype.getData=Wf.prototype.getData,Wf.prototype.disposeInternal=function(){Wf.g.disposeInternal.call(this),delete this.data},u(N,Wf),t("H.map.Object",N);var Xf=new de(1),Yf={ANY:31,OVERLAY:1,SPATIAL:2,MARKER:4,DOM_MARKER:8,GROUP:16};function Zf(t,e,r){var i,n;if(!r||t[0]|e[0]){var o=t.length,a=e.length,s=kd(o,a),l=1;for(n=+r+1;l<s;l+=n)if(i=t[l]-e[l])return i}return r?0:o-a}function $f(t,e){return t.qt(e)}function ag(t,e,r){if(null===e||e===A)return null;if(0<=Object.keys(e).length&&"[object Object]"!==Object.prototype.toString.call(e))throw Error(bg(t,r));try{return JSON.stringify(e),e}catch(e){throw Error(bg(t,r))}}function bg(t,e){return"Object Remote-Id: "+t.gi+" - "+(e?"The value returned by the callback is not a valid JSON object and cannot be set as Feature properties.":"The given object data is not a valid JSON object and cannot be set as Feature properties.")}function cg(t,e){var r;cg.g.constructor.call(this,e),e&&this.Cb(e.style),t&&(this.Xe=!0),e&&(r=e.arrows)&&this.Qw(r)}function dg(t,e){var r,i=!1,n=!1;if(e.length){for(i=0;i<e.length;i++)if(e[i]!==If){n=!0;break}e=t.style,i=n?e.Xj||e.Pc&&t.Xe||(r=t.Tg||!1)&&e.Vj&&r.Pc:e.Pc}return i&&t.Wd(!0)}function eg(t,e){eg.g.constructor.call(this,t,e)}function fg(t,e,r,i){var n,o=[],a=e.length;for(n=0;n<a;n++){var s=e[n];if(s.length){var l=o,u=l.push,c=void 0,h=t,p=r,f=i,d=[],y=s.length,g=0;for(h.Ft=0,c=c||0;g<y;)d.push(gg(h,s[g++],s[g++],c,f));p&&d.push(gg(h,s[0],s[1],c,f)),u.call(l,d)}}return o}function gg(t,e,r,i,n){var o=t.Ft;return o&&180<pd(o-r)&&(r+=0>o?-360:360),t.Ft=r,n.wq(e,r+i)}function hg(t,e,r){for(var i,n,o,a=e,s=t.length+e;a--;){for(n=(e=t[a]).length,i=Array(n);n--;)o=e[n],i[n]=new K(o.x+r,o.y);t[--s]=i}}function ig(t,e,r,i){this.left=+t,this.top=+e,this.right=+r,this.bottom=+i}function jg(t,e){return new ig(t.x,t.y,e.x,e.y)}function kg(t){bb(this,kg),kg.g.constructor.call(this),this.ha=lg(this,t,this.constructor,0)}function lg(t,e,r,i){var n,o=[];if(!fb(e))throw new C(r,i);for(n=0;n<e.length;n++){if(!t.tq(e[n]))throw new C(r,i);o.push(t.ow(e[n]))}return o}function mg(t){mg.g.constructor.call(this,t)}function ng(t,e){var r=e&&(+e.extrusion||+e.extrude)||0,i=e&&+e.elevation||0,n=0;if(ng.g.constructor.call(this,!0,e),0<i&&(n+=i,this.Jf=i),0<r&&(n+=r,this.nh=r),2047<n)throw new Td(ng,n,[0,2047]);B(t,J)?this.X(new L(t)):this.X(t)}N.Type=Yf,N.prototype.xb=function(){return this.Rj},N.prototype.getId=N.prototype.xb,N.prototype.Zr=function(t){if(!jb(t)&&!gb(t))throw new C(this.Zr,0,"id must be a number or a string");return this.gi=t,this},N.prototype.setRemoteId=N.prototype.Zr,N.prototype.yA=function(){return this.gi},N.prototype.getRemoteId=N.prototype.yA,N.prototype.zb=-1/0,N.prototype.Qc=1/0,N.prototype.lu=function(t){var e=this.Qc;if(t)for(t=this;t=t.Na;)e=kd(e,t.Qc);return e},N.prototype.getMax=N.prototype.lu,N.prototype.nu=function(t){var e=this.zb;if(t)for(t=this;t=t.Na;)e=ld(e,t.zb);return e},N.prototype.getMin=N.prototype.nu,N.prototype.Ld=!0,N.prototype.Zb=function(t){return(t=!!t)!==this.Ld&&(this.Ld=t,this.invalidate(Lf.VISUAL)),this},N.prototype.setVisibility=N.prototype.Zb,N.prototype.Wd=function(t){for(var e,r=this;(e=r.Ld)&&t&&(r=r.Na););return e},N.prototype.getVisibility=N.prototype.Wd,N.prototype.lo=!1,N.prototype.sm=function(t){for(var e,r=this;!(e=r.lo)&&t&&(r=r.Na););return e},N.prototype.getVolatility=N.prototype.sm,N.prototype.Zw=function(t){var e=this.lo;return e!==!!t&&(this.lo=!e,this.invalidate(Lf.VOLATILITY)),this},N.prototype.setVolatility=N.prototype.Zw,N.prototype.Hi=A,N.prototype.wu=function(){return this.Hi},N.prototype.getZIndex=N.prototype.wu,N.prototype.ui=function(t){return t!==this.Hi&&(this.Hk(),this.Hi=t,this.invalidate(Lf.Z_ORDER)),this},N.prototype.setZIndex=N.prototype.ui,N.prototype.qo=A,N.prototype.We=function(){var t,e,r=this.qo;if(!r){var i=+((t=this.Hi)!==A);(r=this.Na)?(r=r.We().slice())[0]|=i:r=[i],r.push(t||0,0>(e=this.ds)?this.Rj:e),this.qo=r}return r},N.prototype.getZInfo=N.prototype.We,N.prototype.Hk=function(){this.qo=A},N.compareZInfo=Zf,N.compareZOrder=$f,N.prototype.qt=function(t){return this.ro-t.ro||Zf(this.We(),t.We(),!1)},N.prototype.compareZOrder=N.prototype.qt,m=N.prototype,m.previousSibling=x,m.nextSibling=x,m.ds=-1,m.Na=x,m.mA=function(){return this.Na},N.prototype.getParentGroup=N.prototype.mA,N.prototype.sd=function(){for(var t,e=this;t=e.Na;)e=t;return e},N.prototype.getRootGroup=N.prototype.sd,N.prototype.contains=function(t){return this===t},N.prototype.contains=N.prototype.contains,N.prototype.ea=function(t){if(this.Na)throw new wb(this.ea,"Not allowed for a child of a group");N.g.ea.call(this,t)},N.prototype.setParentEventTarget=N.prototype.ea,N.prototype.draggable=N.prototype.draggable=!1,N.prototype.D=x,N.prototype.Pp=function(){return this.D},N.prototype.getProvider=N.prototype.Pp,N.prototype.ti=function(t,e){var r,i=this.D;if(r=i!==t){if(e&&(i&&!B(i,P)||t&&!B(t,P)))throw new wb(e,"Only LocalObjectProvider allows an object transfers");e=this.type!==Yf.GROUP,i&&(this.invalidate(Lf.REMOVE),e&&i.Oa(this)),(this.D=t)&&(e&&t.Y(this),this.Xf=x,this.invalidate(Lf.ADD))}return r},N.prototype.Xf=x,N.prototype.Nc=function(){return this.Xf||(this.Xf=new Kf)},N.prototype.getInvalidations=N.prototype.Nc,N.prototype.ra=function(t){var e,r=this.D;return(e=!!r)&&r.invalidateObject(this,t),e},N.prototype.invalidate=N.prototype.ra,N.prototype.disposeInternal=function(){this.Na&&this.Na.Oa(this),N.g.disposeInternal.call(this)},N.prototype.setData=function(t){return this.data=t,this},N.prototype.setData=N.prototype.setData,N.prototype.ze=function(t){if(t&&!Za(t))throw new C(N.prototype.ze,0,"opt_callback must be a function");return t=ag(this,t?t(this.data):this.data,!!t),t=Za(this.V)?{type:"Feature",properties:t,geometry:this.V().ze()}:{type:"FeatureCollection",features:je},this.gi&&(t.id=this.gi),t},N.prototype.toGeoJSON=N.prototype.ze,N.prototype.P=function(){return{id:this.Rj,properties:{min:this.nu(),max:this.lu(),zIdx:this.Hi,sIdx:this.ds,parent:this.Na?this.Na.xb():0,visible:this.Wd(),volatile:this.sm()},type:"Feature"}},N.prototype.forWorkerMessage=N.prototype.P,u(cg,N),t("H.map.Spatial",cg),cg.prototype.type=Yf.SPATIAL,cg.prototype.ro=0,cg.prototype.style=Uf,cg.prototype.K=function(){return this.style},cg.prototype.getStyle=cg.prototype.K,cg.prototype.Cb=function(t){var e=!0;return t?this.style=B(t,M)?t:new M(t):this.style?delete this.style:e=!1,e&&this.invalidate(Lf.VISUAL),this},cg.prototype.setStyle=cg.prototype.Cb,cg.prototype.uz=function(){return this.Tg},cg.prototype.getArrows=cg.prototype.uz,cg.prototype.Qw=function(t){var e=this.Tg,r=!1;return!t&&e?(delete this.Tg,r=!0):!t||e&&e.da(t)||(this.Tg=new Mf(t),r=!0),r&&"none"!==this.style.strokeColor&&this.ra(1),this},cg.prototype.setArrows=cg.prototype.Qw,cg.prototype.Xe=!1,cg.prototype.eB=function(){return this.Xe},cg.prototype.isClosed=cg.prototype.eB,cg.prototype.getGeometriesForTile=cg.prototype.xh,cg.prototype.Hp=function(){return A},cg.prototype.getLabels=cg.prototype.Hp,u(eg,cg),t("H.map.GeoShape",eg),eg.prototype.getBoundingBox=eg.prototype.C,t("H.math.Rect",ig),ig.prototype.set=ig,ig.prototype.set=ig.prototype.set,ig.prototype.Oc=function(){return this.ll||(this.ll=new K(this.left,this.top))},ig.prototype.getTopLeft=ig.prototype.Oc,ig.prototype.Mc=function(){return this.Ri||(this.Ri=new K(this.right,this.bottom))},ig.prototype.getBottomRight=ig.prototype.Mc,ig.prototype.Ql=function(t,e){return this.left<=t&&this.right>=t&&this.top<=e&&this.bottom>=e},ig.prototype.containsXY=ig.prototype.Ql,ig.fromPoints=jg,ig.prototype.clone=function(){return new ig(this.left,this.top,this.right,this.bottom)},ig.prototype.clone=ig.prototype.clone,u(kg,we),t("H.geo.MultiGeometry",kg),kg.prototype.splice=function(t,e,r){return t=[t],e!==A&&t.push(e),r&&(e=lg(this,r,this.splice,2),t=t.concat(e)),this.J=x,this.ha.splice.apply(this.ha,t)},kg.prototype.splice=kg.prototype.splice,kg.prototype.Ed=function(t){var e=this.ha.length;if(!(0<=t&&t<e))throw new Td(this.Ed,t,[0,e-1]);return this.J=x,this.ha.splice(t,1)[0]},kg.prototype.removeAt=kg.prototype.Ed,kg.prototype.remove=function(t){if(0<=(t=this.ha.indexOf(t))){var e=this.ha.splice(t,1)[0];this.J=x}return e||x},kg.prototype.remove=kg.prototype.remove,kg.prototype.Tz=function(){return this.ha},kg.prototype.getGeometries=kg.prototype.Tz,kg.prototype.push=function(t){var e=lg(this,[t],this.push,0)[0];this.J&&(this.J=this.J.zd(t.C())),this.ha.push(e)},kg.prototype.push=kg.prototype.push,kg.prototype.C=function(){var t,e,r;if(!(t=this.J)&&(t=x,this.ha.length))for(t=this.ha[0].C(),r=1;r<this.ha.length;r++)(e=this.ha[r].C())&&(t=t?t.zd(e):e);return this.J=t},kg.prototype.getBoundingBox=kg.prototype.C,kg.prototype.J=x,kg.prototype.ow=function(t){return t},kg.prototype.da=function(t){var e,r=this===t;if(!r&&(r=B(t,this.constructor))){var i=this.ha;for(t=t.ha,r=(e=i.length)===t.length;r&&e--;)r=i[e].da(t[e])}return r},kg.prototype.equals=kg.prototype.da,kg.prototype.yf=function(t){var e,r,i=this.ha,n=i.length,o=!1;if(n){for(t.push("("),e=0;e<n;e++)(r=0<e&&o)&&t.push(","),i[e].yf(t),"EMPTY"===t[t.length-1]?t.splice(-1-+r,+r+1):o=!0;o?t.push(")"):t.splice(-1,1,"EMPTY")}else t.push("EMPTY");return t},kg.prototype.Rd=function(){for(var t=[],e=this.ha,r=e.length;r--;)t[r]=e[r].Rd();return t},kg.prototype.P=function(){var t=kg.g.P.call(this);return t.type=this.ac,t},kg.prototype.xf=function(){for(var t=[],e=this.ha,r=e.length;r--;)t[r]=e[r].xf();return t},u(mg,kg),t("H.geo.MultiPolygon",mg),mg.prototype.tq=function(t){return B(t,L)},mg.prototype.ac="Multi"+L.prototype.ac,mg.prototype.Kc="Multi"+L.prototype.Kc,u(ng,eg),t("H.map.Polygon",ng);var og=new L(new J([0,0,0,0,0,0,0,0,0]));function pg(t,e,r,i){var n,o,a=0,s=!0;if(n=qg(t,e.Fb,r,i,e.C())){var l=new Hf(n),u=e.cb;if(o=u.length)for(l.Uj=l.Tc.length;a<o;a++)(n=qg(t,u[a],r,i,e.du(a)))&&(l.Tc=l.Tc.concat(n));for(o=l.Tc.length,a=0;a<o;a++)if(l.Tc[a]!==Jf){s=!1;break}s&&(l=a%2?If:A)}return l}function qg(t,e,r,i,n){var o,a=r.Pj(),s=n,l=s.oc(),u=[[]],c=e.S,h=[],p=c.length,f=!1;for(o=0;o<p;o+=3){var d=c[o],y=c[o+1];f||180!=pd(y)||(h.push(d),h.push(y),h.push(d),h.push(-y),f=!0),h.push(d),h.push(y)}if(c=h,360>l&&-180==s.W&&(s=new I(s.fa,180,s.ga,s.ca)),360>l&&180==s.ca&&(s=new I(s.fa,s.W,s.ga,-180)),s.qc()){for(d=(l=c).length,c=-1,h=0;h<d-2;h+=2)if(ve(l[h+1],l[h+3])){c=h+2;break}-1===c&&ve(l[d-1],l[1])&&(c=d),-1!==c&&(p=l[c-2],h=l[c-1],o=l[c%d],f=l[(c+1)%d],180!==pd(p)&&180!==pd(o)&&(y=pd(o-p),d=pd(f-h),d+=180<d?-360:0,f=pd(180-f),f+=180<f?-360:0,d&&f&&(y/=pd(d)/pd(f),p=o+(o>p?-y:y),h=0<h?180:-180,l.splice(c,0,p,h,p,-h)))),c=l}if(u[0]=rg([].concat(c),s.W),360>s.oc()&&s.Gf(new xe(s.fa,180))&&(c=rg([].concat(c),s.ca),u.push(c)),t=fg(t,u,!0,s=r.pm()),360===n.oc()&&1==e.Cp(!0)%2){for(e=t,t=r.Pj(),e[0][1].x>e[0][e[0].length-1].x&&(e[0]=e[0].reverse()),c=[],l=e[0].length-1,u=0;u<l;u++)h=e[0][u],c[u]=new K(h.x-2*s.w,h.y),c[u+l]=new K(h.x-s.w,h.y),c[u+2*l]=new K(h.x,h.y),c[u+3*l]=new K(h.x+s.w,h.y),c[u+4*l]=new K(h.x+2*s.w,h.y);e[0]=c,(u=s.wq(i,0)).y=2*t[i===Bf.NORTH?"top":"bottom"],i=u.clone(),u.x=e[0][e[0].length-1].x+1,i.x=e[0][0].x-1,e[0].push(u,i),t=e}if(of(t,i=a.left,e=a.top,u=a.right,a=a.bottom,!0).length){if(!r.nm().Vo(n)){for(r=t,n=[new K(i,e),new K(u,e),new K(u,a),new K(i,a)],a=[],t=r.length;t--;)if(i=qf(n,r[t]))for(e=sg(i),a.push(e);i.Nq;)e=sg(i=i.Nq),a.push(e);t=a}}else r=tg(i,e,t[0]),t[1]&&(r=r!==tg(i,e,t[1])),t=r?[Jf]:A;return t}function tg(t,e,r){var i,n,o,a=i=r[0].x,s=n=r[0].y,l=1;for(o=r.length;l<o;l++){var u=r[l].x,c=r[l].y;u>i?i=u:u<a&&(a=u),c>n?n=c:c<s&&(s=c)}return a<=t&&t<=i&&s<=e&&e<=n&&Rd({x:t,y:e},Sd(r.concat(r[0])))}function sg(t){var e=[],r=t;do{var i=md(100*(r.mC?r.mC:r.x))/100,n=md(100*(r.nC?r.nC:r.y))/100;if(!o||.01<rd(sd(o.x-i,2)+sd(o.y-n,2))){var o=new K(i,n);e.push(o)}r=r.next}while(r&&r!==t);return e}function rg(t,e){var r,i=Number.POSITIVE_INFINITY,n=-1,o=t.length;for(r=0;r<o;r+=2){var a=pd(t[r+1]-e);(a+=180<a?360-a:a)<i&&(i=a,n=r)}return 0<r?(e=t.splice(n,t.length-n)).concat(t):t}function ug(t,e){ug.g.constructor.call(this,og,e),this.si(t)}ng.prototype.nh=0,ng.prototype.Jf=0,ng.prototype.Hb=og,ng.MAX_EXTRUDE_HEIGHT=2047,ng.prototype.Pr=function(t){var e=+t;if(e!==t)throw new C(this.Pr,0,t);if(0>e||2047<this.Jf+e)throw new Td(this.Pr,this.Jf+e,[0,2047]);this.nh=e,this.ra(Lf.SPATIAL)},ng.prototype.setExtrusion=ng.prototype.Pr,ng.prototype.Oz=function(){return this.nh},ng.prototype.getExtrusion=ng.prototype.Oz,ng.prototype.Or=function(t){var e=+t;if(e!==t)throw new C(this.Or,0,t);if(0>e||2047<this.nh+e)throw new Td(this.Or,this.nh+e,[0,2047]);this.Jf=e,this.ra(Lf.SPATIAL)},ng.prototype.setElevation=ng.prototype.Or,ng.prototype.Jz=function(){return this.Jf},ng.prototype.getElevation=ng.prototype.Jz,ng.prototype.V=function(){return this.Hb},ng.prototype.getGeometry=ng.prototype.V,ng.prototype.X=function(t){if(B(t,L))var e=!1;else B(t,mg,this.X,0),e=!0;return this.Vf=e,e=this.Hb,this.Hb=t,e!==og&&this.ra(Lf.SPATIAL),this},ng.prototype.setGeometry=ng.prototype.X,ng.prototype.C=function(){return this.V().C()},ng.prototype.getBoundingBox=ng.prototype.C,ng.prototype.xh=function(t){var e,r,i,n=this.V();if(this.Vf){var o=0;for(i=(n=n.ha).length;o<i;o++)(r=pg(this,n[o],t,n[o].kf))&&(e||(e=[]),e.push(r))}else(r=this.kf)===A&&(r=this.Vf?Bf.NORTH:this.V().kf),(r=pg(this,n,t,r))&&(e=[r]);return e},ng.prototype.getGeometriesForTile=ng.prototype.xh,ng.prototype.Si=x,ng.prototype.P=function(){var t,e=ng.g.P.call(this),r=this.V(),i=this.Vf?r.ha:[r],n=e.properties,o=e.geometry=r.P();if(n.style=this.K().P(),n.height=this.nh+this.Jf,n.min_height=this.Jf,this.C().qc()&&(o.type="MultiPolygon",this.Vf)){var a=[];i.forEach((function(e,r){t=o.coordinates[r],e.C().qc()?a=a.concat(t):a.push(t)})),o.coordinates=a}return e},ng.prototype.forWorkerMessage=ng.prototype.P,u(ug,ng),t("H.map.Rect",ug),ug.prototype.si=function(t){if(!B(t,I))throw new C(this.si,0,t);t.da(this.Si)||(this.Si=this.J=t,this.Hb!==x&&ug.g.X.call(this,Af(t)))},ug.prototype.setBoundingBox=ug.prototype.si,ug.prototype.C=function(){return this.J},ug.prototype.getBoundingBox=ug.prototype.C,ug.prototype.X=function(){return this},ug.prototype.setGeometry=ug.prototype.X,ug.prototype.V=function(){return this.Hb===og&&ug.g.X.call(this,Af(this.Si)),this.Hb},ug.prototype.getGeometry=ug.prototype.V;var vg={PENDING:0,ACTIVE:1,DONE:2};function wg(t,e,r){wg.g.constructor.call(this,t),this.oldValue=r,this.newValue=e}t("H.map.render.RenderState",vg),u(wg,Fc),t("H.util.ChangeEvent",wg),t("H.util.constants.DEFAULT_MIN_ZOOM_LEVEL",0),t("H.util.constants.DEFAULT_MAX_ZOOM_LEVEL",22);var xg={PROVIDES_BY_VIEWPORT:1,PROVIDES_RASTERS:2,PROVIDES_SPATIALS:4,PROVIDES_OVERLAYS:8,PROVIDES_MARKERS:16,PROVIDES_DOM_MARKERS:32,PROVIDES_GEOJSON:64,PROVIDES_OMV:128,CROP_LINES_BY_TILE:256,CROP_POLYGONS_BY_TILE:512,HAS_VOLATILE_DATA:1024},yg;function zg(t,e){if(globalThis.URL)return new globalThis.URL(t,e).toString();if(!t||!Ag(t))return t;if(!e||Ag(e))throw new TypeError("Failed to construct 'URL': Invalid base URL");yg||mb(yg=document.createElement("a"));var r=yg;return r.href=e,"/"!==t[0]?t=r.href.replace(/\/[^\/]*$/,"/")+t:((e=r.origin)||(e=r.protocol+"//"+r.host),t=e+t),t}function Ag(t){var e=!1;return"string"==typeof t&&(e=!(-1<t.search(/^(http|https|data|blob):/)||"//"===t.substr(0,2))),e}function Bg(t,e){var r,i,n,o=arguments.length;for(r=1;r<o;r++)if((i=arguments[r])&&i!==t&&i!==a){var a=i;for(n in i){var s=i[n];t[n]!==s&&(Cg(s)?Cg(t[n])?t[n]=Bg(t[n],s):t[n]=Ya(s):void 0!==s&&(t[n]=Ya(s)))}}return t}t("H.map.provider.Capabilities",xg),xg.PROVIDES_WEBGL_RENDERABLE_OBJECTS=xg.PROVIDES_SPATIALS|xg.PROVIDES_OVERLAYS|xg.PROVIDES_MARKERS,t("H.util.webgl.mergeObjects",Bg);var Dg=Ua();function Eg(t,e,r){var i=r[t];return e&&i in e&&0>$a.indexOf(i)?(e=e[i],++t<r.length?Eg(t,e,r):e):Dg}var Fg=Eg.bind(null,0),Gg={polygons:1,lines:1,"pattern-lines":1,points:1,text:1,raster:1,custom_icons:1,overlays:1},Hg={data:1,draw:1,enabled:1,filter:1,properties:1},Ig=Object.keys(Hg);function Jg(t,e,r,i,n,o){var a=i[t],s=r[a];if(++t<i.length){var l=e[a]||{};for(r=Ig.length;r--;){var u=Ig[r];if("draw"!==u||!o){var c=s[u];c!==A&&(l[u]=Ya(c))}}Jg(t,l,s,i,n,o)}else n?l=Ya(s):(l=s,delete r[a]);e[a]=e[a]?Bg(e[a],l):l}var Kg=Jg.bind(null,0);function Lg(t,e){t in Gg&&(e[t]=1)}function Mg(t,e,r){var i,n,o;for(i in t)if(Hg[i]){if("draw"===i){var a=t[i];for(n in a){var s=a[n];(o=s.style)?(s.style=e+o,Lg(o,r)):(delete a[n],a[e+n]=s,Lg(n,r))}}}else Mg(t[i],e,r)}function Ng(t,e){var r,i,n,o,a={};if(e+="_",r=(t=Bg({},t)).styles)for(i in r){var s=r[i];if(delete r[i],r[e+i]=s,n=s.mix)for(gb(n)&&(n=[n]),o=n.length;o--;)Lg(n[o],a),n[o]=e+n[o];(o=s.base)&&(n||(n=s.mix=[]),n.unshift(e+o),delete s.base,Lg(o,a)),Lg(i,a)}else r=t.styles={};if(s=t.layers)for(i in s)n=s[i],delete s[i],(o=n.data)&&!o.layer&&(o.layer=i),s[e+i]=n,Mg(n,e,a);for(i in a)r[e+i]={base:i};return t}function Og(t,e){var r,i=t.sources,n=Object.keys(i)[0],o=Bg(i[n],{uid:e});for(r in i=t.layers,t.sources={},t.sources[e]=o,i)(t=i[r]).data?t.data.source===n&&(t.data.source=e):t.data={source:e}}function Pg(t,e){var r,i=t.textures;for(r in t=t.fonts,i){var n=i[r];n.url&&(n.url=zg(n.url,e))}for(r in t)if(fb(n=t[r]))for(i=0;i<n.length;i++){var o=n[i];o.url=o.url&&zg(o.url,e)}else(o=n).url=o.url&&zg(o.url,e)}function Qg(t,e){return"function(){return feature."+t+(e||"")+";}"}function Rg(t){return Qg("style."+t,void 0)}function Sg(t,e,r,i){return t={base:t,blend:e,blend_order:r},i&&(t.clean_depth=!!i),t}function Tg(t){var e={};return e["translucent-"+(t?"extruded-":"")+"polygons"]={color:Rg("fillColor"),order:1,interactive:!0,extrude:t},e}function Ug(t,e,r,i){return t={data:{source:t,layer:e}},r&&(t.draw=r),i&&(t.filter=i),t}function Cg(t){return ya(t)&&!fb(t)}function Vg(t,e,r){this.Ba=t,this.uid=e,this.opacity=r,this.$m=this.Ba&xg.PROVIDES_BY_VIEWPORT?"function(){return sources[$source].isInMinMaxRange(feature, $zoom) && feature.ref.effectiveVisibility;}":A,this.bg={}}function Wg(t){this.Ba=t}function Xg(t,e,r,i,n){this.Ba=t,this.uid=e,this.Cv=r,this.Kq=i,this.tileSize=n}function Yg(t,e,r,i){return t={type:e,uid:t.uid,tiled:r,max_zoom:t.Kq},i&&Sa(t,i),t}function Zg(t,e,r,i,n,o){this.Ba=t,this.uid=e,this.Cv=r,this.Kq=i,this.opacity=n,this.tileSize=o}function $g(t,e){if($g.g.constructor.call(this),e&&Ag(e))throw new C($g,1,"Base URL must be absolute");this.s=ah.INIT,this.Ia=null,this.md=e}Vg.prototype.Ke=function(){if(this.Ba&xg.PROVIDES_RASTERS&&(this.bg["tile_layer_"+this.uid]=Ug(this.uid,"_default",{"translucent-raster":{color:[1,1,1,this.opacity],order:0}})),this.Ba&xg.PROVIDES_SPATIALS){var t={"translucent-pattern-lines":{color:Rg("strokeColor"),width:Rg("lineWidth * $meters_per_pixel"),join:Rg("lineJoin"),cap:Rg("lineCap"),tail_cap:Rg("lineTailCap"),head_cap:Rg("lineHeadCap"),miter_limit:Rg("miterLimit"),order:"function() { return 2 + feature.effectiveZIdx / 2; }",interactive:!0,dash:Rg("lineDash"),extrude:!0,dash_phase:Rg("lineDashOffset")}},e=this.bg,r="polygon_layer_"+this.uid,i=Ug(this.uid,"polygons",void 0,this.$m);i.flat={filter:"function(){return !feature.height && !feature.min_height;}",draw:Tg(!1)},i.extruded={filter:"function(){return feature.height || feature.min_height;}",draw:Tg(!0)},e[r]=i,this.bg["outline_layer_"+this.uid]=Ug(this.uid,"outlines",t,this.$m),this.bg["polyline_layer_"+this.uid]=Ug(this.uid,"polylines",t,this.$m)}return this.Ba&xg.PROVIDES_OVERLAYS&&(this.bg["overlay_layer_"+this.uid]=Ug(this.uid,"overlays",{"translucent-overlays":{color:[1,1,1,this.opacity],order:8190,interactive:!0}})),this.Ba&xg.PROVIDES_MARKERS&&(this.bg["marker_layer_"+this.uid]=Ug(this.uid,"markers",{markers:{sprite:Qg("icon.id"),offset:Qg("icon.offset"),collide:!1,priority:8191,elevate_by_altitude:!0,interactive:!0,stick:{color:Qg("icon.stick_color"),height:Qg("icon.stick_height")}}},this.$m)),this.bg},Wg.prototype.Ke=function(){var t={};if(this.Ba&xg.PROVIDES_RASTERS&&(t={"translucent-raster":Sg("raster","inlay",1)}),this.Ba&xg.PROVIDES_WEBGL_RENDERABLE_OBJECTS){var e=!!(this.Ba&xg.CROP_LINES_BY_TILE),r={"translucent-polygons":Sg("polygons","inlay",2),"translucent-extruded-polygons":Sg("polygons","translucent",3),"translucent-pattern-lines":Sg("pattern-lines","translucent",4),"translucent-overlays":Sg("overlays","inlay",5),markers:Sg("custom_icons","overlay",6,!1)};r["translucent-polygons"].crop_by_tile=!!(this.Ba&xg.CROP_POLYGONS_BY_TILE),r["translucent-pattern-lines"].crop_by_tile=e,r.markers.suppress_fade=!0,r.markers.stick=!0,Sa(t,r)}return t},Xg.prototype.Ke=function(){var t={};return t[this.uid]=this.Ba&xg.PROVIDES_BY_VIEWPORT?Yg(this,"ObjectSource",!1,{progressiveUpdate:!0,has_volatile_data:!!(this.Ba&xg.HAS_VOLATILE_DATA)}):this.Ba&xg.PROVIDES_RASTERS?Yg(this,"RemoteRasterTileSource",!0,{url:""}):Yg(this,"ObjectTileSource",!0,{tile_size:this.tileSize}),t},Zg.prototype.Ke=function(){if(this.Ba&xg.PROVIDES_DOM_MARKERS&&!(this.Ba&xg.PROVIDES_MARKERS))return{};var t=new Xg(this.Ba,this.uid,this.Cv,this.Kq,this.tileSize),e=new Wg(this.Ba),r=new Vg(this.Ba,this.uid,this.opacity);return{sources:t=t.Ke(),styles:e=e.Ke(),layers:r=r.Ke()}},u($g,E),t("H.map.render.Style",$g),$g.prototype.load=$g.prototype.load,$g.prototype.getState=function(){return this.s},$g.prototype.getState=$g.prototype.getState,$g.prototype.F=function(t){this.s=t},$g.prototype.setState=$g.prototype.F,$g.prototype.Lc=function(){return this.md},$g.prototype.getBaseUrl=$g.prototype.Lc,$g.prototype.Sd=function(){return Ya(this.Ia)},$g.prototype.getConfig=$g.prototype.Sd,$g.prototype.Bz=function(){return this.Ia},$g.prototype.getConfigReference=$g.prototype.Bz,$g.prototype.Eg=function(t){this.Ia=t},$g.prototype.setConfig=$g.prototype.Eg,$g.prototype.Ic=function(t){this.Ia=null,this.F(ah.ERROR),this.bq(bh)?this.dispatchEvent(new fd(bh,t,this)):console.error(t)},$g.prototype.dispatchError=$g.prototype.Ic,$g.prototype.disposeInternal=function(){$g.g.disposeInternal.call(this),this.Ia=null};var bh="error",ch={Af:"change",Js:bh},ah={ERROR:-1,INIT:0,LOADING:1,READY:2};function dh(){var t=dh.qv;return t||(t=this,dh.qv=t,mb(dh.qv),E.call(t),this.Ag()),t}function eh(t,e){"status"in(e=e||{})&&(this.status=+e.status),"statusText"in e&&(this.statusText=e.statusText),this.ok=200<=this.status&&300>this.status,this.Tu=!1,t?"string"==typeof t?this.Ko=t:(e=globalThis.ArrayBuffer)&&e.prototype.isPrototypeOf(t)?this.Cf=t:e&&t.buffer?this.Cf=t.buffer:globalThis.Blob.prototype.isPrototypeOf(t)&&(this.Fl=t):this.Ko=""}function fh(t){if(t.Tu)return dc(new TypeError("Already read"));t.Tu=!0}function gh(t){var e=new FileReader;return e.readAsText(t),new Vb((function(t,r){e.onload=function(){t(e.result)},e.onerror=function(){r(e.error)}}))}function hh(t,e,r){var i,n,o,a,s,l=r&&r.headers||{},u={},c=this;if(!Za(e))throw new C(hh,1,"function required");t+="",Sa(l,kh.headers,l),Sa(u,kh,r||{}),u.headers=l,this.kt=e,this.I=i=new XMLHttpRequest,e=u.method;try{for(n in i.open(e,t,!0),l)l.hasOwnProperty(n)&&(o=l[n])&&i.setRequestHeader(n,o);i.withCredentials=!!u.withCredentials,a=z(c.Wh,c),s=+u.timeout||0,ih?(jh(c,"timeout",a),i.timeout=s):s&&(c.Mx=setTimeout((function(){i.abort(),c.Wh({type:"timeout"})}),s)),jh(c,"error",a),jh(c,"load",a),i.send(u.data)}catch(a){this.Wh({type:"cors"})}}$g.State=ah,u(dh,E),m=dh.prototype,m.disposeInternal=function(){dh.g.disposeInternal.call(this),this.Ag()},m.Ag=function(){this.zB=10,this.AB=6,this.ki=Ua(),this.Cr=Ua(),this.Hr=0},m.Eo=function(t){t=t.type;var e=this.ki[t]||0;if(this.Hr<this.zB&&e<this.AB){var r=++this.oB;return this.Hr++,this.ki[t]=e+1,this.Cr[r+""]=t,r}return x},m.$l=function(t){var e=this.Cr[t];if(!ab(e)||!this.ki[e])throw new wb(this.$l,"Unknown requestId");this.Hr--,this.ki[e]--,this.ki[e]||delete this.ki[e],delete this.Cr[t],this.dispatchEvent("allocatable")},m.oB=-1,t("H.net.Response",eh),eh.prototype.type="default",eh.prototype.type=eh.prototype.type,eh.prototype.status=200,eh.prototype.status=eh.prototype.status,eh.prototype.statusText="OK",eh.prototype.statusText=eh.prototype.statusText,eh.error=function(){return eh.mp||(eh.mp=new eh(null,{status:0,statusText:""}),eh.mp.type="error"),eh.mp},eh.error=eh.error,eh.prototype.text=function(){var t=fh(this);if(!t)if(this.Ko)t=cc(this.Ko);else if(this.Cf){var e,r=(t=new Uint8Array(this.Cf)).length,i=Array(r);for(e=0;e<r;e++)i[e]=String.fromCharCode(t[e]);t=cc(i.join(""))}else t=this.Fl?gh(this.Fl):dc("Unsupported response body");return t},eh.prototype.json=function(){return this.text().then(globalThis.JSON.parse)},eh.prototype.blob=function(){var t,e=fh(this);return e||(this.Fl?t=this.Fl:this.Cf&&(t=new Blob([this.Cf],{type:"application/octet-stream"}))),e||cc(t)},eh.prototype.arrayBuffer=function(){return this.Cf?fh(this)||cc(this.Cf.slice(0)):this.blob().then(eh.sy)},eh.sy=function(t){var e=new FileReader;return e.readAsArrayBuffer(t),new Vb((function(t,r){e.onload=function(){t(e.result)},e.onerror=function(){r(e.error)}}))},!tb&&globalThis.Response&&globalThis.Response.error&&(eh=globalThis.Response,mb(eh.prototype)),t("H.net.Xhr",hh);var kh={method:"GET",headers:{},data:null},lh="withCredentials"in new XMLHttpRequest,ih="timeout"in new XMLHttpRequest;function jh(t,e,r){lh?t.I.addEventListener(e,r):t.I["on"+e]=r}function mh(t,e,r){lh?t.I.removeEventListener(e,r):t.I["on"+e]=null}function nh(t,e,r,i){if(!oh[t])throw new C(nh,0,"Mime type is not supported");this.GB=t,"crossOrigin"in(t=i?Qa(i):{})||(t.crossOrigin="anonymous"),this.Fa=t,ph.href=e.toString(),uc.call(this,ph.protocol+"//"+ph.hostname,e,r)}hh.prototype.abort=function(){this.I&&(this.I.abort(),this.I&&this.Wh({type:"abort"}))},hh.prototype.abort=hh.prototype.abort,hh.prototype.Wh=function(t){var e,r=t.type;t=this.I,this.Mx&&clearTimeout(this.Mx),"load"===r?t instanceof XMLHttpRequest&&200!==t.status&&(e="network"):e=4===t.readyState&&0===t.status&&"error"==r?"cors":"error"!=r?r:"network",mh(this,"timeout",r=this.Wh),mh(this,"error",r),mh(this,"load",r),t=0===t.status||e&&"network"!==e?eh.error():new eh(t.responseText||null,t),e=this.kt,delete this.Wh,delete this.kt,delete this.I,e(t)},u(nh,uc),nh.prototype.Rt=function(){return this.br=oh[this.GB].call(this),!0},nh.prototype.Wi=function(){this.br&&(this.br.abort(),delete this.br)};var oh={"application/json":function(){var t=this,e=qh(this.Fa),r=e.headers;return e.headers=r=r?Qa(r):{},r.Accept="application/json",new hh(this.data,(function(e){200<=e.status&&300>e.status?t.resolve(e.json()):t.reject(e)}),e)},"text/plain":function(){var t=this;return new hh(this.data,(function(e){200<=e.status&&300>e.status?t.resolve(e.text()):t.reject(e)}),qh(this.Fa))},image:function(){var t=globalThis.document.createElement("img"),e=this,r=this.data;return t.onload=z(this.resolve,this,t),t.onerror=function(){e.reject(eh.error())},t.crossOrigin=this.Fa.crossOrigin,t.src=r,{abort:function(){t.onerror=t.onload=null,ae&&oe(t)||t.removeAttribute("src")}}}};!function(){try{var t=new XMLHttpRequest;t.open("get","/",!0)}catch(e){t={}}"response"in t&&(oh.arraybuffer=function(){var t,e=new XMLHttpRequest,r=this,i=this.Fa,n=i.headers;if(e.open("GET",this.data),rh(e,i),e.responseType="arraybuffer",n)for(t in n)e.setRequestHeader(t,n[t]);return e.onerror=e.ontimeout=function(){r.reject(eh.error())},e.onload=function(){r.resolve(new eh(e.response))},e.send(),e})}();var sh=new xc(new dh);nh.prototype.Fp=function(){return sh};var ph=globalThis.document.createElement("a");function qh(t){var e=Qa(t);return delete e.crossOrigin,rh(e,t),e}function rh(t,e){t.withCredentials="use-credentials"===e.crossOrigin}function th(t,e){if(th.g.constructor.call(this,t,e),gb(t))uh.test(t)&&-1===t.indexOf("import:")?(this.yc=t,e||(this.aB=Ag(this.yc)?A:this.yc)):this.po=t;else{if(!ya(t))throw new C(th,0,"invalid style configuration");this.Eg(Ya(t))}}function Ah(t){var e,r=t.Ia;if(ya(r)){var i;if(i=t.ts){for(var n in i=!1,r=r&&r.sources)if(r[n].type===t.ts){i=!0;break}i=!(!r||i)}i&&(e="invalid source, the only valid type is "+t.ts)}else e="invalid style configuration";return e&&t.Ic(e),!e}function yh(t){t.dispatchEvent(new Fc("change",t))}function wh(t){if(t.getState()!==ah.READY)throw new wb(t.fk,"style is not ready yet")}function xh(t,e,r,i){var n,o,a=[],s=fb(e)?e:[e];for(void 0===i&&(i=!0),s=s.sort().reverse();n=s.pop();){e=String(n).split(".");for(var l=t.Ia,u=e.length;u--&&!Hg[e[u]];);if(l&&0>u&&Cg(l=Fg(l.layers,e))||(l=Dg),l===Dg)throw new C(r,0,'Unresolvable layer ID "'+n+'"');if(a.push({id:e,yb:l}),i)for(o in l)!Hg[o]&&Cg(l[o])&&s.push(n+"."+o)}return a}function zh(t,e){var r,i=0;for(r=e.length;i!==r;){var n=e[i++],o=t;if(!(t=o[n]))break}return i===r?{node:t,parent:o,En:n}:void 0}u(th,$g),t("H.map.render.webgl.Style",th),th.prototype.load=function(){var t=this,e=this.Lc();this.yc?(this.F(ah.LOADING),new nh("text/plain",this.yc).then((function(t){var r={};return vh(t,e,!1,(r[e]=!0,r))})).then((function(e){return t.Eg(e)}),(function(e){return t.Ic(e.message)})),delete this.yc):this.po&&(this.F(ah.LOADING),vh(this.po,e).then((function(e){return t.Eg(e)}),(function(e){return t.Ic(e.message)})),delete this.po)},th.prototype.load=th.prototype.load,th.prototype.Vw=function(t,e,r){var i;for(wh(this),t=xh(this,t,this.Vw,r),r=0;r<t.length;r++){var n=t[r].yb.draw;for(i in n){var o=n[i];Cg(o)&&(o.interactive=!!e)}}yh(this)},th.prototype.setInteractive=th.prototype.Vw,th.prototype.setProperty=function(t,e,r){var i,n=t.split("."),o=0,a=n.length;if(wh(this),!ab(e))throw new C(this.setProperty,1,"value");if(i=zh(this.Ia,n)){if(!(i.parent instanceof Object)||i.parent instanceof Array){if(!r)throw new C(this.setProperty,0,t+" property is not primitive type");n.pop(),n=zh(this.Ia,n),i.parent=n.parent[n.En]={}}i.parent[i.En]=e}else{for(i=this.Ia;o!==a-1;)i[n[o]]={},i=i[n[o++]];i[n[o]]=e}Ah(this)&&yh(this)},th.prototype.setProperty=th.prototype.setProperty,th.prototype.Op=function(t){return wh(this),(t=zh(this.Ia,t.split(".")))?Ya(t.node):void 0},th.prototype.getProperty=th.prototype.Op,th.prototype.removeProperty=function(t){wh(this),(t=zh(this.Ia,t.split(".")))&&t.parent&&t.parent.hasOwnProperty(t.En)&&(delete t.parent[t.En],Ah(this)&&yh(this))},th.prototype.removeProperty=th.prototype.removeProperty,th.prototype.vj=function(t,e,r){var i;wh(this);var n=this.Ia,o=n.layers,a=xh(this,t,this.vj,!1);for(t=a.length,i={};t--;)Kg(i,o,a[t].id,!!e,!!r);for(r={},t=(a=Object.keys(n)).length;t--;){var s=a[t],l=n[s];r[s]=l===o?i:Ya(l)}return e||yh(this),r},th.prototype.extractConfig=th.prototype.vj,th.prototype.fk=function(t){if(wh(this),!ya(t))throw new C(this.fk,0,"config");this.Eg(Bg(this.Ia,t))},th.prototype.mergeConfig=th.prototype.fk,th.prototype.Yb=ca(2),th.prototype.toString=function(){return this.getState()===ah.READY?globalThis.H.gl.yaml.dump(this.Ia,{lineWidth:120}):""},th.prototype.disposeInternal=function(){th.g.disposeInternal.call(this),delete this.po,delete this.yc};var uh=/^(http[s]?)?.*\.ya?ml/i;function vh(t,e,r,i){r=void 0!==r&&r,i=void 0===i?{}:i;try{var n=globalThis.H.gl.yaml.load(t,{json:!0})}catch(t){return Promise.reject(t)}return n&&(gb(t=n.import)&&(t=[t]),r&&e&&Bh(n,e),delete n.import,fb(t)&&t.length)?(r=t.reduce((function(t,r){var n=e?zg(r,e):r;return i[n]||(i[n]=!0,t.push(new nh("text/plain",n).then((function(t){return vh(t,n,!0,i)})))),t}),[]),Promise.all(r).then((function(t){var e={};return t.forEach((function(t){return t&&Bg(e,t)})),Bg(e,n),e}))):Promise.resolve(n)}function Bh(t,e){function r(t){t.url&&(t.url=zg(t.url,e))}var i=t&&t.fonts;if(i)for(var n in i)fb(i[n])?i[n].forEach(r):r(i[n]);if(t=t&&t.textures)for(var o in t)r(t[o])}th.normalize=Bh,th.prototype.Eg=function(t){th.g.Eg.call(this,t),Ah(this)&&(this.F(ah.READY),yh(this))},th.prototype.Sd=function(){return th.g.Sd.call(this)},th.prototype.getConfig=th.prototype.Sd,th.prototype.Lc=function(){return this.aB||th.g.Lc.call(this)},th.prototype.getBaseUrl=th.prototype.Lc;var Ch={FEATURE:1,SOURCE:2,PROVIDER:3};function Q(t){var e,r=""+fe();if(Q.g.constructor.call(this),t=t||{},this.min=t.min||0,this.max=t.max||22,e=t.uri){if(/_/.test(e))throw new C(Q,0,"uri "+e)}else e=r;if(this.uri=e||r,this.uid=r,t.getCopyrights&&db(t.getCopyrights,"Function",Q)&&(this.getCopyrights=t.getCopyrights),this.Eb=this.Eb.bind(this),this.lq=!0,this.vb=t.engineType||Dh,this.vb===Eh.HARP&&!H.map.render.harp)throw new C(Q,0,"HARP engine is not supported, module not found")}function Fh(t){if(t.vb===Eh.WEBGL){var e=new Zg(t.getCapabilities(),t.uid,t.min,t.max,t.Sc,t.tileSize);t.Ya=new th(e.Ke())}else t.vb===Eh.HARP&&H.map.render.harp&&(t.Ya=new H.map.render.harp.Style({}));t.lq=!0}function Gh(){}function Hh(t){return kd(1,ld(0,.5-qd(xd(Dd+Cd*t/180))/Bd/2))}function Ih(t){return 0>=t?90:1<=t?-90:Hd*(2*yd(td(Bd*(1-2*t)))-Cd)}t("H.map.provider.PickingMode",Ch),u(Q,E),t("H.map.provider.Provider",Q),m=Q.prototype,m.j={Li:"configchange",Aa:"update"},m.jb=function(t,e){this.dispatchEvent(new id(this.j.Aa,e,t))},m.Eb=function(t){t=new wg(this.j.Li,t&&t.newValue,t&&t.oldValue),this.dispatchEvent(t)},m.disposeInternal=function(){E.prototype.disposeInternal.call(this),this.Ya&&(this.Ya.removeEventListener("change",this.Eb),this.Ya.l(),delete this.Ya)},m.U=function(){return null},Q.prototype.getCopyrights=Q.prototype.U,Q.prototype.getCapabilities=function(){var t=0;return this.qr()&&(t|=xg.PROVIDES_BY_VIEWPORT),this.providesRasters()&&(t|=xg.PROVIDES_RASTERS),this.providesSpatials()&&(t|=xg.PROVIDES_SPATIALS),this.providesOverlays()&&(t|=xg.PROVIDES_OVERLAYS),this.providesMarkers()&&(t|=xg.PROVIDES_MARKERS),this.providesDomMarkers()&&(t|=xg.PROVIDES_DOM_MARKERS),this.providesGeoJSON()&&(t|=xg.PROVIDES_GEOJSON),this.providesOMV()&&(t|=xg.PROVIDES_OMV),t},Q.prototype.getCapabilities=Q.prototype.getCapabilities,Q.prototype.qr=he,Q.prototype.zk=he,Q.prototype.providesRasters=Q.prototype.zk,Q.prototype.ne=he,Q.prototype.providesSpatials=Q.prototype.ne,Q.prototype.sr=he,Q.prototype.providesOverlays=Q.prototype.sr,Q.prototype.Wc=he,Q.prototype.providesMarkers=Q.prototype.Wc,Q.prototype.Vc=he,Q.prototype.providesDomMarkers=Q.prototype.Vc,Q.prototype.rr=he,Q.prototype.providesGeoJSON=Q.prototype.rr,Q.prototype.Xc=he,Q.prototype.providesOMV=Q.prototype.Xc,Q.prototype.Lz=function(){return this.vb},Q.prototype.getEngineType=Q.prototype.Lz,Q.prototype.ZC=function(t){this.vb=t},Q.prototype.setEngineType=Q.prototype.ZC,Q.prototype.xk=ie,Q.prototype.preprocessData=Q.prototype.xk,Q.prototype.Sc=1,Q.prototype.Fg=function(t){t=Nd(t,0,1),D(t)&&(t=1),this.Sc!==t&&(this.Sc=t,this.lq&&Fh(this),this.Eb(),this.jb())},Q.prototype.lA=function(){return this.Sc},Q.prototype.getOpacityInternal=Q.prototype.lA,Q.prototype.Xa=function(t,e){var r=this;if(this.vb===Eh.WEBGL&&!B(t,th)||this.vb===Eh.HARP&&!B(t,H.map.render.harp.Style))throw t=Object.entries(Eh).find((function(t){return t[1]===r.vb})),new C(this.Xa,0,"Invalid style for engineType "+t);this.Ya&&(this.Ya.removeEventListener("change",this.Eb),this.Ya.removeEventListener(bh,this.Eb),this.Ya.l()),this.Ya=t,this.Ya.addEventListener("change",this.Eb),this.Ya.addEventListener(bh,this.Eb),e||this.Eb(),this.lq=!1},Q.prototype.setStyleInternal=Q.prototype.Xa,Q.prototype.mb=function(){return this.Ya||Fh(this),this.Ya},Q.prototype.getStyleInternal=Q.prototype.mb,Q.prototype.ru=function(){var t=this.getCapabilities(),e=Ch.FEATURE;return t&xg.PROVIDES_BY_VIEWPORT?e=Ch.SOURCE:t&xg.PROVIDES_RASTERS?e=null:t&xg.PROVIDES_WEBGL_RENDERABLE_OBJECTS&&(e=Ch.PROVIDER),e},Q.prototype.getPickingMode=Q.prototype.ru,Q.prototype.Qz=function(){return!1},Q.prototype.getFeatureProxy=Q.prototype.Qz,Gh.prototype.Sm=function(t,e,r){return r?(r.x=e/360+.5,r.y=Hh(t)):r=new K(e/360+.5,Hh(t)),r},Gh.prototype.latLngToPoint=Gh.prototype.Sm,Gh.prototype.Se=function(t,e){return this.Sm(t.lat,t.lng,e)},Gh.prototype.geoToPoint=Gh.prototype.Se,Gh.prototype.Za=function(t,e,r){return r?(r.lat=Ih(e),r.lng=360*(1===t?1:Ld(t,1))-180):r=new xe(Ih(e),360*(1===t?1:Ld(t,1))-180),r},Gh.prototype.xyToGeo=Gh.prototype.Za,Gh.prototype.wn=function(t,e){return this.Za(t.x,t.y,e)},Gh.prototype.pointToGeo=Gh.prototype.wn;var Jh=new Gh;function Kh(t,e){this.projection=t||Jh,this.Ii=0,this.jl=this.exp=qd(e||256)/Ad,Lh(this),this.y=this.x=0}t("H.geo.mercator",Jh),t("H.geo.PixelProjection",Kh);var Mh=pd(24)+pd(-8);function Lh(t){t.jl>Mh&&(t.jl=Mh),t.w=sd(2,t.jl),t.h=sd(2,t.jl)}function Nh(t){t=t||{},Nh.g.constructor.call(this),this.min=0,this.max=22,this.My=this.dark=!!t.dark,t.min&&this.Tr(t.min),t.max&&this.Rr(t.max),this.pixelProjection=new Kh(t.projection,t.minWorldSize),t.provider&&(this.D=t.provider,this.jb=z(this.jb,this),this.D.addEventListener(Q.prototype.j.Aa,this.jb,!1,this),this.Eb=z(this.Eb,this),this.D.addEventListener(Q.prototype.j.Li,this.Eb,!1,this))}function Oh(t,e,r){var i=t[e],n="min"===e,o=n?t.Tr:t.Rr;if(r!==i){if(!(n?r<=t.max:r>=t.min))throw new C(o,0,"Invalid condition min <= max");t[e]=r,t.jb(),t.Eb(),t.dispatchEvent(new wg(n?t.j.Qs:t.j.Ps,r,i))}return t}function Ph(t,e){this.w=+t,this.h=+e}function Qh(t,e,r,i){Qh.g.constructor.call(this),this.nd=t,this.ja=i,this.element=t.appendChild(this.createElement(t.ownerDocument)),this.Uk(e,r)}function Rh(t,e){var r=e||{},i=r.contextType;if(r=r.contextAttributes,Rh.g.constructor.call(this,e),db(t,"Function",Rh,0,"invalid render callback"),i){if(-1===Sh.indexOf(i))throw new C(Rh,1,"invalid context type");this.ij=i}r&&(this.hj=r),this.Ar=t}Kh.prototype.Dn=Jh,Kh.prototype.projection=Kh.prototype.Dn,Kh.prototype.x=0,Kh.prototype.x=Kh.prototype.x,Kh.prototype.y=0,Kh.prototype.y=Kh.prototype.y,Kh.prototype.w=sd(2,Mh),Kh.prototype.w=Kh.prototype.w,Kh.prototype.TA=sd(2,Mh),Kh.prototype.h=Kh.prototype.TA,Kh.prototype.Va=function(t){if(D(t))throw new C(this.Va,0,t);var e=this.x/this.w,r=this.y/this.h;this.Ii=t,this.jl=this.exp+t,Lh(this),this.x=e*this.w,this.y=r*this.h},Kh.prototype.rescale=Kh.prototype.Va,Kh.prototype.xu=function(){return this.Ii||0},Kh.prototype.getZoomScale=Kh.prototype.xu,Kh.prototype.Gb=function(t,e){return(t=this.projection.Sm(t.lat,t.lng,e)).x=t.x*this.w-this.x,t.y=t.y*this.h-this.y,t},Kh.prototype.geoToPixel=Kh.prototype.Gb,Kh.prototype.sk=function(t,e){return this.projection.Za((t.x+this.x)/this.w,(t.y+this.y)/this.h,e)},Kh.prototype.pixelToGeo=Kh.prototype.sk,Kh.prototype.Za=function(t,e,r){return this.projection.Za((t+this.x)/this.w,(e+this.y)/this.h,r)},Kh.prototype.xyToGeo=Kh.prototype.Za,Kh.prototype.wq=function(t,e,r){return(t=this.projection.Sm(t,e,r)).x=t.x*this.w-this.x,t.y=t.y*this.h-this.y,t},Kh.prototype.latLngToPixel=Kh.prototype.wq,Kh.prototype.bi=function(t){return new K(t.x*this.w-this.x,t.y*this.h-this.y)},Kh.prototype.pointToPixel=Kh.prototype.bi,u(Nh,E),t("H.map.layer.Layer",Nh),Nh.prototype.min=0,Nh.prototype.min=Nh.prototype.min,Nh.prototype.max=22,Nh.prototype.max=Nh.prototype.max,Nh.prototype.j={Aa:"update",Li:"configchange",Qs:"minchange",Ps:"maxchange"},Nh.prototype.Pp=function(){return this.D},Nh.prototype.getProvider=Nh.prototype.Pp,Nh.prototype.hB=function(t){return this.min<=t&&t<=this.max},Nh.prototype.isValid=Nh.prototype.hB,Nh.prototype.Tr=function(t){return Oh(this,"min",+t)},Nh.prototype.setMin=Nh.prototype.Tr,Nh.prototype.Rr=function(t){return Oh(this,"max",+t)},Nh.prototype.setMax=Nh.prototype.Rr,Nh.prototype.jb=function(){this.dispatchEvent(this.j.Aa)},Nh.prototype.Eb=function(t){t=new wg(this.j.Li,t&&t.newValue,t&&t.oldValue),this.dispatchEvent(t)},Nh.prototype.disposeInternal=function(){Nh.g.disposeInternal.call(this)},Nh.prototype.U=function(){return null},Nh.prototype.getCopyrights=Nh.prototype.U,t("H.util.Disposable",Ac),Ac.prototype.bc=Ac.prototype.bc,Ac.prototype.addOnDisposeCallback=Ac.prototype.bc,t("H.util.dispose",zc),Ac.prototype.l=Ac.prototype.l,Ac.prototype.dispose=Ac.prototype.l,Ac.prototype.disposeInternal=Ac.prototype.disposeInternal,Ac.prototype.disposeInternal=Ac.prototype.disposeInternal,t("H.math.Size",Ph),u(Qh,Ac),Qh.prototype.B=function(){return this.element},Qh.prototype.Uk=function(t,e){this.size?(this.size.w=t,this.size.h=e):this.size=new Ph(t,e),this.Yw(this.element,this.element.style,t,e,this.ja)},Qh.prototype.setSize=Qh.prototype.Uk,m=Qh.prototype,m.mc=function(){return this.size},m.lb=function(){return this.ja},m.Zu=!0,m.Zb=function(t){t!==this.Zu&&(this.element.style.display=t?"block":"none",this.Zu=t)},m.opacity=1,m.Fd=function(t){this.opacity!==t&&(this.Fg(t),this.opacity=t)},m.Ve=function(){return this.opacity},m.ui=function(t){this.element.style.zIndex=t},Qh.prototype.setZIndex=Qh.prototype.ui,Qh.prototype.wu=function(){return+this.element.style.zIndex},Qh.prototype.Re=function(){},Qh.prototype.clear=function(){},Qh.prototype.disposeInternal=function(){this.clear(),this.nd.removeChild(this.element),this.Uk(0,0),delete this.element,delete this.nd,Qh.g.disposeInternal.call(this)},Qh.prototype.disposeInternal=Qh.prototype.disposeInternal,Qh.prototype.xw=0,Qh.prototype.Sn=function(){++this.xw},Qh.prototype.release=function(){--this.xw||this.l()},u(Rh,Nh),t("H.map.layer.CanvasLayer",Rh);var Sh=["2d","webgl","webgl2","experimental-webgl"];function Th(t,e){Th.g.constructor.call(this,e),db(t,"Function",Th,0,"invalid render callback"),this.Ar=t}function Uh(t,e,r,i,n){switch(e&&(this.gf=e),ab(r)&&(this.Ho=!!r),this.Ho&&i&&(this.Io=new Ph(i.w,i.h)),ab(n)&&(this.Gk={crossOrigin:n}),Vh[eb(t)]){case 2:this.gb=t,Wh(this,1);break;case 1:if(oe(t)){this.gb=t,Xh(this),Wh(this,1);break}t=t.src;case 0:if(t){t=ce(t),this.Cm=new nh("image",t,A,this.Gk),this.Cm.then(z(this.$B,this),z(this.ZB,this));break}default:throw Wh(this,-1),new C(Uh,0,"No image data")}}function Wh(t,e){t.s=e,delete t.Cm,t.gf&&t.gf(e,t)}function Xh(t){if(t.Ho){var e=t.gb,r=Yh(t),i=r&&r.w||+e.width,n=r&&r.h||+e.height,o=Vd();if(B(e,globalThis.HTMLCanvasElement))r=e;else{(r=e.ownerDocument.createElement("canvas")).width=od(i*o),r.height=od(n*o);var a=r.getContext("2d");a.scale(o,o),a.drawImage(e,0,0,i,n),yb&&(a.clearRect(0,0,i,n),a.drawImage(e,0,0,i,n))}t.gb=r}}m=Rh.prototype,m.ij="2d",m.uh=function(){return this.ij},m.getContextAttributes=function(){return this.hj},m.L=function(t,e){return this.Sl&&this.Sl.canvas===t||(this.Sl=t.getContext(this.ij,this.hj)),this.Ar(this.Sl,e)},m.disposeInternal=function(){Rh.g.disposeInternal.call(this),delete this.Sl},u(Th,Nh),t("H.map.layer.DomLayer",Th),Th.prototype.L=function(t,e){return this.Ar(t,e)},Uh.prototype.s=0,Uh.prototype.getState=function(){return this.s},Uh.prototype.Ho=!0,Uh.prototype.getData=function(){return this.gb||x};var Vh={String:0,HTMLImageElement:1,HTMLCanvasElement:2};function Yh(t){var e,r=t.Io;if(!r){var i=t.gb;if(0===(r=i.naturalWidth||i.width)&&ae&&1===Vh[eb(i)]){var n=!0;if(e=i.parentNode)var o=i.nextSibling;document.body.appendChild(i)}t.Io=r=new Ph(i.naturalWidth||i.width,i.naturalHeight||i.height),n&&(e?e.insertBefore(i,o):document.body.removeChild(i))}return r}function Zh(t,e){var r,i=t,n=e||[];if(t!==$h.NONE){if(e=r=n.length,-1===ai.indexOf(i))throw new C(Zh,0,t);if(!n)throw new C(Zh,1,n);for(;r--;)if(D(n[r]))throw new C(Zh,1,n);if(i===$h.RECT&&3<e&&(n=[n[0],n[1],n[2],n[1],n[2],n[3],n[0],n[3]],i=$h.POLYGON),i===$h.CIRCLE&&2<e&&0<(t=n[2])){i=n[0];var o=n[1],a=360/(r=kd(2*od(t),40));for(n=[];r--;){var s=a*r*Gd;n.push(i+ud(s)*t,o+wd(s)*t)}i=$h.POLYGON}if(i!==$h.POLYGON||!e||n.length%2)throw new C(Zh,1,n);this.iw=n}}m=Uh.prototype,m.Io=x,m.mc=function(){return 1===this.s?Yh(this):x},m.$B=function(t){this.gb=t,Xh(this),Wh(this,1)},m.ZB=function(){Wh(this,-1)},m.cancel=function(){this.Cm&&this.Cm.cancel()},t("H.map.HitArea",Zh);var $h={NONE:0,RECT:1,CIRCLE:2,POLYGON:3};Zh.ShapeType=$h;var ai=[$h.RECT,$h.CIRCLE,$h.POLYGON];function bi(t,e){var r,i="anonymous";if(this.uid=ci.next(),bi.g.constructor.call(this),e){var n="size";if(n in e){var o=e[n];if(!o||isNaN(o.w)||isNaN(o.h))throw new C(bi,1,n);this.co=new Ph(o.w,o.h)}if((n="anchor")in e){if(!(o=e[n])||isNaN(o.x)||isNaN(o.y))throw new C(bi,1,n);this.Db=new K(o.x,o.y)}(n="hitArea")in e&&(B(o=e[n],Zh,bi,1),this.Am=e[n]),(n="asCanvas")in e&&(r=e[n]),(n="crossOrigin")in e&&(i=e[n]),(o=e.stickHeight)===+o&&0<o&&(this.mD=o),o=e[n="stickColor"],n in e&&gb(o)&&(this.lD=o)}t=new Uh(t,z(this.Wg,this),r,this.co,i),0!==(e=this.s=t.getState())?this.Wg(e,t):this.El=t}Zh.prototype.Bm=function(t,e,r){return this.iw?Qd(t,e,this.iw,r,!0):Pd.NONE},Zh.prototype.hitTest=Zh.prototype.Bm,u(bi,E),t("H.map.Icon",bi);var ci=new de;bi.State={ERROR:-1,LOADING:0,READY:1},bi.prototype.getState=function(){return this.s},bi.prototype.getState=bi.prototype.getState,bi.prototype.Wg=function(t,e){if(this.gb=e.getData(),1===t){var r=this.co;r||(r=this.co=e.mc()),this.Db||(this.Db=new K(r.w/2|0,r.h))}this.El&&(this.s=t,delete this.El,this.dispatchEvent("statechange"))},bi.prototype.gb=x,bi.prototype.Te=function(){return this.gb},bi.prototype.getBitmap=bi.prototype.Te,bi.prototype.mc=function(){return this.co||x},bi.prototype.getSize=bi.prototype.mc,bi.prototype.Db=x,bi.prototype.yp=function(){return this.Db},bi.prototype.getAnchor=bi.prototype.yp,bi.prototype.Am=x,bi.prototype.Uz=function(){return this.Am},bi.prototype.getHitArea=bi.prototype.Uz,bi.prototype.disposeInternal=function(){bi.g.disposeInternal.call(this),this.gb?(this.gb.removeAttribute("src"),delete this.gb):(this.El.cancel(),delete this.El)},t("H.util.events.listenOnce",Vc),t("H.util.events.dispatchEvent",(function(t,e){return t.dispatchEvent(e)})),t("H.util.events.fireListeners",(function(t,e,r,i){if(Jc(t))r=t.Lf(e,r,i);else{var n=!0;if((t=Yc(t))&&(e=t.pb[e.toString()]))for(e=e.concat(),t=0;t<e.length;t++){var o=e[t];o&&o.capture==r&&!o.ii&&(o=dd(o,i),n=n&&!1!==o)}r=n}return r})),t("H.util.events.listen",Uc),t("H.util.events.unlisten",bd);var di=dd;function ei(t){ei.g.constructor.call(this,t)}function fi(t,e){var r;bb(this,fi),fi.g.constructor.call(this,e),this.X(t),e&&"icon"in e&&(r=e.icon),this.we(r||this.Dp())}dd=function(t,e){var r,i,n=!0,o=e[e.currentTarget===e.target?"AT_TARGET":t.capture?"CAPTURING_PHASE":(r=!0,"BUBBLING_PHASE")];return(!r||"pointerenter"!==(i=e.type)&&"pointerleave"!==i)&&(e.eventPhase=o,n=di(t,e),r&&t.src&&t.src.Jb&&null===t.src.Jb()&&delete e.eventPhase),n},u(ei,kg),t("H.geo.MultiPoint",ei),ei.prototype.tq=function(t){return ye(t)},ei.prototype.ow=function(t){return B(t,xe)?t:ze(t)},ei.prototype.ac="Multi"+xe.prototype.ac,ei.prototype.Kc="Multi"+xe.prototype.Kc,u(fi,N),t("H.map.AbstractMarker",fi),fi.prototype.V=function(){return this.hm},fi.prototype.getGeometry=fi.prototype.V,fi.prototype.X=function(t){var e=this.hm;return B(t,xe)||B(t,ei)?this.hm=t:(ye(t,this.X,0),this.hm=ze(t)),e&&this.ra(Lf.SPATIAL),this},fi.prototype.setGeometry=fi.prototype.X,fi.prototype.C=function(){return this.hm.C()},fi.prototype.kc=function(){return this.icon},fi.prototype.getIcon=fi.prototype.kc,fi.prototype.we=function(t){var e=this.icon,r=!e;if(e!==t){if(!this.Yu(t)){if(r)throw new C(this.constructor,1,t);throw new C(this.we,0,t)}this.icon=t,r||this.ra(Lf.VISUAL)}return this},fi.prototype.setIcon=fi.prototype.we,fi.prototype.Dp=function(){var t=this.Oy;return t||(t=this.constructor.prototype.Oy=this.tt(gi)),t};var gi={svg:'<svg xmlns="http://www.w3.org/2000/svg" width="38" height="47" viewBox="0 0 38 47"><g fill="none"><path fill="#0F1621" fill-opacity=".4" d="M15 46c0 .317 1.79.574 4 .574s4-.257 4-.574c0-.317-1.79-.574-4-.574s-4 .257-4 .574z"></path><path fill="#01b6b2" d="M33.25 31.652A19.015 19.015 0 0 0 38 19.06C38 8.549 29.478 0 19 0S0 8.55 0 19.059c0 4.823 1.795 9.233 4.75 12.593L18.975 46 33.25 31.652z"></path><path fill="#6A6D74" fill-opacity=".5" d="M26.862 37.5l4.714-4.77c3.822-3.576 5.924-8.411 5.924-13.62C37.5 8.847 29.2.5 19 .5S.5 8.848.5 19.11c0 5.209 2.102 10.044 5.919 13.614l4.719 4.776h15.724zM19 0c10.493 0 19 8.525 19 19.041 0 5.507-2.348 10.454-6.079 13.932L19 46 6.079 32.973C2.348 29.495 0 24.548 0 19.04 0 8.525 8.507 0 19 0z"></path></g></svg>',size:new Ph(38,47),anchor:new K(19,45),hitArea:new Zh($h.POLYGON,[19,46,2,27,0,18,5,6,19,0,32,5,38,15,36,27,19,47])};function hi(t,e){hi.g.constructor.call(this,t,e)}function ii(t){ii.g.constructor.call(this,t)}function ji(t,e,r){var i,n=6;if(e){for(i=' expected close to: "'+e;n--;)-1!==(e=t.nt.next())&&(i+=String.fromCharCode(e));i+='"'}throw new C(ki,0,"- Malformed WKT: "+(i?r+i:"unexpected end of stream"))}function li(t,e){var r=t.next();r!==(e=e?")":"(")&&ji(t,r,'"'+e+'"')}function mi(t){return","===t.eb()&&(t.next(),!0)}function ni(t,e,r,i,n){var o,a,s=2+e+r;for(a=1;a<=s;a++)(r=t.next())?(o=+r)!==o?ji(t,r,"number"):1===a?i[n+1]=o:2===a?i[n+0]=o:3===a&&(i[n+2]=o):ji(t,r);e||(i[n+2]=0)}fi.prototype.P=function(){var t=fi.g.P.call(this),e=this.kc(),r=e.mc(),i=e.Db;return t.geometry=this.V().P(),r&&((e=t.properties.icon={id:e.uid}).size={w:r.w,h:r.h},e.offset=[r.w/2-(i?i.x:0),r.h/2-(i?i.y:0)]),t},fi.prototype.forWorkerMessage=fi.prototype.P,u(hi,fi),t("H.map.Marker",hi),hi.prototype.type=Yf.MARKER,hi.prototype.ro=1,hi.prototype.ra=function(t){if(t!==Lf.VISUAL||1===this.mw||1===this.icon.getState())var e=hi.g.ra.call(this,t);return e||!1},hi.prototype.invalidate=hi.prototype.ra,m=hi.prototype,m.mw=0,m.Yu=function(t){return B(t,bi)},m.qq=!1,m.Nv=function(){this.ra(Lf.VISUAL)},m.we=function(t){var e=this.icon;return this.qq&&(e.removeEventListener("statechange",this.Nv,!1,this),delete this.qq),e&&(this.mw=e.getState()),hi.g.we.call(this,t),0===t.getState()&&(this.qq=!0,Vc(t,"statechange",this.Nv,!1,this)),this},hi.prototype.setIcon=hi.prototype.we,hi.prototype.tt=function(t){return new bi(t.svg,t)},hi.prototype.P=function(){var t=this.getIcon(),e=t.mD||0,r=hi.g.forWorkerMessage.call(this),i=r.properties.icon;return i&&0<e&&Sa(i,{stick_color:t.lD,stick_height:e}),r},hi.prototype.forWorkerMessage=hi.prototype.P,u(ii,kg),t("H.geo.MultiLineString",ii),ii.prototype.tq=function(t){return B(t,J)},ii.prototype.ac="Multi"+J.prototype.ac,ii.prototype.Kc="Multi"+J.prototype.Kc;var oi=[];function pi(t,e,r,i){return i||li(t,0),ni(t,e,r,oi,0),i||li(t,1),new xe(oi[0],oi[1],e?oi[2]:A)}function qi(t,e,r){var i=[];li(t,0);do{ni(t,e,r,i,i.length)}while(mi(t));return li(t,1),new J(i)}function ri(t,e,r){li(t,0);var i=qi(t,e,r);if(mi(t)){var n=[];do{n.push(qi(t,e,r))}while(mi(t))}return li(t,1),new L(i,n)}var si=[],ti=[ri],ui=[pi],vi={POINT:ui,LINESTRING:[qi],POLYGON:ti,MULTIPOINT:[pi,ei],MULTILINESTRING:[qi,ii],MULTIPOLYGON:[ri,mg],GEOMETRY:si,GEOMETRYCOLLECTION:si,CIRCULARSTRING:si,COMPOUNDCURVE:si,CURVEPOLYGON:si,MULTICURVE:si,MULTISURFACE:si,CURVE:si,SURFACE:si,POLYHEDRALSURFACE:si,TIN:si,TRIANGLE:si},wi={Z:1,M:2,ZM:3};function ki(t){var e,r=(t=new xi(t)).next();if((e=vi[r.toUpperCase()])||ji(t,r,"type name"),e!==si){r=t.eb();var i=1&(r=wi[r.toUpperCase()]),n=r>>1;if(i|n&&t.next(),"EMPTY"===(r=t.eb()))if(t.next(),i=e[1])var o=new i([]);else e!==ui&&(o=new J([]),e===ti&&(o=new L(o)));else if("("===r){if(o=e[0],e=e[1]){var a=[];if(li(t,0),o===pi){var s="("!==t.eb();do{a.push(o(t,i,n,s))}while(mi(t))}else do{a.push(o(t,i,n))}while(mi(t));li(t,1),i=new e(a)}else i=o(t,i,n);o=i}else ji(t,r,'"Z", "M", "ZM", "(" or "EMPTY"');t.next()&&ji(t,r,"end of stream")}return o||x}function xi(t){this.nt=t}xi.prototype.eb=function(){var t=this.dw;if(t===A){for(t=this.nt;t.eb()===yi;)t.next();if(zi[t.eb()])t=(t=t.next())===Ai?"":String.fromCharCode(t);else{t.yi();do{t.next()}while(!zi[t.eb()]);t=String.fromCharCode.apply(null,t.mh())}this.dw=t}return t},xi.prototype.next=function(){var t=this.eb();return""!==t&&delete this.dw,t};var yi=32,Ai=-1,Bi={UD:yi,OD:40,TD:41,LD:44,MD:Ai},zi=Object.keys(Bi).reduce((function(t,e){return t[Bi[e]]=!0,t}),Ua());function Ci(){}function Di(t){this.Lu=String(t),this.jw=0,this.Ec=[],this.Yf=!1}function Ei(){Ei.g.constructor.call(this),this.hd=Fi(this),this.Cn=Ua(),this.nn=z(this.nn,this),this.hd.addEventListener("message",this.nn),this.el={}}t("H.util.ICharStream",Ci),Ci.prototype.next=function(){},Ci.prototype.yi=function(){},Ci.prototype.mh=function(){},Ci.prototype.eb=function(){},t("H.util.CharStream",Di),Di.prototype.next=function(){var t=this.Lu.charCodeAt(this.jw++);return t=isNaN(t)?-1:t,this.Yf&&this.Ec.push(t),t},Di.prototype.yi=function(){this.Yf=!0,this.Ec=[]},Di.prototype.mh=function(){var t=this.Ec.slice();return this.Yf=!1,this.Ec=[],t},Di.prototype.eb=function(){var t=this.Lu.charCodeAt(this.jw+0);return isNaN(t)?-1:t},t("H.util.wkt.toGeometry",(function(t){return ki(new Di(t))})),u(Ei,E),Ei.prototype.disposeInternal=function(){this.hd.terminate()},Ei.prototype.qw=function(t){var e=t.type,r=!!this.Cn[e],i=t.data,n=Gi++,o=i&&i.CD?i.CD:A,a=!0;return r?(this.el[n]=t,Hi(this,e,n,i&&i.message,o)):(t.reject(new C(this.qw,0,"processor_not_found")),a=!1),a},Ei.prototype.nn=function(t){t=t.data;var e=this.el[t.taskId],r=t.taskId,i=t.data,n=this;if(2===t.type)new nh("arraybuffer",i).then((function(t){return t.arrayBuffer()})).then((function(t){n.hd.postMessage(["3",r,[t]],[t])}),(function(){n.hd.postMessage(["3",r,[null,"ERROR"]])}));else{if(e){switch(t.type){case 1:e.resolve(i);break;case 0:e.reject(i)}delete this.el[r]}this.dispatchEvent(new Fc(this.j.IDLE))}};var Gi=0,Mi,Oi;function Ii(t,e,r){var i,n=Gi++;return t.el[n]=i=ec(),Hi(t,e,n,r),i.promise}function Hi(t,e,r,i,n){i===A||Ca(i)||(i=[i]);try{t.hd.postMessage([e,r,i],n)}catch(e){(t=t.el[r]).reject(e.message)}}function Fi(a){var b=globalThis.H.__bootstrap__;if(b=Za(b)?(""+b).replace(/^[^{]+{((.|[\r\n])+?)}\s*$/,"$1"):""+b,globalThis.Worker&&globalThis.URL)try{var c=new globalThis.Worker(globalThis.URL.createObjectURL(qe(b,"application/javascript")))}catch(t){}return c||(a=new Ji(a),function(){eval("var self = arguments[0];"+b)}(a),c=new Ki(a)),c}function Ki(t){E.call(this),this.hd=t}function Ji(a){E.call(this),this.hd=a,this.addEventListener=z(this.addEventListener,this),this.removeEventListener=z(this.removeEventListener,this),this.postMessage=z(this.postMessage,this),this.eval=z(eval,this)}function Li(){var t=Mi;return t||(t=Mi=this,E.call(t),this.Ag()),t}function Ni(t,e,r){uc.call(this,t,e,r)}function Pi(t,e,r){Pi.g.constructor.call(this,og,r),this.Zn(t),this.Yr(e),r&&this.kw in r&&this.Xr(r[this.kw])}function Qi(t){t.Hb!==x&&Pi.g.X.call(t,Ri(t))}function Ri(t){var e=t.Ef,r=e.lat,i=t.wr,n=0,o=new J;if(90===pd(r))for(r=e.mo(0,i,!0).lat;360>n;n+=120)o.tr(r,n-180,A);else for(t=360/(t=t.zn);360>n;n+=t)o.tg(e.mo(n,i,!0));return e=new L(o),0>r&&e.Ww(Bf.SOUTH),e}function Si(t,e){if(!B(t,Element)){if(Ti.innerHTML=t,!(t=Ti.firstElementChild))throw new C(Si,0,"No element data");Ti.removeChild(t);var r=!0;Ti.innerHTML=""}this.Uo=0!==le(t).length,this.Nt=r?t:me(t,globalThis.document,this.Uo),e&&((r="onAttach")in e&&db(t=e[r],"Function",Si,1,r)&&(this.Oq=t),(r="onDetach")in e&&db(t=e[r],"Function",Si,1,r)&&(this.Sq=t))}Ei.prototype.j={IDLE:"idle",Js:"error"},Ei.prototype.jy=function(t,e){var r=this.az||(this.az=new Fc(this.j.Js));r.data=e,delete this.Cn[t],this.dispatchEvent(r)},Ei.prototype.importScripts=function(t){Ii(this,"0",t)},u(Ki,E),Ki.prototype.postMessage=function(t){globalThis.setTimeout(z(this.uC,this,t),0)},Ki.prototype.uC=function(t){var e=new Fc("message");e.data=t,this.hd.dispatchEvent(e)},Ki.prototype.terminate=function(){this.hd.l(),this.l()},u(Ji,E),Ji.prototype.postMessage=function(t){var e=new Fc("message");e.data=t,globalThis.setTimeout(z(this.hd.nn,this.hd,e),0)},u(Li,E),m=Li.prototype,m.disposeInternal=function(){Li.g.disposeInternal.call(this),this.Ag()},m.Ag=function(){var t,e=this.oo;if(e)for(t=e.length;t--;)e[t].l();this.oo=[],mb(this.oo),this.Dm={},this.sw=Ua()},m.Eo=function(t){var e;if(t=t.type,!(e=this.sw[t]))throw new wb(this.Eo,'Unknown type "'+t+'"');var r=this.oo,i=r[0];return i||(i=r[0]=new Ei,this.bc(Ja(zc,i)),Oa(this.Dm)||i.importScripts(globalThis.Object.keys(this.Dm))),(r=i).Cn[t]||(r.Cn[t]=e,Ii(r,"1",[t,Za(e)?e+"":e]).then(ie,z(r.jy,r,t))),i},m.$l=function(){},m.registerProcessor=function(t,e){var r=this.sw,i=r[t];if(i){if(e!==i)throw new wb(this.registerProcessor,'Type "'+t+'" is already registered')}else r[t]=e},m.importScripts=function(t){[].concat(t).forEach((function(t){this.Dm[t]||(this.Dm[t]=!0,this.oo.forEach((function(e){e.importScripts(t)})))}),this)},u(Ni,uc),Ni.prototype.Fp=function(){return Oi||(Oi=new xc(new Li)),Oi},Ni.prototype.Wi=function(){},Ni.prototype.Rt=function(t){return t.qw(this)},u(Pi,ng),t("H.map.Circle",Pi),Pi.prototype.Zn=function(t){(t=ze(t)).da(this.Ef)||(this.Ef=t,Qi(this))},Pi.prototype.setCenter=Pi.prototype.Zn,Pi.prototype.wb=function(){return this.Ef},Pi.prototype.getCenter=Pi.prototype.wb,Pi.prototype.Yr=function(t){if(D(t=Nd(t,0,6371000.79*Bd/2)))throw new C(this.Yr,0,t);this.wr!==t&&(this.wr=t,Qi(this))},Pi.prototype.setRadius=Pi.prototype.Yr,Pi.prototype.xA=function(){return this.wr},Pi.prototype.getRadius=Pi.prototype.xA,Pi.prototype.zn=60,Pi.prototype.Xr=function(t){if(!jb(t))throw new C(this.Xr,0,t);this.zn!==(t=Nd(md(t),4,360))&&(this.zn=t,Qi(this))},Pi.prototype.setPrecision=Pi.prototype.Xr,Pi.prototype.kw="precision",Pi.prototype.uA=function(){return this.zn},Pi.prototype.getPrecision=Pi.prototype.uA,Pi.prototype.X=function(){return this},Pi.prototype.setGeometry=Pi.prototype.X,Pi.prototype.V=function(){return this.Hb===og&&Pi.g.X.call(this,Ri(this)),this.Hb},Pi.prototype.getGeometry=Pi.prototype.V,t("H.map.DomIcon",Si);var Ti=document.createElement("DIV");function Ui(t,e){Ui.g.constructor.call(this,t,e)}function Vi(t){var e=Wi[t];if(!e)if(t in Xi)e=Wi[t]=t;else{e=Yi.length;var r="",i=t.substr(0,1).toUpperCase()+t.substr(1),n="",o=!1;Zi&&(o=(n=Zi+i)in Xi);for(;e--&&!o;)o=(n=(r=Yi[e])+i)in Xi;if(o&&(Zi=r),!(e=o?n:null))throw Error("Could not find any variant of CSS property ["+t+"]");Wi[t]=e}return e}Si.prototype.Oq=null,Si.prototype.Sq=null,Si.prototype.eu=function(t){return me(this.Nt,t,this.Uo)},Si.prototype.Uo=!1,u(Ui,fi),t("H.map.DomMarker",Ui),Ui.prototype.type=Yf.DOM_MARKER,Ui.prototype.ro=2,Ui.prototype.tt=function(t){var e=new Si(t.svg,t);return t=t.anchor,e.Nt.style.margin=-t.y+"px 0 0 -"+t.x+"px",e},Ui.prototype.Yu=function(t){return B(t,Si)},t("H.dom.cssPrefixer.prefix",Vi);var Yi=["O","Ms","ms","Moz","Webkit"],Wi={},Zi="",Xi=document.createElement("span").style;function $i(t,e,r){var i="anonymous",n=1;this.Wg=z(this.Wg,this),N.call(this,r),this.X(t),r&&((t="crossOrigin")in r&&(i=r[t]),(t="opacity")in r&&(n=r[t])),this.Sw(e,i),this.Fd(n)}function aj(t,e){if(e=e||{},!t)throw new C(aj,0,t);this.tileSize=t.tileSize,this.tx={},Nh.call(this,{min:void 0!==e.min?e.min:t.min,max:void 0!==e.max?e.max:t.max,minWorldSize:this.tileSize,projection:e.Dn,dark:e.dark,provider:t})}function bj(t,e,r,i,n){i=nd(i);var o=sd(2,i),a=e.left,s=e.top,l=e.right;r=l+(r?o+(l===e.left?0:1):1);var u=e.bottom,c=[];if(n)var h=a+(1+l-a)/2+n.x/t.tileSize-.5,p=s+(1+u-s)/2+n.y/t.tileSize-.5;for(;a<r;){for(s=e.top;s<=u;)t=a%o,c.push([t,s,i,n?pd(h-a)+pd(p-s):0]),s++;a++}return c}function cj(t,e){return e[3]-t[3]}function dj(t,e){dj.g.constructor.call(this,t,e)}t("H.map.Style",th),th.State=ah,u($i,N),t("H.map.Overlay",$i),$i.prototype.type=Yf.OVERLAY,$i.prototype.C=function(){return this.J},$i.prototype.getBoundingBox=$i.prototype.C,$i.prototype.si=function(t){return B(t,I,this.si,0,t),this.X(t)},$i.prototype.setBoundingBox=$i.prototype.si,$i.prototype.V=function(){return this.J},$i.prototype.getGeometry=$i.prototype.V,$i.prototype.X=function(t){var e=this.J,r=!e;return B(t,I,this.X,0,t),!r&&e.da(t)||(this.J=t,r||this.ra(Lf.SPATIAL)),this},$i.prototype.setGeometry=$i.prototype.X,$i.prototype.Te=function(){return this.gb.getData()},$i.prototype.getBitmap=$i.prototype.Te,$i.prototype.Sw=function(t,e){var r=this.gb;return r&&1!==r.getState()&&r.cancel(),this.gb=new Uh(t,this.Wg,!0,A,e),this},$i.prototype.setBitmap=$i.prototype.Sw,$i.prototype.Wg=function(t,e){this.gb=e,1===t&&this.ra(Lf.VISUAL)},$i.prototype.Ve=function(){return this.Sc},$i.prototype.getOpacity=$i.prototype.Ve,$i.prototype.Fd=function(t){var e=this.Sc,r=2>e;if(!(0<=(t-=0)&&1>=t))throw new C(this.Fd,0);return t!==e&&(this.Sc=t,r&&this.ra(Lf.VISUAL)),this},$i.prototype.setOpacity=$i.prototype.Fd,$i.prototype.P=function(){var t=$i.g.P.call(this);return t.geometry=Af(this.J).P(),t.properties.overlay=!0,t},$i.prototype.forWorkerMessage=$i.prototype.P,u(aj,Nh),t("H.map.layer.BaseTileLayer",aj),aj.prototype.Bj=function(t,e){var r=this.pixelProjection;if(!B(t,I))throw new C(this.Bj,0,t);if(!D(e)){var i=r.xu();r.Va(e)}return t=jg(r.Gb(t.Oc()),r.Gb(t.Mc())),!D(i)&&r.Va(i),t},aj.prototype.geoRectToRect=aj.prototype.Bj,aj.prototype.Fh=function(t,e){var r=sd(2,nd(e)),i=this.tileSize;if(!B(t,ig))throw new C(this.Fh,0,t);if(D(e=+e))throw new C(this.Fh,1,e);(e=nd(t.left/i))===r&&--e;var n=nd(t.right/i);return n===r&&--n,new ig(e,Nd(nd(t.top/i),0,r-1),n,Nd(nd(t.bottom/i),0,r-1))},aj.prototype.getTileBounds=aj.prototype.Fh,aj.prototype.Pa=function(t,e,r,i){return this.D.requestTile(t,e,r,i)},aj.prototype.requestTile=aj.prototype.Pa,aj.prototype.Nd=function(t,e,r){this.D.cancelTile(t,e,r)},aj.prototype.cancelTile=aj.prototype.Nd,aj.prototype.U=function(t,e){return this.D.getCopyrights?this.D.getCopyrights(t,e):null},aj.prototype.getCopyrights=aj.prototype.U,aj.prototype.Oj=function(t,e,r,i,n,o){var a,s,l=[],u=this.D;o=null!=o?o:"__default__";var c=u.requestTile;if(!B(t,ig))throw new C(this.Oj,0,t);if(D(r=+r))throw new C(this.Oj,1,r);if(i||(a={}),t=(e=bj(this,t,e,r,n)).length)for(i||e.sort(cj),r=t;r--;)n=e[r],i||(a[u.Vd.apply(u,n)]=!0),n[3]=+i,(s=c.apply(u,n))&&l.push(s);if(!i){var h;for(h in i=a,a=this.tx[o]||{})a.hasOwnProperty(h)&&a[h]&&!i[h]&&this.D.cancelTileByKey(h);this.tx[o]=i}return{total:t,tiles:l}},aj.prototype.getProviderTiles=aj.prototype.Oj,u(dj,aj),t("H.map.layer.MarkerTileLayer",dj);var ej={markers:[],total:0,requested:0};function fj(t,e,r,i,n){var o,a=nd(r);for(t.pixelProjection.Va(a),e=t.Fh(t.Bj(e),a),r=t.Oj(e,e.left>e.right,~~r,i,n),t=r.tiles,r=r.total,i=t.length,n=[],o=0;o<i;o++)for(a=(e=t[o]).data.length;a--;)n.push(e.data[a]);return{markers:n,total:t.length,requested:r}}function gj(t,e,r,i){this.key="",this.x=t,this.y=e,this.z=r,this.data=i,this.valid=!0}function hj(t){if(bb(this,hj),hj.g.constructor.call(this,t),t&&"tileSize"in t){var e=qd(+t.tileSize)/Ad;if(isNaN(e)||e%1||0>e||30<e)throw new C(hj,0,"tileSize: "+t.tileSize);this.tileSize=+t.tileSize}}function ij(t,e){return Kd(t)-8-md(Kd(e))}function jj(){}function kj(t,e,r){if(this.mk=[],e&&this.fi(e),r&&!Za(r))throw new C(kj,2,r);this.Oe=0,this.filter=r,this.aa={},this.ak=this.ph=null,this.Sr(t)}function mj(t,e){return e&&(t.ph=nj(t,e,t.ph)),e}function oj(t){for(;t.Oe>t.wv&&t.ak;)t.pf(t.ak,!0)}function nj(t,e,r){return r!==e&&((e.Ad||e.mf)&&t.pf(e,!1),(e.Ad=r)&&(e.mf=r.mf,r.mf=e),e.mf||(t.ph=e),e.Ad||(t.ak=e),t.Oe+=e.size),e}function lj(t,e){for(var r=t.mk.length;r--;)t.mk[r].call(t,e.id,e.data,e.size)}function R(t){bb(this,R),R.g.constructor.call(this,t),this.pD=new pj,this.cc=z(this.cc,this),this.jt=qj,this.createTileInternal=this.pd.bind(this)}dj.prototype.qe=function(t,e,r,i){return this.D.providesDomMarkers()?ej:fj(this,t,e,r,i)},dj.prototype.requestMarkers=dj.prototype.qe,dj.prototype.pe=function(t,e,r,i){return this.D.providesDomMarkers()?fj(this,t,e,r,i):ej},dj.prototype.requestDomMarkers=dj.prototype.pe,t("H.map.provider.Tile",gj),u(hj,Q),t("H.map.provider.TileProvider",hj),hj.getZoomLevelOffset=ij,hj.prototype.requestTile=hj.prototype.Pa,hj.prototype.cancelTile=hj.prototype.Nd,hj.prototype.cancelTileByKey=hj.prototype.Xi,hj.prototype.createTileInternal=hj.prototype.pd,hj.prototype.Vd=function(t,e,r){return this.uri.concat("_",t,"_",e,"_",r)},hj.prototype.getTileKey=hj.prototype.Vd,hj.prototype.tileSize=256,hj.prototype.tileSize=hj.prototype.tileSize,t("H.util.ICache",jj),jj.prototype.add=function(){},jj.prototype.add=jj.prototype.add,jj.prototype.get=function(){},jj.prototype.get=jj.prototype.get,jj.prototype.cm=function(){},jj.prototype.drop=jj.prototype.cm,jj.prototype.forEach=function(){},jj.prototype.forEach=jj.prototype.forEach,jj.prototype.ia=function(){},jj.prototype.removeAll=jj.prototype.ia,jj.prototype.fi=function(){},jj.prototype.registerOnDrop=jj.prototype.fi,jj.prototype.gp=function(){},jj.prototype.deRegisterOnDrop=jj.prototype.gp,t("H.util.Cache",kj),kj.prototype.add=function(t,e,r){var i,n;if(!jb(r=+r)||0>r)throw new C(this.add,2,r);return t=String(t),(n=!this.filter||this.filter(t,e,r))&&((i=this.aa[t])?(i.data!==e&&lj(this,i),this.Oe+=r-i.size,i.size=r,i.data=e,mj(this,i)):this.aa[t]=nj(this,{id:t,data:e,size:r,Ad:null,mf:null},this.ph),oj(this)),n},kj.prototype.add=kj.prototype.add,kj.prototype.fi=function(t){if(!Za(t))throw new C(this.fi,0,t);this.mk.push(t)},kj.prototype.registerOnDrop=kj.prototype.fi,kj.prototype.gp=function(t){this.mk=this.mk.filter((function(e){return e!==t}))},kj.prototype.deRegisterOnDrop=kj.prototype.gp,kj.prototype.get=function(t,e){return(t=e?this.aa[t]:mj(this,this.aa[t]))&&t.data},kj.prototype.get=kj.prototype.get,kj.prototype.cm=function(t){var e;(e=this.aa[t])&&this.pf(e,!0)},kj.prototype.drop=kj.prototype.cm,kj.prototype.forEach=function(t,e,r){var i;for(i in this.aa){var n=this.aa[i];(!r||r(i,n.data,n.size))&&t.call(e,i,n.data,n.size)}},kj.prototype.forEach=kj.prototype.forEach,kj.prototype.ia=function(t){var e;for(e in this.aa){var r=this.aa[e];(!t||t(e,r.data,r.size))&&this.pf(this.aa[e],!0)}},kj.prototype.removeAll=kj.prototype.ia,kj.prototype.Sr=function(t){if(!(0<+t))throw new C(kj.prototype.Sr,0,t);return this.wv=+t,oj(this),this},kj.prototype.setMaxSize=kj.prototype.Sr,kj.prototype.iA=function(){return this.wv},kj.prototype.getMaxSize=kj.prototype.iA,kj.prototype.Fz=function(){return this.Oe},kj.prototype.getCurrentSize=kj.prototype.Fz,kj.prototype.pf=function(t,e){var r=t.mf,i=t.Ad;return(r||i||t==this.ph&&t==this.ak)&&(r?r.Ad=i:this.ph=i,i?i.mf=r:this.ak=r,this.Oe-=t.size,e&&(delete this.aa[t.id],lj(this,t))),t.Ad=t.mf=null,t},u(R,hj),t("H.map.provider.RemoteTileProvider",R),R.prototype.Mz=function(){return 1},R.prototype.getEntryWeight=R.prototype.Mz;var qj,rj=screen.width,sj=screen.height,tj=Vd();tj=ld(tj,1);var uj=od(rj*tj*sj*tj/1e6);qj=new kj(sd(2,ld(8,kd(12,7+uj))));var vj={},wj={};function yj(t,e,r,i,n,o){return i=~~i,t.requestInternal(e,r,i,(function(a,s){t.td().put(t.Vd(e,r,i),{raw:s&&s.raw||a,timestamp:globalThis.Date.now()},n,o)}),o,0)}function zj(t){delete vj[t],delete wj[t]}function xj(t){for(var e in vj)t.cc(e)&&t.cancelTileByKey(e)}R.prototype.Sb=function(){return this.jt},R.prototype.getCache=R.prototype.Sb,R.prototype.Yn=ca(3),R.prototype.cc=function(t){var e=this.uri;return!t.indexOf(e)&&"_"===t.charAt(e.length)},R.prototype.cacheFilter=R.prototype.cc,R.prototype.cB=function(t,e){e.valid=!1},R.prototype.reload=function(t){var e=this.getCache();t?e.ia(this.cc):e.forEach(this.cB,this,this.cc),xj(this),this.jb(this,{isReload:!0})},R.prototype.reload=R.prototype.reload,R.prototype.Vi=function(){return!1},R.prototype.MAX_STORE_TIME=1/0,R.prototype.td=function(){return this.pD},R.prototype.pw=function(t,e){e(t)},R.prototype.requestInternal=R.prototype.o,R.prototype.Pa=function(t,e,r,i){var n=this,o=this.getCache();if(D(t=+t))throw new C(this.Pa,0,t);if(D(e=+e))throw new C(this.Pa,0,e);if(D(r=+r))throw new C(this.Pa,0,r);r=~~r;var a=this.getTileKey(t,e,r);return(o=o.get(a))&&o.valid||i||vj[a]||(o=A,this.requestTileAsPromise(t,e,r,i).then((function(t){n.jb(t)}),ie)),o},R.prototype.requestTile=R.prototype.Pa,R.prototype.Hw=function(t,e,r,i){var n,o,a=this,s=this.getCache(),l=this.getTileKey(t,e,r),u=this.td();return wj[l]?wj[l]:(wj[l]=n=new Vb((function(n,c){function h(o){var h,p=0,f=function(i,o){(h=a.createTileInternal(t,e,r,i,o)).key=l,s.add(l,h,1),n(h),zj(l)};o&&(p=globalThis.Date.now()-o.timestamp),o&&p<a.MAX_STORE_TIME?a.pw(o.raw,f):(0<p&&u.remove(l),(h=s.get(l))&&h.valid||i?n(h||null):vj[l]=a.requestInternal(t,e,r,f,c))}o=u.get(l,h,h)})),vj[l]||(vj[l]=o),n.then((function(){zj(l)}),(function(){zj(l)})),n)},R.prototype.requestTileAsPromise=R.prototype.Hw,R.prototype.Gw=function(t,e){var r=this,i=t.id,n=t.tile.coords;return new Vb((function(t,o){r.Hw(n.x,n.y,n.z,e).then((function(e){for(var r,n=x,o=(e=e.bb?e.bb():e.data).length;o--;)if((r=e[o]).xb()===i){n=r;break}t(n)}),o)}))},R.prototype.requestObjectAsPromise=R.prototype.Gw;var Aj={cancel:ie};function pj(){}function Bj(t,e){Za(t)&&(this.Uv=t),jb(e)&&(this.ml=e)}R.prototype.pd=function(t,e,r,i){return new gj(t,e,r,i)},R.prototype.createTileInternal=R.prototype.pd,R.prototype.Xi=function(t){var e=vj[t];e&&(e.cancel(),zj(t))},R.prototype.cancelTileByKey=R.prototype.Xi,R.prototype.Nd=function(t,e,r){this.cancelTileByKey(this.getTileKey(t,e,r))},R.prototype.cancelTile=R.prototype.Nd,R.prototype.disposeInternal=function(){R.g.disposeInternal.call(this),this.getCache().ia(this.cc),xj(this)},R.NullStorage=pj,pj.prototype.get=function(t,e){return e(),Aj},pj.prototype.get=pj.prototype.get,pj.prototype.put=function(t,e,r){r&&r()},pj.prototype.put=pj.prototype.put,pj.prototype.clear=function(t){t&&t()},pj.prototype.clear=pj.prototype.clear,pj.prototype.remove=function(t,e){e&&e()},pj.prototype.remove=pj.prototype.remove,t("H.util.Request",Bj),Bj.State={PENDING:0,PROCESSING:1,COMPLETE:2,CANCELLED:3,ERROR:4};var Cj=[0,1,2,3,4];function Dj(t,e){t.Bn<t.ml&&(ab(e)||(e=2),0===e||1===e||0!==t.s&&1!==t.s||(t.Bn++,2!==e&&t.Vt++,t.F(t.Bn<t.ml?1:2)))}function Ej(t,e,r,i,n,o){var a;for(a=[];i<=n;i++){var s=a.concat,l=t,u=r,c=nd(i);l.pixelProjection.Va(c);var h=l.Bj(u);u=l.Fh(h,c),c=bj(l,u,h.left>h.right,c),a=s.call(a,c)}for(t=a.length,Bj.call(this,o,t),this.kx=r=[],this.Zq=z(this.Zq,this),this.Yq=z(this.Yq,this),this.F(1);t--;)o=a[t],r.push(yj(e,o[0],o[1],o[2],this.Zq,this.Yq))}function Fj(t,e,r,i){Fj.g.constructor.call(this,t,e,r),this.modifiers=i}Bj.prototype.s=0,Bj.prototype.getState=function(){return this.s},Bj.prototype.getState=Bj.prototype.getState,Bj.prototype.F=function(t){if(0>Cj.indexOf(t))throw new C(this.F,0,t);(this.s!==t||1===t&&1<this.ml)&&(this.s=t,this.Uv&&this.Uv(this))},Bj.prototype.ml=1,Bj.prototype.KA=function(){return this.ml},Bj.prototype.getTotal=Bj.prototype.KA,Bj.prototype.Bn=0,Bj.prototype.vA=function(){return this.Bn},Bj.prototype.getProcessed=Bj.prototype.vA,Bj.prototype.Vt=0,Bj.prototype.Pz=function(){return this.Vt},Bj.prototype.getFailed=Bj.prototype.Pz,Bj.prototype.Wi=function(){},Bj.prototype.cancel=function(){3!==this.s&&(this.Wi(),this.F(3))},Bj.prototype.cancel=Bj.prototype.cancel,u(Ej,Bj),Ej.prototype.Zq=function(){Dj(this,2)},Ej.prototype.Yq=function(){Dj(this,4)},Ej.prototype.Wi=function(){for(var t=this.kx,e=t.length;e--;)t[e].cancel();delete this.kx},u(Fj,wg),t("H.map.ChangeEvent",Fj);var Gj={SIZE:1,POSITION:2,HEADING:4,TILT:8,INCLINE:16,ZOOM:32,BOUNDS:64},Lj;function Hj(){}function Ij(t,e){var r=t.B(),i=r.ownerDocument;Ij.g.constructor.call(this),this.v=t,this.G=r=r.appendChild(Jj(i,"DIV","position:absolute;bottom:0;right:0;left:0px;z-index:1;direction:ltr;pointer-events:none;height:40px-webkit-touch-callout: none;-webkit-user-select:none;-khtml-user-select: none;-moz-user-select: none;-ms-user-select: none;user-select:none;",null,"H_imprint")),this.Gl=Jj(i,"DIV","margin: 0 0 16px 16px;display:inline-block;",'<svg height="40" viewBox="0 0 47 40" width="47" xmlns="http://www.w3.org/2000/svg"><g fill="none" fill-rule="evenodd"><path d="m45.2054149 8.82876345.6003191.40637037-.2240425.6914074-.4490426 1.38570368c-.1024468.3148889-.6998936 1.9596297-2.43 3.5918519l-.017234.0163704c-.188617.1887407-.3801064.3659259-.5467021.5084444l-.4605319.4285185-.486383.4516296-.1407447-.0702963c-.7257447.4583704-1.4926596.7886667-2.2796809.9831852l.5840426.5864445-.6769149.6817778-2.052766 2.0636296-.169468.1704444-.019149.0192593-2.3821276 2.3958518c-.4902128.8493334-1.1202128 1.6331852-1.8497873 2.3111112-.6031915.6047407-1.2504255 1.1054814-1.935 1.4954814l-.4777659.4805186-4.3247873 4.3506666-.0296808.0298519-.0315958.0269629-2.1532978 1.8171111-.2661702.2253334h-.3485107-3.8948936l-3.968617 3.9914815-1.3547873 1.3616296-.6769148.6808148-.6769149-.6808148-1.3538298-1.3616296-4.80925535-4.837926-3.2687234-3.2875555-1.63436171-1.6437778h2.3112766 4.62255319 2.67223407l-4.71063832-4.7368148-.6769149-.6808148.6769149-.6808148 4.93851062-4.9650371.6769149-.6798518.6769149.6808148 2.7296809 2.7454074c.9363829-.8820741 2.1485106-1.4685185 3.4037234-1.6562963.278617-1.4694815 1.0187234-2.834963 2.168617-3.9885926.5696808-.572 1.1843617-1.0438519 1.8335106-1.4107407l.2901064-.2917778 4.3094681-4.31985187c.5830851-1.0582963 1.4256383-1.78918519 2.0364893-2.12718519l.4471277-.24748148c.3829787-.7617037.9047872-1.47622222 1.5539362-2.12622222 1.510851-1.51666667 3.3165957-2.31881482 5.22-2.31881482.0871276 0 .1752127.00192593.2594681.00577778 1.9484042.06933334 3.8441489.97933334 5.4775532 2.62792593.1512765.15022222.3303191.34859259.5361702.5797037l.0526595.05874074c.1120213.12518519.2345745.26192593.370532.40733334l1.2657446 1.36066666.6328724.67985185-.6548936.65866667-.2508511.25325926zm-27.9288192 22.17414815h-9.57446804l4.78723404 4.8148148zm23.1864894-21.70422223c-.9220213 1.38666663-2.5180851 3.63037033-4.1984042 1.94133333l4.2510638-4.27651851c-.3810638-.41022222-.6711702-.754-.8923404-.97740741-2.2921277-2.31207407-4.8743617-2.34192593-6.8984043-.312-1.3528723 1.35681481-1.7071277 2.91007407-1.313617 4.38533332l-1.332766-1.52629628c-.385851.21474074-2.0182979 1.65918518-.7937234 3.84703708l-1.5252127-1.274963-2.0240426 2.0299259 2.7344681 2.7502222c-2.1121277-1.6861481-4.3889362-1.5205185-6.2157447.312-1.9560638 1.9615556-1.8181915 4.3381482-.3532979 6.293926l-.295851-.2946667c-1.9321277-1.9432593-4.0318085-1.2576296-5.0706383-.2128148-.8023405.8079259-1.2944681 1.9191852-1.0924468 2.6905185l-4.195532-4.2187407-2.22893613 2.2408148 8.25893613 8.3065185h4.4339362l-2.9767021-2.9938519c-.5893908-.6029568-.9604155-1.0987731-1.1531529-1.5232627-.3182349-.7008886-.1504161-1.2073234.3230465-1.680515.7334043-.7318519 1.583617-.2763704 3.0829787 1.2277777l2.9412766 2.9562963 2.2164894-2.2292592-2.7909575-2.8060741c2.0125532 1.5291852 4.4224468 1.612 6.5728724-.545037 1.3567021-1.2653334 1.7425532-2.4565185 1.7425532-2.4565185l-1.6755319-1.1314815c-.9229788 1.3866666-2.5152128 3.6361481-4.195532 1.9461481l4.2606383-4.2851852 2.655 2.6712593 2.3160639-2.3294074-3.3223405-3.3424445c-1.5520212-1.5609629-.6328723-3.0275555.0124469-3.5793333.3025531.6442222.7448936 1.2624445 1.3078723 1.8296296 2.1485106 2.1676297 4.9260638 2.6038519 7.3685106.1550371 1.3567022-1.2643704 1.7425532-2.4565185 1.7425532-2.4565185zm-3.6564894-1.35537321-2.0211702 2.03377777c-.9890425-1.18251851-.9392553-1.81422222-.3245744-2.43051851.7439361-.7462963 1.4993617-.43044445 2.3457446.39674074zm-12.4879787 12.56088884c-.9890425-1.1825185-.9411702-1.819037-.3284042-2.4353333.7448936-.7462963 1.5003191-.4304444 2.3467021.3967408z" fill="#0f1621" fill-opacity=".7"/><path d="m17.2765957 31.0029116-4.787234 4.8148148-4.78723404-4.8148148zm23.1864894-21.70422223 1.6755319 1.13148153s-.385851 1.1921481-1.7425532 2.4565185c-2.4424468 2.4488148-5.22 2.0125926-7.3685106-.1550371-.5629787-.5671851-1.0053192-1.1854074-1.3078723-1.8296296-.6453192.5517778-1.5644681 2.0183704-.0124469 3.5793333l3.3223405 3.3424445-2.3160639 2.3294074-2.655-2.6712593-4.2606383 4.2851852c1.6803192 1.69 3.2725532-.5594815 4.195532-1.9461481l1.6755319 1.1314815s-.3858511 1.1911851-1.7425532 2.4565185c-2.1504256 2.157037-4.5603192 2.0742222-6.5728724.545037l2.7909575 2.8060741-2.2164894 2.2292592-2.9412766-2.9562963c-1.4993617-1.5041481-2.3495744-1.9596296-3.0829787-1.2277777-.4734626.4731916-.6412814.9796264-.3230465 1.680515.1927374.4244896.5637621.9203059 1.1531529 1.5232627l2.9767021 2.9938519h-4.4339362l-8.25893613-8.3065185 2.22893613-2.2408148 4.195532 4.2187407c-.2020213-.7713333.2901063-1.8825926 1.0924468-2.6905185 1.0388298-1.0448148 3.1385106-1.7304445 5.0706383.2128148l.295851.2946667c-1.4648936-1.9557778-1.6027659-4.3323704.3532979-6.293926 1.8268085-1.8325185 4.103617-1.9981481 6.2157447-.312l-2.7344681-2.7502222 2.0240426-2.0299259 1.5252127 1.274963c-1.2245745-2.1878519.4078724-3.63229634.7937234-3.84703708l1.332766 1.52629628c-.3935107-1.47525925-.0392553-3.02851851 1.313617-4.38533332 2.0240426-2.02992593 4.6062766-2.00007407 6.8984043.312.2211702.22340741.5112766.56718519.8923404.97740741l-4.2510638 4.27651851c1.6803191 1.689037 3.2763829-.5546667 4.1984042-1.94133333zm-16.1444681 11.20551563 2.0182979-2.0385925c-.846383-.8271852-1.6018085-1.1430371-2.3467021-.3967408-.612766.6162963-.6606383 1.2528148.3284042 2.4353333zm12.4879787-12.56088884c-.8463829-.82718519-1.6018085-1.14303704-2.3457446-.39674074-.6146809.61629629-.6644681 1.248.3245744 2.43051851z" fill="#fff" fill-opacity=".3"/></g></svg>',"H_logo"),r.appendChild(this.Gl),r=r.appendChild(Jj(i,"DIV","right:0;bottom:0;position:absolute;background-color:rgba(255,255,255,.8);color:#0F1621;padding:2px 16px",null,"H_copyright")),this.ho=r.appendChild(Jj(i,"A","color:inherit; margin:0px 8px; text-decoration:none; pointer-events:all;","Terms of use")),this.ho.target="_blank",this.ho.tabIndex=1,this.Ul=r.appendChild(Jj(i,"SPAN","margin:0px 8px")),this.dg=r.appendChild(Jj(i,"SPAN")),this.cv=Qa(Kj),this.Ur(e),this.Di=z(this.Di,this),this.ge=z(this.ge,this),this.v.addEventListener(this.v.j.Os,this.Di),this.v.O.addEventListener("add",this.ge),this.v.O.addEventListener("remove",this.ge),this.v.O.addEventListener("set",this.ge),this.ge()}Fj.Type=Gj,Fj.prototype.dy=Gj.SIZE,Fj.prototype.SIZE=Fj.prototype.dy,Fj.prototype.Ss=Gj.POSITION,Fj.prototype.POSITION=Fj.prototype.Ss,Fj.prototype.Ks=Gj.HEADING,Fj.prototype.HEADING=Fj.prototype.Ks,Fj.prototype.Vs=Gj.TILT,Fj.prototype.TILT=Fj.prototype.Vs,Fj.prototype.Ls=Gj.INCLINE,Fj.prototype.INCLINE=Fj.prototype.Ls,Fj.prototype.Ws=Gj.ZOOM,Fj.prototype.ZOOM=Fj.prototype.Ws,Fj.prototype.Es=Gj.BOUNDS,Fj.prototype.BOUNDS=Fj.prototype.Es,t("H.util.ICapturable",Hj),Hj.prototype.capture=function(){},Hj.prototype.capture=Hj.prototype.capture,u(Ij,Ac),t("H.map.Imprint",Ij);var Kj={font:'11px "Lucida Grande", Arial, Helvetica, sans-serif',href:"https://legal.here.com/{LN}/terms/serviceterms/{CN}",invert:!1,reportHref:"https://wego.here.com/",locale:"en-US",mark:""};function Jj(t,e,r,i,n){return t=t.createElement(e),r&&(t.style.cssText=r),i&&(t.innerHTML=i),n&&(t.className=n),t}Ij.prototype.Ur=function(t){var e,r=this.Gl.firstElementChild.firstElementChild.children;t||(this.cv=Qa(Kj));var i=this.cv;for(e in i)t&&e in t&&(i[e]=t[e]);t=(this.oq=t=i.invert)?Mj:Nj,r[0].style.fill=t.bx,r[0].style.fillOpacity=""+t.cx,r[1].style.fill=t.px,r[1].style.fillOpacity=""+t.qx,t=i.locale,Oj[t]||(t="en-US",i.locale=t),this.ho.innerHTML=Oj[t],t=t.split("-"),this.ho.href=i.href.replace("{LN}",t[0]).replace("{CN}",t[1].toLowerCase()),i.mark?(this.dg.innerHTML=i.mark,this.dg.style.margin="0px 8px"):(this.dg.innerHTML="",this.dg.style.margin="0px"),this.G.style.font=i.font},Ij.prototype.setOptions=Ij.prototype.Ur,Ij.prototype.B=function(){return this.G},Ij.prototype.Di=function(){this.Ul.innerHTML=this.Gs+" "+this.U()},Ij.prototype.ge=function(){this.Di(),setTimeout(this.Di,5e3)};var Nj={px:"#0F1621",qx:.3,bx:"#fff",cx:.6},Mj={px:"#fff",qx:1,bx:"#0F1621",cx:.7},Pj="1987&ndash;"+ld(2015,(new Date).getFullYear())+" HERE";function Qj(t,e,r,i){Rj(z((function(t){t?this.oq?r("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACgAAAAeCAYAAABe3VzdAAADNklEQVRYR82XW6hVVRSGv7+rmJfSMKSnSkMEfY7EogcJC7tilGRopBAiSaI+SBARQSCIIqgFISih2YW0oAgLCsKXojA0RB+81VugZEFZv/yHuWTt7d7Hfc4+6+h4OWefNfcc3xlj/v+YS1zjoab5bE8DZgGngB8keSg5GwO0PQ54F3i2BnQIWCLpx14hGwG0fT3wOfBwB5DzwOOSDvQC2RTgM8Ae4D/gaeA3YDdwN5AWvyxp+6gD2r4OmAq8AbwInAMmA/OAT4CbgBWStvYClzUjWkHbrwHLgF8LVHJ8DDxah7P9JHCil7M40oA/A7OBC8ANtSqlrQOVs30/8CWQat8r6cxg1RwRQNvPA88Bk4D7gJzBV4A5teSp5MlS4VuA/ZIeu1Kr+wa0/QTwIRDlRhT5eTswBvi2CKOd42AULilndNAYCcA7gK+BmbVMiyXtsh3Qt4FFBTgW8w6wXtLfV4LrSyS2FwAvAWOBX+JtwF0laUDmS/oun23fDNwJnJb0Ty9g1ZphVdB2qrK2LdFfBbb685/AIxXkUKDqa4cMaDs2kjalRe8Fola57J3qRQSJviGHA3gMuAdYI2lDUfDOArQLWAd8VTuTOW9vjUoFy6TIGYpS9wKfAjuK5wVuSfn91iKcvZJeHy5ci0hsZwzNk5Qh3xIFbLyks7aPAtPLgv+L4VZwDwLvA6uKz6XdfcVAi22PBz4q4+lVSRurXW2vKYKIZfwEHCmmXC35HngAyITYD0ys2t8XWflyBfhmvKm24QCk7aVFCPVc7WMszzKucknI+NoHPCUppt13VICZm2nNwjoksByY0SXL72Vi3FieZ97mgrpyqF432H9xScW2O0H+W6oSE/4D2FYuA9kzlUzVTwO3Ad9IOtx3ydo2aLGZLpABm5KW2Z4AfAbMLfsEcpGkKLqRuMwHu0CukrSpCCrvGlF6hBEVL5MUw24kOhp1B8gc+FTqgxpkFLuzSbjk6jpJOkC2tDPeKCkVbDRkO67fDTTC2VK7vgfyBUlfNEpV2zyAK4HNXRLmZfshScdHC6g9T+WDGU2XpkdZdNXhWs6g7dXAhmsJ7jKR2M77bG4kV7Wt9TZfBLgYEC7PSpcIAAAAAElFTkSuQmCC"):r("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACgAAAAeCAYAAABe3VzdAAAABHNCSVQICAgIfAhkiAAAAAlwSFlzAAAOxAAADsQBlSsOGwAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAIMSURBVFiFzdZPiE1RGADwXzPTTPIMQoodVpbKgpoUG5qExUi8DSVJQv4slJJsbNjYWFhNETWLUUosRDRLUVLCYhIiojFojHkW997uvefNGIuZc99Xp/fOO6/Or++c75xDi0d7hDlWYQNqeB9hvv+OGq6jUWjPsKZKVBbtuKOMy9p3bKqOlsROCWYc27AWr9PfJnCgKlgbluNqivmGDmzBrxR3sCocnMEw7sqXdEAzboeK9uLTFPVbed8VcesxglFJtqNEHbcxlIL68ChADuCSpEgauBULt11SDI3C5yJJdrLCCNsQumMBl+J5AKinY4slBfNTfsRcxJwYsK0YxD3J0r1RPut6Cv/twgp0xoDBBc3LNhr0RwJktNifAn7gsnLmsuxVinyVTn4i7dcLoH4sU96Tp2Pi2uSVehN75Gdev+QO7pIXztmZnLwTvf+AzU+/v5Rn50+A24gP2IW5M4mbJ7+ejgVjJ/EpHXuCa8p77nGK68FX5eWfsTgfTJoh92qu1vAaa+CtPJuDZuEh3CHZUyHyxSSYrL3DWKE/gStm8aybDDkmKYperJM/BrJMnsJuHMLq2YJNh/wsX7JuPAyQfTFg0yGPFMZreCCv4n2xgTQjxyXP+CxquK8iXBYhMlzOtliQBVg4RVuCG/iSto/YHAuWxWFTHyXDWBkbNFkc1cK4LI5rYVwW57QY7i/pZeJv8QQJRQAAAABJRU5ErkJggg=="):((t=this.Gl.cloneNode(!0)).firstChild.setAttribute("style","font:"+e),r(ce(t.innerHTML)))}),t),i)}function Rj(t,e){var r="data:image/svg+xml;charset=utf-8,"+encodeURIComponent('<svg height="40" viewBox="0 0 47 40" width="47" xmlns="http://www.w3.org/2000/svg"><g fill="none" fill-rule="evenodd"><path d="m45.2054149 8.82876345.6003191.40637037-.2240425.6914074-.4490426 1.38570368c-.1024468.3148889-.6998936 1.9596297-2.43 3.5918519l-.017234.0163704c-.188617.1887407-.3801064.3659259-.5467021.5084444l-.4605319.4285185-.486383.4516296-.1407447-.0702963c-.7257447.4583704-1.4926596.7886667-2.2796809.9831852l.5840426.5864445-.6769149.6817778-2.052766 2.0636296-.169468.1704444-.019149.0192593-2.3821276 2.3958518c-.4902128.8493334-1.1202128 1.6331852-1.8497873 2.3111112-.6031915.6047407-1.2504255 1.1054814-1.935 1.4954814l-.4777659.4805186-4.3247873 4.3506666-.0296808.0298519-.0315958.0269629-2.1532978 1.8171111-.2661702.2253334h-.3485107-3.8948936l-3.968617 3.9914815-1.3547873 1.3616296-.6769148.6808148-.6769149-.6808148-1.3538298-1.3616296-4.80925535-4.837926-3.2687234-3.2875555-1.63436171-1.6437778h2.3112766 4.62255319 2.67223407l-4.71063832-4.7368148-.6769149-.6808148.6769149-.6808148 4.93851062-4.9650371.6769149-.6798518.6769149.6808148 2.7296809 2.7454074c.9363829-.8820741 2.1485106-1.4685185 3.4037234-1.6562963.278617-1.4694815 1.0187234-2.834963 2.168617-3.9885926.5696808-.572 1.1843617-1.0438519 1.8335106-1.4107407l.2901064-.2917778 4.3094681-4.31985187c.5830851-1.0582963 1.4256383-1.78918519 2.0364893-2.12718519l.4471277-.24748148c.3829787-.7617037.9047872-1.47622222 1.5539362-2.12622222 1.510851-1.51666667 3.3165957-2.31881482 5.22-2.31881482.0871276 0 .1752127.00192593.2594681.00577778 1.9484042.06933334 3.8441489.97933334 5.4775532 2.62792593.1512765.15022222.3303191.34859259.5361702.5797037l.0526595.05874074c.1120213.12518519.2345745.26192593.370532.40733334l1.2657446 1.36066666.6328724.67985185-.6548936.65866667-.2508511.25325926zm-27.9288192 22.17414815h-9.57446804l4.78723404 4.8148148zm23.1864894-21.70422223c-.9220213 1.38666663-2.5180851 3.63037033-4.1984042 1.94133333l4.2510638-4.27651851c-.3810638-.41022222-.6711702-.754-.8923404-.97740741-2.2921277-2.31207407-4.8743617-2.34192593-6.8984043-.312-1.3528723 1.35681481-1.7071277 2.91007407-1.313617 4.38533332l-1.332766-1.52629628c-.385851.21474074-2.0182979 1.65918518-.7937234 3.84703708l-1.5252127-1.274963-2.0240426 2.0299259 2.7344681 2.7502222c-2.1121277-1.6861481-4.3889362-1.5205185-6.2157447.312-1.9560638 1.9615556-1.8181915 4.3381482-.3532979 6.293926l-.295851-.2946667c-1.9321277-1.9432593-4.0318085-1.2576296-5.0706383-.2128148-.8023405.8079259-1.2944681 1.9191852-1.0924468 2.6905185l-4.195532-4.2187407-2.22893613 2.2408148 8.25893613 8.3065185h4.4339362l-2.9767021-2.9938519c-.5893908-.6029568-.9604155-1.0987731-1.1531529-1.5232627-.3182349-.7008886-.1504161-1.2073234.3230465-1.680515.7334043-.7318519 1.583617-.2763704 3.0829787 1.2277777l2.9412766 2.9562963 2.2164894-2.2292592-2.7909575-2.8060741c2.0125532 1.5291852 4.4224468 1.612 6.5728724-.545037 1.3567021-1.2653334 1.7425532-2.4565185 1.7425532-2.4565185l-1.6755319-1.1314815c-.9229788 1.3866666-2.5152128 3.6361481-4.195532 1.9461481l4.2606383-4.2851852 2.655 2.6712593 2.3160639-2.3294074-3.3223405-3.3424445c-1.5520212-1.5609629-.6328723-3.0275555.0124469-3.5793333.3025531.6442222.7448936 1.2624445 1.3078723 1.8296296 2.1485106 2.1676297 4.9260638 2.6038519 7.3685106.1550371 1.3567022-1.2643704 1.7425532-2.4565185 1.7425532-2.4565185zm-3.6564894-1.35537321-2.0211702 2.03377777c-.9890425-1.18251851-.9392553-1.81422222-.3245744-2.43051851.7439361-.7462963 1.4993617-.43044445 2.3457446.39674074zm-12.4879787 12.56088884c-.9890425-1.1825185-.9411702-1.819037-.3284042-2.4353333.7448936-.7462963 1.5003191-.4304444 2.3467021.3967408z" fill="#0f1621" fill-opacity=".7"/><path d="m17.2765957 31.0029116-4.787234 4.8148148-4.78723404-4.8148148zm23.1864894-21.70422223 1.6755319 1.13148153s-.385851 1.1921481-1.7425532 2.4565185c-2.4424468 2.4488148-5.22 2.0125926-7.3685106-.1550371-.5629787-.5671851-1.0053192-1.1854074-1.3078723-1.8296296-.6453192.5517778-1.5644681 2.0183704-.0124469 3.5793333l3.3223405 3.3424445-2.3160639 2.3294074-2.655-2.6712593-4.2606383 4.2851852c1.6803192 1.69 3.2725532-.5594815 4.195532-1.9461481l1.6755319 1.1314815s-.3858511 1.1911851-1.7425532 2.4565185c-2.1504256 2.157037-4.5603192 2.0742222-6.5728724.545037l2.7909575 2.8060741-2.2164894 2.2292592-2.9412766-2.9562963c-1.4993617-1.5041481-2.3495744-1.9596296-3.0829787-1.2277777-.4734626.4731916-.6412814.9796264-.3230465 1.680515.1927374.4244896.5637621.9203059 1.1531529 1.5232627l2.9767021 2.9938519h-4.4339362l-8.25893613-8.3065185 2.22893613-2.2408148 4.195532 4.2187407c-.2020213-.7713333.2901063-1.8825926 1.0924468-2.6905185 1.0388298-1.0448148 3.1385106-1.7304445 5.0706383.2128148l.295851.2946667c-1.4648936-1.9557778-1.6027659-4.3323704.3532979-6.293926 1.8268085-1.8325185 4.103617-1.9981481 6.2157447-.312l-2.7344681-2.7502222 2.0240426-2.0299259 1.5252127 1.274963c-1.2245745-2.1878519.4078724-3.63229634.7937234-3.84703708l1.332766 1.52629628c-.3935107-1.47525925-.0392553-3.02851851 1.313617-4.38533332 2.0240426-2.02992593 4.6062766-2.00007407 6.8984043.312.2211702.22340741.5112766.56718519.8923404.97740741l-4.2510638 4.27651851c1.6803191 1.689037 3.2763829-.5546667 4.1984042-1.94133333zm-16.1444681 11.20551563 2.0182979-2.0385925c-.846383-.8271852-1.6018085-1.1430371-2.3467021-.3967408-.612766.6162963-.6606383 1.2528148.3284042 2.4353333zm12.4879787-12.56088884c-.8463829-.82718519-1.6018085-1.14303704-2.3457446-.39674074-.6146809.61629629-.6644681 1.248.3245744 2.43051851z" fill="#fff" fill-opacity=".3"/></g></svg>'),i=Lj;ab(i)?t(i):new nh("image",r).then((function(e){Zd.drawImage(e,0,0);try{Zd.getImageData(0,0,1,1),i=!1}catch(t){i=18===t.code}finally{Lj=i,t(i)}}),e)}Ij.prototype.U=function(){var t,e,r,i=this.v,n=i.Ub(),o=i.xa.Ib().bounds,a=(i=i.O).aa.length,s={},l=0,u=[Pj];if(o)for(;l<a;l++)if(e=i.get(l).getCopyrights(o.C(),n))for(t=0;t<e.length;t++)s[r=e[t].label]||(u.push(r),s[r]=1);return u.join(", ")},Ij.prototype.getCopyrights=Ij.prototype.U,Ij.prototype.K=function(){return this.G.style},Ij.prototype.Gs=String.fromCharCode(169),Ij.prototype.disposeInternal=function(){if(this.v.removeEventListener(this.v.j.Os,this.Di),this.v.O.removeEventListener("add",this.ge),this.v.O.removeEventListener("remove",this.ge),this.v.O.removeEventListener("set",this.ge),this.G.parentNode){var t=this.G;t.parentNode.removeChild(t)}},Ij.prototype.disposeInternal=Ij.prototype.disposeInternal,Ij.prototype.capture=function(t,e,r,i){var n,o=t.getContext("2d"),a=window.getComputedStyle(this.Ul.parentElement),s=2*hb(a.paddingLeft,10),l=(this.Ul.offsetWidth+2*s)*e,u=this.Ul.offsetHeight*e,c=0!==this.dg.innerHTML.length?this.dg.offsetWidth*e:0,h=ib(a.getPropertyValue("font-size")),p=this.G.ownerDocument,f=+t.width,d=+t.height,y=16*e,g=this.Gl.childNodes[0].getBoundingClientRect(),v=g.width*e,m=g.height*e,_=ie;Za(i)&&(_=function(){i("capture_error")}),o.fillStyle=a.backgroundColor,o.fillRect(f-l-c,d-u,l+c,u),l=this.dg.innerHTML,l=this.Gs+" "+((n=Jj(p,"div",null,n=this.U())).textContent||n.innerText||"")+(l?" "+l:""),o.font=h*e+"px "+a.getPropertyValue("font-family"),o.fillStyle=a.getPropertyValue("color"),o.textBaseline="bottom",o.textAlign="right",o.fillText(l,f-s*e,d),Qj(this,o.font,(function(e){new nh("image",e).then((function(e){o.drawImage(e,y,d-(m+y),v,m),r(t)}),_)}),_)},Ij.prototype.capture=Ij.prototype.capture,Ij.prototype.oq=!1,Ij.prototype.iy=function(t,e){Oj[t]=e},Ij.prototype.addL11NString=Ij.prototype.iy;var Oj={"de-DE":"Nutzungsbedingungen","en-US":"Terms of use","en-GB":"Terms of use","es-ES":"Condiciones de uso","fi-FI":"Palveluehdot","fr-FR":"Conditions d'utilisation","it-IT":"Condizioni di utilizzo","nl-NL":"Dienstvoorwaarden","pl-PL":"Warunki świadczenia usługi","pt-BR":"Termos de serviço","pt-PT":"Termos do serviço","ru-RU":"Условия использования","tr-TR":"Servis Koşulları","zh-CN":"使用条款"};function Sj(t){if(Sj.g.constructor.call(this,t),t&&(this.Gk={crossOrigin:t.crossOrigin||"anonymous",headers:t.headers||{}},this.Vp=t.getURL),Tj(this)){var e=t&&t.style&&t.style instanceof H.map.render.harp.Style?t.style:new H.map.render.harp.Style({styles:[{technique:"raster",attr:{gamma:1,brightness:1}}]});this.Xa(e)}if(!Za(this.Vp))throw new C(Sj,0,"getURL");if(this.Fg(t.opacity),this.zl=globalThis.URL||globalThis.webkitURL,!(t="anonymous"===(t=this.Gk.crossOrigin)||"use-credentials"===t)){t=this.Vp(0,0,0),e=window.location;var r=document.createElement("a");r.href=t,t=r.hostname===e.hostname&&r.port===e.port&&r.protocol===e.protocol}(this.dx=t&&!!oh.arraybuffer&&!!this.zl)&&this.Sb().fi(z(this.ke,this))}function Tj(t){return!!H.map.render.harp&&t.vb===Eh.HARP}function Uj(){Uj.g.constructor.call(this),this.Pn={},this.ji={position:new xe(0,0),zoom:0,heading:180,incline:0,tilt:0,bounds:new L(jf([90,-180,90,0,90,180,-90,180,-90,-180]))},this.zu=!1}u(Sj,R),t("H.map.provider.ImageTileProvider",Sj),Sj.prototype.Fd=function(t){this.Fg(t)},Sj.prototype.setOpacity=Sj.prototype.Fd,Sj.prototype.Ve=function(){return this.Sc},Sj.prototype.getOpacity=Sj.prototype.Ve,Sj.prototype.zk=ge,Sj.prototype.providesRasters=Sj.prototype.zk,Sj.prototype.o=function(t,e,r,i,n,o){var a,s=this,l=this.Vp(t,e,r);if(t=Aj,l){var u=globalThis.setTimeout((function(){s.dx?(a=new nh("arraybuffer",l,o,s.Gk)).then((function(t){return t.blob()})).then((function(t){var e=new Image;e.onload=z(i,null,e,{raw:t}),e.onerror=z(n,null,"bad url");try{e.src=s.zl.createObjectURL(t)}catch(t){}}),n):(a=new nh("image",l,o,s.Gk)).then(i,n)}),150);t={cancel:function(){a?a.cancel():globalThis.clearTimeout(u)}}}else i(null);return t},Sj.prototype.requestInternal=Sj.prototype.o,Sj.prototype.pw=function(t,e){var r=new Image;r.onload=function(){e(this)},r.src=this.zl.createObjectURL(t)},Sj.prototype.ke=function(t,e){(t=e.data)&&t instanceof HTMLImageElement&&this.zl.revokeObjectURL(t.src)},Sj.prototype.K=function(){return this.mb()},Sj.prototype.getStyle=Sj.prototype.K,Sj.prototype.Cb=function(t){Tj(this)&&t instanceof H.map.render.harp.Style&&this.Xa(t)},Sj.prototype.setStyle=Sj.prototype.Cb,u(Uj,E),t("H.map.ViewModel",Uj),Uj.prototype.j={Aa:"update",Oi:"sync"},Uj.prototype.ad=function(t,e){if(!t)throw new C(this.ad,0,t);var r=t[Vj];if(ab(r)&&!ye(r))throw new C(this.ad,0,Vj);if(ab(r=t[Wj])&&D(+r))throw new C(this.ad,0,Wj);if(ab(r=t[Xj])&&!B(r,we))throw new C(this.ad,0,Xj);return r=Yj(t=globalThis.Object.assign({},t),this.Pn,this.ji),Zj(this,this.Pn,t),this.zu||Zj(this,this.ji,t),this.dispatchEvent(new ak(this.Pn,r,e)),this},Uj.prototype.setLookAtData=Uj.prototype.ad,Uj.prototype.Ib=function(){var t={};return t[Vj]=ze(this.ji[Vj]),Zj(this,t,this.ji,!0),t},Uj.prototype.getLookAtData=Uj.prototype.Ib;var Vj="position",Wj="zoom",Xj="bounds",bk={Ss:Vj,Ws:Wj,Ks:"heading",Vs:"tilt",Ls:"incline",Es:Xj},ck=Object.keys(bk).map((function(t){return bk[t]}));function Zj(t,e,r,i){t.Gv={},t.Fv={},t.pv=[];for(var n,o,a,s=t.dC,l=t.cC,u=ck.length;u--;)if(a=r[n=ck[u]],null==(o=e[n])||!i)if(null!=a){if(ab(s)&&s.call(t,n,o,a),e[n]="position"!==n||a&&!D(a.lat)&&!D(a.lng)?a:ze(a),ab(l)){switch(n){case"position":o=a&&o&&(a.lat!==o.lat||a.lng!==o.lng);break;case"bounds":o=a&&o&&!a.da(o);break;default:o=a!==o}o&&l.call(t,n)}}else delete e[n]}Uj.prototype.dC=function(t,e,r){this.Gv[t]=e,this.Fv[t]=r},Uj.prototype.cC=function(t){this.pv.push(dk[t])};var dk=ck.reduce((function(t,e){return t[e]=Gj[e.toUpperCase()],t}),{});function Yj(t,e,r){var i=0;return["tilt","incline","heading",Wj].forEach((function(n){D(t[n])?t[n]=D(e[n])?r[n]:e[n]:i|=dk[n]})),[Vj,Xj].forEach((function(n){t[n]?i|=dk[n]:t[n]=e[n]||r[n]})),i}function ek(t,e){return t|e}function ak(t,e,r){ak.g.constructor.call(this,Uj.prototype.j.Aa,t,null,e),this.animate=this.animate=jb(r)&&0<r&&1/0>r?r:!!r}function fk(){this.aa=[],fk.g.constructor.call(this)}function gk(t,e,r){if(t=t.aa.length,r)var i=t;else if(D(i=0>(i=+e)?ld(0,t+i):kd(t,i)))throw new Td(fk,e,[0,t-1]);return i}function hk(t,e,r,i,n,o){hk.g.constructor.call(this,e,t),this.idx=r,this.added=i,this.removed=n,this.moved=o}function ik(t){var e;if(ik.g.constructor.call(this),this.dispatchEvent=z(this.dispatchEvent,this),t){var r=t.length;for(e=0;e<r;e++)this.add(t[e])}}function jk(t,e){var r=e.getProvider&&e.getProvider();r&&(kk[r.uid]=r),e.ea(t)}function lk(t){var e=t.getProvider&&t.getProvider();e&&delete kk[e.uid],t.ea(null)}Uj.prototype.rb=function(t){var e={},r={};this.zu=!0,Zj(this,this.ji,t),this.Pn={},e.lookAt=this.Fv,r.lookAt=this.Gv,t=(t=this.pv).length?t.reduce(ek):0,this.dispatchEvent(new Fj(this.j.Oi,e,r,t))},Uj.prototype.synchronize=Uj.prototype.rb,Uj.prototype.Vk=function(t,e){if(D(t=+t))throw new C(this.Vk,0,Wj);this.ad({zoom:t},e)},Uj.prototype.Ub=function(){return this.ji.zoom},Uj.prototype.Id=ub,Uj.prototype.startControl=Uj.prototype.Id,Uj.prototype.control=ub,Uj.prototype.control=Uj.prototype.control,Uj.prototype.hc=ub,Uj.prototype.endControl=Uj.prototype.hc,u(ak,Fj),u(fk,E),t("H.util.OList",fk),fk.prototype.Bo=function(t,e){this.aa.splice(e,0,t),this.dispatchEvent(new hk(this,this.j.Ki,e,t,null,null))},fk.prototype.add=function(t,e){this.Bo(t,gk(this,e,D(e)))},fk.prototype.add=fk.prototype.add,fk.prototype.pf=function(t){var e=this.aa.splice(t,1)[0];return this.dispatchEvent(new hk(this,this.j.Mi,t,null,e,null)),e},fk.prototype.Ed=function(t){return this.get(t),this.pf(t)},fk.prototype.removeAt=fk.prototype.Ed,fk.prototype.remove=function(t){return 0<=(t=this.indexOf(t))&&(this.pf(t),!0)},fk.prototype.remove=fk.prototype.remove,fk.prototype.set=function(t,e){if(0!==this.aa.length||0!==t){this.get(t),t=gk(this,t,!1);var r=this.aa[t]}return this.aa[t]=e,this.dispatchEvent(new hk(this,this.j.Ni,t,e,r,null)),r},fk.prototype.set=fk.prototype.set,fk.prototype.indexOf=function(t){return this.aa.indexOf(t)},fk.prototype.indexOf=fk.prototype.indexOf,fk.prototype.get=function(t){var e=gk(this,t,!1),r=this.aa;if(e>=r.length)throw new Td(this.get,t,[0,r.length-1]);return r[e]},fk.prototype.get=fk.prototype.get,fk.prototype.eA=function(){return this.aa.length},fk.prototype.getLength=fk.prototype.eA,fk.prototype.Ta=function(){return[].concat(this.aa)},fk.prototype.asArray=fk.prototype.Ta,fk.prototype.flush=function(){for(var t=this.aa.length;t--;)this.pf(t)},fk.prototype.flush=fk.prototype.flush,fk.prototype.disposeInternal=function(){this.flush(),fk.g.disposeInternal.call(this)},fk.prototype.j={Ki:"add",Mi:"remove",Ni:"set",RD:"move"},u(hk,Fc),fk.Event=hk,u(ik,fk),t("H.map.DataModel",ik),ik.prototype.add=function(t,e){B(t,Nh,this.add,0),jk(this,t),ik.g.add.call(this,t,e)},ik.prototype.add=ik.prototype.add,ik.prototype.set=function(t,e){return B(e,Nh,this.set,0),jk(this,e),(t=ik.g.set.call(this,t,e))&&lk(t),t},ik.prototype.set=ik.prototype.set,ik.prototype.Ed=function(t){var e;return(e=ik.g.Ed.call(this,t))&&lk(e),e},ik.prototype.removeAt=ik.prototype.Ed,ik.prototype.remove=function(t){var e;return(e=ik.g.remove.call(this,t))&&lk(t),e},ik.prototype.remove=ik.prototype.remove,ik.prototype.flush=function(){for(var t=this.aa.length;t--;)this.Ed(t);ik.g.flush.call(this)},ik.prototype.flush=ik.prototype.flush;var kk={};function mk(t,e,r){if(t=kk[t])return B(t[e],Function,mk,1,"invalid method"),t[e].apply(t,r)}function nk(t,e){var r;if(e=e||{},!B(t,Element))throw new C(nk,0,t);var i=t.ownerDocument.createElement("div");this.G=t,nk.g.constructor.call(this),this.padding=new ig(0,0,0,0),this.center=new K(0,0),this.margin=0,this.element=i,i.style.zIndex=0,i.style.height=i.style.width="100%",i.style.direction="ltr",i.style.position="relative"===t.style.position?"absolute":"relative",this.resize(),t.appendChild(i),(r=e.padding)!==A&&this.Vr(r.top,r.right,r.bottom,r.left),this.Qr((r=e.margin)!==A?r:0)}function ok(t,e,r,i){var n=new ig(0,0,0,0);if(ok.g.constructor.call(this),!t)throw new C(ok,0,t);if(!e)throw new C(ok,1,e);if(!r)throw new C(ok,2,r);if("object"!=typeof i)throw new C(ok,3,i+" is not an object");if("number"!=typeof i.pixelRatio)throw new C(ok,3,i.pixelRatio+" is not a number");this.ja=i.pixelRatio,this.zoom=0,this.Ab=qd(this.ja)/Ad,this.pixelProjection=new Kh,this.rl={1:n.clone(),2:n.clone(),4:n.clone()},this.yd=new K(.5,.5),this.za=t,pk(this,this.ja),this.Jd=z(this.Jd,this),this.wd=z(this.wd,this),this.ic=z(this.ic,this),t.startInteraction=this.Jd,t.interaction=this.wd,t.endInteraction=this.ic,t.addEventListener(t.j.Aa,this.ng,!1,this),this.getCapabilities=this.getCapabilities,this.capture=this.capture,this.zoomAt=this.Ng,this.relaunch=this.ba,this.dispose=this.l,this.screenToGeo=this.Wa,this.geoToScreen=this.La,this.screenToLookAtData=this.Un,this.Ee=e,this.Id=z(this.Id,this),this.control=z(this.control,this),this.hc=z(this.hc,this),e.startControl=this.Id,e.control=this.control,e.endControl=this.hc,e.addEventListener(e.j.Aa,this.ar,!1,this),this.ib=r,this.gn=z(this.gn,this),this.jg=z(this.jg,this),this.kg=z(this.kg,this),this.fn=z(this.fn,this),r.addEventListener(Nh.prototype.j.Aa,this.gn,!1,this),r.addEventListener(r.j.Ki,this.jg,!1,this),r.addEventListener(r.j.Mi,this.kg,!1,this),r.addEventListener(r.j.Ni,this.fn,!1,this)}function pk(t,e){var r=t.za,i=r.width,n=r.height,o=r.padding,a=o.top,s=o.left,l=o.bottom;o=o.right,r=r.margin;var u=-(i+s-o)/2|0,c=-(n+a-l)/2|0;i+=u,n+=c,(t=t.rl)[1].set((u-r)*e,(c-r)*e,(i+r)*e,(n+r)*e),t[2].set(u*e,c*e,i*e,n*e),t[4].set((u+s)*e,(c+a)*e,(i-o)*e,(n-l)*e)}function qk(t,e){t.style.transition="opacity 1.5s",Vc(t,"transitionend",e,!1),t.style.opacity=0}mb(kk),ik.invoke=mk,u(nk,E),t("H.map.ViewPort",nk),nk.prototype.j={Aa:"update",Oi:"sync"},nk.prototype.Qr=function(t){if(this.margin!==+t){if(D(this.margin=+t))throw new C(this.Qr,0,t);this.De(),this.dispatchEvent(this.j.Aa)}},nk.prototype.setMargin=nk.prototype.Qr,nk.prototype.Vr=function(t,e,r,i){var n=this.padding;if(n.top!==t||n.right!==e||n.bottom!==r||n.left!==i){if(D(t+e+r+i))throw new C(this.Vr);n.top=t,n.right=e,n.bottom=r,n.left=i,this.De(),this.dispatchEvent(this.j.Aa)}},nk.prototype.setPadding=nk.prototype.Vr,nk.prototype.De=function(){var t=this.padding;this.center.set((this.width+t.left-t.right)/2|0,(this.height+t.top-t.bottom)/2|0)},nk.prototype.resize=function(){var t=this.G.offsetWidth,e=this.G.offsetHeight;this.width===t&&this.height===e||(this.RB=new Ph(this.width,this.height),this.width=t,this.height=e,this.De(),this.dispatchEvent(this.j.Aa))},nk.prototype.resize=nk.prototype.resize,nk.prototype.rb=function(t){this.dispatchEvent(new Fj(this.j.Oi,this.RB,t,Gj.SIZE))},nk.prototype.synchronize=nk.prototype.rb,nk.prototype.disposeInternal=function(){this.G.removeChild(this.element),delete this.G,delete this.element,nk.g.disposeInternal.call(this)},nk.prototype.Jd=ub,nk.prototype.startInteraction=nk.prototype.Jd,nk.prototype.wd=ub,nk.prototype.interaction=nk.prototype.wd,nk.prototype.ic=ub,nk.prototype.endInteraction=nk.prototype.ic,u(ok,E),t("H.map.render.RenderEngine",ok),ok.prototype.Ng=function(){},ok.prototype.ng=function(){pk(this,this.ja)},ok.prototype.disposeInternal=function(){var t=this.za,e=this.Ee,r=this.ib;t.removeEventListener(t.j.Aa,this.ng,!1,this),t.startInteraction===this.Jd&&(t.startInteraction=nk.prototype.Jd),t.interaction===this.wd&&(t.interaction=nk.prototype.wd),t.endInteraction===this.ic&&(t.endInteraction=nk.prototype.ic),e.removeEventListener(e.j.Aa,this.ar,!1,this),e.startControl===this.Id&&(e.startControl=Uj.prototype.Id),e.control===this.control&&(e.control=Uj.prototype.control),e.endControl===this.hc&&(e.endControl=Uj.prototype.hc),r.removeEventListener(Nh.prototype.j.Aa,this.gn,!1,this),r.removeEventListener(r.j.Ki,this.jg,!1,this),r.removeEventListener(r.j.Mi,this.kg,!1,this),r.removeEventListener(r.j.Ni,this.fn,!1,this)},ok.prototype.Mr=function(t){this.Fo=t},ok.prototype.setAnimationCallback=ok.prototype.Mr,ok.prototype.Dr=function(){this.Fo=void 0},ok.prototype.resetAnimationCallback=ok.prototype.Dr,ok.prototype.control=function(){},ok.prototype.capture=function(){return dc(Error("not implemented"))};var rk={ZOOM:1,HEADING:2,TILT:4,INCLINE:8,COORD:16};function uk(t,e){return e.tilt=vk(t,e.tilt),e.heading=wk(t,e.heading),e.incline=t.getCapabilities().lookAt.incline.min,e}function tk(t,e){var r=t.getCapabilities().lookAt.zoom;return Nd(e,ld(r.min,t.zq),kd(r.max,t.yq))}function vk(t,e){return Nd(e,(t=t.getCapabilities().lookAt.tilt).min,t.max)}function wk(t,e){return Nd((e%360+360)%360,(t=t.getCapabilities().lookAt.heading).min,t.max)}function sk(t,e,r){(r=r?e.addEventListener:e.removeEventListener).call(e,e.j.Qs,t.Vq,!1,t),r.call(e,e.j.Ps,t.Vq,!1,t)}ok.InteractionModifiers=rk,m=ok.prototype,m.j={Us:"render"},m.gn=function(t){this.Ov(t),this.ba()},m.jg=function(t){this.pk(t.idx,t.added)},m.kg=function(t){this.Uq(t.idx,t.removed,t.type===this.ib.j.Ni)},m.fn=function(t){t.removed&&this.kg(t),this.jg(t)},m.Ov=ie,m.pk=function(t,e){this.hq(t,e),0===t&&this.Ac(),B(e,Nh)&&sk(this,e,!0),this.li(),this.ba()},m.Ac=function(){var t=this.ib.Ta();if(0<t.length){var e=t[0].max;this.zq=t[0].min,this.yq=e}else e=(t=this.getCapabilities().lookAt.zoom).max,this.zq=t.min,this.yq=e;(t=tk(this,this.zoom))!==this.zoom&&(this.zoom=t,this.pixelProjection.Va(t),this.rb())},m.rb=function(t){this.vf=this.Ib(),t&&(this.vf.position=t),this.vf.zoom=this.zoom-this.Ab,this.vf.position.alt=0},m.ux=0,m.heading=180,m.Ib=function(){return uk(this,{position:this.pixelProjection.projection.wn(this.yd),zoom:this.zoom,tilt:this.ux,heading:this.heading})},m.hq=ie,m.Uq=ie,m.$C=function(t,e){this.ff={before:t,after:e}},ok.prototype.setOnRenderCallbacks=ok.prototype.$C;var xk={P2D:0,WEBGL:1,HARP:2};function yk(t,e){var r=this;if(!Za(e))throw new C(yk,1,e);if(!Za(t.next||Za(t.cycle)))throw new C(yk,2,'Argument "mode" must implement H.util.AsyncQueue.Mode');this.Ak=[],this.rw=[],this.KB=t,this.process=e,this.wC=function(){zk(r)},this.nr=null,this.Lw=function(){r.nr||(r.nr=globalThis.setTimeout(r.wC,1))}}function zk(t){var e=t.rw,r=0,i=t.KB;for(i.yt(),t.nr=null;r<e.length;){var n=e[r];n.Vu?e.splice(r,1):r++}for(;n=i.next(t.Ak,t.rw);)n.cancelled?n.done(null,"cancelled"):(e.push(n),t.process(n,n.data))}function Bk(){Ak(this,null,null,null)}function Ak(t,e,r,i){return t.data=e,t.cancelled=!1,t.Vu=!1,t.UB=r,t.VB=i,t.Qo=null,t}function Ck(){}ok.EngineType=xk,t("H.util.AsyncQueue",yk),yk.prototype.push=function(t,e){if(!Za(e))throw new C(this.push,1,e);return t=Ak(new Bk,t,this.Lw,e),this.Ak.push(t),this.Lw(),t},yk.prototype.push=yk.prototype.push,yk.prototype.An=function(){zk(this)},yk.Task=Bk,Bk.prototype.done=function(t,e){this.Vu=!0,this.UB(),this.VB(this,t,e)},Bk.prototype.done=Bk.prototype.done,Bk.prototype.cancel=function(){this.Qo&&this.Qo(),this.cancelled=!0},Bk.prototype.cancel=Bk.prototype.cancel,Bk.prototype.YC=function(t){return this.Qo=t,this},Bk.prototype.setCancelFn=Bk.prototype.YC,yk.Mode=Ck,Ck.prototype.next=function(){},Ck.prototype.yt=function(){};var Dk,Ek=function(){function t(){}for(var e,r,i,n=globalThis,o=Va("o ms moz webkit ").split(void 0!==A?void 0:" "),a=5;a--&&!e;)e=o[a],e=(r=n[e+(e?"R":"r")+"equestAnimationFrame"])&&!D(r.call(window,t))&&(i=n[e+(e?"C":"c")+"ancelAnimationFrame"]);return Dk=e?function(t){return r.call(n,t)}:function(t){return n.setTimeout(t,25)},e?function(t){return i.call(n,t)}:function(t){return n.clearTimeout(t)}}(),Fk=globalThis.performance&&globalThis.performance.now?function(){return globalThis.performance.now()}:function(){return globalThis.Date.now()};function Gk(t,e){Gk.g.constructor.call(this,new Hk(t),e)}function Hk(t){if(isNaN(t)||0>t)throw new C(Gk,1,'Argument "maxTime" must be a positive number');this.DB=t,this.$k=Fk()}function Ik(t){return t}function Jk(t){return-t*(t-2)}function Kk(t){return 1-Math.sqrt(1-t*t)}function Lk(t){return rd(2*t-t*t)}function Mk(t){return 1-Math.cos(t*Math.PI/2)}function Nk(t){return Math.sin(t*Math.PI/2)}function Ok(t,e){this.cg={tilt:Pk(t.tilt,e.tilt),heading:Pk(t.heading,e.heading),zoom:e.zoom-t.zoom};var r=this.bp=ze(t.position),i=e.position;t=i.lat*Gd;var n=r.lat*Gd;r=i.lng*Gd-r.lng*Gd,t=Math.atan2(ud(r)*wd(t),wd(n)*ud(t)-ud(n)*wd(t)*wd(r)),this.ry=(0<=t?t:Ed+t)*Hd,this.kh=this.bp.kb(e.position),e=this.cg.zoom,this.Ev=0===e?Qk:Object.assign({},Qk,{zoom:0>e?Lk:Kk,position:0>e?Mk:Nk}),this.gv=Object.assign({},{tilt:0,heading:0,zoom:0})}function Pk(t,e){return-180<(t=e-t)&&180>=t?t:180<t?t-360:t+360}u(Gk,yk),t("H.util.SequentialQueue",Gk),Hk.prototype.next=function(t){return t.length&&Fk()-this.$k<this.DB?t=t.shift():null},Hk.prototype.yt=function(){this.$k=Fk()},t("H.util.animation.ease.LINEAR",Ik),t("H.util.animation.ease.EASE_IN_QUAD",(function(t){return t*t})),t("H.util.animation.ease.EASE_OUT_QUAD",Jk),t("H.util.animation.ease.EASE_IN_OUT_QUINT",(function(t){return 1>(t*=2)?sd(t,5)/2:sd(t-=2,5)/2+1})),t("H.util.animation.ease.EASE_OUT_CIRC",Lk);var Qk={tilt:Ik,heading:Ik,zoom:Ik,position:Ik};function Rk(){E.call(this),this.reset()}function Tk(t){Tk.g.constructor.call(this,Rk.prototype.j.wo),this.mt=t}function Uk(t){return globalThis.Object.create(t.Ro)}function Sk(t,e,r,i,n,o){this.Lb=t,this.Mb=e,this.Nb=r,this.mi=i,this.ni=n,this.Jk=o}function Vk(t){this.yb=t}function Wk(t,e,r,i,n,o){var a=n||"2d";Wk.g.constructor.apply(this,arguments),this.Zl=this.element.getContext(a,o),this.Cu="2d"===a,this.ij=a,this.hj=o}function Xk(t,e,r,i){Xk.g.constructor.apply(this,arguments)}function Yk(t,e){this.Dy=t,this.oa=e}function Zk(t,e,r){var i=[],n={nd:t.Dy,width:e.w,height:e.h,ja:t.oa};for(t=0;t<r.length;t++){var o=(e=r[t]).Eh(),a={};Sa(a,n);var s=e.Pb;switch(o){case"2d":if(B(e.Tb(),Rh)&&(a.Wo=e.Tb().getContextAttributes()),o=c&&"2d"===c.uh()){o=a.Wo;var l=c.hj;o=!(l!==o&&(l&&!o?l.alpha||l.willReadFrequently:o&&!l?o.alpha||o.willReadFrequently:!o.alpha!=!o.alpha||!l.willReadFrequently!=!o.willReadFrequently))}if(o)var u=!1;else if(s&&!u){var c=s;u=!1}else c=new Wk(a.nd,a.width,a.height,a.ja,"2d",a.Wo),u=!0;break;case"dom":c=s||new Xk(a.nd,a.width,a.height,a.ja),u=!s;break;default:c=s||new Wk(a.nd,a.width,a.height,a.ja,e.Tb().uh(),a.Wo),u=!s}i[i.length-1]!==c&&(c.ui(i.length),i.push(c)),e.tf(c)}return i}function $k(t){var e="dom";$k.g.constructor.call(this,t),B(this.yb,Rh)&&(e="2d"===t.uh()?"2d":"webgl"),this.sD=e}function al(t,e){al.g.constructor.call(this,t),this.Qd=!(!e||!e.Qd),this.Hq={}}u(Rk,E),Rk.prototype.start=function(t,e){this.R&&this.reset(),D(t-e)||(this.Ug=+t,this.Vg=+e),this.R=!0},Rk.prototype.reset=function(){this.R=!1,this.Ug=this.Vg=A,this.Ro=new Sk(0,0,0,0,0,0)},Rk.prototype.Lm=function(){return this.R},Rk.prototype.j={wo:"animationupdate"},u(Tk,Fc),Rk.prototype.set=function(t,e,r,i,n,o){var a=this.Ro;this.R&&(t=new Sk(t/1e3,e/1e3,r/1e3,i/1e3,n/1e3,o/1e3),a.da(t)||(this.Ro=t,this.dispatchEvent(new Tk(Uk(this)))))},Rk.prototype.nc=function(){return Uk(this).nc()},Rk.prototype.Nf=function(){var t=Uk(this),e=this.nc()||1;return new Sk(t.Lb/e,t.Mb/e,t.Nb/e,t.mi,t.ni,t.Jk)},Rk.prototype.disposeInternal=function(){this.reset(),Rk.g.disposeInternal.call(this)},Sk.prototype.nc=function(){return rd(this.Lb*this.Lb+this.Mb*this.Mb+this.Nb*this.Nb)},Sk.prototype.Nf=function(){var t=this.nc()||1;return new Sk(this.Lb/t,this.Mb/t,this.Nb/t,this.mi,this.ni,this.Jk)},Sk.prototype.da=function(t){var e=t===this;return!e&&(e=B(t,Sk))&&(e=this.Lb===t.Lb&&this.Mb===t.Mb&&this.Nb===t.Nb&&this.mi===t.mi&&this.ni===t.ni&&this.Jk===t.Jk),e},u(Vk,Ac),Vk.prototype.Tb=function(){return this.yb},Vk.prototype.getLayer=Vk.prototype.Tb,Vk.prototype.FA=function(){return this.Pb},Vk.prototype.getSurface=Vk.prototype.FA,Vk.prototype.tf=function(t){var e=this.Pb;t!==e&&(this.Pb=t,t.Sn(),e&&e.release())},Vk.prototype.setSurface=Vk.prototype.tf,Vk.prototype.disposeInternal=function(){this.Pb.release()},Vk.prototype.disposeInternal=Vk.prototype.disposeInternal,Vk.prototype.Eh=function(){},Vk.prototype.render=Vk.prototype.L,u(Wk,Qh),m=Wk.prototype,m.createElement=function(t){var e=(t=t.createElement("canvas")).style;return e.position="absolute",e.top=e.left="0",t},m.Yw=function(t,e,r,i,n){t.width=ld(r,1),t.height=ld(i,1),e.width=md(r/n)+"px",e.height=md(i/n)+"px"},m.Fg=function(t){this.Zl.globalAlpha=t},m.Re=function(t,e,r,i,n){this.Cu&&this.Zl.drawImage(t,e,r,i,n)},m.getContextAttributes=function(){return this.hj},m.uh=function(){return this.ij},m.clear=function(t){var e,r;this.Cu&&(t?this.Zl.clearRect(e=t.left,r=t.top,t.right-e,t.bottom-r):this.element.width=this.size.w)},m.disposeInternal=function(){var t=this.element;t.width=t.height=0,delete this.Zl,Wk.g.disposeInternal.call(this)},Wk.prototype.disposeInternal=Wk.prototype.disposeInternal,u(Xk,Qh),t("H.map.render.dom.Surface",Xk),m=Xk.prototype,m.uh=function(){return"dom"},m.createElement=function(t){return(t=t.createElement("DIV")).style.position="absolute",t.style.pointerEvents="none",t},m.Yw=function(t,e,r,i){e.width=r+"px",e.height=i+"px"},m.Fg=function(t){this.element.style.opacity=t},m.Re=function(t,e,r){var i=this.ja,n=t.style;n[Vi("transform")]="matrix(1,0,0,1,"+e/i+","+r/i+")",t.parentNode!==this.element&&(n.position="absolute",this.element.appendChild(t),this.element.style.pointerEvents="auto","auto"===getComputedStyle(t).pointerEvents&&(t.style.pointerEvents="all"),this.element.style.pointerEvents="none")},m.clear=function(t){t?this.element.removeChild(t):this.element.innerHTML=""},u($k,Vk),$k.prototype.L=function(t,e,r,i,n,o,a,s){a=this.yb;var l=this.Pb,u=!(B(l,Wk)&&"2d"===l.uh());return i>=a.min&&i<=a.max?(u&&l.Zb(!0),a.L(l.B(),{boundingBox:t,zoom:i,screenCenter:e,priorityCenter:o,projection:r,cacheOnly:n,size:l.mc(),pixelRatio:l.lb(),cameraMatrix:s})):(u&&l.Zb(!1),vg.DONE)},$k.prototype.Eh=function(){return this.sD},u(al,Vk),al.prototype.tf=function(t){al.g.tf.call(this,t),this.pC=t.nd.ownerDocument},al.prototype.setSurface=al.prototype.tf;var bl=function(t,e){return B(e=e.V(),kg)?e.ha:(t[0]=e,t)}.bind(null,[]);function cl(t,e){var r=t[1].We(),i=e[1].We();return Zf(r,i,!0)||t[5]-e[5]||Zf(r,i,!1)}function dl(t,e){dl.g.constructor.apply(this,arguments),this.Gq=0,this.Sh=[],this.sp=z(this.sp,this)}al.prototype.L=function(t,e,r,i,n,o,a){var s,l,u,c,h=this.yb;if(this.vC=e=this.Hq,this.Hq=r={},i>=h.min&&i<=h.max){var p=this.Xt(t,i,n,o),f=p.markers;if(t=f.length){for(i=[],n=this.Pb,o=0;o<t;o++){h=f[o];var d=bl(h);for(s=d.length;s--;)(l=a(d[s]))&&((c=e[u=h.xb()+"_"+s])?delete e[u]:c={uv:h},r[u]=c,i.push([c,h,h.kc(),n,l.x,l.y]))}for(i.sort(cl),t=i.length,o=0;o<t;o++)this.Ew.apply(this,i[o])}}return!p||p.requested&&p.requested===p.total||!p.requested&&f.length===p.total?vg.DONE:vg.PENDING},al.prototype.render=al.prototype.L,al.prototype.Ma=function(){},al.prototype.getObjectsAt=al.prototype.Ma,u(dl,al),t("H.map.render.dom.MarkerRenderer",dl),dl.prototype.Xt=function(){return this.yb.pe.apply(this.yb,arguments)},dl.prototype.L=function(t,e,r,i,n,o,a){this.sp(),this.NB=0;var s,l=dl.g.L.apply(this,arguments),u=this.Pb,c=this.vC;for(s in c)el(this,u,c[s]);return 0===this.Sh.length&&l?vg.DONE:vg.PENDING},dl.prototype.render=dl.prototype.L,dl.prototype.tf=function(t){dl.g.tf.call(this,t),this.oa=t.lb()},dl.prototype.setSurface=dl.prototype.tf,dl.prototype.sp=function(){for(var t,e,r,i=this.Sh.length;i--;)(e=(t=(r=this.Sh[i]).uo).kc()).Oq(r,e,t);this.Sh.length=0},dl.prototype.Ew=function(t,e,r,i,n,o){var a,s=i.lb(),l=e.Nc();n*=s,o*=s,this.Qd||(n=md(n),o=md(o)),t.detail&&(l.Kh(t.bB)?el(this,i,t):a=t.detail),a||(t.detail=a=r.eu(this.pC),this.Gq++,Za(r.Oq)&&this.Sh.push(a)),t.bB=l.Md,a.style.zIndex=this.NB++,a.uo=e,i.Re(a,n,o,0,0)};var fl,gl="pointer-events",hl,il;function el(t,e,r){e.clear(e=r.detail),delete e.uo,t.Gq--,(r=(t=r.uv).kc()).Sq&&r.Sq(e,r,t)}function jl(t,e,r,i,n){if(!Za(t.Mr)||!Za(t.Dr))throw new C(jl,0,t);if(this.bt=t,!Za(this.DD=e))throw new C(jl,1,e);if(D(this.rj=+r))throw new C(jl,2,r);if(!Za(this.Hv=i)&&null!=i)throw new C(jl,3,i);if(!Za(this.Mt=n)&&null!=n)throw new C(jl,4,n);this.id=(new de).next(),this.R=!1}function kl(t,e){aj.call(this,t,e)}function ll(t,e,r,i){return(t-=r)*t+(e-=i)*e}function ml(t,e,r){return nl(t,e*e,r||0,0,t.length-1)}function nl(t,e,r,i,n){var o=0,a=i,s=t[i].x,l=t[i].y,u=t[n].x,c=t[n].y,h=i+1,p=ll(s,l,u,c);if(p)for(;h<n;){var f=t[h++],d=f.x,y=((d-s)*(u-s)+((f=f.y)-l)*(c-l))/p;(d=0>y?ll(d,f,s,l):1<y?ll(d,f,u,c):ll(d,f,s+y*(u-s),l+y*(c-l)))>o&&(o=d,a=h-1)}else for(;h<n;)(d=ll(d=(f=t[h++]).x,f=f.y,s,l))>o&&(o=d,a=h-1);return o>=e||0<r&&a-i?(--r,1<a-i?(i=nl(t,e,r,i,a)).splice(i.length-1,1):i=[t[i]],i=1<n-a?i.concat(nl(t,e,r,a,n)):i.concat(t.slice(a,n+1))):i=[t[i],t[n]],i}function ol(t,e,r,i,n,o,a,s){ol.g.constructor.call(this,e,r,i,null),this.key=t,this.Bd=s,this.gd=n,this.oa=o,this.di={},this.zL=a,this.Vm=od(M.MAX_LINE_WIDTH/2*this.oa+1)}function pl(t){return t.Bd.getInvalidations(Yf.SPATIAL)}function ql(t){var e,r=pl(t),i=r.Md,n=t.zg,o=n===i;if(!(o||r.Ru(n)||r.sq(n))){o=t.Ig;var a=t.di;if(r.Km(n))for(e=o.length;e--;){var s=o[e];if(s.Nc().Km(n)){o.splice(e,1);var l=l||rl(t,s.xb())}}if(r.uq(n)){for(e=o.length;e--;)if((s=o[e]).Nc().uq(n)){var u=1;if((s=a[s.xb()])&&s.wm){l=1;break}}u&&o.sort(sl)}if(!l&&r.Kh(n))for(e=o.length;e--;)if(o[e].Nc().Kh(n)){var c=1;break}t.xr!==n||c||(t.xr=i,t.qf!==n||l||(t.qf=i)),t.zg=i,o=!0}return o}function tl(t,e){this.gm=t,this.wm=e}function rl(t,e){var r=(t=t.di)[e];if(r)return delete t[e],r.wm}function ul(t){var e,r=pl(t),i=t.zg,n=t.Ig;if(!ql(t)){for(e=n.length;e--;){var o=n[e],a=o.Nc();(a.Km(i)||a.sq(i))&&rl(t,o.xb())}t.Ig=t.Bd.requestSpatialsByTile(t,!1,!1).sort(sl),t.zg=r.Md}}function sl(t,e){return Zf(t.We(),e.We(),!1)}ae&&(ae&&xb!==x&&(xb=(il=/(MSIE\s+|rv:)([^\);]+)(\)|;)/.exec(navigator.userAgent))?+il[2]:x),hl=xb,9===hl?gl="display":10===hl&&(gl="visibility")),fl=gl,dl.prototype.Ma=function(t,e,r){var i,n,o,a,s,l=this.oa,u=je;if(this.Gq){t/=l,e/=l;var c=(l=this.Pb.nd.getRootNode()).documentElement,h=this.Pb.B(),p=h.getBoundingClientRect();for(t+=p.left,e+=p.top;(n=o=l.elementFromPoint(t,e))&&n!==h&&n!==c&&n!==l.host&&o!==f;){for(;(a=n.parentNode)&&(!Za(a.contains)||!a.contains(h));)n=a;if(a===h&&(n!==o||"svg"!==n.nodeName)&&0>u.indexOf(s=n.uo)&&(u===je&&(u=[]),u.push(s),r))break;i||(i=[]);var f=n.style;i.push({xt:f.getPropertyValue(fl),XA:f.getPropertyPriority(fl),style:f}),f.setProperty(fl,"visibility"===fl?"hidden":"none","important"),f=o}if(i)for(e=i.length;e--;)(t=i[e]).style.removeProperty(fl),gb(t.xt)&&t.style.setProperty(fl,t.xt,t.XA)}return u},dl.prototype.getObjectsAt=dl.prototype.Ma,dl.prototype.Eh=function(){return"dom"},dl.prototype.disposeInternal=function(){this.Sh.length=0;var t,e=this.Pb,r=this.Hq;for(t in r)el(this,e,r[t]);this.Pb.l(),dl.g.disposeInternal.call(this)},dl.prototype.disposeInternal=dl.prototype.disposeInternal,t("H.util.animation.Animation",jl),jl.prototype.start=function(){var t=this;this.$k=Fk(),this.R=!0;var e=this.$k;this.bt.Mr((function(){if(t.R){var r=Fk(),i=r-t.$k,n=i/t.rj,o=!1;1<=n&&(n=1,o=!0),t.DD(t.Mt?t.Mt(n):n,i,r-e,r),e=r,o&&t.stop()}else t.stop()}))},jl.prototype.start=jl.prototype.start,jl.prototype.stop=function(t){this.R=!1,this.bt.Dr(),t||this.Hv&&this.Hv(this)},jl.prototype.stop=jl.prototype.stop,jl.prototype.Lm=function(){return this.R},jl.prototype.isRunning=jl.prototype.Lm,u(kl,aj),t("H.map.layer.TileLayer",kl),kl.prototype.yg=function(t,e,r,i,n){if(!B(t,I))throw new C(this.yg,0,t);if(D(e=+e))throw new C(this.yg,1,e);e=nd(e),this.pixelProjection.Va(e),t=this.Bj(t);var o=this.Fh(t,e);return this.Oj(o,t.left>t.right,e,r,i,n)},kl.prototype.requestTiles=kl.prototype.yg,t("H.math.simplifyDP",ml),u(ol,gj),t("H.map.provider.SpatialTile",ol),ol.prototype.zg=Jd,ol.prototype.xr=Jd,ol.prototype.qf=Jd,ol.prototype.Ih=function(){var t=pl(this),e=t.Md,r=this.qf,i=r===e;return i||(this.Bd.uw&&!t.Kh(r)?i=!0:ql(this)&&(i=this.qf===e)),i},ol.prototype.isCanvasValid=ol.prototype.Ih,Object.defineProperty(ol.prototype,"valid",{get:function(){return this.Ih()},set:ie,configurable:!0}),ol.prototype.Ig=je,ol.prototype.bb=function(){return this.Ig},ol.prototype.getObjects=ol.prototype.bb,ol.prototype.HA=function(){return this.gd},ol.prototype.getTileSize=ol.prototype.HA;var vl={};function xl(t,e,r,i,n,o,a,s,l){var u=t.Tc,c=-a;if(a=o+a,s=s||0,l===A&&(l=u.length),n&&t===If)e.fillRect(0,0,o,o);else if(l>s){for(e.beginPath(),o=s;o<l;o++){var h=u[o],p=h.length;if(h===Jf)e.moveTo(c,c),e.lineTo(c,a),e.lineTo(a,a),e.lineTo(a,c);else{var f=h[0];for(e.moveTo(f.x,f.y),s=1;s<p;s++)f=h[s],e.lineTo(f.x,f.y)}r&&e.closePath()}r&&n&&e.fill(t.Uj!==Id?"evenodd":"nonzero"),i&&e.stroke()}}function wl(t,e,r){var i;t.strokeStyle=e.strokeColor,t.lineWidth=e.lineWidth*r,t.lineCap=e.lineCap,t.lineJoin=e.lineJoin,t.miterLimit=e.miterLimit,t.setLineDash&&(i=e.lineDash)!==je&&(t.setLineDash(i),t.lineDashOffset=e.lineDashOffset)}function yl(t,e){t.fillStyle=e.fillColor}function zl(t,e,r,i,n,o){var a=n*i.width/2,s=(n=n*i.length/2)/2;i=2*n*i.frequency;var l=rd(sd(n,2)+sd(a,2));t=new ig(l,l,t=t.gd-l,t),r=r.Tc;var u,c,h,p,f,d,y,g=Bd/2;for(o=o||0,l=r.length;l-- >o;){var v=0,m=r[l];if(c=u=m.length){var _=m;for(c=_.length,h=0;--c;)h+=_[c].kb(_[c-1]);c=(_=h)>=i}if(c)for(h=(c=_/((c=kd(nd(_/i),1e3))+1))/2;--u;){for(p=(f=m[u]).kb(d=m[u-1]);h<=v+p;){var b=f.x+(d.x-f.x)*(y=(h-v)/p);y=f.y+(d.y-f.y)*y,t.Ql(b,y)&&(e.save(),e.translate(b,y),e.rotate(-yd((d.y-f.y)/(f.x-d.x))+(f.x<d.x?g:-g)),e.beginPath(),e.moveTo(-a,-n),e.lineTo(0,n),e.lineTo(a,-n),e.lineTo(0,-s),e.closePath(),e.fill(),e.restore()),h+=c}v+=p}}}ol.prototype.Pj=function(){var t=this.gd+"_"+this.oa,e=vl[t];if(!e){e=-this.Vm;var r=this.gd-e;e=vl[t]=new ig(e,e,r,r)}return e},ol.prototype.getPxClipRect=ol.prototype.Pj,ol.prototype.nm=function(){var t=this.nz;if(!t){var e=this.pm();t=0;var r=this.gd;this.z&&(r-=t+=this.Pj().top),t=this.nz=Ee(e.sk(new K(t,t)),e.sk(new K(r,r)))}return t},ol.prototype.getGeoClipRect=ol.prototype.nm,ol.prototype.pm=function(){var t=this.yC;if(!t){var e=this.gd;(t=this.yC=new Kh(A,e)).Va(this.z),t.x=this.x*e,t.y=this.y*e}return t},ol.prototype.getPxProj=ol.prototype.pm,ol.prototype.lb=function(){return this.oa},ol.prototype.getPixelRatio=ol.prototype.lb,ol.prototype.Hn=function(){var t=this.data;return t&&(this.data=null,this.qf=Jd),t},ol.prototype.releaseCanvas=ol.prototype.Hn,ol.prototype.In=function(){this.di={},delete this.Ig,this.zg=Jd},ol.prototype.releaseData=ol.prototype.In,ol.prototype.L=function(t){var e,r,i,n,o=t.getContext("2d"),a=0;if(ul(this),this.qf<this.zg){var s=this.Ig;if(e=s.length){t.width=t.height=this.gd,o.clearRect(0,0,this.gd,this.gd);var l=this.di;for(r=0;r<e;r++){var u=s[r],c=u.xb();if(n=(i=l[c])?i.gm:u.getGeometriesForTile(this)){if(i)u.Nc().Kh(this.qf)&&(i.wm=dg(u,n)),i=i.wm;else{var h;i=dg(u,n);for(var p=n,f=u.Xe?2:0,d=p.length;d--;){var y=p[d];if(y!==If){var g=y.Tc;for(h=g.length;h--;)4<(y=g[h]).length&&(g[h]=ml(y,.6,f))}}this.di[c]=new tl(n,i)}if(i){for(o.save(),p=u.Xe?this.EC:this.GC,c=0;c<n.length;c++)p.call(this,u,n[c],u.K(),o);if(n=u.getLabels(this))for(u=o,c=n.length;c--;)for(p=(f=n[c]).size,u.font=p+"px "+f.font,u.fillStyle=f.color,u.textAlign="center",u.translate(f.x,f.y),u.rotate(f.angle),p=f.lineHeight||1.375*p,f=(d=f.lines).length;f--;)u.fillText(d[f],0,f*p);o.restore()}a|=+i}}}this.data=a?t:null,this.xr=this.qf=this.zg}else this.data&&(a=1);return 0<a},ol.prototype.render=ol.prototype.L,ol.prototype.data=null,ol.prototype.GC=function(t,e,r,i){var n;r.Xj&&(wl(i,r,this.oa),xl(e,i,!1,!0,!1,this.gd,this.Vm)),r.Vj&&(n=t.Tg)&&n.Pc&&(yl(i,n),zl(this,i,e,n,r.lineWidth))},ol.prototype.EC=function(t,e,r,i){var n,o=r.Pc,a=r.Xj,s=this.gd,l=this.Vm;if(e===If)o&&(yl(i,r),i.fillRect(0,0,s,s));else{if(a&&wl(i,r,this.oa),r.Vj&&(n=t.Tg)){var u=r.lineWidth;n.Pc||(n=null)}(t=e.sn)===Id?((a||o)&&(yl(i,r),xl(e,i,!0,a,o,s,this.Vm)),n&&(yl(i,n),zl(this,i,e,n,u,0))):(o&&(yl(i,r),xl(e,i,!0,!1,o,s,l,0,t)),a&&xl(e,i,!1,a,!1,s,l,t),n&&(yl(i,n),zl(this,i,e,n,u,t)))}};var Al=[];function Bl(t,e){var r;Bl.g.constructor.call(this,e),this.tw=t,this.oa=t=e.pixelRatio,this.tileSize=r=1<<md(Kd((e.tileSize||256)*t)),this.vs=ij(r,t),this.ke=z(this.ke,this),this.Qq=z(this.Qq,this),this.sg=z(this.sg,this),this.mg=z(this.mg,this),this.he=z(this.he,this),this.tw.addEventListener(Q.prototype.j.Aa,this.he,!1,this),this.Zg=[],this.wf=new kj(e.tileCacheSize||256,this.ke),this.cp=new kj(e.dataCacheSize||512,this.Qq),this.Mn=new Gk(20,this.sg),this.qg={},this.fv=Fk()}function Cl(t,e){(e=e?Qa(e):{}).tileSize=e.tileSize||256,e.pixelRatio=e.pixelRatio||Vd(),e.max=24,this.Hg=new Bl(t,e),this.wi=new kl(this.Hg),e.minWorldSize=this.Hg.tileSize,e.provider=t,Cl.g.constructor.call(this,e),this.tileSize=this.wi.tileSize,this.ln=z(this.ln,this),this.Hg.addEventListener(this.Hg.j.Aa,this.ln),t.addEventListener(t.j.Aa,this.ln)}ol.prototype.Ma=function(t,e,r){for(var i,n,o,a,s,l,u,c=this.Ig,h=c.length,p=je,f=this.oa;h--;)if((n=c[h]).Wd(!0)&&(o=this.di[n.xb()])&&(a=o.gm)){for(l="none"!==(i=n.K()).fillColor&&n.Xe,u="none"===i.strokeColor?0:i.lineWidth*f,i=a.length;i--;){var d;if(s=a[i],!(d=l&&s===If)&&(d=l||u)){var y;d=t;var g=e,v=l,m=u,_=s.Uj,b=s.sn,x=b!==Id,w=s.Tc,E=w.length,T=0,A=0,S=!1;for(s=0;s<E;s++){var k=w[s],I=s>=b,P=!I&&s>=_;if(k===Jf&&v)P?T++:A++;else{var O=k.length;for(Al.length=2*O,y=0;y<O;y++){var L=k[y];Al[2*y]=L.x,Al[2*y+1]=L.y}if(y=v&&!I,I=x&&!I?0:m,y||I){if((I=Qd(d,g,Al,I,y))===Pd.EDGE||I===Pd.VERTEX){S=!0;break}if(I===Pd.SURFACE)if(P)T++;else if(A++,_===Id)break}}}d=S||0<A&&!(T%2)}if(d){p===je&&(p=[]),p.push(n);break}}if(r&&p.length)break}return p},u(Bl,hj),Bl.prototype.he=function(t){(t=t.target).type===Yf.SPATIAL&&this.jb(t)},Bl.prototype.Pa=function(t,e,r,i){var n,o=this.getTileKey(t,e,r);if(n=this.wf.get(o,i)){if(i||n.Ih())return n;i||this.wf.cm(o)}if((n=this.cp.get(o,i))&&(i||ql(n)))return t=this.Zg.pop()||document.createElement("canvas"),n.L(t)||this.Zg.push(t),this.wf.add(o,n,1),n;i||((n=this.qg[o])?n.count++:((n=this.Mn.push([o,t,e,r],this.mg)).count=1,this.qg[o]=n))},Bl.prototype.requestTile=Bl.prototype.Pa,Bl.prototype.pd=function(){},Bl.prototype.createTileInternal=Bl.prototype.pd,Bl.prototype.An=function(){var t=Fk();33<t-this.fv&&(this.Mn.An(),this.fv=t)},Bl.prototype.Nd=function(t,e,r){this.Xi(this.getTileKey(t,e,r))},Bl.prototype.cancelTile=Bl.prototype.Nd,Bl.prototype.Xi=function(t){var e;(e=this.qg[t])&&(e.count--,e.count||(e.cancel(),delete this.qg[t]))},Bl.prototype.cancelTileByKey=Bl.prototype.Xi,m=Bl.prototype,m.sg=function(t,e){var r=e[0],i=e[1],n=e[2],o=e[3];i=(r=this.wf.get(r)||new ol(r,i,n,o,this.tileSize,this.oa,o+this.vs,this.tw)).data||this.Zg.pop()||document.createElement("canvas"),r.L(i)||this.Zg.push(i),e.push(r),t.done(r)},m.mg=function(t,e){t=t.data[0],e&&this.wf.add(t,e,1),delete this.qg[t],this.jb()},m.ke=function(t,e){e.data&&this.Zg.push(e.Hn()),this.cp.add(t,e,1)},m.Qq=function(t,e){e.In()},m.disposeInternal=function(){for(var t in this.qg)this.qg[t].cancel();this.wf.ia(),this.cp.ia(),this.Zg.length=0,Bl.g.disposeInternal.call(this)},u(Cl,Nh),t("H.map.layer.ObjectLayer",Cl),Cl.prototype.ln=function(t){t.currentTarget!==this.Hg&&t.target.type===Yf.SPATIAL||this.jb()};var Dl={markers:je,total:0};Cl.prototype.qe=function(t,e,r){var i,n=this.D;return n.providesMarkers()&&(i=n.requestMarkers(t,e,!0,r)).length?{markers:i,total:i.length}:Dl},Cl.prototype.requestMarkers=Cl.prototype.qe,Cl.prototype.pe=function(t,e,r){var i,n=this.D;return n.providesDomMarkers()&&(i=n.requestDomMarkers(t,e,!0,r)).length?{markers:i,total:i.length}:Dl},Cl.prototype.requestDomMarkers=Cl.prototype.pe;var El={tiles:je,total:0};Cl.prototype.yg=function(t,e,r,i){if(this.D.providesSpatials()){var n=this.wi.yg(t,e,r,i);r||(this.Hg.An(),n=this.wi.yg(t,e,!0,i))}else n=El;return n},Cl.prototype.requestTiles=Cl.prototype.yg,Cl.prototype.Pa=function(t,e,r,i){return this.wi.Pa(t,e,r,i)},Cl.prototype.requestTile=Cl.prototype.Pa,Cl.prototype.Nd=function(t,e,r){this.wi.Nd(t,e,r)},Cl.prototype.cancelTile=Cl.prototype.Nd;var Fl={overlays:je,total:0};Cl.prototype.xg=function(t,e,r){var i=this.D,n=Fl;return i.providesOverlays&&i.providesOverlays()&&(e=(t=i.requestOverlays(t,e,!0,r)).length)&&(n={overlays:t,total:e}),n},Cl.prototype.requestOverlays=Cl.prototype.xg,Cl.prototype.disposeInternal=function(){this.Hg.l(),this.wi.l(),this.D.dispose(),Cl.g.disposeInternal.call(this)};var Gl={lookAt:{zoom:{min:-8,max:24},tilt:{min:0,max:85},incline:{min:0,max:0},heading:{min:0,max:360}},interaction:{ZOOM:rk.ZOOM,COORD:rk.COORD},capture:!0};function Hl(t){var e,r=this,i=globalThis.H.gl;Hl.g.constructor.call(this),this.m=e=i.Scene.create(globalThis.URL.createObjectURL(qe(JSON.stringify(Il))),{viewport:t.viewport,container:t.nd,disableRenderLoop:!0,devicePixelRatio:t.devicePixelRatio,logLevel:"error"}),t.bC&&e.subscribe({load:t.bC}),e.subscribe({view_complete:function(){r.Jr=!0,t.Qv()}});var n=e.requestRedraw;e.requestRedraw=function(){n.apply(e),t.Qv()},this.Kr=z(this.Kr,this),this.Kn=z(this.Kn,this),this.rs=0,this.Rh={},this.Hd={}}function Jl(t){var e;for(e in t=t.m.sources){var r=t[e];if(r.hasPendingCommands&&r.hasPendingCommands())return!0}return globalThis.H.gl.Task.hasPendingTasks()}function Kl(t){t.Jr=!1,t.m.resetViewComplete()}function Ll(t){return t.m.view}function Ml(t,e){function r(){var r,n,o,a,s,l=e.Ta(),u={},c={},h=++t.rs;for(Bg(c,Il),n=0;n<l.length;n++){var p=l[n];if(r=p.D){var f=r.mb();if(f.getState()===ah.READY){var d=f.Sd();if(!Oa(d)){for(o in delete d.cameras,delete d.camera,u[n]=d=Ng(d,n),!B(p,Cl)&&d.sources&&Og(d,r.uid),d.sources){var y=d.sources[o];y.max_zoom=kd(r.max,Gl.lookAt.zoom.max),y.max_display_zoom=p.max,y.min_display_zoom=p.min,(s=r.tileSize)&&(2<=i&&256<s&&r instanceof Sj&&(s/=2),y.tile_size=s)}(a=f.Lc())&&Pg(d,a),Bg(c,d)}}}}return Bg(c.layers.skybox.draw.skybox.color,c.scene.sky),t.m.config=c,t.m.updateConfig().then((function(){var e,r,i={};if(h!==t.rs)return!1;for(r in t.rs=0,u){p=l[+r];var n=u[r].sources;for(e in n)(n=t.m.sources[e])&&(i[e]=n,n.initialize&&p.getProvider()&&n.initialize(p.getProvider(),t.Kr,t.m.getWorkers().length,n.tiled?A:t.m.tile_manager.getWorkerForTile(x,n)))}for(e in t.Rh)!i[e]&&t.Rh[e].dispose&&t.Rh[e].dispose();return t.Rh=i,!0}))}var i=t.m.pixelRatio();t.m.initialized?r():t.m.load(x,{blocking:!1}).then(r)}function Nl(t,e){var r=t.m.tile_manager;r.removeTiles(t.Kn),r.updateTilesForView(),e&&r.removeCachedTiles(t.Kn),Kl(t),t.Hd={}}function Ol(t,e,r,i){t.m.getFeatureAt(e,r,i),t.m.update()}function Pl(t){return t.m.screenshot(void 0).then((function(t){return new Vb((function(e,r){new Uh(URL.createObjectURL(t.blob),(function(t,i){1===t?e(i.getData()):r()}),!1)}))}))}t("H.map.render.webgl.capabilities",Gl),u(Hl,Ac),m=Hl.prototype,m.Jr=!1,m.L=function(){var t=globalThis.H.gl.Task;return this.m.immediateRedraw(),t.setState({user_moving_view:this.m.view.user_input_active}),t.processAll(),this.Jr&&!this.m.dirty&&!this.m.building&&!Jl(this)&&!Object.keys(this.Hd).length},m.Kr=function(t,e,r){var i=this,n=this.m.sources[t],o=r&&r.isReload;e?!0!==this.Hd[t]&&(this.Hd[t]||(this.Hd[t]={sx:{},it:[]}),B(e,gj)?this.Hd[t].sx[e.x+"/"+e.y+"/"+e.z]=!0:(e=e.boundingBox,this.Hd[t].it.push(new I(e[0],e[1],e[2],e[3])))):this.Hd[t]=!0,n&&n.has_volatile_data?Nl(this,o):(globalThis.clearTimeout(this.Bw),this.Bw=globalThis.setTimeout((function(){return Nl(i,o)}),100))},m.Kn=function(t){var e=!1,r=this.Hd[t.source.name],i=globalThis.H.gl;if(r)if(!0===r)e=!0;else{var n=i.Tile.coord(i.Geo.wrapTile(t.coords));if(!(e=!!r.sx[n.key])){var o=i.Geo.getTileBoundingBox(n,t.source.tile_size,M.MAX_LINE_WIDTH/2);o=Ee(o.getTopLeft(),o.getBottomRight()),e=r.it.some((function(t){return t.Wf(o,!0)||o.Gf(t.wb(),!0)}))}}return e},m.Sd=function(){return this.m.config},m.lb=function(){return this.m.pixelRatio()},m.disposeInternal=function(){var t=this.Rh;Hl.g.disposeInternal.call(this),this.m.destroy(),this.Hd={},t&&Object.keys(t).forEach((function(e){t[e].dispose()})),globalThis.clearTimeout(this.Bw),delete this.Rh,delete this.m},Hl.prototype.disposeInternal=Hl.prototype.disposeInternal;var Il={scene:{background:{color:"#FFFFFF"},sky:{zenith:"#347BC0",horizon:"#EDF2F9",fog:"#FFFFFF"}},lights:{default_light:{type:"directional",name:"default_light",visible:!0}},camera:{type:"perspective"},styles:{},fonts:{},sources:{skybox:{type:"SkyBox"}},layers:{skybox:{data:{source:"skybox"},draw:{skybox:{color:{}}}}},global:{}};function Ql(t,e){if(D(this.x=+t))throw new C(Ql,0,t);if(D(this.y=+e))throw new C(Ql,1,e)}function Rl(t){return rd(t.Lt(t))}function Sl(t){t=t||ke,this.IB=ab(t.HB)?t.HB:3,this.xv=ab(t.CB)?t.CB:300,this.Ix=ab(t.HD)?t.HD:3,this.xD=ab(t.wD)?t.wD:50,this.ei=[],this.clear()}function Vl(t,e){t.ik^=t.ik&e}m=Ql.prototype,m.add=function(t){return new Ql(this.x+t.x,this.y+t.y)},m.Lt=function(t){if(!B(t,Ql))throw new C(this.Lt,0,t);return(t=this.multiply(t)).x+t.y},m.multiply=function(t){if(!B(t,Ql))throw new C(this.multiply,0,t);return new Ql(this.x*t.x,this.y*t.y)},m.Va=function(t){return new Ql(this.x*t,this.y*t)},m.normalize=function(){var t=Rl(this);return 0!==t?new Ql(this.x/t,this.y/t):this},t("H.map.render.InteractionUtils",Sl),Sl.prototype.fB=function(){return this.Jh},Sl.prototype.isGestureDetected=Sl.prototype.fB,Sl.prototype.start=function(t,e){var r=rk.HEADING,i=rk.TILT;this.R&&this.clear(),this.ik=t,this.Jm=!!e,this.R=!0,this.Jh=!(t&(r|i))||t===r||t===i},Sl.prototype.start=Sl.prototype.start,Sl.prototype.store=function(t,e,r,i,n){var o=!1;if(this.R){if(o=(t=new Tl(t,e,r,i,n)).Su,this.Vn=this.af,this.af=t,this.yj){if(this.ym=!0,o){e=this.ik;var a=this.Jh;if(!a&&this.ym){n=rk.HEADING;var s=rk.TILT;r=rk.COORD,i=rk.ZOOM;var l=e&(r|s)?this.Ah(!0):Ul,u=e&i?this.jm(!0):1,c=e&n?pd(this.Bp(!0)):0,h=pd(l.x),p=pd(l.y);l=10<h||10<p,h=10<p&&p>3*h,u=.8>u||1.2<u,c=7<c,e&s&&(c||u||l&&!h?Vl(this,s):h&&(Vl(this,~s>>>0),a=!0)),!a&&e&n&&e&(r|i)&&(u||l?(Vl(this,n),a=!0):c&&(Vl(this,s),a=!0)),this.Jh=a}}}else this.yj=t,o||(this.Jh=!0);this.Jm&&this.ei.push(t)}return o},Sl.prototype.store=Sl.prototype.store,Sl.prototype.clear=function(){this.ei.length=0,this.R=this.Jm=this.ym=this.Jh=!1,this.yj=this.Vn=this.af=void 0},Sl.prototype.clear=Sl.prototype.clear,Sl.prototype.ae=function(t){return 0<(this.ik&t)},Sl.prototype.isModifierEnabled=Sl.prototype.ae,Sl.prototype.Lm=function(){return this.R},Sl.prototype.isRunning=Sl.prototype.Lm;var Ul=Wa(new Ql(0,0));function Tl(t,e,r,i,n){this.le=new K(t,e),r!==A&&(this.rg=new K(r,i),this.Su=!0),this.timestamp=n!==A?n:Fk()}function Xl(t){var e=t.le;return(t=t.rg)?new K(e.x-(e.x-t.x)/2,e.y-(e.y-t.y)/2):A}function Zl(t,e){var r=t.le;return(t=t.rg)&&t.kb(e)<r.kb(e)?t:r}function Wl(t,e){var r=t.rg,i=e.rg;return i&&r?(e=Xl(e),t=Xl(t)):r?t=Zl(t,e=e.le):i?e=Zl(e,t=t.le):(e=e.le,t=t.le),new Ql(e.x-t.x,e.y-t.y)}function Yl(t){var e=t.rg;return e?t.le.kb(e):0}function $l(t,e){if(D(this.xo=+t))throw new C($l,0,t);this.eo=this.rj=0,e&&this.Uw(e)}function S(t,e,r,i){var n;if(S.g.constructor.call(this,t,e,r,i),this.qp=new kj(this.ay),this.Xb=new K(0,0),(n=i.renderBaseBackground)&&(this.Dw=n.lower,this.Cw=n.higher),this.tj=!!i.enableSubpixelRendering,this.Kg=am,this.na=new Sl,this.T=i=new Rk,this.gg=z(this.gg,this),i.addEventListener(i.j.wo,this.gg),i=t.element,this.rc=t=i.ownerDocument.createElement("div"),t.style.position="absolute",t.style.width=t.style.height="100%",t.style.zIndex=0,i.insertBefore(t,i.firstChild),this.cl=new Yk(this.rc,this.ja),this.Um=e.Ib().position,!(e=globalThis.H.gl))throw new wb(S,'"H-webgl" module is missing');this.m=new Hl({viewport:this.za,nd:this.rc,devicePixelRatio:this.ja,Qv:z(this.ba,this)}),e.WorkerBroker.addTarget("model",ik),this.gq(),this.Tq=z(this.Tq,this),this.wg=z(this.wg,this),this.La=z(this.La,this),r.addEventListener(Nh.prototype.j.Li,this.Tq),this.s=bm,this.zoom=tk(this,this.Ee.Ub()),this.Ac(),this.ng()}Sl.prototype.Nf=function(){var t;if(this.Jm){var e=this.ei,r=e.length,i=0;for(t=new Ql(0,0);--r&&i<this.Ix;)t=t.add(Wl(e[r-1],e[r])),i++}else t=this.Ah();return t.normalize()},Sl.prototype.getDirection=Sl.prototype.Nf,Sl.prototype.nc=function(t){var e,r;if(t=t||Fk(),this.Jm){var i=this.ei,n=this.ei.length,o=this.ei[n-1];for(r=e=0;--n&&e<this.Ix;)r+=Rl(Wl(i[n],i[n-1])),e++;i=r/e}else o=this.af,i=Rl(this.Ah());return i>=this.IB&&t-o.timestamp<=this.xD?i>this.xv?this.xv:i:0},Sl.prototype.getSpeed=Sl.prototype.nc,Sl.prototype.im=function(){return this.af?Xl(this.af):A},Sl.prototype.getBifocalCenter=Sl.prototype.im,Sl.prototype.Ah=function(t){return(t=t?this.yj:this.Vn)?Wl(t,this.af):new Ql(0,0)},Sl.prototype.getMoveVector=Sl.prototype.Ah,Sl.prototype.jm=function(t){var e=1;if(this.ym){var r=this.af;(t=Yl(t=t?this.yj:this.Vn))&&(r=Yl(r))&&(e=r/t)}return e},Sl.prototype.getBifocalScaling=Sl.prototype.jm,Sl.prototype.Bp=function(t){if(this.ym){var e=t?this.yj:this.Vn,r=this.af;t=e.rg;var i=r.rg,n=0;t&&i&&(e=e.le,r=r.le,n-=zd(i.y-r.y,i.x-r.x)*Hd-zd(t.y-e.y,t.x-e.x)*Hd),t=n}else t=0;return t},Sl.prototype.getBifocalRotation=Sl.prototype.Bp,Tl.prototype.Su=!1,t("H.util.kinetics.KineticMove",$l),$l.prototype.Uw=function(t){return this.eo=t,this.rj=this.gu(),this},$l.prototype.setInitialSpeed=$l.prototype.Uw,$l.prototype.gu=function(){return Math.abs(this.eo/this.xo)},$l.prototype.getDuration=$l.prototype.gu,$l.prototype.Hj=function(t){return this.eo+this.xo*t},$l.prototype.getCurrentSpeed=$l.prototype.Hj,$l.prototype.Ez=function(t){return this.eo*t+this.xo*t*t/2},$l.prototype.getCurrentPath=$l.prototype.Ez,u(S,ok),t("H.map.render.webgl.RenderEngine",S),S.prototype.ay=100,S.prototype.Ib=function(){var t=this.Um;return uk(this,{position:{pB:t.pB,wB:t.wB},zoom:this.zoom,tilt:this.ux,heading:this.heading})},S.prototype.Tq=function(t){((t=(t=t.target.D)&&t.mb())&&t.getState())===ah.INIT?t.load():(Kl(this.m),Ml(this.m,this.ib),this.ba())},S.prototype.type=xk.WEBGL;var bm=2;function cm(t,e,r){function i(t){return n[t]+Pk(n[t],e[t])/2}if(!(r&Gj.POSITION||r&Gj.BOUNDS))return null;var n=Ll(t.m).getLookAtData();r=n.position;var o=e.position,a=e.bounds;return Df(n.bounds,o.lat,o.lng,!1)||a&&Df(a,r.lat,r.lng,!1)?null:((r=dm(t,{tilt:i("tilt"),heading:i("heading"),incline:0,bounds:Fe([r,o])})).zoom=tk(t,r.zoom-.5),delete r.bounds,r)}function em(t,e,r,i){return t=t.getCapabilities().lookAt[i],pd("zoom"===i?r[i]-e[i]:Pk(e[i],r[i]))/(t.max-t.min)||0}function fm(t,e,r){return Nd(3e3*(t=ld(8*em(t,e,r,"zoom"),em(t,e,r,"heading"),em(t,e,r,"tilt")/2)),300,4e3)}function dm(t,e){return hm(e),Ll(t.m).getBestLookAtData(e)}function hm(t){var e=t.bounds;!e||e instanceof L||(t.bounds=Af(e.C()))}function jm(t,e,r){Ll(t.m).setLookAtData(e),Kl(t.m),im(t),t.ba(),r&&setTimeout(r,0)}function gm(t,e,r,i){var n=Ll(t.m).getLookAtData(),o=new Ok(n,e);0!==o.cg.tilt+o.cg.heading+o.cg.zoom+o.kh?t.cd((function(e){for(var r in o.cg)if(0!==o.cg[r]){var i=o.Ev[r](e);n[r]+=o.cg[r]*(i-o.gv[r]),o.gv[r]=i}return 0!==o.kh&&(n.position=o.bp.mo(o.ry,o.kh*o.Ev.position(e),!0)),jm(t,n)}),r,(function(){return jm(t,e,i)})):jm(t,e,i)}function km(t,e){t.qp.ia((function(t,r){return r.Jb()===e}))}function lm(t){return!(B(t,Th)||B(t,Rh))}function im(t){var e=Ll(t.m).getLookAtData();t.zoom=e.zoom,t.Um=e.position}function mm(t,e){return new K((e=Ll(t.m).geoToMeters(e)).x/t.Fs+.5,1-(e.y/t.Fs+.5))}function nm(t,e){return e.sub(mm(t,t.Um)).scale(sd(2,8+t.zoom))}function om(t,e,r,i,n,o,a,s){var l,u,c,h=0,p=function(){0==--h&&o(n)};if(s&&s.features)for(h=u=s.features.length,c=0;c<u;c++){var f=s.features[c],d=f.id;if(l=t.m.m.sources[f.source_name]){var y=l.provider,g=y.ru();if(g===Ch.SOURCE){var v=f.source_layer;if("overlays"===v)pm(t,e,r,i,n,l,f.properties.overlays_config);else if(l=l.getMapObjectById(d))if("markers"!==v)n.push(l);else if(qm(t,e,r,l))n.push(l);else if(i&&!a){var m=!0;Ol(t.m,{x:e,y:r},{radius:3.5,top_most_only:!1},(function(a){om(t,e,r,i,n,o,!0,a)}))}h--}else g===Ch.FEATURE?(v=f.tile.coords,(m=y.getFeatureProxy(f.properties,v,(function(t){t&&(t.Xw(y),n.push(t)),p()})))||((l=t.qp.get(d))||((l=new Wf(f)).ea(y),t.qp.add(d,l,1)),n.push(l),h--)):g===Ch.PROVIDER&&(m=!0,y.Gw(f,!1).then((function(t){t&&(!(t instanceof fi)||qm(this,e,r,t))&&n.push(t),p()}),(function(){p()}),t))}}g&&(m||0!==h)||o(n)}function pm(t,e,r,i,n,o,a){var s;for(t=t.Wa(e,r),e=a.length;e--&&(!(s=o.getMapObjectById(a[e].id))||0<=n.indexOf(s)||!s.V().Gf(t)||(n.push(s),!i)););}function qm(t,e,r,i){var n,o=i.kc(),a=o.Am,s=!a;if(a)if(e+=(o=o.Db).x,r+=o.y,B(o=i.V(),ei))for(n=(i=o.ha).length;n--&&!s;)o=t.La(i[n]),s=a.Bm(e-o.x,r-o.y,0)!==Pd.NONE;else o=t.La(o),s=a.Bm(e-o.x,r-o.y,0)!==Pd.NONE;return s}S.prototype.getState=function(){return this.s},S.prototype.getState=S.prototype.getState,S.prototype.Ej=function(t,e){t=e-t;var r=sd(2,8+this.zoom);return t<r/2?t:t-r*e/pd(e)},S.prototype.mr=!1,S.prototype.ar=function(t){var e=this,r=t.newValue,i=t.modifiers,n=Ll(this.m);this.Jg(),this.Xb.set(0,0);var o=this.Do(r);if(ck.forEach((function(e){i&t[e.toUpperCase()]||delete o[e]})),t.animate){n=Ll(this.m).getLookAtData();var a=dm(this,o);r=cm(this,a,i);var s=1;jb(t.animate)&&(s=1/t.animate);var l=function(){return e.mr=!1};if(delete a.bounds,this.mr=!0,r){n=fm(this,n,r);var u=fm(this,r,a);gm(this,r,n*s,(function(){return gm(e,a,u*s,l)}))}else r=fm(this,n,a),gm(this,a,r*s,l)}else hm(o),n.setLookAtData(o);im(this),Kl(this.m),this.ba()},S.prototype.Wn=function(){},S.prototype.setAnimationDuration=S.prototype.Wn,S.prototype.zp=function(){},S.prototype.getAnimationDuration=S.prototype.zp,S.prototype.Xn=function(){},S.prototype.setAnimationEase=S.prototype.Xn,S.prototype.Ap=function(){},S.prototype.getAnimationEase=S.prototype.Ap,S.prototype.Qn=function(){},S.prototype.resetAnimationDefaults=S.prototype.Qn,m=S.prototype,m.Ov=function(t){km(this,t.target.D),Kl(this.m),this.ba()},m.pk=function(t,e){S.g.pk.call(this,t,e),lm(e)&&(Kl(this.m),(t=(t=e.D)&&t.mb())&&t.getState()===ah.INIT&&t.load())},m.Uq=function(t,e,r){var i;if(this.$j=Fk(),km(this,e.D),e.requestDomMarkers||B(e,Rh)||B(e,Th)){var n=this.re.ka;for(i=n.length;i--;){var o=n[i];if(o.Tb()===e){n.splice(i,1),o.l();break}}}lm(e)&&Ml(this.m,this.ib),this.bf=this.ib.Ta(),0===t&&(sk(this,e,!1),this.Ac()),Zk(this.cl,this.Tf(),this.Qf()),this.li(),r||this.ba()},m.gq=function(){var t=this.ib.Ta(),e=0,r=t.length;for(this.re={Qe:[],ka:[]},this.bf=t;e<r;e++){var i=t[e];this.pk(e,i),sk(this,i,!0)}this.Ac()},m.Vq=function(){this.Ac()},m.Ac=function(){S.g.Ac.call(this);var t=this.getCapabilities().lookAt.zoom;Ll(this.m).setZoomConstraints(ld(t.min,this.zq),kd(t.max,this.yq))},m.hq=function(t,e){var r;if(e){if(t={Qd:this.tj,Ab:this.Ab},e.L?(B(e,Rh)||B(e,Th))&&(r=new $k(e)):e.requestDomMarkers&&(r=new dl(e,t)),r){this.re.ka.push(r);var i=this.ib.Ta();this.re.ka.sort((function(t,e){return i.indexOf(t.yb)-i.indexOf(e.yb)})),Zk(this.cl,this.Tf(),this.Qf())}lm(e)&&Ml(this.m,this.ib)}this.bf=this.ib.Ta()},m.Qf=function(){return this.re.ka.filter(ab)},m.Po=function(){return this.s===bm},m.Do=function(t){var e=t.position;return uk(this,{zoom:tk(this,t.zoom),position:new xe(e.lat,e.lng),tilt:t.tilt,heading:t.heading,bounds:t.bounds})},m.Fs=40075016.68557849,m.La=function(t){return Ll(this.m).geoToPixel(t)},S.prototype.geoToScreen=S.prototype.La,S.prototype.Wa=function(t,e){return Ll(this.m).xyToGeo(t,e)},S.prototype.screenToGeo=S.prototype.Wa,S.prototype.Un=function(t,e){return t=this.Wa(t,e),(e=this.Ee.Ib()).position=t,e},S.prototype.Ma=function(t,e,r,i){var n=this,o=[];o=this.Mp(o,this.re.ka,t*this.ja,e*this.ja,r),r&&o.length?i(o):this.m.m.initialized?Ol(this.m,{x:t,y:e},{radius:3.5,top_most_only:r},(function(a){om(n,t,e,r,o,i,!1,a)})):i(o)},S.prototype.getObjectsAt=S.prototype.Ma,m=S.prototype,m.Mp=function(t,e,r,i,n){for(var o,a=e.length;a--&&!((o=e[a])&&o.Ma&&(t=t.concat(o.Ma(r,i,n)),t.length&&n)););return t},m.ye=x,m.Tf=function(){var t=this.rl[2];return{w:t.right-t.left,h:t.bottom-t.top}},m.ng=function(){var t=this.re.ka.length;pk(this,this.ja),this.Xb.set(0,0);var e=this.Tf(),r=e.w,i=e.h;for(this.m.m.handleViewportUpdate();t--;){var n=(e=this.re.ka[t].Pb).mc();n.w===r&&n.h===i||e.Uk(r,i)}this.ye=new Ph(r,i),Kl(this.m),this.ba()},m.getCapabilities=function(){return Gl},S.prototype.getCapabilities=S.prototype.getCapabilities,m=S.prototype,m.Lk=function(){this.ta&&this.ta.R||(Jl(this.m)||Fk()-this.$j<this.Kg)&&!this.oe?this.rh||(this.rh=Dk(this.wg)):(this.oe&&(this.li(),this.pj()),this.s=bm)},m.rh=0,m.li=function(){this.re.Qe.length=0},m.wg=function(){this.rh=0,this.ff&&this.ff.before();var t=Ll(this.m),e=t.getLookAtData(!1),r=t.getLookAtData(!0);t=this.za.center.clone(),r=r.bounds.C();var i=this.zoom,n=this.Xb,o=this.bf,a=o.length;for(this.Kg=am;a--;){var s=o[a];B(s,Nh)&&s.D&&s.D.xk(r,i)}this.oe=this.m.L(),this.Ee.rb(e),this.oe=this.Ln(r,t,i,!1,n,this.re)&&this.oe,this.ye&&(this.za.rb(this.ye),this.ye=x),this.ta&&this.ta.R&&this.Fo(),this.ff&&this.ff.after(),this.Lk()},m.Ln=function(t,e,r,i,n,o){var a,s=o.ka.length,l=!0;for(a=0;a<s;a++){var u=o.ka[a],c=o.Qe;if(u){var h=u.L(t,e,void 0,r,i,n,this.La,this.m.m.getCameraMatrix());h===vg.ACTIVE&&(this.Kg=1/0),h!==vg.DONE||c[a]||(this.pj(u.Tb()),c[a]=!0),c[a]||(l=!1)}}return l},m.pj=function(t){this.mr||setTimeout(z(this.dispatchEvent,this,{type:this.j.Us,target:t||this}),1)},m.disposeInternal=function(){var t=this.ib.Ta()[0],e=this.za;Ek(this.rh),this.dd(!0),t&&sk(this,t,!1),this.Qf().forEach((function(t){t.l()})),e.element&&e.element.removeChild(this.rc),delete this.rc,this.s=3,this.m.l(),S.g.disposeInternal.call(this)},m.ba=function(){this.$j=Fk(),this.Po()&&(this.oe=!1,this.s=1,this.Lk())},m.Bc=function(t,e){this.Sg(t,e),this.Xb.set(0,0),Kl(this.m),this.ba()},m.Sg=function(t,e){Ll(this.m).applyPxOffset([t,e]),im(this)},m.Ng=function(t,e,r){t=tk(this,tk(this,t)),this.sb(t,e,r)},S.prototype.zoomAt=S.prototype.Ng,S.prototype.sb=function(t,e,r){Ll(this.m).setLookAtData({zoom:t},jb(e)&&jb(e)?[e,r]:A),im(this),Kl(this.m),this.ba()},S.prototype.Jg=function(){this.dd(!0),this.T.R&&this.hc(!0),this.na.R&&this.ic(!0)},S.prototype.Rk=function(t){if(t){var e={};e.wk=t.power,e.sj=t.ease,e.duration=t.duration,this.ua=e}},S.prototype.Jd=function(t,e){var r=!!(e||t&(rk.HEADING|rk.TILT));this.Jg(),this.Rk(e),this.na.start(t,r),Ll(this.m).setPanning(!0)},S.prototype.startInteraction=S.prototype.Jd,S.prototype.wd=function(t,e,r,i,n){var o=this.na,a=!1;if(o.R){var s=Ll(this.m),l=s.getLookAtData(),u=this.za.center;u=[u.x,u.y],e=o.store(t,e,r,i,n),r=o.im(),t=o.Ah(),i=this.na.jm(),n=this.na.Bp(),o.Jh&&(o.ae(rk.TILT)&&(s.setLookAtData({tilt:vk(this,l.tilt+t.y/this.za.height*-180)},u),a=!0),e&&1!==i&&o.ae(rk.ZOOM)&&(a=o.im(),this.sb(tk(this,qd(sd(2,this.zoom)*i)/Ad),a.x,a.y),a=!0),o.ae(rk.COORD)&&0<Rl(t)&&(this.Bc(-t.x,-t.y),a=!0),o.ae(rk.HEADING)&&(e?s.setLookAtData({heading:l.heading+wk(this,n)},[r.x,r.y]):t.x&&s.setLookAtData({heading:wk(this,l.heading+t.x/this.za.width*360)},u),a=!0),a&&(Kl(this.m),this.ba()))}},S.prototype.interaction=S.prototype.wd,S.prototype.ic=function(t){var e=this;if(this.na.R&&!t){if(this.ua){t=this.na.nc();var r=this.na.Nf(),i=this.ua.duration,n=(this.ua.wk||1)*t,o=new $l(-n/(0<i?i:1),n);!D(r.x)&&!D(r.y)&&0<n&&e.na.ae(rk.COORD)&&this.cd((function(t){n=o.Hj(t*i),D(n)||e.Bc(md(-r.x*n),md(-r.y*n))}),i,void 0,this.ua.sj)}delete this.ua,this.na.clear()}Ll(this.m).setPanning(!1),this.ba()},S.prototype.endInteraction=S.prototype.ic,S.prototype.Id=function(t,e,r){this.Jg(),this.T.start(e,r),this.Rk(t),Ll(this.m).setPanning(!0)},S.prototype.startControl=S.prototype.Id,S.prototype.control=function(t,e,r,i,n,o){for(var a,s=0;s<arguments.length;s++)if((a=+arguments[s])!=a)throw new C(this.control,s,a);this.T.R&&this.T.set(t,e,r,i,n,o)},S.prototype.control=S.prototype.control,S.prototype.hc=function(t,e){var r,i=this;if(this.T.R){this.dd(!0);var n=Fk(),o=n-this.jj;if(1<=o){var a=Uk(this.T);this.Qi(a,o)}if(!this.ua||t||e)"function"==typeof e&&(e(t=(t=Ll(this.m)).getLookAtData()),this.Go(t));else{e=this.T.nc();var s=this.T.Nf(),l=this.ua.duration,u=(this.ua.wk||1)*e,c=new $l(-u/(0<l?l:1),u);!D(s.Lb)&&!D(s.Mb)&&0<u&&this.cd((function(t,e,o,a){n&&(o=a-n,n=0),u=c.Hj(t*l)*o,D(u)||((r=s.Nb*u)&&i.sb(tk(i,i.zoom+r),i.T.Ug,i.T.Vg),i.Bc(md(s.Lb*u),md(s.Mb*u)))}),l,void 0,this.ua.sj)}this.T.reset(),Ll(this.m).setPanning(!1),this.ba()}},S.prototype.endControl=S.prototype.hc,m=S.prototype,m.Go=function(t){var e=this,r=nm(this,mm(this,t.position)),i=r.y;r=r.x;var n=t.zoom,o=nm(this,mm(this,this.Um));t=o.y;var a=o.x;o=this.zoom;var s=this.T.nc(),l=this.T.Ug,u=this.T.Vg,c=0;if(r=this.Ej(a,r),t=rd((r-=a)*r+(i-=t)*i+(o=n-o)*o),0!==s&&0!==t){var h=r/t,p=i/t,f=o/t,d=s*s/(2*t);this.cd((function(t,r){var i;1!==t?((i=f*(r=(t=s*r-d*r*r/2)-c))&&(i=tk(e,e.zoom+i),e.sb(i,l,u)),e.Bc(md(h*r),md(p*r)),c=t):(e.sb(tk(e,n),l,u),e.ba())}),2*t/s)}},m.gg=function(t){var e=this,r=t.mt;this.Xb.set(0,0),r.Lb||r.Mb||r.Nb||r.mi||r.ni||r.Jk?(this.jj=Fk(),this.cd((function(t,i,n,o){e.jj=o,e.Qi(r,n)}),Id),this.ba()):this.dd(!0)},m.Qi=function(t,e){e=e||0;var r=this.T,i=Ll(this.m),n=i.getLookAtData();t.Nb&&this.sb(tk(this,n.zoom+t.Nb*e),r.Ug,r.Vg),i.setLookAtData({heading:wk(this,n.heading+t.ni*e),tilt:vk(this,n.tilt+t.mi*e)}),im(this),this.Bc(t.Lb*e,t.Mb*e)},m.cd=function(t,e,r,i){this.ta&&this.ta.R&&this.ta.stop(!0),this.ta=new jl(this,t,e,r,i),this.ta.start()},m.dd=function(t){this.ta&&this.ta.R&&this.ta.stop(t)},m.kp=function(){},S.prototype.enter=S.prototype.kp,S.prototype.pp=function(t){qk(this.rc,t)},S.prototype.exit=S.prototype.pp,S.prototype.capture=function(t,e,r,i){var n=this;return Pl(n.m).then((function(o){var a=n.rc.ownerDocument.createElement("canvas"),s=n.ja,l=a.getContext("2d"),u=n.m.lb()/s,c=(r-t)*s;return s*=i-e,a.width=c,a.height=s,l.drawImage(o,t*u,e*u,c*u,s*u,0,0,c,s),a}))},S.prototype.oz=function(t){return Ll(this.m).geoToMeters(t)},S.prototype.geoToMeters=S.prototype.oz,S.prototype.FB=function(t){return Ll(this.m).metersToGeo(t)},S.prototype.metersToGeo=S.prototype.FB;var am=5e3,tm,um;function rm(){if(this.constructor=this.constructor,!gb("STATIC_DB"))throw new C(this.constructor,0);if(this.Ku=sm(),!this.Ku)throw new wb(this.constructor,"This browser does not support IndexedDB");this.MB="STATIC_DB",this.hf=[],this.Xh=[],this.$q=z(this.$q,this)}function ym(t,e,r){if(t.og)t.hf?(t.hf.push(e),r&&t.Xh.push(r)):t.pn?r&&r(t.pn):e(t.og.result);else{t.og=t.Ku.open("H_"+t.MB,1),t.og.onupgradeneeded=t.$q;var i=t.og.onerror=function(){clearTimeout(t.Vv),t.pn=this.error,t.Xh.forEach((function(e){e(t.pn)})),delete t.hf,delete t.Xh};t.Vv=setTimeout((function(){i.call({error:Error("DbOpenTimeoutError")})}),t.Tx),t.og.onsuccess=function(){clearTimeout(t.Vv),t.hf?(t.hf.forEach((function(t){t(this.result)}),this),delete t.hf,delete t.Xh):(delete t.og,delete t.pn,t.hf=[],t.Xh=[])},t.hf.push(e),r&&t.Xh.push(r)}}function wm(t,e,r){ym(t,(function(r){r=r.transaction([t.yl],"readwrite"),e(r.objectStore(t.yl))}),r)}function xm(t,e,r){e&&(t.onsuccess=function(){e(this.result)}),r&&(t.onerror=function(){r(this.error)})}function vm(t){var e=Object.prototype.toString.call(t);return"[object Blob]"===e||"[object ArrayBuffer]"===e||gb(t)||ya(t)}function zm(){return tm||(tm=new rm),tm}function sm(){return globalThis.indexedDB||globalThis.webkitIndexedDB||globalThis.mozIndexedDB||globalThis.msIndexedDB}function Am(){var t="";if(!ab(um))if("file:"===window.location.protocol&&-1<navigator.userAgent.toLowerCase().indexOf("firefox")&&128<=window.location.href.length)um=!1;else{try{var e=sm();t="H_TEST_DB";var r=e&&e.open(t,1)}catch(t){}um=!!r&&null===r.onupgradeneeded,r&&e.deleteDatabase&&e.deleteDatabase(t)}return um}function Bm(t,e){Bm.g.constructor.call(this,!1,e),this.X(t)}function Cm(t,e){if(!B(t,J)||2>t.Mj())throw new C(e,0)}function Dm(t,e,r,i){var n=lf(e,r.nm());if(n.length&&(n=(t=fg(t,n,!1,e=r.pm())).length)){var o=r.Pj();e=e.w,r.x||hg(t,n,-e),r.x===(1<<r.z)-1&&hg(t,n,e),(r=of(t,o.left,o.top,o.right,o.bottom,!1)).length&&i.push(new Hf(r))}}function T(t){var e={};this.Fu=e.previousSibling=e.nextSibling=e,this.iD=new de,T.g.constructor.call(this,t),t&&"objects"in t&&this.kd(t.objects)}function Em(t,e,r){t.ti(r.D)}function Fm(t){t.Hk()}function Gm(t,e,r){t.ra(r.Zt)}function Hm(t){this.push(t)}function Im(t,e){for(var r,i=0,n=e.length,o=[];i<n;i++)r=(r=e[i])instanceof T?{type:"GeometryCollection",geometries:Im(t,r.bb())}:r instanceof fi||r instanceof $i||r instanceof Bm||r instanceof ng?r.V().ze():{type:"FeatureCollection",features:je},o.push(r);return o}function Jm(t,e,r,i,n,o){Jm.g.constructor.call(this,isNaN(t)?15:t,e,r,i,n,o)}function Km(t,e){this.id=Xe++,this[0]=e,this[1]=t}function Lm(){this.Be=new Jm(10,180,90,0,0,!0)}function Mm(t){var e;for(e in bb(this,Mm),Mm.g.constructor.call(this,t),this.Xf=t=[],Yf)t[Yf[e]]=new Kf}function P(t){t=t||{},P.g.constructor.call(this,t),this.Bg=t=new T({min:t.min,max:t.max}),t.D=this,t.ea(this),t.ra(Lf.ADD),this.rk=new bf,this.xi=new bf,this.ek=new Lm,this.jk=new bf,this.bm=new Lm,this.Zm=new bf}function Nm(t,e,r,i,n,o,a){if(a=a||[],e.jc)for(t=e!==t.ek&&e!==t.jk,n=!n,r=(e=e.Fm(r,o,o)).length,o=0;o<r;o++){var s,l=e[o].Cs;if(s=void 0!==i){for(var u=nd(i),c=l;(s=c.zb<=u&&c.Qc>=u)&&(c=c.Na););s=!s}s||!n&&!l.Wd(!0)||(t||1===l.kc().getState())&&a.push(l)}return a}function Om(t,e,r,i,n){var o=Nm(t,t.ek,e,r,i,n);return Nm(t,t.jk,e,r,i,n,o),o}function Pm(t,e,r,i,n){var o=Nm(t,t.bm,e,r,i,n);return Nm(t,t.Zm,e,r,i,n,o),o}function Qm(t,e,r){var i,n=r.V(),o=Rm.bind(null,t);t=Sm.bind(null,t),B(r,Bm)?i=B(n,J)?o(n):n.ha.some(o):B(r,ng)?i=B(n,L)?t(n):n.ha.some(t):B(r,$i)&&(i=t(Af(n))),i&&e.push(r)}function Rm(t,e){t:{var r=e.S,i=Ff(t,e);if(!i){e=e.S.length;for(var n=0;n<e;n+=3)if(Df(t,r[n],r[n+1])){t=!0;break t}}t=i}return t}function Sm(t,e){return Gf(t,e)}function Tm(t,e,r){for(var i=t.length;i--;){var n=t[i],o=n.V();if(B(o,ei)){for(var a,s=(o=o.ha).length;s--;)if(Df(e,(a=o[s]).lat,a.lng)){r.push(n);break}}else Df(e,o.lat,o.lng)&&r.push(n)}}function U(t,e,r){var i={};if(!(t instanceof HTMLElement))throw new C(U,0);if(U.g.constructor.call(this),this.Fa=Um(r,U),this.xa=r=new Uj,this.Fq=!1,r.addEventListener(r.j.Oi,this.Rv,!1,this),!B(t,Element))throw new C(U,0,t);var n=(r=this.G=t.ownerDocument.createElement("div")).style;if(n.position="relative",n.height=r.style.width="100%",n.overflow="hidden",n.webkitTapHighlightColor="transparent","transparent"!==n.webkitTapHighlightColor&&(n.webkitTapHighlightColor="rgba(0,0,0,0)"),t.appendChild(r),this.sa=new nk(this.G,this.Fa),this.sa.addEventListener(this.sa.j.Oi,this.Rv,!1,this),(t=this.O=new ik(this.Fa.layers)).addEventListener(t.j.Ni,this.Rq,!1,this),t.addEventListener(t.j.Ki,this.Rq,!1,this),t.addEventListener(t.j.Mi,this.Rq,!1,this),!this.qb&&Vm(this),this.pa=null,this.O.add(e,0),this.Ca=this.Yo(null!=this.Fa.engineType?this.Fa.engineType:Dh,this.Fa),this.jp=z(this.jp,this),(e=this.Fa.imprint)!==A&&"object"!=typeof e)throw new C(U,1,"imprint");this.Yd=null===e?e:new Ij(this,e),e=this.Fa.autoColor,this.ht=e===A||!!e,Wm(this),(e=this.Fa.zoom)&&(i.zoom=e),(e=this.Fa.bounds)&&(i.bounds=e),(e=this.Fa.center)&&(i.position=e),this.xa.ad(i)}function Um(t,e){if(t){var r=t.pixelRatio;if(r===A)t.pixelRatio=Vd();else if(!(0<r))throw new C(e,0,"pixelRatio: "+r)}else(t={}).pixelRatio=Vd();return t.renderBaseBackground||(t.renderBaseBackground={lower:3,higher:2}),t}function Wm(t){t.Yd&&t.ht&&t.Yd.Ur({invert:t.pa&&t.pa.My})}function Xm(t,e,r){t.dispatchEvent(r?new Fj(t.j.Ns,r.newValue,r.oldValue,r.modifiers):t.j.Ns+e)}function Ym(t){Bj.call(this,t)}function Vm(t){t.sc=new P({max:24,engineType:t.Fa.engineType}),t.qb=new Cl(t.sc,t.Fa),t.O.add(t.qb)}m=rm.prototype,m.put=function(t,e,r,i){if(!gb(t)&&!jb(t))throw new C(this.put,0);if(!vm(e))throw new C(this.put,1);wm(this,(function(n){xm(n.put(e,t),r,i)}),i)},m.get=function(t,e,r){var i;if(!gb(t)&&!jb(t))throw new C(this.get,0);if(!Za(e))throw new C(this.get,1);return wm(this,(function(n){xm(i=n.get(t),e,r)}),r),{cancel:function(){i&&(i.onsuccess=ie)}}},m.remove=function(t,e,r){if(!gb(t)&&!jb(t))throw new C(this.remove,0);wm(this,(function(i){xm(i.delete(t),e,r)}),r)},m.clear=function(t,e){wm(this,(function(r){xm(r.clear(),t,e)}),e)},m.yl="data",m.Tx=500,m.$q=function(){var t=this.og.result;t.objectStoreNames.contains(this.yl)||t.createObjectStore(this.yl)},t("H.util.IndexedDBStorage.getInstance",zm),t("H.util.IndexedDBStorage.isSupported",Am),u(Bm,eg),t("H.map.Polyline",Bm),Bm.prototype.C=function(){return this.Hb.C()},Bm.prototype.getBoundingBox=Bm.prototype.C,Bm.prototype.X=function(t){var e,r,i=this.X;if(B(t,ii)){var n=t.ha;if(!(e=n.length))throw new C(i,0);for(r=0;r<e;r++)Cm(n[r],i)}else Cm(t,i);return this.Vf=!!n,this.Hb=t,this.ra(Lf.SPATIAL),this},Bm.prototype.setGeometry=Bm.prototype.X,Bm.prototype.V=function(){return this.Hb},Bm.prototype.getGeometry=Bm.prototype.V,Bm.prototype.clip=function(t){var e=this.Hb;return lf(this.Vf?e.ha[0]:e,t)},Bm.prototype.clip=Bm.prototype.clip,Bm.prototype.xh=function(t){var e,r=this.Hb,i=[];if(this.Vf)for(e=(r=r.ha).length;e--;)Dm(this,r[e],t,i);else Dm(this,r,t,i);return i.length?i:A},Bm.prototype.getGeometriesForTile=Bm.prototype.xh,Bm.prototype.P=function(){var t=Bm.g.P.call(this),e=t.properties;return t.geometry=this.V().P(),e.style=this.K().P(),e.height=0,t},Bm.prototype.forWorkerMessage=Bm.prototype.P,u(T,N),t("H.map.Group",T),T.prototype.type=Yf.GROUP,T.prototype.ti=function(t,e){return this.lr=!0,t=T.g.ti.call(this,t,e),this.lr=!1,t&&this.forEach(Em,!0),t},T.prototype.setProvider=T.prototype.ti,T.prototype.contains=function(t){var e=this===t;if(!e&&this.ah&&B(t,N))for(;!e&&t;)t===this?e=!0:t=t.Na;return e},T.prototype.contains=T.prototype.contains,T.prototype.Hk=function(){this.qo=A,this.forEach(Fm,!0)},T.prototype.resetZInfo=T.prototype.Hk,T.prototype.lr=!1,T.prototype.ra=function(t){var e=T.g.ra.call(this,t);return e&&!this.lr&&(this.Zt=t,this.forEach(Gm,!0),delete this.Zt),e},T.prototype.invalidate=T.prototype.ra,T.prototype.forEach=function(t,e,r){var i;if(this.ah){var n=this.Fu,o=n.nextSibling;for(i=0;o!==n;){var a=o.nextSibling;t.call(r,o,i++,this),e&&B(o,T)&&o.forEach(t,e,r),o=a}}},T.prototype.forEach=T.prototype.forEach,T.prototype.bb=function(t){var e=[];return this.forEach(Hm,t,e),e},T.prototype.getObjects=T.prototype.bb,T.prototype.C=function(){var t=null;return this.ah&&this.forEach((function(e){e.C&&(e=e.C())&&(t=t?t.zd(e):e)})),t},T.prototype.getBoundingBox=T.prototype.C,T.prototype.ah=0,T.prototype.zz=function(){return this.ah},T.prototype.getChildCount=T.prototype.zz,T.prototype.Y=function(t){var e=this.Fu,r=e.previousSibling;if(B(t,N,this.Y,0),t.contains(this))throw new wb(this.Y,"The new object contains the parent group");var i=t.sm(!0),n=t.Na;if(n!==this){if(n){n=t.previousSibling;var o=t.nextSibling;n.nextSibling=o,o.previousSibling=n}t.Na=this,N.g.ea.call(t,this),r.nextSibling=t,t.previousSibling=r,t.nextSibling=e,e.previousSibling=t,this.ah++}return t.ds=this.iD.next(),t.Hk(),e=t.ti(this.D,this.Y),t.sm(!0)!==i&&t.ra(Lf.VOLATILITY),e||t.ra(Lf.Z_ORDER),t},T.prototype.addObject=T.prototype.Y,T.prototype.kd=function(t){var e;fb(t,this.kd,0);var r=t.length;for(e=0;e<r;e++)this.Y(t[e])},T.prototype.addObjects=T.prototype.kd,T.prototype.Oa=function(t){if(!t||t.Na!==this)throw new wb(this.Oa,"object not found");var e=t.previousSibling,r=t.nextSibling;return e.nextSibling=r,r.previousSibling=e,t.Na=null,N.g.ea.call(t,null),delete t.previousSibling,delete t.nextSibling,B(t.D,P)&&t.ti(null,this.Oa),this.ah--,t},T.prototype.removeObject=T.prototype.Oa,T.prototype.vg=function(t){var e;fb(t,this.vg,0);var r=t.length;for(e=0;e<r;e++)this.Oa(t[e])},T.prototype.removeObjects=T.prototype.vg,T.prototype.ia=function(){var t=this.bb();this.vg(t)},T.prototype.removeAll=T.prototype.ia,T.prototype.ze=function(t){for(var e,r,i,n=this.bb(),o=0,a=n.length,s=[];o<a;o++)(i=n[o])instanceof T?(r=ag(this,e=t?t(i.getData()):i.getData(),!!t),(e={type:"Feature"}).properties=r,i.gi&&(e.id=i.gi),e.geometry={},e.geometry.type="GeometryCollection",e.geometry.geometries=Im(this,i.bb()),s.push(e)):s.push(i.ze(t));return{type:"FeatureCollection",features:s}},T.prototype.toGeoJSON=T.prototype.ze,T.prototype.P=function(){var t=T.g.P.call(this);return t.type="Group",t},T.prototype.forWorkerMessage=T.prototype.P,u(Jm,Re),Jm.prototype.Ll=function(t){for(var e,r,i=this.head,n=t;n;){if(t=n.entries)if(e=t.length){if(2>e&&(r=n.parent)&&1===r.hb){r.removeChild(n),i===n&&(i=r),r.entries=t,n=t[0].node=r;continue}}else if(delete n.entries,(r=n.parent)&&(r.removeChild(n),i===n&&(i=r),1===r.hb)){n=r.hb?r[0]||r[1]||r[2]||r[3]:null;continue}break}this.head!==i&&(this.head=i,this.ld())},Jm.prototype.Zd=function(t,e){if(Ye(this.root,t,e,t,e))return this.Vb(this.root,t,e,this.Ph);throw Error("Coordinates out of bounds")},Jm.prototype.Vb=function(t,e,r,i){var n=t.entries;if(i)if(t.hb)n=this.Sj(t,e,r,i);else if(n){n=n[0];var o=t.th(+(n[1]>=t[8])|+(n[0]>=t[9])<<1);o.entries=t.entries,delete t.entries,n.node=o,this.ld(o),n=this.Sj(t,e,r,i)}else t.Qg(n=new Km(e,r)),this.ld(t),Ue(this,n,!0);else n||this.ld(t),t.Qg(n=new Km(e,r)),Ue(this,n,!0);return n},Jm.prototype.Sj=function(t,e,r,i){return this.Vb(t.th(+(e>=t[8])|+(r>=t[9])<<1),e,r,i-1)},Km.prototype.Of=function(t){return this[t%2]},m=Lm.prototype,m.jc=0,m.J=null,m.C=function(){var t,e=this.J;return!e&&(t=Se(this.Be))&&(this.J=e=new I(-t[0],t[3],-t[2],t[1])),e},m.Zd=function(t){return++this.jc,this.J=null,this.Be.Zd(t.lng,-t.lat)},m.remove=function(t){return(t=this.Be.remove(t))&&(--this.jc,this.J=null),t},m.Fm=function(t,e,r){var i=this.Be,n=t.Oc(),o=t.Mc(),a=-n.lat;n=n.lng;var s=-o.lat;return o=o.lng,t.qc()?i.ob(-180,a,o,s,r,e).concat(i.ob(n,a,180,s,r,e)):i.ob(n,a,o,s,r,e)},u(Mm,Q),t("H.map.provider.ObjectProvider",Mm),Mm.prototype.qr=ge,Mm.prototype.providesByViewport=Mm.prototype.qr,Mm.prototype.Nc=function(t){return this.Xf[t||Yf.ANY]},Mm.prototype.getInvalidations=Mm.prototype.Nc,Mm.prototype.Hh=function(t,e){if(e!==Lf.NONE){var r=this.Xf[Yf.ANY],i=r.Md+1;r.update(i,e),(r=this.Xf[t.type]).update(i,e),t.Nc().update(i,e),this.jb(t)}},Mm.prototype.invalidateObject=Mm.prototype.Hh,Mm.prototype.requestOverlays=Mm.prototype.xg,Mm.prototype.requestSpatials=Mm.prototype.Nn,Mm.prototype.requestSpatialsByTile=Mm.prototype.On,Mm.prototype.uw=!1,Mm.prototype.requestMarkers=Mm.prototype.qe,Mm.prototype.requestDomMarkers=Mm.prototype.pe,u(P,Mm),t("H.map.provider.LocalObjectProvider",P),P.prototype.getCapabilities=function(){return xg.PROVIDES_BY_VIEWPORT|xg.PROVIDES_WEBGL_RENDERABLE_OBJECTS|xg.PROVIDES_DOM_MARKERS|xg.CROP_LINES_BY_TILE},P.prototype.mb=function(){if(!this.Ui&&(this.Ui=P.g.mb.call(this),this.Ui instanceof th)){var t=new Zg(this.getCapabilities()|xg.HAS_VOLATILE_DATA,this.uid+"_vol",this.min,this.max,this.Sc,this.tileSize);this.Ui.fk(t.Ke())}return this.Ui},P.prototype.getStyleInternal=P.prototype.mb,P.prototype.Xa=function(t,e){P.g.Xa.call(this,t,e),this.Ui=null},P.prototype.setStyleInternal=P.prototype.Xa,P.prototype.sd=function(){return this.Bg},P.prototype.getRootGroup=P.prototype.sd,P.prototype.Hh=function(t,e){e&Lf.SPATIAL&&this.Y(t),P.g.Hh.call(this,t,e)},P.prototype.invalidateObject=P.prototype.Hh,P.prototype.Y=function(t){var e;if(B(t,N,this.Y,0),t.D!==this)throw new wb(this.Y,"foreign object");this.Oa(t);var r=t.type;if(r===Yf.MARKER)if((e=t.V())instanceof xe){var i=!0;r=this.ek}else r=this.jk;else r===Yf.DOM_MARKER?(e=t.V())instanceof xe?(i=!0,r=this.bm):r=this.Zm:r=r===Yf.OVERLAY?this.rk:this.xi;(i=i?r.Zd(e):r.Mu(t.C())).Cs=t,t.As=i},P.prototype.Oa=function(t){var e;if(t)if(t.D!==this){if(B(t,N))throw new wb(this.Oa,"foreign object")}else if(e=t.As){var r=t.type;r===Yf.MARKER?this.ek.remove(e)||this.jk.remove(e):r===Yf.DOM_MARKER?this.bm.remove(e)||this.Zm.remove(e):r===Yf.OVERLAY?this.rk.remove(e):this.xi.remove(e),delete e.Cs,delete t.As}},P.prototype.removeObject=P.prototype.Oa,P.prototype.sr=function(){return 0<this.rk.jc},P.prototype.providesOverlays=P.prototype.sr,P.prototype.xg=function(t,e,r){return Nm(this,this.rk,t,e,r,!1).filter((function(t){return t.Te()}))},P.prototype.requestOverlays=P.prototype.xg,P.prototype.ne=function(){return 0<this.xi.jc},P.prototype.providesSpatials=P.prototype.ne,P.prototype.Nn=function(t,e,r){return Nm(this,this.xi,t,e,r,!1)},P.prototype.requestSpatials=P.prototype.Nn,P.prototype.On=function(t,e){return Nm(this,this.xi,t.nm(),t.zL,e,!1)},P.prototype.requestSpatialsByTile=P.prototype.On,P.prototype.Wc=function(){return 0<this.ek.jc+this.jk.jc},P.prototype.providesMarkers=P.prototype.Wc,P.prototype.qe=function(t,e,r){return Om(this,t,e,r,!1)},P.prototype.requestMarkers=P.prototype.qe,P.prototype.Vc=function(){return 0<this.bm.jc+this.Zm.jc},P.prototype.providesDomMarkers=P.prototype.Vc,P.prototype.pe=function(t,e,r){return Pm(this,t,e,r,!1)},P.prototype.requestDomMarkers=P.prototype.pe,P.prototype.bb=function(t,e,r,i,n){var o=this,a=t.C(),s=[],l=cc(),u=1;if(a)for(;u&Yf.ANY;){if(u&i)switch(u){case Yf.MARKER:l=l.then((function(){return Om(o,a,r,e,!0)})).then((function(e){return Tm(e,t,s)}));break;case Yf.DOM_MARKER:l=l.then((function(){return Pm(o,a,r,e,!0)})).then((function(e){return Tm(e,t,s)}));break;case Yf.SPATIAL:l=l.then((function(){return Nm(o,o.xi,a,r,e,!0)})).then((function(e){e.forEach(Qm.bind(null,t,s))}));break;case Yf.OVERLAY:l=l.then((function(){return Nm(o,o.rk,a,r,e,!0)})).then((function(e){e.forEach(Qm.bind(null,t,s))}))}u<<=1}l.then((function(){return n(s)}))},P.prototype.Pf=function(t,e,r){var i=(r=r||ke).zoom,n=r.visiblesOnly;r=r.types;var o=Yf.ANY;B(t,L,this.Pf,0,"area"),db(e,"Function",this.Pf,1,"callback"),db(i,"Number",this.Pf,2,"options"),this.bb(t,!ab(n)||!!n,i,ab(r)?r&o:o,e)},P.prototype.getObjectsWithin=P.prototype.Pf,P.prototype.disposeInternal=function(){P.g.disposeInternal.call(this),this.Bg.ia()},u(U,E),t("H.Map",U),U.prototype.draggable=U.prototype.draggable=!1,U.prototype.cy=333,U.prototype.disposeInternal=function(){this.ht=!1,this.Yd&&this.Yd.l(),this.Ca.dispose(),this.xa.l(),this.sa.l(),this.qb.l(),this.sc.l(),this.O.l();var t=this.G;t.parentNode.removeChild(t),delete this.G,E.prototype.disposeInternal.call(this)},U.prototype.B=function(){return this.G},U.prototype.getElement=U.prototype.B,U.prototype.lb=function(){return this.Fa.pixelRatio},U.prototype.getPixelRatio=U.prototype.lb,U.prototype.Rq=function(t){var e=t.added,r=t.removed;e&&e.D&&e.D.ea(this),r&&r.D&&r.D.ea(null),r===this.qb&&(delete this.qb,delete this.sc),r===this.pa&&(this.pa=null),0===t.idx&&(this.dispatchEvent(new wg(this.j.xl,this.pa=t.type!==this.O.j.Mi?e:0<this.O.aa.length?this.O.get(0):x,t.type!==this.O.j.Ki?r:1<this.O.aa.length?this.O.get(1):x)),Wm(this))},U.prototype.Rv=function(t){t.modifiers&&(this.Fq||(Xm(this,"start"),this.Fq=!0),Xm(this,"",t),this.tv&&globalThis.clearTimeout(this.tv),this.tv=globalThis.setTimeout(this.jp,this.cy))},U.prototype.jp=function(){Xm(this,"end"),this.Fq=!1},U.prototype.Zn=function(t,e){return this.Ca.getCapabilities().lookAt&&this.xa.ad({position:t},!!e),this},U.prototype.setCenter=U.prototype.Zn,U.prototype.wb=function(){var t=this.xa.Ib();return t?t.position:x},U.prototype.getCenter=U.prototype.wb,U.prototype.Vk=function(t,e){return this.xa.Vk(t,!!e),this},U.prototype.setZoom=U.prototype.Vk,U.prototype.Ub=function(){return this.xa.Ub()},U.prototype.getZoom=U.prototype.Ub,U.prototype.Ng=function(t,e,r){this.Ca.zoomAt(t,e,r)},U.prototype.zoomAt=U.prototype.Ng,U.prototype.PA=function(){return this.sa},U.prototype.getViewPort=U.prototype.PA,U.prototype.OA=function(){return this.xa},U.prototype.getViewModel=U.prototype.OA,U.prototype.cA=function(){return this.O},U.prototype.getLayers=U.prototype.cA,U.prototype.Xz=function(){return this.Yd},U.prototype.getImprint=U.prototype.Xz,U.prototype.capture=function(t,e,r,i,n,o){function a(t,e){d?t.cancel():(u.save(),e.capture(l,p,(function(e){u.restore(),t.done(e)}),(function(e){t.done(null,e),s(null)})))}function s(e){d||(d=!0,t(e))}var l,u,c=this.Ca,h=c.getCapabilities(),p=this.Fa.pixelRatio,f=this.sa,d=!1,y=this;if(!Za(t))throw new C(this.capture,0,t);r=r||0,i=i||0,n=n||f.width,o=o||f.height;var g=ld(0,kd(r,n)),v=ld(0,kd(i,o));r=kd(f.width,ld(r,n)),i=kd(f.height,ld(i,o)),h.capture?c.capture(g,v,r,i).then((function(t){var r=y.Yd,i=e||[];u=(l=t).getContext("2d"),l.style.width=l.width/p+"px",l.style.height=l.height/p+"px";var n=new Gk(10,a);(i=i.concat(r).filter((function(t){return Za(t&&t.capture)}))).length?(t=i.pop(),i.forEach((function(t){n.push(t,ie)})),n.push(t,z(s,y,l)),n.An()):s(l)}),(function(){s(x)})):t(null)},U.prototype.capture=U.prototype.capture,U.prototype.Kz=function(){return this.Ca},U.prototype.getEngine=U.prototype.Kz,U.prototype.Yo=function(t,e){if(e=e?Um(e,this.Yo):this.Fa,Wm(this),t===Eh.P2D)return new globalThis.H.map.render.p2d.RenderEngine(this.sa,this.xa,this.O,e);if(t===Eh.WEBGL)return new S(this.sa,this.xa,this.O,e);if(t===Eh.HARP)return new globalThis.H.map.render.harp.RenderEngine(this.sa,this.xa,this.O,e);throw new C(this.Yo,0,t)},U.prototype.al=function(t,e,r,i,n){if(e=ab(e)?B(e,I,this.al,1,e)&&e:this.xa.Ib().bounds.C(),!B(n=n||this.pa,aj))throw new C(this.al,4);var o=n.D,a=this.lb(),s=n.tileSize;if(2<=a&&256<s&&o instanceof Sj&&(s/=2),a=this.Ub(),s=Math.log2(s)-8,!((r=ab(r)?+r:a)<=(i=ab(i)?+i:a)))throw new C(this.al,A,"!(min <= max)");a=o.min;var l=o.max,u=this.Ca.type===Eh.WEBGL?nd:md;if(r=Nd(u(r)-s,a,l),i=Nd(u(i)-s,a,l),!(o&&B(o,R)&&Am()&&o.Vi()))throw new wb(this.al,"Storing is not supported");return new Ej(n,o,e,r,i,t)},U.prototype.storeContent=U.prototype.al,u(Ym,Bj),Ym.prototype.lC=function(){Dj(this,2)},Ym.prototype.kC=function(){Dj(this,4)},U.prototype.Ay=function(t){return t=new Ym(t),zm().clear(z(t.lC,t),z(t.kC,t)),t},U.prototype.clearContent=U.prototype.Ay,U.prototype.Bl=function(t,e){var r=this.O,i=r.indexOf(t),n=e!==+e;return e=n?r.aa.length-1:e,0>i?r.add(t,e):i-e&&(r.Ed(i),r.add(t,n?e-1:e)),this},U.prototype.addLayer=U.prototype.Bl,U.prototype.hi=function(t){var e=this.O.indexOf(t);return t!==this.pa&&t!==this.qb&&-1!==e&&this.O.Ed(e),this},U.prototype.removeLayer=U.prototype.hi,U.prototype.Dg=function(t){return this.pa!==t&&(this.O.aa.length&&this.O.get(0)!==this.qb?this.O.set(0,t):this.O.add(t,0),this.pa=t),this},U.prototype.setBaseLayer=U.prototype.Dg,U.prototype.wz=function(){return this.pa},U.prototype.getBaseLayer=U.prototype.wz,U.prototype.La=function(t){if(!ye(t))throw new C(this.La,0,t);return(t=this.Ca.geoToScreen(t))?nf(t):x},U.prototype.geoToScreen=U.prototype.La,U.prototype.Wa=function(t,e){var r;if(r=+D(t)||2*+D(e))throw new C(this.Wa,r-1,arguments[r-1]);return(r=this.Ca.screenToGeo(t,e))?ze(r):x},U.prototype.screenToGeo=U.prototype.Wa,U.prototype.Un=function(t,e){return this.Ca.screenToLookAtData(t,e)},U.prototype.screenToLookAtData=U.prototype.Un,U.prototype.Y=function(t){if(!B(t,N))throw new C(this.Y,0,t);return!this.qb&&Vm(this),this.sc.sd().Y(t),t},U.prototype.addObject=U.prototype.Y,U.prototype.Oa=function(t){if(!B(t,N))throw new C(this.Oa,0,t);return!this.qb&&Vm(this),this.sc.sd().Oa(t),t},U.prototype.removeObject=U.prototype.Oa,U.prototype.bb=function(t){return!this.qb&&Vm(this),this.sc.sd().bb(t)},U.prototype.getObjects=U.prototype.bb,U.prototype.kd=function(t){var e;fb(t,this.kd,0,t),!this.qb&&Vm(this);var r=t.length;for(e=0;e<r;e++)this.Y(t[e]);return this},U.prototype.addObjects=U.prototype.kd,U.prototype.vg=function(t){var e;fb(t,this.vg,0,t),!this.qb&&Vm(this);var r=t.length;for(e=0;e<r;e++)this.Oa(t[e]);return this},U.prototype.removeObjects=U.prototype.vg,U.prototype.Bh=function(t,e,r){var i;if(i=+D(t)||2*+D(e))throw new C(this.Bh,i-1,arguments[i-1]);this.Ca.getObjectsAt(t,e,!0,(function(t){r(t[0])}))},U.prototype.getObjectAt=U.prototype.Bh,U.prototype.Ma=function(t,e,r,i){var n;if(n=+D(t)||2*+D(e))throw new C(this.Bh,n-1,arguments[n-1]);this.Ca.getObjectsAt(t,e,!1,r,!!i)},U.prototype.getObjectsAt=U.prototype.Ma,U.prototype.Pf=function(t,e,r){var i=(r=r||{}).zoom;r.zoom=ab(i)?i:this.xa.Ub(),this.sc.Pf(t,e,r)},U.prototype.getObjectsWithin=U.prototype.Pf;var Zm=xk.HARP,Eh={P2D:xk.P2D,WEBGL:xk.WEBGL,HARP:Zm};function $m(t,e,r,i){if(!t||!e||!r)throw new C($m,A,"Must specify name, version and revision parameter");this.name=t,this.version=e,this.revision=r,i&&Sa(this,i)}U.EngineType=Eh,U.prototype.j={QD:"mapviewchangestart",Ns:"mapviewchange",Os:"mapviewchangeend",xl:"baselayerchange"},t("H.util.BuildInfo",$m),$m.prototype.toString=function(){var t,e=[];for(t in this)gb(this[t])&&e.push(this[t]);return e.join(";")};var an={};function bn(t,e,r,i){if(!t)throw new C(bn,1,"Must specify a name parameter");return an[t]||(an[t]=new $m(t,e,r,i))}$m.get=bn,t("H.buildInfo",(function(){return bn("H-core","1.60.0","2c2ebf2",{region:"row"})}));var Dh=Eh.WEBGL,cn,dn="maps".concat("js-"),en,fn,gn,hn,jn;if(en=globalThis.document.querySelector('script[src*="'+dn+'"]'),!en)for(fn=globalThis.document.getElementsByTagName("script"),hn=new RegExp("^.*"+dn),jn=0,gn=fn.length;jn<gn;jn++)if(hn.test(fn[jn].src)){en=fn[jn];break}function kn(){var t=decodeURIComponent(cn);if(t){t="/"===t[t.length-1]?t.substring(0,t.length-1):t;var e=globalThis.document,r="";e?((e=e.createElement("a")).href=t,r=e.href):/[\w]+:\/\//.test(t)&&(r=t),(t=new URL(r)).pathname+="/"===t.pathname[t.pathname.length-1]?"styles":"/styles",t=t.toString()}else t="https://js.api.here.com/v3/3.1.60.0/styles";return t}function ln(t,e,r,i,n,o){if(isNaN(t))throw Error("x needs to be a number");if(isNaN(e))throw Error("y needs to be a number");if(isNaN(r))throw Error("pointer must have an id");this.viewportX=t,this.viewportY=e,this.target=null,this.id=r,this.type=i,this.dragTarget=null,this.button=ab(n)?n:-1,this.buttons=ab(o)?o:0,this.Pm=this.button}function mn(t,e,r){if(isNaN(e))throw Error("x needs to be a number");if(isNaN(r))throw Error("y needs to be a number");t.viewportX=e,t.viewportY=r}function nn(t,e){t.Pm=e,t.buttons|=on[+e]||0}function pn(t,e){t.Pm=e,t.buttons&=~(on[+e]||0)}cn=en?en.src.replace(/\/[^\/]*$/,"/"):"",t("H.getScriptPath",(function(){return cn})),t("H.getStylePath",kn),t("H.mapevents.Pointer",ln),ln.prototype.$z=function(){return this.Pm},ln.prototype.getLastChangedButton=ln.prototype.$z;var on=[1,4,2],qn={NONE:-1,LEFT:0,MIDDLE:1,RIGHT:2};function rn(t,e,r,i,n,o,a){rn.g.constructor.call(this,t),this.pointers=e,this.changedPointers=r,this.targetPointers=i,this.currentPointer=n,this.originalEvent=a,this.target=o}function sn(t){this.Ea=t instanceof Array?t.slice(0):[]}function tn(t,e){return-1!==(e=t.indexOf(e))?t.Ea[e]:null}function un(t,e){for(var r=t.Ea.length,i=[];r--;)t.Ea[r].type!==e&&i.push(t.Ea[r]);t.Ea=i}function vn(t,e){for(var r=t.Ea.length;r--;)if(t.Ea[r].dragTarget===e)return!0;return!1}function wn(t,e,r){if(r=r||{},!(t instanceof U))throw Error("events: map instance required");if(!(e instanceof Array))throw Error("events: map array required");Ac.call(this),this.fp=r.fp||300,this.zt=r.zt||50,this.nx=r.nx||50,this.ox=r.ox||500,this.Dq=r.Dq||900,this.Cq=r.Cq||8,this.map=t,this.za=this.map.sa,this.element=this.za.element,this.np=e,this.pointers=new sn,this.changedPointers=new sn,this.$f={},this.Ka=null,this.em=!0,this.Nk={},this.sf={},this.bk=null,this.mj=z(this.mj,this),this.Qt={pointerdown:this.Uy,pointermove:this.Vy,pointerup:this.Wy,pointercancel:this.Ty},xn(this)}function xn(t,e){var r,i=t.np.length;for(r=0;r<i;r++){var n=t.np[r],o=n.listener;"function"==typeof o&&(e?(n.target||t.element).removeEventListener(n.$a,o):(n.target||t.element).addEventListener(n.$a,o))}}function yn(t,e,r){var i;if("function"==typeof t.Qt[e]){"pointermove"!==e&&(t.em=!0);var n=0;for(i=t.changedPointers.length();n<i;n++){var o=t.changedPointers.item(n);t.element.contains(r.composedPath()[0])?zn(t,o,t.It.bind(t,r,e,o)):t.It(r,e,o,null)}}t.changedPointers.clear()}function zn(t,e,r){if(t.Ka===e)r(e.target);else{var i=t.za,n=e.viewportX;if(e=e.viewportY,0>n||0>e||n>=i.width||e>=i.height)r(x);else{var o=t.map;o.Bh(n,e,(function(t){r(t||o)}))}}}function Bn(t,e,r){e===t.Ka&&(Cn(t,e.dragTarget,"dragend",r,e),t.Ka=null,An(e.id,t.Nk)),e.dragTarget=null}function An(t,e){e[t]&&(e[t].timeout?clearTimeout(e[t].timeout):clearTimeout(e[t]),delete e[t])}function Dn(t,e,r){var i=e.target,n=new K(e.viewportX,e.viewportY),o=e.id;An(o,t.sf);var a=setTimeout((function(){i&&i===e.target&&n.kb({x:e.viewportX,y:e.viewportY})<t.Cq&&(Cn(t,i,"longpress",r,e),delete t.$f[e.id])}),t.Dq);t.sf[o]={timeout:a,vk:n}}function Cn(t,e,r,i,n){if(e&&"function"==typeof e.dispatchEvent){var o,a=rn,s=t.pointers.Ta(),l=t.changedPointers.Ta(),u=(t=t.pointers).Ea.length,c=[];for(o=0;o<u;o++)t.Ea[o].target===e&&c.push(t.Ea[o]);a=new a(r,s,l,c,n,e,i),n.button=/^(?:longpress|(?:dbl)?tap|pointer(?:down|up))$/.test(r)?n.Pm:qn.NONE,e.dispatchEvent(a)}return a}function En(t,e,r,i){En.g.constructor.call(this,"contextmenu"),this.items=[],this.viewportX=t,this.viewportY=e,this.target=r,this.originalEvent=i}function Fn(t){var e=t.ownerDocument;e=e.documentElement||e.body.parentNode||e.body;try{var r=t.getBoundingClientRect()}catch(t){r={top:0,right:0,bottom:0,left:0,height:0,width:0}}return{x:r.left+("number"==typeof window.pageXOffset?window.pageXOffset:e.scrollLeft),y:r.top+("number"==typeof window.pageYOffset?window.pageYOffset:e.scrollTop)}}function Gn(t){this.Xp=z(this.Xp,this),this.Zp=z(this.Zp,this),this.Yp=z(this.Yp,this),this.qn=!1,this.ih=-1,this.hv=0,Gn.g.constructor.call(this,t,[{$a:"contextmenu",listener:this.Xp},{target:t,$a:"longpress",listener:this.Zp},{target:t,$a:"dbltap",listener:this.Yp}])}function Hn(t,e,r,i,n){var o=t.map,a=Date.now()-t.hv;n?!t.qn&&a>t.Dq&&(t.qn=!0,n.dispatchEvent(new En(e,r,n,i)),Vc(o.B(),In,t.Ht,!1,t)):o.Bh(e,r,t.Lp.bind(t,e,r,i))}ln.Button=qn,u(rn,Fc),t("H.mapevents.Event",rn),m=sn.prototype,m.clear=function(){this.Ea.splice(0,this.Ea.length)},m.length=function(){return this.Ea.length},m.item=function(t){return this.Ea[t]||null},m.indexOf=function(t){for(var e=this.Ea.length;e--;)if(this.Ea[e].id===t)return e;return-1},m.remove=function(t){return-1!==(t=this.indexOf(t))?this.Ea.splice(t,1)[0]:null},m.push=function(t){if(t instanceof ln)return this.Ea.push(t);throw Error("list needs a pointer")},m.Ta=function(){return this.Ea},m.clone=function(){return new sn(this.Ea)},u(wn,Ac),m=wn.prototype,m.It=function(t,e,r,i){An(r.id,this.Nk),this.Qt[e].call(this,r,i,t)},m.Wy=function(t,e,r){var i=t.id;t.target=e,Bn(this,t,r),Cn(this,e,"pointerup",r,t),"mouse"!==t.type&&Cn(this,e,"pointerleave",r,t),e=this.$f[t.id];var n={x:t.viewportX,y:t.viewportY},o=r.timeStamp,a=t.target,s=this.bk;e&&e.target===a&&e.vk.kb(n)<this.nx&&o-e.ps<this.ox?(Cn(this,a,"tap",r,t),s&&s.target===a&&o-s.ps<this.fp?s.vk.kb({x:t.viewportX,y:t.viewportY})<this.zt&&(Cn(this,a,"dbltap",r,t),this.bk=null):this.bk={target:a,vk:new K(t.viewportX,t.viewportY),ps:r.timeStamp}):this.bk=null,this.$f={},An(i,this.sf)},m.mj=function(t,e){var r=this;Cn(this,t.dragTarget,"drag",e,t),An(t.id,this.Nk),this.Nk[t.id]=setTimeout((function(){r.mj(t,e)}),150)},m.Vy=function(t,e,r){var i=t.dragTarget,n=t.id,o=t.target;t.target=e,o!==e&&(Cn(this,o,"pointerleave",r,t),Cn(this,e,"pointerenter",r,t)),i?this.Ka?(this.mj(t,r),this.sf[n]&&this.sf[n].vk.kb({x:t.viewportX,y:t.viewportY})>this.Cq&&An(n,this.sf)):this.em?this.em=!1:(this.Ka=t,Cn(this,i,"dragstart",r,t),this.mj(t,r),delete this.$f[n],this.em=!0):(!this.Ka||this.Ka&&this.Ka.dragTarget!==e&&this.Ka.dragTarget!==this.map)&&Cn(this,e,"pointermove",r,t)},m.Uy=function(t,e,r){var i=!(/^(?:mouse|pen)$/.test(t.type)&&0!==r.button);if(e){t.target=e,this.$f[t.id]={vk:new K(t.viewportX,t.viewportY),target:t.target,ps:r.timeStamp},"mouse"!==t.type&&Cn(this,e,"pointerenter",r,t);var n=Cn(this,e,"pointerdown",r,t);!this.Ka&&i&&(e.draggable&&!vn(this.pointers,e)?t.dragTarget=e:!this.map.draggable||n.defaultPrevented||vn(this.pointers,this.map)||(t.dragTarget=this.map)),Dn(this,t,r)}},m.Ty=function(t,e,r){var i=t.id;t.target=null,e?(Cn(this,e,"pointerleave",r,t),Cn(this,e,"pointercancel",r,t)):Cn(this,this.map,"pointercancel",r,t),Bn(this,t,r),this.$f={},An(i,this.sf)},m.disposeInternal=function(){xn(this,!0),this.pointers.clear(),this.changedPointers.clear();var t,e=this.Nk;for(t in e)An(t,e);for(var r in e=this.sf)An(r,e);delete this.element,delete this.np,delete this.pointers,delete this.changedPointers,delete this.map,this.bk=null,delete this.$f,this.Ka=null,Ac.prototype.disposeInternal.call(this)},u(En,Fc),t("H.mapevents.ContextMenuEvent",En),u(Gn,wn),m=Gn.prototype,m.Zp=function(t){var e=t.currentPointer;"touch"===e.type&&1===t.pointers.length&&Hn(this,e.viewportX,e.viewportY,t.originalEvent,t.target)},m.Yp=function(t){"touch"===t.currentPointer.type&&(this.hv=Date.now())},m.Xp=function(t){var e=this;-1===this.ih?this.ih=setTimeout((function(){var r=Fn(e.element),i=t.pageX-r.x;r=t.pageY-r.y,e.ih=-1,Hn(e,i,r,t)}),this.fp):(clearInterval(this.ih),this.ih=-1),t.preventDefault()},m.Lp=function(t,e,r,i){Hn(this,t,e,r,i&&Za(i.dispatchEvent)?i:this.map)},m.Ht=function(){this.qn&&(this.qn=!1,this.map.dispatchEvent(new Fc("contextmenuclose",this.map)))},m.disposeInternal=function(){var t=this.map.B();clearInterval(this.ih),t&&bd(t,In,this.Ht,!1,this),wn.prototype.disposeInternal.call(this)};var In=["mousedown","touchstart","pointerdown","wheel"];function Jn(t){var e=Kn(this);(window.PointerEvent||window.MSPointerEvent)&&e.push({$a:"MSHoldVisual",listener:"prevent"}),wn.call(this,t,e)}function Kn(t){var e,r,i=!!window.PointerEvent,n=[];return t.$p=z(t.$p,t),"MSPointerDown MSPointerMove MSPointerUp MSPointerCancel MSPointerOut MSPointerOver".split(" ").forEach((function(o){e=o.toLowerCase().replace(/ms/g,""),r=i?e:o,n.push({$a:r,listener:t.$p,target:/^pointer(up|move)$/.test(e)?window:null})})),n}u(Jn,wn);var Ln={2:"touch",3:"pen",4:"mouse"};function Mn(t){this.Gh=z(this.Gh,this),wn.call(this,t,[{$a:"touchstart",listener:this.Gh},{$a:"touchmove",listener:this.Gh},{$a:"touchend",listener:this.Gh},{$a:"touchcancel",listener:this.Gh}]),this.Bx={touchstart:"pointerdown",touchmove:"pointermove",touchend:"pointerup",touchcancel:"pointercancel"},this.Ju=(t=(t=t.Yd)?t.B():null)?Array.prototype.slice.call(t.querySelectorAll("a"),0):[]}function Nn(t,e,r,i,n){Nn.g.constructor.call(this,"wheel"),this.delta=t,this.viewportX=e,this.viewportY=r,this.target=i,this.originalEvent=n}function On(t){var e="onwheel"in document;this.by=e,this.$x=(e?"d":"wheelD")+"elta",this.aq=z(this.aq,this),On.g.constructor.call(this,t,[{$a:(e?"":"mouse")+"wheel",listener:this.aq}]),this.sa=this.map.sa}function Pn(t){this.Uf=z(this.Uf,this),wn.call(this,t,[{$a:"mousedown",listener:this.Uf},{$a:"mousemove",listener:this.Uf,target:window},{$a:"mouseup",listener:this.Uf,target:window},{$a:"mouseover",listener:this.Uf},{$a:"mouseout",listener:this.Uf},{$a:"dragstart",listener:this.jC}])}function Qn(t){var e=t.sa.element.style;if(-1!==Rn.indexOf(t))throw Error("InvalidArgument: map is already in use");this.v=t,Rn.push(t),e.msTouchAction=e.touchAction="none",zb||!window.PointerEvent&&!window.MSPointerEvent?(this.Ax=new Mn(this.v),this.Dv=new Pn(this.v)):this.Ax=new Jn(this.v),this.ID=new On(this.v),this.Ey=new Gn(this.v),this.v.bc(this.l,this),Ac.call(this)}Jn.prototype.$o=function(t,e){var r=t.pointerType;return"number"==typeof r&&(r=Ln[r]),t=new ln(e.x,e.y,t.pointerId,r,t.button,t.buttons),this.pointers.push(t),t},Jn.prototype.$p=function(t){var e=window.PointerEvent?t.type:t.type.toLowerCase().replace(/ms/g,""),r=Fn(this.element),i=tn(this.pointers,t.pointerId),n=t.pageX-r.x;r=t.pageY-r.y;var o=Ln[t.pointerType]||t.pointerType;yb&&"rtl"===globalThis.getComputedStyle(this.za.element).direction&&(n-=(globalThis.devicePixelRatio-1)*this.za.width),i||/^pointer(up|out|cancel)$/.test(e)||"touch"===o&&"pointerdown"!==e||(i=this.$o(t,{x:n,y:r})),i&&(/^pointer(up|cancel)$/.test(e)?("touch"===o&&this.pointers.remove(i.id),pn(i,t.button)):"pointerdown"===e&&("touch"===t.pointerType&&(un(this.pointers,"mouse"),un(this.pointers,"pen")),nn(i,t.button)),this.changedPointers.push(i),"pointermove"!==e?(mn(i,n,r),yn(this,/^pointer(over|out)$/.test(e)?"pointermove":e,t)):i.viewportX===n&&i.viewportY===r||(mn(i,n,r),yn(this,e,t))),this.changedPointers.clear()},u(Mn,wn),Mn.prototype.Gh=function(t){var e,r=t.touches,i=this.pointers.length();if("touchstart"===t.type&&i>=r.length){for(i=this.pointers.clone(),e=r.length;e--;)i.remove(r[e].identifier);for(e=i.length();e--;)this.pointers.remove(i.item(e).id);this.changedPointers=i,yn(this,"pointercancel",t),this.changedPointers.clear()}if(this.Bx[t.type]){r=Fn(this.za.element),i=t.type;var n,o=(e=t.changedTouches).length;for(this.changedPointers.clear(),n=0;n<o;n++){var a=e[n],s=tn(this.pointers,a.identifier),l=a.pageX-r.x,u=a.pageY-r.y;if(s)if("touchmove"===i){a=Math.abs(s.viewportX-l);var c=Math.abs(s.viewportY-u);(1<a||1<c||1===a&&1===c)&&(mn(s,l,u),this.changedPointers.push(s))}else"touchend"===i&&(this.pointers.remove(s.id),this.changedPointers.push(s),pn(s,qn.LEFT));else s=new ln(l,u,a.identifier,"touch",qn.LEFT,1),this.pointers.push(s),this.changedPointers.push(s)}yn(this,this.Bx[t.type],t),-1===this.Ju.indexOf(t.target)&&t.preventDefault()}},Mn.prototype.disposeInternal=function(){this.Ju=null,wn.prototype.disposeInternal.call(this)},u(Nn,Fc),t("H.mapevents.WheelEvent",Nn),u(On,wn),On.prototype.normalize=function(t,e,r){var i,n=this.$x,o=t[n+(n+"Y"in t?"Y":"")];if(yb&&"rtl"===globalThis.getComputedStyle(this.sa.element).direction&&(e-=(globalThis.devicePixelRatio-1)*this.sa.width),o){var a=Math.abs,s=a(o);o=(!(i=t[n+"X"])||3<=s/a(i))&&(!(i=t[n+"Z"])||3<=s/a(i))?(+(0<o)-+(0>o))*(this.by?1:-1):0}return new Nn(o,e,r,null,t)},On.prototype.aq=function(t){if(!t.Qx){var e=Fn(this.element);(e=this.normalize(t,t.pageX-e.x,t.pageY-e.y)).delta&&(t.stopImmediatePropagation(),t.preventDefault(),this.map.Bh(e.viewportX,e.viewportY,this.Lp.bind(this,e)))}},On.prototype.Lp=function(t,e){var r,i,n=t.target=e||this.map;setTimeout((function(){n.dispatchEvent(t),t.defaultPrevented||(r=t.originalEvent,(i=new globalThis.WheelEvent("wheel",r)).Qx=!0,r.target.dispatchEvent(i))}),0)},u(Pn,wn),Pn.prototype.$o=function(t){return t=new ln(t.x,t.y,1,"mouse"),this.pointers.push(t),t},Pn.prototype.Uf=function(t){var e=t.type,r=Fn(this.element),i={x:t.pageX-r.x,y:t.pageY-r.y};r=this.pointers.item(0)||this.$o(i),this.changedPointers.push(r),mn(r,i.x,i.y),/^mouse(?:move|over|out)$/.test(e)?yn(this,"pointermove",t):(/^mouse(down|up)$/.test(e)&&(i=t.which-1,"up"===globalThis.RegExp.$1?pn(r,i):nn(r,i)),yn(this,e.replace("mouse","pointer"),t)),this.changedPointers.clear()},Pn.prototype.jC=function(t){t.preventDefault()},u(Qn,Ac),t("H.mapevents.MapEvents",Qn);var Rn=[];function Sn(t,e){var r;if(e=void 0===e?{}:e,Sn.g.constructor.call(this),-1!==Tn.indexOf(t))throw new C(Sn,0,"events are already used");this.v=r=t.v,this.rv=t,Tn.push(t),r.draggable=!0,this.ua=e.kinetics||{duration:600,ease:Jk},this.LB=e.modifierKey||"Alt",this.enable(e.enabled),this.Fi=r.sa,this.sl=this.Fi.element,this.Rm=0,r.addEventListener("dragstart",this.Cd,!1,this),r.addEventListener("drag",this.ig,!1,this),r.addEventListener("dragend",this.ef,!0,this),r.addEventListener("wheel",this.Tv,!1,this),r.addEventListener("dbltap",this.Lv,!1,this),r.addEventListener("pointermove",this.ie,!1,this),Uc(this.sl,"contextmenu",this.bn,!1,this),t.bc(this.l,this)}mb(Rn),Qn.prototype.l=function(){delete this.v,this.Ax.l(),this.ID.l(),this.Ey.l(),this.Dv&&this.Dv.l(),Rn.splice(Rn.indexOf(this.v),1),Ac.prototype.l.call(this)},Qn.prototype.dispose=Qn.prototype.l,Qn.prototype.vz=function(){return this.v},Qn.prototype.getAttachedMap=Qn.prototype.vz,u(Sn,Ac),t("H.mapevents.Behavior",Sn);var Tn=[];mb(Tn),Sn.prototype.Rb=0;var Un={PANNING:1,PINCH_ZOOM:2,WHEEL_ZOOM:4,DBL_TAP_ZOOM:8,FRACTIONAL_ZOOM:16,TILT:32,HEADING:64};Sn.Feature=Un;var Vn=Un.PANNING,Wn=Un.PINCH_ZOOM,Xn=Un.WHEEL_ZOOM,Yn=Un.DBL_TAP_ZOOM,Zn=Un.FRACTIONAL_ZOOM,$n=Un.TILT,ao=Un.HEADING,bo=Vn|Wn|Xn|Yn|Zn|$n|ao;function co(t,e){if(t!==+t||t%1||0>t||2147483647<t)throw new C(e,0,"integer in range [0...0x7FFFFFFF] required")}function eo(t,e,r){var i,n="touch"===e.currentPointer.type,o=0;if(i=!n){i=t.LB;var a=e.originalEvent;i=a.getModifierState?a.getModifierState(i):!!a[i.replace(/^Control$/,"ctrl").toLowerCase()+"Key"]}return i?o|=$n|ao:(o|=Vn,n&&2===(e=e.pointers).length&&(o|=Wn|ao,r?55>pd(e[0].viewportY-e[1].viewportY)&&(o|=$n):t.iq&rk.TILT&&(o|=$n))),((o&=t.Rb)&$n?rk.TILT:0)|(o&ao?rk.HEADING:0)|(o&Wn?rk.ZOOM:0)|(o&Vn?rk.COORD:0)}function fo(t){var e=t.pointers;return t=e[0],e=e[1],t=[t.viewportX,t.viewportY],e&&t.push(e.viewportX,e.viewportY),t}function go(t){return t=t.Vd("_#-;,:","_#-;,:","_#-;,:"),new RegExp("^"+t.replace(/[.*+?^${}()|[\]\\\/]/g,"\\$&").replace(/_#-;,:/g,"\\d+")+"$")}function ho(t,e){return Sa.apply(null,arguments),t}function io(t,e){var r=globalThis.console;r&&r.warn&&(t=cb(t)+" is deprecated and will be removed soon. ",e&&(t+=e),r.warn(t))}Sn.DRAGGING=Vn,Sn.WHEELZOOM=Xn,Sn.DBLTAPZOOM=Yn,Sn.FRACTIONALZOOM=Zn,Sn.prototype.disable=function(t){var e=this.Rb;t!==A?(co(t,this.disable),e^=e&t):e=0,this.Fi.endInteraction(!0),this.Rb=e,this.v.draggable=0<(e&(Vn|$n|ao|Wn))},Sn.prototype.disable=Sn.prototype.disable,Sn.prototype.enable=function(t){var e=this.Rb;t!==A?(co(t,this.enable),e|=t&bo):e=bo,this.Rb=e,this.v.draggable=0<(e&(Vn|$n|ao|Wn))},Sn.prototype.enable=Sn.prototype.enable,Sn.prototype.isEnabled=function(t){return co(t,this.isEnabled),t===(this.Rb&t)},Sn.prototype.isEnabled=Sn.prototype.isEnabled,m=Sn.prototype,m.iq=0,m.Cd=function(t){var e=eo(this,t,!0);if(this.iq=e){var r=this.Fi;if(t=fo(t),r.startInteraction(e,this.ua),r.interaction.apply(r,t),this.Rb&Xn&&!(this.Rb&Zn)&&(e=t[0],r=t[1],this.Rm)){t=this.v.Ub();var i=(0>this.Rm?od:nd)(t);t!==i&&(this.Rm=0,this.Ii(t,i,e,r))}}},m.ig=function(t){var e=eo(this,t,!1);if(e!==this.iq)"pointerout"!==t.originalEvent.type&&"pointerover"!==t.originalEvent.type&&(this.ef(t),this.Cd(t));else if(e){e=this.Fi;var r=fo(t);e.interaction.apply(e,r),t.originalEvent.preventDefault()}},m.ef=function(t){eo(this,t,!1)&&this.Fi.endInteraction(!this.ua)},m.Ii=function(t,e,r,i){var n=this.v.xa;if(isNaN(+t))throw Error("start zoom needs to be a number");if(isNaN(+e))throw Error("to zoom needs to be a number");0!=+e-+t&&(n.startControl(null,r,i),n.control(0,0,6,0,0,0),n.endControl(!0,(function(t){t.zoom=e})))},m.Tv=function(t){if(!t.defaultPrevented&&this.Rb&Xn){var e=t.delta,r=this.v.Ub(),i=this.v,n=i.Ca.type;i=this.Rb&Zn?r-e:(0>-e?od:nd)(r)-e,n!==Eh.P2D&&n!==Eh.WEBGL&&n!==Eh.HARP||(this.Ii(r,i,t.viewportX,t.viewportY),this.Rm=e),t.preventDefault()}},m.ie=function(){},m.Lv=function(t){var e=t.currentPointer,r=this.v.Ub(),i=t.currentPointer.type,n=this.v.Ca.type;(n===Eh.P2D||n===Eh.WEBGL||n===Eh.HARP)&&this.Rb&Yn&&(t="mouse"===i?0===t.originalEvent.button?-1:1:0<t.pointers.length?1:-1,t=this.Rb&Zn?r-t:(0>-t?od:nd)(r)-t,this.Ii(r,t,e.viewportX,e.viewportY))},m.bn=function(t){return!(this.Rb&Yn&&(t.preventDefault(),1))},m.l=function(){var t=this.v;t&&(t.draggable=!1,t.removeEventListener("dragstart",this.Cd,!1,this),t.removeEventListener("drag",this.ig,!1,this),t.removeEventListener("dragend",this.ef,!0,this),t.removeEventListener("wheel",this.Tv,!1,this),t.removeEventListener("dbltap",this.Lv,!1,this),t.removeEventListener("pointermove",this.ie,!1,this),delete this.v),this.sl&&(this.sl.style.msTouchAction="",bd(this.sl,"contextmenu",this.bn,!1,this),delete this.sl),delete this.Fi,delete this.ua,Tn.splice(Tn.indexOf(this.rv),1),delete this.rv,Ac.prototype.l.call(this)},Sn.prototype.dispose=Sn.prototype.l,t("H.mapevents.buildInfo",(function(){return bn("H-mapevents","1.60.0","2c2ebf2",{region:"row"})})),R.prototype.Yn=da(3,(function(t){var e=this.getCache(),r=this;if(t!==x){B(t,kj,R.prototype.Yn,0);var i=t}else i=qj;i!==e&&e.ia((function(t,e,n){return!!r.cc(t)&&(i.add(t,e,n),!0)})),this.jt=i})),th.prototype.Yb=da(2,(function(t){this.ts=t,(t=this.getState())!==ah.INIT&&t!==ah.LOADING&&Ah(this)}));var jo={};function ko(t,e){B(t,lo,ko,0);var r={};Object.assign(r,e),r.min=r.min||0,r.max=r.max||20,r.tileSize=r.tileSize||512,r.getURL=function(e,i,n){return t.Sf(e,i,n).clone().u({size:r.tileSize})},Sj.call(this,r),this.$=t}function W(t,e,r,i,n,o){if(!t||!e)throw new C(W,A,'Parameters "scheme" and "host" must be specified');this.$r(t),this.Qk(e),this.wc(r),this.Wr(n),this.Ow(o),this.Tk(i)}function mo(t,e){var r,i,n,o=globalThis.document,a="";if(o){if(a=o.createElement("a"),e){var s=(r=o.getElementsByTagName("base")[0])&&r.href,l=o.head,u=r||l.appendChild(o.createElement("base"));u.href=e}a.href=t,a=a.href,e&&(r?r.href=s:l.removeChild(u))}else/[\w]+:\/\//.test(t)&&(a=t);if(t=(s=/(?:(\w+):\/\/)?(?:([^:]+):([^@/]*)@)?([^/:]+)?(?:[:]{1}([0-9]+))?(\/[^?#]*)?(\?[^#]+)?(#.*)?/.exec(a))[1],l=s[4],e=s[5],u=s[6],o=s[7],r=s[8],!s[2]&&l&&/@/.test(l)&&(l=l.split("@")[1]),s=W,u=u&&0<u.length?u.substr(1):"",a={},o)for(i=/([?&]?([^=&+]+))(=([^&]+))?/g;n=i.exec(o);)a[decodeURIComponent(n[2])]=n[4]?decodeURIComponent(n[4]):void 0;return new s(t,l,u,a,isNaN(+e)?void 0:+e,r&&0<r.length?r.substr(1):"")}function po(t){return encodeURIComponent(t).replace(/[!'()*]/g,(function(t){return"%"+t.charCodeAt(0).toString(16)}))}function oo(t){var e,r=[],i=t.Ga,n={};for(e in i){if(i.hasOwnProperty(e)&&"function"!=typeof i[e]){var o=t.Ga[e];n.Og=po(e),B(o,qo)?o.jo.forEach(function(t){return function(e){r.push(t.Og+"="+po(e))}}(n)):B(o,ro)?r.push(n.Og+"="+o.jo.map((function(t){return po(t)})).join(o.Ry)):r.push(void 0===o?n.Og:n.Og+"="+po(o))}n={Og:n.Og}}return 0<r.length?"?"+r.join("&"):""}function so(t){var e=bn("H-service","1.60.0","2c2ebf2",{region:"row"});return t.Ga.xnlp="CL_JSMv3."+e.version,t}function no(t){var e,r=0;for(e in t.Ga)if(t.Ga.hasOwnProperty(e)&&"function"!=typeof t.Ga[e]&&0<++r)break;return!r}function to(t,e){if(fb(t))for(var r=0;r<t.length;r++){var i=t[r];if(!gb(i)&&!jb(i)){var n="The Array does not contain only strings and numbers";break}}else n="Not an Array";if(n)throw new C(e,0,t);return t}function qo(t){this.jo=to(t,qo)}function ro(t,e){if(this.jo=to(t,ro),!/^[!\$\(\)\*\+,;]$/.test(e))throw new C(ro,1,'Invalid delimiter "'+e+'"');this.Ry=e}function uo(){}u(ko,Sj),t("H.service.rasterTile.Provider",ko),ko.prototype.U=function(t,e){var r=this.$;return r.U().query(r.Ci.Rn+"."+r.K(),e,t)},ko.prototype.getCopyrights=ko.prototype.U,ko.prototype.Vi=function(){return Am()},ko.prototype.td=function(){return Am()?zm():ko.g.td.call(this)},t("H.service.Url",W),W.parse=mo,W.prototype.clone=function(){var t,e={};for(t in this.Ga)e[t]=this.Ga[t];return new W(this.oi,this.Qj,this.jf,e,this.uk,this.Db)},W.prototype.clone=W.prototype.clone,W.prototype.$r=function(t){if(!t||"string"!=typeof t)throw new C(this.$r,0,'The "scheme" parameter must be a non-empty string.');return this.oi=t,this},W.prototype.setScheme=W.prototype.$r,W.prototype.CA=function(){return this.oi},W.prototype.getScheme=W.prototype.CA,W.prototype.Qk=function(t){if(!t||"string"!=typeof t||"-"===t.charAt(0)||"."===t.charAt(0)||"."===t.charAt(t.length-1))throw new C(this.Qk,0,'The "host" parameter is not a valid host name.');return this.Qj=t,this},W.prototype.setHost=W.prototype.Qk,W.prototype.Vz=function(){return this.Qj},W.prototype.getHost=W.prototype.Vz,W.prototype.wc=function(t){return this.jf=t||void 0,this},W.prototype.setPath=W.prototype.wc,W.prototype.oA=function(){return this.jf},W.prototype.getPath=W.prototype.oA,W.prototype.Tk=function(t){if(t){if("object"!=typeof t)throw new C(this.Tk,0,'Parameter "params" must be an object.');this.Ga=t}else this.Ga={};return this},W.prototype.setQuery=W.prototype.Tk,W.prototype.Du=function(){return!no(this)},W.prototype.hasQuery=W.prototype.Du,W.prototype.getQuery=function(){return this.Ga},W.prototype.getQuery=W.prototype.getQuery,W.prototype.Wr=function(t){if(void 0===t)this.uk=t;else{var e=Nd(0|+t,0,65535);if(e!=t)throw new C(this.Wr,0,'Parameter "port" must be an integer in range [0...65535]');this.uk=e}return this},W.prototype.setPort=W.prototype.Wr,W.prototype.tA=function(){return this.uk},W.prototype.getPort=W.prototype.tA,W.prototype.Ow=function(t){return this.Db=t||void 0,this},W.prototype.setAnchor=W.prototype.Ow,W.prototype.yp=function(){return this.Db},W.prototype.getAnchor=W.prototype.yp,W.prototype.u=function(t){if("object"!=typeof t)throw new C(this.u,0,'Parameter "other" must be an object.');var e,r=this.Ga;for(e in t)t.hasOwnProperty(e)&&"function"!=typeof t[e]&&(r[e]=t[e]);return this},W.prototype.mergeQuery=W.prototype.u,W.prototype.la=function(t){if(!t||"string"!=typeof t)throw new C(this.la,0,'Parameter "subDomain" must be a non-empty string');return"."===t.substr(t.length-1)&&(t=t.substr(0,t.length-1)),this.Qk(t+"."+this.Qj)},W.prototype.addSubDomain=W.prototype.la,W.prototype.A=function(t){if(!t||"string"!=typeof t)throw new C(this.A,0,'Parameter "subPath" must be a non-empty string');return this.wc((this.jf?this.jf+"/":"")+t)},W.prototype.addSubPath=W.prototype.A,W.prototype.toString=function(){return[this.oi+"://",this.Qj,this.uk?":"+this.uk:"",this.jf||!no(this)||this.Db?"/":"",this.jf?encodeURI(this.jf):"",oo(this),this.Db?"#"+encodeURIComponent(this.Db):""].join("")},W.prototype.toString=W.prototype.toString,W.MultiValueQueryParameter=qo,qo.prototype.NA=function(){return this.jo},qo.prototype.getValues=qo.prototype.NA,W.DelimitedQuerySubValues=ro,uo.prototype.pop=function(t){return this[t]||(this[t]=[]),this[t].pop()||document.createElement("canvas")},uo.prototype.push=function(t,e){this[e]||(this[e]=[]),this[e].push(t)};var vo=new uo;function X(t){var e=(t=ho({},this.Py,t)).apikey||t.apiKey,r=t.baseUrl;if(r=e?r?0:"baseUrl":"apikey")throw new C(X,0,'"'+r+'" must be specified');this.Rw(t.baseUrl),this.ct=e,this.md.u({apikey:e}),this.pc=t.headers||{},this.XC=Qa(t.servicesConfig||{})}function wo(t,e,r){var i=+(r=r||{}).min,n=+r.max;r.min=i?Nd(i,1,17):1,r.max=n?Nd(n,1,17):17,wo.g.constructor.call(this,r),B(t,xo,wo,0),B(e,$g,wo,1),this.$=t,e.Yb&&e.Yb("OMV"),this.Xa(e,!0),this.Hl=go(this)}function yo(t,e){if(e=void 0===e?{}:e,!t.Hm)throw new wb(t);yo.g.constructor.call(this);var r=zo(this,e);if(!r.baseUrl&&!r.platformBaseUrl)throw new C(t,0,'either "baseUrl" or "platformBaseUrl" must be specified');this.yc=(r.baseUrl?r.baseUrl:r.platformBaseUrl).clone(),(t=r.baseUrl?e:r).host&&this.yc.Qk(t.host),t.subDomain&&this.yc.la(t.subDomain),t.path&&this.yc.wc(t.path),so(this.yc),this.pc=r.headers||{}}function zo(t,e){return t=t.Da(),e?ho({},t,e):t}function Ao(t,e,r){return function(i){return"function"!=typeof i.json?Promise.reject(r(Bo(e,i))):i.json().then((function(e){return r(t.Jc(e))}),(function(){return r(Bo(e,i))}))}}function Bo(t,e){return Error((e.statusText?"["+e.statusText+"] ":"")+t+" request failed")}function xo(t){xo.g.constructor.call(this,xo,t),this.Aq=(t||ke).layer||"traffic",this.me="mc",this.kz="omv"}function Co(t){Co.g.constructor.call(this,Co,t)}function Do(t){io(Do,"Use HERE Geocoding and Search API v7 instead."),Do.g.constructor.call(this,Do,t)}function Eo(t){if(this.ns=!!t.toBypassToken,!this.ns&&!t.token)throw new C(Eo,0,'"token" must be specified');io(Eo,"Use HERE IML service instead."),Eo.g.constructor.call(this,Eo,t),this.yx=t.token,this.st={},this.Vl={}}function Io(t,e,r,i,n,o,a){return n={method:n,headers:Object.assign(t.ns?{}:{authorization:"Bearer "+t.yx},{"Content-Type":"application/geo+json"},t.pc)},o&&(n.data=JSON.stringify(o)),(o=new nh("application/json",(e=Go(t.i().clone().A(e+"/features").u(a||{}))).toString(),vc,n)).then(r,Ao(t,e,i)),o}function Ho(t,e){return t.ns?e:Go(e).u({access_token:t.yx})}function Go(t){var e=Object.assign({},t.getQuery());return delete e.apikey,t.Tk(e)}t("H.service.util.eval",(function(a){return eval(a)})),t("H.service.Platform",X),X.prototype.Py={apikey:null,baseUrl:new W("https","hereapi.com")},X.prototype.Rw=function(t){this.md=so(t.clone()),this.ct=t=this.ct,this.md.u({apikey:t})},X.prototype.setBaseUrl=X.prototype.Rw,X.prototype.Lc=function(){return this.md},X.prototype.getBaseUrl=X.prototype.Lc,X.prototype.Ja=function(t,e){try{return t.Hm=!0,new t(ho({platformBaseUrl:this.Lc(),headers:this.pc},this.XC[t.CONFIG_KEY]||{},e||{}))}finally{t.Hm=!1}},X.prototype.createService=X.prototype.Ja,X.prototype.Yl=function(t,e,r){var i=this;if(!H.map.render.harp)throw Error("HARP engine module not found");if(!ya(t)&&!gb(t))throw new C(this.Yl,0,"is invalid: must be either a configuration object or a URL");if(!Za(e))throw new C(this.Yl,1,"is invalid: must be a Function");if(!Za(r))throw new C(this.Yl,2,"is invalid: must be a Function");var n=new H.map.render.harp.Style(t);n.addEventListener("change",(function(){var t=n.getState();if(-1===t)r(Error("H.service.platform#createHybridLayers method failed to load style configuration"));else if(2===t){t={dark:!0};var o=i.Qp({resource:"background",queryParams:{style:"satellite.day"}}),a=n.Sd(),s={styles:[{technique:"raster",attr:{gamma:1,brightness:1}}]};a.definitions&&(void 0!==a.definitions["Satellite.Texture.Gamma"]&&(s.styles[0].attr.gamma=a.definitions["Satellite.Texture.Gamma"]),void 0!==a.definitions["Satellite.Texture.Brightness"]&&(s.styles[0].attr.brightness=a.definitions["Satellite.Texture.Brightness"])),o=new ko(o,{engineType:Zm,style:new H.map.render.harp.Style(s)}),e({raster:new kl(o,t),vector:i.Lj().od(n,{engineType:Zm},t),traffic:i.Tp().od(n,{engineType:Zm},t)})}})),n.load()},X.prototype.createHybridLayers=X.prototype.Yl,X.prototype.Xl=function(t,e,r,i,n,o){function a(t,e,n){e=t.rm(e),e=f?new th(e):new H.map.render.harp.Style(e);var a,s={engineType:u};return h&&h.politicalView&&(s.politicalView=h.politicalView),r&&(s.lg=r),i&&(s.lg2=i),o&&(s.pois=o),n&&(a={dark:n}),t.od(e,s,a)}function s(t,e,r,i,n){return t.Pd(e,r,d,i,y,1,n,c)}var l=this,u=Dh,c={crossOrigin:"anonymous"};if(ya(t)){var h=t;"crossOrigin"in h&&(c.crossOrigin=h.crossOrigin),t=h.tileSize,e=h.ppi,r=h.lg,i=h.lg2,n=h.style,o=h.pois,void 0!==h.engineType&&(u=h.engineType,c.engineType=u)}var p=u===Eh.HARP,f=u===Eh.WEBGL,d=t||512,y={};if(0>[72,250,320,500].indexOf(+e)){if(e!==A)throw new C(this.Xl,1,e)}else y.ppi=+e;if(r&&(y.lg=r),i&&(y.lg2=i),n&&(y.style=n),o&&(y.pois=!!o),p&&!H.map.render.harp)throw new C(this.Xl,0,"HARP engine is not supported, module not found");t={},n=this.Kp();var g=this.Kp({type:"aerial"}),v=this.Sp(),m=v.vt(y.lg?{lg:y.lg,i18n:!0,engineType:u}:{engineType:u});if(ho(t,{raster:{normal:{xbase:s(n,"xbasetile","normal.day","png8",!1),xbasenight:s(n,"xbasetile","normal.night","png8",!0),base:s(n,"basetile","normal.day","png8",!1),basenight:s(n,"basetile","normal.night","png8",!0),map:s(n,"maptile","normal.day","png8",!1),mapnight:s(n,"maptile","normal.night","png8",!0),trafficincidents:m,transit:s(n,"maptile","normal.day.transit","png8",!1),labels:s(n,"labeltile","normal.day","png",!1)},satellite:{xbase:s(g,"xbasetile","hybrid.day","jpg",!0),base:s(g,"basetile","hybrid.day","jpg",!0),map:s(g,"maptile","hybrid.day","jpg",!0),labels:s(g,"labeltile","hybrid.day","png",!0)},terrain:{xbase:s(g,"xbasetile","terrain.day","jpg",!1),base:s(g,"basetile","terrain.day","jpg",!1),map:s(g,"maptile","terrain.day","jpg",!1),labels:s(g,"labeltile","terrain.day","png",!1)}}}),p||f){ho(t,{vector:{normal:{traffic:v.ut(void 0,u),trafficincidents:m}}}),g=this.Lj({queryParams:{content:"default,transit"}}),n=this.Tp(),v=this.Lj({queryParams:{content:"default,advanced_roads,advanced_pois,transit"}});var _=this.Lj({queryParams:{content:"default,hillshade,contours,transit"}});if(f)t.vector.normal.map=a(g,"omv/miami/normal.day.yaml"),t.vector.normal.truck=a(g,"omv/miami/truck.day.yaml");else if(p){t.vector.normal.map=a(g,"harp/oslo/normal.day.json"),t.vector.normal.truck=a(g,"harp/oslo/normal.day.json"),t.vector.normal.logistics=a(v,"harp/oslo/logistics.day.json"),t.vector.normal.logisticsnight=a(v,"harp/oslo/logistics.night.json"),m=a(_,"harp/oslo/topo.day.json"),_=a(_,"harp/oslo/topo.night.json");var b=function(t){if(2===(t=t.target).getState()){t.removeEventListener("change",b);var e=t.getEnabledFeatures()||[];[{feature:"terrain",mode:"hillshade"},{feature:"contours",mode:"all"}].forEach((function(t){var r=e.findIndex((function(e){return e.feature===t.feature}));e.splice(r,-1===r?0:1,t)})),t.setEnabledFeatures(e)}};m.D.K().addEventListener("change",b),_.D.K().addEventListener("change",b),t.vector.normal.topo=m,t.vector.normal.toponight=_;var x={ppi:72<e||void 0===e&&2<=window.devicePixelRatio?200:100,size:256<d?512:256,features:"pois:"+(!0===o||gb(o)&&/[^0]/.test(o)?"all":"disabled")};r&&(x.lang=r),i&&(x.lang2=i),h&&h.politicalView&&(x.pview=h.politicalView),e={dark:!0},m=function(t,e,r,i,n){var o=ho({},x);return/^explore\./.test(r)||delete o.features,new kl(n=new ko(t=l.Qp({format:e,resource:t,queryParams:ho({style:r},o)}),{engineType:u,style:n}),i)},ho(t.raster.normal,{base:m("background","png8","explore.day"),basenight:m("background","png8","explore.night",e),map:m("base","png8","explore.day"),mapnight:m("base","png8","explore.night",e),labels:m("label","png","explore.day")}),ho(t.raster.satellite,{xbase:m("background","jpeg","satellite.day",e),base:m("background","jpeg","explore.satellite.day",e),map:m("base","jpeg","explore.satellite.day",e),labels:m("label","png","explore.satellite.day")}),ho(t.vector.normal,{mapnight:a(g,"harp/oslo/normal.night.json",!0),lite:a(g,"harp/oslo/lite.day.json"),litenight:a(g,"harp/oslo/lite.night.json",!0),ism:a(g,"harp/oslo/road.network.day.json"),ismnight:a(g,"harp/oslo/road.network.night.json",!0),roadnetwork:a(g,"harp/oslo/road.network.day.json"),roadnetworknight:a(g,"harp/oslo/road.network.night.json",!0)}),_={styles:[{technique:"raster",attr:{gamma:["step",["zoom"],.9,13,1],brightness:["step",["zoom"],.6,12,.7,13,.8,14,.8,17,.9]}}]};for(var w=[],E=0;6>E;E++){var T=new H.map.render.harp.Style(JSON.parse(JSON.stringify(_)));T=m("background","jpeg","satellite.day",e,T),w.push(T)}t.hybrid={day:{raster:w[0],vector:a(g,"harp/oslo/hybrid.day.json",!0),traffic:a(n,"harp/oslo/hybrid.day.json",!0)},night:{raster:w[1],vector:a(g,"harp/oslo/hybrid.night.json",!0),traffic:a(n,"harp/oslo/hybrid.night.json",!0)},liteday:{raster:w[2],vector:a(g,"harp/oslo/lite.hybrid.day.json",!0),traffic:a(n,"harp/oslo/lite.hybrid.day.json",!0)},litenight:{raster:w[3],vector:a(g,"harp/oslo/lite.hybrid.night.json",!0),traffic:a(n,"harp/oslo/lite.hybrid.night.json",!0)},logistics:{raster:w[4],vector:a(v,"harp/oslo/logistics.hybrid.day.json",!0),traffic:a(n,"harp/oslo/logistics.hybrid.day.json",!0)},logisticsnight:{raster:w[5],vector:a(v,"harp/oslo/logistics.hybrid.night.json",!0),traffic:a(n,"harp/oslo/logistics.hybrid.night.json",!0)}}}(g={traffic:{}}).traffic.map=a(n,f?"traffic/vector.tile.yaml":"harp/oslo/normal.day.json"),p&&(g.traffic.logistics=a(n,"harp/oslo/logistics.day.json"),g.traffic.logisticsnight=a(n,"harp/oslo/logistics.night.json"),g.traffic.mapnight=a(n,"harp/oslo/normal.night.json"),g.traffic.lite=a(n,"harp/oslo/lite.day.json"),g.traffic.litenight=a(n,"harp/oslo/lite.night.json"),g.traffic.topo=a(n,"harp/oslo/topo.day.json"),g.traffic.toponight=a(n,"harp/oslo/topo.night.json")),ho(t.vector,g)}return t},X.prototype.createDefaultLayers=X.prototype.Xl,u(wo,R),t("H.service.trafficVectorTile.Provider",wo),wo.prototype.Xc=ge,wo.prototype.providesOMV=wo.prototype.Xc,wo.prototype.cc=function(t){return this.Hl.test(t)},wo.prototype.cacheFilter=wo.prototype.cc,wo.prototype.Vd=function(t,e,r){return this.$.Sf(t,e,r).toString()},wo.prototype.getTileKey=wo.prototype.Vd,wo.prototype.Sb=function(){return this.wf},wo.prototype.getCache=wo.prototype.Sb,wo.prototype.MAX_STORE_TIME=2592e6,wo.prototype.Vi=function(){return Am()},wo.prototype.td=function(){return Am()?zm():wo.g.td.call(this)},wo.prototype.o=function(t,e,r,i,n){return this.$.Pa(t,e,r,i,n)},wo.prototype.requestInternal=wo.prototype.o,wo.prototype.Cb=function(t){t.Yb&&t.Yb("OMV"),this.Xa(t)},wo.prototype.setStyle=wo.prototype.Cb,wo.prototype.K=function(){return wo.g.mb.apply(this)},wo.prototype.getStyle=wo.prototype.K,wo.prototype.wf=new kj(256),wo.prototype.U=function(){return null},wo.prototype.getCopyrights=wo.prototype.U,u(yo,E),t("H.service.Service",yo),yo.prototype.Da=function(){return{}},yo.prototype.i=function(){return this.yc},yo.prototype.getUrl=yo.prototype.i,yo.prototype.o=function(t,e,r,i){return(i=new nh(void 0===i?"application/json":i,t.toString(),vc,{headers:this.pc})).then(e,Ao(this,t,r)),i},yo.prototype.Jc=function(t){return Error(t.message)},u(xo,yo),t("H.service.trafficVectorTile.Service",xo),xo.prototype.Da=function(){return{subDomain:"traffic.vector",path:"v2"}},xo.CONFIG_KEY="trafficVectorTile",xo.prototype.od=function(t,e,r){e=e||{};var i={min:0,max:22};return ya(r)&&ho(i,r),new kl(new wo(this,t,e),i)},xo.prototype.createLayer=xo.prototype.od,xo.prototype.Pa=function(t,e,r,i,n){return this.o(this.Sf(t,e,r),(function(t){return t.arrayBuffer().then(i,n)}),n,"arraybuffer")},xo.prototype.Sf=function(t,e,r){return this.i().clone().A("traffictiles/"+this.Aq+"/"+this.me+"/"+r+"/"+t+"/"+e+"/"+this.kz)},xo.prototype.rm=function(t){return kn()+"/"+t},xo.prototype.bA=function(){return this.Aq},xo.prototype.getLayerName=xo.prototype.bA,X.prototype.Tp=function(t){return this.Ja(xo,t)},X.prototype.getTrafficVectorTileService=X.prototype.Tp,u(Co,yo),t("H.service.publicTransit.Service",Co),Co.prototype.Da=function(){return{subDomain:"transit.router",path:"v8"}},Co.CONFIG_KEY="publicTransit",Co.prototype.AA=function(t,e,r){return t=this.i().clone().A("routes").u(t),this.o(t,e,r)},Co.prototype.getRoutes=Co.prototype.AA,Co.prototype.Iz=function(t,e,r){return t=this.i().clone().A("departures").u(t),this.o(t,e,r)},Co.prototype.getDepartures=Co.prototype.Iz,Co.prototype.EA=function(t,e,r){return t=this.i().clone().A("stations").u(t),this.o(t,e,r)},Co.prototype.getStations=Co.prototype.EA,Co.prototype.Jc=function(t){return Error(JSON.stringify(t))},X.prototype.wA=function(t){return this.Ja(Co,t)},X.prototype.getPublicTransitService=X.prototype.wA,u(Do,yo),t("H.service.PlacesService",Do),Do.prototype.Da=function(){return{subDomain:"places.ls",path:"places/v1"}},Do.CONFIG_KEY="places",Do.EntryPoint={SEARCH:"discover/search",SUGGEST:"suggest",EXPLORE:"discover/explore",AROUND:"discover/around",HERE:"discover/here",CATEGORIES:"categories/places"},Do.prototype.request=function(t,e,r,i){return this.I(t,e,r,i)},Do.prototype.request=Do.prototype.request,Do.prototype.I=function(t,e,r,i){return t=this.i().clone().A(t).u(e||{}),this.o(t,r,i)},Do.prototype.search=function(t,e,r){return this.I("discover/search",t,e,r)},Do.prototype.search=Do.prototype.search,Do.prototype.rD=function(t,e,r){return this.I("suggest",t,e,r)},Do.prototype.suggest=Do.prototype.rD,Do.prototype.ez=function(t,e,r){return this.I("discover/explore",t,e,r)},Do.prototype.explore=Do.prototype.ez,Do.prototype.ny=function(t,e,r){return this.I("discover/around",t,e,r)},Do.prototype.around=Do.prototype.ny,Do.prototype.WA=function(t,e,r){return this.I("discover/here",t,e,r)},Do.prototype.here=Do.prototype.WA,Do.prototype.zy=function(t,e,r){return this.I("categories/places",t,e,r)},Do.prototype.categories=Do.prototype.zy,Do.prototype.iz=function(t,e,r,i){return t=mo(t).u(this.i().getQuery()).u(i||{}),this.o(t,e,r)},Do.prototype.follow=Do.prototype.iz,X.prototype.pA=function(t){return this.Ja(Do,t)},X.prototype.getPlacesService=X.prototype.pA,u(Eo,yo),t("H.service.xyz.Service",Eo),Eo.prototype.Da=function(){return{host:"xyz.api.here.com",path:"hub/spaces"}},Eo.prototype.Jc=function(t){return Error(t.errorMessage||t.message)},Eo.prototype.Np=function(t,e,r){return db(t,"String",this.Np,0,'"projectId" must be a string'),Fo(this.Np,1,e,r),t=Go(this.i().clone().wc("project-api/projects/"+t)),this.o(t,e,r)},Eo.prototype.getProject=Eo.prototype.Np,Eo.prototype.tu=function(t,e,r){return Fo(this.tu,0,t,e),r=Ho(this,this.i().clone().u(r||{})),this.o(r,t,e)},Eo.prototype.getSpaces=Eo.prototype.tu,Eo.prototype.qm=function(t,e,r){return db(t,"String",this.qm,0,'"spaceId" must be a string'),Fo(this.qm,1,e,r),t=Ho(this,this.i().clone().A(t)),this.o(t,e,r)},Eo.prototype.getSpace=Eo.prototype.qm,Eo.prototype.Dh=function(t,e,r){return db(t,"String",this.Dh,0,'"spaceId" must be a string'),Fo(this.Dh,1,e,r),t=Ho(this,this.i().clone().A(t+"/statistics")),this.o(t,e,r)},Eo.prototype.getStatistics=Eo.prototype.Dh,Eo.prototype.lm=function(t,e,r,i,n,o,a){return t=Ho(this,this.i().clone().A(i+"/tile/web/"+r+"_"+t+"_"+e+".mvtf").u(Object.assign({clip:!0},a))),this.o(t,(function(t){return t.arrayBuffer().then(n)}),o,"arraybuffer")},Eo.prototype.search=function(t,e,r,i){return db(t,"String",this.search,0,'"spaceId" must be a string'),Fo(this.search,1,e,r),t=Ho(this,this.i().clone().A(t+"/search").u(i||{})),this.o(t,e,r)},Eo.prototype.search=Eo.prototype.search,Eo.prototype.Ue=function(t,e,r,i){if(db(t,"String",this.Ue,0,'"spaceId" must be a string'),!ya(e))throw new C(this.Ue,1,'"params" must be an object');return Fo(this.Ue,2,r,i),t=Ho(this,this.i().clone().A(t+"/features").u(e)),this.o(t,r,i)},Eo.prototype.getFeaturesById=Eo.prototype.Ue,Eo.prototype.wh=function(t,e,r,i){if(db(t,"String",this.wh,0,'"spaceId" must be a string'),!ya(e))throw new C(this.Ue,1,'"params" must be an object');return Fo(this.wh,2,r,i),t=Ho(this,this.i().clone().A(t+"/bbox").u(e)),this.o(t,r,i)},Eo.prototype.getFeaturesByBoundingBox=Eo.prototype.wh,Eo.prototype.U=function(t){return this.st[t]||(this.Vl[t]||this.Kf(t),null)},Eo.prototype.nf=function(t,e,r,i,n){if(db(t,"String",this.nf,0,'"spaceId" must be a string'),!ya(e))throw new C(this.nf,1,'"geojsonObject" must be an object');if(Fo(this.nf,2,r,i),n&&!ya(n))throw new C(this.nf,4,'"opt_params" must be an object');return Io(this,t,r,i,"PUT",e,n)},Eo.prototype.putFeatures=Eo.prototype.nf,Eo.prototype.lf=function(t,e,r,i,n){if(db(t,"String",this.lf,0,'"spaceId" must be a string'),!ya(e))throw new C(this.lf,1,'"featureCollection" must be an object');if(Fo(this.lf,2,r,i),n&&!ya(n))throw new C(this.lf,4,'"opt_params" must be an object');return Io(this,t,r,i,"POST",e,n)},Eo.prototype.postFeatures=Eo.prototype.lf,Eo.prototype.If=function(t,e,r,i){if(db(t,"String",this.If,0,'"spaceId" must be a string'),!ya(e))throw new C(this.If,1,'"params" must be an object');return Fo(this.If,2,r,i),Io(this,t,r,i,"DELETE",A,e)},Eo.prototype.deleteFeatures=Eo.prototype.If,Eo.prototype.Kf=function(t){var e=this;this.Vl[t]=Jo,this.qm(t,(function(r){e.Vl[t]=Ko,e.st[t]=r.copyright,e.dispatchEvent("copyrightupdate")}),(function(r){throw e.Vl[t]=Lo,r}))},Eo.CONFIG_KEY="xyz";var Jo=1,Ko=2,Lo=-1;function Fo(t,e,r,i){if(!Za(r))throw new C(t,e,'"onResult" must be a function');if(!Za(i))throw new C(t,e+1,'"onError" must be a function')}function Mo(t,e,r){var i;if(Mo.g.constructor.call(this,r?{min:r.min,max:r.max,engineType:r.engineType}:void 0),B(t,Eo,Mo,0),!gb(e))throw new C(Mo,1,'"spaceId" must be a string');if(this.$=t,this.Gg=e,this.Ok={},r&&(["limit","simplificationLevel","tags"].forEach((function(t){t in r&&(this.Ok[t]=r[t])}),this),t=r.parameters))for(i in t)this.Ok[i]=t[i];this.Xa(this.Ep())}function No(){this.qs={}}function Oo(t,e){for(var r in e)e.hasOwnProperty(r)&&t.Bo(r,e[r])}function Po(t,e,r,i,n,o,a){var s=this;a=a||{},o=o||{};var l=t.i().clone().A(e+"/"+t.fb+"/"+r).u(o),u=t.bd;this.$=t,this.rx=l,Sj.call(this,{tileSize:i,max:512===i?19:20,min:512===i?2:0,getURL:function(t,e,r){var o=s.rx.clone();return u&&o.la(u[(r+e+t)%u.length]),o.A(r+"/"+t+"/"+e+"/"+i+"/"+n),o.toString()},crossOrigin:a.crossOrigin,headers:a.headers,uri:l.toString().replace(/_/g,"")+i,engineType:a.engineType}),this.vD=e,this.oi=r,this.Ga=o,this.Xo=r.split(".")[0],this.Ce=z(this.Ce,this),this.getCopyrights=this.U,this.Ye=!1,t.addEventListener("versionupdate",this.Ce)}function Qo(t){Qo.g.constructor.call(this,Qo,t),t=zo(this,t),this.bd=t.shards,(this.Ra=t.ignoreTypes?null:t.type)&&this.i().la(this.Ra),this.fb=t.version,this.ec=new No,this.pr={},this.Wl=0,"newest"===this.fb&&this.rp()}function Ro(t,e){for(var r={},i=t[e+"s"][e],n=i.length;n--;)r[i[n].id]=i[n];t[e+"s"]=r}function So(t){So.g.constructor.call(this,So,t),io(So,"Use HERE Geofencing API v8 instead.")}function To(){}function Uo(t,e){this.$b=t,this.Nl=e}function Vo(){}function Wo(){}function Xo(t,e){this.$b=t,this.Kk=e}function Yo(t,e,r){var i;if(e=e||(t&&t.length?Object.keys(t[0]):A),this.Ob=t,e)for(this.eh=e,this.To=t=Ua(),i=e.length;i--;)t[e[i]]=!0;r!==A&&(this.Lq=r)}function Zo(t,e,r,i){if(!Za(r))throw new C(t,e,"has invalid type");if(!Za(i))throw new C(t,e+1,"has invalid type")}function $o(t,e,r,i){i=i||ap,this.Fk={},i.provider=t,this.invalidate=he,$o.g.constructor.call(this,e,i),delete this.invalidate,r&&(this.ED=r),this.ra(Lf.ADD)}X.prototype.RA=function(t){return this.Ja(Eo,t)},X.prototype.getXYZService=X.prototype.RA,u(Mo,R),t("H.service.xyz.Provider",Mo),Mo.prototype.o=function(t,e,r,i,n){return this.$.lm(t,e,r,this.Gg,i,n,this.Ok)},Mo.prototype.requestInternal=Mo.prototype.o,Mo.prototype.U=function(){return this.$.U(this.Gg)},Mo.prototype.getCopyrights=Mo.prototype.U,Mo.prototype.Xc=ge,Mo.prototype.providesOMV=Mo.prototype.Xc,Mo.prototype.K=function(){return this.mb()},Mo.prototype.getStyle=Mo.prototype.K,Mo.prototype.Cb=function(t){B(t,th)&&t.Yb("MVT"),this.Xa(t)},Mo.prototype.setStyle=Mo.prototype.Cb,Mo.prototype.Ep=function(){return this.vb===Eh.WEBGL?new th({sources:{xyz:{type:"MVT"}},layers:{xyz:{data:{source:"xyz",layer:this.Gg},points:{filter:{$geometry:"point"},draw:{points:{collide:!1,order:200,color:"#92CF48",size:[[10,"8px"],[14,"12px"],[18,"16px"]]}}},polygons:{filter:{$geometry:"polygon"},draw:{polygons:{order:201,color:"#E39E3C"},lines:{order:202,color:"#755DA5",width:"1px"}}},lines:{filter:{$geometry:"line"},draw:{lines:{order:203,color:"#000000",width:"2px",join:"round",cap:"round"}}}}}}):new H.map.render.harp.Style({styles:[{layer:this.Gg,when:["==",["geometry-type"],"Point"],technique:"circles",renderOrder:200,color:"#92CF48",size:["interpolate",["linear"],["zoom"],10,8,14,12,18,16]},{layer:this.Gg,when:["==",["geometry-type"],"Polygon"],technique:"polygon",color:"#E39E3C",renderOrder:201},{layer:this.Gg,when:["==",["geometry-type"],"Polygon"],technique:"solid-line",color:"#755DA5",width:"1px",renderOrder:202},{layer:this.Gg,when:["==",["geometry-type"],"LineString"],technique:"solid-line",color:"#000000",width:"2px",renderOrder:203}]})},No.prototype.Bo=function(t,e){t=this.qs[t]||(this.qs[t]=[]);var r,i=e.length;for(r=0;r<i;r++){var n=new jo.Rs(e[r]);t.push(n)}},No.prototype.query=function(t,e,r){var i,n=(t=this.qs[t])?t.length:0,o=[];for(i=0;i<n;i++)t[i].Wf(e,r)&&o.push(t[i]);return o},jo.Rs=function(t){var e,r=t.boxes;if(this.alt=t.alt,this.label=t.label,this.min=t.minLevel,this.max=t.maxLevel,this.Gn=[],r&&(e=r.length)){var i=r[0],n=new I(i[0],i[1],i[2],i[3]);for(this.Gn.push(n),this.rn=new I(i[0],i[1],i[2],i[3]),t=1;t<e;t++)n=new I((i=r[t])[0],i[1],i[2],i[3]),this.Gn.push(n),this.rn.zd(n,!1,this.rn)}},jo.Rs.prototype.Wf=function(t,e){if(t>=this.min&&t<=this.max){if(!(t=this.Gn.length)||!this.rn)return!0;if(this.rn.Wf(e))for(;t--;)if(this.Gn[t].Wf(e))return!0}return!1},u(Po,Sj),Po.prototype.MAX_STORE_TIME=2592e6,Po.prototype.o=function(t,e,r,i,n,o){return this.Ye||(io(Qo,"Use HERE Vector Tile API or Raster Tile API v3 instead."),this.Ye=!0),Po.g.o.call(this,t,e,r,i,n,o)},Po.prototype.requestInternal=Po.prototype.o,Po.prototype.disposeInternal=function(){Sj.prototype.disposeInternal.call(this),this.$.removeEventListener("versionupdate",this.Ce)},Po.prototype.U=function(t,e){return this.$.U().query(this.Xo,e,t)},Po.prototype.getCopyrights=Po.prototype.U,Po.prototype.Ce=function(){var t=this.$;this.rx=t.i().clone().A(this.vD+"/"+t.fb+"/"+this.oi).u(this.Ga),this.reload(!1)},Po.prototype.Vi=function(){return Am()},Po.prototype.td=function(){return Am()?zm():Po.g.td.call(this)},u(Qo,yo),t("H.service.MapTileService",Qo),Qo.prototype.Da=function(){return{subDomain:"maps.ls",path:"maptile/2.1",type:"base",version:"newest",shards:["1","2","3","4"]}},Qo.CONFIG_KEY="maptile",Qo.prototype.vu=function(){return this.Ra},Qo.prototype.getType=Qo.prototype.vu,Qo.prototype.Wp=function(){return this.fb},Qo.prototype.getVersion=Qo.prototype.Wp,Qo.prototype.cs=function(t){this.fb=t},Qo.prototype.U=function(){return this.Wl||(this.fb&&"newest"!==this.fb||"traffic"===this.Ra)&&this.Kf(),this.ec},Qo.prototype.getCopyrights=Qo.prototype.U,m=Qo.prototype,m.ss=function(t){var e;if(Ro(t=t.response,"map"),Ro(t,"scheme"),Ro(t,"tiletype"),Ro(t,"format"),Ro(t,"resolution"),Ro(t,"language"),"newest"===this.fb&&"traffic"!==this.Ra)for(e in t.maps)t.maps[e].hash&&t.maps[e].newest&&(this.cs(t.maps[e].hash),this.dispatchEvent("versionupdate"));this.fq=t,this.dispatchEvent("infoupdate")},m.pl=function(t){Oo(this.ec,t),this.dispatchEvent("copyrightupdate")},m.rp=function(){var t=this,e=this.i().clone().A("info").u({output:"json"});this.bd&&e.la(this.bd[0]),this.o(e,(function(e){t.ss(e)}),(function(t){throw t}))},m.Kf=function(){var t=this,e=this.i().clone().A("copyright").A(t.fb).u({output:"json"});this.bd&&e.la(this.bd[0]),this.Wl=1,this.o(e,(function(e){t.Wl=2,t.pl(e)}),(function(e){throw t.Wl=-1,e}))},m.Kj=function(){return this.fq},Qo.prototype.getInfo=Qo.prototype.Kj,Qo.prototype.nj=function(t,e,r,i,n,o){var a,s=this.i().clone().A(t+"/"+this.fb+"/"+e+"/"+r+"/"+i).u(n||{}).toString(),l=0,u=s.length;if(0!==u)for(a=0;a<u;a++)l=(l<<5)-l+s.charCodeAt(a),l|=0;return s=l,(l=this.pr[s])||(l=new Po(this,t,e,r,i,n,ho({headers:this.pc},o||{})),this.pr[s]=l),l},Qo.prototype.createTileProvider=Qo.prototype.nj,Qo.prototype.Pd=function(t,e,r,i,n,o,a,s){return new kl(t=this.nj(t,e,r,i,n,s),{opacity:o,dark:!!a})},Qo.prototype.createTileLayer=Qo.prototype.Pd,X.prototype.Kp=function(t){return this.Ja(Qo,t)},X.prototype.getMapTileService=X.prototype.Kp,u(So,yo),t("H.service.extension.geofencing.Service",So),So.prototype.Da=function(){return{subDomain:"fleet.ls",path:"2"}},So.CONFIG_KEY="geofencing",So.prototype.request=function(t,e,r,i){return this.I(t,e,r,i)},So.prototype.request=So.prototype.request,So.prototype.Jc=function(t){return Error(t.issues&&t.issues.length?t.issues.map((function(t){return t.message})).join(". "):t.message||t.response_code)},So.prototype.I=function(t,e,r,i){if(!t)throw new C(this.request,0,t);if(!Za(r))throw new TypeError("onResult must be a function");if(!Za(i))throw new TypeError("onError must be a function");return t=this.i().clone().A(t+".json").u(e),this.o(t,r,i)},So.EntryPoint={SEARCH_PROXIMITY:"search/proximity"},t("H.service.extension.dataView.IColumn",To),To.prototype.va=function(){},To.prototype.getCell=To.prototype.va,t("H.service.extension.dataView.ObjColumn",Uo),Uo.prototype.va=function(t){return this.$b.va(t,this.Nl)},Uo.prototype.getCell=Uo.prototype.va,t("H.service.extension.dataView.ITable",Vo),Vo.prototype.zh=function(){},Vo.prototype.getMeta=Vo.prototype.zh,Vo.prototype.Ch=function(){},Vo.prototype.getRowCount=Vo.prototype.Ch,Vo.prototype.Ud=function(){},Vo.prototype.getRow=Vo.prototype.Ud,Vo.prototype.ab=function(){},Vo.prototype.getColumnNames=Vo.prototype.ab,Vo.prototype.Fj=function(){},Vo.prototype.getColumn=Vo.prototype.Fj,Vo.prototype.va=function(){},Vo.prototype.getCell=Vo.prototype.va,Vo.prototype.concat=function(){},Vo.prototype.concat=Vo.prototype.concat,t("H.service.extension.dataView.IRow",Wo),Wo.prototype.ab=function(){},Wo.prototype.getColumnNames=Wo.prototype.ab,Wo.prototype.va=function(){},Wo.prototype.getCell=Wo.prototype.va,Wo.prototype.Rf=function(){},Wo.prototype.getTable=Wo.prototype.Rf,t("H.service.extension.dataView.ObjRow",Xo),Xo.prototype.ab=function(){return this.$b.ab()},Xo.prototype.getColumnNames=Xo.prototype.ab,Xo.prototype.va=function(t){return this.$b.va(this.Kk,t)},Xo.prototype.getCell=Xo.prototype.va,Xo.prototype.Rf=function(){return this.$b},Xo.prototype.getTable=Xo.prototype.Rf,t("H.service.extension.dataView.ObjTable",Yo),m=Yo.prototype,m.Lq=A,m.Ob=A,m.eh=A,m.To=A,m.zh=function(){return this.Lq},Yo.prototype.getMeta=Yo.prototype.zh,Yo.prototype.Ch=function(){return this.Ob?this.Ob.length:0},Yo.prototype.getRowCount=Yo.prototype.Ch,Yo.prototype.Ud=function(t){var e=this.Ob;return e&&e[t]?new Xo(this,t):A},Yo.prototype.getRow=Yo.prototype.Ud,Yo.prototype.ab=function(){return this.eh||je},Yo.prototype.getColumnNames=Yo.prototype.ab,Yo.prototype.Fj=function(t){return this.To[t]?new Uo(this,t):A},Yo.prototype.getColumn=Yo.prototype.Fj,Yo.prototype.va=function(t,e){var r=this.Ob;return(t=r&&this.To[e]&&r[t])&&t[e]},Yo.prototype.getCell=Yo.prototype.va,Yo.prototype.concat=function(){var t,e=arguments.length,r=this.eh,i=""+this.eh,n=(this.Ob||[]).slice();for(t=0;t<e;t++){var o=arguments[t];if(!(o instanceof Yo))throw new C(this.concat,t);if(o.Ob){if(r&&""+o.eh!==i)throw new C(this.concat,t,"Incompatible columns!");n=n.concat(o.Ob)}}return new Yo(n,this.eh,this.Lq)},Yo.prototype.concat=Yo.prototype.concat,u($o,cg),t("H.service.remote.Spatial",$o);var ap={};function bp(t,e){this.gm=t,e&&(this.labels=e)}$o.prototype.xb=function(){return this.ED||cg.prototype.xb.call(this)},$o.prototype.getId=$o.prototype.xb,$o.prototype.Sn=ie,$o.prototype.retain=$o.prototype.Sn,$o.prototype.release=ge,$o.prototype.release=$o.prototype.release;var cp=new bp(je);function dp(t,e,r){t.Fk[e.key]=new bp(r,void 0)}function ep(t,e,r){var i=8===t;this.zi=e,this.Pt=r||ie,(this.Mm=4===t||i)?this.Xe=i:this.Wu=1===t,this.cu=this.Mm?"$HProjGeometry":"geometry"}function fp(t,e,r,i,n){var o=[],a=n.paths,s=a.length,l=0,u=t.zi&&t.zi(i);for(t=new $o(e,t.Xe,A,{style:u||t.Qy,data:i});l!==s;){i=(e=o).push;for(var c=0,h=(u=a[l++]).length,p=[];c<h;)p.push(new K(u[c++],u[c++]));i.call(e,p)}return dp(t,r,[new Hf(o,n.interiorsIndex,n.outlinesIndex)]),t}function gp(t,e,r,i){i=new xe(i[0],i[1]);var n=t.zi&&t.zi(r);return t=t.Wu?new hi(i,t={icon:n,data:r,provider:e}):new Ui(i,t={icon:n,data:r,provider:e})}function hp(t,e){var r={};this.rC=t,Sa(r,e||r),Mm.call(this,r),this.Jn={},(t=this.Nc(Yf.SPATIAL)).update(t.Md+1,Lf.ADD)}function ip(t){return t.Wd(!0)}function jp(t,e,r){var i,n=e.Ji&&e.Ji[r];return!n&&(i=e.ul)&&(delete e.ul,(e.Ji=t=t.rC.parse(t,e,i))&&(n=t[r])),n||je}$o.prototype.xh=function(t){return(this.Fk[t.key]||cp).gm},$o.prototype.getGeometriesForTile=$o.prototype.xh,$o.prototype.Hp=function(t){return(this.Fk[t.key]||cp).labels},$o.prototype.getLabels=$o.prototype.Hp,ep.prototype.parse=function(t,e,r){var i,n,o,a={},s=[],l=0;for(n=r.length;l<n;l++){var u=r[l],c=u.Rows;if(u=c.length){var h=Object.keys(c[0]).filter((function(t){return"geometry"!==t&&"$HProjGeometry"!==t}));for(h=new Yo(c,h),o=0;o<u;o++){var p=c[o];if(i=p[this.cu]){if(delete p[this.cu],p=h.Ud(o))try{var f=this.Mm?fp(this,t,e,p,i):gp(this,t,p,i.path);f.ea(t),s.push(f)}catch(t){this.Pt(t.message)}}else this.Pt("Layer must contain geometries")}}}return a[this.Mm?"spatials":this.Wu?"markers":"domMarkers"]=s,a},u(hp,Mm),t("H.service.remote.ObjectProvider",hp),hp.prototype.l=function(){Mm.prototype.l.call(this)},hp.prototype.dispose=hp.prototype.l,hp.prototype.qe=function(){return je},hp.prototype.requestMarkers=hp.prototype.qe,hp.prototype.pe=function(){return je},hp.prototype.requestDomMarkers=hp.prototype.pe,hp.prototype.xg=function(){return je},hp.prototype.requestOverlays=hp.prototype.xg,hp.prototype.Wc=ge,hp.prototype.providesMarkers=hp.prototype.Wc,hp.prototype.Vc=ge,hp.prototype.providesDomMarkers=hp.prototype.Vc,hp.prototype.ne=ge,hp.prototype.providesSpatials=hp.prototype.ne,hp.prototype.Nn=function(){return je},hp.prototype.requestSpatials=hp.prototype.Nn,hp.prototype.On=function(t,e){return t=jp(this,t,kp),e&&(t=t.filter(ip)),t},hp.prototype.requestSpatialsByTile=hp.prototype.On,hp.prototype.Y=function(t){var e=t.xb();if(this.Jn[e])throw new wb(this.Y,"Remote object "+e+" already added");return this.Jn[e]=t},hp.prototype.Oa=function(t){delete this.Jn[t.xb()]};var kp="spatials";function lp(t){var e=(t=t||{}).tileCacheSize||1024,r=t.resultType,i=t.styleCallback;if(ab(t.min)||(t.min=12),lp.g.constructor.call(this,t),-1===mp.indexOf(r))throw new C(lp,2,"invalid resultType");if(this.resultType=r,i&&!Za(i))throw new C(lp,2,"invalid style callback");this.zi=i,this.oa=t.pixelRatio||Vd(),this.Ic=z(this.Ic,this),this.Yn(new kj(e,z(this.ke,this))),this.createTileInternal=z(4===r||8===r?this.Hy:this.Fy,this)}function np(t){var e=t.Bd;return e||(t.bw||(t.bw=t.qu(t.resultType,t.zi,t.Ic)),(e=t.Bd=new hp(t.bw)).ea(t),e.addEventListener(t.j.Aa,z(t.he,t)),e.uw=!0),e}u(lp,R),t("H.service.extension.TileProvider",lp),lp.prototype.rq=!1,lp.prototype.getCapabilities=function(){return lp.g.getCapabilities.call(this)|xg.CROP_LINES_BY_TILE|xg.CROP_POLYGONS_BY_TILE},lp.prototype.Pa=function(t,e,r,i){return this.rq?lp.g.Pa.call(this,t,e,r,i):A},lp.prototype.requestTile=lp.prototype.Pa,lp.prototype.Ic=function(t){this.dispatchEvent(new fd("error",gb(t)?t:t+"",this))},lp.prototype.Wc=function(){return 1===this.resultType},lp.prototype.providesMarkers=lp.prototype.Wc,lp.prototype.Vc=function(){return 2===this.resultType},lp.prototype.providesDomMarkers=lp.prototype.Vc,lp.prototype.ne=function(){return 4===this.resultType||8===this.resultType},lp.prototype.providesSpatials=lp.prototype.ne,lp.prototype.Fy=function(t,e,r,i){var n=this.getTileKey(t,e,r);n=this.Sb().get(n);var o=2==this.resultType,a=[],s=np(this);for(n?n.valid=!0:(delete(t=n=new gj(t,e,r,x)).Ji,t.ul=i),e=(i=jp(s,n,o?"domMarkers":"markers")).length;e--;)(t=i[e]).ys=n,(o||1===t.kc().getState())&&a.push(t);return n.data=a,n},lp.prototype.he=function(t){(t=t.target.ys)&&(t.valid=!1)},lp.prototype.cD=function(t){this.Fw=!!t},lp.prototype.setTileCanvasRendering=lp.prototype.cD,lp.prototype.Fw=!0,lp.prototype.Hy=function(t,e,r,i){var n=np(this),o=this.getTileKey(t,e,r),a=this.tileSize,s=this.Sb().get(o);return s||(delete(t=s=new ol(o,t,e,r,a,this.oa,r,n)).Ji,t.ul=i),this.Fw?(i=vo.pop(a),s.L(i)||vo.push(i,a)):ul(s),s},lp.prototype.ke=function(t,e){var r;if(4===this.resultType||8===this.resultType){for(r=(t=e.bb()).length;r--;)delete t[r].Fk[e.key];(t=e.Hn())&&(vo.push(t,this.tileSize),e.In())}else for(r=(t=e.data).length;r--;)delete t[r].ys},lp.prototype.disposeInternal=function(){lp.g.disposeInternal.call(this),np(this).l()};var op={MARKER:1,DOM_MARKER:2,POLYLINE:4,POLYGON:8};lp.ResultType=op;var mp=[1,2,4,8];function pp(t){var e=qp;if(!t||!gb(be(t.layerId,t.layer))||!jb(t.level)||ab(t.rowFilter)&&!Za(t.rowFilter)||ab(t.rowFilterContext)&&!ya(t.rowFilterContext))throw new C(e,1,ab("invalid layer config")?"invalid layer config":t)}function qp(t,e,r){var i=this,n=e&&e.rowFilter,o=r.resultType;qp.g.constructor.call(this,r),B(t,rp,qp,0),pp(e),n?(r=Qa(e)).rowFilter=n.toString():r=Qa(e),delete r.layer,r.layerId=be(e.layerId,e.layer),(new Li).registerProcessor("pde","H.service.extension.worker.processor"),t=t.i().clone().A(sp+"."+tp).u({meta:1}),new Ni("pde",{message:[this.uid,0,{tileSize:this.tileSize,projected:!0,onlyOutline:4===o,serverUrl:t.toString(),layerConfigs:[r],horizontalMargin:1}]}).then((function(){i.rq=!0,i.jb()}),this.Ic)}u(qp,lp),t("H.service.extension.platformData.TileProvider",qp),qp.prototype.qu=function(t,e,r){return(t=new ep(t,e,r)).Qy=up,t};var up=new M({strokeColor:"transparent",fillColor:"transparent",lineWidth:0,lineJoin:"round",lineCap:"round"});function vp(t){this.yy=t}function wp(t,e,r,i,n,o){Zo(wp,1,e,r),Zo(wp,2,i,n),(this.Tn=t.length)?(this.Ob=t,this.mn=e,this.dn=r,this.kk=0,this.vn=z(this.vn,this),this.Iy=i,this.Gy=n,this.Yh=Ua(),Sa(this.Yh,xp,o||{}),this.ks={},globalThis.setTimeout(this.vn,0)):e(je,!0)}qp.prototype.o=function(t,e,r,i,n){var o,a=this,s=this.getTileKey(t,e,r);s=this.Sb().get(s);var l={cancel:ie},u=!0,c=this.resultType;if(s&&(4===c||8===c?s.Ih()||(i(vo.pop(this.tileSize),null),u=!1):(i(x),u=!1)),u){var h=globalThis.setTimeout((function(){(o=new Ni("pde",{message:[a.uid,1,[t,e,r]]})).then(i,n)}),500);l.cancel=function(){o?o.cancel():globalThis.clearTimeout(h)}}return l},qp.prototype.requestInternal=qp.prototype.o,qp.prototype.disposeInternal=function(){qp.g.disposeInternal.call(this),new Ni("pde",{message:[this.uid,3]})},qp.ResultType=op,vp.prototype.cancel=function(){for(var t=this.yy,e=t.length;e--;)t[e].cancel();t.length=0},vp.prototype.cancel=vp.prototype.cancel;var xp={duration:100,rz:"geometry",qz:"WKT",WC:"searchAttributes",At:A};function rp(t){rp.g.constructor.call(this,rp,t),io(rp)}wp.prototype.vn=function(){for(var t,e=[],r=!1,i=Fk();this.kk<this.Tn;){var n=this.Ob[this.kk];if(r=n.attributes,t=n.layerId||this.Yh.At,n.distance&&(r[this.Yh.WC]={nearest:new xe(n.nearestLat,n.nearestLon),distance:n.distance}),n=n[this.Yh.rz]){try{var o=ki(new Di(n))}catch(t){this.dn(new globalThis.Error(t.message)),r=!0;break}r[this.Yh.qz]=o}if((n=this.ks[t])||(n=this.ks[t]=this.Iy({layerId:t,columnNames:Object.keys(r)})),r=this.Gy(n,r),e.push(r),this.kk++,(r=this.kk===this.Tn)||Fk()-i>=this.Yh.duration){this.mn(e,r);break}}r?this.ks={}:this.kl=globalThis.setTimeout(this.vn,0)},wp.prototype.cancel=function(){globalThis.clearTimeout(this.kl),this.kk<this.Tn&&this.dn(new globalThis.Error("parsing canceled"))},wp.prototype.cancel=wp.prototype.cancel,u(rp,yo),t("H.service.extension.platformData.Service",rp),rp.prototype.Da=function(){return{subDomain:"s.fleet.ls",path:"1"}},rp.CONFIG_KEY="platformData",rp.prototype.request=function(t,e,r,i,n){return this.I(t,e,r,i,n)},rp.prototype.request=rp.prototype.request,rp.prototype.I=function(t,e,r,i,n){var o="text/plain";if(!t)throw new C(this.request,0,t);if(!e)throw new C(this.request,1,e);if(!i)throw new C(this.request,3,i);if(!n)throw new C(this.request,4,n);return t=this.i().clone().A(t+"."+e).u(r),e===yp.JSON&&(o="application/json"),this.o(t,i,n,o)};var sp="tiles";rp.EntryPoint={DOC_ATTRIBUTES:"doc/attributes",DOC_LAYER:"doc/layer",DOC_LAYERS:"doc/layers",DOC_MAPS:"doc/maps",DOC_INDEXES:"doc/indexes",SEARCH_BBOX:"search/bbox",SEARCH_CORRIDOR:"search/corridor",SEARCH_PROXIMITY:"search/proximity",SEARCH_QUADKEY:"search/quadkey",SERVICE_CONFIGURATION:"serviceconfiguration",STATIC:"static",TILE:"tile",TILES:sp,FILE:"file",INDEX:"index"};var tp="json",yp={TXT:"txt",JSON:tp,HTML:"html",BIN:"bin"};function zp(t,e,r){if(!fb(t))throw new C(r,0,"has invalid type");if(!fb(e))throw new C(r,1,"has invalid type");if(t.length!==e.length||!t.length)throw new C(r,1,"specify one key attribute for each given layer id in the same order")}function Ap(t){Do.g.constructor.call(this,Ap,t),io(Ap)}function Bp(){if(Cp)throw new wb(Bp)}rp.EntryPointType=yp,rp.prototype.Pd=function(t,e){var r=e&&e.resultType;return t=new qp(this,t,e),1==r||2===r?new dj(t):new kl(t)},rp.prototype.createTileLayer=rp.prototype.Pd,rp.prototype.Cg=function(t,e,r,i){var n,o=[],a=e.layer_id||e.layer_ids;return t=this.request(t,tp,e,(function(t){n=new wp(t.geometries,r,i,(function(t){return new Yo([],t.columnNames,t)}),(function(t,e){var r=t.Ud;return t.Ob?t.Ob.push(e):t.Ob=[e],r.call(t,t.Ob.length-1)}),{At:a}),o.push(n)}),(function(t){i(new globalThis.Error(t))})),o.push(t),new vp(o)},rp.prototype.se=function(t,e,r,i,n,o){function a(t,e){e&&s--,i(t,!s)}var s,l=[];for(zp(t,e,this.se),Zo(this.se,3,i,n),B(r,I,this.se,2),r={bbox:r.fa+","+r.W+";"+r.ga+","+r.ca},o&&Sa(r,o),t=r.layer_id?[r.layer_id]:t,o=0,s=t.length;o<s;o++)r.layer_id=t[o],r.key_attribute=e[o],l.push(this.Cg("search/bbox",r,a,n));return new vp(l)},rp.prototype.searchByBoundingBox=rp.prototype.se,rp.prototype.Zc=function(t,e,r,i,n,o,a){if(zp(t,e,this.Zc),B(r,xe,this.Zc,2,"has invalid type"),!jb(i))throw new C(this.Zc,3,"has invalid type");return Zo(this.Zc,4,n,o),t={layer_ids:t.join(","),key_attributes:e.join(","),proximity:r.lat+","+r.lng+","+i},a&&Sa(t,a),this.Cg("search/proximity",t,n,o)},rp.prototype.searchByProximity=rp.prototype.Zc,rp.prototype.Yc=function(t,e,r,i,n,o,a){var s="";if(zp(t,e,this.Yc),!gb(r)&&!B(r,J))throw new C(this.Yc,1,"has invalid type");if(!jb(i))throw new C(this.Yc,2,"has invalid type");if(Zo(this.Yc,4,n,o),t={layer_ids:t.join(","),key_attributes:e.join(","),radius:i},gb(r))t.route_id=r;else{for(i=r.S,r=0,e=i.length;r<e;r+=3)s+=i[r]+","+i[r+1],r<e-3&&(s+=";");t.corridor=s}return a&&Sa(t,a),this.Cg("search/corridor",t,n,o)},rp.prototype.searchByCorridor=rp.prototype.Yc,X.prototype.qA=function(t){return this.Ja(rp,t)},X.prototype.getPlatformDataService=X.prototype.qA,u(Ap,yo),t("H.service.extension.customRoute.Service",Ap),Ap.prototype.Da=function(){return{subDomain:"s.fleet.ls",path:"2"}},Ap.CONFIG_KEY="customRoute",Ap.prototype.Jc=function(t){return Error(t.issues&&t.issues.length?t.issues.map((function(t){return t.message})).join(". "):t)},Ap.prototype.Xg=function(t,e,r){return Zo(this.Xg,1,e,r),t=this.i().clone().A("calculateroute.json").u(t),this.o(t,e,r)},Ap.prototype.calculateRoute=Ap.prototype.Xg,X.prototype.Hz=function(t){return this.Ja(Ap,t)},X.prototype.getCustomRoutingService=X.prototype.Hz,t("H.service.extension.customLocation.Permission",{READ:"read",WRITE:"write",EXPORT:"export"}),t("H.service.extension.customLocation.Storage",{READONLY:"readonly",UPDATABLE:"updatable"}),t("H.service.extension.customLocation.Table",Bp);var Cp=!0;function Ep(t,e){var r;Cp=!1;var i=new Bp;Cp=!0,i.Ym=Xa(globalThis.JSON.parse(globalThis.JSON.stringify(t))),t=t.columnNames;var n=Ua();for(r=t.length;r--;)n[t[r]]=r;if(i.So=n,i.Hc=t.length,e){if(e.length%t.length)throw new C(Ep,1,"Invalid number of cells")}else e=[];return i.tb=e,i}Bp.prototype.zh=function(){return this.Ym},Bp.prototype.getMeta=Bp.prototype.zh,Bp.prototype.Ch=function(){return this.tb.length/this.Hc},Bp.prototype.getRowCount=Bp.prototype.Ch,Bp.prototype.Ud=function(t){return t<this.tb.length/this.Hc?new Fp(this,t):A},Bp.prototype.getRow=Bp.prototype.Ud,Bp.prototype.BA=function(){var t,e=this.tb.length/this.Hc,r=new globalThis.Array(e);for(t=0;t<e;t++)r[t]=new Fp(this,t);return r},Bp.prototype.getRows=Bp.prototype.BA,Bp.prototype.zo=function(t){var e=this.Hc,r=this.tb,i=r.length/this.Hc;if(!t||t.length%e)throw new C(this.zo,0,"Invalid number of cells");return this.tb=r.concat(t),i},Bp.prototype.addCells=Bp.prototype.zo,Bp.prototype.ky=function(){for(var t=this.Hc,e=this.tb,r=this.tb.length/this.Hc;t--;)e.push(x);return this.Ud(r)},Bp.prototype.addRow=Bp.prototype.ky,Bp.prototype.ab=function(){return this.Ym.columnNames},Bp.prototype.getColumnNames=Bp.prototype.ab,Bp.prototype.Fj=function(t){return this.So[t]===A?A:new Gp(this,t)},Bp.prototype.getColumn=Bp.prototype.Fj,Bp.prototype.va=function(t,e){return this.tb[t*this.Hc+this.So[e]]},Bp.prototype.getCell=Bp.prototype.va,Bp.prototype.ue=function(t,e,r){if(e=this.So[e],t>=this.tb.length/this.Hc)throw new C(this.ue,0,"Row index out of bounds");if(e===A)throw new C(this.ue,0,"Column unknown");this.tb[t*this.Hc+e]=r},Bp.prototype.setCell=Bp.prototype.ue,Bp.prototype.concat=function(t){var e,r=arguments.length,i=""+this.ab(),n=this.tb?this.tb.slice():[];for(e=0;e<r;e++){var o=arguments[e];if(!(o instanceof Bp))throw new C(this.concat,e);if(""+o.ab()!==i)throw new C(this.concat,e,"Incompatible columns!");o.tb&&(n=n.concat(o.tb))}return Ep(this.Ym,n)},Bp.prototype.concat=Bp.prototype.concat;var Hp=/(\n|\t|\r|")/;function Ip(t,e,r,i,n,o,a,s){var l;for(l=0;l<a;l++){l&&e.push("\t");var u=r[i*n+o[l]];if(l!==s){if(u!==x){if(u=String(u),Hp.test(u))throw new C(t.os,0,'Invalid character (\\n, \\r, \\t, or ") in row '+i+" column "+t.Ym.columnNames[o[l]]);e.push(u)}}else e.push(u)}}function Gp(t,e){this.$b=t,this.Nl=e}function Fp(t,e){this.$b=t,this.Kk=e}function Jp(t){var e=Kp;if(!t||!gb(t.layerId)||ab(t.rowFilter)&&!Za(t.rowFilter)||ab(t.rowFilterContext)&&!ya(t.rowFilterContext))throw new C(e,1,ab("invalid layer config")?"invalid layer config":t)}function Lp(t){return gb(t)&&/^[A-Z][A-Z0-9_]*$/.test(t)}function Mp(t){for(var e=t&&t.length,r=2<=e&&"WKT"===t[--e]&&"GEOMETRY_ID"===t[--e];r&&e--;)r=Lp(t[e]);return r}function Np(t,e){var r="",i=[];if(e){var n=t.geometries;if(n&&n.length){var o=Object.keys(n[0].attributes);for(r=r+"Meta:\t"+e+"\n"+o.join("\t"),r+="\tWKT\n",t=0;t<n.length;t++){var a=n[t].attributes,s=n[t].geometry;for(e=0;e<o.length;e++)i.push(a[o[e]]);r+=i.join("\t"),r+="\t"+s+"\n",i=[]}}}else{if(s={},i=[],t.geometries)for(n=0;n<t.geometries.length;n++)s[(e=t.geometries[n]).layerId]||(s[e.layerId]=[]),s[e.layerId].push(e);for(o in s)i.push({layerId:o,geometries:s[o]});for(t=0;t<i.length;t++)r+=Np(i[t],i[t].layerId)}return r}function Kp(t,e,r){var i,n=this,o=e&&e.rowFilter;Kp.g.constructor.call(this,r),B(t,Op,Kp,0);var a=r.resultType;if(Jp(e),o){var s=Qa(e);s.rowFilter=o.toString()}else s=e;(new Li).registerProcessor("cle","H.service.extension.worker.processor");var l=e.layerId;t.request(Pp,Qp,{detail_level:"all",layer_id:l},(function(e){var r;for(e=e.layers,r=0;r<e.length;r++)if(e[r].layerId===l){s.level=e[r].level;break}i=t.i().clone().A(Rp+"."+Qp).u({meta:1}),new Ni("cle",{message:[n.uid,0,{tileSize:n.tileSize,projected:!0,onlyOutline:4===a,serverUrl:i.toString(),layerConfigs:[s],batchTiles:!1,horizontalMargin:1}]}).then((function(){n.rq=!0,n.jb()}),n.Ic)}),(function(t){n.Ic(t.message)}))}function Sp(t){if(t===A)t="\t";else if(!/^[^"\r\n]$/.test(t))throw new C(Sp,0);this.Zx=String(t).charCodeAt(0),this.xd=z(this.xd,this),this.s=Tp}Bp.prototype.os=function(t,e){var r,i=this.Hc,n=this.ab(),o=[],a=[],s=this.tb,l=-1;for(r=0;r<i;r++)t&&!t.test(n[r])||("WKT"===n[r]&&(l=o.length),o.push(r));if(!(t=o.length))throw new C(this.os,1,"No columns filtered");if(Ip(this,a,n,0,i,o,t,l),e){var u=e.length;for(r=0;r<u;r++)a.push("\n"),Ip(this,a,s,n=e[r],i,o,t,l)}else for(u=this.Ch(),n=0;n<u;n++)a.push("\n"),Ip(this,a,s,n,i,o,t,l);return a.join("")},Bp.Column=Gp,Gp.prototype.va=function(t){return this.$b.va(t,this.Nl)},Gp.prototype.getCell=Gp.prototype.va,Gp.prototype.ue=function(t,e){this.$b.ue(t,this.Nl,e)},Gp.prototype.setCell=Gp.prototype.ue,Bp.Row=Fp,Fp.prototype.ab=function(){return this.$b.ab()},Fp.prototype.getColumnNames=Fp.prototype.ab,Fp.prototype.va=function(t){return this.$b.va(this.Kk,t)},Fp.prototype.getCell=Fp.prototype.va,Fp.prototype.ue=function(t,e){this.$b.ue(this.Kk,t,e)},Fp.prototype.setCell=Fp.prototype.ue,Fp.prototype.Rf=function(){return this.$b},Fp.prototype.getTable=Fp.prototype.Rf,u(Kp,lp),t("H.service.extension.customLocation.TileProvider",Kp),Kp.prototype.qu=function(t,e,r){return new ep(t,e,r)},Kp.prototype.o=function(t,e,r,i,n){var o,a=this,s=this.getTileKey(t,e,r);s=this.Sb().get(s);var l={cancel:ie},u=!0,c=this.resultType;if(s&&(4===c||8===c?s.Ih()||(i(vo.pop(this.tileSize),null),u=!1):(i(x),u=!1)),u){var h=globalThis.setTimeout((function(){(o=new Ni("cle",{message:[a.uid,1,[t,e,r]]})).then(i,n)}),500);l.cancel=function(){o?o.cancel():globalThis.clearTimeout(h)}}return l},Kp.prototype.requestInternal=Kp.prototype.o,Kp.prototype.disposeInternal=function(){Kp.g.disposeInternal.call(this),new Ni("cle",{message:[this.uid,3]})};var Tp=0;function Up(t,e,r){var i=t.s;if(i!==e)throw 1===i&&(t.s=Tp),new wb(r,"Requires state: "+["READY","PARSE","PAUSE"][e]+" but found "+["READY","PARSE","PAUSE"][i])}function Vp(t,e){var r=[];return t.parse(e,(function(t,e,i){return 1>t&&(r[e]=i),0<t})),t.s=Tp,r}function Wp(t,e,r){this.ed=new Di(t),this.Is=e,this.cq=!0,this.Ol=this.Gr=this.fj=0,Xp(this),this.xd=r,this.Ec=[],this.Yf=!1}function Xp(t){var e=t.ed.eb();t.Yt=!1,(t.gB=34===e)&&t.ed.next()}function Yp(t,e){var r=t.ed;switch(t.Yt=!0,e){case t.Is:t.fj++;break;case 13:r.next(),10!==r.eb()&&t.xd("CR without LF");case 10:t.fj=0,t.Gr++;break;case-1:t.cq=!1;break;default:t.xd("End of field expected")}return r.next(),-1}function Zp(t,e,r,i){if(i=i||{},!e)throw new C(Zp,1,"has to be a function");if(!r)throw new C(Zp,2,"has to be a function");for(this.mn=e,this.dn=r,this.bh=[],this.pc={},this.xq=[],this.lh={},this.fs={},this.ls={},this.mx={},this.rj=i.duration||100,this.Gm=z(this.Gm,this),t=t.split("Meta:\t").slice(1),e=0;e<t.length;e++){r=(i=t[e].split("\n"))[0].split("\t")[0],i=i.slice(1).join("\n"),this.lh[r]=new Sp,this.pc[r]=Vp(this.lh[r],i);var n={layerId:r,columnNames:this.pc[r]};this.xq.push(r),this.mx[r]=Ep(n),this.fs[r]=Fk(),$p(this,i,r),this.Gm(r)}}function $p(t,e,r){var i=[],n=t.pc[r].length-1,o=t.mx[r];try{t.lh[r].parse(e,(function(e,a,s){var l=!1;return 0<e&&(i[a]=s,a===n&&(t.bh.push(o.Ud(o.zo(i))),Fk()-t.fs[r]>t.rj&&(l=!0))),l}),(function(t,e,r){if(0<t&&e===n)return ki(r)}))}catch(e){t.dn(e)}}function Op(t){Op.g.constructor.call(this,Op,t),io(Op)}function aq(t,e,r,i){var n=e[t=t===bq?"changes":"file"],o=gb(n),a=!o&&B(n,Blob);if(!o&&!a)throw new C(i,0,"Invalid "+t+" parameter");if(cq)n=a?n:qe(n,"text/plain"),(i=new globalThis.FormData).append(t,n,n.name||t+".wkt"),r.method="POST",r.data=i,delete e[t];else if(a)throw new C(i,0,"Sending Blob data is not supported by the browser")}m=Sp.prototype,m.getState=function(){return this.s},m.abort=function(){Up(this,2,Sp.prototype.abort),this.s=Tp},m.xd=function(t){throw this.s=Tp,new C(Sp.prototype.parse,0,"Malformed DSV at row "+this.ed.Gr+" column "+this.ed.fj+": "+t)},m.parse=function(t,e,r){Up(this,Tp,Sp.prototype.parse),t=t.trim(),this.ed=new Wp(t,this.Zx,this.xd),this.YB=e,this.Iv=r||he,this.s=2,this.resume()},m.Iv=he,m.resume=function(){var t=this.ed,e=[];Up(this,2,Sp.prototype.resume),this.s=1;do{if(!t.cq){this.s=Tp;break}if(n>t.fj){if(void 0!==r&&r!==n)return void this.ed.xd("The number of columns must be the same for all rows");var r=n}var i=t.Gr,n=t.fj,o=t.Ol,a=this.Iv(i,n,t);if(t.Ol>o)for(;-1!==t.next(););else{for(;-1!==(o=t.next());)e.push(o);a=String.fromCharCode.apply(x,e),e.length=0}Xp(t),this.YB(i,n,a)&&(this.s=t.cq?2:Tp)}while(1===this.s);2!=this.s&&void 0!==r&&0<n&&r!==n&&this.ed.xd("The number of columns must be the same for all rows")},m=Wp.prototype,m.Ol=0,m.eb=function(){if(this.Yt)var t=-1;else{var e=this.ed;if(t=e.eb(),this.gB)switch(t){case 34:e.next(),34!==(t=e.eb())&&(t=Yp(this,t));break;case-1:this.xd("Closing quotation mark expected")}else switch(t){case 34:this.xd("Unexpected quotation mark");case this.Is:case 13:case 10:case-1:t=Yp(this,t)}}return t},m.yi=function(){this.Yf=!0,this.Ec=[]},m.mh=function(){var t=this.Ec.slice();return this.Yf=!1,this.Ec=[],t},m.next=function(){var t=this.eb();return-1!==t&&this.ed.next(),this.Yf&&this.Ec.push(t),this.Ol++,t},Zp.prototype.cancel=function(){for(var t in this.ls)globalThis.clearTimeout(this.ls[t])},Zp.prototype.cancel=Zp.prototype.cancel,Zp.prototype.Gm=function(t){var e,r,i=this;this.ls[t]=globalThis.setTimeout((function(){if(2===i.lh[t].getState())i.fs[t]=Fk(),i.mn(i.bh,!1),i.bh=[],i.lh[t].resume(),i.Gm(t);else{for(e=!0,r=0;r<i.xq.length;r++)if(i.lh[i.xq[r]].getState()!==Tp){e=!1;break}e&&(0<i.bh.length&&i.mn(i.bh,!0),i.bh=[])}}),0)},u(Op,yo),t("H.service.extension.customLocation.Service",Op),Op.prototype.Da=function(){return{subDomain:"fleet.ls",path:"2"}},Op.CONFIG_KEY="customLocation",Op.prototype.Pd=function(t,e){var r=e&&e.resultType;return t=new Kp(this,t,e),1===r||2===r?new dj(t):new kl(t)},Op.prototype.createTileLayer=Op.prototype.Pd;var cq=globalThis.FormData&&!!globalThis.FormData.prototype.append;Op.prototype.request=function(t,e,r,i,n){return this.I(t,e,r,i,n)},Op.prototype.request=Op.prototype.request,Op.prototype.I=function(t,e,r,i,n){var o="text/plain",a=t===dq.LAYERS_UPLOAD||t===dq.LAYERS_MODIFY||t===dq.LAYERS_IMPORT,s=r,l={data:A,method:"GET",headers:this.pc};if(!t)throw new C(this.request,0,t);if(!e)throw new C(this.request,1,e);Zo(this.request,3,i,n),a&&(B(r,Object,this.request,2,"Invalid request parameters"),aq(t,s=Qa(r),l,this.request));var u=this.i().clone().A(t+"."+e).u(s);return e===eq.JSON&&(o="application/json"),(t=new nh(o,u.toString(),vc,l)).then((function(t){var e=t.issues;e&&t.error_id&&t.response_code?n(Error(e[0].message)):i(t)}),(function(t){"error"===t.type||404===t.status?n(Error(t.statusText||"Unable to load data")):t.json().then((function(t){n(Error("["+t.issues[0].message+"] "+u+" request failed"))}),(function(){n(Error("["+t.statusText+"] "+u+" request failed"))}))})),t};var Pp="layers/list",bq="layers/modify",Rp="tiled/tile",dq={LAYERS_DELETE:"layers/delete",LAYERS_GRANT:"layers/access/grant",LAYERS_LIST:Pp,LAYERS_MODIFY:bq,LAYERS_UPLOAD:"layers/upload",LAYERS_IMPORT:"layers/import",SEARCH_ALL:"search/all",SEARCH_BBOX:"search/bbox",SEARCH_CORRIDOR:"search/corridor",SEARCH_PROXIMITY:"search/proximity",SEARCH_QUADKEY:"search/quadkey",SEARCH_TILE:Rp};Op.EntryPoint=dq;var Qp="json",eq={TXT:"txt",JSON:Qp};Op.EntryPointType=eq,Op.prototype.Tb=function(t,e,r){var i=this;return this.request("search/all","txt",{filter:'WKT==""',layer_id:t},(function(n){var o=String(n).replace(/[\r\n]+$/g,"").split("\t");i.request(Pp,Qp,{layer_id:t,detail_level:"all"},(function(t){(t=t.layers[0]).columnNames=o,e(Ep(t))}),r)}),r)},Op.prototype.getLayer=Op.prototype.Tb,Op.prototype.Au=function(t,e,r,i){var n=e&&e.length,o=-1,a=this;return function s(){return++o<n?a.request("layers/access/grant",Qp,{layer_id:t,granted_app_id:e[o].grantedAppId,permissions:e[o].permissions.join(",")},s,i):a.Tb(t,r,i)}()},Op.prototype.grantAccess=Op.prototype.Au,Op.prototype.Dt=function(t,e,r){return this.request("layers/delete",Qp,{layer_ids:t},e,r)},Op.prototype.deleteLayer=Op.prototype.Dt,Op.prototype.od=function(t,e,r){function i(){setTimeout((function(){l.Tb(a,(function(t){setTimeout(n.bind(null,t),c)}),(function(){64e3>u?(u+=c,i()):r(globalThis.Error("Timeout"))}))}),c),c*=2}function n(i){var n=JSON.stringify(i.ab()),o=t.grants;if(n!==JSON.stringify(s)){var u="Results into different column names on the backend: "+n;setTimeout((function(){l.Dt(a,(function(){r(globalThis.Error(u))}),(function(t){r(globalThis.Error(u+". "+t.message))}))}),c)}else o&&o.length?l.Au(a,o,e,r):e(i)}var o,a,s,l=this,u=0,c=1e3,h=!t||!Lp(a=t.layerId)&&(o="layerId")||!Mp(s=t.columnNames)&&(o="columnNames")?0:Za(e)?Za(r)?-1:2:1;if(0<=h)throw new C(l.od,h,o||arguments[h]);return l.Tb(a,(function(){r(globalThis.Error("Layer exists already"))}),(function(){var e={layer_id:a,file:s.join("\t")},n=t.level,o=t.storage;n!==A&&(e.level=n),o!==A&&(e.storage=o),l.request("layers/upload",Qp,e,i,r)}))},Op.prototype.createLayer=Op.prototype.od,Op.prototype.Cg=function(t,e,r,i){var n,o=[];return t=this.request(t,Qp,e,(function(t){t.geometries.length?(t=Np(t,e.layer_id),n=new Zp(t,r,i),o.push(n)):r(je,!0)}),i),o.push(t),new vp(o)},Op.prototype.Zc=function(t,e,r,i,n,o){if(!fb(t))throw new C(this.Zc,0,"has invalid type");if(B(e,xe,this.Zc,1,"has invalid type"),!jb(r))throw new C(this.Zc,2,"has invalid type");return Zo(this.Zc,3,i,n),t={layer_ids:t.join(","),proximity:e.lat+","+e.lng+","+r},o&&Sa(t,o),this.Cg("search/proximity",t,i,n)},Op.prototype.searchByProximity=Op.prototype.Zc,Op.prototype.Yc=function(t,e,r,i,n,o){var a="";if(!fb(t))throw new C(this.Yc,0,"has invalid type");if(!gb(e)&&!B(e,J))throw new C(this.Yc,1,"has invalid type");if(!jb(r))throw new C(this.Yc,2,"has invalid type");if(Zo(this.Yc,3,i,n),t={layer_ids:t.join(","),radius:r},gb(e))t.route_id=e;else{var s=e.S;for(e=0,r=s.length;e<r;e+=3)a+=s[e]+","+s[e+1],e<r-3&&(a+=",");t.corridor=a}return o&&Sa(t,o),this.Cg("search/corridor",t,i,n)},Op.prototype.searchByCorridor=Op.prototype.Yc,Op.prototype.se=function(t,e,r,i,n){function o(t,e){e&&a--,r(t,!a)}var a,s=[];if(!fb(t))throw new C(this.se,0,"has invalid type");for(B(e,I,this.se,1,"has invalid type"),Zo(this.se,2,r,i),e={bbox:e.fa+","+e.W+";"+e.ga+","+e.ca},n&&Sa(e,n),t=e.layer_id?[e.layer_id]:t,n=0,a=t.length;n<a;n++)e.layer_id=t[n],s.push(this.Cg("search/bbox",e,o,i));return new vp(s)},Op.prototype.searchByBoundingBox=Op.prototype.se,Op.prototype.Lr=function(t,e,r,i){var n,o=[];if(!gb(t))throw new C(this.Lr,0,"has invalid type");Zo(this.Lr,1,e,r);var a={layer_id:t};return i&&Sa(a,i),i=this.request("search/all",Qp,a,(function(i){i.geometries.length?(i=Np(i,t),n=new Zp(i,e,r),o.push(n)):e(je,!0)}),r),o.push(i),new vp(o)},Op.prototype.searchAll=Op.prototype.Lr;var fq={delete:/^GEOMETRY_ID$/,append:/^(?!GEOMETRY_ID$)/};function gq(t,e,r,i,n,o){function a(){d++,i(this,d===p)}function s(t){d++,n(t,this,d===p)}var l,u="append"!==e,c={},h=Ua(),p=0,f=[],d=0;if(!fb(r))throw new C(o,0,r);for(Zo(o,1,i,n),l=r.length;l--;){var y=r[l];if(B(y,Fp)){var g=y.Rf().zh().layerId,v=y.va("GEOMETRY_ID");if(u){if(v===x||""===String(v))var m='GEOMETRY_ID must not be null or ""';c[v=g+"_"+v]&&(m="same GEOMETRY_ID for multiple rows"),c[v]=y}else v!==x&&""!==String(v)&&(m='GEOMETRY_ID must be null or ""')}else m="Invalid type";if(m)throw new C(o,0,"- Invalid row at index "+l+", "+m);(v=h[g])||(v=h[g]=[],p++),v.push(y)}for(g in h){for(r=[],l=(v=h[g]).length;l--;)r.push(v[l].Kk);f.push(t.request(bq,Qp,{layer_id:g,action:e,changes:v[0].Rf().os(fq[e]||null,r)},z(a,v),z(s,v)))}return new vp(f)}function hq(t){hq.g.constructor.call(this,hq,t),this.Jw=zo(this,t).reverseSubDomain,io(hq,"Use HERE Geocoding and Search API v7 instead.")}function iq(t){iq.g.constructor.call(this,iq,t)}function jq(t){jq.g.constructor.call(this,jq,t)}function kq(t,e){if(!(e instanceof Blob))throw new C(t,1,"must be an instance of Blob");return(t=new FormData).append("file",e),t}function lq(t){lq.g.constructor.call(this,lq,t)}function mq(t){mq.g.constructor.call(this,mq,t),io(mq,"Use HERE Routing API v8 instead.")}function nq(t){nq.g.constructor.call(this,nq,t)}function oq(t){oq.g.constructor.call(this,oq,t),this.uu=t.getToken}function wq(t,e,r,i){return t.i().clone().A(e+"/layers/"+r+"/features").u(i||{})}function uq(t,e,r,i,n){return wq(t,r,i,e=Object.assign({},n,{id:new qo(e)}))}function sq(t,e,r,i,n){return t.i().clone().A(r+"/layers/"+i+"/features/"+e).u(n||{})}function pq(t,e,r,i){db(r,"String",t,e,"must be a string"),db(i,"String",t,e+1,"must be a string")}function rq(t,e){db(e,"String",t,0,"must be a string")}function tq(t,e){if(!Array.isArray(e)||0===e.length||e.some((function(t){return"string"!=typeof t})))throw new C(t,0,"must be a non-empty array of strings")}function vq(t,e,r){if(!ya(r))throw new C(t,e,"must be a GeoJSON object")}function qq(t,e,r,i){if(!Za(r))throw new C(t,e,"must be a function");if(!Za(i))throw new C(t,e+1,"must be a function")}function xq(t,e,r,i){if(xq.g.constructor.call(this,i?{min:i.min,max:i.max,engineType:i.engineType}:void 0),B(t,oq,xq,0),!gb(e))throw new C(xq,1,'"catalogHrn" must be a string');if(!gb(r))throw new C(xq,2,'"layerId" must be a string');this.$=t,this.$g=e,this.Mh=r,this.Ok=ya(i)&&ya(i.parameters)?i.parameters:{},this.Xa(this.Ep())}function yq(t,e,r){var i,n=this,o=r||{},a=+o.min,s=+o.max;o.tileSize=o.tileSize||512,o.min=a?Nd(a,1,17):1,o.min+=ij(o.tileSize,1),o.max=s?Nd(s,1,17):17,yq.g.constructor.call(this,o),B(t,zq,yq,0),B(e,$g,yq,1),this.$=t,e.Yb&&e.Yb("OMV"),this.Xa(e,!0),this.xn=!1,r&&(r.politicalView&&(this.yn=r.politicalView),Aq(this,r.lg,r.lg2),this.xn=!!r.pois),this.yw=function(){n.Hl=go(n),n.reload(!1)},t.addEventListener("versionupdate",this.yw),this.Hl=go(this),yq.prototype.Xo=(i=/^v2\/vectortiles\/(.+)\/mc$/.exec(t.i().jf))?i[1]:A+""}function Aq(t,e,r){var i=gb(e),n=gb(r);i&&(t.nw=e),n&&(t.Wt=r),(i||n)&&(t.Zj=[],(n=(i=/^([a-zA-Z]{2})(-|$)/).exec(e))&&("zh"===n[1]?t.Zj.push(e):t.Zj.push(n[1])),(n=i.exec(r))&&("zh"===n[1]?t.Zj.push(r):t.Zj.push(n[1])),t.pq=!0)}Op.prototype.dt=function(t,e,r){return gq(this,"append",t,e,r,this.dt)},Op.prototype.appendRows=Op.prototype.dt,Op.prototype.Gx=function(t,e,r){return gq(this,"update",t,e,r,this.Gx)},Op.prototype.updateRows=Op.prototype.Gx,Op.prototype.Et=function(t,e,r){return gq(this,"delete",t,e,r,this.Et)},Op.prototype.deleteRows=Op.prototype.Et,X.prototype.Gz=function(t){return this.Ja(Op,t)},X.prototype.getCustomLocationService=X.prototype.Gz,u(hq,yo),t("H.service.GeocodingService",hq),hq.prototype.Da=function(){return{subDomain:"geocoder.ls",reverseSubDomain:"reverse",path:"6.2"}},hq.CONFIG_KEY="geocoding",hq.prototype.Jc=function(t){return Error(t.Details||t.message||t.error)},hq.prototype.xp=function(t,e,r){return t=this.i().clone().A("geocode.json").u(t),this.o(t,e,r)},hq.prototype.geocode=hq.prototype.xp,hq.prototype.Fr=function(t,e,r){return t=this.i().clone().A("reversegeocode.json").u(t),this.Jw&&t.la(this.Jw),this.o(t,e,r)},hq.prototype.reverseGeocode=hq.prototype.Fr,hq.prototype.search=function(t,e,r){return t=this.i().clone().A("search.json").u(t),this.o(t,e,r)},hq.prototype.search=hq.prototype.search,X.prototype.Sz=function(t){return this.Ja(hq,t)},X.prototype.getGeocodingService=X.prototype.Sz,u(iq,yo),t("H.service.WaypointsSequenceService",iq),iq.CONFIG_KEY="waypointsSequence",iq.prototype.gz=function(t,e,r){return t=this.i().clone().la("wps").wc("v8/findsequence2").u(t),this.o(t,e,r)},iq.prototype.findSequence=iq.prototype.gz,X.prototype.QA=function(t){return this.Ja(iq,t)},X.prototype.getWaypointsSequenceService=X.prototype.QA,u(jq,yo),t("H.service.GeofencingService",jq),jq.CONFIG_KEY="geofencing",jq.prototype.Jc=function(t){return Error(t.issues&&t.issues[0]?t.issues[0].message:t.message,{cause:t})},jq.prototype.pz=function(t,e,r){return t=this.i().clone().la("geofencing").wc("v8/geofence").u(t),this.I(t,"GET",e,r)},jq.prototype.geofence=jq.prototype.pz,jq.prototype.delete=function(t,e,r){return t=this.i().clone().la("geofencing").wc("v8/geofence/delete").u(t),this.I(t,"GET",e,r)},jq.prototype.delete=jq.prototype.delete,jq.prototype.upload=function(t,e,r,i){return t=this.i().clone().la("geofencing").wc("v8/geofence/upload").u(t),e=kq(jq.prototype.upload,e),this.I(t,"POST",r,i,e)},jq.prototype.upload=jq.prototype.upload,jq.prototype.modify=function(t,e,r,i){return t=this.i().clone().la("geofencing").wc("v8/geofence/modify").u(t),e=kq(jq.prototype.modify,e),this.I(t,"POST",r,i,e)},jq.prototype.modify=jq.prototype.modify,jq.prototype.I=function(t,e,r,i,n,o){return o=void 0===o?"application/json":o,e={method:e,headers:Object.assign({},this.pc),data:n||void 0},(o=new nh(o,t.toString(),vc,e)).then(r,Ao(this,t,i)),o},X.prototype.ku=function(t,e){if(void 0===(e=e?+e:void 0))e=So;else{if(8!==e)throw new C(this.ku,1,"allowed values are 8 or undefined");e=jq}return this.Ja(e,t)},X.prototype.getGeofencingService=X.prototype.ku,u(lq,yo),t("H.service.SearchService",lq),lq.CONFIG_KEY="search",lq.prototype.Da=function(){return{subDomain:"search",path:"v1"}},lq.prototype.Jc=function(t){return t=[t.title,t.action,t.cause].filter((function(t){return t})),Error(t.join(". "))},lq.prototype.xp=function(t,e,r){return t=this.i().clone().la("geocode").A("geocode").u(t),this.o(t,e,r)},lq.prototype.geocode=lq.prototype.xp,lq.prototype.Fr=function(t,e,r){return t=this.i().clone().la("revgeocode").A("revgeocode").u(t),this.o(t,e,r)},lq.prototype.reverseGeocode=lq.prototype.Fr,lq.prototype.py=function(t,e,r){return t=this.i().clone().la("autosuggest").A("autosuggest").u(t),this.o(t,e,r)},lq.prototype.autosuggest=lq.prototype.py,lq.prototype.autocomplete=function(t,e,r){return t=this.i().clone().la("autocomplete").A("autocomplete").u(t),this.o(t,e,r)},lq.prototype.autocomplete=lq.prototype.autocomplete,lq.prototype.Sy=function(t,e,r){return t=this.i().clone().la("discover").A("discover").u(t),this.o(t,e,r)},lq.prototype.discover=lq.prototype.Sy,lq.prototype.yB=function(t,e,r){return t=this.i().clone().la("lookup").A("lookup").u(t),this.o(t,e,r)},lq.prototype.lookup=lq.prototype.yB,lq.prototype.ty=function(t,e,r){return t=this.i().clone().la("browse").A("browse").u(t),this.o(t,e,r)},lq.prototype.browse=lq.prototype.ty,X.prototype.DA=function(t){return this.Ja(lq,t)},X.prototype.getSearchService=X.prototype.DA,u(mq,yo),t("H.service.RoutingService",mq),mq.prototype.Da=function(){return{subDomain:"route.ls",path:"routing/7.2"}},mq.prototype.Jc=function(t){return Error(t.details)},mq.CONFIG_KEY="routing",mq.prototype.Xg=function(t,e,r){return t=this.i().clone().A("calculateroute.json").u(t),this.o(t,e,r)},mq.prototype.calculateRoute=mq.prototype.Xg,mq.prototype.Mo=function(t,e,r){return t=this.i().clone().la("isoline").A("calculateisoline.json").u(t),this.o(t,e,r)},mq.prototype.calculateIsoline=mq.prototype.Mo,u(nq,yo),t("H.service.RoutingService8",nq),nq.CONFIG_KEY="routing_v8",nq.prototype.Da=function(){return{subDomain:"router",path:"v8/routes"}},nq.prototype.Jc=function(t){return Error(401===(t&&void 0===t.status?401:t.status)?t.error_description:t.title,{cause:t})},nq.prototype.Xg=function(t,e,r){return t=this.i().clone().u(t),this.o(t,e,r)},nq.prototype.calculateRoute=nq.prototype.Xg,nq.prototype.Mo=function(t,e,r){return t=this.i().clone().la("isoline").wc("v8/isolines").u(t),this.o(t,e,r)},nq.prototype.calculateIsoline=nq.prototype.Mo,X.prototype.su=function(t,e){if(7===(e=+e||7))e=mq;else{if(8!==e)throw new C(this.su,1,"allowed values are 7 and 8");e=nq}return this.Ja(e,t)},X.prototype.getRoutingService=X.prototype.su,u(oq,yo),t("H.service.iml.Service",oq),oq.prototype.Da=function(){return{host:"interactive.data.api.platform.here.com",path:"interactive/v1/catalogs"}},oq.prototype.Jc=function(t){var e=[{keys:["code","title","cause","action"],format:function(){return t.code+": "+t.title+"; cause: "+t.cause+"; action: "+t.action}},{keys:["error","error_description"],format:function(){return t.error+": "+t.error_description}},{keys:["error","errorMessage"],format:function(){return t.error+": "+t.errorMessage}}];return Error(ya(t)?function(){for(var r=fa(e),i=r.next();!i.done;i=r.next()){var n=(i=i.value).format;if(i.keys.every((function(e){return t[e]})))return n()}return JSON.stringify(t)}():t)},oq.prototype.Dh=function(t,e,r,i,n){var o=this.Dh;return pq(o,0,t,e),qq(o,2,r,i),t=this.i().clone().A(t+"/layers/"+e+"/statistics").u(n||{}),this.I(t,"GET",r,i)},oq.prototype.getStatistics=oq.prototype.Dh,oq.prototype.lm=function(t,e,r,i,n,o,a,s,l){var u=l?"":".mvtf";return t=this.i().clone().A(i+"/layers/"+n+"/tile/web/"+r+"_"+t+"_"+e+u).u(Object.assign({clip:!0},s)),this.I(t,"GET",l?o:function(t){return t.arrayBuffer().then(o)},a,void 0,l?"application/json":"arraybuffer")},oq.prototype.getFeaturesByTile=oq.prototype.lm,oq.prototype.hu=function(t,e,r,i,n,o){var a=this.hu;return rq(a,t),pq(a,1,e,r),qq(a,3,i,n),t=sq(this,t,e,r,o),this.I(t,"GET",i,n)},oq.prototype.getFeatureById=oq.prototype.hu,oq.prototype.Ue=function(t,e,r,i,n,o){var a=this.Ue;return tq(a,t),pq(a,1,e,r),qq(a,3,i,n),t=uq(this,t,e,r,o),this.I(t,"GET",i,n)},oq.prototype.getFeaturesById=oq.prototype.Ue,oq.prototype.wh=function(t,e,r,i,n){var o=this.wh;if(!ya(t)||!(t.bbox||t.north&&t.east&&t.south&&t.west))throw new C(o,0,'must be an object with either "bbox" or a full set of "north", "east", "south" and "west"');return pq(o,1,e,r),qq(o,3,i,n),t=this.i().clone().A(e+"/layers/"+r+"/bbox").u(t),this.I(t,"GET",i,n)},oq.prototype.getFeaturesByBoundingBox=oq.prototype.wh,oq.prototype.ju=function(t,e,r,i,n){var o=this.ju;if(!(ya(t)&&t.radius&&(t.lat&&(t.lng||t.lon)||t.refCatalogHrn&&t.refLayerId&&t.refFeatureId)))throw new C(o,0,'must be an object with "radius" and a combination of either "lat"+"lng" or "refCatalogHrn"+"refLayerId"+"refFeatureId"');return pq(o,1,e,r),qq(o,3,i,n),t=this.i().clone().A(e+"/layers/"+r+"/spatial").u(t),this.I(t,"GET",i,n)},oq.prototype.getFeaturesByPointAndRadius=oq.prototype.ju,oq.prototype.iu=function(t,e,r,i,n,o){var a=this.iu;if(!ya(t)||!t.radius)throw new C(a,0,'must be an object with "radius"');return vq(a,1,e),pq(a,2,r,i),qq(a,4,n,o),t=this.i().clone().A(r+"/layers/"+i+"/spatial").u(t),this.I(t,"POST",n,o,e)},oq.prototype.getFeaturesByGeometryAndRadius=oq.prototype.iu,oq.prototype.Mw=function(t,e,r,i,n){var o=this.Mw;return pq(o,0,t,e),qq(o,2,r,i),t=this.i().clone().A(t+"/layers/"+e+"/search").u(n||{}),this.I(t,"GET",r,i)},oq.prototype.searchFeatures=oq.prototype.Mw,oq.prototype.$u=function(t,e,r,i,n){var o=this.$u;return pq(o,0,t,e),qq(o,2,r,i),t=this.i().clone().A(t+"/layers/"+e+"/iterate").u(n||{}),this.I(t,"GET",r,i)},oq.prototype.iterateFeatures=oq.prototype.$u,oq.prototype.nf=function(t,e,r,i,n,o){var a=this.nf;return vq(a,0,t),pq(a,1,e,r),qq(a,3,i,n),e=wq(this,e,r,o),this.I(e,"PUT",i,n,t)},oq.prototype.putFeatures=oq.prototype.nf,oq.prototype.lf=function(t,e,r,i,n,o){var a=this.lf;return vq(a,0,t),pq(a,1,e,r),qq(a,3,i,n),e=wq(this,e,r,o),this.I(e,"POST",i,n,t)},oq.prototype.postFeatures=oq.prototype.lf,oq.prototype.If=function(t,e,r,i,n){var o=this.If;return tq(o,t),pq(o,1,e,r),qq(o,3,i,n),t=uq(this,t,e,r),this.I(t,"DELETE",i,n)},oq.prototype.deleteFeatures=oq.prototype.If,oq.prototype.ww=function(t,e,r,i,n,o,a){var s=this.ww;return rq(s,t),vq(s,1,e),pq(s,2,r,i),qq(s,4,n,o),t=sq(this,t,r,i,a),this.I(t,"PUT",n,o,e)},oq.prototype.putFeature=oq.prototype.ww,oq.prototype.cw=function(t,e,r,i,n,o,a){var s=this.cw;return rq(s,t),vq(s,1,e),pq(s,2,r,i),qq(s,4,n,o),t=sq(this,t,r,i,a),this.I(t,"PATCH",n,o,e)},oq.prototype.patchFeature=oq.prototype.cw,oq.prototype.Ct=function(t,e,r,i,n){var o=this.Ct;return rq(o,t),pq(o,1,e,r),qq(o,3,i,n),t=sq(this,t,e,r),this.I(t,"DELETE",i,n,void 0,"text/plain")},oq.prototype.deleteFeature=oq.prototype.Ct,oq.prototype.I=function(t,e,r,i,n,o){return o=void 0===o?"application/json":o,e={method:e,headers:Object.assign({},n?{"Content-Type":"application/geo+json"}:void 0,"function"==typeof this.uu?{Authorization:"Bearer "+this.uu()}:void 0,this.pc)},n&&(e.data=JSON.stringify(n)),(n=new nh(o,t.toString(),vc,e)).then(r,Ao(this,t,i)),n},oq.CONFIG_KEY="iml",X.prototype.Wz=function(t){return this.Ja(oq,t)},X.prototype.getIMLService=X.prototype.Wz,u(xq,R),t("H.service.iml.Provider",xq),xq.prototype.o=function(t,e,r,i,n){return this.$.lm(t,e,r,this.$g,this.Mh,i,n,this.Ok)},xq.prototype.requestInternal=xq.prototype.o,xq.prototype.Xc=ge,xq.prototype.providesOMV=xq.prototype.Xc,xq.prototype.K=function(){return this.mb()},xq.prototype.getStyle=xq.prototype.K,xq.prototype.Cb=function(t){B(t,th)&&t.Yb("MVT"),this.Xa(t)},xq.prototype.setStyle=xq.prototype.Cb,xq.prototype.Ep=function(){return this.vb===Eh.WEBGL?new th({sources:{iml:{type:"MVT"}},layers:{iml:{data:{source:"iml",layer:this.$g+":"+this.Mh},points:{filter:{$geometry:"point"},draw:{points:{collide:!1,order:200,color:"#92CF48",size:[[10,"8px"],[14,"12px"],[18,"16px"]]}}},polygons:{filter:{$geometry:"polygon"},draw:{polygons:{order:201,color:"#E39E3C"},lines:{order:202,color:"#755DA5",width:"1px"}}},lines:{filter:{$geometry:"line"},draw:{lines:{order:203,color:"#0258AE",width:"2px",join:"round",cap:"round"}}}}}}):new H.map.render.harp.Style({styles:[{layer:this.$g+":"+this.Mh,when:["==",["geometry-type"],"Point"],technique:"circles",renderOrder:200,color:"#92CF48",size:["interpolate",["linear"],["zoom"],10,8,14,12,18,16]},{layer:this.$g+":"+this.Mh,when:["==",["geometry-type"],"Polygon"],technique:"polygon",color:"#E39E3C",renderOrder:201},{layer:this.$g+":"+this.Mh,when:["==",["geometry-type"],"Polygon"],technique:"solid-line",color:"#755DA5",width:"1px",renderOrder:202},{layer:this.$g+":"+this.Mh,when:["==",["geometry-type"],"LineString"],technique:"solid-line",color:"#0258AE",width:"2px",renderOrder:203}]})},u(yq,R),t("H.service.omv.Provider",yq),yq.prototype.Xc=ge,yq.prototype.providesOMV=yq.prototype.Xc,yq.prototype.cc=function(t){return this.Hl.test(t)},yq.prototype.cacheFilter=yq.prototype.cc,yq.prototype.Vd=function(t,e,r){return this.$.Sf(t,e,r).toString()},yq.prototype.getTileKey=yq.prototype.Vd,yq.prototype.Sb=function(){return this.SB},yq.prototype.getCache=yq.prototype.Sb,yq.prototype.sA=function(){return this.yn},yq.prototype.getPoliticalView=yq.prototype.sA,yq.prototype.aD=function(t){var e=this.yn;this.yn=t,this.dispatchEvent(new wg("politicalviewchange",this.yn,e))},yq.prototype.setPoliticalView=yq.prototype.aD,yq.prototype.MAX_STORE_TIME=2592e6,yq.prototype.Vi=function(){return Am()},yq.prototype.td=function(){return Am()?zm():yq.g.td.call(this)},yq.prototype.o=function(t,e,r,i,n){return this.$.Pa(t,e,r,i,n)},yq.prototype.requestInternal=yq.prototype.o,yq.prototype.Cb=function(t){t.Yb&&t.Yb("OMV"),this.Xa(t)},yq.prototype.setStyle=yq.prototype.Cb,yq.prototype.K=function(){return yq.g.mb.apply(this)},yq.prototype.getStyle=yq.prototype.K,yq.prototype.mb=function(){var t=yq.g.mb.apply(this),e=t.getState()===ah.READY,r=t.Sd();return e&&r&&r.global&&(this.pq&&(this.nw&&(r.global.ux_language=this.nw),this.Wt&&(r.global.ux_language_fallback=this.Wt)),this.xn&&r.global.poi&&r.global.poi.default&&(r.global.poi.default.visible=this.xn),this.pq||this.xn)&&(t=new th(r,t.Lc())),t},yq.prototype.getStyleInternal=yq.prototype.mb,yq.prototype.pq=!1;var Bq=["en"];function zq(t){zq.g.constructor.call(this,zq,t);var e=zo(this,t).mapVersion;this.Fn=t.queryParams||{},this.dk=ab(e)?e:Cq[this.i().toString()],ab(this.dk)||Dq(this)}yq.prototype.Ip=function(){return this.Zj||Bq},yq.prototype.getLanguages=yq.prototype.Ip,yq.prototype.disposeInternal=function(){yq.g.disposeInternal.call(this),this.$.removeEventListener("versionupdate",this.yw)},yq.prototype.SB=new kj(256),yq.prototype.U=function(t,e){return this.$.U().query(this.Xo,e,t)},yq.prototype.getCopyrights=yq.prototype.U,u(zq,yo),t("H.service.omv.Service",zq),zq.prototype.Da=function(){return{subDomain:"vector",path:"v2/vectortiles/base/mc"}},zq.CONFIG_KEY="omv";var Cq={};function Dq(t){t.o(t.i().clone().A("../../info"),(function(e){e=e.mapVersion;var r=t.i().toString();t.dk=e,e!==Cq[r]&&(Cq[r]=e,t.dispatchEvent("versionupdate"))}),(function(){}))}function lo(t){t=void 0===t?{}:t,lo.g.constructor.call(this,lo,t),this.Ci={Rn:t.resource||"base",Dn:t.projection||"mc",format:t.format||"png8"},this.Fn=t.queryParams||{}}function Eq(t){if(!t||!Za(t.requestData))throw new C(Eq,0,"options.requestData");Eq.g.constructor.call(this,t),this.IC=t.requestData,this.xC=!!t.providesDomMarkers}function Fq(){this.vd={}}mb(Cq),zq.prototype.gA=function(){return this.dk},zq.prototype.getMapVersion=zq.prototype.gA,zq.prototype.od=function(t,e,r){e=e||{};var i={min:0,max:22};return ya(r)&&ho(i,r),new kl(new yq(this,t,e),i)},zq.prototype.createLayer=zq.prototype.od,zq.prototype.Pa=function(t,e,r,i,n){return this.o(this.Sf(t,e,r),(function(t){return t.arrayBuffer().then(i,n)}),n,"arraybuffer")},zq.prototype.Sf=function(t,e,r){return t=this.i().clone().A(r+"/"+t+"/"+e+"/omv"),ab(this.dk)&&t.u({mv:this.dk}).u(this.Fn),t},zq.prototype.rm=function(t){return kn()+"/"+t},zq.prototype.Nj=function(t,e){if(!Za(t))throw new C(this.Nj,0,'"onResult" must be a function');if(!Za(e))throw new C(this.Nj,1,'"onError" must be a function');return this.o(this.i().clone().wc("v2/vectortiles/pviews"),t,e)},zq.prototype.getPoliticalViews=zq.prototype.Nj,X.prototype.Lj=function(t){return this.Ja(zq,t)},X.prototype.getOMVService=X.prototype.Lj,zq.prototype.Kf=function(){this.ec=new No,this.o(this.i().clone().A("../../copyrights"),z(this.pl,this),ie)},zq.prototype.pl=function(t){Oo(this.ec,t),this.dispatchEvent("copyrightupdate")},zq.prototype.U=function(){return this.ec||this.Kf(),this.ec},zq.prototype.getCopyrights=zq.prototype.U,u(lo,yo),t("H.service.rasterTile.Service",lo),m=lo.prototype,m.K=function(){return this.Fn.style||"explore.day"},m.Sf=function(t,e,r){return this.i().clone().A(this.Ci.Rn+"/"+this.Ci.Dn+"/"+r+"/"+t+"/"+e+"/"+this.Ci.format).u(this.Fn)},m.Da=function(){return{subDomain:"maps",path:"v3"}},m.U=function(){return this.ec||this.Kf(),this.ec},m.Kf=function(){this.ec=new No,this.o(this.i().clone().A("copyright"),z(this.pl,this),ie)},m.pl=function(t){var e=t.copyrights;t=t.resources;var r={},i=this.Ci.Rn+"."+this.K();r[i]=[],t[this.Ci.Rn].styles[this.K()].forEach((function(t){e[t].forEach((function(t){var e=[];t.boundingBoxes.forEach((function(t){e.push([t.north,t.west,t.south,t.east])})),r[i].push({boxes:e,label:t.label,alt:t.alt,minLevel:t.minLevel,maxLevel:t.maxLevel})}))})),Oo(this.ec,r)},m.Kj=function(t,e){return this.o(this.i().clone().A("info"),t,e)},lo.prototype.getInfo=lo.prototype.Kj,lo.prototype.Nj=function(t,e){return this.o(this.i().clone().A("politicalViews"),t,e)},lo.prototype.getPoliticalViews=lo.prototype.Nj,lo.prototype.Rz=function(t,e){return this.o(this.i().clone().A("features"),t,e)},lo.prototype.getFeatures=lo.prototype.Rz,lo.prototype.Ip=function(t,e){return this.o(this.i().clone().A("languages"),t,e)},lo.prototype.getLanguages=lo.prototype.Ip,lo.CONFIG_KEY="rasterTile",X.prototype.Qp=function(t){return this.Ja(lo,t)},X.prototype.getRasterTileService=X.prototype.Qp,u(Eq,R),t("H.map.provider.MarkerTileProvider",Eq),Eq.prototype.o=function(t,e,r,i,n){var o=this;return this.IC(t,e,r,(function(n){for(var a,s,l=[],u=n.length;u--;)(s=n[u]).tD=o.getTileKey(t,e,r),s.ea(o),a=s.kc(),(B(s,Ui)||1===a.getState())&&l.push(n[u]);i(l)}),n)},Eq.prototype.requestInternal=Eq.prototype.o,Eq.prototype.Hh=function(t,e){e===Lf.VISUAL&&(t=this.Sb().get(t.tD))&&(t.valid=!1,this.jb(t))},Eq.prototype.invalidateObject=Eq.prototype.Hh,Eq.prototype.Vc=function(){return this.xC},Eq.prototype.providesDomMarkers=Eq.prototype.Vc,Eq.prototype.Wc=ge,Eq.prototype.providesMarkers=Eq.prototype.Wc,Fq.prototype.kc=function(t,e){var r,i=t+e;return(r=this.vd[i])?r:(t=(t=Gq.MARKER.replace("{{icon}}",Hq[t]||Hq.OTHER)).replace("{{color}}",Iq[e]||Iq.BLOCKING),e={size:{w:26,h:33},anchor:{x:13,y:30},hitArea:new Zh($h.POLYGON,Jq.MARKER)},this.vd[i]=new bi(t,e))};var Gq={MARKER:'<svg width="26" height="33" enable-background="new 0 0 26 33" viewBox="0 0 26 33" xmlns="http://www.w3.org/2000/svg"><path d="m26 33h-26v-33h26z" fill="#8c8c8c" opacity="0"/><path d="m17 29.566c0 1.116-1.791 2.022-4 2.022s-4-.906-4-2.022c0-1.118 1.791-2.026 4-2.026s4 .908 4 2.026" fill="#878787" opacity=".6"/><path d="m1.795 17.971c-1.562-1.555-1.574-3.828-.028-5.655l8.343-10.021c.769-.895 1.795-1.384 2.894-1.384 1.117 0 2.197.521 2.889 1.394l8.338 10.014c1.588 1.854 1.578 4.022-.029 5.65l-11.202 11.202z" fill="{{color}}"/>{{icon}}</svg>'},Hq={CONGESTION:'<path style="fill:#FFFFFF;" d="M12.966,1.177c0.965,0,1.894,0.442,2.496,1.204l8.378,10.258c1.362,1.592,1.482,3.477,0,4.979L12.994,28.464L2.143,17.618c-1.381-1.375-1.38-3.348,0-4.979l8.314-10.258C11.174,1.547,12.085,1.177,12.966,1.177 M12.967,0.177L12.967,0.177c-1.247,0-2.408,0.551-3.269,1.552l-8.332,10.28c-1.711,2.022-1.688,4.567,0.07,6.317l10.85,10.845l0.707,0.707l0.707-0.707l10.847-10.846c1.784-1.807,1.803-4.292,0.053-6.337L16.237,1.748C15.462,0.769,14.236,0.177,12.967,0.177L12.967,0.177z M16.645,10.405l-2.025-2.22c-0.48-0.51-1.15-0.8-1.84-0.8H9.53c-0.69,0-1.36,0.29-1.84,0.8l-1.94,2.22c-0.39,0.63-0.59,1.35-0.59,2.09v1.64c0,0.69,0.56,1.25,1.25,1.25h1.44l0.255-0.539c0.204-0.431,0.456-0.837,0.753-1.21l0.962-1.211l0.83-0.9c0.32-0.35,0.72-0.63,1.15-0.82H8.23c-0.28,0-0.55-0.07-0.79-0.22l-0.28-0.17l1.27-1.45c0.28-0.31,0.68-0.48,1.1-0.48h3.25c0.42,0,0.82,0.17,1.1,0.48l1.354,1.54H16.645z M18.31,12.205c-0.35-0.37-0.81-0.63-1.3-0.74c-0.18-0.04-0.36-0.06-0.54-0.06h-3.24c-0.7,0-1.37,0.29-1.84,0.8l-1.13,1.22l-0.82,1c-0.38,0.63-0.59,1.35-0.59,2.09v1.64c0,0.69,0.56,1.25,1.25,1.25h1.75v-1h5.99v1h1.75c0.69,0,1.25-0.56,1.25-1.25v-1.64c0-0.74-0.2-1.46-0.59-2.09L18.31,12.205z M12.1,17.105h-1c-0.138,0-0.25-0.112-0.25-0.25v-1c0-0.138,0.112-0.25,0.25-0.25h1c0.138,0,0.25,0.112,0.25,0.25v1C12.35,16.993,12.238,17.105,12.1,17.105z M18.59,17.105h-1c-0.138,0-0.25-0.112-0.25-0.25v-1c0-0.138,0.112-0.25,0.25-0.25h1c0.138,0,0.25,0.112,0.25,0.25v1C18.84,16.993,18.728,17.105,18.59,17.105z M18.56,14.505c-0.24,0.15-0.51,0.22-0.79,0.22h-5.85c-0.28,0-0.55-0.07-0.78-0.22l-0.29-0.17l1.27-1.45c0.15-0.16,0.33-0.28,0.53-0.37c0.18-0.07,0.38-0.11,0.58-0.11h3.24c0.24,0,0.48,0.06,0.68,0.16c0.16,0.08,0.3,0.19,0.42,0.32l1.27,1.45L18.56,14.505z M8.42,13.03h-1c-0.138,0-0.25-0.112-0.25-0.25v-1c0-0.138,0.112-0.25,0.25-0.25h1c0.138,0,0.25,0.112,0.25,0.25v1C8.67,12.918,8.559,13.03,8.42,13.03z"/>',ROADWORKS:'<path d="m13.004 1.411c.964 0 1.894.441 2.496 1.204l8.346 10.023c1.363 1.592 1.482 3.477 0 4.979l-10.846 10.847-10.852-10.846c-1.381-1.375-1.379-3.348 0-4.979l8.346-10.023c.717-.835 1.628-1.205 2.51-1.205m0-1c-1.248 0-2.408.551-3.268 1.552l-8.356 10.035c-1.718 2.033-1.695 4.578.064 6.328l10.85 10.845.706.707.707-.707 10.846-10.846c1.784-1.808 1.803-4.293.053-6.337l-8.337-10.012c-.769-.973-1.996-1.565-3.265-1.565zm-.575 15.264c.018-.332-.13-.651-.394-.851l-2.945-2.235-.21.36c-.22.39-.41.78-.58 1.19l-.677 2.129-1.364 3.051h1.314l2.109-4.672 1.317 1.212.138 3.46h1.092zm6.16-1.327c-.401-.54-1.209-.539-1.609.001l-1.17 1.58-2.29-1.74-.139-4.054c-.011-.276-.134-.535-.342-.716l-.7-.61c-.185-.161-.422-.25-.667-.25h-1.885c-.335 0-.648.168-.833.447l-1.144 1.723 7.58 5.76-1.86 2.51c-.098.132-.004.32.161.32h6.648l1.142-1.077zm-8.79-2.989-.876-.665.841-1.018.965.043zm1.63 1.24.969-1.781.118 2.61zm2.76-5.79c-.64 0-1.16.52-1.16 1.16 0 .65.52 1.17 1.16 1.17s1.16-.52 1.16-1.17c0-.64-.52-1.16-1.16-1.16z" fill="#fff"/>',ACCIDENT:'<path style="fill:#FFFFFF;" d="M12.998,1.091c0.964,0,1.894,0.442,2.496,1.204l8.346,10.344c1.363,1.592,1.482,3.477,0,4.979L12.994,28.465L2.143,17.618c-1.381-1.375-1.379-3.348,0-4.979l8.346-10.344C11.205,1.462,12.115,1.091,12.998,1.091 M12.998,0.091L12.998,0.091c-1.248,0-2.408,0.551-3.269,1.552L1.364,12.011c-1.708,2.021-1.685,4.566,0.073,6.316l10.85,10.845l0.707,0.707l0.707-0.707l10.846-10.846c1.784-1.808,1.803-4.293,0.053-6.337l-8.327-10.32C15.494,0.684,14.268,0.091,12.998,0.091L12.998,0.091z M7.83,18.982l-3.309-1.855l0.945,1.855H7.83z M16.111,19h3.942l1.596-2L16.111,19z M10.512,20.064l1.021-1.021l1.632,0.076c0.329,0.018,0.651-0.022,0.963-0.123c0.626-0.206,1.122-0.76,1.288-1.44l0.264-1.089l2.066-0.93c0.373-0.17,0.673-0.42,0.861-0.731c0.275-0.449,0.405-0.97,0.369-1.498L18.9,11.676l1.021-1.021l-0.724-0.724l-0.427,0.427l-0.121-0.364c-0.201-0.603-0.54-1.151-0.989-1.6l-1.159-1.159c-0.5-0.5-1.31-0.5-1.809,0l-1.267,1.267l0.724,0.724l-5.066,5.066l-0.724-0.724l-1.267,1.267c-0.5,0.5-0.5,1.31,0,1.809l1.159,1.159c0.449,0.449,0.997,0.788,1.6,0.989l0.364,0.121l-0.427,0.427L10.512,20.064z M14.901,10.349l0.732-0.732c0.098-0.098,0.256-0.098,0.354,0l0.732,0.732c0.098,0.098,0.098,0.256,0,0.354l-0.732,0.732c-0.098,0.098-0.256,0.098-0.354,0l-0.732-0.732C14.803,10.604,14.803,10.446,14.901,10.349z M9.472,15.777l0.732-0.732c0.098-0.098,0.256-0.098,0.354,0l0.732,0.732c0.098,0.098,0.098,0.256,0,0.354l-0.732,0.732c-0.098,0.098-0.256,0.098-0.354,0L9.472,16.13C9.375,16.033,9.375,15.874,9.472,15.777z M11.391,17.615c0.069-0.271,0.206-0.518,0.405-0.717l4.961-4.961c0.195-0.195,0.445-0.337,0.717-0.405l0.344-0.083l0.137,1.925c0.022,0.318-0.058,0.63-0.221,0.901c-0.101,0.166-0.279,0.271-0.409,0.329L14.8,15.74l-0.38,1.574c-0.083,0.344-0.318,0.615-0.612,0.713c-0.188,0.058-0.38,0.083-0.579,0.072l-1.925-0.138L11.391,17.615z"/>',OTHER:'<path style="fill:#FFFFFF;" d="M13.004,1.411c0.964,0,1.894,0.441,2.496,1.204l8.346,10.023c1.363,1.592,1.482,3.477,0,4.979L13,28.465L2.148,17.618c-1.381-1.375-1.379-3.348,0-4.979l8.346-10.023C11.211,1.781,12.122,1.411,13.004,1.411 M13.004,0.411L13.004,0.411c-1.248,0-2.408,0.551-3.268,1.552L1.38,11.998c-1.718,2.033-1.694,4.579,0.064,6.328l10.85,10.845L13,29.878l0.707-0.707l10.846-10.846c1.784-1.808,1.803-4.293,0.053-6.337L16.269,1.976C15.5,1.003,14.273,0.411,13.004,0.411L13.004,0.411z M14.716,20.139c0,0.947-0.758,1.724-1.724,1.724c-0.947,0-1.704-0.777-1.704-1.724c0-0.928,0.757-1.704,1.704-1.704C13.958,18.435,14.716,19.211,14.716,20.139z M14.204,16.33H11.78l-0.537-8.533h3.5L14.204,16.33z"/>'},Iq={BLOCKING:"#323232",VERYHIGH:"#d5232f",HIGH:"#ffa100"},Jq={MARKER:[24.1,17.8,14.2,28.42,16.8,29.4,12.8,31.4,8.79,29.4,11.23,28.42,1.7,17.8,1.7,12.1,10,1.9,12.9,.498,15.8,1.9,24.1,12.1,24.1,17.8]};function Kq(t,e,r){(r=r||{}).criticality||(r.criticality="major,critical"),B(t,Lq,Kq,0),Eq.call(this,{max:20,min:8,requestData:z(this.MC,this),engineType:r.engineType}),this.vd=new Fq,this.$=t,this.Ga=r,this.reload=z(this.reload,this),this.yr=setInterval(this.reload,e||18e4)}u(Kq,Eq),t("H.service.traffic.incidents.Provider",Kq);var Mq={minor:"HIGH","low impact":"HIGH",major:"VERYHIGH",critical:"BLOCKING"};Kq.prototype.MC=function(t,e,r,i,n){var o=this,a=this.vd;return this.$.requestIncidentsByTile(t,e,r,(function(t){var e,r=[];if(t=t.TRAFFIC_ITEMS)for(e=(t=t.TRAFFIC_ITEM).length;e--;){var n=t[e],s=n.TRAFFIC_ITEM_TYPE_DESC;switch(s){case"ACCIDENT":case"CONGESTION":var l=s;break;case"CONSTRUCTION":l="ROADWORKS";break;default:l="OTHER"}l=a.kc(l,Mq[n.CRITICALITY.DESCRIPTION]),(s=new hi({lat:(s=n.LOCATION.GEOLOC.ORIGIN).LATITUDE,lng:s.LONGITUDE},{provider:o,icon:l})).setData(n),r.push(s)}i(r)}),n,this.Ga)},Kq.prototype.l=function(){Eq.prototype.l.call(this),clearInterval(this.yr)},Kq.prototype.dispose=Kq.prototype.l;var Nq="A21 A22 F01 F02 F08 F04 F05 F07 F03 F06 A2F F13 A25 A2C F12 D1B F1B A27 E12 A3A A24 A3D A3F F1F F25 F2C E32 A33 F29 D26 D36 F26 D0F F0F F2B E0C D3A A45 D23 D11 F2E F19 F14 F39 A4A A4B A5C D38 F2A F1A D0A F1C A48 D25 D1D F32 A46 A3E D24 E1C E32 A5F D2E D22 D0A".split(" ");function Oq(t,e,r,i){Oq.g.constructor.call(this,{min:10,max:21,engineType:i}),B(t,Lq,Oq,0),this.$=t,this.Ga=r||Pq,this.Ga.responseattributes="sh,fc",this.yr=setInterval(z(this.reload,this),e||18e4),this.vb===Eh.WEBGL?this.Xa(new th(t.rm("traffic/flow.yaml")),!0):this.Xa(new H.map.render.harp.Style({styles:[{when:["==",["geometry-type"],"LineString"],technique:"solid-line",renderOrder:10002,attr:{color:["case",[">=",["get","JF"],10],"black",[">=",["get","JF"],8],"red",[">=",["get","JF"],4],"yellow","green"],width:3,metricUnit:"Pixel"}}]}))}u(Oq,R),t("H.service.traffic.flow.Provider",Oq),Oq.prototype.rr=ge,Oq.prototype.providesGeoJSON=Oq.prototype.rr,Oq.prototype.K=function(){return this.mb()},Oq.prototype.getStyle=Oq.prototype.K,Oq.prototype.Cb=function(t){t.Yb&&t.Yb("GeoJSONTileSource"),this.Xa(t)},Oq.prototype.setStyle=Oq.prototype.Cb;var Pq={locationreferences:"tmc,shp"};Oq.prototype.disposeInternal=function(){Oq.g.disposeInternal.call(this),clearInterval(this.yr)},Oq.prototype.o=function(t,e,r,i,n){return this.$.requestFlowByTile(t,e,r,(function(t){t.type&&-1!==t.type.indexOf("Error")?n(t.Details):i(t)}),n,this.Ga)},Oq.prototype.requestInternal=Oq.prototype.o,Oq.prototype.pd=function(t,e,r,i,n){var o,a,s,l,u,c={type:"FeatureCollection",features:[]},h=i.RWS.length;for(o=0;o<h;o++){var p=i.RWS[o],f=p.RW,d=f.length,y=-1!==Nq.indexOf(p.EXTENDED_COUNTRY_CODE+p.EBU_COUNTRY_CODE);for(p=0;p<d;p++){var g=f[p].FIS,v=g.length;for(g=0;g<v;g++){var m=f[p].FIS[g].FI,_=m.length;for(a=0;a<_;a++){var b=m[a],x=[],w=b.CF[0],E=!!w.SSS,T={type:"Feature",properties:w,geometry:{type:"MultiLineString",coordinates:x}};for(T.properties.LHT=y,b.SHP.length&&(T.properties.FC=b.SHP[0].FC),E&&(u=[]),w=0;w<b.SHP.length;w++){var A=b.SHP[w].value,S=A.length;for(s=0;s<S;s++){var k=E?u:void 0,I=new Di(A[s].trim()),P=[],O={};for(I.yi();-1!==(l=I.eb());)l===Qq?(O.lat=+String.fromCharCode.apply(Oq,I.mh()),I.next(),I.yi()):l===Rq?(O.lng=+String.fromCharCode.apply(Oq,I.mh()),P.push([O.lng,O.lat]),k&&k.push(ze(O)),O=[],I.next(),I.yi()):I.next();O.lng=+String.fromCharCode.apply(Oq,I.mh()),P.push([O.lng,O.lat]),k&&k.push(ze(O)),l=P,x.push(l)}}c.features.push(T)}}}}return Oq.g.pd.call(this,t,e,r,c,n)},Oq.prototype.createTileInternal=Oq.prototype.pd;var Rq=32,Qq=44;function Sq(t){function e(e){i.contains(n)&&i.removeChild(n),u&&clearTimeout(u),delete Sq.Br[o],e&&t.Ot&&t.Ot.call(l,e)}if(!t.url||!t.Oo)throw Error('Parameter "options" must specify at least a URL and a callback.');if("function"!=typeof t.Oo)throw Error("Parameters options.callback must be a function");var r=t.YD||document,i=r.getElementsByTagName("head")[0],n=r.createElement("script");r=t.url instanceof W?t.url:mo(t.url,t.WD);var o=Sq.SC++,a=t.wy||"callback",s=t.Oo,l={},u=null;return l.id=o,l.cancel=function(){e("cancelled")},0!==t.timeout&&(u=globalThis.setTimeout((function(){e("timeout")}),t.timeout||3e4)),Sq.Br[o]=function(t){e(),s.call(l,t)},n.type="text/javascript",n.src=r.toString()+(r.Du()?"&":"?")+a+"="+(t.ZD?"H.service.jsonp.handleResponse("+o+")":encodeURI("H.service.jsonp.handleResponse("+o+")")),i.appendChild(n),l}function Lq(t){Lq.g.constructor.call(this,Lq,t),this.xy=zo(this,t).callbackKey,this.Ye=!1}function Tq(t,e,r,i){return t.Ye||(io(Lq,"Use HERE Traffic API v7 instead."),t.Ye=!0),Sq({url:e,Oo:r,Ot:function(t){i(Error("["+t+"] "+e+" request failed"))},wy:t.xy})}function Uq(t){Uq.g.constructor.call(this,Uq,t)}function Vq(){}function Wq(t){var e=t.childNodes,r=new Vq;for(this.offsetX=this.offsetY=0,t=e.length;t--;){var i=e[t];"href"===i.nodeName&&(this.href=r.Ua(i))}}function Xq(t){for(var e,r=(t=t.attributes).length;r--;)switch(e=t[r],e.name){case"x":this.x=parseFloat(e.value);break;case"y":this.y=parseFloat(e.value);break;case"xunits":this.Ze="fraction"===Vq.prototype.Ua(e);break;case"yunits":this.$d="fraction"===Vq.prototype.Ua(e)}}function Yq(t){var e;if(t){var r=(t=t.childNodes).length;for(e=new Vq;r--;){var i=t[r];switch(i.nodeName){case"scale":this.scale=e.mm(i);break;case"Icon":this.icon=i=new Wq(i);break;case"hotSpot":this.Gu=i=new Xq(i)}}}}function Zq(){this.YA={4:function(t){return["#",t.charAt(1),t.charAt(1),t.charAt(2),t.charAt(2),t.charAt(3),t.charAt(3),"ff"].join("")},5:function(t){return["#",t.charAt(1),t.charAt(1),t.charAt(2),t.charAt(2),t.charAt(3),t.charAt(3),t.charAt(4),t.charAt(4)].join("")},7:function(t){return t+"ff"},9:function(t){return t}},this.TC={4:function(t){return[$q(t.charAt(1)),$q(t.charAt(2)),$q(t.charAt(3)),255]},5:function(t){return[$q(t.charAt(1)),$q(t.charAt(2)),$q(t.charAt(3)),$q(t.charAt(4))]},7:function(t){return[(t=parseInt(t.substring(1),16))>>16&255,t>>8&255,255&t,255]},9:function(t){return[(t=parseInt(t.substring(1),16))>>24&255,t>>16&255,t>>8&255,255&t]}}}function $q(t){return((t=parseInt(t,16))<<4)+t}function ar(t){return 16>t?"0"+Math.round(t).toString(16):Math.round(t).toString(16)}function br(t,e,r){return/^(#|rgb).*/.test(e)?(r||(r="","#"===e.charAt(0)?r=t.YA[e.length]?e:"":"rgb"===e.substr(0,3)&&(r=2<(r=(e=e.match(/\d+(\.\d+)?/g)).length)&&5>r?["#",ar(+e[0]),ar(+e[1]),ar(+e[2]),3<r?ar(255*+e[3]):"ff"].join(""):""),e=r),(t=t.TC[e.length](e))[3]=Math.round(t[3]/255*100)/100,t):[0,0,0,255]}function cr(t){for(var e,r=(t=t.childNodes).length,i=new Vq,n=new Zq;r--;)switch(e=t[r],e.nodeName){case"color":this.color=i.km(e);break;case"colorMode":this.By=i.Ua(e)}"random"===this.By&&(this.color="#"+n.vx(this.color,!1))}function dr(t){var e=t.childNodes,r=e.length,i=new Vq;for(this.Ml=new cr(t);r--;)"width"===(t=e[r]).nodeName&&(this.width=i.mm(t))}function er(t){for(var e,r=(t=t.childNodes).length,i=new Vq;r--;)switch(e=t[r],e.nodeName){case"bgColor":this.bgColor=i.km(e);break;case"textColor":this.textColor=i.km(e);break;case"text":this.text=i.Ua(e);break;case"displayMode":this.displayMode=i.Ua(e)}}function fr(t){var e=t.childNodes,r=e.length,i=new Vq;for(this.outline=this.fill=!0,this.Ml=new cr(t);r--;)switch(t=e[r],t.nodeName){case"fill":this.fill=i.sh(t);break;case"outline":this.outline=i.sh(t)}}function gr(t){var e=t.childNodes,r=e.length;for(this.id=t.getAttribute("id");r--;)switch(t=e[r],t.nodeName){case"IconStyle":this.Iu=t=new Yq(t);break;case"LineStyle":this.Nh=t=new dr(t);break;case"PolyStyle":this.hw=t=new fr(t);break;case"BalloonStyle":this.Dl=t=new er(t)}}function hr(t,e){var r=(t=t.childNodes).length,i=new Vq;for(this.qD=e;r--;)switch(e=t[r],e.nodeName){case"key":this.key=i.Ua(e);break;case"styleUrl":this.bl=i.Ua(e)}}function ir(t,e){var r=t.childNodes,i=r.length;for(this.hs=e,this.id=t.getAttribute("id"),this.un=[];i--;)"Pair"===(t=r[i]).nodeName&&(t=new hr(t,this.hs),this.un.push(t))}function jr(){this.jx={}}function kr(t){bb(this,kr),this.url=t,this.gj=[],this.be=x,this.lj=z(this.lj,this),E.call(this)}t("H.service.jsonp",Sq),Sq.UA=function(t){return(t=Sq.Br[t])?t:function(){}},Sq.handleResponse=Sq.UA,Sq.SC=0,Sq.Br={},u(Lq,yo),t("H.service.traffic.Service",Lq),Lq.prototype.Da=function(){return{subDomain:"traffic.ls",path:"traffic/6.1",callbackKey:"jsoncallback"}},Lq.CONFIG_KEY="traffic",Lq.prototype.ut=function(t,e){return new kl(new Oq(this,void 0,t,e),{max:22})},Lq.prototype.createFlowLayer=Lq.prototype.ut,Lq.prototype.vt=function(t){return new dj(new Kq(this,void 0,t))},Lq.prototype.createIncidentsLayer=Lq.prototype.vt,Lq.prototype.NC=function(t,e,r){return Tq(this,t=this.i().clone().A("incidents.json").u(t),e,r)},Lq.prototype.requestIncidents=Lq.prototype.NC,Lq.prototype.KC=function(t,e,r,i,n,o){return Tq(this,t=this.i().clone().A(["flow/json",r,t,e].join("/")).u(o||{}),i,n)},Lq.prototype.requestFlowByTile=Lq.prototype.KC,Lq.prototype.PC=function(t,e,r,i,n,o){return Tq(this,t=this.i().clone().A(["incidents/json",r,t,e].join("/")).u(o||{}),i,n)},Lq.prototype.requestIncidentsByTile=Lq.prototype.PC,Lq.prototype.rm=function(t){return kn()+"/"+t},u(Uq,yo),t("H.service.traffic.Service7",Uq),Uq.prototype.Da=function(){return{subDomain:"data.traffic",path:"v7"}},Uq.CONFIG_KEY="traffic_v7",Uq.prototype.LC=function(t,e,r,i){return t=this.i().clone().A(["incidents",t].join("/")).u(e||{}),this.o(t,r,i)},Uq.prototype.requestIncidentById=Uq.prototype.LC,Uq.prototype.JC=function(t,e,r){return t=this.i().clone().A("flow").u(t||{}),this.o(t,e,r)},Uq.prototype.requestFlowByArea=Uq.prototype.JC,Uq.prototype.OC=function(t,e,r){return t=this.i().clone().A("incidents").u(t||{}),this.o(t,e,r)},Uq.prototype.requestIncidentsByArea=Uq.prototype.OC,X.prototype.Sp=function(t,e){if(6===(e=e||6))e=Lq;else{if(7!==e)throw new C(this.Sp,1,"allowed values are 6 and 7");e=Uq}return this.Ja(e,t)},X.prototype.getTrafficService=X.prototype.Sp,t("H.service.buildInfo",(function(){return bn("H-service","1.60.0","2c2ebf2",{region:"row"})})),t("H.data.utils.Dom",Vq),Vq.prototype.sh=function(t){return!!t&&/^\s*(1|true)\s*$/i.test(this.Ua(t))},Vq.prototype.getBoolean=Vq.prototype.sh,Vq.prototype.Ua=function(t){var e;try{if(t.nodeType===Node.ATTRIBUTE_NODE)return t.value;var r="",i=0,n=t.childNodes;for(e=n.length;i<e;i++)n[i].nodeType!==Node.COMMENT_NODE&&(r+=n[i].nodeValue.replace(/^\s+|\s+$/g,""))}catch(t){}return r||""},Vq.prototype.getString=Vq.prototype.Ua,Vq.prototype.mm=function(t){return parseFloat(this.Ua(t))||0},Vq.prototype.getFloat=Vq.prototype.mm,Vq.prototype.aw=function(t){var e,r=t.split(/\s+/),i=r.length,n=!(r&&1==i),o=n?1:3,a=[];for(n||(i=(r=t.split(",")).length),e=0;e<i;e+=o){if(!(t=this.fr(n?r[e]:e+3>r.length?null:r.slice(e,e+3))))return[];a.push(t)}return a},Vq.prototype.parseCoords=Vq.prototype.aw,Vq.prototype.fr=function(t){if(!t)return null;var e=t instanceof Array&&0<t.length&&4>t.length?t:t.split(",");t=parseFloat(e[0]);var r=parseFloat(e[1]);return e=parseFloat(e[2]),isNaN(r)||isNaN(t)?null:new xe(r,t,isNaN(e)?void 0:e)},Vq.prototype.parseCoord=Vq.prototype.fr,Vq.prototype.km=function(t){return t=this.Ua(t),/^[0-9a-fA-F]{8}$/.test(t)?"#"+t.substr(6,2)+t.substr(4,2)+t.substr(2,2)+t.substr(0,2):"#000000ff"},Vq.prototype.getColor=Vq.prototype.km,t("H.data.kml.Icon",Wq),t("H.data.kml.HotSpot",Xq),t("H.data.kml.IconStyle",Yq),t("H.data.utils.ColorHelper",Zq),Zq.prototype.vx=function(t,e){var r="";if(!/^(#|rgb).*/.test(t)){for(r="",t=0;6>t;t++)r+="ABCDEF0123456789".charAt(Math.floor(16*Math.random()));return r+"ff"}for(t=br(this,t,e),e=0;4>e;e++)r+=""+ar(3>e?Math.floor(Math.random()*(t[e]-0+1))+0:255*t[e]);return r},Zq.prototype.toRandomRGBA=Zq.prototype.vx,t("H.data.kml.ColorStyle",cr),t("H.data.kml.LineStyle",dr),t("H.data.kml.BalloonStyle",er),t("H.data.kml.PolyStyle",fr),t("H.data.kml.Style",gr),t("H.data.kml.Pair",hr),hr.prototype.K=function(){if(this.bl){var t="highlight"===this.key;t=this.qD.Rp(this.bl.substr(1),t)}return t},hr.prototype.getStyle=hr.prototype.K,t("H.data.kml.StyleMap",ir),ir.prototype.K=function(t){var e=null;t=t?"highlight":"normal";for(var r=this.un.length;r--;)this.un[r].key===t&&(e=this.un[r].K());return e},ir.prototype.getStyle=ir.prototype.K,t("H.data.kml.StyleContainer",jr),jr.prototype.Ao=function(t){t&&t.id&&(this.jx["style_"+t.id]=t)},jr.prototype.addStyle=jr.prototype.Ao,jr.prototype.Rp=function(t,e){return(t=this.jx["style_"+t])instanceof ir&&(t=t.K(e)),t},jr.prototype.getStyleById=jr.prototype.Rp,u(kr,E),t("H.data.AbstractReader",kr);var lr={ERROR:-1,LOADING:0,VISIT:1,READY:2};function mr(t,e,r,i){mr.g.constructor.call(this,e,t),this.state=r,this.message=i}function nr(t){for(var e,r=(t=t.childNodes).length,i=new Vq;r--;)if("coordinates"===(e=t[r]).nodeName){e=i.Ua(e);var n=[],o=new Vq;try{n=o.aw(e)}catch(t){n=[]}this.Tl=2>n.length?[]:n}}function or(){}function pr(t){var e=t.childNodes,r=e.length;for(this.Tt=new J,this.Pu=[];r--;){var i=e[r],n=i.nodeName;if("outerBoundaryIs"===n||"innerBoundaryIs"===n){var o=i.childNodes;for(i=o.length;i--;){var a=o[i];if("LinearRing"===a.nodeName){var s=new nr(a);if("outerBoundaryIs"===n){this.Tt=s.vh();var l=void 0,u=t,c=s.Tl;s=new Vq;var h=u.querySelector("altitudeMode");if(h&&h.parentNode===u&&!/^\s*clampTo/.test(s.Ua(h))&&c){h=c.length;for(var p=0;p<h&&0!==l;p++){var f=c[p].alt;f?l?f!==l&&(l=0):l=f:l=0}(c=u.querySelector("*|altitudeOffset"))&&c.parentNode===a&&"http://www.google.com/kml/ext/2.2"===c.namespaceURI&&(a=s.mm(c))&&(l+=a),l&&(l=kd(2047,l),(a=u.querySelector("extrude"))&&a.parentNode===u&&s.sh(a)?this.Ut=l:this.elevation=l)}}else this.Pu.push(s.vh())}}}}}function qr(t,e){var r=t&&t.childNodes||[],i=new Vq;if(!t||!e)throw Error("Node or stylesContainer is not defined");for(this.visibility=!0,this.tC=t,t=r.length;t--;){var n=r[t];switch(n.nodeName){case"name":this.name=i.Ua(n);break;case"description":this.description=i.Ua(n);break;case"visibility":this.visibility=i.sh(n);break;case"open":this.open=i.sh(n);break;case"styleUrl":(this.bl=i.Ua(n))&&(n=this.bl.substr(1),this.fz=e.Rp(n,!1));break;case"Style":this.ov=n=new gr(n)}}}function rr(t){for(var e,r=(t=t.childNodes).length,i=null,n=new Vq;r--;)"coordinates"===(e=t[r]).nodeName&&(i=n.Ua(e));this.kv=null,i&&(this.kv=n.fr(i)||null)}function sr(t,e){var r=document.createElement("CANVAS");r.width=1,r.height=1,this.hs=t,this.eq={},this.hr={},this.$y=new bi(r),this.md=e||""}function tr(t,e,r){for(var i,n,o=(e=e.childNodes).length,a={};o--;){var s=e[o];switch(s.nodeName){case"Point":s=new rr(s),n=ur(t,"Marker"),(s=s.vh())&&(i=new hi(s,n),n.gr&&Vc(n.gr,"statechange",z(t.fC,t,n.gr,i,n),!1));break;case"LineString":case"LinearRing":s=new nr(s),n=ur(t,"Polyline"),i=new Bm(s.vh(),n);break;case"Polygon":s=new pr(s),(n=ur(t,"Polygon")).elevation=s.elevation,n.extrusion=s.Ut,i=new ng(new L(s.Tt,s.Pu),n);break;case"MultiGeometry":i=tr(t,s,new T)}i&&(t.oh.name&&(a.name=t.oh.name),t.oh.description&&(a.description=t.oh.description),n&&n.Dl&&(a.balloonStyle=n.Dl),a.kmlNode=t.oh.tC,i.setData(a),r&&r.Y(i))}return r||i}function ur(t,e){var r=t.oh,i={visibility:r.visibility},n=new Zq,o=1,a={x:0,y:0,Ze:!1,$d:!1},s=vr(t,r.fz);switch(r.ov&&(s=vr(t,r.ov,s)),e){case"Marker":if(s&&s.Iu){if((n=s.Iu).scale&&(o=n.scale),n.Gu){var l=n.Gu;a={x:l.x,y:l.y,Ze:l.Ze,$d:l.$d}}n.icon&&n.icon.href?(e=n.icon.href,wr.test(e)||(e=t.md+e),n=o+"_"+a.x+a.y+a.Ze+a.$d+"_"+e,(l=t.eq[n]||t.hr[n])||(l=new bi(e),t.hr[n]=l),0===l.getState()?(i.icon=t.$y,i.gr=l,i.href=e,i.anchor=a,i.scale=o):1===l.getState()&&(i.icon=l)):1!==o&&(l||(a={x:14,y:4,Ze:!1,$d:!1}),n=bi,t=t.Dp(),o={size:new Ph((l={w:28*o,h:36*o}).w,l.h),anchor:new K(a.Ze?l.w*a.x:a.x*o,a.$d?l.h*(1-a.y):l.h-a.y*o),hitArea:new Zh($h.POLYGON,[0*o,16*o,0*o,7*o,8*o,0*o,18*o,0*o,26*o,7*o,26*o,16*o,18*o,34*o,8*o,34*o])},i.icon=new n(t,o))}break;case"Polyline":i.style={},s&&s.Nh&&(o=s.Nh,i.style.strokeColor="rgba("+br(n,o.Ml.color,!0)+")",0<=o.width&&(i.style.lineWidth=o.width));break;case"Polygon":i.style={},s&&(s.Nh&&(o=s.Nh,i.style.strokeColor="rgba("+br(n,o.Ml.color,!0)+")",0<=o.width&&(i.style.lineWidth=o.width)),s.hw&&(o=s.hw,i.style.fillColor=o.fill?"rgba("+br(n,o.Ml.color,!0)+")":"rgba(0,0,0,0)",o.outline||(i.style.lineWidth=0)))}return i.Dl=s.Dl,i}function vr(t,e,r){for(var i in r=r||{},e)e.hasOwnProperty(i)&&(r[i]="object"==typeof e[i]?vr(t,e[i],r[i]):e[i]);return r}kr.State=lr,kr.prototype.state=lr.READY,kr.prototype.j={fy:"statechange"},kr.prototype.Tb=function(){return this.be||(this.be=new P,this.be.sd().kd(this.gj)),new Cl(this.be)},kr.prototype.getLayer=kr.prototype.Tb,kr.prototype.nA=function(){return this.gj.concat([])},kr.prototype.getParsedObjects=kr.prototype.nA,kr.prototype.i=function(){return this.url},kr.prototype.getUrl=kr.prototype.i,kr.prototype.eD=function(t){if(this.state===lr.LOADING||this.state===lr.VISIT)throw Error("InvalidState: state "+this.state);return this.gj=[],this.be=x,this.url=t,this},kr.prototype.setUrl=kr.prototype.eD,kr.prototype.getState=function(){return this.state},kr.prototype.getState=kr.prototype.getState,kr.prototype.F=function(t,e,r){this.state=t,this.dispatchEvent(new mr(e||this,this.j.fy,t,r||""))},kr.prototype.parse=function(){var t=this;ab(this.url)?(this.F(lr.LOADING),new nh("text/plain",this.url).then((function(e){try{t.lj(e)}catch(e){t.F(lr.ERROR,x,e.message)}}),(function(){t.F(lr.ERROR,x,"Error loading file")}))):t.F(lr.ERROR,x,"File url was not set")},kr.prototype.parse=kr.prototype.parse,u(mr,Fc),kr.Event=mr,t("H.data.kml.Line",nr),nr.prototype.vh=function(){for(var t=new J,e=this.Tl?this.Tl.length:0;e--;)t.tg(this.Tl[e]);return t},or.prototype.elevation=0,or.prototype.Ut=0,u(pr,or),t("H.data.kml.Polygon",pr),t("H.data.kml.Feature",qr),t("H.data.kml.Point",rr),rr.prototype.vh=function(){return this.kv},sr.prototype.create=function(t){return this.oh=new qr(t,this.hs),tr(this,t)},sr.prototype.fC=function(t,e,r){var i=r.anchor,n=r.scale;r=n+"_"+i.x+i.y+i.Ze+i.$d+"_"+r.href;var o={};if(1===t.getState()){var a=this.eq[r];if(!a){var s=i.x,l=i.y;(a=t.mc())&&(a={w:a.w*n,h:a.h*n},o.size=a),s=i.Ze&&a?a.w*s:s*n,l=i.$d&&a?a.h*(1-l):!i.$d&&a?a.h-l*n:l*n,o.anchor={x:s,y:l},a=new bi(t.Te(),o),this.eq[r]=a}e.we(a)}delete this.hr[r]};var wr=/^[^:\/]+:/;function xr(t){var e=t?t.lastIndexOf("/"):-1;this.Ak=[],kr.call(this,t),0<=e&&(this.jB=t.substr(0,e)+"/")}function yr(t,e){for(var r,i=t.length,n=[];i--;)(r=t[i]).nodeName===e&&n.push(r);return n}function zr(t,e,r,i,n){1&n&&Ar(t,t,e,r,i,0),2&n&&Ar(t,t,e,r,i,1),4&n&&Ar(t,t,e,r,i,2),8&n&&Ar(t,t,e,r,i,3)}function Ar(t,e,r,i,n,o){for(var a,s,l,u,c=(r+1)*(r+1),h=4*i,p=r+1,f=[{r:0,mz:0,b:0,a:0,next:null}],d=1,y=["r","g","b","a"][o],g=2*r+1;d<g;d++)f[d]={r:0,mz:0,b:0,a:0,next:null},f[d-1].next=f[d];f[2*r].next=f[0];var v=4*(i-1);for(a=0;a<n;a++){var m=a*h,_=t[m+o],b=_*p*(r+2)/2;for(g=_*p,d=0;d<=r;d++)f[d][y]=_;var x=0;for(d=1;d<=r;d++){var w=d<i?m+4*d:m+v;b+=(w=t[w+o])*(p-d),x+=w,f[r+d][y]=w}w=f[0],l=f[p],d=m,u=4*p;var E=m+v;for(_=0;_<i;_++){e[d+o]=b/c,b-=g;var T=_+p<i?d+u:E;if(b+=x+=T=t[T+o],g-=w[y],g+=l[y],x-=l[y],w[y]=T,w=w.next,l=l.next,d+=4,!b)for(;(s=4*(_+p))<h&&0===t[m+o+s];)_++,d+=4}}for(m=(n-1)*h,_=0;_<i;_++){for(b=(a=e[(t=4*_)+o])*p*(r+2)/2,g=a*p,d=0;d<=r;d++)f[d][y]=a;for(x=0,d=1;d<=r;d++)b+=(w=e[(w=d<n?t+d*h:t+m)+o])*(r-d+1),x+=w,f[r+d][y]=w;for(w=f[0],l=f[p],d=t,E=p*h,v=t+m,a=0;a<n;a++)if(e[d+o]=b/c,b-=g,b+=x+=T=e[(T=a+p<n?d+E:v)+o],g-=w[y],g+=l[y],x-=l[y],w[y]=T,w=w.next,l=l.next,d+=h,!b)for(;(s=a+p)<n&&0===e[s*h+o+t];)a++,d+=h}}function Br(t,e,r){this.ZA=e=t>>e,this.BB=Math.log(e)*Math.LOG2E,this.Ec=t=document.createElement("CANVAS"),this.uy=t.getContext("2d"),this.vy=t.width=t.height=3*e;var i=document.createElement("canvas");t=r.Qu;var n,o=r.oD;for(a in e=[],i.width=256,i.height=1,i=i.getContext("2d"),o)o.hasOwnProperty(a)&&e.push({stop:parseFloat(a),value:o[a]});o=e.length,e.sort(this.nD),0<e[0].stop&&e.unshift({stop:0,value:e[0].value}),1>e[o-1].stop&&e.push({stop:1,value:e[o-1].value}),o=e.length;var a=i.createLinearGradient(0,0,256,0);for(n=0;n<o;n++){if(!t&&l){var s=l.stop+(e[n].stop-l.stop)/2;a.addColorStop(s,l.value),a.addColorStop(s,e[n].value)}a.addColorStop(e[n].stop,e[n].value);var l=e[n]}i.fillStyle=a,i.fillRect(0,0,256,1),this.Cy=i.getImageData(0,0,256,1).data,this.$A=r.Qu}function Cr(t,e){this.canvas=t,this.size=e}function Dr(t,e){var r,i=0;if(!ya(t)||Oa(t))throw new C(Dr,0,t);for(r in t){var n=+r;if(i++,!(jb(n)&&0<=n&&1>=n&&gb(t[r])))throw new C(Dr,0,t)}if(2>i)throw new C(Dr,0,"Specify at least 2 stops");this.oD=t,this.Qu=!!e}sr.prototype.Dp=function(){return'<svg xmlns="http://www.w3.org/2000/svg" width="28px" height="36px"><path d="M 19 31 C 19 32.7 16.3 34 13 34 C 9.7 34 7 32.7 7 31 C 7 29.3 9.7 28 13 28 C 16.3 28 19 29.3 19 31 Z" fill="#000" fill-opacity=".2"/><path d="M 13 0 C 9.5 0 6.3 1.3 3.8 3.8 C 1.4 7.8 0 9.4 0 12.8 C 0 16.3 1.4 19.5 3.8 21.9 L 13 31 L 22.2 21.9 C 24.6 19.5 25.9 16.3 25.9 12.8 C 25.9 9.4 24.6 6.1 22.1 3.8 C 19.7 1.3 16.5 0 13 0 Z" fill="#fff"/><path d="M 13 2.2 C 6 2.2 2.3 7.2 2.1 12.8 C 2.1 16.1 3.1 18.4 5.2 20.5 L 13 28.2 L 20.8 20.5 C 22.9 18.4 23.8 16.2 23.8 12.8 C 23.6 7.07 20 2.2 13 2.2 Z" fill="#18d"/></svg>'},u(xr,kr),t("H.data.kml.Reader",xr),xr.prototype.lj=function(t){var e,r=null;if(gb(t)&&""!=t.trim()){try{var i=(new DOMParser).parseFromString(t,"text/xml")}catch(t){return void this.F(lr.ERROR,x,"Error parsing KML document")}if(i.getElementsByTagName("parsererror").length)this.F(lr.ERROR,x,"Error parsing KML document");else if((t=i.childNodes&&"kml"===i.childNodes[0].nodeName?i.childNodes[0]:void 0)&&(e=yr(t.childNodes,"Document")[0]),e=e||t){i=new jr;for(var n=yr(e.childNodes,"Style"),o=yr(e.childNodes,"StyleMap"),a=n.length;a--;)t=new gr(n[a]),i.Ao(t);for(a=o.length;a--;)t=new ir(o[a],i),i.Ao(t);for(this.QB=new sr(i,this.jB),e=(t=e.childNodes).length;e--;)i=r,"Placemark"===(n=t[e]).nodeName?(n=this.QB.create(n))&&this.Rg(n,i):"Folder"===n.nodeName&&(n={group:new T,node:n},this.Rg(n.group,i),this.Ak.push(n)),!e&&(i=this.Ak.shift())&&(t=i.node.childNodes,r=i.group,e=t.length);this.F(lr.READY)}else this.F(lr.ERROR,x,"Invalid KML document")}else this.F(lr.ERROR,x,"Unable to create objects from the empty data")},xr.prototype.Rg=function(t,e){e?e.Y(t):(this.be&&this.be.sd().Y(t),this.gj.push(t),this.F(lr.VISIT,t))},Br.prototype.nD=function(t,e){return t.stop-e.stop},Br.prototype.Sx="#000",Br.prototype.gy="#080",t("H.data.heatmap.Colors",Dr);var Er=new Dr({0:"#008",.2:"#0b0",.5:"#ff0",.7:"#f00"},!0);function Fr(t,e,r){this.cf=t=Nd(t,0,30),this.Ra=e,this.oj=r,this.gs=[],this.ci=[];do{this.ci[t]=[],this.gs[t]=new Gr}while(t--);e===Hr?(this.Ts=Ir,this.normalize=Jr):(this.Ts=Kr,this.normalize=Lr),this.gk=1/0,this.Xm=-1/0}Dr.DEFAULT=Er;var Mr=Math.log(.5);function Jr(t){return this.ip?Math.round((t-this.gk)/this.ip*255):127}function Lr(t){return void 0===this.bu?127:Math.round(255*Math.pow(t,this.bu))}function Nr(t,e,r,i,n){var o,a,s=1<<e;return i=Md(i,s),!(s=0<=r&&r<s&&(o=t.ci[e])&&(a=o[r])&&(s=a[i])||null)&&n&&0<=e&&(s=Nr(t,e-1,r>>1,i>>1,n)),s}function Or(t,e,r,i,n,o){for(var a,s=[];r<=i;r++)for(a=n;a<=o;a++)s.push(Nr(t,e,r,a,!1));return s}function Pr(t,e){var r,i=0,n=0,o=Nr(t,0,0,0,!1);return e.fm||(e.z===t.cf?e.Aj=e.Cc:(Qr(t,e,(function(e){var a=Rr(t,e),s=4-a.length;if(e.z!==t.cf){for(r=0;r<a.length;r++)i+=a[r].Cc,n++;i+=s*o.Cc,n+=s}})),e.Aj=i/n),e.fm=!0),e.Aj}function Qr(t,e,r){e=[e];for(var i,n;0<e.length;)i=Rr(t,n=e.shift()),r(n),e.push.apply(e,i)}function Rr(t,e){var r,i,n,o=[];for(i=0;1>=i;i++)for(n=0;1>=n;n++)(r=Nr(t,e.z+1,2*e.x+i,2*e.y+n,!1))&&o.push(r);return o}function Kr(t,e,r){this.x=t,this.y=e,this.z=r,this.Cc=this.fd=this.count=0,this.fm=!1,this.Aj=0}function Ir(t,e,r){this.x=t,this.y=e,this.z=r,this.Cc=this.fd=this.count=0,this.fm=!1,this.Aj=0}function Gr(){this.Av=this.zv=1/0,this.Qh=this.Iq=-1/0}function Sr(t){var e=t||{},r=+e.sampleDepth,i=e.pointSize;t=+e.coarseness;var n=e.colors,o={min:e.min,max:e.max,engineType:e.engineType},a=e.tileSize,s=+e.dataMax;if(e.tileSize&&(o.tileSize=a),R.call(this,o),this.Fg(e.opacity),this.Ra="value"===e.type?Hr:Tr,this.sampleDepth_=jb(r)?Nd(Math.round(r),1,8):4,this.Kw=this.Ra===Tr?jb(i)?Nd(Math.round(7-i),0,6):2:1,this.et=!!e.assumeValues,e=this.max,this.oj=jb(s)?Nd(Math.round(s),this.min,e+this.sampleDepth_):e,t=jb(t)?Nd(Math.round(t),0,3):1,n&&!B(n,Dr))throw new C(Sr,0,"colors");this.Bi=new Fr(e+this.sampleDepth_+this.Kw,this.Ra,this.oj),this.uD=new Br(this.tileSize,t,n||Er),this.sg=z(this.sg,this),this.mg=z(this.mg,this),this.Mn=new Gk(20,this.sg)}Fr.prototype.zc=function(t){var e,r,i=t.value;void 0===i&&(i=1),i>this.Xm&&(this.Xm=i,this.ip=this.Xm-this.gk),i<this.gk&&(this.gk=i,this.ip=this.Xm-this.gk);var n=Jh.Se(t).scale(1073741823).floor();i=this.cf;var o=n.x>>30-i;for(n=n.y>>30-i,r=this.Ts;-1<i;){this.ci[i][n]||(this.ci[i][n]=[]),(e=this.ci[i][n][o])||(e=this.ci[i][n][o]=new r(o,n,i)),e.zc(t,i);var a=this.gs[i];a.Av>e.fd&&(a.Av=e.fd),a.Qh<e.fd&&(a.Qh=e.fd),a.zv>e.Cc&&(a.zv=e.Cc),a.Iq<e.Cc&&(a.Iq=e.Cc),i--,o>>=1,n>>=1}},Fr.prototype.clear=function(){Fr.call(this,this.cf,this.Ra,this.oj)},Kr.prototype.zc=function(t,e){this.count++,this.fd+=t.value||1,this.Cc=this.fd/Math.pow(2,2*(30-e))},Ir.prototype.zc=function(t){t=t.value,this.fd+=void 0!==t?t:1,this.Cc=this.fd/++this.count,this.fm=!1},u(Sr,R),t("H.data.heatmap.Provider",Sr),Sr.prototype.Fd=function(t){this.Fg(t)},Sr.prototype.setOpacity=Sr.prototype.Fd,Sr.prototype.Ve=function(){return this.Sc},Sr.prototype.getOpacity=Sr.prototype.Ve,Sr.prototype.zk=ge,Sr.prototype.providesRasters=Sr.prototype.zk,Sr.prototype.o=function(t,e,r,i,n){var o,a,s=this.et;if(Nr(this.Bi,0,0,0,!1)){if(!s){var l=Or(this.Bi,r,e-1,e+1,t-1,t+1);for(o=l.length;o--&&!s;)if(null!==l[o]){s=!0;break}}s&&(a=this.Mn.push([t,e,r,i,n],this.mg))}return s||i(null),a||Aj},Sr.prototype.requestInternal=Sr.prototype.o,Sr.prototype.sg=function(t,e){var r=t.done,i=e[0],n=e[1],o=e[2];e=document.createElement("canvas");var a=this.tileSize,s=e.getContext("2d");e.width=e.height=a;var l,u,c=this.uD,h=this.Bi,p=this.et,f=this.Ra,d=this.Kw,y=c.ZA,g=c.uy,v=f===Tr?void 0===d?2:d:1;d=v,v=Math.min(this.sampleDepth_+v,c.BB);var m=c.vy,_=h.cf;if(p&&f===Hr){for(u=-1;1>=u;u++)for(p=-1;1>=p;p++){var b=(b=Nr(h,o,n+u,i+p,!0))?h.normalize(Pr(h,b)):128;g.fillStyle="rgba("+b+",128,0,1)",g.fillRect((p+1)*y,(u+1)*y,y,y)}p=y-Math.floor(y/10),u=3,zr((b=g.getImageData(0,0,m,m)).data,p,m,m,u),g.putImageData(b,0,0)}else g.fillStyle=p?c.gy:c.Sx,g.fillRect(0,0,m,m);for(;d<=v&&o+d<=_;d++){u=y-(p=y>>d);var x=f===Tr?127+Math.floor(128/(1<<v-d)):255;b=2+(1<<d);var w=1<<d,E=i<<d,T=n<<d;for(E=(w=Or(h,o+d,T-1,T+w,E-1,E+w)).length;E--;){T=E%b;var A=E/b|0;(l=w[E])&&(l=h.normalize(l.Cc),g.fillStyle="rgba("+l+","+x+",0,1)",g.fillRect(T*p+u,A*p+u,p,p))}b=g,x=p,w=u,E=y+2*p,p=y+2*p,T=T=3,zr((A=g.getImageData(w,u,E,p)).data,x,E,p,T),b.putImageData(A,w,u)}for(i=g.getImageData(0,0,m,m),n=c.Cy,o=c.$A,v=0,m=(h=i.data).length;v<m;v+=4)f=h[v],d=h[v+1],4===n.length&&(f=0),h[v]=n[4*f],h[v+1]=n[4*f+1],h[v+2]=n[4*f+2],h[v+3]=n[4*f+3]*(o?d/255:10>d?0:1);g.putImageData(i,0,0),y=(c=new Cr(c.Ec,y)).size,s.drawImage(c.canvas,y,y,y,y,0,0,a,a),r.call(t,e)},Sr.prototype.mg=function(t,e,r){var i=t.data;t=i[3],i=i[4],r?i():t(e)},Sr.prototype.Zs=function(t,e){var r;if(!fb(t))throw new C(this.Zs,0,t);if(r=t.length){for(;r--;)this.Bi.zc(t[r]);var i;r=(t=this.Bi).gs;var n=t.cf,o=0;if(t.Ra===Tr){var a=r[t.cf].Qh;for(i=t.cf;0<=i&&r[i].Qh===a;i--)o=i;for(a=r[0].Qh,i=0;i<=o&&a===r[i].Qh;i++)n=i;o>t.oj&&(o=t.oj),a=Math.round(n+(o-n)/2),t.bu=Mr/Math.log(r[a].Iq)}this.reload(!!e)}},Sr.prototype.addData=Sr.prototype.Zs,Sr.prototype.clear=function(){this.Bi.clear(),this.reload(!0)},Sr.prototype.clear=Sr.prototype.clear;var Tr=0,Hr=1;function Ur(t,e){this.Ya=t,this.Pe=e}function Vr(t){return new xe(t[1],t[0])}function Xr(t){for(var e,r=Wr(t[0]),i=[],n=1,o=t.length;n<o;n++)e=Wr(t[n]),i.push(e);return new L(r,i)}function Wr(t){for(var e=0,r=t.length,i=new J;e<r;e++)i.tg(Vr(t[e]));return i}function Yr(t,e){e=e||{},this.Ya=e.style||this.gh,(this.Pe=!!e.disableLegacyMode)||window.console.warn("H.data.geojson.Reader: Legacy parser is enabled in GeoJSON Reader. Features like Multi-Geometries, Polygon interiors and GeoJSON feature properties might not work as expected. To maximise compatibility with the remote services it is recommended to set the `disableLegacyMode` flag to true."),kr.call(this,t)}function Zr(t){var e={};if(t.geometry){var r=t.geometry;e.type=r.type,e.properties=t.properties,r.coordinates&&(e.coordinates=r.coordinates),r.geometries&&(e.geometries=r.geometries),t.id&&(e.id=t.id)}return e}function $r(t){var e;Ac.call(this),this.fc=[],t?Sa(e={},as,t):e=as,this.options=e,Ac.call(this)}Ur.prototype.create=function(t,e){var r=t.coordinates;switch(t.type){case"Point":var i=new hi(Vr(r));break;case"LineString":i=new Bm(Wr(r));break;case"Polygon":i=new ng(Xr(r));break;case"MultiPoint":var n=0,o=r.length;if(i=[],this.Pe){for(;n<o;n++)i.push(Vr(r[n]));r=new hi(new ei(i))}else{for(;n<o;n++)i.push(new hi(Vr(r[n])));(r=new T).kd(i)}i=r,o="multiPoint";break;case"MultiLineString":if(n=0,o=r.length,i=[],this.Pe){for(;n<o;n++)i.push(Wr(r[n]));r=new Bm(new ii(i))}else{for(;n<o;n++)i.push(new Bm(Wr(r[n])));(r=new T).kd(i)}i=r,o="multiLineString";break;case"MultiPolygon":if(i=[],n=0,o=r.length,this.Pe){for(;n<o;n++)i.push(Xr(r[n]));r=new ng(new mg(i))}else{for(;n<o;n++)i.push(new ng(Xr(r[n])));(r=new T).kd(i)}i=r,o="multiPolygon";break;case"GeometryCollection":r=i=new T,o=0;for(var a=(n=t.geometries).length;o<a;o++)this.create(n[o],r);o="geometryCollection"}return i&&(r=i,n=t.properties,t=t.id,a={},n&&(this.Pe?a=n:a.properties=n),o&&!this.Pe&&(a[o]=!0),t&&r.Zr(t),r.setData(a),this.Ya(i)),e&&i&&e.Y(i),i},Ur.prototype.create=Ur.prototype.create,u(Yr,kr),t("H.data.geojson.Reader",Yr),Yr.prototype.lj=function(t){var e,r;try{var i="string"==typeof t?JSON.parse(t):t;if("object"==typeof i){var n=new Ur(this.Ya,this.Pe);switch(i.type){case"FeatureCollection":if(e=i.features){var o=new T;for(this.Rg(o),r=0;r<e.length;r++){var a=Zr(e[r]);(a=n.create(a))&&o.Y(a)}}break;case"Feature":a=Zr(i),(a=n.create(a))&&this.Rg(a);break;default:(a=n.create(i))&&this.Rg(a)}this.F(lr.READY)}else this.F(lr.ERROR,x,"Invalid syntax")}catch(t){this.F(lr.ERROR,x,"Parse error. "+t.message)}},Yr.prototype.qC=function(t){this.F(lr.LOADING),this.lj(t)},Yr.prototype.parseData=Yr.prototype.qC,Yr.prototype.gh=function(){},Yr.prototype.Rg=function(t){this.be&&this.be.sd().Y(t),this.gj.push(t),this.F(lr.VISIT,t)},t("H.data.buildInfo",(function(){return bn("H-data","1.60.0","2c2ebf2",{region:"row"})})),Re.prototype.Ae=da(1,(function(t,e){this.root.Ae(t,jb(e)?e:this.Ph)})),Ve.prototype.Ae=da(0,(function(t,e){var r,i=0;if(!t(this)&&e--)for(;3>=i;i++)(r=this[i])&&r.Ae(t,e)})),t("H.clustering.DataPoint",(function(t,e,r,i){this.lat=t,this.lng=e,this.wt=r===+r?r:1,this.data=i})),u($r,Ac);var bs={clusters:[],noisePoints:[]},as={projection:Jh,min:0,max:22,eps:32,minWeight:2};function cs(t){this.oa=t,this.qy=11;var e=(t=document.createElement("canvas")).getContext("2d"),r=this.oa,i=14*r;t.width=i,t.height=i,e.scale(r,r),e.beginPath(),e.strokeStyle="#FFFFFF",e.fillStyle="#1080DD",e.arc(7,7,6,0,2*Math.PI,!1),e.fill(),e.lineWidth=1,e.stroke(),this.OB=new bi(t,{size:{w:14,h:14},anchor:{x:7,y:7}}),this.ot={},this.pt={}}function ds(t,e,r){var i,n=document.createElement("canvas"),o=n.getContext("2d"),a=t.oa,s=e*a;return n.width=s,n.height=s,o.scale(a,a),a=e+":"+r,(i=t.ot[a])?o.putImageData(i,0,0):(e/=2,o.beginPath(),o.strokeStyle="rgba("+r+",0.2)",o.fillStyle="rgba("+r+",1)",o.arc(e,e,e/5*3,0,2*Math.PI,!1),o.fill(),o.lineWidth=e/5*4,o.stroke(),t.ot[a]=o.getImageData(0,0,s,s)),n}function es(t,e,r,i,n,o){this.Co=e,t&&(this.parent=t,1&e?(r=t[8],n=t[5]):(r=t[7],n=t[8]),2&e?(i=t[9],o=t[6]):(i=t[4],o=t[9])),this[7]=r,this[5]=n,this[8]=(r+n)/2,this[4]=i,this[6]=o,this[9]=(i+o)/2}function fs(t,e,r,i){var n,o;if(!e(t,i)&&r--)for(++i,n=0;4>n;n++)(o=t[n])&&fs(o,e,r,i)}function gs(t){this.Ph=t||10,this.Ck=this.Bk=this.Zi=this.Yi=2147483648,this.Em()}function hs(t,e){var r,i;for(r=0;4>r;r++)(i=e[r])&&(hs(t,i),delete e[r]);delete e.parent,delete e.entries}function is(t,e,r,i){this[0]=e,this[1]=t,this.weight=r,this.data=i}function js(t,e,r){this.qa=t,this.dm=e,this.ee=r}function ks(t,e,r,i){this.qa=t,this.uc=e,this.ee=r,this.Jq=i,this.wp=Ia(this.wp,this),this.up=Ia(this.up,this)}function ls(t){$r.call(this,t),t=this.options,this.me=t.projection,this.hk=t.min,this.fg=t.max,this.Bv=t.minWeight,this.hh=7-md(qd(ld(1,t.eps))/Ad),this.vr=new gs(ld(this.hk,this.fg+this.hh))}function ms(t,e,r,i,n,o,a){var s,l=e.Gc;if(a&&(a.node.Gc!==l?(o.clusters.push(new ks(t,a.node,a.depth,r-1)),a=null):n++),a||(l>=t.Bv?(a={node:e,depth:r},n=r):ns(t,e,n+1,o)),e.hb&&i--)for(r++,l=0;4>l;l++)(s=e[l])&&(ms(t,s,r,i,n,o,a),a=null);a&&o.clusters.push(new ks(t,a.node,a.depth,t.fg+t.hh))}function ns(t,e,r,i){var n;if(e=e.entries){var o=e.length;for(i=i.noisePoints,n=0;n<o;n++)i.push(new js(t,e[n],r))}else for(n=0;4>n;n++)(o=t[n])&&ns(t,o,r,i)}function os(t,e){this.ir=t,this.ee=e}function ps(t,e,r){this.Jq=this.ee=r,this.jr=[],this.us=0,this.J=Ee(t,e,!0)}function qs(t){$r.call(this,t)}function rs(t){if($r.call(this,t),(t=this.options).projection!==Jh)throw new C(rs,0,"Other projection than mercator not supported yet");this.me=t.projection,this.lp=t.eps,this.JB=t.minWeight,this.ew=new Kh(this.me),(new Li).registerProcessor("cluster","H.clustering.dynamicgrid.worker"),this.hg=z(this.hg,this),this.Pq=z(this.Pq,this)}m=$r.prototype,m.ve=function(t){this.fc=t,this.qd=!0},m.zc=function(t){this.fc.push(t),this.qd=!0},m.Al=function(t){this.fc=this.fc.concat(t),this.qd=!0},m.Dk=function(t){this.fc=this.fc.filter((function(e){return e!==t})),this.qd=!0},m.disposeInternal=function(){$r.g.disposeInternal.call(this),delete this.fc},$r.prototype.disposeInternal=$r.prototype.disposeInternal,$r.prototype.Pw=ie,t("H.clustering.theme.Circular",cs),cs.prototype.Az=function(t){var e=t.Xd(),r=this.pt[e];if(!r){if(10>e){r=ds(this,28,"118,209,0");var i={x:11,y:18}}else 25>e?(r=ds(this,38,"255,105,0"),i={x:13,y:23}):50>e?(r=ds(this,38,"240,60,0"),i={x:13,y:23}):100>e?(r=ds(this,38,"181,0,21"),i={x:13,y:23}):1e3>e?(r=ds(this,48,"181,0,21"),i={x:15,y:28}):(r=ds(this,66,"181,0,21"),i={x:20,y:38});var n=r.getContext("2d");n.fillStyle="#FFFFFF",n.font="bold "+this.qy+"px Arial",n.fillText(String(e),i.x,i.y),r=new bi(r,{size:{w:i=r.width/this.oa,h:i},anchor:{x:i/2,y:i/2}}),this.pt[e]=r}return(e=new hi(t.ya(),{icon:r,min:t.Td(),max:t.om()})).setData(t),e},cs.prototype.getClusterPresentation=cs.prototype.Az,cs.prototype.kA=function(t){var e=new hi(t.ya(),{icon:this.OB,min:t.Td()});return e.setData(t),e},cs.prototype.getNoisePresentation=cs.prototype.kA,m=es.prototype,m.hb=0,m.th=function(t){return this[t]||(++this.hb,this[t]=new es(this,t))},m.removeChild=function(t){var e=t.Co;this[e]===t&&(delete this[e],delete t.parent,--this.hb)},m.Ae=function(t,e){for(var r=0,i=this;i=i.parent;)++r;fs(this,t,e,r)},m.Qg=function(t){(this.entries||(this.entries=[])).push(t)},m.dj=0,m.ej=0,m.Gc=0,m=gs.prototype,m.Em=function(){this.head=this.root=new es(null,NaN,this.Yi-this.Bk,this.Zi-this.Ck,this.Yi+this.Bk,this.Zi+this.Ck)},m.Ll=function(){hs(this,this.root),this.Em()},m.ld=function(t){var e,r=this.head;if(t){var i=t;if(i!==r)for(r=i;i=i.parent;)(i.entries||1<i.hb)&&(r=i)}else for(;!r.entries&&2>(e=r.hb)&&e;)r=i;this.head=r},m.Zd=function(t,e,r,i){var n=this.root;if(!(t>=n[7]&&e>=n[4]&&t<=n[5]&&e<=n[6]))throw Error("Coordinates out of bounds");return this.Vb(this.root,t,e,r,this.Ph,i)},m.Vb=function(t,e,r,i,n,o){var a=t.entries;return n?t.hb?a=this.Sj(t,e,r,i,n,o):a?(a=a[0],(a=t.th(+(a[1]>=t[8])|+(a[0]>=t[9])<<1)).entries=t.entries,a.dj=t.dj,a.ej=t.ej,a.Gc=t.Gc,a.dh=t.dh,a.cj=t.cj,a.aj=t.aj,a.bj=t.bj,delete t.entries,this.ld(a),a=this.Sj(t,e,r,i,n,o)):(t.Qg(a=new is(e,r,i,o)),this.ld(t)):(a||this.ld(t),t.Qg(a=new is(e,r,i,o))),t.dj+=e*i,t.ej+=r*i,t.Gc+=i,t.dh===A?(t.dh=t.aj=e,t.cj=t.bj=r):(e<t.dh?t.dh=e:e>t.aj&&(t.aj=e),r<t.cj?t.cj=r:r>t.bj&&(t.bj=r)),a},m.Sj=function(t,e,r,i,n,o){return this.Vb(t.th(+(e>=t[8])|+(r>=t[9])<<1),e,r,i,n-1,o)},m.Ae=function(t,e){fs(this.root,t,e===+e?e:this.Ph,0)},t("H.clustering.fastgrid.NoisePoint",js),js.prototype.ya=function(){return this.Uc||(this.Uc=this.qa.Za(this.dm[1],this.dm[0],1)),this.Uc},js.prototype.getPosition=js.prototype.ya,js.prototype.Xd=function(){return this.dm.weight},js.prototype.getWeight=js.prototype.Xd,js.prototype.Zf=he,js.prototype.isCluster=js.prototype.Zf,js.prototype.Td=function(){return this.ee-this.qa.hh},js.prototype.getMinZoom=js.prototype.Td,js.prototype.getData=function(){return this.dm.data},js.prototype.getData=js.prototype.getData,t("H.clustering.fastgrid.Cluster",ks),ks.prototype.ya=function(){return this.Uc||(this.Uc=this.qa.Za(this.uc.dj,this.uc.ej,this.uc.Gc)),this.Uc},ks.prototype.getPosition=ks.prototype.ya,ks.prototype.Xd=function(){return this.uc.Gc},ks.prototype.getWeight=ks.prototype.Xd,ks.prototype.Zf=ge,ks.prototype.isCluster=ks.prototype.Zf,ks.prototype.Td=function(){return this.ee?this.ee-this.qa.hh:-1/0},ks.prototype.getMinZoom=ks.prototype.Td,ks.prototype.om=function(){return this.Jq-this.qa.hh},ks.prototype.getMaxZoom=ks.prototype.om,ks.prototype.C=function(){return this.J||(this.J=Ee(this.qa.Za(this.uc.dh,this.uc.cj,1),this.qa.Za(this.uc.aj,this.uc.bj,1),!0)),this.J},ks.prototype.getBoundingBox=ks.prototype.C,ks.prototype.vp=function(t){this.$t=t,this.uc.Ae(this.wp,Id)},ks.prototype.forEachEntry=ks.prototype.vp,ks.prototype.wp=function(t,e){var r,i,n=!1;if(t.Gc>=this.qa.Bv&&t!==this.uc&&t.Gc!==this.uc.Gc&&(this.$t(new ks(this.qa,t,0,e)),n=!0),!n&&(r=t.entries))for(t=r.length,i=0;i<t;i++)this.$t(new js(this.qa,r[i],e));return n},ks.prototype.zj=function(t){this.jz=t,this.uc.Ae(this.up,Id)},ks.prototype.forEachDataPoint=ks.prototype.zj,ks.prototype.up=function(t,e){var r;if(t=t.entries){var i=t.length;for(r=0;r<i;r++)this.jz(new js(this.qa,t[r],e))}return!1},u(ls,$r),m=ls.prototype,m.ve=function(t){var e,r=0,i=t.length,n=new K(0,0),o=this.me,a=this.vr;for(ls.g.ve.call(this,t),a.Ll();r<i;r++)o.Se(e=t[r],n).scale(4294967296).floor(),a.Zd(n.x,n.y,e.wt,e.data);this.qd=!0},m.zc=function(t){ls.g.zc.call(this,t),this.ve(this.fc)},m.Al=function(t){for(var e=t.length,r=ls.g.zc;e--;)r.call(this,t[e]);this.ve(this.fc)},m.Dk=function(t){ls.g.Dk.call(this,t),this.ve(this.fc)},m.Za=function(t,e,r,i){return this.me.Za(t/r/4294967296,e/r/4294967296,i)},m.es=function(t){if(this.qd){var e={clusters:[],noisePoints:[]};ms(this,this.vr.root,0,this.fg+this.hh,-1/0,e,null),this.qd=!1,t(e)}},m.disposeInternal=function(){ls.g.disposeInternal.call(this),this.vr=null},ls.prototype.disposeInternal=ls.prototype.disposeInternal,t("H.clustering.grid.NoisePoint",os),os.prototype.ya=function(){return ze(this.ir)},os.prototype.getPosition=os.prototype.ya,os.prototype.Xd=function(){return this.ir.wt},os.prototype.getWeight=os.prototype.Xd,os.prototype.Zf=he,os.prototype.isCluster=os.prototype.Zf,os.prototype.Td=function(){return this.ee},os.prototype.getMinZoom=os.prototype.Td,os.prototype.getData=function(){return this.ir.data},os.prototype.getData=os.prototype.getData,t("H.clustering.grid.Cluster",ps),ps.prototype.Pi=function(t){this.Uc||(this.Uc=ze(t)),this.us+=t.wt||1,this.jr.push(t)},ps.prototype.ya=function(){return this.Uc},ps.prototype.getPosition=ps.prototype.ya,ps.prototype.Xd=function(){return this.us},ps.prototype.getWeight=ps.prototype.Xd,ps.prototype.Zf=ge,ps.prototype.isCluster=ps.prototype.Zf,ps.prototype.Td=function(){return this.ee},ps.prototype.getMinZoom=ps.prototype.Td,ps.prototype.om=function(){return this.Jq},ps.prototype.getMaxZoom=ps.prototype.om,ps.prototype.C=function(){return this.J},ps.prototype.getBoundingBox=ps.prototype.C,ps.prototype.vp=function(t){this.zj(t)},ps.prototype.forEachEntry=ps.prototype.vp,ps.prototype.zj=function(t){var e=this;if(!Za(t))throw new C(this.zj,0,t);this.jr.forEach((function(r){t(new os(r,e.ee+1))}))},ps.prototype.forEachDataPoint=ps.prototype.zj,u(qs,$r),qs.prototype.es=function(t){var e,r=this.options,i=r.min,n=r.max,o=[],a=[];if(this.qd){for(e=this.fc;i<=n;i++){for(var s,l,u,c,h,p,f,d,y=void 0,g=i,v=e,m=o,_=a,b=r.eps,x=r.projection,w=r.minWeight,E=v.length,T=Math.pow(2,g+8),A=[];d=v[--E];)if(!d.Bs){for(f=T,p=(u=x.Se(d).scale(T).floor()).x,h=u.y,l=A.length;l--;)c=(s=A[l]).ya(),s.zs||(s.zs=x.Se(c).scale(T).floor()),(c=(c=s.zs).kb(u))<f&&(f=c,y=s);y&&y.C().Gf(d)||(y=new ps(x.wn({x:(p-b)/T,y:(h-b)/T}),x.wn({x:(p+b)/T,y:(h+b)/T}),g),A.push(y)),y.Pi(d),y=null}for(E=A.length;E--;)if((l=(s=A[E]).Xd())<w)for(l=(s=s.jr).length;d=s[--l];)_.push(new os(d,g)),d.Bs=!0;else m.push(s)}for(i=0,n=e.length;i<n;i++)delete e[i].Bs;this.qd=!1,t({clusters:o,noisePoints:a})}},u(rs,$r),rs.prototype.Pw=function(t,e){this.Ky=t,this.Ly=nd(e)},rs.prototype.es=function(t,e){var r=this.Lg,i=this.Ky,n=this.Ly||0,o=!r||!(r.zoom===n&&r.Si.da(i));if(i&&(this.qd||o)){if(r&&3>r.state&&r.cancel(),this.qd=!1,(r=this.lp)>=128*sd(2,n))var a=ss;else{(o=this.ew).Va(n);var s=o.Gb(i.Oc());a=o.Gb(i.Mc()),s.y-=r,a.y+=r,s=o.sk(s);var l=o.sk(a);a=new I(s.lat,s.lng,l.lat,l.lng),r=o.Za(r,0).lng+180,a=a.de(s.lat,s.lng-r,l.lat,s.lng).de(s.lat,l.lng,l.lat,l.lng+r)}for(r=a,a=[],o=(s=this.fc).length;o--;)r.Gf(s[o])&&a.push(s[o]);0<a.length?(this.Lg=new ts(i,n,a,this.lp,this.JB,this.me!==Jh,t,e),this.Lg.then(this.hg,this.Pq)):t(bs)}},rs.prototype.hg=function(t){Ca(t)||(t=new globalThis.Uint32Array(t));for(var e=this.Lg,r=e.gC,i=0,n=t[i++],o=Array(n),a=0,s=[],l=t.length,u=this.Lg.Ny,c=this.Lg.zoom;n--;)o[a++]=new os(u[t[i++]],c);for(;i<l;){n=t[i++],a=u[t[i]];var h=this.ew,p=this.lp;h.Va(this.Lg.zoom);var f=h.Gb(a);for(a=h.Za(f.x-p,f.y-p),h=h.Za(f.x+p,f.y+p),a=new ps((a=new I(a.lat,a.lng,h.lat,h.lng)).Oc(),a.Mc(),c);n--;)a.Pi(u[t[i++]]);s.push(a)}r.call(e,{clusters:s,noisePoints:o})},rs.prototype.Pq=function(t){gb(t)&&this.Lg.XB(t)};var ss=new I(90,-180,-90,180);function ts(t,e,r,i,n,o,a,s){this.Si=t,this.zoom=e,this.Ny=r,this.gC=a,this.XB=s,a=3*(t=r.length),s=new(globalThis.Float64Array||Array)(a);for(var l;t--;)l=r[t],s[--a]=l.lat,s[--a]=l.lng,s[--a]=l.wt;uc.call(this,"cluster",{message:[s,i,n,e,o]},void 0)}function us(t,e){var r={},i=(e=e||{}).min||0;switch(i={min:i,max:ld(i,e.max||22)},us.g.constructor.call(this,i),this.oa=e.pixelRatio||Vd(),Sa(r,as,i,e.clusteringOptions||{}),r.minWeight=ld(as.minWeight,r.minWeight),r.strategy){case vs.DYNAMICGRID:if(r.projection!==Jh)throw new C(us,1,"Unsupported projection");this.qa=new rs(r);break;case vs.GRID:this.qa=new qs(r);break;default:this.qa=new ls(r)}this.qa.ve(t),this.fl=e.theme||new cs(this.oa),this.No=z(this.No,this),this.hg=z(this.hg,this),ws(this)}rs.prototype.disposeInternal=function(){rs.g.disposeInternal.call(this)},rs.prototype.disposeInternal=rs.prototype.disposeInternal,u(ts,Ni),u(us,P),t("H.clustering.Provider",us),us.prototype.disposeInternal=function(){us.g.disposeInternal.call(this),this.Bg.ia(),this.qa.l(),delete this.qa,delete this.Qm,delete this.fl,globalThis.clearTimeout(this.hp)};var vs={FASTGRID:0,GRID:1,DYNAMICGRID:2};function ws(t,e,r){t.hp&&globalThis.clearTimeout(t.hp),e&&t.qa.Pw(e,r),t.hp=globalThis.setTimeout(t.No,t.ey)}function xs(t){var e=t.Qm.clusters,r=t.Qm.noisePoints,i=e.length,n=r.length,o=0<i+n;for(t.Bg.ia();n--;){var a=r[n];t.Bg.Y(t.fl.getNoisePresentation(a))}for(;i--;)r=e[i],t.Bg.Y(t.fl.getClusterPresentation(r));o&&t.jb()}function ys(t,e){t:{for(var r=t.length,i="string"==typeof t?t.split(""):t,n=0;n<r;n++)if(n in i&&e.call(void 0,i[n],n,t)){e=n;break t}e=-1}return 0>e?null:"string"==typeof t?t.charAt(e):t[e]}us.Strategy=vs,us.prototype.ey=150,us.prototype.No=function(){this.dispatchEvent("start"),this.qa.es(this.hg,ie)},us.prototype.hg=function(t){this.Qm=t,xs(this),this.dispatchEvent("end")},us.prototype.ve=function(t){this.qa.ve(t),ws(this)},us.prototype.setDataPoints=us.prototype.ve,us.prototype.zc=function(t){this.qa.zc(t),ws(this)},us.prototype.addDataPoint=us.prototype.zc,us.prototype.Al=function(t){this.qa.Al(t),ws(this)},us.prototype.addDataPoints=us.prototype.Al,us.prototype.Dk=function(t){this.qa.Dk(t),ws(this)},us.prototype.removeDataPoint=us.prototype.Dk,us.prototype.GA=function(){return this.fl},us.prototype.getTheme=us.prototype.GA,us.prototype.bD=function(t){this.fl=t,this.Qm&&(this.Bg.ia(),xs(this))},us.prototype.setTheme=us.prototype.bD,us.prototype.Vc=function(){return!0},us.prototype.providesDomMarkers=us.prototype.Vc,us.prototype.Wc=function(){return!0},us.prototype.providesMarkers=us.prototype.Wc,us.prototype.ne=function(){return!0},us.prototype.providesSpatials=us.prototype.ne,us.prototype.xk=function(t,e){ws(this,t,e)},us.prototype.preprocessData=us.prototype.xk,t("H.clustering.buildInfo",(function(){return bn("H-clustering","1.60.0","2c2ebf2",{region:"row"})}));var zs={};function As(t){var e=t.ownerDocument,r=e.documentElement;e=e.defaultView;var i=t.getBoundingClientRect();return t=i.left,i=i.top,isNaN(e.pageXOffset)?(t+=r.scrollLeft,i+=r.scrollTop):(t+=e.pageXOffset,i+=e.pageYOffset),new K(t,i)}function Bs(t,e,r){e=jb(e)?e+"px":e,r=jb(r)?r+"px":r,t.style[Vi("transform")]="translate("+e+","+r+")"}var Cs,Ds=navigator.userAgent,Es=-1<Ds.indexOf("Android")&&-1<Ds.indexOf("Mozilla/5.0")&&-1<Ds.indexOf("AppleWebKit"),Fs=/AppleWebKit\/([\d.]+)/,Gs=null===Fs.exec(Ds)?null:parseFloat(Fs.exec(Ds)[1]);Cs=Es&&null!==Gs&&537>Gs;var Hs=document.createElement("T");function Is(){this.$w=this.Gt()}Is.prototype.Gt=function(){var t=navigator,e=[];return t&&(t.msPointerEnabled?e.push(Js):t.pointerEnabled&&e.push(Ks)),1>e.length&&("TouchEvent"in globalThis&&e.push(Ls),e.push(Ms)),e.push(Ns),e},Is.prototype.detectEventSets=Is.prototype.Gt,Is.prototype.addEventListener=function(t,e,r,i){for(var n,o=this.$w,a=o.length,s=!1;a--;)(n=o[a][e])&&(s=!0,t.addEventListener(n,r,i||!1));s||t.addEventListener(e,r,i||!1)},Is.prototype.removeEventListener=function(t,e,r,i){for(var n,o=this.$w,a=o.length,s=!1;a--;)(n=o[a][e])&&(s=!0,t.removeEventListener(n,r,i||!1));s||t.removeEventListener(e,r,i||!1)};var Ks={start:"pointerdown",end:"pointerup",move:"pointermove",cancel:"pointercancel",over:"pointerover",out:"pointerout",hover:"pointerhover"},Js={start:"MSPointerDown",end:"MSPointerUp",move:"MSPointerMove",cancel:"MSPointerCancel",over:"MSPointerOver",out:"MSPointerOut",hover:"MSPointerHover"},Ls={start:"touchstart",end:"touchend",move:"touchmove",cancel:"touchcancel"},Ms={start:"mousedown",end:"mouseup",move:"mousemove",over:"mouseover",out:"mouseout",hover:"mousehover"},Ns={start:"keydown",end:"keyup"};function Os(t){return!(t instanceof KeyboardEvent)||"Enter"===t.code}function Ps(t,e,r,i){return t=t.createElement(e),r&&(t.className=r),i&&(t.innerHTML=i),t}function Qs(t,e){for(var r=1,i=arguments.length;r<i;r++)t.appendChild(arguments[r])}var Rs=new Is;function Ss(t,e,r){Rs.addEventListener(t,e,r,void 0)}function Ts(t,e,r){Rs.removeEventListener(t,e,r,void 0)}function Y(t,e){E.call(this),this.Ra=t||"div",this.Me=e?e.split(" "):[],this.ub=!1,this.Me.push("H_el")}function Us(t){(t=t.B())&&t.parentNode&&t.parentNode.removeChild(t)}function Vs(t,e,r){Y.call(this,t,e),this.dc=r?[].concat(r):[]}u(Y,E),t("H.ui.base.Element",Y),Y.prototype.L=function(t){if(!t)throw Error("Wrong document object");return this.G=Ps(t,this.Ra,this.Me.join(" ")),this.renderInternal(this.G,t),this.wa(this.ub,!0),this.Gd(this.zx),this.Zb(this.Ld),this.uf(this.lx),this.G},Y.prototype.subscribe=function(){},Y.prototype.unsubscribe=function(){},Y.prototype.N=function(){},Y.prototype.renderInternal=Y.prototype.N,Y.prototype.mq=function(){return this.ub},Y.prototype.isDisabled=Y.prototype.mq,Y.prototype.wa=function(t,e){return((t=!!t)!==this.ub||e)&&((this.ub=t)?this.Ha("H_disabled"):this.Bb("H_disabled")),this},Y.prototype.setDisabled=Y.prototype.wa,Y.prototype.ep=null,Y.prototype.getData=function(){return this.ep},Y.prototype.getData=Y.prototype.getData,Y.prototype.setData=function(t){this.ep=t},Y.prototype.setData=Y.prototype.setData,Y.prototype.Gd=function(t){var e=this.B();this.zx=t,e&&(t?(e.setAttribute("title",t),e.setAttribute("aria-label",t)):(e.removeAttribute("title"),e.removeAttribute("aria-label")))},Y.prototype.setTooltip=Y.prototype.Gd,Y.prototype.G=null,Y.prototype.B=function(){return this.G},Y.prototype.getElement=Y.prototype.B,Y.prototype.Ld=!0,Y.prototype.Zb=function(t){var e=this.B();this.Ld=t,e&&(e.style.display=t?"":"none")},Y.prototype.setVisibility=Y.prototype.Zb,Y.prototype.Wd=function(){return this.Ld},Y.prototype.getVisibility=Y.prototype.Wd,Y.prototype.lx=-1,Y.prototype.uf=function(t){this.lx=t;var e=this.B();e&&(e.tabIndex=t)},Y.prototype.setTabIndex=Y.prototype.uf,Y.prototype.Ha=function(t){var e=this.B();return 0>this.Me.indexOf(t)&&this.Me.push(t),e&&(e.className=this.Me.join(" ")),this},Y.prototype.addClass=Y.prototype.Ha,Y.prototype.Bb=function(t){t=this.Me.indexOf(t);var e=this.B();return-1<t&&this.Me.splice(t,1),e&&(e.className=this.Me.join(" ")),this},Y.prototype.removeClass=Y.prototype.Bb,Y.prototype.disposeInternal=function(){Y.g.disposeInternal.call(this),Us(this),this.ep=this.G=null,delete this.zx},u(Vs,Y),t("H.ui.base.Container",Vs),Vs.prototype.wa=function(t,e){var r=this.dc?this.dc.length:0;for(Y.prototype.wa.call(this,t,e);r--;)this.dc[r].wa(t,e);return this},Vs.prototype.setDisabled=Vs.prototype.wa,Vs.prototype.Sa=function(t){var e=this.B();return this.dc.push(t),e&&(t.L(e.ownerDocument),e.appendChild(t.B())),this},Vs.prototype.addChild=Vs.prototype.Sa,Vs.prototype.Dj=function(){return[].concat(this.dc)},Vs.prototype.getChildren=Vs.prototype.Dj,Vs.prototype.removeChild=function(t){var e=this.dc.indexOf(t),r=this.B();0<=e&&(this.dc.splice(e,1),r&&r.removeChild(t.B()))},Vs.prototype.removeChild=Vs.prototype.removeChild,Vs.prototype.ia=function(){var t=this.B();t&&this.dc.forEach((function(e){t.removeChild(e.B())})),this.dc=[]},Vs.prototype.N=function(t,e){for(var r=0,i=this.dc.length;r<i;r++)t.appendChild(this.dc[r].L(e))},Vs.prototype.renderInternal=Vs.prototype.N,Vs.prototype.disposeInternal=function(){this.ia(),this.dc.forEach(this.Yy,this),Y.prototype.disposeInternal.call(this)},Vs.prototype.Yy=function(t){t.l()};var Ws={TOP_LEFT:"top-left",TOP_CENTER:"top-center",TOP_RIGHT:"top-right",LEFT_TOP:"left-top",LEFT_MIDDLE:"left-middle",LEFT_BOTTOM:"left-bottom",RIGHT_TOP:"right-top",RIGHT_MIDDLE:"right-middle",RIGHT_BOTTOM:"right-bottom",BOTTOM_LEFT:"bottom-left",BOTTOM_CENTER:"bottom-center",BOTTOM_RIGHT:"bottom-right"};function Xs(){Vs.call(this,"div","H_ctl"),this.map=null,this.Fe="top-left"}function Ys(t){t=t||{},Y.call(this,"div","H_btn"),this.xe(t.label||" "),this.Gd(t.tooltip||""),this.setData(t.data),this.wa(!!t.disabled),this.uf(0),this.F(Zs.UP,!0),t.onStateChange&&this.addEventListener("statechange",t.onStateChange),this.cn=z(this.cn,this),this.Vh=z(this.Vh,this)}t("H.ui.LayoutAlignment",Ws),u(Xs,Vs),t("H.ui.Control",Xs),Xs.prototype.Qa=function(t){this.map=t},Xs.prototype.L=function(t){return Vs.prototype.L.call(this,t)},Xs.prototype.N=function(t,e){Vs.prototype.renderInternal.call(this,t,e),this.$c(this.Fe)},Xs.prototype.renderInternal=Xs.prototype.N,Xs.prototype.qk=function(){},Xs.prototype.onUnitSystemChange=Xs.prototype.qk,Xs.prototype.lc=function(){return this.map},Xs.prototype.getMap=Xs.prototype.lc,Xs.prototype.ma=function(){return this.xB},Xs.prototype.getLocalization=Xs.prototype.ma,Xs.prototype.sz=function(){return this.Fe},Xs.prototype.getAlignment=Xs.prototype.sz,Xs.prototype.$c=function(t){return"string"==typeof t&&Ws[t.replace("-","_").toUpperCase()]===t&&(this.Fe=t,this.dispatchEvent("alignmentchange")),this},Xs.prototype.setAlignment=Xs.prototype.$c,u(Ys,Y),t("H.ui.base.Button",Ys),Ys.prototype.wa=function(t,e){return t&&this.Bb("H_active"),Ys.g.wa.call(this,t,e)},Ys.prototype.setDisabled=Ys.prototype.wa,Ys.prototype.N=function(t){Ss(t,"start",this.cn),Ss(t,"end",this.Vh),Ss(t,"out",this.Vh),this.xe(this.Wb,!0)},Ys.prototype.renderInternal=Ys.prototype.N,Ys.prototype.getState=function(){return this.s},Ys.prototype.getState=Ys.prototype.getState,Ys.prototype.F=function(t,e){return t!==this.s&&(this.s=t,t===Zs.DOWN?this.Ha("H_active"):this.Bb("H_active"),e||this.dispatchEvent("statechange")),this},Ys.prototype.setState=Ys.prototype.F,Ys.prototype.Gp=function(){return this.Wb},Ys.prototype.getLabel=Ys.prototype.Gp,Ys.prototype.xe=function(t,e){return(e||t!==this.Wb)&&(this.Wb=t,(e=this.B())&&(e.innerHTML=t)),this},Ys.prototype.setLabel=Ys.prototype.xe,Ys.prototype.cn=function(t){!this.ub&&Os(t)&&(this.F(Zs.DOWN),t.preventDefault())},Ys.prototype.Vh=function(t){!this.ub&&Os(t)&&(this.F(Zs.UP),t.preventDefault())},Ys.prototype.disposeInternal=function(){var t=this.B();t&&(Ts(t,"start",this.cn),Ts(t,"end",this.Vh),Ts(t,"out",this.Vh)),Y.prototype.disposeInternal.call(this)};var Zs={UP:"up",DOWN:"down"};function $s(t){Ys.call(this,t),this.WB=function(t){Os(t)&&t.preventDefault()},this.je=z((function(t){!this.ub&&Os(t)&&(this.toggleState(),t.preventDefault())}),this)}function at(t){t=t||{},Vs.call(this,"div","H_rdo"),this.ms=new Y("div","H_rdo_title"),this.Ti=new Vs("div","H_rdo_buttons"),this.Sa(this.ms),this.Sa(this.Ti),this.Jv=z((function(t){t.target.getState()===Zs.DOWN?(this.Nw(t.target,!0),this.dispatchEvent(bt)):t.target.F(Zs.DOWN,!0)}),this),this.addEventListener("statechange",this.Jv),this.bs(t.title||""),t.onActiveButtonChange&&this.addEventListener(bt,t.onActiveButtonChange),t.buttonsOptions&&t.buttonsOptions.forEach((function(t){this.yo(new $s(t))}),this)}Ys.State=Zs,u($s,Ys),t("H.ui.base.PushButton",$s),$s.prototype.N=function(t){Ss(t,"start",this.je),Ss(t,"end",this.WB),this.xe(this.Wb,!0)},$s.prototype.renderInternal=$s.prototype.N,$s.prototype.wx=function(){var t=Zs.DOWN;return this.F(this.getState()===t?Zs.UP:t),this},$s.prototype.toggleState=$s.prototype.wx,$s.prototype.disposeInternal=function(){var t=this.B();t&&Ts(t,"start",this.je),Ys.prototype.disposeInternal.call(this)},u(at,Vs),t("H.ui.base.RadioGroup",at);var bt="activebuttonchange";function ct(t){B(t,gd,ct,1),Y.call(this,"div","H_context_menu_item"),this.Kb=t,this.lk=z(this.lk,this),this.De=z(this.De,this),this.Kb.addEventListener("update",this.De)}at.prototype.N=function(t,e){Vs.prototype.renderInternal.call(this,t,e),this.bs(this.io,!0)},at.prototype.renderInternal=at.prototype.N,at.prototype.ia=function(){this.Ti.ia()},at.prototype.bs=function(t,e){return(t!==this.io||e)&&(this.io=t,this.ms.B()&&(this.ms.B().innerHTML=this.io)),this},at.prototype.setTitle=at.prototype.bs,at.prototype.IA=function(){return this.io},at.prototype.getTitle=at.prototype.IA,at.prototype.yo=function(t){if(!(t instanceof $s))throw Error("PushButton expected");return t.ea(this),this.Ti.Sa(t),this},at.prototype.addButton=at.prototype.yo,at.prototype.AC=function(t){return this.Ti.removeChild(t),t.ea(null),this},at.prototype.removeButton=at.prototype.AC,at.prototype.Cj=function(){return this.Ti.Dj()},at.prototype.getButtons=at.prototype.Cj,at.prototype.Nw=function(t,e){for(var r=this.Cj(),i=r.length;i--;)r[i].F(r[i]===t?Zs.DOWN:Zs.UP,e)},at.prototype.setActiveButton=at.prototype.Nw,at.prototype.disposeInternal=function(){this.removeEventListener("statechange",this.Jv),this.ia(),Vs.prototype.disposeInternal.call(this)},u(ct,Y),t("H.ui.context.Item",ct),ct.prototype.lk=function(t){var e=this.Kb,r=e.callback;r&&!e.isDisabled()&&(this.dispatchEvent("click"),r(t))},ct.prototype.N=function(){var t=this,e=this.B();Ss(e,"click",this.lk),Ss(e,"keyup",(function(e){"Enter"===e.code.code&&t.lk(e)})),this.uf(-1),this.De()},ct.prototype.renderInternal=ct.prototype.N,ct.prototype.De=function(){var t=this.B(),e=this.Kb;e.callback?this.Ha("H_clickable"):this.Bb("H_clickable"),e.isDisabled()?this.Ha("H_disabled"):this.Bb("H_disabled"),e=e.getLabel(),Hs.textContent=e,t.innerHTML=Hs.innerHTML.split("\n").join("<br/>")},ct.prototype.disposeInternal=function(){Y.prototype.disposeInternal.call(this),this.Kb.removeEventListener("update",this.De)};var dt={};function et(t){B(t,Array,et,1),Vs.call(this,"div","H_context_menu"),this.EB=t,this.v=null,this.Fc=this.Fc.bind(this)}dt=function(t,e,r){Ac.call(this),this.qh=-1,this.G=t,this.Nm=e,this.Mv=r,this.je=z(this.je,this),t.focus(),Ss(t,"keydown",this.je)},u(dt,Ac),dt.prototype.disposeInternal=function(){this.qh=-1,this.Fx(),dt.g.disposeInternal.call(this),Ts(this.G,"keydown",this.je);var t=this.Mv;this.G=this.Nm=this.Mv=null,t()},dt.prototype.je=function(t){if(t instanceof KeyboardEvent){var e=this.Nm.length-1,r=/^Arrow(Down|Up)$/.exec(t.code);r?(t={Up:-1,Down:1}[r[1]])&&(this.qh=0>this.qh&&0>t?e:Nd(this.qh+t,0,e),this.Fx()):"Enter"===t.code?(e=this.Nm[this.qh])instanceof Ys?(e.Jb()instanceof at?e.F(Zs.DOWN):e.wx(),this.l()):e instanceof ct&&(e.lk(),this.l()):"Escape"===t.code&&this.l()}},dt.prototype.Fx=function(){var t=this;this.Nm.forEach((function(e,r){r===t.qh?e.Ha("H_focused"):e.Bb("H_focused")}))},u(et,Vs),t("H.ui.context.Menu",et),et.prototype.disposeInternal=function(){et.g.disposeInternal.call(this),this.Yj&&this.Yj.l(),this.Yj=null},et.prototype.disposeInternal=et.prototype.disposeInternal,et.prototype.N=function(){Vs.prototype.N.apply(this,arguments),this.EB.forEach((function(t){t===hd?t=new Y("div","H_context_menu_item_separator"):(t=new ct(t)).addEventListener("click",this.Fc),this.Sa(t),this.uf(0)}),this),Uc(this.B(),["mousedown","touchstart","pointerdown","wheel"],(function(t){t.stopPropagation()})),this.Yj=new dt(this.B(),this.Dj().filter((function(t){return t instanceof ct&&(t=t.Kb).callback&&!t.isDisabled()})),this.Fc)},et.prototype.renderInternal=et.prototype.N,et.prototype.setPosition=function(t,e){if(this.v){var r=this.B(),i=r.offsetWidth,n=r.offsetHeight,o=this.v,a=o.sa.width;t+i>a&&t>a/2&&(t-=i),e+n>(o=o.sa.height)&&e>o/2&&(e-=n),Bs(r,t,e)}},et.prototype.setPosition=et.prototype.setPosition,et.prototype.Fc=function(){this.v&&this.v.dispatchEvent(new Fc("contextmenuclose",this.v))},et.prototype.Qa=function(t){this.v=t},et.prototype.setMap=et.prototype.Qa;var ft={btn:'<svg class="H_icon" height="24" viewBox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg"><g fill-rule="evenodd"><g transform="translate(3 2)"><path d="m18 13v7h-18v-7h2v5h2v-2h2v2h2v-3h2v3h2v-2h2v2h2v-5z"></path><path d="m2.3.3c.7 0 1.3.1 1.8.4s.9.6 1.1 1 .4.9.4 1.4c0 .5-.1 1-.3 1.4s-.57 1-1 1.6-1.3 1.3-2.3 2.2h3.9l-.2 1.7h-6.16v-1.6c1.1-1.1 2-2 2.5-2.6s.9-1 1-1.4.3-.8.3-1.2c0-.4-.1-.7-.3-.9s-.5-.3-.9-.3c-.3 0-.6 0-.9.2s-.5.4-.8.7l-1.3-1c.4-.5.9-.9 1.4-1.2s1.2-.4 1.8-.4zm14.4 9.7h-2.3l-.2-3.8c 0-.9-.1-1.7-.1-2.4 0-.5 0-1 0-1.5l-1.5 6.7h-2.2l-1.6-6.7c.1.8.1 1.6.1 2.3 0 .5 0 1.1 0 1.7l-.2 3.8h-2.2l.7-9.7h2.9l1.5 6.6 1.4-6.6h2.9z"></path></g></g></svg>',point:'<svg height="22" viewBox="0 0 12 12" width="22" xmlns="http://www.w3.org/2000/svg"><g fill="none" fill-rule="evenodd"><path d="m6 12c3.3 0 6-2.7 6-6s-2.7-6-6-6-6 2.7-6 6 2.7 6 6 6z" fill="#fff"></path><path d="m6 10c2.2 0 4-1.8 4-4s-1.8-4-4-4-4 1.8-4 4 1.8 4 4 4z" fill="#2ed5c9" stroke="#272c36" stroke-width="2"></path></g></svg>'};function gt(t,e,r){Ui.call(this,t,{icon:ht,visibility:r}),it(this,e)}function it(t,e){t.lB=e,t.G&&(t.G.textContent=e)}u(gt,Ui);var ht=new Si(Ps(globalThis.document,"span","H_dm_label"),{onAttach:function(t,e,r){r.G=t,it(r,r.lB)},onDetach:function(t,e,r){delete r.G}});function jt(t,e){E.call(this),this.Ne=t,this.Wb=new gt(this.yD,""),e.push(this.Wb),this.ud=new T({objects:e,data:this}),this.$n=this.$n.bind(this)}function kt(t,e){e&&(t.nextSibling=e,e.previousSibling=t)}function lt(t,e,r,i){var n=new J,o=[];kt(t,this),kt(this,e),n.tg(t.ya()),n.tg(e.ya()),this.Oh=new Bm(n,{style:r.Nh}),this.yu=new Bm(n,{style:{strokeColor:"transparent",lineWidth:Math.min(100,this.Oh.K().lineWidth+2*(i||5))}}),r.outlineStyle&&(this.cr=new Bm(n,{style:r.outlineStyle}),o.push(this.cr)),o.push(this.Oh,this.yu),jt.call(this,r,o),this.ev=this.dv=-1,(t=this.ud).addEventListener("pointermove",this.ie,!0,this),t.addEventListener("pointerleave",this.Wq,!0,this)}function mt(t,e,r){var i=t.Oh.V();i.Yk(3*+r,3,[e.lat,e.lng,0]),t.cr&&t.cr.X(i),t.yu.X(i),t.Oh.X(i)}function nt(t,e,r){r=e.Jj(r||0),this.eg=new hi(t,{icon:r,zIndex:0}),this.eg.draggable=!0,jt.call(this,e,[this.eg]),(t=this.ud).addEventListener("dragstart",this.Cd,!0,this),t.addEventListener("drag",this.ig,!0,this),t.addEventListener("dragend",this.ef,!0,this)}function ot(t){var e=0;t.nextSibling&&t.previousSibling&&(t.nextSibling.$e||t.previousSibling.$e?t.nextSibling.$e&&!t.previousSibling.$e&&(e=2):e=1),e=t.Ne.Jj(e),t.eg.we(e)}u(jt,E),m=jt.prototype,m.$e=!1,m.yD={lat:0,lng:0},m.xe=function(t,e){it(this.Wb,t),this.Wb.X(e)},m.Sk=function(t){(this.Ld=t)?this.$n():(this.kl&&globalThis.clearTimeout(this.kl),this.kl=globalThis.setTimeout(this.$n,100))},m.kl=0,m.$n=function(){this.Wb.Zb(this.Ld)},u(lt,jt),lt.prototype.Ij=function(){var t=this.Oh.V();return t.wj(0).kb(t.wj(1))},lt.prototype.ie=function(t){var e=t.currentPointer;t=this.previousSibling.ya();var r=this.nextSibling.ya(),i=this.Ne.fx,n=e.viewportX;e=e.viewportY,this.dv===n&&this.ev===e||(this.dv=n,this.ev=e,i.X(this.Ne.jA(t,r,{x:n,y:e})),i.Zb(!0))},lt.prototype.Wq=function(){this.Ne.fx.Zb()},lt.prototype.Nr=function(){this.xe(this.Ne.Jt(this.Ij()),this.Oh.C().wb())},u(nt,jt),m=nt.prototype,m.kh=0,m.j={Af:"change"},m.Ij=function(){return this.kh},m.ya=function(){return this.eg.V()},m.ig=function(t){var e=t.currentPointer;t=e.viewportX,e=e.viewportY,this.mB===t&&this.nB===e||(this.mB=t,this.nB=e,this.eg.X(this.Ne.map.Wa(t-this.vv.x,e-this.vv.y)),this.dispatchEvent(new Fc(this.j.Af,this)))},m.Cd=function(t){var e=t.currentPointer,r=e.viewportX;e=e.viewportY;var i=this.Ne.map.La(this.ya());this.eg.ui(1),this.vv={x:r-i.x,y:e-i.y},t.stopPropagation()},m.ef=function(){this.eg.ui(0)},m.Nr=function(t){this.kh=t,this.xe(this.Ne.Jt(t),this.ya())};var pt={IMPERIAL:"imperial",METRIC:"metric"};function qt(t,e){this.Ia=e,this.vc=t,this.nb={$e:!0},rt(this,this.nb),this.hn=z(this.hn,this)}function st(t,e){var r=e||t.nb.nextSibling,i=0,n=0;if(e&&!tt(t,e))throw new C(t.Ek,0,e);for(r instanceof nt?i=r.Ij():r instanceof lt&&(i=r.previousSibling.Ij()),e=r;e&&e!==t.nb;e=e.nextSibling,n++)e.Nr(i),1==n%2&&(i+=e.Ij())}function tt(t,e){for(var r=t.nb.nextSibling,i=!1;r!==t.nb;){if(r===e){i=!0;break}r=r.nextSibling}return i}function ut(t,e,r){e=new lt(e,r,t.Ia),t.vc.Y(e.ud)}function rt(t,e){t.nb.nextSibling=e,e.previousSibling=t.nb}function vt(t){var e,r=(t=t||{}).lineStyle;Xs.call(this),this.Lo=new $s({label:ft.btn,onStateChange:z(this.gf,this)}),this.Sa(this.Lo),(e=t.distanceFormatter)&&(this.Kt=e),r&&(this.nv=r,this.Wv=A),this.$c(t.alignment||"right-bottom"),this.vd={},this.vd[0]=t.startIcon,this.vd[2]=t.endIcon,this.vd[1]=t.stopoverIcon,this.vd[3]=t.splitIcon}function wt(t){function e(){var t=i.mc();return t={anchor:i.Db.clone().scale(o).floor(),size:new Ph(nd(t.w*o),nd(t.h*o)),hitArea:n},new bi(i.Te(),t)}var r,i=t.Jj(3),n=new Zh($h.NONE,[]),o=i===t.Hs?.5:1;if(1===i.getState())var a=e();else a=new bi("<svg/>",{hitArea:n}),i.addEventListener("statechange",(function(){1===i.getState()&&r.we(e())}));return r=new hi(t.map.wb(),{visibility:!1,icon:a})}function xt(t){t=t||{},Xs.call(this),this.tc=new $s({label:'<svg xmlns="http://www.w3.org/2000/svg" class="H_icon" viewBox="0 0 24 24"><g transform="translate(1 3)"><path fill-rule="nonzero" d="M5,0 L5,2 L2,2 L2,16 L5,16 L5,18 L2,18 C0.9,18 0,17 0,15.75 L0,2.25 C0,1 0.9,0 2,0 L5,0 Z M17,0 L20,0 C21.1,0 22,1 22,2.25 L22,15.75 C22,17 21.1,18 20,18 L17,18 L17,16 L20,16 L20,2 L17,2 L17,0 Z"></path><rect width="10" height="2" x="6" y="8"></rect><rect width="2" height="10" x="10" y="4"></rect></g></svg>',onStateChange:z(this.gf,this)}),this.Sa(this.tc),this.$c(t.alignment||"right-bottom")}function yt(){this.s=zt.CLOSED,Vs.call(this,"div","H_overlay")}t("H.ui.UnitSystem",pt),t("H.ui.distanceMeasurement.Model",qt),m=qt.prototype,m.Im=function(){return this.nb.nextSibling===this.nb},m.Sk=function(t){for(var e=this.nb,r=e.nextSibling;r!==e;)r.Sk(r.previousSibling!==e&&t),r=r.nextSibling},m.Pi=function(t){var e=this.nb.previousSibling,r=this.Im();return t=new nt(t,this.Ia,r?0:2),this.vc.Y(t.ud),kt(t,this.nb),t.addEventListener(t.j.Af,this.hn),r?rt(this,t):(ut(this,e,t),ot(e),st(this,e)),t},m.insertBefore=function(t,e){var r,i=1;if(e){if(!tt(this,e))throw new C(this.insertBefore,1,e);(r=e.previousSibling.$e)&&(i=0),(t=new nt(t,this.Ia,i)).addEventListener(t.j.Af,this.hn),this.vc.Y(t.ud),r?(ut(this,t,r=this.nb.nextSibling),rt(this,t),e=t,ot(r)):(e=(r=e.previousSibling).previousSibling,i=r.nextSibling,this.vc.Oa(r.ud),ut(this,e,t),ut(this,t,i)),st(this,e)}else t=this.Pi(t);return t},m.ia=function(){rt(this,this.nb),this.vc.ia()},m.Ek=function(t){var e=this.nb,r=t.previousSibling,i=t.nextSibling;if(!tt(this,t))throw new C(this.Ek,0,t);if(this.vc.Oa(t.ud),r===e){var n=i;n!==e?(rt(this,t=n.nextSibling),t.Nr(0),ot(t),st(this,t)):rt(this,this.nb)}else i===e?(kt(t=(n=r).previousSibling,e),ot(t)):r&&i&&(ut(this,r.previousSibling,i.nextSibling),this.vc.vg([i.ud,r.ud]),st(this,r.previousSibling));n&&n!==e&&this.vc.Oa(n.ud)},m.hn=function(t){var e=(t=t.target).previousSibling,r=t.nextSibling,i=t.ya();if(!r.$e){mt(r,i,!1);var n=t}e.$e||(mt(e,i,!0),n=e.previousSibling),st(this,n)},u(vt,Xs),t("H.ui.DistanceMeasurement",vt),m=vt.prototype,m.Qb=pt.METRIC,m.Ux=22,m.nv={strokeColor:"rgb(39,44,54)",lineWidth:5},m.Wv={strokeColor:"white",lineWidth:7},m.Wk=function(){var t,e=this.map,r={};this.Wj||(this.sc=new P,this.qb=new Cl(this.sc,{pixelRatio:this.map.lb()}),this.vc=t=this.sc.sd(),this.vc.Zw(!0),t.addEventListener("dragstart",this.Cd,!0,this),t.addEventListener("dragend",this.Xk,!0,this),t.addEventListener("pointerenter",this.Xk,!0,this),t.addEventListener("pointerleave",this.Wq,!0,this),t.addEventListener("tap",this.hC,!0,this),this.Zk=wt(this),r.Jt=z(this.Kt,this),r.Jj=z(this.Jj,this),r.jA=z(this.pu,this),r.map=this.map,r.fx=this.Zk,r.Nh=this.nv,r.outlineStyle=this.Wv,this.Kb=new qt(this.vc,r),this.Wj=!0),this.Zk&&this.vc.Y(this.Zk),e.addEventListener("tap",this.Pv,!0,this),e.O.add(this.qb)},m.Ai=function(){var t=this.map;this.Wj&&(t.removeEventListener("tap",this.Pv,!0,this),t.hi(this.qb),this.Kb.ia())},m.Kt=function(t){var e="m",r=0;return"metric"===this.Qb?1e3<=t&&(t/=1e3,e="km",r=1):(e="ft",5280<=(t/=.3048)&&(t/=5280,e="mi",r=1)),t.toFixed(r)+" "+this.ma().translate("scale."+e)},m.pu=function(t,e,r){var i=this.map.La(t);return e=this.map.La(e),r=new K(r.x,r.y).ou(i,e),this.map.Wa(r.x,r.y)||ze(t)},m.N=function(t,e){var r=this.map.Ca.type===Eh.P2D?this.map.lb():1,i=(r*=this.Ux)/2;Xs.prototype.renderInternal.call(this,t,e),this.Qb=pt.METRIC,this.Hs=new bi(ft.point,{anchor:{x:i,y:i},size:{w:r,h:r},hitArea:new Zh($h.CIRCLE,[i,i,i])}),this.Lo.Gd(this.ma().translate("distance.measurement"))},vt.prototype.renderInternal=vt.prototype.N,m=vt.prototype,m.Jj=function(t){return this.vd[t]||this.Hs},m.Xk=function(){this.Kb.Sk(!0)},m.Cd=function(){this.Kb.Sk()},m.Wq=function(t){"touch"!==t.currentPointer.type&&this.Kb.Sk()},m.hC=function(t){var e,r=t.currentPointer,i=t.target.Na;i&&(i=i.getData())instanceof jt&&(e=i),i=e,t=(t=t.originalEvent).metaKey||t.altKey,i&&(t&&i instanceof nt?this.Kb.Ek(i):i instanceof lt&&(t=i.previousSibling.ya(),e=i.nextSibling.ya(),r={x:r.viewportX,y:r.viewportY},this.Kb.insertBefore(this.pu(t,e,r),i.nextSibling),this.Zk.Zb()),this.Xk())},m.Pv=function(t){var e=t.currentPointer;(t=t.target)!==this.map&&t.getProvider&&t.getProvider()===this.sc||(this.Kb.Pi(this.map.Wa(e.viewportX,e.viewportY)),this.Zk.Zb(),this.Xk())},m.gf=function(t){"down"===t.target.getState()?this.Wk():this.Ai()},m.qk=function(t){this.Qb=t,this.Wj&&(st(this.Kb),this.Xk())},vt.prototype.onUnitSystemChange=vt.prototype.qk,vt.prototype.disposeInternal=function(){this.Ai(),this.Wj&&(this.sc.l(),this.qb.l()),vt.g.disposeInternal.call(this)},vt.prototype.Qa=function(t){t?this.Lo.getState()===Zs.DOWN&&(this.map=t,this.Wk()):(this.Ai(),this.Wj=!1),Xs.prototype.Qa.apply(this,arguments)},vt.prototype.setMap=vt.prototype.Qa,u(xt,Xs),t("H.ui.ZoomRectangle",xt),m=xt.prototype,m.gf=function(t){var e=this.map,r=e.sa.element;t.target.getState()===Zs.DOWN?(e.addEventListener("dragstart",this.Cd,!0,this),e.addEventListener("drag",this.ig,!0,this),e.addEventListener("dragend",this.ef,!0,this),(t=r.ownerDocument.createElement("div")).className="H_zoom_lasso",r.appendChild(t),this.Om=t):(e.removeEventListener("dragstart",this.Cd,!0,this),e.removeEventListener("drag",this.ig,!0,this),e.removeEventListener("dragend",this.ef,!0,this),r.removeChild(this.Om))},m.Cd=function(t){var e=this.Om.style,r=t.currentPointer,i=r.viewportX;r=r.viewportY,t.target===this.map&&(t.stopPropagation(),e.width="0px",e.height="0px",e.top=r+"px",e.left=i+"px",e.display="block",this.hx=r,this.gx=i)},m.ig=function(t){var e=t.currentPointer,r=e.viewportX,i=e.viewportY;e=this.gx;var n=this.hx,o=this.Om.style;t.target===this.map&&(t.stopPropagation(),t=r-e,r=i-n,o.left=e+(0>t?t:0)+"px",o.top=n+(0>r?r:0)+"px",o.width=Math.abs(t)+"px",o.height=Math.abs(r)+"px")},m.ef=function(t){var e=this.map,r=t.currentPointer;t.target===this.map&&(t.stopPropagation(),this.Om.style.display="none",e.xa.ad({bounds:Fe([e.Wa(this.gx,this.hx),e.Wa(r.viewportX,r.viewportY)])},!0))},m.N=function(t,e){Xs.prototype.renderInternal.call(this,t,e),this.tc.Gd(this.ma().translate("zoom.rectangle"))},xt.prototype.renderInternal=xt.prototype.N,u(yt,Vs),t("H.ui.base.OverlayPanel",yt),yt.prototype.F=function(t,e){return(t!==this.s||e)&&(this.s=t,t===zt.OPEN?this.Ha("H_open"):this.Bb("H_open")),this},yt.prototype.setState=yt.prototype.F,yt.prototype.getState=function(){return this.s},yt.prototype.getState=yt.prototype.getState,yt.prototype.gw=function(t){var e=t.Fe;t=t.B();var r=this.B(),i=r.style;if(this.Bb("H_top"),this.Bb("H_middle"),this.Bb("H_bottom"),this.Bb("H_left"),this.Bb("H_center"),this.Bb("H_right"),i.bottom=i.top=i.left=i.right=i.margin="",/top/g.test(e)){this.Ha("H_top"),i.top="0",i.margin="0 12px";var n=-1}else/bottom/g.test(e)?(this.Ha("H_bottom"),i.bottom="0",i.margin="0 12px",n=1):(this.Ha("H_middle"),i.top="50%",i.margin="0 12px",i.marginTop=-Math.round(.5*r.offsetHeight)+"px",n=0);/left/g.test(e)?(this.Ha("H_left"),i.left=t.offsetWidth+"px",i.marginLeft="12px"):/right/g.test(e)?(this.Ha("H_right"),i.right=t.offsetWidth+"px",i.marginRight="12px"):(this.Ha("H_center"),i.left="50%",0>n?(i.top=t.offsetHeight+"px",i.marginTop="12px"):0<n&&(i.bottom=t.offsetHeight+"px",i.marginBottom="12px"),i.marginLeft=-Math.round(.5*r.offsetWidth)+"px",t.appendChild(r))},yt.prototype.pointToControl=yt.prototype.gw;var zt={OPEN:"open",CLOSED:"closed"};function At(t){t=t||{},Xs.call(this),this.ce=new yt,this.te=this.te.bind(this),this.Fc=this.Fc.bind(this),this.Rc=this.Rc.bind(this),this.um=this.um.bind(this),this.$c(t.alignment||"bottom-right"),Bt(this,t.baseLayers,t.layers)}function Ct(t,e){var r=[];return t.concat(e).forEach((function(t){r=r.concat(t.layer)})),r}function Dt(t,e,r){var i=t.lc();if(i){t=Ct(t.He,t.ag);var n=Ct(e,r);t.forEach((function(t){n.includes(t)||i.hi(t)}))}}function Bt(t,e,r){Dt(t,e,r),t.vq=NaN,t.He=fb(e)?e:[],t.ag=fb(r)?r:[],t.Bf&&(t.Bf.ia(),t.ck.ia(),Et(t))}function Ft(t,e){if(t.map.Ca.type===Zm){var r=H.map.render.harp.Style;e=[].concat(e);for(var i=0;!o&&i<e.length;i++){var n=e[i].D;if(n.Xc()&&n.K)var o=(n=n.K()).getConfig()||n.getUrl()}if(o){var a=function(t){(t=t.D).Xc()&&t.K&&t.K()instanceof r&&t.Cb(new r(o))};t.ag.forEach((function(t){fb(t=t.layer)?t.forEach(a):t&&a(t)}))}}}function Et(t){var e=t.ma();t.He.forEach((function(t,r){var i=t.layer;(t=new $s({label:Gt(e,t.label),data:r,disabled:!i||fb(i)&&!i.length})).uf(-1),this.Bf.yo(t)}),t),t.ag.forEach((function(t,r){var i=t.layer;(t=new $s({label:Gt(e,t.label),onStateChange:this.aC.bind(this,t.layer),data:r,disabled:!i||fb(i)&&!i.length})).uf(-1),this.ck.Sa(t)}),t),t.Bu.Zb(!(!t.ag.length||!t.He.length)),globalThis.setTimeout(function(){this.map&&(this.te(),this.tc.wa(!(this.He&&this.He.length||this.ag&&this.ag.length)))}.bind(t))}function Jt(t,e){var r=window.H.service&&window.H.service.omv.Provider,i=e.D;if(r&&e.D instanceof r&&i.K().vj){var n=i.K(),o=function(){var t=Kt.ground.filter((function(t){return!!n.Op("layers."+t)})),r=Kt.water.filter((function(t){return!!n.Op("layers."+t)}));if(t.concat(r).length){var a={};Bg(a,n.vj(t)),Bg(a,n.vj(r,!1,!0)),delete a.global,t=new th(a,n.Lc()),(t=i.$.od(t)).vo=e,this.map.Bl(t)}n.removeEventListener(ch.CHANGE,o)}.bind(t);n.getState()!==ah.READY?n.addEventListener(ch.CHANGE,o):o()}}function Ht(t){return ys(t.map.O.Ta(),(function(t){return!!t.vo}))}function It(t){t=t.map.O.Ta();var e=window.H.service&&window.H.service.traffic.flow.Provider;return!!e&&t.some((function(t){return t.D instanceof e}))}yt.State=zt,u(At,Xs),t("H.ui.MapSettingsControl",At),At.prototype.subscribe=function(){var t=this.lc();if(t){var e=this.Jb();e&&(e=e.B())&&Uc(e,"pointerdown",this.Rc),Uc(t,"pointerdown",this.Rc),Uc(t=t.O,"add",this.te),Uc(t,"remove",this.te),Uc(t,"set",this.te)}},At.prototype.Rc=function(t){this.ce.getState()===zt.OPEN&&(t.currentTarget!==this.lc()&&this.ce.B().contains(t.target)||this.Fc())},At.prototype.unsubscribe=function(){var t=this.lc();if(t){var e=this.Jb();e&&(e=e.B())&&bd(e,"pointerdown",this.Rc),bd(t,"pointerdown",this.Rc),bd(t=t.O,"add",this.te),bd(t,"remove",this.te),bd(t,"set",this.te)}},At.prototype.N=function(t,e){var r=this.ma().translate("layers.choose");Xs.prototype.renderInternal.call(this,t,e),this.subscribe(),this.tc=new $s({tooltip:r,label:'<svg xmlns="http://www.w3.org/2000/svg" class="H_icon" viewBox="0 0 24 24"><path fill-rule="evenodd" d="M6.7,14.6 L4.5,16 L12,20.6 L19.5,16 L17.3,14.6 L19.1,13.5 L23,16 L12,23 L1,16 L4.9,13.5 L6.7,14.6 Z M12,2 L23,9 L12,16 L1,9 L12,2 Z"></path></svg>',onStateChange:z((function(t){var e=this;t.target.getState()===Zs.DOWN?(this.ce.F(zt.OPEN),this.ce.gw(this),this.Yj=new dt(this.B().ownerDocument.body,this.Bf.Cj().concat(this.ck.Dj()),(function(){e.tc.F(Zs.UP),e.tc.B().blur()}))):globalThis.setTimeout((function(){e.ce.F(zt.CLOSED),e.Yj.l()}))}),this)}),this.Bf=new at({title:r,onActiveButtonChange:function(){var t=this.vq;t:{for(var e=this.Bf.Cj(),r=e.length;r--;)if(e[r].getState()===Zs.DOWN){e=e[r];break t}e=null}if(e=e.getData(),r=fb(e=this.He[e].layer),this.map.Dg(r?e[0]:e),(t=this.He[t])&&fb(t=t.layer))for(var i=t.length;1<i--;)this.map.hi(t[i]);if(r)for(t=e.length;1<t--;)this.map.Bl(e[t],1);Ft(this,e),this.um(),this.Fc()}.bind(this)}),this.ck=new Vs("div","H_grp"),this.Bu=new Y("div","H_separator"),this.Sa(this.tc),this.Sa(this.ce),this.ce.Sa(this.Bf),this.ce.Sa(this.Bu),this.ce.Sa(this.ck),Et(this);var i=this;Ss(this.tc.B(),"focus",(function(){i.tc.F(Zs.DOWN)})),Ss(this.tc.B(),"blur",(function(){i.Fc()}))},At.prototype.renderInternal=At.prototype.N,At.prototype.te=function(){var t=this.map.pa,e=this.map.O;this.vq=NaN,this.He.forEach((function(e,r){e=e.layer,e=t===(fb(e)?e[0]:e),this.Bf.Cj()[r].F(Zs[e?"DOWN":"UP"],!0),e&&(this.vq=r)}),this),this.ag.forEach((function(t,r){var i=fb(t=t.layer);r=this.ck.Dj()[r],!t||i&&!t.length?r.wa(!0):r.F(Zs[-1!==e.indexOf(i?t[0]:t)?"DOWN":"UP"],!0)}),this)},At.prototype.aC=function(t,e){t=fb(t)?t:[t],e=e.target.getState()===Zs.DOWN;for(var r=0;r<t.length;r++)e?this.map.Bl(t[r]):this.map.hi(t[r]);this.um(),this.Fc()},At.prototype.um=function(){var t=Ht(this);t&&(t.vo.D.K().fk(t.D.K().Sd()),this.map.hi(t),t.l(),delete t.vo),It(this)&&Jt(this,this.map.pa)};var Kt={water:["water.water-labels"],ground:"road_labels continent_label island_label roads.shields roads.directions truck-restriction.signs places landuse.label".split(" ")};function Gt(t,e){return/^layers?/.test(e)&&t.xm(e)?t.translate(e):e}At.prototype.Fc=function(){this.tc.F(Zs.UP),this.tc.B().blur()},At.prototype.disposeInternal=function(){At.g.disposeInternal.call(this),this.unsubscribe()};var Lt=[];t("H.ui.i18n.defaultLocales",Lt);var Mt={},Nt=[];function Ot(t,e){Mt[t]=e,-1===Lt.indexOf(t)&&Lt.push(t),Nt.length?Pt(t,e):Nt=Object.keys(e)}function Pt(t,e){for(var r,i=Nt,n=i.length;n--;)if(!e[r=i[n]])throw Error("'"+r+"' key missing in translation map for "+t)}function Qt(t,e){if(!gb(t))throw new TypeError("string locale code required");if(ya(e))Pt(t,e);else{if(-1===Lt.indexOf(t))throw Error("Default locale '"+t+"' does nto exist.");e=Mt[t]}this.v=e||{},this.Tm=t}function Rt(t){var e;t=t||{},this.zf=!!t.vertical,this.qB=t.length||this.Vx,this.zb=jb(e=t.min)?e:this.Xx,this.Qc=ld(this.zb,jb(e=t.max)?e:this.Wx),this.kD=D(e=t.step)?this.Yx:e,this.Ei=St(this,jb(e=t.value)?e:(this.zb+this.Qc)/2),this.Rc=z(this.Rc,this),this.ie=z(this.ie,this),this.kn=z(this.kn,this),this.jn=z(this.jn,this),this.tk=t.pointerArea,Y.call(this,"div","H_slider"+(this.zf?"":" H_l_horizontal"))}function St(t,e){var r=t.kD;return e=Nd(e,t.zb,t.Qc),r?t.zb+md((e-t.zb)/r)*r:e}function Tt(t,e){var r=t.Dx,i=t.zf;t.Cx||(t.Cx=r["offset"+(i?"Height":"Width")]),0>(e-=As(r)[i?"y":"x"])&&(e=0),e=(t.Qc-t.zb)*e/t.Cx,e=St(t,i?t.Qc-e:t.zb+e),t.Ei!==e&&(t.bo(e,!0),t.dispatchEvent(new wg(t.j.Af,e,t.Ei)))}function Ut(t,e){return(e.touches?e.targetTouches[0]:e)["page"+(t.zf?"Y":"X")]}function Vt(t,e){var r=!1,i=t.type;return-1!==i.indexOf("pointer")||-1!==i.indexOf("touch")?r=!0:B(t,MouseEvent)&&(r=t.which===e||t.buttons===e),r}function Wt(t){var e=t.touches;return e&&1===e.length||B(t,MouseEvent)}Ot("es-ES",{"layers.normal":"Mapa","layers.satellite":"Satélite","layers.terrain":"Terreno","layer.transit":"Transporte público","layer.traffic":"Estado del tráfico","layer.incidents":"Mostrar incidentes de tráfico","layers.choose":"Elija una vista",minimap:"Minimap","scale.switchToImperial":"Cambiar a millas","scale.switchToMetric":"Cambiar a km","scale.km":"km","scale.m":"m","scale.mi":"mi","scale.ft":"ft","zoom.out":"Alejar","zoom.in":"Acercar","zoom.rectangle":"Zoom rectangle","traffic.MASS_TRANSIT":"Transporte público","traffic.MISCELLANEOUS":"Varios","traffic.ACCIDENT":"Accidente","traffic.OTHER_NEWS":"Más noticias","traffic.OTHER":"Más noticias","traffic.PLANNED_EVENT":"Acto programado","traffic.ROAD_HAZARD":"Riesgo en carretera","traffic.ROAD_CLOSURE":"Carretera cerrada","traffic.WEATHER":"Tiempo","traffic.CONGESTION":"Atasco","traffic.CONSTRUCTION":"Construcción","traffic.DISABLED_VEHICLE":"Vehículo averiado","traffic.LANE_RESTRICTION":"Restricción de carril","traffic.from":"Inicio:","traffic.until":"Finalización estimada:","distance.measurement":"Measure distance"}),Ot("ru-RU",{"layers.normal":"Режим карты","layers.satellite":"Спутниковая","layers.terrain":"Местность","layer.transit":"Общественный транспорт","layer.traffic":"Дорожные условия","layer.incidents":"Показать дорожные события","layers.choose":"Выберите вид",minimap:"Minimap","scale.switchToImperial":"Использовать мили","scale.switchToMetric":"Использовать километры","scale.km":"км","scale.m":"м","scale.mi":"миль","scale.ft":"фут","zoom.out":"Отдалить","zoom.in":"Приблизить","zoom.rectangle":"Zoom rectangle","traffic.MASS_TRANSIT":"Общественный транспорт","traffic.MISCELLANEOUS":"Прочее ДТП","traffic.ACCIDENT":"ДТП","traffic.OTHER_NEWS":"Другие новости","traffic.OTHER":"Другие новости","traffic.PLANNED_EVENT":"Плановое мероприятие","traffic.ROAD_HAZARD":"Дорожная опасность","traffic.ROAD_CLOSURE":"Дорога закрыта","traffic.WEATHER":"Погода","traffic.CONGESTION":"Пробка","traffic.CONSTRUCTION":"Ремонт","traffic.DISABLED_VEHICLE":"Неисправный автомобиль","traffic.LANE_RESTRICTION":"Ограничение полосы движения","traffic.from":"Время начала:","traffic.until":"Ожидаемое время окончания:","distance.measurement":"Измерить расстояние"}),Ot("de-DE",{"layers.normal":"Kartenansicht","layers.satellite":"Satellit","layers.terrain":"Gelände","layer.transit":"Öffentliche Verkehrsmittel","layer.traffic":"Verkehrslage","layer.incidents":"Verkehrsstörungen anzeigen","layers.choose":"Ansicht auswählen",minimap:"Minimap","scale.switchToImperial":"Umrechnung in Meilen","scale.switchToMetric":"Umrechnung in Kilometer","scale.km":"km","scale.m":"m","scale.mi":"mi","scale.ft":"ft","zoom.out":"Verkleinern","zoom.in":"Vergrößern","zoom.rectangle":"Zoom rectangle","traffic.MASS_TRANSIT":"Öffentliche Verkehrsmittel","traffic.MISCELLANEOUS":"Diverse","traffic.ACCIDENT":"Unfall","traffic.OTHER_NEWS":"Anderes Ereignis","traffic.OTHER":"Anderes Ereignis","traffic.PLANNED_EVENT":"Geplantes Ereignis","traffic.ROAD_HAZARD":"Verkehrshindernis","traffic.ROAD_CLOSURE":"Fahrbahn gesperrt","traffic.WEATHER":"Wetter","traffic.CONGESTION":"Verkehrsstau","traffic.CONSTRUCTION":"Baustelle","traffic.DISABLED_VEHICLE":"Liegengebliebenes Fahrzeug","traffic.LANE_RESTRICTION":"Fahrstreifensperrung","traffic.from":"Beginn:","traffic.until":"Voraussichtliches Ende:","distance.measurement":"Measure distance"}),Ot("nl-NL",{"layers.normal":"Kaartweergave","layers.satellite":"Satelliet","layers.terrain":"Terrein","layer.transit":"Openbaar vervoer","layer.traffic":"Verkeerssituatie","layer.incidents":"Toon verkeersincidenten","layers.choose":"Weergave kiezen",minimap:"Minimap","scale.switchToImperial":"Overgaan naar mijlen","scale.switchToMetric":"Wijzigen naar km","scale.km":"km","scale.m":"m","scale.mi":"mi","scale.ft":"ft","zoom.out":"Uitzoomen","zoom.in":"Inzoomen","zoom.rectangle":"Zoom rectangle","traffic.MASS_TRANSIT":"Openbaar vervoer","traffic.MISCELLANEOUS":"Diversen","traffic.ACCIDENT":"Ongeval","traffic.OTHER_NEWS":"Meer informatie","traffic.OTHER":"Meer informatie","traffic.PLANNED_EVENT":"Geplande afzetting","traffic.ROAD_HAZARD":"Gevaar op de weg","traffic.ROAD_CLOSURE":"Rijbaan afgesloten","traffic.WEATHER":"Weer","traffic.CONGESTION":"Verkeersopstopping","traffic.CONSTRUCTION":"Wegwerkzaamheden","traffic.DISABLED_VEHICLE":"Voertuig met pech","traffic.LANE_RESTRICTION":"Rijstrookbeperking","traffic.from":"Begintijd:","traffic.until":"Geschatte eindtijd:","distance.measurement":"Measure distance"}),Ot("pt-PT",{"layers.normal":"Vista do mapa","layers.satellite":"Satélite","layers.terrain":"Terreno","layer.transit":"Transportes públicos","layer.traffic":"Condições de trânsito","layer.incidents":"Mostrar incidentes de trânsito","layers.choose":"Escolher vista",minimap:"Minimap","scale.switchToImperial":"Mudar para milhas","scale.switchToMetric":"Mudar para km","scale.km":"km","scale.m":"m","scale.mi":"mi","scale.ft":"ft","zoom.out":"Diminuir","zoom.in":"Aumentar","zoom.rectangle":"Zoom rectangle","traffic.MASS_TRANSIT":"Transportes públicos","traffic.MISCELLANEOUS":"Diversos","traffic.ACCIDENT":"Acidente","traffic.OTHER_NEWS":"Outras notícias","traffic.OTHER":"Outras notícias","traffic.PLANNED_EVENT":"Evento planeado","traffic.ROAD_HAZARD":"Perigo na estrada","traffic.ROAD_CLOSURE":"Estrada fechada","traffic.WEATHER":"Meteorologia","traffic.CONGESTION":"Congestionamento","traffic.CONSTRUCTION":"Construção","traffic.DISABLED_VEHICLE":"Veículo avariado","traffic.LANE_RESTRICTION":"Limitação da faixa de rodagem","traffic.from":"Hora de início:","traffic.until":"Hora de fim prevista:","distance.measurement":"Measure distance"}),Ot("tr-TR",{"layers.normal":"Harita görünümü","layers.satellite":"Uydu","layers.terrain":"Arazi","layer.transit":"Toplu ulaşım","layer.traffic":"Trafik durumları","layer.incidents":"Trafik olaylarını göster","layers.choose":"Görünüm seç",minimap:"Minimap","scale.switchToImperial":"Mile dönüştür","scale.switchToMetric":"Kilometreye dönüştür","scale.km":"km","scale.m":"m","scale.mi":"mil","scale.ft":"ft","zoom.out":"Uzaklaştır","zoom.in":"Yakınlaştır","zoom.rectangle":"Zoom rectangle","traffic.MASS_TRANSIT":"Toplu ulaşım","traffic.MISCELLANEOUS":"Çeşitli","traffic.ACCIDENT":"Kaza","traffic.OTHER_NEWS":"Diğer haberler","traffic.OTHER":"Diğer haberler","traffic.PLANNED_EVENT":"Planlı etkinlik","traffic.ROAD_HAZARD":"Yol tehlikesi","traffic.ROAD_CLOSURE":"Yol kapalı","traffic.WEATHER":"Hava durumu","traffic.CONGESTION":"Yoğunluk","traffic.CONSTRUCTION":"Yol çalışması","traffic.DISABLED_VEHICLE":"Araç arızası","traffic.LANE_RESTRICTION":"Şerit kısıtlaması","traffic.from":"Başlangıç zamanı:","traffic.until":"Tahmini bitiş zamanı:","distance.measurement":"Measure distance"}),Ot("en-US",{"layers.normal":"Map view","layers.satellite":"Satellite","layers.terrain":"Terrain","layer.transit":"Public transport","layer.traffic":"Traffic conditions","layer.incidents":"Show traffic incidents","layers.choose":"Choose view",minimap:"Minimap","scale.switchToImperial":"Change to miles","scale.switchToMetric":"Change to km","scale.km":"km","scale.m":"m","scale.mi":"mi","scale.ft":"ft","zoom.out":"Zoom out","zoom.in":"Zoom in","zoom.rectangle":"Zoom rectangle","traffic.MASS_TRANSIT":"Public transport","traffic.MISCELLANEOUS":"Miscellaneous","traffic.ACCIDENT":"Accident","traffic.OTHER_NEWS":"Other news","traffic.OTHER":"Other news","traffic.PLANNED_EVENT":"Planned event","traffic.ROAD_HAZARD":"Road hazard","traffic.ROAD_CLOSURE":"Roadway closed","traffic.WEATHER":"Weather","traffic.CONGESTION":"Congestion","traffic.CONSTRUCTION":"Construction","traffic.DISABLED_VEHICLE":"Disabled vehicle","traffic.LANE_RESTRICTION":"Lane restriction","traffic.from":"Start time:","traffic.until":"Estimated end time:","distance.measurement":"Measure distance"}),Ot("zh-CN",{"layers.normal":"地图视图","layers.satellite":"卫星","layers.terrain":"地形","layer.transit":"公共交通","layer.traffic":"交通情况","layer.incidents":"显示交通事件","layers.choose":"选择视图",minimap:"Minimap","scale.switchToImperial":"切换为「英里」","scale.switchToMetric":"切换为「公里」","scale.km":"公里","scale.m":"米","scale.mi":"英里","scale.ft":"英尺","zoom.out":"缩小","zoom.in":"放大","zoom.rectangle":"Zoom rectangle","traffic.MASS_TRANSIT":"公共交通","traffic.MISCELLANEOUS":"综合事件","traffic.ACCIDENT":"交通意外","traffic.OTHER_NEWS":"其他新闻","traffic.OTHER":"其他新闻","traffic.PLANNED_EVENT":"预定事件","traffic.ROAD_HAZARD":"道路危险","traffic.ROAD_CLOSURE":"道路已关闭","traffic.WEATHER":"天气","traffic.CONGESTION":"堵塞","traffic.CONSTRUCTION":"施工","traffic.DISABLED_VEHICLE":"车辆抛锚","traffic.LANE_RESTRICTION":"车道限制","traffic.from":"开始时间：","traffic.until":"预计结束时间：","distance.measurement":"Measure distance"}),Ot("fr-FR",{"layers.normal":"Carte","layers.satellite":"Satellite","layers.terrain":"Terrain","layer.transit":"Transports publics","layer.traffic":"Conditions de circulation","layer.incidents":"Afficher les incidents de circulation","layers.choose":"Choisir la vue",minimap:"Minimap","scale.switchToImperial":"Passer en miles","scale.switchToMetric":"Passer en km","scale.km":"km","scale.m":"m","scale.mi":"mi","scale.ft":"ft","zoom.out":"Zoom arrière","zoom.in":"Zoom avant","zoom.rectangle":"Zoom rectangle","traffic.MASS_TRANSIT":"Transports publics","traffic.MISCELLANEOUS":"Divers","traffic.ACCIDENT":"Accident","traffic.OTHER_NEWS":"Autre","traffic.OTHER":"Autre","traffic.PLANNED_EVENT":"Événement prévu","traffic.ROAD_HAZARD":"Danger routier","traffic.ROAD_CLOSURE":"Chaussée fermée","traffic.WEATHER":"Météo","traffic.CONGESTION":"Embouteillage","traffic.CONSTRUCTION":"Travaux","traffic.DISABLED_VEHICLE":"Véhicule en panne","traffic.LANE_RESTRICTION":"Restriction de voie","traffic.from":"Date ou heure de début:","traffic.until":"Date et heure de fin estimées:","distance.measurement":"Measure distance"}),Ot("pl-PL",{"layers.normal":"Widok mapy","layers.satellite":"Satelita","layers.terrain":"Teren","layer.transit":"Transport publiczny","layer.traffic":"Warunki drogowe","layer.incidents":"Pokaż zdarzenia drogowe","layers.choose":"Wybierz widok",minimap:"Minimap","scale.switchToImperial":"Zmień na mile","scale.switchToMetric":"Zmień na km","scale.km":"km","scale.m":"m","scale.mi":"mi","scale.ft":"ft","zoom.out":"Oddal","zoom.in":"Przybliż","zoom.rectangle":"Zoom rectangle","traffic.MASS_TRANSIT":"Transport publiczny","traffic.MISCELLANEOUS":"Inne zdarzenie","traffic.ACCIDENT":"Wypadek","traffic.OTHER_NEWS":"Inne wiadomości","traffic.OTHER":"Inne wiadomości","traffic.PLANNED_EVENT":"Zdarzenie planowane","traffic.ROAD_HAZARD":"Niebezpieczeństwo na drodze","traffic.ROAD_CLOSURE":"Jezdnia zamknięta","traffic.WEATHER":"Pogoda","traffic.CONGESTION":"Korek","traffic.CONSTRUCTION":"Budowa","traffic.DISABLED_VEHICLE":"Uszkodzony pojazd","traffic.LANE_RESTRICTION":"Ograniczenie pasa ruchu","traffic.from":"Data rozpoczęcia:","traffic.until":"Przybliżona data zakończenia:","distance.measurement":"Measure distance"}),Ot("fi-FI",{"layers.normal":"Karttanäkymä","layers.satellite":"Satelliitti","layers.terrain":"Maasto","layer.transit":"Julkinen liikenne","layer.traffic":"Liikenneolosuhteet","layer.incidents":"Näytä liikennetapahtumat","layers.choose":"Valitse näkymä",minimap:"Minimap","scale.switchToImperial":"Vaihda maileihin","scale.switchToMetric":"Vaihda kilometreihin","scale.km":"km","scale.m":"m","scale.mi":"mi","scale.ft":"ft","zoom.out":"Loitonna","zoom.in":"Lähennä","zoom.rectangle":"Zoom rectangle","traffic.MASS_TRANSIT":"Julkinen liikenne","traffic.MISCELLANEOUS":"Erittelemätön syy","traffic.ACCIDENT":"Onnettomuus","traffic.OTHER_NEWS":"Muu tapahtuma","traffic.OTHER":"Muu tapahtuma","traffic.PLANNED_EVENT":"Suunniteltu tapahtuma","traffic.ROAD_HAZARD":"Vaara tiellä","traffic.ROAD_CLOSURE":"Tie suljettu","traffic.WEATHER":"Sää","traffic.CONGESTION":"Ruuhka","traffic.CONSTRUCTION":"Rakennustyö","traffic.DISABLED_VEHICLE":"Pysähtynyt ajoneuvo","traffic.LANE_RESTRICTION":"Kaista rajoitus","traffic.from":"Alkamisaika:","traffic.until":"Arvioitu päättymisaika:","distance.measurement":"Measure distance"}),Ot("it-IT",{"layers.normal":"Vista mappa","layers.satellite":"Satellite","layers.terrain":"Terreno","layer.transit":"Mezzi pubblici","layer.traffic":"Condizioni del traffico","layer.incidents":"Mostra incidenti stradali","layers.choose":"Scegli vista",minimap:"Minimap","scale.switchToImperial":"Passa a miglia","scale.switchToMetric":"Passa a km","scale.km":"km","scale.m":"m","scale.mi":"mi","scale.ft":"ft","zoom.out":"Zoom indietro","zoom.in":"Zoom avanti","zoom.rectangle":"Zoom rectangle","traffic.MASS_TRANSIT":"Mezzi pubblici","traffic.MISCELLANEOUS":"Varie","traffic.ACCIDENT":"Incidente","traffic.OTHER_NEWS":"Altre notizie","traffic.OTHER":"Altre notizie","traffic.PLANNED_EVENT":"Evento pianificato","traffic.ROAD_HAZARD":"Strada dissestata","traffic.ROAD_CLOSURE":"Strada chiusa","traffic.WEATHER":"Maltempo","traffic.CONGESTION":"Ingorgo","traffic.CONSTRUCTION":"Lavori in corso","traffic.DISABLED_VEHICLE":"Veicolo in panne","traffic.LANE_RESTRICTION":"Restrizione di corsia","traffic.from":"Ora di inizio:","traffic.until":"Ora di fine stimata:","distance.measurement":"Measure distance"}),Ot("pt-BR",{"layers.normal":"Exibição do mapa","layers.satellite":"Satélite","layers.terrain":"Terreno","layer.transit":"Transporte público","layer.traffic":"Condições do trânsito","layer.incidents":"Mostrar incidentes no trânsito","layers.choose":"Escolher exibição",minimap:"Minimap","scale.switchToImperial":"Mudar para milhas","scale.switchToMetric":"Mudar para km","scale.km":"km","scale.m":"m","scale.mi":"milhas","scale.ft":"pés","zoom.out":"Menos zoom","zoom.in":"Mais zoom","zoom.rectangle":"Zoom rectangle","traffic.MASS_TRANSIT":"Transporte público","traffic.MISCELLANEOUS":"Miscelânea","traffic.ACCIDENT":"Acidente","traffic.OTHER_NEWS":"Outras notícias","traffic.OTHER":"Outras notícias","traffic.PLANNED_EVENT":"Evento planejado","traffic.ROAD_HAZARD":"Risco na estrada","traffic.ROAD_CLOSURE":"Estrada fechada","traffic.WEATHER":"Clima","traffic.CONGESTION":"Congestionamento","traffic.CONSTRUCTION":"Construção","traffic.DISABLED_VEHICLE":"Veículo incapacitado","traffic.LANE_RESTRICTION":"Restrição de pista","traffic.from":"Hora de início:","traffic.until":"Tempo final estimado:","distance.measurement":"Measure distance"}),t("H.ui.i18n.Localization",Qt),Qt.prototype.fA=function(){return this.Tm},Qt.prototype.getLocale=Qt.prototype.fA,Qt.prototype.Zz=function(){return Object.keys(this.v)},Qt.prototype.getKeys=Qt.prototype.Zz,Qt.prototype.xm=function(t){return!(!this.v||!this.v[t])},Qt.prototype.hasKey=Qt.prototype.xm,Qt.prototype.translate=function(t){var e=this.v[t];if(!gb(e))throw Error("Translation missing for key '"+t+"'.");return e},Qt.prototype.translate=Qt.prototype.translate,u(Rt,Y),t("H.ui.base.Slider",Rt),m=Rt.prototype,m.Ms=1,m.Xx=0,m.Wx=100,m.Yx=1,m.Vx="16em",m.bo=function(t,e){var r=this.zf,i=r?"top":"left";return this.Ka&&!e||(t=Nd(t,this.zb,this.Qc),this.Lh&&(r=(r?-1:1)*(e=100*(t-this.zb)/(this.Qc-this.zb)),this.Lh.style[i]=r+"%",this.AD.style[i]=100+r+"%"),this.Ei=St(this,t)),this.Ei},Rt.prototype.setValue=Rt.prototype.bo,Rt.prototype.MA=function(){return this.Ei},Rt.prototype.getValue=Rt.prototype.MA,m=Rt.prototype,m.Wk=function(){if(!this.jq){Ss(this.B(),"start",this.Rc);var t=this.tk;Ss(t,"move",this.ie),Ss(t,"end",this.kn),Ss(t,"out",this.jn),this.jq=!0}},m.Ai=function(){if(this.jq){Ts(this.B(),"start",this.Rc);var t=this.tk;Ts(t,"move",this.ie),Ts(t,"end",this.kn),Ts(t,"out",this.jn),this.jq=!1}},m.Rc=function(t){var e=this.zf;if(Vt(t,this.Ms)&&Wt(t)){var r=Ut(this,t),i=t.target;i===this.Lh||i.parentElement===this.Lh?(this.kB=r-As(this.Lh)[e?"y":"x"]-this.Lh.offsetWidth/2,this.B().className="H_slider H_slider_active"+(this.zf?"":" H_l_horizontal"),this.Ka=!0):Tt(this,r),t.preventDefault()}},m.kn=function(){this.Ka&&(this.B().className="H_slider "+(this.zf?"":" H_l_horizontal"),this.Ka=!1)},m.jn=function(t){this.Ka&&t.target===this.tk&&(this.Ka=!1)},m.ie=function(t){this.Ka&&Wt(t)&&(Vt(t,this.Ms)?(Tt(this,Ut(this,t)-this.kB),t.preventDefault()):this.Ka=!1)},m.j={Af:"change"},m.N=function(t,e){var r=Ps(e,"div","H_slider_cont"),i=Ps(e,"div","H_slider_knob_cont"),n=Ps(e,"div","H_slider_knob"),o=Ps(e,"div","H_slider_knob_halo"),a=Ps(e,"div","H_slider_track");e=Ps(e,"div","H_slider_track H_slider_track_active"),t.appendChild(r),r.appendChild(a),a.appendChild(e),r.appendChild(i),i.appendChild(n),i.appendChild(o),this.Dx=a,this.AD=e,this.Lh=i,this.tk||(this.tk=t.ownerDocument.body),r.style[this.zf?"height":"width"]=this.qB,this.bo(this.Ei),this.Wk()},Rt.prototype.renderInternal=Rt.prototype.N,Rt.prototype.disposeInternal=function(){this.Ai()},Rt.prototype.wa=function(t,e){return t?this.Ai():this.Dx&&this.Wk(),Y.prototype.wa.call(this,t,e)},Rt.prototype.setDisabled=Rt.prototype.wa;var Xt={in:'<svg version="1.1" class="H_icon" xmlns="http://www.w3.org/2000/svg" x="0px" y="0px"viewBox="0 0 24 24" enable-background="new 0 0 24 24" xml:space="preserve"><g><path d="m5 10.6h5.6v-5.6h2.8v5.6h5.6v2.8h-5.6v5.6h-2.8v-5.6h-5.6v-2.8z"></path></g></svg>',out:'<svg version="1.1" class="H_icon" xmlns="http://www.w3.org/2000/svg" x="0px" y="0px"viewBox="0 0 24 24" enable-background="new 0 0 24 24" xml:space="preserve"><path d="m5 10.6h14v2.8h-14z"/></svg>'};function Yt(t){var e=(t=t||{}).slider;Xs.call(this),this.on=z(this.on,this),this.ql=z(this.ql,this),this.Kd=z(this.Kd,this),e&&(this.Xq=z(this.Xq,this),this.Eu=e,this.jD=t.sliderSnaps,this.Ha("H_zoom_slider")),this.tl=new Ys({label:Xt.in,onStateChange:this.on}),this.so=new Ys({label:Xt.out,onStateChange:this.on}),this.Ha("H_zoom"),this.Ha("H_grp"),this.lz=!1!==t.fractionalZoom,this.setZoomSpeed(t.zoomSpeed||4),this.$c(t.alignment||"right-middle")}function Zt(t){t.removeChild(t.vi),t.vi=null,t.pa&&(t.pa.removeEventListener("minchange",t.Kd),t.pa.removeEventListener("maxchange",t.Kd),t.pa=null)}function $t(t){t=t||{},Xs.call(this),this.Ha("H_scalebar"),this.$c(t.alignment||"right-bottom"),this.maxWidth=150,this.update=z(this.update,this),this.av=this.Ir=this.Mk=this.dl=null,this.uf(0)}function au(t,e){e=e||{};var r=this;Y.call(this,"div","H_ib H_ib_top"),this.Sv=z((function(t){r.ub||!Os(t)&&t instanceof KeyboardEvent&&"Escape"!==t.code||(r.close(),t.preventDefault())}),this),this.update=z(this.update,this),this.am=z(this.am,this),this.setPosition(t),this.Pk(e.content),e.onStateChange&&this.addEventListener("statechange",e.onStateChange),this.F(bu.OPEN)}u(Yt,Xs),t("H.ui.ZoomControl",Yt),Yt.prototype.SA=function(){return this.Px},Yt.prototype.getZoomSpeed=Yt.prototype.SA,Yt.prototype.fD=function(t){this.Px=t},Yt.prototype.setZoomSpeed=Yt.prototype.fD,Yt.prototype.Qa=function(t){this.map!==t&&(this.map&&this.map.removeEventListener("mapviewchange",this.ql),Zt(this)),Xs.prototype.Qa.apply(this,arguments),this.map&&(this.Kd(),t.addEventListener("mapviewchange",this.ql),t.addEventListener("baselayerchange",this.Kd))},Yt.prototype.setMap=Yt.prototype.Qa,Yt.prototype.disposeInternal=function(){Xs.prototype.disposeInternal.apply(this,arguments),this.map.removeEventListener("baselayerchange",this.Kd),Zt(this)},Yt.prototype.N=function(t,e){Xs.prototype.renderInternal.call(this,t,e),this.tl.Gd(this.ma().translate("zoom.in")),this.so.Gd(this.ma().translate("zoom.out"))},Yt.prototype.renderInternal=Yt.prototype.N,Yt.prototype.$c=function(t){var e=this.Fe;return Xs.prototype.$c.call(this,t),e!==t&&this.Kd(),this},Yt.prototype.setAlignment=Yt.prototype.$c,Yt.prototype.ql=function(){var t=this.map,e=t.Ub(),r=t.lb()-1;t=t.pa||t.Ca.getCapabilities().lookAt.zoom,this.Eu&&this.vi.bo(e),this.ub||(this.tl.wa(e+r>=t.max),this.so.wa(e<=t.min))},Yt.prototype.wa=function(t,e){return Yt.g.wa.call(this,t,e),this.ql(),this},Yt.prototype.setDisabled=Yt.prototype.wa,Yt.prototype.on=function(t){var e,r=(t=t.target)===this.tl?1:-1,i=0<r?Math.ceil:Math.floor,n=this.map,o=this;n&&("down"===t.getState()?(n.xa.startControl(),n.xa.control(0,0,r*this.Px,0,0,0)):n.xa.endControl(!0,(function(t){e=o.lz?t.zoom:i(t.zoom),t.zoom=e})))},Yt.prototype.Xq=function(t){this.map&&this.map.Vk(t.newValue)},Yt.prototype.Kd=function(){var t=this.Fe,e=this.lc();if(/^top/g.test(t)||/^bottom/g.test(t)){var r=this.so;t=this.tl;var i=!1}else r=this.tl,t=this.so,i=!0;if(this.removeChild(r),this.removeChild(t),this.Sa(r),this.Eu&&e){Zt(this),e=i;var n=(i=(r=this.map)&&r.pa)||r.Ca.getCapabilities().lookAt.zoom;(this.pa=i)&&(i.addEventListener("minchange",this.Kd),i.addEventListener("maxchange",this.Kd)),this.vi=new Rt({step:this.jD?1:0,vertical:e,min:n.min,max:n.max,value:r.Ub(),pointerArea:r.B()}),this.vi.addEventListener(this.vi.j.Af,this.Xq),this.Sa(this.vi)}this.Sa(t)},u($t,Xs),t("H.ui.ScaleBar",$t),$t.prototype.N=function(t,e){Xs.prototype.renderInternal.call(this,t,e),t.innerHTML='<svg height="12" version="1.1" xmlns="http://www.w3.org/2000/svg"><polyline style="fill:none; stroke:white; stroke-width:4" points="2,2 2,10 98,10 98,2"/><polyline style="fill:none; stroke:black; stroke-width:2" points="2,2 2,10 98,10 98,2"/></svg><div style="padding: 0 0 0 10px"></div>',t.style.direction="ltr",this.dl=t.firstChild,e=this.dl.childNodes,this.Mk=e[0],this.Ir=e[1],this.av=t.lastChild,this.Qb=pt.METRIC,this.Xy=z((function(t){!this.ub&&Os(t)&&(this.dispatchEvent("toggleunitsystem"),t.preventDefault())}),this),this.je=z((function(t){!this.ub&&Os(t)&&t.preventDefault()}),this),Ss(t,"start",this.je),Ss(t,"end",this.Xy),this.Gd(this.ma().translate("scale.switchToImperial")),this.update()},$t.prototype.renderInternal=$t.prototype.N,$t.prototype.Qa=function(t){this.map&&this.map.removeEventListener("mapviewchange",this.update),t&&t.addEventListener("mapviewchange",this.update),Xs.prototype.Qa.apply(this,arguments)},$t.prototype.setMap=$t.prototype.Qa,$t.prototype.capture=function(t,e,r){var i=this.B(),n=i.ownerDocument,o=n.createElement("canvas"),a=o.getContext("2d"),s=n.createElementNS("http://www.w3.org/2000/svg","svg"),l=n.createElementNS("http://www.w3.org/2000/svg","foreignObject"),u=me(i,n,!1);n=parseFloat(i.offsetWidth)+1;var c=parseFloat(i.offsetHeight),h=n*t;t*=c,o.width=h,o.height=t,s.setAttribute("xmlns","http://www.w3.org/2000/svg"),s.setAttribute("width",h),s.setAttribute("height",t),s.setAttribute("viewBox","0 0 "+n+" "+c),l.setAttribute("width","100%"),l.setAttribute("height","100%"),s.appendChild(l),u.setAttribute("width","100%"),u.setAttribute("height","100%"),u.setAttribute("xmlns","http://www.w3.org/1999/xhtml");var p=window.getComputedStyle(i);"box-shadow display align-items font font-family font-size height text-shadow direction".split(" ").forEach((function(t){u.style.setProperty(t,p.getPropertyValue(t))})),l.appendChild(u),new nh("image",i=ce(s.outerHTML)).then((function(t){a.drawImage(t,0,0),e(o)}),r)},$t.prototype.capture=$t.prototype.capture,$t.prototype.qk=function(t){this.Qb=t,this.Gd("imperial"===t?this.ma().translate("scale.switchToMetric"):this.ma().translate("scale.switchToImperial")),this.update()},$t.prototype.onUnitSystemChange=$t.prototype.qk,$t.prototype.update=function(){var t;if(this.B()){this.dl=this.dl,this.Mk=this.Mk;var e=this.maxWidth,r=0;if(t=this.map){var i=t.sa,n=Math.round(.5*i.width),o=Math.round(.5*i.height);0<n&&0<o&&(i=t.Wa(n,o))&&(t=t.Wa(n+1,o))&&(r=100*i.kb(t))}r&&(this.Qb===pt.IMPERIAL?1609.344>r?(n=r/.3048006,t=this.ma().translate("scale.ft")):(n=r/1609.344,t=this.ma().translate("scale.mi")):1e3>r?(n=r,t=this.ma().translate("scale.m")):(n=r/1e3,t=this.ma().translate("scale.km")),(n=(r=Math.pow(10,Math.floor(Math.log(n)/Math.LN10)))/n*100)<e/5?(r*=5,n*=5):n<e/2?(r*=2,n*=2):n>e&&(r/=2,n/=2),n=Math.round(n),this.dl.setAttribute("width",n),this.av.textContent=r+" "+t,this.Mk.points.getItem(2).x=this.Ir.points.getItem(2).x=this.Mk.points.getItem(3).x=this.Ir.points.getItem(3).x=n-2)}},u(au,Y),t("H.ui.InfoBubble",au),au.prototype.v=null,au.prototype.ya=function(){return this.Uc},au.prototype.setPosition=function(t){this.Uc=ze(t),this.update()},au.prototype.setPosition=au.prototype.setPosition,au.prototype.Qa=function(t){this.v=t},au.prototype.N=function(t,e){this.Jo=Ps(e,"div","H_ib_body"),this.tailEl_=Ps(e,"div","H_ib_tail"),this.$i=Ps(e,"div","H_ib_close H_btn",'<svg version="1.1" class="H_icon" viewBox="0 0 12 12"><path d="m8.12 6 3.66-3.66c.29-.29.29-.76 0-1.05l-1.06-1.06c-.29-.29-.76-.29-1.05 0l-3.66 3.66-3.66-3.66c-.29-.29-.76-.29-1.05 0l-1.06 1.06c-.29.29-.3.76 0 1.05l3.66 3.66-3.66 3.66c-.29.29-.29.76 0 1.05l1.06 1.06c.29.29.76.29 1.05 0l3.66-3.66 3.66 3.66c.29.29.76.29 1.05 0l1.06-1.06c.29-.29.3-.76 0-1.05z"></path></svg>'),this.$i.setAttribute("tabindex","0"),this.fh=Ps(e,"div","H_ib_content","&nbsp;"),this.Jo.appendChild(this.$i),this.Jo.appendChild(this.fh),Ss(this.$i,"start",this.Sv),this.v.xa.addEventListener("sync",this.update),this.v.sa.addEventListener("sync",this.update),t.appendChild(this.Jo),t.appendChild(this.tailEl_),this.Pk(this.Rl)},au.prototype.renderInternal=au.prototype.N,au.prototype.am=function(){this.Bt||(this.Bt=setTimeout(this.update,0))},au.prototype.update=function(){var t,e=this.B(),r=this.v,i="none";if(this.Bt=0,r&&e&&this.getState()===bu.OPEN){if(t=r.La(this.Uc)){var n=t.x;t=t.y,(n>=-(r=r.sa.width)||n<=2*r||t>=-r||t<=2*r)&&(i="",Cs?(e.style.left=n-r+"px",e.style.top=t+"px"):Bs(e,n,t))}e.style.display=i,""===i&&(e.style.visibility="visible")}};var bu={OPEN:"open",CLOSED:"closed"};function cu(t,e){this.xc=t,this.Dc=null,this.hk=0,this.fg=22,this.BD=e,this.en=z(this.en,this),this.Zo=z(this.Zo,this),(t=this.xc.lc()).addEventListener("mapviewchange",this.eC,!1,this),this.vb=t.Ca.type,(t=t.O).addEventListener("add",this.jg,!1,this),t.addEventListener("remove",this.kg,!1,this)}function du(t,e,r){var i=e.D;i&&void 0!==r&&r&&i.removeEventListener("tap",t.en),e?(i.addEventListener("tap",t.en),t.hk=i.min,t.fg=i.max):(t.hk=0,t.fg=22)}function eu(t){return window.H.service&&(t.D instanceof window.H.service.traffic.incidents.Provider||t.D instanceof window.H.service.trafficVectorTile.Provider&&"incident"===t.D.$.Aq)}function fu(t,e){var r={},i={};r["top-left"]=Ps(e,"div",[gu,hu].join(" ")),r["top-center"]=Ps(e,"div",[gu,iu,ju,hu].join(" ")),r["top-right"]=Ps(e,"div",[gu,hu].join(" ")),r["left-top"]=Ps(e,"div",[gu,ku].join(" ")),r["left-middle"]=Ps(e,"div",[gu,lu,mu,ku].join(" ")),r["left-bottom"]=Ps(e,"div",[gu,ku].join(" ")),r["right-top"]=Ps(e,"div",[gu,ku].join(" ")),r["right-middle"]=Ps(e,"div",[gu,nu,mu,ku].join(" ")),r["right-bottom"]=Ps(e,"div",[gu,ku].join(" ")),r["bottom-left"]=Ps(e,"div",[gu,hu].join(" ")),r["bottom-center"]=Ps(e,"div",[gu,ou,ju,hu].join(" ")),r["bottom-right"]=Ps(e,"div",[gu,hu].join(" ")),i["top-left"]=Ps(e,"div",[iu,lu].join(" ")),i["top-right"]=Ps(e,"div",[iu,nu].join(" ")),i["bottom-left"]=Ps(e,"div",[ou,lu].join(" ")),i["bottom-right"]=Ps(e,"div",[ou,nu].join(" ")),Qs(i["top-left"],r["top-left"],r["left-top"]),Qs(i["top-right"],r["top-right"],r["right-top"]),Qs(i["bottom-left"],r["left-bottom"],r["bottom-left"]),Qs(i["bottom-right"],r["right-bottom"],r["bottom-right"]),Qs(t,i["top-left"],i["top-right"],i["bottom-left"],i["bottom-right"],r["top-center"],r["left-middle"],r["right-middle"],r["bottom-center"]),this.at=r}au.State=bu,au.prototype.s=bu.OPEN,au.prototype.getState=function(){return this.s},au.prototype.getState=au.prototype.getState,au.prototype.F=function(t){t!==this.s&&(this.s=t,this.dispatchEvent("statechange")),(t=this.B())&&(this.s===bu.OPEN?(t.style.display="block",t.style.visibility="hidden",this.am()):t.style.display="none")},au.prototype.setState=au.prototype.F,au.prototype.close=function(){this.F(bu.CLOSED)},au.prototype.close=au.prototype.close,au.prototype.open=function(){this.F(bu.OPEN)},au.prototype.open=au.prototype.open,au.prototype.Cz=function(){return this.fh||null},au.prototype.getContentElement=au.prototype.Cz,au.prototype.Pk=function(t){if(t){if("string"!=typeof t&&("number"!=typeof t.nodeType||"string"!=typeof t.nodeName))throw Error("InfoBubble content must be a string or HTML node.");this.Rl=t}else this.Rl="";this.B()&&(this.Rl?(this.fh.innerHTML="","string"==typeof this.Rl?this.fh.innerHTML=t:"number"==typeof t.nodeType&&"string"==typeof t.nodeName&&this.fh.appendChild(t)):this.fh.innerHTML="&nbsp;",this.am())},au.prototype.setContent=au.prototype.Pk,au.prototype.disposeInternal=function(){this.close(),this.Pk(""),this.$i&&Ts(this.$i,"end",this.Sv),this.v&&(this.v.xa.removeEventListener("sync",this.update),this.v.sa.removeEventListener("sync",this.update)),Y.prototype.disposeInternal.call(this)},m=cu.prototype,m.eC=function(t){var e=t.newValue.zoom;this.Dc&&t.modifiers&t.ZOOM&&(e<this.hk||e>this.fg)&&this.Dc.close()},m.jg=function(t){eu(t=t.added)&&du(this,t)},m.kg=function(t){eu(t=t.removed)&&(this.Dc&&this.Dc.close(),du(this,t,!0))},m.en=function(t){var e,r=this.vb===Eh.HARP;t.target&&(e=t.target.getData())&&0===t.currentPointer.button&&(r?(e=this.xc.lc().Wa(t.currentPointer.viewportX,t.currentPointer.viewportY),(r=t.target.getData()?t.target.getData().properties.id:null)&&this.BD.requestIncidentById(r,{locationReferencing:"none",lang:this.xc.ma().Tm,units:this.xc.Qb===pt.METRIC?"metric":"imperial"},this.Ex.bind(this,e),console.error)):(r=t.target.V(),this.Ex(r,e)),t.stopPropagation())},m.Ex=function(t,e){if(this.vb===Eh.HARP){e=e.incidentDetails;var r=this.xc.ma().Tm,i=e.type,n=i.split(/(?=[A-Z])/).join("_").toUpperCase();this.xc.ma().xm("traffic."+n)&&(i=this.xc.ma().translate("traffic."+n)),t={position:t,title:i,description:e.description.value,startTime:new Date(e.startTime).toLocaleString(r).split(",").join(" "),endTime:new Date(e.endTime).toLocaleString(r).split(",").join(" ")}}else r=e.TRAFFIC_ITEM_TYPE_DESC.replace(" ","_"),t={position:t,title:r=this.xc.ma().xm("traffic."+r)?this.xc.ma().translate("traffic."+r):e.TRAFFIC_ITEM_DESCRIPTION[e.TRAFFIC_ITEM_DESCRIPTION.length-1].value,description:e.TRAFFIC_ITEM_DESCRIPTION[0].value,startTime:e.START_TIME,endTime:e.END_TIME};this.Zo(t)},m.Zo=function(t){var e=t.position,r=t.title,i=t.description,n=t.startTime;t=t.endTime,this.Dc||(this.Dc=new au(e),this.Dc.Ha("H_tib"),this.xc.Ys(this.Dc)),this.Dc.setPosition(e),this.Dc.Pk('<div class="H_tib_content"><div class="H_rdo_title" dir="auto">{{title}}</div><div class="H_tib_desc" dir="auto"><span>{{desc}}</span><div class="H_tib_time"><span class="H_tib_left">{{traffic.from}}</span><span class="H_tib_right">{{from}}</span><br/><span class="H_tib_left">{{traffic.until}}</span><span class="H_tib_right">{{until}}</span></div></div>'.replace("{{title}}",r).replace("{{desc}}",i).replace("{{traffic.from}}",this.xc.ma().translate("traffic.from")).replace("{{traffic.until}}",this.xc.ma().translate("traffic.until")).replace("{{from}}",n).replace("{{until}}",t)),this.Dc.open()};var iu="H_l_top",ou="H_l_bottom",lu="H_l_left",nu="H_l_right",ju="H_l_center",mu="H_l_middle",hu="H_l_horizontal",ku="H_l_vertical",gu="H_l_anchor";function pu(t,e){e?(e=t.offsetWidth,t.style.marginLeft=-Math.round(.5*e)+"px"):(e=t.offsetHeight,t.style.marginTop=-Math.round(.5*e)+"px")}function qu(t,e){try{return t.Hm=!0,new t(e)}finally{t.Hm=!1}}function ru(t,e){var r=t.B(),i=this;E.call(this),this.v=t,this.qj=r.ownerDocument,this.Hf={},this.Je=[],this.G=Ps(this.qj,"div","H_ui"),this.setDirection(),this.TB=z((function(t){this.lv.put(t.target,t.target.Fe)}),this),this.addEventListener("alignmentchange",this.TB),this.iC=z((function(){this.xx()}),this),this.addEventListener("toggleunitsystem",this.iC),this.G.addEventListener("contextmenu",this.lw,!1),this.G.addEventListener("MSHoldVisual",this.lw,!1),this.v.addEventListener("contextmenu",this.bn,!1,this),this.v.addEventListener("contextmenuclose",this.Kv,!1,this),this.v.bc(this.l.bind(this)),this.Od=null,this.rt=-1,this.lv=new fu(this.G,this.qj),this.Qb=pt.METRIC,su(this,"en-US"),e&&tu(this,e),r.appendChild(this.G),globalThis.setTimeout((function(){i.lv.update()}),1)}function su(t,e){if(gb(e))var r=e;else{if(!(e instanceof Qt))throw Error("The locale parameter must be a string or a H.ui.i18n.Localization object.");r=e.Tm;var i=e}if(!r)throw Error("No locale was defined.");if(i)t.Bq=i;else{if(!(0<=Lt.indexOf(r)))throw Error("Locale ["+r+"] is not supported.");t.Bq=new Qt(r)}}function tu(t,e){var r,i;e.unitSystem&&t.ao(e.unitSystem),(i=e.locale)&&su(t,i),(r=e.zoom)&&t.Pg("zoom",new Yt(ya(r)?r:null)),(r=e.zoomrectangle)&&t.Pg("zoomrectangle",new xt(ya(r)?r:null)),(r=e.mapsettings)&&t.Pg("mapsettings",new At(ya(r)?r:null)),(r=e.scalebar)&&t.Pg("scalebar",new $t(ya(r)?r:null)),(r=e.distancemeasurement)&&t.Pg("distancemeasurement",new vt(ya(r)?r:null))}function vu(t,e,r,i){for(var n=t,o=0;n&&o<e.length;o++)n=n[e[o]];if(n&&n!==t)return t={label:r,layer:n},i.push(t),t}function uu(t,e,r){var i=[],n=[],o=e.raster;if(t===Eh.P2D&&o){if(vu(e,["raster","normal","map"],"layers.normal",i),vu(e,["raster","satellite","map"],"layers.satellite",i),vu(e,["raster","terrain","map"],"layers.terrain",i),r)for(var a in o)if(o[a]&&o[a].map===r){var s=a;break}vu(e,["raster","normal","trafficincidents"],"layer.incidents",n),vu(e,["raster",s,"transit"],"layer.transit",n)}else vu(e,["vector","normal","map"],"layers.normal",i),t===Eh.WEBGL?(vu(e,["raster","satellite","map"],"layers.satellite",i),vu(e,["vector","normal","traffic"],"layer.traffic",n),vu(e,["vector","normal","trafficincidents"],"layer.incidents",n)):(r=vu(e,["hybrid","day","vector"],"",[]),(o=vu(e,["hybrid","day","raster"],"layers.satellite",i)).layer=[o.layer,r.layer],window.H.service&&(r=e.vector.traffic.map.D.$.i(),e=qu(window.H.service.trafficVectorTile.Service,{baseUrl:r,layer:"flow"}),r=qu(window.H.service.trafficVectorTile.Service,{baseUrl:r,layer:"incident"}),s=kn()+"/harp/oslo/normal.day.json",o=new H.map.render.harp.Style(s),s=new H.map.render.harp.Style(s),e=e.createLayer(o,{engineType:t}),t=r.createLayer(s,{engineType:t}),n.push({label:"layer.traffic",layer:e},{label:"layer.incidents",layer:t})));return{alignment:"bottom-right",baseLayers:i,layers:n}}function wu(t,e){if(e=e||{},!(t&&t instanceof kl))throw Error("Base layer is mandatory for overview UI element");Xs.call(this),this.dr=new $s({label:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" class="H_icon"><g fill-rule="evenodd" transform="translate(2 2)"><rect width="9" height="9" x="10" y="10"/><rect class="H_icon_stroke" width="18" height="18" x="1" y="1" fill="none" stroke="#000" stroke-width="2" rx="2"/></g></svg>',onStateChange:z(this.gf,this)}),this.Sa(this.dr),this.$h=new xu(t,e.zoomDelta,e.scaleX,e.scaleY),this.$c(e.alignment||"right-bottom"),this.Sa(this.$h)}function xu(t,e,r,i){this.pa=t,this.Xs="H_overview_active","number"==typeof e&&(this.Ox=e),"number"==typeof r&&(this.Zv=r),"number"==typeof i&&(this.$v=i),Vs.call(this,"div","H_overview")}function zu(t){!t.jh&&yu(t),t.Bb(t.Xs),t.v.removeEventListener("mapviewchange",t.js,!1,t)}function yu(t,e){var r=t.v.sa.element,i=t.B().style,n=r.offsetWidth/t.Zv/10;r=r.offsetHeight/t.$v/10;var o=t.Eq.style;e?(i.width=n+"em",i.height=r+"em",o.width=n+"em",o.height=r+"em"):i.width=i.height="0em",t.ai.sa.resize()}function Au(t,e){this.Wm=[],Au.g.constructor.apply(this,arguments)}function Bu(t,e){if(!t)throw new C(Bu,0,t);Bu.g.constructor.call(this,t),this.fw={},this.tj=!(!e||!e.Qd),this.Rj=Cu++}fu.prototype.update=function(){var t=this.at;pu(t["top-center"],!0),pu(t["bottom-center"],!0),pu(t["left-middle"],!1),pu(t["right-middle"],!1)},fu.prototype.put=function(t,e){t=t?t.B():null;var r=e?this.at[e]:null;t&&r&&(t.parentElement&&t.parentElement.removeChild(t),r.insertBefore(t,/(bottom|right)$/.test(e)||/(center|middle)/.test(e)&&r.childNodes.length%2?r.firstChild:null)),this.update()},u(ru,E),t("H.ui.UI",ru),ru.prototype.lw=function(t){for(var e=t.target;e&&!/\bH_ib_content\b/.test(e.className);)e=e.parentNode;e||t.preventDefault()},ru.prototype.B=function(){return this.G},ru.prototype.getElement=ru.prototype.B,ru.prototype.lc=function(){return this.v},ru.prototype.getMap=ru.prototype.lc,ru.prototype.LA=function(){return this.Qb},ru.prototype.getUnitSystem=ru.prototype.LA,ru.prototype.ao=function(t){var e,r=this.Hf;if(t!==this.Qb)for(e in this.Qb=t,r)r[e]instanceof Xs&&r[e].onUnitSystemChange(this.Qb)},ru.prototype.setUnitSystem=ru.prototype.ao,ru.prototype.setDirection=function(t){this.G.setAttribute("dir",t||getComputedStyle(this.lc().B()).direction)},ru.prototype.setDirection=ru.prototype.setDirection,ru.prototype.ma=function(){return this.Bq},ru.prototype.xx=function(){this.Qb===pt.METRIC?this.ao(pt.IMPERIAL):this.ao(pt.METRIC)},ru.prototype.toggleUnitSystem=ru.prototype.xx,ru.prototype.Ys=function(t){var e=this.Je.length,r=this.G;if(0>this.Je.indexOf(t)){t.ea(this),t.Qa(this.v);var i=t.L(this.qj);e=0<e?this.Je[e-1].B().nextSibling:this.G.firstChild,r.insertBefore(i,e),this.Je.push(t)}},ru.prototype.addBubble=ru.prototype.Ys,ru.prototype.bn=function(t){var e=t.items;this.Od&&this.Kv(),clearTimeout(this.rt),this.rt=globalThis.setTimeout(function(){e.length&&(this.Od=new et(e),this.G.insertBefore(this.Od.L(this.qj),this.G.firstChild),this.Od.ea(this),this.Od.Qa(this.v),this.Od.setPosition(t.viewportX,t.viewportY))}.bind(this),0)},ru.prototype.Kv=function(){this.Od&&(this.Od.l(),this.Od=null)},ru.prototype.zC=function(t){var e=this.Je.indexOf(t);-1<e&&(t.ea(null),t.Qa(null),this.Je.splice(e,1),this.G.removeChild(t.B()))},ru.prototype.removeBubble=ru.prototype.zC,ru.prototype.yz=function(){return this.Je},ru.prototype.getBubbles=ru.prototype.yz,ru.prototype.Pg=function(t,e){if(this.Gj(t))throw Error("A control with name ["+t+"] is already registered.");e.ea(this),e.Qa(this.v),e.xB=this.Bq,e.L(this.qj),e.onUnitSystemChange(this.Qb),this.Hf[t]=e},ru.prototype.addControl=ru.prototype.Pg,ru.prototype.BC=function(t){var e=this.Gj(t);if(!e)throw Error("Control ["+t+"] not found in this UI's controls.");return e.unsubscribe(),e.ea(null),e.Qa(null),Us(e),delete this.Hf[t],e},ru.prototype.removeControl=ru.prototype.BC,ru.prototype.Gj=function(t){return this.Hf[t]},ru.prototype.getControl=ru.prototype.Gj,ru.prototype.disposeInternal=function(){for(var t in this.Hf)zs.hasOwnProperty.call(this.Hf,t)&&this.Hf[t].l();this.Je.forEach((function(t){t.l()})),(t=this.G.parentNode)&&t.removeChild(this.G),E.prototype.disposeInternal.call(this),delete this.G},ru.prototype.capture=function(t,e,r,i){var n=this.Gj("scalebar"),o=t.getContext("2d"),a=t.width,s=t.height,l=this.v.Yd,u=5+(l?l.B().childNodes[1].offsetHeight:0);n&&n.Wd()?n.capture(e,(function(i){o.drawImage(i,a-i.width-5*e,s-i.height-u*e),r(t)}),i):r(t)},ru.prototype.capture=ru.prototype.capture,ru.createDefault=function(t,e,r){var i=t.Ca.type;if(r=new ru(t,{unitSystem:pt.METRIC,zoom:{alignment:"right-bottom"},mapsettings:uu(i,e,t.pa),scalebar:{alignment:"bottom-right"},locale:r||"en-US"}),i===Eh.P2D){var n=r.Gj("mapsettings"),o=function(){if(n.lc()){var r=uu(i,e,t.pa);Bt(n,r.baseLayers,r.layers)}};t.addEventListener(t.j.xl,o),r.bc((function(){t.removeEventListener(t.j.xl,o)})),n.bc((function(){t.removeEventListener(t.j.xl,o)}))}if(i===Eh.HARP){if(window.H.service){var a=e.vector.traffic.map.D.$.i(),s=new window.H.service.Url(a.oi,a.Qj.split(".").slice(-2).join(".")),l=(s=qu(window.H.service.traffic.Service7,{platformBaseUrl:s})).i().getQuery();l.apikey=a.getQuery().apikey,s.i().Tk(l),new cu(r,s)}}else new cu(r);return r},ru.prototype.dD=function(){},ru.prototype.setTrafficIncidentsHandle=ru.prototype.dD,u(wu,Xs),t("H.ui.Overview",wu),wu.prototype.Dg=function(t){return this.$h.Dg(t),this},wu.prototype.setBaseLayer=wu.prototype.Dg,wu.prototype.gf=function(t){t.target.getState()===Zs.DOWN?(yu(t=this.$h,!0),t.js(),t.Ha(t.Xs),t.v.addEventListener("mapviewchange",t.js,!1,t)):zu(this.$h)},wu.prototype.N=function(t,e){Xs.prototype.renderInternal.call(this,t,e),this.dr.B().style.float=this.Fe.match("right")?"right":"left",this.$h.Qa(this.map),this.dr.Gd(this.ma().translate("minimap"))},wu.prototype.renderInternal=wu.prototype.N,wu.prototype.disposeInternal=function(){this.$h.l(),Y.prototype.disposeInternal.call(this)},u(xu,Xs),xu.prototype.Dg=function(t){this.ai.Dg(t)},xu.prototype.N=function(t,e){Qs(t,e=Ps(e,"div","H_overview_map")),this.Eq=e},xu.prototype.renderInternal=xu.prototype.N,xu.prototype.renderInternal=xu.prototype.N,m=xu.prototype,m.Ox=3,m.Zv=5,m.$v=5,m.Qa=function(t){this.v=t,this.ai=new U(this.Eq,this.pa,{pixelRatio:this.v.lb(),engineType:this.v.Ca.type}),this.ai.Yd.B().style.display="none",this.Yv=this.ai.xa,this.sv=this.v.xa},m.js=function(t){t&&t.modifiers&t.SIZE&&yu(this,!0),(t=this.sv.Ib()).zoom-=this.Ox,this.Yv.ad(t)},m.disposeInternal=function(){xu.g.disposeInternal.call(this),zu(this),this.ai.l(),this.ai=this.Yv=this.sv=this.v=this.pa=this.Eq=null},t("H.ui.buildInfo",(function(){return bn("H-ui","1.60.0","2c2ebf2",{region:"row"})})),u(Au,al),m=Au.prototype,m.Xt=function(){return this.yb.qe.apply(this.yb,arguments)},m.L=function(t,e,r,i,n,o,a){return this.Wm=[],Au.g.L.apply(this,arguments)},m.oa=1,m.Ew=function(t,e,r,i,n,o){var a=this.oa=i.lb();n*=a,o*=a;var s=r.mc();e=s.w*a,s=s.h*a;var l=r.Db;this.Qd?(n-=l.x*a,o-=l.y*a):(n=md(n-l.x*a),o=md(o-l.y*a)),i.Re(r.Te(),n,o,e,s),t.detail?t.detail.set(n,o,n+e,o+s):t.detail=new ig(n,o,n+e,o+s),this.Wm.push(t)},m.Ma=function(t,e,r){for(var i,n,o,a=this.Wm,s=a.length,l=je,u=this.oa;s--&&!((n=(i=a[s]).detail).Ql(t,e)&&(i=i.uv,(!(o=i.kc().Am)||o.Bm((t-n.left)/u,(e-n.top)/u,0))&&0>l.indexOf(i)&&(l===je&&(l=[]),l.push(i),r))););return l},m.Eh=function(){return"2d"},m.disposeInternal=function(){this.Wm=[],Au.g.disposeInternal.call(this)},Au.prototype.disposeInternal=Au.prototype.disposeInternal,u(Bu,Vk);var Cu=0;Bu.prototype.L=function(t,e,r,i,n,o){var a=md(i),s=this.yb,l=a+(r.exp-s.pixelProjection.exp),u=s.min,c=s.max;i=s.tileSize;var h=s.D.Sc,p=this.Pb,f=p.Ve(),d=p.mc().w,y=r.w,g=r.x,v=r.y,m={};if(a<u||a>c)return vg.DONE;for(t=(n=s.requestTiles(t,l,n,o,this.Rj)).total,o=(n=n.tiles).length,this.me=r,this.VC=e,this.ws=l,f!==h&&p.Fd(h),r=i=i*y/(sd(2,l)*i),this.tj||(i%1&&(g/=y=r/(i=nd(i)),v/=y,y=sd(2,l)*i),g=nd(g),v=nd(v)),this.HC=r,l=-i,a=d+i,s=0;s<o;s++){if((u=(d=n[s]).data)&&u.tagName){for(r=e.x-(g-d.x*i),h=e.y-(v-d.y*i),p.Re(u,r,h,i,i),f=r;(f-=y)>l;)p.Re(u,f,h,i,i);for(f=r;(f+=y)<a;)p.Re(u,f,h,i,i)}m[this.ws+"_"+d.x+"_"+d.y]=d}return this.fw=m,o===t?vg.DONE:vg.PENDING},Bu.prototype.Ma=function(t,e,r){var i,n=this.HC,o=n/this.yb.tileSize,a=this.me,s=this.VC;if(ab(this.ws)&&a){t=a.x+(t-s.x),e=a.y+(e-s.y);var l=nd(a.w/n),u=a=nd(t/n);s=nd(e/n),pd(u)>=l&&(u%=l),0>u&&(u=l+u),(l=this.fw[this.ws+"_"+u+"_"+s])&&l.Ma&&(i=l.Ma((t-n*a)/o,(e-n*s)/o,r))}return i||je},Bu.prototype.Eh=function(){return"2d"};var Du={lookAt:{zoom:{min:-8,max:24},tilt:{min:0,max:0},incline:{min:0,max:0},heading:{min:180,max:180}},interaction:{ZOOM:rk.ZOOM,COORD:rk.COORD},capture:!0};function Eu(t,e){e=e||{},B(t,Cl,Eu,0),Eu.g.constructor.call(this,t),this.Qd=!!e.Qd,this.sC=e.Ab||0,this.tn=[],this.Xv={}}function Z(t,e,r,i){Z.g.constructor.call(this,t,e,r,i),this.Xb=new K(0,0),(r=i.renderBaseBackground)&&(this.Dw=r.lower,this.Cw=r.higher),this.tj=!!i.enableSubpixelRendering,this.Kg=Fu,this.jv=0,this.xs=this.bv=!1,this.na=new Sl,this.T=i=new Rk,this.gg=z(this.gg,this),i.addEventListener(i.j.wo,this.gg),this.La=z(this.La,this),i=t.element,this.rc=t=i.ownerDocument.createElement("div"),t.style.position="absolute",t.style.width=t.style.height="100%",t.style.zIndex=0,i.insertBefore(t,i.firstChild),this.cl=new Yk(this.rc,this.ja),this.Ge=[],this.gq(),this.wg=z(Z.prototype.wg,this),this.s=Gu,this.Qn(),this.zoom=Hu(this,this.Ee.Ub()+this.Ab),this.Ac(),Iu(this,e.Ib().position,this.zoom),this.rb(),this.ng()}t("H.map.render.p2d.capabilities",Du),u(Eu,Vk),Eu.prototype.L=function(t,e,r,i,n,o){var a,s,l=this.yb;i-=this.sC,this.tn.length=0;var u=this.Xv;if(this.Xv=a={},i>=l.min&&i<=l.max){var c=l.xg(t,i,n,o),h=c.overlays;if(t=h.length)for(h.sort($f),i=this.Pb,n=this.Qd,o=0;o<t;o++){var p=(l=h[o]).C(),f=r.Gb(p.Oc()),d=r.Gb(p.Mc());p=r.w,f.x>=d.x&&(f.x-=p),p*=-((f.x+d.x)/p>>1),f.x+=p,f.add(e),d.x+=p,d.add(e),n||(f.round(),d.round()),(p=u[s=l.xb()])?delete u[s]:p={oC:l},a[s]=p;var y=f.x;f=f.y;var g=d.x,v=g-y,m=(d=d.y)-f;i.Fd(l.Ve()),i.Re(l.Te(),y,f,v,m),p.details?p.details.set(y,f,g,d):p.details=new ig(y,f,g,d),this.tn.push(p)}}return!c||c.requested&&c.requested===c.total||!c.requested&&h.length===c.total?vg.DONE:vg.PENDING},Eu.prototype.Ma=function(t,e,r){for(var i,n,o=this.tn,a=o.length;a--;)if((i=o[a]).details.Ql(t,e))if(i=i.oC,n)n.push(i);else if(n=[i],r)break;return n||je},Eu.prototype.Eh=function(){return"2d"},Eu.prototype.disposeInternal=function(){delete this.tn,Eu.g.disposeInternal.call(this)},Eu.prototype.disposeInternal=Eu.prototype.disposeInternal,u(Z,ok),t("H.map.render.p2d.RenderEngine",Z),Z.prototype.type=xk.P2D;var Gu=2;function Iu(t,e,r){var i=t.pixelProjection;i.Va(r),t.yd=i.projection.Se(e),i.x=i.w*t.yd.x,i.y=i.h*t.yd.y}function Ju(t,e,r,i){var n=t.getCapabilities().lookAt.zoom.max,o=e.wb(),a=i||o;if(e.Im()||r&&i)r=r===A?n:r;else{var s=new Kh(t.pixelProjection.projection);s.Va(n);var l=s.Gb(e.Oc()).round(),u=s.Gb(e.Mc()).round();n=s.w,e.qc()&&(l.x-=n),i?(o=s.Gb(a),e=2*ld(o.x-l.x,u.x-o.x),l=2*ld(o.y-l.y,u.y-o.y)):(e=u.x-l.x,l=u.y-l.y,a=o),r===A&&(r=(o=t.rl[4]).right-o.left,o=o.bottom-o.top,r=tk(t,r=-8+kd(qd(r/e*n)/Ad,qd(o/l*n)/Ad)-t.Ab))}return{zoom:nd(r),position:a}}function Hu(t,e){return tk(t,tk(t,e-t.Ab)+t.Ab)}Z.prototype.getState=function(){return this.s},Z.prototype.getState=Z.prototype.getState,Z.prototype.Ej=function(t,e){return pd(t=e-t)<this.pixelProjection.w/2?t:t-this.pixelProjection.w*e/pd(e)},Z.prototype.ar=function(t){var e=this,r=t.animate,i=t.newValue,n=t.modifiers;t=i.position;var o,a=i.bounds,s=this.zoom,l=this.yd,u=0;if(n&Gj.POSITION&&(o=e.pixelProjection.Gb(t)),n&Gj.BOUNDS)i=Ju(this,a.C(),n&Gj.ZOOM?i.zoom:A,n&Gj.POSITION?t:A),this.Ee.ad(i,r);else{n&Gj.POSITION||(o=e.pixelProjection.Gb(i.position));var c=o.x,h=o.y;this.Jg(),this.Xb.set(0,0);var p=(i=this.Do(i)).zoom,f=i.position;if(r){var d=p-s,y={x:l.x,y:l.y};r=this.pixelProjection.bi(y).x;var g=this.pixelProjection.projection.Se(t);g.x===this.yd.x&&g.y===this.yd.y&&p===this.zoom||(c=this.Ej(r,c),this.cd((function(t){var r=t-u;if(p!==s){o=e.pixelProjection.bi(g);var i=e.pixelProjection.bi(y);c=e.Ej(i.x,o.x),h=o.y-i.y}u=t,e.Sg(c*r,h*r),s+=d*r,e.sb(s),e.rb(),e.ba()}),this.vl,(function(){Iu(e,f,p),e.sb(p),e.rb(f),e.ba()}),this.wl))}else this.dd(),Iu(this,f,p),this.sb(p),this.rb(f);this.ba()}},Z.prototype.vl=300,Z.prototype.Wn=function(t){var e=jb(t);if(!e||e&&0>t)throw new C(this.Wn,1,"positive number required");this.vl=t},Z.prototype.setAnimationDuration=Z.prototype.Wn,Z.prototype.zp=function(){return this.vl},Z.prototype.getAnimationDuration=Z.prototype.zp,Z.prototype.wl=Jk,Z.prototype.Xn=function(t){if(!Za(t))throw new C(this.Xn,1,"function required");this.wl=t},Z.prototype.setAnimationEase=Z.prototype.Xn,Z.prototype.Ap=function(){return this.wl},Z.prototype.getAnimationEase=Z.prototype.Ap,Z.prototype.Qn=function(){this.wl=Jk,this.vl=300},Z.prototype.resetAnimationDefaults=Z.prototype.Qn,m=Z.prototype,m.Uq=function(t,e,r){var i;this.$j=Fk(),(i=this.Zh.ka.splice(t,1)[0])&&i.l&&i.l(),(i=this.Mf.ka.splice(t,1)[0])&&i.l&&i.l(),(i=this.ri.ka.splice(t,1)[0])&&i.l&&i.l(),(i=this.pi.ka.splice(t,1)[0])&&i.l&&i.l(),this.bf=this.ib.Ta(),0===t&&(sk(this,e,!1),this.Ac()),this.Ge=Zk(this.cl,this.Tf(),this.Qf()),this.li(),r||this.ba()},m.gq=function(){var t=this.ib.Ta(),e=0,r=t.length;for([this.Zh={},this.Mf={},this.ri={},this.pi={}].forEach((function(t){t.Qe=[],t.ka=[]})),this.bf=this.ib.Ta();e<r;e++)this.pk(e,t[e]);this.Ac()},m.Vq=function(){this.Ac(),this.ba()},m.hq=function(t,e,r){var i,n,o,a;if(e){var s={Qd:this.tj,Ab:this.Ab};e.L?B(e,Rh)?n=new $k(e):B(e,Th)&&(a=new $k(e)):(e.requestOverlays&&(i=new Eu(e,s)),e.requestTiles&&(n=new Bu(e,s)),e.requestMarkers&&(o=new Au(e,s)),e.requestDomMarkers&&(a=new dl(e,s)))}r=r||0,this.Zh.ka.splice(t,r,i),this.Mf.ka.splice(t,r,n),this.ri.ka.splice(t,r,o),this.pi.ka.splice(t,r,a),this.bf=this.ib.Ta(),this.Ge=Zk(this.cl,this.Tf(),this.Qf())},m.Qf=function(){var t=[];return(t=(t=(t=(t=t.concat(this.Mf.ka)).concat(this.Zh.ka)).concat(this.ri.ka)).concat(this.pi.ka)).filter(ab)},m.Po=function(){return this.s===Gu},m.Do=function(t){var e=tk(this,tk(this,t.zoom)+this.Ab);return(t=uk(this,t)).zoom=e,t},m.Wa=function(t,e){var r=this.za.center,i=this.ja;return this.pixelProjection.Za((t-r.x)*i,(e-r.y)*i)},Z.prototype.screenToGeo=Z.prototype.Wa,Z.prototype.Un=function(t,e){return t=this.Wa(t,e),(e=this.Ee.Ib()).position=t,e},Z.prototype.La=function(t){var e=this.ja,r=this.za.center,i=r.x*e;r=r.y*e,t=this.pixelProjection.Gb(t);var n=this.pixelProjection.w;return new K(md((t.x-md(t.x/n)*n+i)/e),md((t.y+r)/e))},Z.prototype.geoToScreen=Z.prototype.La,Z.prototype.C=function(t,e){var r=this.rl[t||4];t=this.pixelProjection;var i=r.left-e,n=t.Za(i,r.top-e),o=r.right+e;return e=t.Za(o,r.bottom+e),o-i>=t.w&&(n.lng=-(e.lng=180)),Ee(n,e)},Z.prototype.Ma=function(t,e,r,i){var n,o=[],a=this.ja;for(t*=a,e*=a,n=(a=[this.Zh,this.Mf,this.ri,this.pi]).length;n--&&(!r||!o.length);)o=this.Mp(o,a[n].ka,t,e,r);i(o)},Z.prototype.getObjectsAt=Z.prototype.Ma,m=Z.prototype,m.Mp=function(t,e,r,i,n){for(var o,a=e.length;a--&&!((o=e[a])&&o.Ma&&(t=t.concat(o.Ma(r,i,n)),t.length&&n)););return t},m.ye=x,m.Tf=function(){var t=this.rl[2];return{w:t.right-t.left,h:t.bottom-t.top}},m.ng=function(){var t,e=this.Ge.length;Z.g.ng.call(this);var r=this.Tf();this.Xb.set(0,0);var i=r.w;for(t=r.h;e--;){var n=(r=this.Ge[e]).mc();n.w===i&&n.h===t||r.Uk(i,t)}this.ye=new Ph(i,t),this.ba()},m.getCapabilities=function(){return Du},Z.prototype.getCapabilities=Z.prototype.getCapabilities,m=Z.prototype,m.Lk=function(){this.ta&&this.ta.R||Fk()-this.$j<this.Kg&&!this.oe?this.rh=Dk(this.wg):(this.oe&&(this.li(),this.pj()),this.s=Gu)},m.li=function(){this.Zh.Qe.length=0,this.Mf.Qe.length=0,this.ri.Qe.length=0,this.pi.Qe.length=0},m.wg=function(){var t;this.ff&&this.ff.before();var e=this.Mf.ka,r=this.za.center.clone().scale(this.ja).round(),i=this.C(1,0),n=this.C(1,Ku),o=this.zoom,a=o-this.Ab,s=this.pixelProjection,l=this.Dw,u=this.Cw,c=e[0];e=this.Xb;var h=this.Ge.length,p=this.bf;for(t=p.length;h--;){var f=this.Ge[h];B(f,Wk)&&f.clear()}if(c){if(l)for(;l;)h=o-l,c.L(i,r,s,h,!0,e),--l;if(u&&this.xs)for(f=1;f<=u&&(h=o+f,s.Va(h),l=this.C(2,0),s.Va(o),!c.L(l,r,s,h,!0,e));f++);}for(this.Kg=Fu;t--;)B(s=p[t],Nh)&&s.D&&s.D.xk(n,a);i=this.Ln(i,r,o,!1,e,Lu,this.Mf,this.Zh),r=this.Ln(n,r,a,!1,e,Mu,this.ri,this.pi),this.oe=i&&r,this.ta&&this.ta.R&&this.Fo(),this.vf||(this.vf=this.Ee.Ib()),this.vf.bounds=this.C(4,0),this.Ee.rb(this.vf),this.vf=null,this.ye&&(this.za.rb(this.ye),this.ye=x),o<this.jv?this.xs=!0:this.bv&&(this.xs=!1),this.jv=o,this.bv=i,this.ff&&this.ff.after(),this.Lk()},m.Ln=function(t,e,r,i,n,o,a){var s,l=Array.prototype.slice.call(arguments,6),u=l.length,c=l[0].ka.length,h=u*c,p=!!h;for(s=0;s<h;s++){if(o===Lu)var f=s%u,d=Math.floor(s/u);else f=Math.floor(s/c),d=s%c;var y=l[f].ka[d];f=l[f].Qe,y&&((y=y.L(t,e,this.pixelProjection,r,i,n,this.La))===vg.ACTIVE&&(this.Kg=1/0),y!==vg.DONE||f[d]||(this.pj(this.bf[d]),f[d]=!0),f[d]||(p=!1))}return p},m.pj=function(t){this.dispatchEvent({type:this.j.Us,target:t||this})},m.disposeInternal=function(){var t=this.ib.Ta()[0],e=this.za;Ek(this.rh),this.dd(!0),t&&sk(this,t,!1),this.Qf().forEach((function(t){t.l()})),e.element&&e.element.removeChild(this.rc),this.rc=null,this.s=3,Z.g.disposeInternal.call(this)},m.ba=function(){this.$j=Fk(),this.Po()&&(this.oe=!1,this.s=1,this.Lk())},m.Bc=function(t,e){this.Sg(t*this.ja,e*this.ja),this.Xb.set(0,0),this.rb(),this.ba()},m.Sg=function(t,e){var r=this.pixelProjection,i=this.yd;r.x=Ld(r.x+t,r.w),r.y=ld(0,kd(r.w,r.y+e)),i.x=r.x/r.w,i.y=r.y/r.h},m.Ng=function(t,e,r){t=tk(this,tk(this,t)+this.Ab),this.sb(t,e,r)},Z.prototype.zoomAt=Z.prototype.Ng,Z.prototype.sb=function(t,e,r){var i=this.ja,n=this.za.center;e===+e&&r===+r?(e=(e-n.x)*i,r=(r-n.y)*i,this.Xb.set(e,r),this.Sg(e,r),this.pixelProjection.Va(t),this.Sg(-e,-r)):(this.Xb.set(0,0),this.pixelProjection.Va(t)),this.zoom=t,this.rb(),this.ba()},Z.prototype.Jg=function(){this.dd(!0),this.T.R&&this.hc(!0),this.na.R&&this.ic(!0),this.dd(!0)},Z.prototype.Jd=function(t,e){this.Jg(),this.Rk(e),this.na.start(t,!!e)},Z.prototype.startInteraction=Z.prototype.Jd,Z.prototype.Rk=function(t){if(t){var e={};e.wk=t.power,e.sj=t.ease,e.duration=t.duration,this.ua=e}},Z.prototype.wd=function(t,e,r,i,n){var o=!1;this.na.R&&(e=this.na.store(t,e,r,i,n),this.na.ae(rk.COORD)&&0<Rl(t=this.na.Ah())&&(this.Bc(-t.x,-t.y),o=!0),e&&this.na.ae(rk.ZOOM)&&(t=this.na.im(),e=this.na.jm(),(e=qd(sd(2,this.zoom)*e)/Ad)!==this.zoom&&(e=Hu(this,e),this.sb(e,t.x,t.y),o=!0)),o&&this.ba())},Z.prototype.interaction=Z.prototype.wd,Z.prototype.ic=function(t){var e=this;if(this.na.R&&!t){if(this.ua){t=this.na.nc();var r=this.na.Nf(),i=this.ua.duration,n=(this.ua.wk||1)*t,o=new $l(-n/(0<i?i:1),n);!D(r.x)&&!D(r.y)&&0<n&&e.na.ae(rk.COORD)&&this.cd((function(t){n=o.Hj(t*i),D(n)||e.Bc(md(-r.x*n),md(-r.y*n))}),i,void 0,this.ua.sj)}this.ua=null,this.na.clear()}},Z.prototype.endInteraction=Z.prototype.ic,Z.prototype.Id=function(t,e,r){this.Jg(),this.T.start(e,r),this.Rk(t)},Z.prototype.startControl=Z.prototype.Id,Z.prototype.control=function(t,e,r){if(D(+r))throw new C(this.control,2,r);if(D(t))throw new C(this.control,0,t);if(D(e))throw new C(this.control,1,e);this.T.R&&this.T.set(t,e,r,0,0,0)},Z.prototype.control=Z.prototype.control,Z.prototype.hc=function(t,e){var r,i=this;if(this.T.R){this.dd(!0);var n=Fk(),o=n-this.jj;if(1<=o){var a=Uk(this.T);this.Qi(a,o)}if(!this.ua||t||e)"function"==typeof e&&((t=this.Ib()).zoom=this.zoom-this.Ab,e(t),t.zoom+=this.Ab,this.Go(t));else{e=this.T.nc();var s=this.T.Nf(),l=this.ua.duration,u=(this.ua.wk||1)*e,c=new $l(-u/(0<l?l:1),u);!D(s.Lb)&&!D(s.Mb)&&0<u&&this.cd((function(t,e,o,a){n&&(o=a-n,n=0),u=c.Hj(t*l)*o,D(u)||((r=s.Nb*u)&&i.sb(Hu(i,i.zoom+r),i.T.Ug,i.T.Vg),i.Bc(md(s.Lb*u),md(s.Mb*u)))}),l,void 0,this.ua.sj)}this.T.reset()}},Z.prototype.endControl=Z.prototype.hc,m=Z.prototype,m.Go=function(t){var e=this,r=this.yd,i=this.pixelProjection.projection.Se(t.position),n=this.pixelProjection.bi(i),o=n.y;n=n.x;var a=t.zoom;t=(r=this.pixelProjection.bi(r)).y;var s=r.x;r=this.zoom;var l=this.T.nc(),u=this.T.Ug,c=this.T.Vg,h=0;if(n=this.Ej(s,n),t=rd((n-=s)*n+(o-=t)*o+(r=a-r)*r),0!==l&&0!==t){var p=n/t,f=o/t,d=r/t,y=l*l/(2*t);this.cd((function(t,r){var n;1!==t?((n=d*(r=(t=l*r-y*r*r/2)-h))&&(n=Hu(e,e.zoom+n),e.sb(Hu(e,n),u,c)),e.Bc(md(p*r),md(f*r)),h=t):(e.yd=i,e.sb(Hu(e,a),u,c),e.rb(),e.ba())}),2*t/l)}},m.gg=function(t){var e=this,r=t.mt;this.Xb.set(0,0),r.Lb||r.Mb||r.Nb?(this.jj=Fk(),this.cd((function(t,i,n,o){e.jj=o,e.Qi(r,n)}),Number.POSITIVE_INFINITY),this.ba()):this.dd(!0)},m.Qi=function(t,e){e=e||0,t.Nb&&this.sb(Hu(this,this.zoom+t.Nb*e),this.T.atX,this.T.atY),this.Bc(t.Lb*e,t.Mb*e)},m.cd=function(t,e,r,i){this.ta&&this.ta.R&&this.ta.stop(!0),this.ta=new jl(this,t,e,r,i),this.ta.start()},m.dd=function(t){this.ta&&this.ta.R&&this.ta.stop(t)},m.kp=function(){},Z.prototype.enter=Z.prototype.kp,Z.prototype.pp=function(t){qk(this.rc,t)},Z.prototype.exit=Z.prototype.pp,Z.prototype.capture=function(t,e,r,i){var n=this.rc.ownerDocument.createElement("canvas"),o=n.getContext("2d"),a=this.ja;for(n.width=(r-t)*a,n.height=(i-e)*a,r=0;r<this.Ge.length;r++)B(i=this.Ge[r],Wk)&&o.drawImage(i.B(),-t*a,-e*a);return cc(n)};var Mu=0,Lu=1,Fu=1e3,Ku=256;function Nu(t){var e;if(t)for(Ou={},e=t.length;e--;)Ou[t[e]]=!0;this.ix={}}var Pu,Ou={};Nu.prototype.parse=function(t,e,r){var i,n,o,a,s;Pu=!1;try{r=JSON.parse(r)}catch(t){Pu=!0}if(r&&(i=r.metadata)){var l={spatials:[]};for(n in i)if((r=!Ou[n]&&(o=Qu[n]))&&((a=i[n])||(Pu=!0,a=void 0),r=a),r)for(r=a.length;r--;){var u;(u=a[r])||(Pu=!0,u=void 0),(s=u)&&o(e,t,this,n,s,l)}}else Pu=!0;return Pu?void 0:l},Nu.prototype.parse=Nu.prototype.parse;var Qu={"street labels":function(t,e,r,i,n,o){var a;if((a=n.vertices)||(Pu=!0,a=void 0),a){var s,l,u=a.length;if((l=0<u)||(Pu=!0,l=void 0),l)for(s=Array(u/2);u;){var c=a[--u];l=a[--u],s[u/2]=new K(l,c)}s=s?{Tc:[s]}:A,u=+n["font size"]/t.lb(),(a=r.ix[u])||(Ru.lineWidth=u,a=r.ix[u]=r.gh.fu(Ru)),Su(t,e,s,!1,a,n,i,o)}delete n.vertices},"city center labels":function(t,e,r,i,n,o){Su(t,e,Tu(n,new Hf([])),!0,r.gh,n,i,o)},labels:function(t,e,r,i,n,o){var a;if((a=n["bounding boxes"])||(Pu=!0,a=void 0),a){for(var s,l=a.length,u=new Hf([]);l--;){var c;(c=a[l])||(Pu=!0,c=void 0),(s=c)&&Tu(s,u)}Su(t,e,u,!0,r.gh,n,i,o)}delete n["bounding boxes"]},buildings:function(t,e,r,i,n,o){var a,s,l,u,c=n.id,h=e.Jn[c],p=[],f=[];(a=n)||(Pu=!0,a=void 0),a&&((s=a.vertices)||(Pu=!0,s=void 0),s)&&((u=a.polygons)||(Pu=!0,u=void 0),(l=u)&&p.push.apply(p,Uu(s,l)),(a=a.outlines)||(Pu=!0,a=void 0),(l=a)&&f.push.apply(f,Uu(s,l))),l=p.length,p.push.apply(p,f),f=new Hf(p,Id,l),(p=p.length)||(Pu=!0,p=void 0),p&&(h?(dp(h,t,[f]),o.spatials.push(h)):(h=Su(t,e,f,!0,r.gh,n,i,o,c),e.Y(h)))}};Qu["transit stops"]=Qu.POIs=Qu.labels;var Vu=["box 2","box 1","annotation box","icon box"];function Tu(t,e){for(var r,i,n=Vu.length;n--;)if(i=t[r=Vu[n]]){var o=i[0],a=i[1],s=i[2];i=i[3],e.Tc.push([new K(o,a),new K(o+s,a),new K(o+s,a+i),new K(o,a+i)]),delete t[r]}return e}function Uu(t,e){var r,i,n,o=e.length;if(0<o)for(i=Array(o);o--;)if((r=e[o])||(Pu=!0,r=void 0),r){var a=r.length;if(0<a)for(i[o]=n=Array(a);a--;){var s=2*r[a];n[a]=new K(t[s],t[s+1])}}return i||[]}var Wu={};function Su(t,e,r,i,n,o,a,s,l){return Wu.style=n,i=new $o(e,i,l,Wu),r&&dp(i,t,[r]),Xu(o),o.category=a,i.setData(o),s.spatials.push(i),i.ea(e),i}Nu.prototype.gh=new M({strokeColor:"transparent",fillColor:"transparent",lineWidth:0});var Ru={};function Xu(t){var e,r=!1;switch(typeof t){case"object":if(t instanceof Array)for(e=t.length;e--;)Xu(t[e])?r=!0:delete t[e];else if(t)for(e in t)Xu(t[e])?r=!0:delete t[e];break;case"number":r=!0;break;default:r=!!t}return r}function Yu(t,e,r){e=e||{};var i=(r=r||{}).tileType||"maptile",n=r.scheme||"normal.day";if(R.call(this,{min:0,max:20}),!0===e.pois&&(e.pois="!F"),this.Ga=e,!(t&&t instanceof Zu))throw Error("InvalidArgument: service required");this.$=t,this.Ce=z(this.Ce,this),this.$.addEventListener("versionupdate",this.Ce),this.md=t.i().clone().A(i+"/"+t.fb+"/"+n).u($u).u(e),this.bd=t.bd||null,this.oa=r.pixelRatio||r.pixelratio||Vd(),this.tileSize=r.tileSize||256,this.tileType=i,this.scheme=n,this.vs=0,this.Bd=new hp(new Nu(r.categoryFilter)),this.Bd.ea(this),this.he=z(this.he,this),this.Bd.addEventListener("update",this.he),this.Ye=!1,R.call(this,{min:0,max:20}),this.Yn(new kj(r.tileCacheSize||256,z(this.ke,this)))}u(Yu,R),t("H.service.metaInfo.TileProvider",Yu),Yu.prototype.ke=function(t,e){for(var r,i=(t=e.bb()).length;i--;)delete(r=t[i]).Fk[e.key],r.release();e.data&&(vo.push(e.Hn(),this.tileSize),e.In())},Yu.prototype.he=function(){this.dispatchEvent("update")},Yu.prototype.o=function(t,e,r,i,n){var o,a=this.md.clone(),s=this.bd,l=this.tileSize,u=this.getTileKey(t,e,r);if((u=this.Sb().get(u))&&!u.Ih()){i(vo.pop(this.tileSize),null);var c={cancel:function(){}}}else{s&&a.la(s[(r+e+t)%s.length]),a.A(r+"/"+t+"/"+e+"/"+l+"/png8");var h=globalThis.setTimeout((function(){(o=new nh("text/plain",a.toString())).then((function(t){i(null,t)}),n)}),500)}return this.Ye||(io(Yu,"Use HERE Vector Tile API or Raster Tile API v3 instead."),this.Ye=!0),c||{cancel:function(){o?o.cancel():globalThis.clearTimeout(h)}}},Yu.prototype.requestInternal=Yu.prototype.o,Yu.prototype.pd=function(t,e,r,i,n){var o=this.Bd,a=i||vo.pop(this.tileSize);if(i)(t=this.Sb().get(this.getTileKey(t,e,r))).L(i);else if(delete(i=t=new ol(this.Vd(t,e,r),t,e,r,this.tileSize,this.oa,r+this.vs,o)).Ji,i.ul=n,t.L(a))for(a=(n=t.bb()).length;a--;)n[a].Sn();else vo.push(a,this.tileSize);return t},Yu.prototype.createTileInternal=Yu.prototype.pd,Yu.prototype.l=function(){this.Bd.l(),this.$.removeEventListener("versionupdate",this.Ce),R.prototype.l.call(this)},Yu.prototype.dispose=Yu.prototype.l,Yu.prototype.Ce=function(){var t=this.$;this.md=t.i().clone().A(this.tileType+"/"+t.fb+"/"+this.scheme).u($u).u(this.Ga),this.reload(!1)};var $u={metadata:"metaonly",mgen:"2"},a;function Zu(t){Zu.g.constructor.call(this,Zu,t),t=zo(this,t),this.bd=t.shards,(this.Ra=t.ignoreTypes?null:t.type)&&this.i().la(this.Ra),this.fb=t.version,this.pr={},this.ec=new No,"newest"===this.fb&&this.rp()}function av(t,e){for(var r={},i=t[e+"s"][e],n=i.length;n--;)r[i[n].id]=i[n];t[e+"s"]=r}u(Zu,yo),t("H.service.metaInfo.Service",Zu),Zu.prototype.Da=function(){return{type:"base",version:"newest",subDomain:"maps.ls",path:"maptile/2.1",shards:["1","2","3","4"]}},Zu.CONFIG_KEY="metaInfo",Zu.prototype.vu=function(){return this.Ra},Zu.prototype.Wp=function(){return this.fb},Zu.prototype.getVersion=Zu.prototype.Wp,Zu.prototype.cs=function(t){this.fb=t},Zu.prototype.U=function(){return this.ec},Zu.prototype.getCopyrights=Zu.prototype.U,Zu.prototype.ss=function(t){var e;if(av(t=t.response,"map"),av(t,"scheme"),av(t,"tiletype"),av(t,"format"),av(t,"resolution"),av(t,"language"),"newest"===this.fb&&"traffic"!==this.Ra)for(e in t.maps)t.maps[e].hash&&t.maps[e].newest&&(this.cs(t.maps[e].hash),this.dispatchEvent("versionupdate"));this.fq=t,this.dispatchEvent("infoupdate")},Zu.prototype.rp=function(){var t=this,e=this.i().clone().A("info").u({output:"json"});this.bd&&e.la(this.bd[0]),this.o(e,(function(e){t.ss(e)}),(function(t){throw t}))},Zu.prototype.Kj=function(){return this.fq},Zu.prototype.getInfo=Zu.prototype.Kj,Zu.prototype.nj=function(t,e,r,i,n,o){return new Yu(this,i,{tileSize:t,pixelRatio:e,categoryFilter:r,tileType:n,scheme:o})},Zu.prototype.createTileProvider=Zu.prototype.nj,Zu.prototype.Pd=function(t,e,r,i,n,o){return new kl(this.nj(t,e,r,i,n,o))},Zu.prototype.createTileLayer=Zu.prototype.Pd,X.prototype.mu=function(t){return this.Ja(Zu,t)},X.prototype.getMetaInfoService=X.prototype.mu,a=X.prototype.createDefaultLayers,X.prototype.createDefaultLayers=function(t,e,r,i,n,o){var s=a.call(this,t,e,r,i,n,o),l={},u=this.mu();"object"==typeof t&&(t=(o=t).tileSize,e=o.ppi,r=o.lg,i=o.lg2,n=o.style,o=o.pois),t=t||256;var c=320===e?2:1;if(0>[72,250,320,500].indexOf(+e)){if(e!==A)throw new C(this.Xl,1,e)}else l.ppi=+e;return r&&(l.lg=r),i&&(l.lg2=i),n&&(l.style=n),o&&(l.pois=o),s.raster.normal.metaInfo=u.Pd(t,c,["buildings"],l),s},H.__bootstrap__='/*\n\n Copyright The Closure Library Authors.\n SPDX-License-Identifier: Apache-2.0\n*/\nvar l;function ba(a){a=["object"==typeof globalThis&&globalThis,a,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof global&&global];for(var b=0;b<a.length;++b){var c=a[b];if(c&&c.Math==Math)return c}throw Error("Cannot find global object");}var ca=ba(this);function da(a){var b=0;return function(){return b<a.length?{done:!1,value:a[b++]}:{done:!0}}}\nvar ea="function"==typeof Object.defineProperties?Object.defineProperty:function(a,b,c){if(a==Array.prototype||a==Object.prototype)return a;a[b]=c.value;return a};function fa(a,b){if(b)a:{var c=ca;a=a.split(".");for(var d=0;d<a.length-1;d++){var e=a[d];if(!(e in c))break a;c=c[e]}a=a[a.length-1];d=c[a];b=b(d);b!=d&&null!=b&&ea(c,a,{configurable:!0,writable:!0,value:b})}}\nfa("Symbol",function(a){function b(f){if(this instanceof b)throw new TypeError("Symbol is not a constructor");return new c(d+(f||"")+"_"+e++,f)}function c(f,g){this.fc=f;ea(this,"description",{configurable:!0,writable:!0,value:g})}if(a)return a;c.prototype.toString=function(){return this.fc};var d="jscomp_symbol_"+(1E9*Math.random()>>>0)+"_",e=0;return b});\nfa("Symbol.iterator",function(a){if(a)return a;a=Symbol("Symbol.iterator");for(var b="Array Int8Array Uint8Array Uint8ClampedArray Int16Array Uint16Array Int32Array Uint32Array Float32Array Float64Array".split(" "),c=0;c<b.length;c++){var d=ca[b[c]];"function"===typeof d&&"function"!=typeof d.prototype[a]&&ea(d.prototype,a,{configurable:!0,writable:!0,value:function(){return ha(da(this))}})}return a});function ha(a){a={next:a};a[Symbol.iterator]=function(){return this};return a}\nfa("globalThis",function(a){return a||ca});function ka(a,b){a instanceof String&&(a+="");var c=0,d=!1,e={next:function(){if(!d&&c<a.length){var f=c++;return{value:b(f,a[f]),done:!1}}d=!0;return{done:!0,value:void 0}}};e[Symbol.iterator]=function(){return e};return e}fa("Array.prototype.keys",function(a){return a?a:function(){return ka(this,function(b){return b})}});var la;\nif("function"==typeof Object.setPrototypeOf)la=Object.setPrototypeOf;else{var ma;a:{var na={a:!0},oa={};try{oa.__proto__=na;ma=oa.a;break a}catch(a){}ma=!1}la=ma?function(a,b){a.__proto__=b;if(a.__proto__!==b)throw new TypeError(a+" is not extensible");return a}:null}var pa=la;fa("Object.setPrototypeOf",function(a){return a||pa});var p=this||self;\nfunction qa(a,b,c,d){a=a.split(".");d=d||p;a[0]in d||"undefined"==typeof d.execScript||d.execScript("var "+a[0]);for(var e;a.length&&(e=a.shift());)if(a.length||void 0===b)d=d[e]&&d[e]!==Object.prototype[e]?d[e]:d[e]={};else if(!c&&ra(b)&&ra(d[e]))for(var f in b)b.hasOwnProperty(f)&&(d[e][f]=b[f]);else d[e]=b}function sa(){}function ta(a){var b=typeof a;return"object"!=b?b:a?Array.isArray(a)?"array":b:"null"}function ra(a){var b=typeof a;return"object"==b&&null!=a||"function"==b}\nfunction ua(a){return Object.prototype.hasOwnProperty.call(a,ya)&&a[ya]||(a[ya]=++za)}var ya="closure_uid_"+(1E9*Math.random()>>>0),za=0;function Aa(a,b,c){return a.call.apply(a.bind,arguments)}function Ba(a,b,c){if(!a)throw Error();if(2<arguments.length){var d=Array.prototype.slice.call(arguments,2);return function(){var e=Array.prototype.slice.call(arguments);Array.prototype.unshift.apply(e,d);return a.apply(b,e)}}return function(){return a.apply(b,arguments)}}\nfunction Ca(a,b,c){Ca=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?Aa:Ba;return Ca.apply(null,arguments)}function Da(a,b){var c=Array.prototype.slice.call(arguments,1);return function(){var d=c.slice();d.push.apply(d,arguments);return a.apply(this,d)}}function r(a,b){qa(a,b,!0,void 0)}\nfunction Fa(a,b){function c(){}c.prototype=b.prototype;a.Z=b.prototype;a.prototype=new c;a.prototype.constructor=a;a.Cd=function(d,e,f){for(var g=Array(arguments.length-2),h=2;h<arguments.length;h++)g[h-2]=arguments[h];return b.prototype[e].apply(d,g)}};function Ga(){var a=Ha,b;for(b in a)return!1;return!0}function Ia(a){var b={},c;for(c in a)b[c]=a[c];return b}var Ja="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function Ka(a,b){for(var c,d,e=1;e<arguments.length;e++){d=arguments[e];for(c in d)a[c]=d[c];for(var f=0;f<Ja.length;f++)c=Ja[f],Object.prototype.hasOwnProperty.call(d,c)&&(a[c]=d[c])}};function La(a){if(Error.captureStackTrace)Error.captureStackTrace(this,La);else{var b=Error().stack;b&&(this.stack=b)}a&&(this.message=String(a))}Fa(La,Error);La.prototype.name="CustomError";var Ma=Array.prototype.indexOf?function(a,b){return Array.prototype.indexOf.call(a,b,void 0)}:function(a,b){if("string"===typeof a)return"string"!==typeof b||1!=b.length?-1:a.indexOf(b,0);for(var c=0;c<a.length;c++)if(c in a&&a[c]===b)return c;return-1};var Na=Ca,Oa=String,Pa=globalThis.Object.freeze||function(a){return a},t=[].pop(),Qa=/x/.exec("");function Ra(a){return Oa(a).split(","!==t?",":" ")}var Sa="prototype constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function Ta(a,b,c,d){if(!(b=a instanceof b)&&c)throw new x(c,d,void 0!==t?void 0:a);return b}function Ua(a){return"function"==ta(a)}function Va(a,b,c,d){var e;if(!(e="Array"===Wa(a))&&b)throw new x(b,c,d!==t?d:a);return e}\nr("H.lang.isArray",function(a,b,c,d){return Va(a,b,c,d)});function Xa(a){return"string"===typeof a}r("H.lang.isString",Xa);var Ya=isNaN;function $a(a){return a===+a}r("H.lang.isNumber",$a);r("H.lang.isInteger",Number.isInteger?Number.isInteger:function(a){return"number"===typeof a&&0===a%1});function Wa(a){var b=Object[Sa[0]][Sa[6]].call(a).match(/^\\[object (\\w+)\\]$/);return b?b[1]:typeof a}var ab=[];0>ab.indexOf(ab)&&ab.push(ab);\nfunction bb(a,b,c,d){var e="",f=2>arguments.length,g;f&&(b={H:globalThis.H},c="",d=ab.slice());cb(b,!0,function(h,k){try{if(g=h[k],k=db(h,g),!(ra(g)&&g.window===g&&g.self===g||ra(g)&&0<g.nodeType&&Ua(g.cloneNode))&&ra(g)){if(g===a)return e=c+"."+k,!0;if(0>d.indexOf(g)&&(d.push(g),e=bb(a,g,c+"."+k,d)))return!0}}catch(m){}});f&&(e=e?e.substr(1).replace("."+Sa[0]+".","#"):"~"+(Ua(a)?eb(a)+"()":Wa(a)));return e}\nfunction db(a,b){var c=[];cb(a,!1,function(d,e){d[e]===b&&c.push(e)});return c.sort(fb)[0]}function fb(a,b){return b.length-a.length}var gb=Object[Sa[0]][Sa[2]];function cb(a,b,c){var d;if(a){for(e in a)if((!b||gb.call(a,e))&&c(a,e,!0))return;for(d=Sa.length;d--;){var e=Sa[d];if((!b||gb.call(a,e))&&c(a,e,!1))break}}}function eb(a){return(a=/^\\s*function ([^\\( ]+)/.exec(a))?a[1]:"anonymous"}function hb(a,b,c){c[b]="#"+b}\nfunction x(a,b,c){var d=arguments.length;b=b!==t?+b:b;if(b!==t){var e=(e=/^.*?\\(([^\\)]+)/.exec((""+a).replace(/(\\/\\*([\\s\\S]*?)\\*\\/)|(\\/\\/(.*)$)/gm,"")))?Ra(e[1].replace(/\\s+/g,"")):[];e.forEach(hb);e=e[b]||"#"+b}var f=a?bb(a):"";d=2<d?Oa(c):"";if(e||d)f+=" (Argument "+(e||"")+(d?" "+d:"")+")";d=Error(f);Object.setPrototypeOf(d,x.prototype);return d}Fa(x,Error);r("H.lang.InvalidArgumentError",x);x.prototype.name="InvalidArgumentError";\nfunction ib(a,b){var c=[];a&&c.push(bb(a));1<arguments.length&&c.push(""+b);c=Error(c.join(" "));Object.setPrototypeOf(c,ib.prototype);return c}Fa(ib,Error);r("H.lang.IllegalOperationError",ib);ib.prototype.name="IllegalOperationError";var y=Math,jb=y.min,kb=y.max,lb=y.round,mb=y.floor,nb=y.ceil,ob=y.abs,pb=y.log,qb=y.sqrt,z=y.pow,rb=y.exp,sb=y.sin,tb=y.asin,ub=y.cos,vb=y.tan,wb=y.atan,xb=y.atan2,yb=y.LN2,A=y.PI,zb=A/2,Bb=A/4,Cb=2*A,Db=3*A,Eb=A/180,Fb=180/A,Gb=1/0;function Hb(a,b){var c;return 0>(c=a%b)===0>b?c:c+b}r("H.math.normalize",function(a,b,c){b-=c=c||0;a-=c;return a-mb(a/b)*b+c});function Ib(a,b,c){return(a-=0)>c?c:a<b?b:a}r("H.math.clamp",Ib);\nfunction Jb(a,b,c){var d=0;(d-=0)||(d=0);return b<c?a>=b-d&&a<=c+d:a>=c-d&&a<=b+d}var Kb={NONE:0,VERTEX:1,EDGE:2,SURFACE:3};r("H.math.CoverType",Kb);\nfunction Lb(a,b,c){for(var d=c.length,e=d,f,g,h,k,m=c[0],n=0,q=0,u=0;1!=n&&1<e;){e-=0;g=c[--e];f=c[--e];k=c[e?e-0-1:(d+(e-0-1))%d];h=c[e?e-0-2:(d+(e-0-2))%d];if(f>=a-0&&f<=a+0&&g>=b-0&&g<=b+0||h>=a-0&&h<=a+0&&k>=b-0&&k<=b+0)n=1;else if(!n&&f===a)h===a&&(g<b&&k>b||g>b&&k<b)||(m<=a&&h>a||m>=a&&h<a)&&(g>=b?++q:++u),n=Jb(b,g,k)&&0>=qb(z((a-h)*(g-k)-(b-k)*(f-h),2)/(z(f-h,2)+z(g-k,2)))?2:0;else if(!n&&Jb(a,f,h)){if(f<a&&h>a||f>a&&h<a)m=g+(a-f)/(h-f)*(k-g),q+=m>b,u+=m<b;n=Jb(b,g,k)&&0>=qb(z((a-h)*(g-k)-\n(b-k)*(f-h),2)/(z(f-h,2)+z(g-k,2)))?2:0}m=f}!n&&0!==u&&0!==q%2&&(n=3);return n}function Mb(a,b){return Lb(a.x,a.y,b)!==Kb.NONE}r("H.math.isPointInsidePolygon",Mb);function Nb(a){for(var b=a.length,c=new Float64Array(2*b),d=b&&a[0].x!==t;b--;){var e=a[b],f=b<<1;c[f]=d?e.x:e[0];c[f+1]=d?e.y:e[1]}return c}r("H.math.flatten",Nb);function B(a,b){this.x=+a;this.y=+b}r("H.math.Point",B);B.prototype.set=B;B.prototype.set=B.prototype.set;B.prototype.clone=function(a){a?(a.x=this.x,a.y=this.y):a=new B(this.x,this.y);return a};B.prototype.clone=B.prototype.clone;B.prototype.add=function(a){this.x+=a.x;this.y+=a.y;return this};B.prototype.add=B.prototype.add;B.prototype.sub=function(a){this.x-=a.x;this.y-=a.y;return this};B.prototype.sub=B.prototype.sub;B.prototype.scale=function(a,b){this.x*=a;this.y*=void 0===b?a:b;return this};\nB.prototype.scale=B.prototype.scale;B.prototype.round=function(){this.x=lb(this.x);this.y=lb(this.y);return this};B.prototype.round=B.prototype.round;B.prototype.floor=function(){this.x=mb(this.x);this.y=mb(this.y);return this};B.prototype.floor=B.prototype.floor;B.prototype.ceil=function(){this.x=nb(this.x);this.y=nb(this.y);return this};B.prototype.ceil=B.prototype.ceil;B.prototype.S=function(a){return!(!a||this.x!==a.x||this.y!==a.y)};B.prototype.equals=B.prototype.S;\nB.prototype.Kc=function(a,b){var c=b.x-a.x,d=b.y-a.y;var e=a;if(c||d)e=((this.x-a.x)*c+(this.y-a.y)*d)/(c*c+d*d),e=0>=e?a:1<=e?b:new B(a.x+e*c,a.y+e*d);return e};B.prototype.getNearest=B.prototype.Kc;B.prototype.eb=function(a){return qb(z(this.x-a.x,2)+z(this.y-a.y,2))};B.prototype.distance=B.prototype.eb;B.fromIPoint=function(a){if(!a)throw Error("invalid argument");return a instanceof B?a:new B(a.x,a.y)};function Ob(a,b,c){var d=a[b];a=a[b+1];this.Pb=[];this.Eb=0;this.oc=b;this.mc=[a-c,d-c,a+c,d+c]}Ob.prototype.Ia=function(a,b){var c=a[b];a=a[b+1];b=this.mc;return b[1]<=c&&c<=b[3]&&b[0]<=a&&a<=b[2]};Ob.prototype.T=function(){return this.oc};function Pb(a,b,c){var d=Ib(+a,-90,90);if(b&&Ya(d))throw new x(b,c,a);return d}function Qb(a,b,c){var d=+a;if(-180>d||180<d)d=Hb(d+180,360)-180;if(b&&Ya(d))throw new x(b,c,a);return d}function Rb(a,b,c){var d;if(a!==t&&Ya(d=+a)&&b)throw new x(b,c,a);return d}r("H.geo.isDBC",function(a,b){return 0>a!==0>b&&180<ob(b-a)});function C(){var a=C;if(!0===(Ta(this,a)&&this.constructor===a))throw new TypeError("Illegal constructor "+bb(a));}r("H.geo.AbstractGeometry",C);C.prototype.getBoundingBox=C.prototype.pa;C.prototype.equals=C.prototype.S;C.prototype.Xa="";C.prototype.kb="";C.prototype.toString=function(){return this.dc([this.Xa.toUpperCase()," "]).join("")};C.prototype.toString=C.prototype.toString;C.prototype.sd=function(){return{type:this.kb,coordinates:this.cc()}};C.prototype.toGeoJSON=C.prototype.sd;\nC.prototype.ib=function(){return{type:this.Xa,coordinates:this.jb(),boundingBox:this.pa().ib()}};C.prototype.forWorkerMessage=C.prototype.ib;function D(a,b,c){this.lat=Pb(a,D,0);this.lng=Qb(b,D,1);c!==t&&(this.alt=Rb(c,D,2))}Fa(D,C);r("H.geo.Point",D);D.prototype.S=function(a){return this===a||!!a&&this.lat===a.lat&&this.lng===a.lng&&(this.alt||0)===(a.alt||0)};D.prototype.equals=D.prototype.S;D.prototype.eb=function(a){if(this===a||this.lat===a.lat&&this.lng===a.lng)a=0;else{var b=this.lat*Eb;var c=a.lat*Eb;a=1.274200158E7*tb(jb(1,qb(z(sb((b-c)/2),2)+ub(b)*ub(c)*z(sb((this.lng*Eb-a.lng*Eb)/2),2))))}return a};\nD.prototype.distance=D.prototype.eb;\nD.prototype.vd=function(a,b,c){var d;if(c){if(d=b/6371000.79){b=a*Eb;a=Eb*this.lat;var e=sb(a);c=sb(d);var f=ub(d);d=Eb*this.lng;var g=ub(a);a=tb(g*ub(b)*c+e*f);b=xb(sb(b)*g*c,f-e*sb(a));b=(d+b+A)%(2*A)-A;b*=Fb;e=new D(a*Fb,(b+540)%360-180)}return e||this}a=(a%360+360)%360;if(0===(a+90)%180)return a=this.lng+b/(6371000.79*Cb*ub(this.lat*Eb))*(270===a?-360:360),new D(this.lat,(a+540)%360-180);if(b/=6371000.79)a*=Eb,e=this.lat*Eb,c=this.lng*Eb,d=e+b*ub(a),f=d-e,g=pb(vb(d/2+Bb)/vb(e/2+Bb)),g=Ya(f/g)?\nub(e):f/g,a=b*sb(a)/g,ob(d)>zb&&(d=0<d?A-d:-(A+d)),d=new D(d*Fb,((c+a+Db+(ob(e+f)>zb?A:0))%Cb-A)*Fb);return d||this};D.prototype.walk=D.prototype.vd;D.prototype.pa=function(){return new E(this.lat,this.lng,this.lat,this.lng)};D.prototype.getBoundingBox=D.prototype.pa;function Sb(a,b,c){var d=ra(a)&&!(Ya(a.lat=Pb(a.lat))||Ya(a.lng=Qb(a.lng))||a.alt!==t&&Ya(a.alt=Rb(a.alt)));if(!d&&b)throw new x(b,c,a);return d}D.validate=Sb;function Tb(a){if(!a)throw new x(Tb,0,a);return new D(a.lat,a.lng,a.alt)}\nD.fromIPoint=Tb;l=D.prototype;l.Xa="Point";l.dc=function(a){a.push("(",this.lng," ",this.lat,")");return a};l.kb="Point";l.cc=function(){return[this.lng,this.lat,this.alt||0]};l.jb=function(){return[this.lat,this.lng,this.alt||0]};function Ub(){}function Vb(a){return jb(1,kb(0,.5-pb(vb(Bb+zb*a/180))/A/2))}Ub.prototype.Oa=function(a,b,c){c?(c.x=b/360+.5,c.y=Vb(a)):c=new B(b/360+.5,Vb(a));return c};Ub.prototype.latLngToPoint=Ub.prototype.Oa;Ub.prototype.Ac=function(a,b){return this.Oa(a.lat,a.lng,b)};Ub.prototype.geoToPoint=Ub.prototype.Ac;function Wb(a){return 0>=a?90:1<=a?-90:Fb*(2*wb(rb(A*(1-2*a)))-zb)}\nUb.prototype.ka=function(a,b,c){c?(c.lat=Wb(b),c.lng=360*(1===a?1:Hb(a,1))-180):c=new D(Wb(b),360*(1===a?1:Hb(a,1))-180);return c};Ub.prototype.xyToGeo=Ub.prototype.ka;Ub.prototype.ed=function(a,b){return this.ka(a.x,a.y,b)};Ub.prototype.pointToGeo=Ub.prototype.ed;var Xb=new Ub;r("H.geo.mercator",Xb);r("H.util.constants.DEFAULT_MIN_ZOOM_LEVEL",0);r("H.util.constants.DEFAULT_MAX_ZOOM_LEVEL",22);function G(a,b){this.projection=a||Xb;this.ec=0;this.Da=this.exp=pb(b||256)/yb;Yb(this);this.y=this.x=0}r("H.geo.PixelProjection",G);var Zb=ob(24)+ob(-8);G.prototype.hd=Xb;G.prototype.projection=G.prototype.hd;G.prototype.x=0;G.prototype.x=G.prototype.x;G.prototype.y=0;G.prototype.y=G.prototype.y;G.prototype.w=z(2,Zb);G.prototype.w=G.prototype.w;G.prototype.Rc=z(2,Zb);G.prototype.h=G.prototype.Rc;\nG.prototype.Aa=function(a){if(Ya(a))throw new x(this.Aa,0,a);var b=this.x/this.w;var c=this.y/this.h;this.ec=a;this.Da=this.exp+a;Yb(this);this.x=b*this.w;this.y=c*this.h};G.prototype.rescale=G.prototype.Aa;function Yb(a){a.Da>Zb&&(a.Da=Zb);a.w=z(2,a.Da);a.h=z(2,a.Da)}G.prototype.Ob=function(){return this.ec||0};G.prototype.getZoomScale=G.prototype.Ob;G.prototype.zc=function(a,b){a=this.projection.Oa(a.lat,a.lng,b);a.x=a.x*this.w-this.x;a.y=a.y*this.h-this.y;return a};G.prototype.geoToPixel=G.prototype.zc;\nG.prototype.xb=function(a,b){return this.projection.ka((a.x+this.x)/this.w,(a.y+this.y)/this.h,b)};G.prototype.pixelToGeo=G.prototype.xb;G.prototype.ka=function(a,b,c){return this.projection.ka((a+this.x)/this.w,(b+this.y)/this.h,c)};G.prototype.xyToGeo=G.prototype.ka;G.prototype.sb=function(a,b,c){a=this.projection.Oa(a,b,c);a.x=a.x*this.w-this.x;a.y=a.y*this.h-this.y;return a};G.prototype.latLngToPixel=G.prototype.sb;G.prototype.fd=function(a){return new B(a.x*this.w-this.x,a.y*this.h-this.y)};\nG.prototype.pointToPixel=G.prototype.fd;var $b=new B(0,0);function ac(a,b,c,d,e){d[e]=b;d[e+1]=a}var bc=new G;function cc(a,b,c,d,e){bc.sb(a,b,$b);d[e]=$b.x;d[e+1]=$b.y}\nr("H.clustering.dynamicgrid.worker",function(a,b,c,d,e){var f=e?ac:cc,g=0;e=!!self.ArrayBuffer;var h=a.byteLength?new Float64Array(a):a,k=h.length/3;a=[];var m=[],n=[],q=e?new Float64Array(2*k):[];k=0;var u=0;for(bc.Aa(d);g<h.length;){var I=h[g++];var K=h[g++];var w=h[g++];f(w,K,d,q,u);for(w=a.length;w--;)if(K=a[w],K.Ia(q,u)){var F=K;break}F||(F=new Ob(q,u,b),a.push(F));w=u/2;F.Eb+=I||1;F.Pb.push(w);F=null;u+=2}for(w=a.length;w--;)K=a[w],b=K.Eb>=c,f=K.Pb,d=f.length,b?(m.push(d),m=m.concat(f)):\n(k+=d,n=n.concat(f));c=[k].concat(n).concat(m);c=e?(new Uint32Array(c)).buffer:c;this.postMessage(c,[c])});var dc={};function ec(a){try{importScripts.apply(self,arguments)}catch(b){this.postError("invalid_script")}}function fc(a){delete dc[a];this.postMessage(a)}function gc(a,b,c){if(Ua(b))var d=b;else try{d=self.eval("("+b+")"),Ua(d)||(d=null)}catch(e){}d?(dc[a]=d,c||this.postMessage(a)):this.postError("invalid_processor")}function hc(a){this.Wb=a&&a[0];this.Ua=a&&a[1];this.kc=a&&a[2]||[]}hc.prototype.postError=function(a){this.postMessage(a,t,0)};\nhc.prototype.postMessage=function(a,b,c){self.postMessage({processor:this.Wb,taskId:this.Ua,type:c===t?1:c,data:a},b||t)};function ic(a,b,c){if(!Xa(a))throw new x(ic,0,"InvalidArgument");if(!Ua(b))throw new x(ic,1,"InvalidArgument");var d=jc++;kc[d]={mimeType:c||lc,nc:b};(new hc(["3",d,[]])).postMessage(a,[],2)}var kc={},jc=0;\nfunction oc(a,b){var c=a;if(kc[this.Ua]){var d=kc[this.Ua];var e=d.nc;delete kc[this.Ua];if(b)e(null,b);else{if(d.mimeType===pc){a=new Uint8Array(a);b=a.byteLength;d="";c=0;for(var f,g,h,k;c<b;)f=a[c++],192>f||(g=a[c++],224>f?f=(f&31)<<6|g&63:(h=a[c++],240>f?f=(f&15)<<12|(g&63)<<6|h&63:(k=a[c++],f=(f&7)<<18|(g&63)<<12|(h&63)<<6|k&63))),65536>f?d+=String.fromCharCode(f):(f-=65536,d+=String.fromCharCode((f>>10)+55296,(f&1023)+56320));c=d}e(c)}}}var lc=0,pc=1;function qc(a,b,c,d){var e=!!c,f,g=0,h=0,k=0,m=0,n=0,q,u=-1;var I=globalThis.Float32Array;var K,w=[];if(b){b=Ra(b);a=Ra(a);e&&(f=Ra(c));c=b.length;d=d?1E-7:1E-5;for(K=new I(3*c);g<c;){I=b[g];var F=+I;var W=+a[g];e&&(q=+f[g]);rc.test(I)?0<=u&&(0<g-u&&w.push(u,g+1),u=-1):0>u&&(u=g);g++;m=K[h++]=m+W*d;k=K[h++]=k+F*d;e&&(n=K[h]=n+q);h++}0<=u&&1<c-u&&w.push(u,c)}else K=new I(0);return{path:K,outlineIndices:w}}var rc=/^-?0\\d/;\nfunction sc(a,b){for(var c=0,d=a.length/3,e=new globalThis.Array(d),f=0;c<d;)e[c++]=b.sb(a[f],a[++f]),f+=2;return e};function tc(a,b){b=180/(1<<b);var c=a.lat+90;a=(a.lng+180)%360;var d=0;180==c&&d--;d+=Math.floor(c/b);return[d,0+Math.floor(a/b)]}var uc=1/Math.pow(10,10);function vc(a,b){var c=[],d=a.Nb();a=a.Mb();var e;180==a.lng&&(a.lng-=uc);d=tc(d,b);a=tc(a,b);for(e=d[0];e>=a[0];e--)for(b=d[1];b<=a[1];b++)c.push(e,b);return c};function L(){}r("H.util.ICache",L);L.prototype.add=function(){};L.prototype.add=L.prototype.add;L.prototype.get=function(){};L.prototype.get=L.prototype.get;L.prototype.fb=function(){};L.prototype.drop=L.prototype.fb;L.prototype.forEach=function(){};L.prototype.forEach=L.prototype.forEach;L.prototype.ia=function(){};L.prototype.removeAll=L.prototype.ia;L.prototype.ya=function(){};L.prototype.registerOnDrop=L.prototype.ya;L.prototype.bb=function(){};L.prototype.deRegisterOnDrop=L.prototype.bb;function M(a,b,c){this.ta=[];b&&this.ya(b);if(c&&!Ua(c))throw new x(M,2,c);this.J=0;this.filter=c;this.s={};this.qa=this.ea=null;this.zb(a)}r("H.util.Cache",M);M.prototype.add=function(a,b,c){var d,e;c=+c;if(!$a(c)||0>c)throw new x(this.add,2,c);a=String(a);if(e=this.filter?this.filter(a,b,c):!0)(d=this.s[a])?(d.data!==b&&wc(this,d),this.J+=c-d.size,d.size=c,d.data=b,xc(this,d)):this.s[a]=yc(this,{id:a,data:b,size:c,v:null,N:null},this.ea),zc(this);return e};M.prototype.add=M.prototype.add;\nM.prototype.ya=function(a){if(!Ua(a))throw new x(this.ya,0,a);this.ta.push(a)};M.prototype.registerOnDrop=M.prototype.ya;M.prototype.bb=function(a){this.ta=this.ta.filter(function(b){return b!==a})};M.prototype.deRegisterOnDrop=M.prototype.bb;M.prototype.get=function(a,b){return(a=b?this.s[a]:xc(this,this.s[a]))&&a.data};M.prototype.get=M.prototype.get;M.prototype.fb=function(a){var b;(b=this.s[a])&&Ac(this,b,!0)};M.prototype.drop=M.prototype.fb;\nM.prototype.forEach=function(a,b,c){var d;for(d in this.s){var e=this.s[d];(c?c(d,e.data,e.size):1)&&a.call(b,d,e.data,e.size)}};M.prototype.forEach=M.prototype.forEach;M.prototype.ia=function(a){var b;for(b in this.s){var c=this.s[b];(a?a(b,c.data,c.size):1)&&Ac(this,this.s[b],!0)}};M.prototype.removeAll=M.prototype.ia;M.prototype.zb=function(a){if(!(0<+a))throw new x(M.prototype.zb,0,a);this.Tb=+a;zc(this);return this};M.prototype.setMaxSize=M.prototype.zb;M.prototype.Jc=function(){return this.Tb};\nM.prototype.getMaxSize=M.prototype.Jc;M.prototype.Ec=function(){return this.J};M.prototype.getCurrentSize=M.prototype.Ec;function xc(a,b){b&&(a.ea=yc(a,b,a.ea));return b}function zc(a){for(;a.J>a.Tb&&a.qa;)Ac(a,a.qa,!0)}function yc(a,b,c){if(c!==b){(b.v||b.N)&&Ac(a,b,!1);if(b.v=c)b.N=c.N,c.N=b;b.N||(a.ea=b);b.v||(a.qa=b);a.J+=b.size}return b}function Ac(a,b,c){var d=b.N,e=b.v;if(d||e||b==a.ea&&b==a.qa)d?d.v=e:a.ea=e,e?e.N=d:a.qa=d,a.J-=b.size,c&&(delete a.s[b.id],wc(a,b));b.v=b.N=null}\nfunction wc(a,b){for(var c=a.ta.length;c--;)a.ta[c].call(a,b.id,b.data,b.size)};function Bc(a,b,c,d){if(!a||!b||!c)throw new x(Bc,t,"Must specify name, version and revision parameter");this.name=a;this.version=b;this.revision=c;d&&Ka(this,d)}r("H.util.BuildInfo",Bc);Bc.prototype.toString=function(){var a,b=[];for(a in this)Xa(this[a])&&b.push(this[a]);return b.join(";")};var Cc={};function Dc(a,b,c,d){if(!a)throw new x(Dc,1,"Must specify a name parameter");return Cc[a]||(Cc[a]=new Bc(a,b,c,d))}Bc.get=Dc;function O(a,b,c,d,e,f){if(a&&b)this.Cb(a),this.Ra(b),this.Ab(c),this.Bb(e),this.ac(f),this.Ta(d);else throw new x(O,t,\'Parameters "scheme" and "host" must be specified\');}r("H.service.Url",O);\nfunction Ec(a,b){var c=globalThis.document,d;var e="";if(c){e=c.createElement("a");if(b){var f=(d=c.getElementsByTagName("base")[0])&&d.href;var g=c.head;var h=d||g.appendChild(c.createElement("base"));h.href=b}e.href=a;e=e.href;b&&(d?d.href=f:g.removeChild(h))}else/[\\w]+:\\/\\//.test(a)&&(e=a);f=/(?:(\\w+):\\/\\/)?(?:([^:]+):([^@/]*)@)?([^/:]+)?(?:[:]{1}([0-9]+))?(\\/[^?#]*)?(\\?[^#]+)?(#.*)?/.exec(e);a=f[1];g=f[4];b=f[5];h=f[6];c=f[7];d=f[8];!f[2]&&g&&/@/.test(g)&&(g=g.split("@")[1]);f=O;h=h&&0<h.length?\nh.substr(1):"";e={};var k,m;if(c)for(k=/([?&]?([^=&+]+))(=([^&]+))?/g;m=k.exec(c);)e[decodeURIComponent(m[2])]=m[4]?decodeURIComponent(m[4]):void 0;return new f(a,g,h,e,isNaN(+b)?void 0:+b,d&&0<d.length?d.substr(1):"")}O.parse=Ec;O.prototype.clone=function(){var a={},b;for(b in this.A)a[b]=this.A[b];return new O(this.yb,this.Na,this.X,a,this.wa,this.la)};O.prototype.clone=O.prototype.clone;\nO.prototype.Cb=function(a){if(!a||"string"!==typeof a)throw new x(this.Cb,0,\'The "scheme" parameter must be a non-empty string.\');this.yb=a;return this};O.prototype.setScheme=O.prototype.Cb;O.prototype.Oc=function(){return this.yb};O.prototype.getScheme=O.prototype.Oc;O.prototype.Ra=function(a){if(!a||"string"!==typeof a||"-"===a.charAt(0)||"."===a.charAt(0)||"."===a.charAt(a.length-1))throw new x(this.Ra,0,\'The "host" parameter is not a valid host name.\');this.Na=a;return this};\nO.prototype.setHost=O.prototype.Ra;O.prototype.Fc=function(){return this.Na};O.prototype.getHost=O.prototype.Fc;O.prototype.Ab=function(a){this.X=a||void 0;return this};O.prototype.setPath=O.prototype.Ab;O.prototype.Lc=function(){return this.X};O.prototype.getPath=O.prototype.Lc;O.prototype.Ta=function(a){if(a)if("object"==typeof a)this.A=a;else throw new x(this.Ta,0,\'Parameter "params" must be an object.\');else this.A={};return this};O.prototype.setQuery=O.prototype.Ta;O.prototype.Sc=function(){return!Fc(this)};\nO.prototype.hasQuery=O.prototype.Sc;O.prototype.getQuery=function(){return this.A};O.prototype.getQuery=O.prototype.getQuery;O.prototype.Bb=function(a){if(void 0===a)this.wa=a;else{var b=Ib(+a<<0,0,65535);if(b!=a)throw new x(this.Bb,0,\'Parameter "port" must be an integer in range [0...65535]\');this.wa=b}return this};O.prototype.setPort=O.prototype.Bb;O.prototype.Mc=function(){return this.wa};O.prototype.getPort=O.prototype.Mc;O.prototype.ac=function(a){this.la=a||void 0;return this};\nO.prototype.setAnchor=O.prototype.ac;O.prototype.Bc=function(){return this.la};O.prototype.getAnchor=O.prototype.Bc;O.prototype.ga=function(a){if("object"!==typeof a)throw new x(this.ga,0,\'Parameter "other" must be an object.\');var b=this.A,c;for(c in a)a.hasOwnProperty(c)&&"function"!==typeof a[c]&&(b[c]=a[c]);return this};O.prototype.mergeQuery=O.prototype.ga;\nO.prototype.Gb=function(a){if(!a||"string"!==typeof a)throw new x(this.Gb,0,\'Parameter "subDomain" must be a non-empty string\');"."===a.substr(a.length-1)&&(a=a.substr(0,a.length-1));return this.Ra(a+"."+this.Na)};O.prototype.addSubDomain=O.prototype.Gb;O.prototype.Hb=function(a){if(!a||"string"!==typeof a)throw new x(this.Hb,0,\'Parameter "subPath" must be a non-empty string\');return this.Ab((this.X?this.X+"/":"")+a)};O.prototype.addSubPath=O.prototype.Hb;\nO.prototype.toString=function(){return[this.yb+"://",this.Na,this.wa?":"+this.wa:"",this.X||!Fc(this)||this.la?"/":"",this.X?encodeURI(this.X):"",Gc(this),this.la?"#"+encodeURIComponent(this.la):""].join("")};O.prototype.toString=O.prototype.toString;function Hc(a){return encodeURIComponent(a).replace(/[!\'()*]/g,function(b){return"%"+b.charCodeAt(0).toString(16)})}\nfunction Gc(a){var b=[],c=a.A,d={},e;for(e in c){if(c.hasOwnProperty(e)&&"function"!==typeof c[e]){var f=a.A[e];d.$=Hc(e);Ta(f,Ic)?f.Va.forEach(function(g){return function(h){b.push(g.$+"="+Hc(h))}}(d)):Ta(f,Jc)?b.push(d.$+"="+f.Va.map(function(g){return Hc(g)}).join(f.tc)):b.push(void 0===f?d.$:d.$+"="+Hc(f))}d={$:d.$}}return 0<b.length?"?"+b.join("&"):""}function Fc(a){var b,c=0;for(b in a.A)if(a.A.hasOwnProperty(b)&&"function"!==typeof a.A[b]&&(c++,0<c))break;return!c}\nfunction Kc(a,b){if(Va(a,void 0,void 0,void 0))for(var c=0;c<a.length;c++){var d=a[c];if(!Xa(d)&&!$a(d)){var e="The Array does not contain only strings and numbers";break}}else e="Not an Array";if(e)throw new x(b,0,a);return a}function Ic(a){this.Va=Kc(a,Ic)}O.MultiValueQueryParameter=Ic;Ic.prototype.Qc=function(){return this.Va};Ic.prototype.getValues=Ic.prototype.Qc;function Jc(a,b){this.Va=Kc(a,Jc);if(!/^[!\\$\\(\\)\\*\\+,;]$/.test(b))throw new x(Jc,1,\'Invalid delimiter "\'+b+\'"\');this.tc=b}\nO.DelimitedQuerySubValues=Jc;function Q(){}r("H.service.extension.dataView.ITable",Q);Q.prototype.nb=function(){};Q.prototype.getMeta=Q.prototype.nb;Q.prototype.ob=function(){};Q.prototype.getRowCount=Q.prototype.ob;Q.prototype.Ja=function(){};Q.prototype.getRow=Q.prototype.Ja;Q.prototype.L=function(){};Q.prototype.getColumnNames=Q.prototype.L;Q.prototype.lb=function(){};Q.prototype.getColumn=Q.prototype.lb;Q.prototype.o=function(){};Q.prototype.getCell=Q.prototype.o;Q.prototype.concat=function(){};Q.prototype.concat=Q.prototype.concat;function Lc(a,b,c){var d=[],e=arguments.length;a&&d.push(bb(a));1<e&&(e=2<e&&Va(c,void 0,void 0,void 0)?" out of ["+c[0]+"..."+c[1]+"]":"",d.push("("+b+e+")"));d=Error(d.join(" "));Object.setPrototypeOf(d,Lc.prototype);return d}Fa(Lc,Error);r("H.lang.OutOfRangeError",Lc);Lc.prototype.name="OutOfRangeError";function Mc(a){p.setTimeout(function(){throw a;},0)};function Nc(a,b){this.$c=100;this.rc=a;this.md=b;this.Qa=0;this.Ma=null}Nc.prototype.get=function(){if(0<this.Qa){this.Qa--;var a=this.Ma;this.Ma=a.next;a.next=null}else a=this.rc();return a};Nc.prototype.put=function(a){this.md(a);this.Qa<this.$c&&(this.Qa++,a.next=this.Ma,this.Ma=a)};function Oc(){this.Ya=this.ja=null}Oc.prototype.add=function(a,b){var c=Pc.get();c.set(a,b);this.Ya?this.Ya.next=c:this.ja=c;this.Ya=c};Oc.prototype.remove=function(){var a=null;this.ja&&(a=this.ja,this.ja=this.ja.next,this.ja||(this.Ya=null),a.next=null);return a};var Pc=new Nc(function(){return new Qc},function(a){return a.reset()});function Qc(){this.next=this.scope=this.hb=null}Qc.prototype.set=function(a,b){this.hb=a;this.scope=b;this.next=null};\nQc.prototype.reset=function(){this.next=this.scope=this.hb=null};function Rc(a,b){return-1!=a.indexOf(b)};var S;a:{var Sc=p.navigator;if(Sc){var Tc=Sc.userAgent;if(Tc){S=Tc;break a}}S=""};function Uc(a){Uc[" "](a);return a}Uc[" "]=sa;var Vc=Rc(S,"Gecko")&&!(Rc(S.toLowerCase(),"webkit")&&!Rc(S,"Edge"))&&!(Rc(S,"Trident")||Rc(S,"MSIE"))&&!Rc(S,"Edge"),Wc=Rc(S.toLowerCase(),"webkit")&&!Rc(S,"Edge");function Xc(){var a=document;var b="IFRAME";"application/xhtml+xml"===a.contentType&&(b=b.toLowerCase());return a.createElement(b)};var Yc;\nfunction Zc(){var a=p.MessageChannel;"undefined"===typeof a&&"undefined"!==typeof window&&window.postMessage&&window.addEventListener&&!Rc(S,"Presto")&&(a=function(){var e=Xc();e.style.display="none";document.documentElement.appendChild(e);var f=e.contentWindow;e=f.document;e.open();e.close();var g="callImmediate"+Math.random(),h="file:"==f.location.protocol?"*":f.location.protocol+"//"+f.location.host;e=Ca(function(k){if(("*"==h||k.origin==h)&&k.data==g)this.port1.onmessage()},this);f.addEventListener("message",e,\n!1);this.port1={};this.port2={postMessage:function(){f.postMessage(g,h)}}});if("undefined"!==typeof a&&!Rc(S,"Trident")&&!Rc(S,"MSIE")){var b=new a,c={},d=c;b.port1.onmessage=function(){if(void 0!==c.next){c=c.next;var e=c.Jb;c.Jb=null;e()}};return function(e){d.next={Jb:e};d=d.next;b.port2.postMessage(0)}}return function(e){p.setTimeout(e,0)}};function $c(a,b){ad||bd();cd||(ad(),cd=!0);dd.add(a,b)}var ad;function bd(){if(p.Promise&&p.Promise.resolve){var a=p.Promise.resolve(void 0);ad=function(){a.then(ed)}}else ad=function(){var b=ed;"function"!==typeof p.setImmediate||p.Window&&p.Window.prototype&&!Rc(S,"Edge")&&p.Window.prototype.setImmediate==p.setImmediate?(Yc||(Yc=Zc()),Yc(b)):p.setImmediate(b)}}var cd=!1,dd=new Oc;function ed(){for(var a;a=dd.remove();){try{a.hb.call(a.scope)}catch(b){Mc(b)}Pc.put(a)}cd=!1};function fd(a){this.u=gd;this.Zb=void 0;this.ba=this.I=this.W=null;this.Ka=this.gb=!1;if(a!=sa)try{var b=this;a.call(void 0,function(c){hd(b,id,c)},function(c){hd(b,jd,c)})}catch(c){hd(this,jd,c)}}var gd=0,id=2,jd=3;function kd(){this.next=this.context=this.ha=this.ua=this.R=null;this.Fa=!1}kd.prototype.reset=function(){this.context=this.ha=this.ua=this.R=null;this.Fa=!1};var ld=new Nc(function(){return new kd},function(a){a.reset()});\nfunction md(a,b,c){var d=ld.get();d.ua=a;d.ha=b;d.context=c;return d}function nd(a,b,c){od(a,b,c,null)||$c(Da(b,a))}function pd(a){return new fd(function(b,c){var d=a.length,e=[];if(d)for(var f=function(m,n){d--;e[m]=n;0==d&&b(e)},g=function(m){c(m)},h=0,k;h<a.length;h++)k=a[h],nd(k,Da(f,h),g);else b(e)})}function qd(){var a,b,c=new fd(function(d,e){a=d;b=e});return new rd(c,a,b)}fd.prototype.then=function(a,b,c){return sd(this,"function"===typeof a?a:null,"function"===typeof b?b:null,c)};\nfd.prototype.$goog_Thenable=!0;fd.prototype.cancel=function(a){if(this.u==gd){var b=new td(a);$c(function(){ud(this,b)},this)}};function ud(a,b){if(a.u==gd)if(a.W){var c=a.W;if(c.I){for(var d=0,e=null,f=null,g=c.I;g&&(g.Fa||(d++,g.R==a&&(e=g),!(e&&1<d)));g=g.next)e||(f=g);e&&(c.u==gd&&1==d?ud(c,b):(f?(d=f,d.next==c.ba&&(c.ba=d),d.next=d.next.next):vd(c),wd(c,e,jd,b)))}a.W=null}else hd(a,jd,b)}function xd(a,b){a.I||a.u!=id&&a.u!=jd||yd(a);a.ba?a.ba.next=b:a.I=b;a.ba=b}\nfunction sd(a,b,c,d){var e=md(null,null,null);e.R=new fd(function(f,g){e.ua=b?function(h){try{var k=b.call(d,h);f(k)}catch(m){g(m)}}:f;e.ha=c?function(h){try{var k=c.call(d,h);void 0===k&&h instanceof td?g(h):f(k)}catch(m){g(m)}}:g});e.R.W=a;xd(a,e);return e.R}fd.prototype.td=function(a){this.u=gd;hd(this,id,a)};fd.prototype.ud=function(a){this.u=gd;hd(this,jd,a)};\nfunction hd(a,b,c){a.u==gd&&(a===c&&(b=jd,c=new TypeError("Promise cannot resolve to itself")),a.u=1,od(c,a.td,a.ud,a)||(a.Zb=c,a.u=b,a.W=null,yd(a),b!=jd||c instanceof td||zd(a,c)))}function od(a,b,c,d){if(a instanceof fd)return xd(a,md(b||sa,c||null,d)),!0;if(a)try{var e=!!a.$goog_Thenable}catch(g){e=!1}else e=!1;if(e)return a.then(b,c,d),!0;if(ra(a))try{var f=a.then;if("function"===typeof f)return Ad(a,f,b,c,d),!0}catch(g){return c.call(d,g),!0}return!1}\nfunction Ad(a,b,c,d,e){function f(k){h||(h=!0,d.call(e,k))}function g(k){h||(h=!0,c.call(e,k))}var h=!1;try{b.call(a,g,f)}catch(k){f(k)}}function yd(a){a.gb||(a.gb=!0,$c(a.uc,a))}function vd(a){var b=null;a.I&&(b=a.I,a.I=b.next,b.next=null);a.I||(a.ba=null);return b}fd.prototype.uc=function(){for(var a;a=vd(this);)wd(this,a,this.u,this.Zb);this.gb=!1};\nfunction wd(a,b,c,d){if(c==jd&&b.ha&&!b.Fa)for(;a&&a.Ka;a=a.W)a.Ka=!1;if(b.R)b.R.W=null,Bd(b,c,d);else try{b.Fa?b.ua.call(b.context):Bd(b,c,d)}catch(e){Cd.call(null,e)}ld.put(b)}function Bd(a,b,c){b==id?a.ua.call(a.context,c):a.ha&&a.ha.call(a.context,c)}function zd(a,b){a.Ka=!0;$c(function(){a.Ka&&Cd.call(null,b)})}var Cd=Mc;function td(a){La.call(this,a)}Fa(td,La);td.prototype.name="cancel";function rd(a,b,c){this.promise=a;this.resolve=b;this.reject=c};function Dd(){}r("H.util.ICancelable",Dd);Dd.prototype.cancel=function(){};Dd.prototype.cancel=Dd.prototype.cancel;function Ed(a,b,c){this.type=a;this.data=b;this.O=qd();this.resolve=Na(this.resolve,this);this.reject=Na(this.reject,this);this.priority=Fd;c!==t&&(this.priority=c);this.Gc().add(this)}var Fd=1,Gd={zd:0,Ad:Fd,yd:2};l=Ed.prototype;l.then=function(a,b,c){return this.O.promise.then(a,b,c)};l.resolve=function(a){this.state=3;this.O.resolve(a)};l.reject=function(a){this.state=5;this.O.reject(a)};l.state=0;l.cancel=function(){3>this.state&&(this.Dd(),this.Gc().remove(this),this.state=4)};\nEd.prototype.cancel=Ed.prototype.cancel;function Hd(a){var b;this.Y={};for(b in Gd)this.Y[Gd[b]]=[];this.Ba=a;this.Ba.addEventListener("allocatable",Na(this.Lb,this))}r("H.util.JobManager",Hd);var Id=Object.keys(Gd).map(function(a){return Gd[a]}).sort().reverse();Hd.prototype.add=function(a){Ta(a,Ed,this.add,0);this.Y[a.priority].push(a);this.Lb()};Hd.prototype.contains=function(a){return-1<this.Y[a.priority].indexOf(a)};\nHd.prototype.remove=function(a){var b=a.priority,c=this.Y[b].indexOf(a);if(-1<c)return this.Y[b].splice(c,1),!0;a.Fb&&this.Ba.sc(a.Fb);return!1};Hd.prototype.Lb=function(){Id.forEach(function(a){this.Y[a]=this.Y[a].filter(function(b){var c;if((c=this.Ba.Bd(b))!==Qa){var d=Na(this.Ba.sc,this.Ba,c,b);b.Fb=c;b.then(d,d);b.state=b.Ed(c)?1:5}else return!0},this)},this)};function T(){0!=Jd&&(Kd[ua(this)]=this);this.na=this.na;this.G=this.G}var Jd=0,Kd={};T.prototype.na=!1;T.prototype.C=function(){if(!this.na&&(this.na=!0,this.K(),0!=Jd)){var a=ua(this);if(0!=Jd&&this.G&&0<this.G.length)throw Error(this+" did not empty its onDisposeCallbacks queue. This probably means it overrode dispose() or disposeInternal() without calling the superclass\' method.");delete Kd[a]}};\nT.prototype.aa=function(a,b){this.na?void 0!==b?a.call(b):a():(this.G||(this.G=[]),this.G.push(void 0!==b?Ca(a,b):a))};T.prototype.K=function(){if(this.G)for(;this.G.length;)this.G.shift()()};var Ld=function(){if(!p.addEventListener||!Object.defineProperty)return!1;var a=!1,b=Object.defineProperty({},"passive",{get:function(){a=!0}});try{p.addEventListener("test",sa,b),p.removeEventListener("test",sa,b)}catch(c){}return a}();function U(a,b){this.type=a;this.currentTarget=this.target=b;this.defaultPrevented=this.xa=!1}U.prototype.stopPropagation=function(){this.xa=!0};U.prototype.preventDefault=function(){this.defaultPrevented=!0};function Md(a,b){U.call(this,a?a.type:"");this.relatedTarget=this.currentTarget=this.target=null;this.button=this.screenY=this.screenX=this.clientY=this.clientX=this.offsetY=this.offsetX=0;this.key="";this.charCode=this.keyCode=0;this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1;this.state=null;this.pointerId=0;this.pointerType="";this.oa=null;if(a){var c=this.type=a.type,d=a.changedTouches&&a.changedTouches.length?a.changedTouches[0]:null;this.target=a.target||a.srcElement;this.currentTarget=\nb;if(b=a.relatedTarget){if(Vc){a:{try{Uc(b.nodeName);var e=!0;break a}catch(f){}e=!1}e||(b=null)}}else"mouseover"==c?b=a.fromElement:"mouseout"==c&&(b=a.toElement);this.relatedTarget=b;d?(this.clientX=void 0!==d.clientX?d.clientX:d.pageX,this.clientY=void 0!==d.clientY?d.clientY:d.pageY,this.screenX=d.screenX||0,this.screenY=d.screenY||0):(this.offsetX=Wc||void 0!==a.offsetX?a.offsetX:a.layerX,this.offsetY=Wc||void 0!==a.offsetY?a.offsetY:a.layerY,this.clientX=void 0!==a.clientX?a.clientX:a.pageX,\nthis.clientY=void 0!==a.clientY?a.clientY:a.pageY,this.screenX=a.screenX||0,this.screenY=a.screenY||0);this.button=a.button;this.keyCode=a.keyCode||0;this.key=a.key||"";this.charCode=a.charCode||("keypress"==c?a.keyCode:0);this.ctrlKey=a.ctrlKey;this.altKey=a.altKey;this.shiftKey=a.shiftKey;this.metaKey=a.metaKey;this.pointerId=a.pointerId||0;this.pointerType="string"===typeof a.pointerType?a.pointerType:Nd[a.pointerType]||"";this.state=a.state;this.oa=a;a.defaultPrevented&&Md.Z.preventDefault.call(this)}}\nFa(Md,U);var Nd={2:"touch",3:"pen",4:"mouse"};Md.prototype.stopPropagation=function(){Md.Z.stopPropagation.call(this);this.oa.stopPropagation?this.oa.stopPropagation():this.oa.cancelBubble=!0};Md.prototype.preventDefault=function(){Md.Z.preventDefault.call(this);var a=this.oa;a.preventDefault?a.preventDefault():a.returnValue=!1};var Od="closure_listenable_"+(1E6*Math.random()|0);var Pd=0;function Qd(a,b,c,d,e){this.listener=a;this.proxy=null;this.src=b;this.type=c;this.capture=!!d;this.La=e;this.key=++Pd;this.za=this.Ga=!1}function Rd(a){a.za=!0;a.listener=null;a.proxy=null;a.src=null;a.La=null};function Sd(a){this.src=a;this.m={};this.Ea=0}Sd.prototype.add=function(a,b,c,d,e){var f=a.toString();a=this.m[f];a||(a=this.m[f]=[],this.Ea++);var g=Td(a,b,d,e);-1<g?(b=a[g],c||(b.Ga=!1)):(b=new Qd(b,this.src,f,!!d,e),b.Ga=c,a.push(b));return b};Sd.prototype.remove=function(a,b,c,d){a=a.toString();if(!(a in this.m))return!1;var e=this.m[a];b=Td(e,b,c,d);return-1<b?(Rd(e[b]),Array.prototype.splice.call(e,b,1),0==e.length&&(delete this.m[a],this.Ea--),!0):!1};\nfunction Ud(a,b){var c=b.type;if(c in a.m){var d=a.m[c],e=Ma(d,b),f;(f=0<=e)&&Array.prototype.splice.call(d,e,1);f&&(Rd(b),0==a.m[c].length&&(delete a.m[c],a.Ea--))}}Sd.prototype.ia=function(a){a=a&&a.toString();var b=0,c;for(c in this.m)if(!a||c==a){for(var d=this.m[c],e=0;e<d.length;e++)++b,Rd(d[e]);delete this.m[c];this.Ea--}return b};Sd.prototype.mb=function(a,b,c,d){a=this.m[a.toString()];var e=-1;a&&(e=Td(a,b,c,d));return-1<e?a[e]:null};\nfunction Td(a,b,c,d){for(var e=0;e<a.length;++e){var f=a[e];if(!f.za&&f.listener==b&&f.capture==!!c&&f.La==d)return e}return-1};var Vd="closure_lm_"+(1E6*Math.random()|0),Xd={},Yd=0;function Zd(a,b,c,d,e){if(d&&d.once)$d(a,b,c,d,e);else if(Array.isArray(b))for(var f=0;f<b.length;f++)Zd(a,b[f],c,d,e);else c=ae(c),a&&a[Od]?a.D.add(String(b),c,!1,ra(d)?!!d.capture:!!d,e):be(a,b,c,!1,d,e)}\nfunction be(a,b,c,d,e,f){if(!b)throw Error("Invalid event type");var g=ra(e)?!!e.capture:!!e,h=ce(a);h||(a[Vd]=h=new Sd(a));c=h.add(b,c,d,g,f);if(!c.proxy){d=de();c.proxy=d;d.src=a;d.listener=c;if(a.addEventListener)Ld||(e=g),void 0===e&&(e=!1),a.addEventListener(b.toString(),d,e);else if(a.attachEvent)a.attachEvent(ee(b.toString()),d);else if(a.addListener&&a.removeListener)a.addListener(d);else throw Error("addEventListener and attachEvent are unavailable.");Yd++}}\nfunction de(){function a(c){return b.call(a.src,a.listener,c)}var b=fe;return a}function $d(a,b,c,d,e){if(Array.isArray(b))for(var f=0;f<b.length;f++)$d(a,b[f],c,d,e);else c=ae(c),a&&a[Od]?a.D.add(String(b),c,!0,ra(d)?!!d.capture:!!d,e):be(a,b,c,!0,d,e)}function ge(a,b,c,d,e){if(Array.isArray(b))for(var f=0;f<b.length;f++)ge(a,b[f],c,d,e);else d=ra(d)?!!d.capture:!!d,c=ae(c),a&&a[Od]?a.D.remove(String(b),c,d,e):a&&(a=ce(a))&&(b=a.mb(b,c,d,e))&&he(b)}\nfunction he(a){if("number"!==typeof a&&a&&!a.za){var b=a.src;if(b&&b[Od])Ud(b.D,a);else{var c=a.type,d=a.proxy;b.removeEventListener?b.removeEventListener(c,d,a.capture):b.detachEvent?b.detachEvent(ee(c),d):b.addListener&&b.removeListener&&b.removeListener(d);Yd--;(c=ce(b))?(Ud(c,a),0==c.Ea&&(c.src=null,b[Vd]=null)):Rd(a)}}}function ee(a){return a in Xd?Xd[a]:Xd[a]="on"+a}function fe(a,b){if(a.za)a=!0;else{b=new Md(b,this);var c=a.listener,d=a.La||a.src;a.Ga&&he(a);a=c.call(d,b)}return a}\nfunction ce(a){a=a[Vd];return a instanceof Sd?a:null}var ie="__closure_events_fn_"+(1E9*Math.random()>>>0);function ae(a){if("function"===typeof a)return a;a[ie]||(a[ie]=function(b){return a.handleEvent(b)});return a[ie]};r("H.util.Event",U);U.prototype.stopPropagation=U.prototype.stopPropagation;U.prototype.stopPropagation=U.prototype.stopPropagation;U.prototype.CAPTURING_PHASE=1;U.prototype.CAPTURING_PHASE=U.prototype.CAPTURING_PHASE;U.prototype.AT_TARGET=2;U.prototype.AT_TARGET=U.prototype.AT_TARGET;U.prototype.BUBBLING_PHASE=3;U.prototype.BUBBLING_PHASE=U.prototype.BUBBLING_PHASE;U.prototype.eventPhase=0;U.prototype.eventPhase=U.prototype.eventPhase;function je(a,b,c){je.Z.constructor.call(this,a,c);this.data=b}Fa(je,U);r("H.util.DataEvent",je);function X(){T.call(this);this.D=new Sd(this);this.hc=this;this.wb=null}Fa(X,T);X.prototype[Od]=!0;l=X.prototype;l.M=function(){return this.wb};l.Sa=function(a){this.wb=a};l.addEventListener=function(a,b,c,d){Zd(this,a,b,c,d)};l.removeEventListener=function(a,b,c,d){ge(this,a,b,c,d)};\nl.dispatchEvent=function(a){var b,c=this.M();if(c)for(b=[];c;c=c.M())b.push(c);c=this.hc;var d=a.type||a;if("string"===typeof a)a=new U(a,c);else if(a instanceof U)a.target=a.target||c;else{var e=a;a=new U(d,c);Ka(a,e)}e=!0;if(b)for(var f=b.length-1;!a.xa&&0<=f;f--){var g=a.currentTarget=b[f];e=g.da(d,!0,a)&&e}a.xa||(g=a.currentTarget=c,e=g.da(d,!0,a)&&e,a.xa||(e=g.da(d,!1,a)&&e));if(b)for(f=0;!a.xa&&f<b.length;f++)g=a.currentTarget=b[f],e=g.da(d,!1,a)&&e;return e};\nl.K=function(){X.Z.K.call(this);this.D&&this.D.ia(void 0);this.wb=null};l.da=function(a,b,c){a=this.D.m[String(a)];if(!a)return!0;a=a.concat();for(var d=!0,e=0;e<a.length;++e){var f=a[e];if(f&&!f.za&&f.capture==b){var g=f.listener,h=f.La||f.src;f.Ga&&Ud(this.D,f);d=!1!==g.call(h,c)&&d}}return d&&!c.defaultPrevented};l.mb=function(a,b,c,d){return this.D.mb(String(a),b,c,d)};r("H.util.EventTarget",X);X.prototype.Sa=X.prototype.Sa;X.prototype.setParentEventTarget=X.prototype.Sa;X.prototype.M=X.prototype.M;X.prototype.getParentEventTarget=X.prototype.M;X.prototype.addEventListener=X.prototype.addEventListener;X.prototype.addEventListener=X.prototype.addEventListener;X.prototype.removeEventListener=X.prototype.removeEventListener;X.prototype.removeEventListener=X.prototype.removeEventListener;X.prototype.dispatchEvent=X.prototype.dispatchEvent;\nX.prototype.dispatchEvent=X.prototype.dispatchEvent;X.prototype.C=X.prototype.C;X.prototype.dispose=X.prototype.C;X.prototype.aa=X.prototype.aa;X.prototype.addOnDisposeCallback=X.prototype.aa;X.prototype.yc=X.prototype.da;\nX.prototype.da=function(a,b,c){var d,e,f=!0;var g=c[c.currentTarget===c.target?"AT_TARGET":b?"CAPTURING_PHASE":(d=!0,"BUBBLING_PHASE")];if(!d||"pointerenter"!==(e=c.type)&&"pointerleave"!==e)c.eventPhase=g,f=X.prototype.yc.apply(this,arguments),d&&this.M&&null===this.M()&&delete c.eventPhase;return f};X.prototype.qd=function(a){for(var b,c=this;c&&(b=c.M())&&b!==a;)c=b;b||c.Sa(a)};X.prototype.setRootParentEventTarget=X.prototype.qd;function Y(a){a=a||{};var b=a.callback;this.rb=a.label;Ua(b)&&(this.callback=b);this.cb=!!a.disabled;Y.Z.constructor.call(this)}Fa(Y,X);r("H.util.ContextItem",Y);Y.prototype.Hc=function(){return this.rb};Y.prototype.getLabel=Y.prototype.Hc;Y.prototype.pd=function(a){this.rb!==a&&(this.rb=a,this.dispatchEvent("update"));return this};Y.prototype.setLabel=Y.prototype.pd;Y.prototype.Xc=function(){return this.cb};Y.prototype.isDisabled=Y.prototype.Xc;\nY.prototype.od=function(a){a!==this.cb&&(this.cb=a,this.dispatchEvent("update"));return this};Y.prototype.setDisabled=Y.prototype.od;var ke=new Y;Y.SEPARATOR=ke;function le(a,b,c){le.Z.constructor.call(this,a,c);this.message=b}Fa(le,U);r("H.util.ErrorEvent",le);function me(a){if(globalThis.document){var b=document.createElement("canvas");b.width=b.height=1;b.getContext("2d",{Fd:a})}}r("H.util.getPixelRatio",function(){return window.devicePixelRatio||1});Object.create(Qa,void 0);r("H.util.eval",function(a){return eval(a)});r("H.util.provide",function(a){var b=p.$jscomp;if(b&&("function"!=typeof b.Dc?0:b.Dc()))throw Error("goog.provide cannot be used within a module.");qa(a,void 0,void 0)});function ne(){this.v=0}\nne.prototype.next=function(a){if(9007199254740992===this.v)throw new Lc(a,this.v,[0,9007199254740991]);return this.v++};var oe=new ne;Na(oe.next,oe);var pe=Pa([]);Pa({});me(!0);me(!1);function qe(){}r("H.service.extension.dataView.IColumn",qe);qe.prototype.o=function(){};qe.prototype.getCell=qe.prototype.o;function re(a,b){this.Ca=a;this.qc=b}r("H.service.extension.dataView.ObjColumn",re);re.prototype.o=function(a){return this.Ca.o(a,this.qc)};re.prototype.getCell=re.prototype.o;function se(){}r("H.service.extension.dataView.IRow",se);se.prototype.L=function(){};se.prototype.getColumnNames=se.prototype.L;se.prototype.o=function(){};se.prototype.getCell=se.prototype.o;se.prototype.pb=function(){};se.prototype.getTable=se.prototype.pb;function te(a,b){this.Ca=a;this.nd=b}r("H.service.extension.dataView.ObjRow",te);te.prototype.L=function(){return this.Ca.L()};te.prototype.getColumnNames=te.prototype.L;te.prototype.o=function(a){return this.Ca.o(this.nd,a)};te.prototype.getCell=te.prototype.o;te.prototype.pb=function(){return this.Ca};te.prototype.getTable=te.prototype.pb;function Z(a,b,c){var d;b=b||(a&&a.length?Object.keys(a[0]):t);this.P=a;if(b)for(this.ca=b,this.ab=a=Object.create(Qa,void 0),d=b.length;d--;)a[b[d]]=!0;c!==t&&(this.ub=c)}r("H.service.extension.dataView.ObjTable",Z);l=Z.prototype;l.ub=t;l.P=t;l.ca=t;l.ab=t;l.nb=function(){return this.ub};Z.prototype.getMeta=Z.prototype.nb;Z.prototype.ob=function(){return this.P?this.P.length:0};Z.prototype.getRowCount=Z.prototype.ob;Z.prototype.Ja=function(a){var b=this.P;return b&&b[a]?new te(this,a):t};\nZ.prototype.getRow=Z.prototype.Ja;Z.prototype.L=function(){return this.ca||pe};Z.prototype.getColumnNames=Z.prototype.L;Z.prototype.lb=function(a){return this.ab[a]?new re(this,a):t};Z.prototype.getColumn=Z.prototype.lb;Z.prototype.o=function(a,b){var c=this.P;return(a=c&&this.ab[b]&&c[a])&&a[b]};Z.prototype.getCell=Z.prototype.o;\nZ.prototype.concat=function(){var a=arguments.length,b,c=this.ca,d=""+this.ca,e=(this.P||[]).slice();for(b=0;b<a;b++){var f=arguments[b];if(!(f instanceof Z))throw new x(this.concat,b);if(f.P){if(c&&""+f.ca!==d)throw new x(this.concat,b,"Incompatible columns!");e=e.concat(f.P)}}return new Z(e,this.ca,this.ub)};Z.prototype.concat=Z.prototype.concat;function ue(a,b,c,d,e,f){var g,h,k=a.length,m,n;if(k)for(g=[];k--;){var q=a[k];var u=q.length;var I=0;for(m=1;m<u;m++)if(n=ve(q[m-1],q[m],c,b,d,e)){var K=n[0];var w=n[1];I&&I.S(K)?h.push(w):g.push(h=n);I=w;f&&(m=u,k=0)}}else g=a;return g}r("H.math.clipping.clipStrips",ue);\nfunction ve(a,b,c,d,e,f){var g=a.x;a=-a.y;var h=b.x;b=-b.y;c=-c;f=-f;if(g>h){if(h>e||g<d)return;var k=g;var m=a;g=h;a=b;h=k;b=m;k=1}else if(g>e||h<d)return;if(a>b){if(b>c||a<f)return;var n=1;a=-a;b=-b;m=f;f=-c;c=-m}else if(a>c||b<f)return;if(g<d){if((a+=(d-g)*(b-a)/(h-g))>c)return;g=d}if(a<f){if((g+=(f-a)*(h-g)/(b-a))>e)return;a=f}h>e&&(b=a+(e-g)*(b-a)/(h-g),h=e);b>c&&(h=g+(c-a)*(h-g)/(b-a),b=c);n&&(a=-a,b=-b);return k?[new B(h,-b),new B(g,-a)]:[new B(g,-a),new B(h,-b)]}\nfunction we(a,b,c){a=xe(a,!0);b=xe(b,!1);var d,e;var f={};var g=d=1;switch(~~(1*(c||0))){case 1:g=d=0;break;case 2:d=0;g=1;break;case 3:d=1,g=0}c=d;var h=g;if(b&&a){b.ma=new ye(b.x,b.y,null,ze(b));a.ma=new ye(a.x,a.y,null,ze(a));for(g=b;g.next;g=g.next)if(!g.F)for(d=a;d.next;d=d.next)if(!d.F){var k=Ae(g.next);var m=Ae(d.next);if(e=Be(g,k,d,m,f)){e=f.ic;var n=f.jc;var q=f.wd;var u=f.xd;e=new ye(q,u,null,null,null,null,!0,0,0,e);Ce(e,g,k);k=new ye(q,u,null,null,null,null,!0,0,0,n);Ce(k,d,m);e.vb=k;\nk.vb=e}}f=Mb(b,De(a));c&&(f=!f);for(g=b;g;g=g.next)g.F&&(g.qb=f,f=!f);f=Mb(a,De(b));h&&(f=!f);for(d=a;d.next;d=d.next)d.F&&(d.qb=f,f=!f);Ee(b);for(Ee(a);(a=Fe(b))!=b;){for(c=null;!a.Wa;a=a.vb){for(f=a.qb;;){c=new ye(a.x,a.y,c);c.artificial=a.F||a.Rb;a.Wa=1;a=f?a.next:a.B;if(!a)break;if(a.F){a.Wa=1;break}}if(!a)break}c.Vb=I||null;var I=c}return I}}r("H.math.clipping.clipPolygon",we);\nfunction ye(a,b,c,d,e,f,g,h,k,m){this.x=a;this.y=b;this.next=c||null;this.B=d||null;this.Vb=e||null;this.vb=f||null;this.F=!!g;this.qb=!!h;this.Wa=k||0;this.alpha=m||0;d&&(d.next=this);c&&(c.B=this);this.Rb=!1;this.ma=null}function Ae(a){for(;a&&a.F;)a=a.next;return a}function ze(a){if(a)for(;a.next;)a=a.next;return a}function Fe(a){var b=a;if(b){do b=b.next;while(b!=a&&(!b.F||b.F&&b.Wa))}return b}function Ee(a){var b=ze(a);b.B.next=a;a.B=b.B}\nfunction Be(a,b,c,d,e){var f,g=b.x-a.x,h=b.y-a.y;var k=d.x-c.x;var m=d.y-c.y;var n=g*m-h*k;if(!n)return 0;k=((c.x-a.x)*m-(c.y-a.y)*k)/n;n=(h*(c.x-a.x)-g*(c.y-a.y))/n;if(0>k||1<k||0>n||1<n)return 0;0===k?f=a:1===k?f=b:0===n?f=c:1===n&&(f=d);if(f)return f.x+=2.480549651603763E-5,f.y+=7.321997314118067E-5,f.ma&&(f.ma.x=f.x,f.ma.y=f.y),Be(a,b,c,d,e);e.wd=a.x+k*g;e.xd=a.y+k*h;e.ic=k;e.jc=n;return 1}function De(a){for(var b=[];a;)b.push(a.x,a.y),a=a.next;return b}\nfunction Ce(a,b,c){for(b=b.next;b!==c&&b.alpha<=a.alpha;)b=b.next;a.next=b;a.B=b.B;a.next.B=a;a.B.next=a}function xe(a,b){for(var c,d=null,e=0,f=a.length;e<f;e++){c=new ye(a[e].x,a[e].y,d);c.Rb=b;if(c.next=d)d.B=c;d=c}return d};function Ge(a,b,c,d){this.key="";this.x=a;this.y=b;this.Sb=c;this.ra=d;this.O=qd()}Ge.prototype.then=function(a,b,c){return this.O.promise.then(a,b,c)};Ge.prototype.resolve=function(a){this.O.resolve(a)};Ge.prototype.reject=function(a){this.O.reject(a)};Ge.prototype.cancel=function(){this.O.promise.cancel()};Ge.prototype.cancel=Ge.prototype.cancel;r("H.util.Disposable",T);T.prototype.aa=T.prototype.aa;T.prototype.addOnDisposeCallback=T.prototype.aa;r("H.util.dispose",function(a){a&&"function"==typeof a.C&&a.C()});T.prototype.C=T.prototype.C;T.prototype.dispose=T.prototype.C;T.prototype.K=T.prototype.K;T.prototype.disposeInternal=T.prototype.K;function E(a,b,c,d){He(this,Pb(a,E,0),Qb(b,E,1),Pb(c,E,2),Qb(d,E,3))}Fa(E,C);r("H.geo.Rect",E);E.prototype.Xa="Polygon";E.prototype.dc=function(a){var b=this.l,c=this.g,d=this.j,e=this.i;a.push("(","(",c," ",b,",",e," ",b,",",e," ",d,",",c," ",d,",",c," ",b,")",")");return a};E.prototype.S=function(a){var b=this===a;!b&&Ta(a,E)&&(b=this.l===a.l&&this.g===a.g&&this.j===a.j&&this.i===a.i);return b};E.prototype.equals=E.prototype.S;\nE.prototype.clone=function(){return new E(this.l,this.g,this.j,this.i)};E.prototype.clone=E.prototype.clone;function He(a,b,c,d,e){a.g=c;a.i=e;b<d&&(c=b,b=d,d=c);a.l=b;a.j=d;a.Db=a.Za=a.$a=null;return a}E.prototype.Nb=function(){this.Db||(this.Db=new D(this.l,this.g));return this.Db};E.prototype.getTopLeft=E.prototype.Nb;E.prototype.Mb=function(){this.Za||(this.Za=new D(this.j,this.i));return this.Za};E.prototype.getBottomRight=E.prototype.Mb;E.prototype.Pc=function(){return this.l};\nE.prototype.getTop=E.prototype.Pc;E.prototype.Cc=function(){return this.j};E.prototype.getBottom=E.prototype.Cc;E.prototype.Ic=function(){return this.g};E.prototype.getLeft=E.prototype.Ic;E.prototype.Nc=function(){return this.i};E.prototype.getRight=E.prototype.Nc;E.prototype.T=function(){this.$a||(this.$a=new D(this.j+(this.l-this.j)/2,Ie(this.g,this.U())));return this.$a};E.prototype.getCenter=E.prototype.T;E.prototype.U=function(){return Je(this.g,this.i)};E.prototype.getWidth=E.prototype.U;\nE.prototype.fa=function(){return this.l-this.j};E.prototype.getHeight=E.prototype.fa;E.prototype.Wc=function(){return this.g>this.i};E.prototype.isCDB=E.prototype.Wc;E.prototype.Yc=function(){return!this.U()&&!this.fa()};E.prototype.isEmpty=E.prototype.Yc;E.prototype.pa=function(){return new E(this.l,this.g,this.j,this.i)};E.prototype.getBoundingBox=E.prototype.pa;\nE.prototype.Ha=function(a,b,c){var d=this.T();c||(a=Pb(a,this.Ha,0),b=Qb(b,this.Ha,1));b=this.V(a,b,c);a=b.T();return a.lat===d.lat&&a.lng===d.lng&&this.fa()===b.fa()&&this.U()===b.U()};E.prototype.containsLatLng=E.prototype.Ha;E.prototype.Ia=function(a,b){b||Sb(a,this.Ia,0);return this.Ha(a.lat,a.lng,b)};E.prototype.containsPoint=E.prototype.Ia;\nE.prototype.Kb=function(a,b){var c=this.T();if(!b&&!Ta(a,E))throw new x(this.Kb,0,a);b=this.Pa(a,b);a=b.T();return a.lat===c.lat&&a.lng===c.lng&&this.fa()===b.fa()&&this.U()===b.U()};E.prototype.containsRect=E.prototype.Kb;E.prototype.V=function(a,b,c,d){if(!c){if(Ya(a=Pb(a)))throw new x(this.V,0,a);if(Ya(b=Qb(b)))throw new x(this.V,1,b);}return Ke(this.l,this.g,this.j,this.i,a,b,a,b,d)};E.prototype.mergeLatLng=E.prototype.V;\nE.prototype.Ub=function(a,b,c){b||Sb(a,this.Ub,0);return this.V(a.lat,a.lng,b,c)};E.prototype.mergePoint=E.prototype.Ub;E.prototype.Pa=function(a,b,c){if(!b&&!Ta(a,E))throw new x(this.Pa,0,a);return Ke(this.l,this.g,this.j,this.i,a.l,a.g,a.j,a.i,c)};E.prototype.mergeRect=E.prototype.Pa;E.prototype.sa=function(a,b,c,d,e,f){e||(a=Pb(a,this.sa,0),b=Qb(b,this.sa,1),c=Pb(c,this.sa,2),d=Qb(d,this.sa,3));return Ke(this.l,this.g,this.j,this.i,a,b,c,d,f)};E.prototype.mergeTopLeftBottomRight=E.prototype.sa;\nE.prototype.Qb=function(a,b){var c=this.g<=this.i,d=a.g<=a.i,e=this.g<a.i,f=a.g<this.i;if(!b&&!Ta(a,E))throw new x(this.Qb,0,a);return this.j<=a.l&&a.j<=this.l&&(!c&&(!d||e||f)||!d&&(e||f)||e&&f)};E.prototype.intersects=E.prototype.Qb;function Je(a,b){a=b-a;return a+(0>a?360:0)}function Ie(a,b){a+=b/2;return a-(180<a?360:0)}\nfunction Ke(a,b,c,d,e,f,g,h,k){c=jb(c,g);a=kb(a,e);e=Je(b,d);var m=Ie(b,e);g=Je(f,h);var n=Ie(f,g)-m;n+=0>n-1E-6?360:0;if(180>n-1E-6){m=b;var q=h}else n=360-n,m=f,q=d;n=n+e/2+g/2;360<=n+5E-7?(m=-180,q=180):n-5E-7<e?(m=b,q=d):n-5E-7<g&&(m=f,q=h);return k?He(k,a,m,c,q):new E(a,m,c,q)}E.merge=Ke;function Le(a,b,c){c||(Sb(a,Le,0),Sb(b,Le,1));return new E(a.lat,a.lng,b.lat,b.lng)}E.fromPoints=Le;\nfunction Me(a,b){var c=1,d=a.length,e=null;var f=ta(a);if("array"!=f&&("object"!=f||"number"!=typeof a.length))throw new x(Me,0,a);if(0<d)for(f=a[0],e=Le(f,f,b);c<d;c++)f=a[c],e.V(f.lat,f.lng,b,e);return e}E.coverPoints=Me;function Ne(a,b){var c=3,d=a.length,e;if(!(b||a&&null!=a.length))throw new x(Ne,0,a);if(0<d)for(e=new E(a[0],a[1],a[0],a[1]);c<d;c+=3)e.V(a[c],a[c+1],b,e);return e}E.coverLatLngAlts=Ne;\nfunction Oe(a,b){var c=1,d=a.length,e;if(b&&(!a||null==a.length))throw new x(Oe,0,a);if(0<d)for(e=new E(a[0].l,a[0].g,a[0].j,a[0].i);c<d;c++)e.Pa(a[c],b,e);return e}E.coverRects=Oe;\nE.prototype.Yb=function(a,b){var c=this.g,d=this.l,e=this.i,f=this.j,g=this.T().lng;Sb(a,this.Yb,0);var h=a.lat-f-(d-f)/2;var k=a.lng-g;k=180<k||-180>k?-(g+a.lng):k;a=c+(0>k?2*k:0);a=-180>a?360+a:a;e+=0<k?2*k:0;e=180<e?e-360:e;d=0<h?d+2*h:d;90<=d&&(d=90);f=0>h?f+2*h:f;-90>=f&&(f=-90);return b?He(b,d,a,f,e):new E(d,a,f,e)};E.prototype.resizeToCenter=E.prototype.Yb;E.prototype.kb="Polygon";\nE.prototype.cc=function(){return[[this.g,this.l,0],[this.i,this.l,0],[this.i,this.j,0],[this.g,this.j,0],[this.g,this.l,0]]};E.prototype.ib=function(){return this.jb()};E.prototype.jb=function(){return[this.l,this.g,this.j,this.i]};function Pe(a,b){var c=a.tileSize||256;this.va={};this.$b=Ec(a.serverUrl);this.Ib=b;this.Zc=a.layerConfigs||[];this.Xb=a.projected;this.bc=c;this.lc=!1!==a.batchTiles;this.Tc=a.horizontalMargin||0;this.ad=a.onlyOutline;this.jd=new G(t,c);this.tb=new G(t,c);this.tb.Aa(22-Math.log(c)/Math.LN2+8)}Fa(Pe,T);\nPe.prototype.ld=function(a,b,c){var d=this.bc,e=this.Tc,f={x:a*d-e,y:b*d};d={x:(a+1)*d-1+e,y:(b+1)*d-1};e=this.jd;e.Aa(c);f=e.xb(f);d=e.xb(d);return Qe(this,new E(f.lat,f.lng,d.lat,d.lng),this.Zc,{x:a,y:b,z:c})};Pe.prototype.kd=function(a,b,c,d,e){return Qe(this,new E(a,b,c,d),e)};\nfunction Qe(a,b,c,d){var e=Re(c),f=e.length,g={},h,k=a.va,m=[],n=[];for(c=0;c<f;c++){var q=e[c];var u=q.layerId;var I=q.level;g[u]=q.columns;q=vc(b,I);var K=q.length-1;for(h=0;h<K;h+=2){var w=[u,q[h+1],q[h],I].join("_");var F=k[w]||a.Ib.get(w);F||(F=new Ge(q[h+1],q[h],I,u),F.key=w,k[w]=F,n.push(F));m.push(F)}}n.length&&(a.lc?Se(a,n):Te(a,n));return pd(m.map(function(W){var ia=Na(this.xc,this,g[W.ra]),N=Na(this.gd,this,W,d||Ue),Ea=W.then,va=this.wc,wa=W.ra,xa={},v,R=e.length;for(v=0;v<R;v++){var J=\ne[v];if(J.rowFilter){var V=J.layerId;V=V!==t?V:J.layer;xa[V]=Na(J.rowFilter,J.rowFilterContext)}}return Ea.call(W,Na(va,this,wa,xa)).then(N).then(ia)},a))}var Ue={x:0,y:0,z:0};Pe.prototype.wc=function(a,b,c){var d=c.Rows,e=d.length,f,g;if(e&&(f=b[a])){b=new Z(c.Rows);var h=[];for(g=0;g<e;g++){var k=d[g];f(b.Ja(g),a)&&h.push(k)}a={Rows:h};if(c=c.Meta)a.Meta=c}else a=c;return a};\nfunction Te(a,b){function c(k,m,n){n?(delete a.va[k.key],k.reject(n)):Ve(a,k,m)}var d,e=b.length,f=a.$b;for(d=0;d<e;d++){var g=b[d];var h=f.clone().ga({tilex:g.x}).ga({tiley:g.y}).ga({level:g.Sb}).ga({layer:g.ra});new ic(h.toString(),Na(c,null,g),pc)}}function Se(a,b){var c=b.length,d;for(d=0;d<c;d+=15){var e=b.slice(d,d+15);We(a,e)}}\nfunction We(a,b){var c=a.$b.clone(),d=[],e=[],f=[],g=c.getQuery();b.length&&(b.forEach(function(h){d.push(h.x,h.y);e.push(h.Sb);f.push(h.ra)}),g.tilexy=d.join(","),g.layers=f.join(","),g.levels=e.join(","),c.Ta(g),new ic(c.toString(),function(h,k){k?b.forEach(function(m){delete a.va[m.key];m.reject("error")}):Ve(a,b,h)},pc))}\nfunction Ve(a,b,c){var d=b.length,e;if(Va(b,void 0,void 0,void 0)){var f=c.indexOf("[")+1;for(e=0;e<d;e++){var g=c.indexOf("]},{",f+3)+2;g<f&&(g=c.lastIndexOf("]}"));var h=c.substr(f,g-f);f=g+1;Xe(a,b[e],h)}}else Xe(a,b,c)}function Xe(a,b,c){try{var d=c.length;var e=b.key;delete a.va[e];a.Ib.add(e,b,2*d);b.resolve(JSON.parse(c))}catch(f){b.reject(f.message)}}function Ye(a,b,c,d,e){return e?[new B(a,b),new B(c,b),new B(c,d),new B(a,d),new B(a,b)]:[a,b,c,b,c,d,a,d]}\nPe.prototype.gd=function(a,b,c){var d=this.tb.Ob()-b.z,e=this.bc<<d,f=50<<d,g=b.x*e;b=b.y*e;var h=g+e;e=b+e;var k=g-f,m=b-f,n=h+f;f=e+f;var q,u,I=c.Rows,K=I.length,w,F=/^ADAS/.test(a.ra),W=this.tb,ia=this.ad,N,Ea=[],va=[],wa=[],xa=[];for(a=0;a<K;a++){var v=w=I[a];var R=(N=F)?"HPY":"LAT";var J=N?"HPX":"LON";var V=N?"HPZ":"ZLEVEL";if(v[R]){var P=qc(v[R],v[J],v[V],N);v.geometry=P;delete v[R];delete v[J];delete v[V];if(v.INNER_LAT)for(R=v.INNER_LAT.split(";"),P=v.INNER_LON.split(";"),delete v.INNER_LAT,\ndelete v.INNER_LON,v.interiors=V=[],J=R.length,v=0;v<J;v++)V.push(qc(R[v],P[v],"",N))}if(this.Xb){J=w;v=W;P=J.$$projected$$;R=0;if(!P){var aa=J.geometry;N=sc(aa.path,v);w=[N];J.$$projected$$=P={dd:w};J=(V=J.interiors)?V.length:0;w.length+=J;R|=+Ze(w,N,aa.outlineIndices);if(J)for(P.Uc=1,q=0;q<J;q++)aa=V[q],N=sc(aa.path,v),w[1+q]=N,R|=+Ze(w,N,aa.outlineIndices);R&&(P.bd=1+J)}v=P;N=v.dd;w=v.Uc;var mc=v.bd;P=[];R=J=Gb;var Za=V=t;v=N[0];if(1===v.length){var nc=nc||(nc=Ye(g,b,h,e,!1));w=v[0];Lb(w.x,w.y,\nnc)&&P.push($e(v,g,b,d))}else{var Wd=N.length;for(aa=ia?mc:0;aa<Wd&&(ia||!aa||P.length);aa++)if(v=N[aa],aa>=mc){aa===mc&&(R=P.length);var ja=ue([v],k,m,n,f,!1);af(ja,g,b,d,P)}else{var Ab=Ab||(Ab=Ye(k,m,n,f,!0));if(aa>=w)if(aa===w&&(J=P.length),Za)for(q=Za.length;q--;){if(ja=bf(Za[q],v),u=ja.length){for(V=V||[];u--;)V.push(q);af(ja,g,b,d,P)}}else ja=bf(Ab,v),af(ja,g,b,d,P);else if(ja=bf(Ab,v),af(ja,g,b,d,P),1<ja.length&&w<Wd)for(Za=[],q=ja.length;q--;)Za[q]=ja[q]}}P.length&&(Ea[a]=P,va[a]=J,wa[a]=\nV,xa[a]=R)}}return{rd:c,pc:Ea,Vc:va,vc:wa,cd:xa}};function Ze(a,b,c){for(var d=c.length,e=0,f,g,h=b.length;e<d;)f=c[e++],g=c[e++],a.push(g-f===h?b:b.slice(f,g));return 0<c.length}function bf(a,b){var c,d=[];if(c=we(a,b)){do{a=[];b=c;do a.push(b);while(b=b.next);d.push(a)}while(c=c.Vb)}else Mb(b[0],Nb(a))?d.push(b):Mb(a[0],Nb(b))&&d.push(a);return d}function af(a,b,c,d,e){for(var f=0,g=a.length;f<g;f++)e.push($e(a[f],b,c,d))}\nfunction $e(a,b,c,d){var e,f=a.length,g=new Int32Array(2*f),h=0;for(e=0;e<f;e++){var k=a[e];g[h++]=k.x-b>>d;g[h++]=k.y-c>>d}return g}\nPe.prototype.xc=function(a,b){var c=b.rd,d=b.pc,e=b.Vc,f=b.cd;b=b.vc;for(var g=[],h,k={Rows:g},m,n=a?a.length:0,q=0,u,I=c.Rows,K=I.length,w;q<K;q+=1)if(d[q]||!this.Xb){h={};u=I[q];if(n)for(m=0;m<n;m++)u.hasOwnProperty(a[m])&&(h[a[m]]=u[a[m]]);else for(w in u)"$$projected$$"!==w&&(h[w]=u[w]);u.geometry&&(h.geometry=u.geometry);m=void 0;var F,W=h,ia=d[q],N=e[q],Ea=b[q],va=f[q],wa=g;if(ia){var xa=ia.length;if(Ea)for(F=N;F--;){if(F){var v={};for(m in W)v[m]=W[m]}else v=W;u=[ia[F]];var R=jb(xa,va)-N;for(h=\n0;h<R;h++)Ea[h]===F&&u.push(ia[N+h]);R=u.length;if(!F)for(h=va;h<xa;h++)u.push(ia[h]);v.$HProjGeometry={paths:u,interiorsIndex:1,outlinesIndex:R};wa.push(v)}else W.$HProjGeometry={paths:ia,interiorsIndex:N,outlinesIndex:va},wa.push(W)}else wa.push(W)}c.Meta&&(k.Meta=c.Meta);return k};Pe.prototype.K=function(){var a,b=this.va;for(a in b)b.hasOwnProperty(a)&&(b[a].reject("disposed"),delete b[a])};Pe.prototype.disposeInternal=Pe.prototype.K;\nfunction Re(a){for(var b=[],c,d=a.length,e=0;e<d;e++){c=Ia(a[e]);if(c.rowFilter&&(c.rowFilter=eval("("+c.rowFilter+")"),!Ua(c.rowFilter)))throw Error("Invalid row filter for layer "+c.layerId);b.push(c)}return b};r("H.service.extension.worker.processor",function(a,b,c){function d(h){e.postMessage(h)}var e=this,f=Ha[a];var g=function(h){e.postError(h.toString())};if(0===b)f||(Ha[a]=new Pe(c,cf)),this.postMessage(void 0);else if(f)switch(b){case 1:try{f.ld.apply(f,c).then(d,g)}catch(h){this.postError(h.message)}break;case 2:try{f.kd.apply(f,c).then(d,g)}catch(h){this.postError(h.message)}break;case 3:f.C();delete Ha[a];Ga()&&cf.ia();break;default:e.postError("Unsupported command")}});\nvar cf=new M(26214400),Ha=Object.create(Qa,void 0);self.addEventListener("message",function(a){a=new hc(a.data);var b=dc[a.Wb];if(b)try{b.apply(a,a.kc)}catch(c){a.postError(c.message)}else a.postError("processor_not_found")});(function(){var a=new hc;var b=function(c,d){gc.apply(a,[c,d,!0])};b("0",ec);b("1",gc);b("2",fc);b("3",oc)})();\n',function(){var f=function(){var target=("undefined"==typeof self||!("undefined"!=typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope))&&(module.exports||"undefined"!=typeof window);if(target)var __worker_src__=f.toString(),__worker_src_map__="",__worker_src_origin__="undefined"!=typeof document&&document.currentScript instanceof HTMLScriptElement?document.currentScript.src:"";(function(){var commonjsGlobal="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function getDefaultExportFromCjs(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}function getAugmentedNamespace(t){if(t.__esModule)return t;var e=t.default;if("function"==typeof e){var r=function t(){return this instanceof t?Reflect.construct(e,arguments,this.constructor):e.apply(this,arguments)};r.prototype=e.prototype}else r={};return Object.defineProperty(r,"__esModule",{value:!0}),Object.keys(t).forEach((function(e){var i=Object.getOwnPropertyDescriptor(t,e);Object.defineProperty(r,e,i.get?i:{enumerable:!0,get:function(){return t[e]}})})),r}var toString$2={}.toString,classofRaw$1=function(t){return toString$2.call(t).slice(8,-1)},shared$1={exports:{}},O="object",check=function(t){return t&&t.Math==Math&&t},global$c=check(typeof globalThis==O&&globalThis)||check(typeof window==O&&window)||check(typeof self==O&&self)||check(typeof commonjsGlobal==O&&commonjsGlobal)||Function("return this")(),objectDefineProperty={},fails$3=function(t){try{return!!t()}catch(t){return!0}},descriptors=!fails$3((function(){return 7!=Object.defineProperty({},"a",{get:function(){return 7}}).a})),isObject$9=function(t){return"object"==typeof t?null!==t:"function"==typeof t},isObject$8=isObject$9,document$3=global$c.document,exist=isObject$8(document$3)&&isObject$8(document$3.createElement),documentCreateElement$1=function(t){return exist?document$3.createElement(t):{}},ie8DomDefine=!descriptors&&!fails$3((function(){return 7!=Object.defineProperty(documentCreateElement$1("div"),"a",{get:function(){return 7}}).a})),isObject$7=isObject$9,anObject$9=function(t){if(!isObject$7(t))throw TypeError(String(t)+" is not an object");return t},isObject$6=isObject$9,toPrimitive$2=function(t,e){if(!isObject$6(t))return t;var r,i;if(e&&"function"==typeof(r=t.toString)&&!isObject$6(i=r.call(t)))return i;if("function"==typeof(r=t.valueOf)&&!isObject$6(i=r.call(t)))return i;if(!e&&"function"==typeof(r=t.toString)&&!isObject$6(i=r.call(t)))return i;throw TypeError("Can't convert object to primitive value")},DESCRIPTORS$2=descriptors,IE8_DOM_DEFINE$1=ie8DomDefine,anObject$8=anObject$9,toPrimitive$1=toPrimitive$2,nativeDefineProperty=Object.defineProperty;objectDefineProperty.f=DESCRIPTORS$2?nativeDefineProperty:function(t,e,r){if(anObject$8(t),e=toPrimitive$1(e,!0),anObject$8(r),IE8_DOM_DEFINE$1)try{return nativeDefineProperty(t,e,r)}catch(t){}if("get"in r||"set"in r)throw TypeError("Accessors not supported");return"value"in r&&(t[e]=r.value),t};var createPropertyDescriptor$3=function(t,e){return{enumerable:!(1&t),configurable:!(2&t),writable:!(4&t),value:e}},definePropertyModule$2=objectDefineProperty,createPropertyDescriptor$2=createPropertyDescriptor$3,hide$7=descriptors?function(t,e,r){return definePropertyModule$2.f(t,e,createPropertyDescriptor$2(1,r))}:function(t,e,r){return t[e]=r,t},global$b=global$c,hide$6=hide$7,setGlobal$2=function(t,e){try{hide$6(global$b,t,e)}catch(r){global$b[t]=e}return e},isPure=!1,global$a=global$c,setGlobal$1=setGlobal$2,SHARED="__core-js_shared__",store$2=global$a[SHARED]||setGlobal$1(SHARED,{});(shared$1.exports=function(t,e){return store$2[t]||(store$2[t]=void 0!==e?e:{})})("versions",[]).push({version:"3.1.0",mode:"global",copyright:"© 2019 Denis Pushkarev (zloirock.ru)"});var sharedExports=shared$1.exports,id$2=0,postfix=Math.random(),uid$2=function(t){return"Symbol(".concat(void 0===t?"":t,")_",(++id$2+postfix).toString(36))},nativeSymbol=!fails$3((function(){return!String(Symbol())})),store$1=sharedExports("wks"),uid$1=uid$2,Symbol$1=global$c.Symbol,NATIVE_SYMBOL=nativeSymbol,wellKnownSymbol$1=function(t){return store$1[t]||(store$1[t]=NATIVE_SYMBOL&&Symbol$1[t]||(NATIVE_SYMBOL?Symbol$1:uid$1)("Symbol."+t))},classofRaw=classofRaw$1,TO_STRING_TAG$2=wellKnownSymbol$1("toStringTag"),CORRECT_ARGUMENTS="Arguments"==classofRaw(function(){return arguments}()),tryGet=function(t,e){try{return t[e]}catch(t){}},classof$6=function(t){var e,r,i;return void 0===t?"Undefined":null===t?"Null":"string"==typeof(r=tryGet(e=Object(t),TO_STRING_TAG$2))?r:CORRECT_ARGUMENTS?classofRaw(e):"Object"==(i=classofRaw(e))&&"function"==typeof e.callee?"Arguments":i},classof$5=classof$6,TO_STRING_TAG$1=wellKnownSymbol$1("toStringTag"),test={};test[TO_STRING_TAG$1]="z";var objectToString$1="[object z]"!==String(test)?function(){return"[object "+classof$5(this)+"]"}:test.toString,redefine$2={exports:{}},hasOwnProperty$1={}.hasOwnProperty,has$6=function(t,e){return hasOwnProperty$1.call(t,e)},functionToString,hasRequiredFunctionToString;function requireFunctionToString(){return hasRequiredFunctionToString?functionToString:(hasRequiredFunctionToString=1,functionToString=sharedExports("native-function-to-string",Function.toString))}var nativeFunctionToString=requireFunctionToString(),WeakMap$1=global$c.WeakMap,nativeWeakMap="function"==typeof WeakMap$1&&/native code/.test(nativeFunctionToString.call(WeakMap$1)),shared=sharedExports("keys"),uid=uid$2,sharedKey$1=function(t){return shared[t]||(shared[t]=uid(t))},hiddenKeys$3={},NATIVE_WEAK_MAP=nativeWeakMap,isObject$5=isObject$9,hide$5=hide$7,objectHas=has$6,sharedKey=sharedKey$1,hiddenKeys$2=hiddenKeys$3,WeakMap=global$c.WeakMap,set$2,get,has$5,enforce=function(t){return has$5(t)?get(t):set$2(t,{})},getterFor=function(t){return function(e){var r;if(!isObject$5(e)||(r=get(e)).type!==t)throw TypeError("Incompatible receiver, "+t+" required");return r}};if(NATIVE_WEAK_MAP){var store=new WeakMap,wmget=store.get,wmhas=store.has,wmset=store.set;set$2=function(t,e){return wmset.call(store,t,e),e},get=function(t){return wmget.call(store,t)||{}},has$5=function(t){return wmhas.call(store,t)}}else{var STATE=sharedKey("state");hiddenKeys$2[STATE]=!0,set$2=function(t,e){return hide$5(t,STATE,e),e},get=function(t){return objectHas(t,STATE)?t[STATE]:{}},has$5=function(t){return objectHas(t,STATE)}}var internalState={set:set$2,get,has:has$5,enforce,getterFor},hasRequiredRedefine;function requireRedefine(){if(hasRequiredRedefine)return redefine$2.exports;hasRequiredRedefine=1;var t=global$c,e=hide$7,r=has$6,i=setGlobal$2,n=requireFunctionToString(),o=internalState,a=o.get,s=o.enforce,l=String(n).split("toString");return sharedExports("inspectSource",(function(t){return n.call(t)})),(redefine$2.exports=function(n,o,a,u){var c=!!u&&!!u.unsafe,h=!!u&&!!u.enumerable,p=!!u&&!!u.noTargetGet;"function"==typeof a&&("string"!=typeof o||r(a,"name")||e(a,"name",o),s(a).source=l.join("string"==typeof o?o:"")),n!==t?(c?!p&&n[o]&&(h=!0):delete n[o],h?n[o]=a:e(n,o,a)):h?n[o]=a:i(o,a)})(Function.prototype,"toString",(function(){return"function"==typeof this&&a(this).source||n.call(this)})),redefine$2.exports}var toString$1=objectToString$1,ObjectPrototype$1=Object.prototype;toString$1!==ObjectPrototype$1.toString&&requireRedefine()(ObjectPrototype$1,"toString",toString$1,{unsafe:!0});var ceil=Math.ceil,floor=Math.floor,toInteger$3=function(t){return isNaN(t=+t)?0:(t>0?floor:ceil)(t)},requireObjectCoercible$3=function(t){if(null==t)throw TypeError("Can't call method on "+t);return t},toInteger$2=toInteger$3,requireObjectCoercible$2=requireObjectCoercible$3,stringAt=function(t,e,r){var i,n,o=String(requireObjectCoercible$2(t)),a=toInteger$2(e),s=o.length;return a<0||a>=s?r?"":void 0:(i=o.charCodeAt(a))<55296||i>56319||a+1===s||(n=o.charCodeAt(a+1))<56320||n>57343?r?o.charAt(a):i:r?o.slice(a,a+2):n-56320+(i-55296<<10)+65536},objectGetOwnPropertyDescriptor={},objectPropertyIsEnumerable={},nativePropertyIsEnumerable={}.propertyIsEnumerable,nativeGetOwnPropertyDescriptor$1=Object.getOwnPropertyDescriptor,NASHORN_BUG=nativeGetOwnPropertyDescriptor$1&&!nativePropertyIsEnumerable.call({1:2},1);objectPropertyIsEnumerable.f=NASHORN_BUG?function(t){var e=nativeGetOwnPropertyDescriptor$1(this,t);return!!e&&e.enumerable}:nativePropertyIsEnumerable;var fails$2=fails$3,classof$4=classofRaw$1,split="".split,indexedObject=fails$2((function(){return!Object("z").propertyIsEnumerable(0)}))?function(t){return"String"==classof$4(t)?split.call(t,""):Object(t)}:Object,IndexedObject=indexedObject,requireObjectCoercible$1=requireObjectCoercible$3,toIndexedObject$4=function(t){return IndexedObject(requireObjectCoercible$1(t))},DESCRIPTORS$1=descriptors,propertyIsEnumerableModule=objectPropertyIsEnumerable,createPropertyDescriptor$1=createPropertyDescriptor$3,toIndexedObject$3=toIndexedObject$4,toPrimitive=toPrimitive$2,has$4=has$6,IE8_DOM_DEFINE=ie8DomDefine,nativeGetOwnPropertyDescriptor=Object.getOwnPropertyDescriptor;objectGetOwnPropertyDescriptor.f=DESCRIPTORS$1?nativeGetOwnPropertyDescriptor:function(t,e){if(t=toIndexedObject$3(t),e=toPrimitive(e,!0),IE8_DOM_DEFINE)try{return nativeGetOwnPropertyDescriptor(t,e)}catch(t){}if(has$4(t,e))return createPropertyDescriptor$1(!propertyIsEnumerableModule.f.call(t,e),t[e])};var objectGetOwnPropertyNames={},toInteger$1=toInteger$3,min$1=Math.min,toLength$2=function(t){return t>0?min$1(toInteger$1(t),9007199254740991):0},toInteger=toInteger$3,max=Math.max,min=Math.min,toAbsoluteIndex$1=function(t,e){var r=toInteger(t);return r<0?max(r+e,0):min(r,e)},toIndexedObject$2=toIndexedObject$4,toLength$1=toLength$2,toAbsoluteIndex=toAbsoluteIndex$1,arrayIncludes=function(t){return function(e,r,i){var n,o=toIndexedObject$2(e),a=toLength$1(o.length),s=toAbsoluteIndex(i,a);if(t&&r!=r){for(;a>s;)if((n=o[s++])!=n)return!0}else for(;a>s;s++)if((t||s in o)&&o[s]===r)return t||s||0;return!t&&-1}},has$3=has$6,toIndexedObject$1=toIndexedObject$4,arrayIndexOf$1=arrayIncludes(!1),hiddenKeys$1=hiddenKeys$3,objectKeysInternal=function(t,e){var r,i=toIndexedObject$1(t),n=0,o=[];for(r in i)!has$3(hiddenKeys$1,r)&&has$3(i,r)&&o.push(r);for(;e.length>n;)has$3(i,r=e[n++])&&(~arrayIndexOf$1(o,r)||o.push(r));return o},enumBugKeys$2=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"],internalObjectKeys$1=objectKeysInternal,hiddenKeys=enumBugKeys$2.concat("length","prototype");objectGetOwnPropertyNames.f=Object.getOwnPropertyNames||function(t){return internalObjectKeys$1(t,hiddenKeys)};var objectGetOwnPropertySymbols={};objectGetOwnPropertySymbols.f=Object.getOwnPropertySymbols;var getOwnPropertyNamesModule=objectGetOwnPropertyNames,getOwnPropertySymbolsModule=objectGetOwnPropertySymbols,anObject$7=anObject$9,Reflect$1=global$c.Reflect,ownKeys$1=Reflect$1&&Reflect$1.ownKeys||function(t){var e=getOwnPropertyNamesModule.f(anObject$7(t)),r=getOwnPropertySymbolsModule.f;return r?e.concat(r(t)):e},has$2=has$6,ownKeys=ownKeys$1,getOwnPropertyDescriptorModule=objectGetOwnPropertyDescriptor,definePropertyModule$1=objectDefineProperty,copyConstructorProperties$1=function(t,e){for(var r=ownKeys(e),i=definePropertyModule$1.f,n=getOwnPropertyDescriptorModule.f,o=0;o<r.length;o++){var a=r[o];has$2(t,a)||i(t,a,n(e,a))}},fails$1=fails$3,replacement=/#|\.prototype\./,isForced$2=function(t,e){var r=data[normalize$1(t)];return r==POLYFILL||r!=NATIVE&&("function"==typeof e?fails$1(e):!!e)},normalize$1=isForced$2.normalize=function(t){return String(t).replace(replacement,".").toLowerCase()},data=isForced$2.data={},NATIVE=isForced$2.NATIVE="N",POLYFILL=isForced$2.POLYFILL="P",isForced_1=isForced$2,global$9=global$c,getOwnPropertyDescriptor$1=objectGetOwnPropertyDescriptor.f,hide$4=hide$7,redefine$1=requireRedefine(),setGlobal=setGlobal$2,copyConstructorProperties=copyConstructorProperties$1,isForced$1=isForced_1,_export=function(t,e){var r,i,n,o,a,s=t.target,l=t.global,u=t.stat;if(r=l?global$9:u?global$9[s]||setGlobal(s,{}):(global$9[s]||{}).prototype)for(i in e){if(o=e[i],n=t.noTargetGet?(a=getOwnPropertyDescriptor$1(r,i))&&a.value:r[i],!isForced$1(l?i:s+(u?".":"#")+i,t.forced)&&void 0!==n){if(typeof o==typeof n)continue;copyConstructorProperties(o,n)}(t.sham||n&&n.sham)&&hide$4(o,"sham",!0),redefine$1(r,i,o,t)}},requireObjectCoercible=requireObjectCoercible$3,toObject$1=function(t){return Object(requireObjectCoercible(t))},correctPrototypeGetter=!fails$3((function(){function t(){}return t.prototype.constructor=null,Object.getPrototypeOf(new t)!==t.prototype})),has$1=has$6,toObject=toObject$1,IE_PROTO$1=sharedKey$1("IE_PROTO"),CORRECT_PROTOTYPE_GETTER=correctPrototypeGetter,ObjectPrototype=Object.prototype,objectGetPrototypeOf=CORRECT_PROTOTYPE_GETTER?Object.getPrototypeOf:function(t){return t=toObject(t),has$1(t,IE_PROTO$1)?t[IE_PROTO$1]:"function"==typeof t.constructor&&t instanceof t.constructor?t.constructor.prototype:t instanceof Object?ObjectPrototype:null},getPrototypeOf$1=objectGetPrototypeOf,hide$3=hide$7,has=has$6,ITERATOR$5=wellKnownSymbol$1("iterator"),BUGGY_SAFARI_ITERATORS$1=!1,returnThis$2=function(){return this},IteratorPrototype$2,PrototypeOfArrayIteratorPrototype,arrayIterator;[].keys&&(arrayIterator=[].keys(),"next"in arrayIterator?(PrototypeOfArrayIteratorPrototype=getPrototypeOf$1(getPrototypeOf$1(arrayIterator)),PrototypeOfArrayIteratorPrototype!==Object.prototype&&(IteratorPrototype$2=PrototypeOfArrayIteratorPrototype)):BUGGY_SAFARI_ITERATORS$1=!0),null==IteratorPrototype$2&&(IteratorPrototype$2={}),has(IteratorPrototype$2,ITERATOR$5)||hide$3(IteratorPrototype$2,ITERATOR$5,returnThis$2);var iteratorsCore={IteratorPrototype:IteratorPrototype$2,BUGGY_SAFARI_ITERATORS:BUGGY_SAFARI_ITERATORS$1},internalObjectKeys=objectKeysInternal,enumBugKeys$1=enumBugKeys$2,objectKeys$2=Object.keys||function(t){return internalObjectKeys(t,enumBugKeys$1)},DESCRIPTORS=descriptors,definePropertyModule=objectDefineProperty,anObject$6=anObject$9,objectKeys$1=objectKeys$2,objectDefineProperties=DESCRIPTORS?Object.defineProperties:function(t,e){anObject$6(t);for(var r,i=objectKeys$1(e),n=i.length,o=0;n>o;)definePropertyModule.f(t,r=i[o++],e[r]);return t},document$2=global$c.document,html$2=document$2&&document$2.documentElement,anObject$5=anObject$9,defineProperties=objectDefineProperties,enumBugKeys=enumBugKeys$2,html$1=html$2,documentCreateElement=documentCreateElement$1,IE_PROTO=sharedKey$1("IE_PROTO"),PROTOTYPE="prototype",Empty=function(){},createDict=function(){var t,e=documentCreateElement("iframe"),r=enumBugKeys.length,i="script",n="java"+i+":";for(e.style.display="none",html$1.appendChild(e),e.src=String(n),(t=e.contentWindow.document).open(),t.write("<"+i+">document.F=Object</"+i+">"),t.close(),createDict=t.F;r--;)delete createDict[PROTOTYPE][enumBugKeys[r]];return createDict()},objectCreate=Object.create||function(t,e){var r;return null!==t?(Empty[PROTOTYPE]=anObject$5(t),r=new Empty,Empty[PROTOTYPE]=null,r[IE_PROTO]=t):r=createDict(),void 0===e?r:defineProperties(r,e)},setToStringTag$2,hasRequiredSetToStringTag;function requireSetToStringTag(){if(hasRequiredSetToStringTag)return setToStringTag$2;hasRequiredSetToStringTag=1;var t=objectDefineProperty.f,e=has$6,r=wellKnownSymbol$1("toStringTag");return setToStringTag$2=function(i,n,o){i&&!e(i=o?i:i.prototype,r)&&t(i,r,{configurable:!0,value:n})}}hiddenKeys$3[IE_PROTO]=!0;var iterators={},IteratorPrototype$1=iteratorsCore.IteratorPrototype,create$3=objectCreate,createPropertyDescriptor=createPropertyDescriptor$3,setToStringTag$1=requireSetToStringTag(),Iterators$4=iterators,returnThis$1=function(){return this},createIteratorConstructor$1=function(t,e,r){var i=e+" Iterator";return t.prototype=create$3(IteratorPrototype$1,{next:createPropertyDescriptor(1,r)}),setToStringTag$1(t,i,!1,!0),Iterators$4[i]=returnThis$1,t},isObject$4=isObject$9,anObject$4=anObject$9,validateSetPrototypeOfArguments$1=function(t,e){if(anObject$4(t),!isObject$4(e)&&null!==e)throw TypeError("Can't set "+String(e)+" as a prototype")},validateSetPrototypeOfArguments=validateSetPrototypeOfArguments$1,objectSetPrototypeOf=Object.setPrototypeOf||("__proto__"in{}?function(){var t,e=!1,r={};try{(t=Object.getOwnPropertyDescriptor(Object.prototype,"__proto__").set).call(r,[]),e=r instanceof Array}catch(t){}return function(r,i){return validateSetPrototypeOfArguments(r,i),e?t.call(r,i):r.__proto__=i,r}}():void 0),$export$1=_export,createIteratorConstructor=createIteratorConstructor$1,getPrototypeOf=objectGetPrototypeOf,setPrototypeOf=objectSetPrototypeOf,setToStringTag=requireSetToStringTag(),hide$2=hide$7,redefine=requireRedefine(),ITERATOR$4=wellKnownSymbol$1("iterator"),Iterators$3=iterators,IteratorsCore=iteratorsCore,IteratorPrototype=IteratorsCore.IteratorPrototype,BUGGY_SAFARI_ITERATORS=IteratorsCore.BUGGY_SAFARI_ITERATORS,KEYS="keys",VALUES="values",ENTRIES="entries",returnThis=function(){return this},defineIterator$2=function(t,e,r,i,n,o,a){createIteratorConstructor(r,e,i);var s,l,u,c=function(t){if(t===n&&y)return y;if(!BUGGY_SAFARI_ITERATORS&&t in f)return f[t];switch(t){case KEYS:case VALUES:case ENTRIES:return function(){return new r(this,t)}}return function(){return new r(this)}},h=e+" Iterator",p=!1,f=t.prototype,d=f[ITERATOR$4]||f["@@iterator"]||n&&f[n],y=!BUGGY_SAFARI_ITERATORS&&d||c(n),g="Array"==e&&f.entries||d;if(g&&(s=getPrototypeOf(g.call(new t)),IteratorPrototype!==Object.prototype&&s.next&&(getPrototypeOf(s)!==IteratorPrototype&&(setPrototypeOf?setPrototypeOf(s,IteratorPrototype):"function"!=typeof s[ITERATOR$4]&&hide$2(s,ITERATOR$4,returnThis)),setToStringTag(s,h,!0,!0))),n==VALUES&&d&&d.name!==VALUES&&(p=!0,y=function(){return d.call(this)}),f[ITERATOR$4]!==y&&hide$2(f,ITERATOR$4,y),Iterators$3[e]=y,n)if(l={values:c(VALUES),keys:o?y:c(KEYS),entries:c(ENTRIES)},a)for(u in l)(BUGGY_SAFARI_ITERATORS||p||!(u in f))&&redefine(f,u,l[u]);else $export$1({target:e,proto:!0,forced:BUGGY_SAFARI_ITERATORS||p},l);return l},codePointAt$1=stringAt,InternalStateModule$2=internalState,defineIterator$1=defineIterator$2,STRING_ITERATOR="String Iterator",setInternalState$2=InternalStateModule$2.set,getInternalState$2=InternalStateModule$2.getterFor(STRING_ITERATOR);defineIterator$1(String,"String",(function(t){setInternalState$2(this,{type:STRING_ITERATOR,string:String(t),index:0})}),(function(){var t,e=getInternalState$2(this),r=e.string,i=e.index;return i>=r.length?{value:void 0,done:!0}:(t=codePointAt$1(r,i,!0),e.index+=t.length,{value:t,done:!1})}));var domIterables={CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0},UNSCOPABLES=wellKnownSymbol$1("unscopables"),create$2=objectCreate,hide$1=hide$7,ArrayPrototype$1=Array.prototype;null==ArrayPrototype$1[UNSCOPABLES]&&hide$1(ArrayPrototype$1,UNSCOPABLES,create$2(null));var addToUnscopables$1=function(t){ArrayPrototype$1[UNSCOPABLES][t]=!0},toIndexedObject=toIndexedObject$4,addToUnscopables=addToUnscopables$1,Iterators$2=iterators,InternalStateModule$1=internalState,defineIterator=defineIterator$2,ARRAY_ITERATOR="Array Iterator",setInternalState$1=InternalStateModule$1.set,getInternalState$1=InternalStateModule$1.getterFor(ARRAY_ITERATOR),es_array_iterator=defineIterator(Array,"Array",(function(t,e){setInternalState$1(this,{type:ARRAY_ITERATOR,target:toIndexedObject(t),index:0,kind:e})}),(function(){var t=getInternalState$1(this),e=t.target,r=t.kind,i=t.index++;return!e||i>=e.length?(t.target=void 0,{value:void 0,done:!0}):"keys"==r?{value:i,done:!1}:"values"==r?{value:e[i],done:!1}:{value:[i,e[i]],done:!1}}),"values");Iterators$2.Arguments=Iterators$2.Array,addToUnscopables("keys"),addToUnscopables("values"),addToUnscopables("entries");var DOMIterables=domIterables,ArrayIteratorMethods=es_array_iterator,global$8=global$c,hide=hide$7,wellKnownSymbol=wellKnownSymbol$1,ITERATOR$3=wellKnownSymbol("iterator"),TO_STRING_TAG=wellKnownSymbol("toStringTag"),ArrayValues=ArrayIteratorMethods.values;for(var COLLECTION_NAME in DOMIterables){var Collection=global$8[COLLECTION_NAME],CollectionPrototype=Collection&&Collection.prototype;if(CollectionPrototype){if(CollectionPrototype[ITERATOR$3]!==ArrayValues)try{hide(CollectionPrototype,ITERATOR$3,ArrayValues)}catch(e){CollectionPrototype[ITERATOR$3]=ArrayValues}if(CollectionPrototype[TO_STRING_TAG]||hide(CollectionPrototype,TO_STRING_TAG,COLLECTION_NAME),DOMIterables[COLLECTION_NAME])for(var METHOD_NAME in ArrayIteratorMethods)if(CollectionPrototype[METHOD_NAME]!==ArrayIteratorMethods[METHOD_NAME])try{hide(CollectionPrototype,METHOD_NAME,ArrayIteratorMethods[METHOD_NAME])}catch(e){CollectionPrototype[METHOD_NAME]=ArrayIteratorMethods[METHOD_NAME]}}}var aFunction$5=function(t){if("function"!=typeof t)throw TypeError(String(t)+" is not a function");return t},anInstance$1=function(t,e,r){if(!(t instanceof e))throw TypeError("Incorrect "+(r?r+" ":"")+"invocation");return t},iterate$1={exports:{}},Iterators$1=iterators,ITERATOR$2=wellKnownSymbol$1("iterator"),ArrayPrototype=Array.prototype,isArrayIteratorMethod$1=function(t){return void 0!==t&&(Iterators$1.Array===t||ArrayPrototype[ITERATOR$2]===t)},aFunction$4=aFunction$5,bindContext=function(t,e,r){if(aFunction$4(t),void 0===e)return t;switch(r){case 0:return function(){return t.call(e)};case 1:return function(r){return t.call(e,r)};case 2:return function(r,i){return t.call(e,r,i)};case 3:return function(r,i,n){return t.call(e,r,i,n)}}return function(){return t.apply(e,arguments)}},classof$3=classof$6,ITERATOR$1=wellKnownSymbol$1("iterator"),Iterators=iterators,getIteratorMethod$1=function(t){if(null!=t)return t[ITERATOR$1]||t["@@iterator"]||Iterators[classof$3(t)]},anObject$3=anObject$9,callWithSafeIterationClosing$1=function(t,e,r,i){try{return i?e(anObject$3(r)[0],r[1]):e(r)}catch(e){var n=t.return;throw void 0!==n&&anObject$3(n.call(t)),e}},anObject$2=anObject$9,isArrayIteratorMethod=isArrayIteratorMethod$1,toLength=toLength$2,bind$2=bindContext,getIteratorMethod=getIteratorMethod$1,callWithSafeIterationClosing=callWithSafeIterationClosing$1,BREAK={},exports$1=iterate$1.exports=function(t,e,r,i,n){var o,a,s,l,u,c=bind$2(e,r,i?2:1);if(n)o=t;else{if("function"!=typeof(a=getIteratorMethod(t)))throw TypeError("Target is not iterable");if(isArrayIteratorMethod(a)){for(s=0,l=toLength(t.length);l>s;s++)if((i?c(anObject$2(u=t[s])[0],u[1]):c(t[s]))===BREAK)return BREAK;return}o=a.call(t)}for(;!(u=o.next()).done;)if(callWithSafeIterationClosing(o,c,u.value,i)===BREAK)return BREAK};exports$1.BREAK=BREAK;var iterateExports=iterate$1.exports,ITERATOR=wellKnownSymbol$1("iterator"),SAFE_CLOSING=!1;try{var called=0,iteratorWithReturn={next:function(){return{done:!!called++}},return:function(){SAFE_CLOSING=!0}};iteratorWithReturn[ITERATOR]=function(){return this},Array.from(iteratorWithReturn,(function(){throw 2}))}catch(e){}var checkCorrectnessOfIteration$1=function(t,e){if(!e&&!SAFE_CLOSING)return!1;var r=!1;try{var i={};i[ITERATOR]=function(){return{next:function(){return{done:r=!0}}}},t(i)}catch(t){}return r},anObject$1=anObject$9,aFunction$3=aFunction$5,SPECIES$1=wellKnownSymbol$1("species"),speciesConstructor$2=function(t,e){var r,i=anObject$1(t).constructor;return void 0===i||null==(r=anObject$1(i)[SPECIES$1])?e:aFunction$3(r)},global$7=global$c,fails=fails$3,classof$2=classofRaw$1,bind$1=bindContext,html=html$2,createElement=documentCreateElement$1,location=global$7.location,set$1=global$7.setImmediate,clear=global$7.clearImmediate,process$2=global$7.process,MessageChannel=global$7.MessageChannel,Dispatch=global$7.Dispatch,counter=0,queue={},ONREADYSTATECHANGE="onreadystatechange",defer,channel,port,run=function(t){if(queue.hasOwnProperty(t)){var e=queue[t];delete queue[t],e()}},runner=function(t){return function(){run(t)}},listener=function(t){run(t.data)},post=function(t){global$7.postMessage(t+"",location.protocol+"//"+location.host)};set$1&&clear||(set$1=function(t){for(var e=[],r=1;arguments.length>r;)e.push(arguments[r++]);return queue[++counter]=function(){("function"==typeof t?t:Function(t)).apply(void 0,e)},defer(counter),counter},clear=function(t){delete queue[t]},"process"==classof$2(process$2)?defer=function(t){process$2.nextTick(runner(t))}:Dispatch&&Dispatch.now?defer=function(t){Dispatch.now(runner(t))}:MessageChannel?(channel=new MessageChannel,port=channel.port2,channel.port1.onmessage=listener,defer=bind$1(port.postMessage,port,1)):!global$7.addEventListener||"function"!=typeof postMessage||global$7.importScripts||fails(post)?defer=ONREADYSTATECHANGE in createElement("script")?function(t){html.appendChild(createElement("script"))[ONREADYSTATECHANGE]=function(){html.removeChild(this),run(t)}}:function(t){setTimeout(runner(t),0)}:(defer=post,global$7.addEventListener("message",listener,!1)));var task$1={set:set$1,clear},global$6=global$c,navigator$1=global$6.navigator,userAgent$2=navigator$1&&navigator$1.userAgent||"",global$5=global$c,getOwnPropertyDescriptor=objectGetOwnPropertyDescriptor.f,classof$1=classofRaw$1,macrotask=task$1.set,userAgent$1=userAgent$2,MutationObserver=global$5.MutationObserver||global$5.WebKitMutationObserver,process$1=global$5.process,Promise$1=global$5.Promise,IS_NODE$1="process"==classof$1(process$1),queueMicrotaskDescriptor=getOwnPropertyDescriptor(global$5,"queueMicrotask"),queueMicrotask=queueMicrotaskDescriptor&&queueMicrotaskDescriptor.value,flush,head,last,notify$1,toggle,node,promise;queueMicrotask||(flush=function(){var t,e;for(IS_NODE$1&&(t=process$1.domain)&&t.exit();head;){e=head.fn,head=head.next;try{e()}catch(t){throw head?notify$1():last=void 0,t}}last=void 0,t&&t.enter()},IS_NODE$1?notify$1=function(){process$1.nextTick(flush)}:MutationObserver&&!/(iphone|ipod|ipad).*applewebkit/i.test(userAgent$1)?(toggle=!0,node=document.createTextNode(""),new MutationObserver(flush).observe(node,{characterData:!0}),notify$1=function(){node.data=toggle=!toggle}):Promise$1&&Promise$1.resolve?(promise=Promise$1.resolve(void 0),notify$1=function(){promise.then(flush)}):notify$1=function(){macrotask.call(global$5,flush)});var microtask$1=queueMicrotask||function(t){var e={fn:t,next:void 0};last&&(last.next=e),head||(head=e,notify$1()),last=e},newPromiseCapability$2={},aFunction$2=aFunction$5,PromiseCapability=function(t){var e,r;this.promise=new t((function(t,i){if(void 0!==e||void 0!==r)throw TypeError("Bad Promise constructor");e=t,r=i})),this.resolve=aFunction$2(e),this.reject=aFunction$2(r)};newPromiseCapability$2.f=function(t){return new PromiseCapability(t)};var anObject=anObject$9,isObject$3=isObject$9,newPromiseCapability$1=newPromiseCapability$2,promiseResolve$2=function(t,e){if(anObject(t),isObject$3(e)&&e.constructor===t)return e;var r=newPromiseCapability$1.f(t);return(0,r.resolve)(e),r.promise},global$4=global$c,hostReportErrors$1=function(t,e){var r=global$4.console;r&&r.error&&(1===arguments.length?r.error(t):r.error(t,e))},perform$1=function(t){try{return{error:!1,value:t()}}catch(t){return{error:!0,value:t}}},redefineAll,hasRequiredRedefineAll;function requireRedefineAll(){if(hasRequiredRedefineAll)return redefineAll;hasRequiredRedefineAll=1;var t=requireRedefine();return redefineAll=function(e,r,i){for(var n in r)t(e,n,r[n],i);return e},redefineAll}var path$1=global$c,path=path$1,global$3=global$c,aFunction$1=function(t){return"function"==typeof t?t:void 0},getBuiltIn$1=function(t,e){return arguments.length<2?aFunction$1(path[t])||aFunction$1(global$3[t]):path[t]&&path[t][e]||global$3[t]&&global$3[t][e]},setSpecies,hasRequiredSetSpecies;function requireSetSpecies(){if(hasRequiredSetSpecies)return setSpecies;hasRequiredSetSpecies=1;var t=getBuiltIn$1,e=objectDefineProperty,r=descriptors,i=wellKnownSymbol$1("species");return setSpecies=function(n){var o=t(n),a=e.f;r&&o&&!o[i]&&a(o,i,{configurable:!0,get:function(){return this}})}}var PROMISE="Promise",IS_PURE=isPure,global$2=global$c,$export=_export,isObject$2=isObject$9,aFunction=aFunction$5,anInstance=anInstance$1,classof=classofRaw$1,iterate=iterateExports,checkCorrectnessOfIteration=checkCorrectnessOfIteration$1,speciesConstructor$1=speciesConstructor$2,task=task$1.set,microtask=microtask$1,promiseResolve$1=promiseResolve$2,hostReportErrors=hostReportErrors$1,newPromiseCapabilityModule=newPromiseCapability$2,perform=perform$1,userAgent=userAgent$2,SPECIES=wellKnownSymbol$1("species"),InternalStateModule=internalState,isForced=isForced_1,getInternalState=InternalStateModule.get,setInternalState=InternalStateModule.set,getInternalPromiseState=InternalStateModule.getterFor(PROMISE),PromiseConstructor=global$2[PROMISE],TypeError$1=global$2.TypeError,document$1=global$2.document,process=global$2.process,$fetch=global$2.fetch,versions=process&&process.versions,v8=versions&&versions.v8||"",newPromiseCapability=newPromiseCapabilityModule.f,newGenericPromiseCapability=newPromiseCapability,IS_NODE="process"==classof(process),DISPATCH_EVENT=!!(document$1&&document$1.createEvent&&global$2.dispatchEvent),UNHANDLED_REJECTION="unhandledrejection",REJECTION_HANDLED="rejectionhandled",PENDING=0,FULFILLED=1,REJECTED=2,HANDLED=1,UNHANDLED=2,Internal,OwnPromiseCapability,PromiseWrapper,FORCED=isForced(PROMISE,(function(){var t=PromiseConstructor.resolve(1),e=function(){},r=(t.constructor={})[SPECIES]=function(t){t(e,e)};return!((IS_NODE||"function"==typeof PromiseRejectionEvent)&&!IS_PURE&&t.then(e)instanceof r&&0!==v8.indexOf("6.6")&&-1===userAgent.indexOf("Chrome/66"))})),INCORRECT_ITERATION=FORCED||!checkCorrectnessOfIteration((function(t){PromiseConstructor.all(t).catch((function(){}))})),isThenable=function(t){var e;return!(!isObject$2(t)||"function"!=typeof(e=t.then))&&e},notify=function(t,e,r){if(!e.notified){e.notified=!0;var i=e.reactions;microtask((function(){for(var n=e.value,o=e.state==FULFILLED,a=0,s=function(r){var i,a,s,l=o?r.ok:r.fail,u=r.resolve,c=r.reject,h=r.domain;try{l?(o||(e.rejection===UNHANDLED&&onHandleUnhandled(t,e),e.rejection=HANDLED),!0===l?i=n:(h&&h.enter(),i=l(n),h&&(h.exit(),s=!0)),i===r.promise?c(TypeError$1("Promise-chain cycle")):(a=isThenable(i))?a.call(i,u,c):u(i)):c(n)}catch(t){h&&!s&&h.exit(),c(t)}};i.length>a;)s(i[a++]);e.reactions=[],e.notified=!1,r&&!e.rejection&&onUnhandled(t,e)}))}},dispatchEvent=function(t,e,r){var i,n;DISPATCH_EVENT?((i=document$1.createEvent("Event")).promise=e,i.reason=r,i.initEvent(t,!1,!0),global$2.dispatchEvent(i)):i={promise:e,reason:r},(n=global$2["on"+t])?n(i):t===UNHANDLED_REJECTION&&hostReportErrors("Unhandled promise rejection",r)},onUnhandled=function(t,e){task.call(global$2,(function(){var r,i=e.value;if(isUnhandled(e)&&(r=perform((function(){IS_NODE?process.emit("unhandledRejection",i,t):dispatchEvent(UNHANDLED_REJECTION,t,i)})),e.rejection=IS_NODE||isUnhandled(e)?UNHANDLED:HANDLED,r.error))throw r.value}))},isUnhandled=function(t){return t.rejection!==HANDLED&&!t.parent},onHandleUnhandled=function(t,e){task.call(global$2,(function(){IS_NODE?process.emit("rejectionHandled",t):dispatchEvent(REJECTION_HANDLED,t,e.value)}))},bind=function(t,e,r,i){return function(n){t(e,r,n,i)}},internalReject=function(t,e,r,i){e.done||(e.done=!0,i&&(e=i),e.value=r,e.state=REJECTED,notify(t,e,!0))},internalResolve=function(t,e,r,i){if(!e.done){e.done=!0,i&&(e=i);try{if(t===r)throw TypeError$1("Promise can't be resolved itself");var n=isThenable(r);n?microtask((function(){var i={done:!1};try{n.call(r,bind(internalResolve,t,i,e),bind(internalReject,t,i,e))}catch(r){internalReject(t,i,r,e)}})):(e.value=r,e.state=FULFILLED,notify(t,e,!1))}catch(r){internalReject(t,{done:!1},r,e)}}};FORCED&&(PromiseConstructor=function(t){anInstance(this,PromiseConstructor,PROMISE),aFunction(t),Internal.call(this);var e=getInternalState(this);try{t(bind(internalResolve,this,e),bind(internalReject,this,e))}catch(t){internalReject(this,e,t)}},Internal=function(t){setInternalState(this,{type:PROMISE,done:!1,notified:!1,parent:!1,reactions:[],rejection:!1,state:PENDING,value:void 0})},Internal.prototype=requireRedefineAll()(PromiseConstructor.prototype,{then:function(t,e){var r=getInternalPromiseState(this),i=newPromiseCapability(speciesConstructor$1(this,PromiseConstructor));return i.ok="function"!=typeof t||t,i.fail="function"==typeof e&&e,i.domain=IS_NODE?process.domain:void 0,r.parent=!0,r.reactions.push(i),r.state!=PENDING&&notify(this,r,!1),i.promise},catch:function(t){return this.then(void 0,t)}}),OwnPromiseCapability=function(){var t=new Internal,e=getInternalState(t);this.promise=t,this.resolve=bind(internalResolve,t,e),this.reject=bind(internalReject,t,e)},newPromiseCapabilityModule.f=newPromiseCapability=function(t){return t===PromiseConstructor||t===PromiseWrapper?new OwnPromiseCapability(t):newGenericPromiseCapability(t)},"function"==typeof $fetch&&$export({global:!0,enumerable:!0,forced:!0},{fetch:function(t){return promiseResolve$1(PromiseConstructor,$fetch.apply(global$2,arguments))}})),$export({global:!0,wrap:!0,forced:FORCED},{Promise:PromiseConstructor}),requireSetToStringTag()(PromiseConstructor,PROMISE,!1,!0),requireSetSpecies()(PROMISE),PromiseWrapper=path$1[PROMISE],$export({target:PROMISE,stat:!0,forced:FORCED},{reject:function(t){var e=newPromiseCapability(this);return e.reject.call(void 0,t),e.promise}}),$export({target:PROMISE,stat:!0,forced:FORCED},{resolve:function(t){return promiseResolve$1(this,t)}}),$export({target:PROMISE,stat:!0,forced:INCORRECT_ITERATION},{all:function(t){var e=this,r=newPromiseCapability(e),i=r.resolve,n=r.reject,o=perform((function(){var r=aFunction(e.resolve),o=[],a=0,s=1;iterate(t,(function(t){var l=a++,u=!1;o.push(void 0),s++,r.call(e,t).then((function(t){u||(u=!0,o[l]=t,--s||i(o))}),n)})),--s||i(o)}));return o.error&&n(o.value),r.promise},race:function(t){var e=this,r=newPromiseCapability(e),i=r.reject,n=perform((function(){var n=aFunction(e.resolve);iterate(t,(function(t){n.call(e,t).then(r.resolve,i)}))}));return n.error&&i(n.value),r.promise}});var getBuiltIn=getBuiltIn$1,speciesConstructor=speciesConstructor$2,promiseResolve=promiseResolve$2,perf;if(_export({target:"Promise",proto:!0,real:!0},{finally:function(t){var e=speciesConstructor(this,getBuiltIn("Promise")),r="function"==typeof t;return this.then(r?function(r){return promiseResolve(e,t()).then((function(){return r}))}:t,r?function(r){return promiseResolve(e,t()).then((function(){throw r}))}:t)}}),path$1.Promise,"function"!=typeof Object.assign&&(Object.assign=function(t){if(null==t)throw new TypeError("Cannot convert undefined or null to object");for(var e=Object(t),r=1;r<arguments.length;r++){var i=arguments[r];if(null!=i)for(var n in i)i.hasOwnProperty(n)&&(e[n]=i[n])}return e}),"function"!=typeof Object.values&&(Object.values=function(t){return Object.keys(t).map((function(e){return t[e]}))}),Math.hypot=Math.hypot||function(){for(var t=0,e=arguments.length,r=0;r<e;r++){if(arguments[r]===1/0||arguments[r]===-1/0)return 1/0;t+=arguments[r]*arguments[r]}return Math.sqrt(t)},Math.log2=Math.log2||function(t){return Math.log(t)*Math.LOG2E},"undefined"!=typeof window?("performance"in window==0&&(window.performance={}),perf=window.performance):"undefined"!=typeof self&&"undefined"!=typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope&&("performance"in self==0&&(self.performance={}),perf=self.performance),perf&&"function"!=typeof perf.now){var start=+new Date;perf.now=function(){return+new Date-start}}function _callSuper(t,e,r){return e=_getPrototypeOf(e),_possibleConstructorReturn(t,_isNativeReflectConstruct()?Reflect.construct(e,r||[],_getPrototypeOf(t).constructor):e.apply(t,r))}function _construct(t,e,r){if(_isNativeReflectConstruct())return Reflect.construct.apply(null,arguments);var i=[null];i.push.apply(i,e);var n=new(t.bind.apply(t,i));return r&&_setPrototypeOf(n,r.prototype),n}function _isNativeReflectConstruct(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(t){}return(_isNativeReflectConstruct=function(){return!!t})()}function _iterableToArrayLimit(t,e){var r=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=r){var i,n,o,a,s=[],l=!0,u=!1;try{if(o=(r=r.call(t)).next,0===e){if(Object(r)!==r)return;l=!1}else for(;!(l=(i=o.call(r)).done)&&(s.push(i.value),s.length!==e);l=!0);}catch(t){u=!0,n=t}finally{try{if(!l&&null!=r.return&&(a=r.return(),Object(a)!==a))return}finally{if(u)throw n}}return s}}function _toPrimitive(t,e){if("object"!=typeof t||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var i=r.call(t,e||"default");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}function _toPropertyKey(t){var e=_toPrimitive(t,"string");return"symbol"==typeof e?e:e+""}function _typeof(t){return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},_typeof(t)}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _defineProperties(t,e){for(var r=0;r<e.length;r++){var i=e[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,_toPropertyKey(i.key),i)}}function _createClass(t,e,r){return e&&_defineProperties(t.prototype,e),r&&_defineProperties(t,r),Object.defineProperty(t,"prototype",{writable:!1}),t}function _defineProperty(t,e,r){return(e=_toPropertyKey(e))in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function _inherits(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&_setPrototypeOf(t,e)}function _getPrototypeOf(t){return _getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},_getPrototypeOf(t)}function _setPrototypeOf(t,e){return _setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},_setPrototypeOf(t,e)}function _isNativeFunction(t){try{return-1!==Function.toString.call(t).indexOf("[native code]")}catch(e){return"function"==typeof t}}function _wrapNativeSuper(t){var e="function"==typeof Map?new Map:void 0;return _wrapNativeSuper=function(t){if(null===t||!_isNativeFunction(t))return t;if("function"!=typeof t)throw new TypeError("Super expression must either be null or a function");if(void 0!==e){if(e.has(t))return e.get(t);e.set(t,r)}function r(){return _construct(t,arguments,_getPrototypeOf(this).constructor)}return r.prototype=Object.create(t.prototype,{constructor:{value:r,enumerable:!1,writable:!0,configurable:!0}}),_setPrototypeOf(r,t)},_wrapNativeSuper(t)}function _assertThisInitialized(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function _possibleConstructorReturn(t,e){if(e&&("object"==typeof e||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return _assertThisInitialized(t)}function _superPropBase(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=_getPrototypeOf(t)););return t}function _get(){return _get="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,e,r){var i=_superPropBase(t,e);if(i){var n=Object.getOwnPropertyDescriptor(i,e);return n.get?n.get.call(arguments.length<3?t:r):n.value}},_get.apply(this,arguments)}function _slicedToArray(t,e){return _arrayWithHoles(t)||_iterableToArrayLimit(t,e)||_unsupportedIterableToArray(t,e)||_nonIterableRest()}function _toConsumableArray(t){return _arrayWithoutHoles(t)||_iterableToArray(t)||_unsupportedIterableToArray(t)||_nonIterableSpread()}function _arrayWithoutHoles(t){if(Array.isArray(t))return _arrayLikeToArray(t)}function _arrayWithHoles(t){if(Array.isArray(t))return t}function _iterableToArray(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}function _unsupportedIterableToArray(t,e){if(t){if("string"==typeof t)return _arrayLikeToArray(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?_arrayLikeToArray(t,e):void 0}}function _arrayLikeToArray(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,i=new Array(e);r<e;r++)i[r]=t[r];return i}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _createForOfIteratorHelper(t,e){var r="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!r){if(Array.isArray(t)||(r=_unsupportedIterableToArray(t))||e&&t&&"number"==typeof t.length){r&&(t=r);var i=0,n=function(){};return{s:n,n:function(){return i>=t.length?{done:!0}:{done:!1,value:t[i++]}},e:function(t){throw t},f:n}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,s=!1;return{s:function(){r=r.call(t)},n:function(){var t=r.next();return a=t.done,t},e:function(t){s=!0,o=t},f:function(){try{a||null==r.return||r.return()}finally{if(s)throw o}}}}var global$1="undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{},ns={},MathUtils;(function(){var t,e="function"==typeof Object.defineProperties?Object.defineProperty:function(t,e,r){t!=Array.prototype&&t!=Object.prototype&&(t[e]=r.value)},r="undefined"!=typeof window&&window===this?this:void 0!==global$1&&null!=global$1?global$1:this;if("function"==typeof Object.setPrototypeOf)t=Object.setPrototypeOf;else{var i;t:{var n={};try{n.__proto__={ea:!0},i=n.ea;break t}catch(t){}i=!1}t=i?function(t,e){if(t.__proto__=e,t.__proto__!==e)throw new TypeError(t+" is not extensible");return t}:null}var o=t;!function(t,i){if(i){var n=r;t=t.split(".");for(var o=0;o<t.length-1;o++){var a=t[o];a in n||(n[a]={}),n=n[a]}(i=i(o=n[t=t[t.length-1]]))!=o&&null!=i&&e(n,t,{configurable:!0,writable:!0,value:i})}}("Object.setPrototypeOf",(function(t){return t||o}));var a=this||self;function s(t){var e=_typeof(t);if("object"==e){if(!t)return"null";if(t instanceof Array)return"array";if(t instanceof Object)return e;var r=Object.prototype.toString.call(t);if("[object Window]"==r)return"object";if("[object Array]"==r||"number"==typeof t.length&&void 0!==t.splice&&void 0!==t.propertyIsEnumerable&&!t.propertyIsEnumerable("splice"))return"array";if("[object Function]"==r||void 0!==t.call&&void 0!==t.propertyIsEnumerable&&!t.propertyIsEnumerable("call"))return"function"}else if("function"==e&&void 0===t.call)return"object";return e}function l(t){return"function"==s(t)}function u(t){var e=_typeof(t);return"object"==e&&null!=t||"function"==e}function c(t,e){t=t.split(".");var r,i=a;t[0]in i||void 0===i.execScript||i.execScript("var "+t[0]);for(;t.length&&(r=t.shift());)t.length||void 0===e?i=i[r]&&i[r]!==Object.prototype[r]?i[r]:i[r]={}:i[r]=e}function h(t,e){function r(){}r.prototype=e.prototype,t.ua=e.prototype,t.prototype=new r,t.prototype.constructor=t}var p=Math,f=p.min,d=p.max,y=p.round,g=p.floor,v=p.ceil,m=p.abs,_=p.log,b=p.sqrt,x=p.pow,w=p.sin,E=p.asin,T=p.cos,A=p.tan,S=p.atan2,k=p.PI,I=k/2,P=k/4,O=2*k,L=3*k,C=k/180,R=180/k;function M(t,e,r){return t>r?r:t<e?e:t}function N(t,e,r){return e<r?t>=e&&t<=r:t>=r&&t<=e}function j(t,e,r,i,n,o){return b(x((t-n)*(i-o)-(e-o)*(r-n),2)/(x(r-n,2)+x(i-o,2)))}c("H.math.normalize",(function(t,e,r){return e-=r=r||0,(t-=r)-g(t/e)*e+r})),c("H.math.clamp",M);var D={NONE:0,VERTEX:1,EDGE:2,SURFACE:3};function B(t,e){var r=t.x;t=t.y;for(var i,n,o,a,s=e.length,l=s,u=e[0],c=0,h=0,p=0;1!=c&&1<l;)n=e[--l],i=e[--l],a=e[l?l-1:(s+(l-1))%s],o=e[l?l-2:(s+(l-2))%s],i>=r&&i<=r&&n>=t&&n<=t||o>=r&&o<=r&&a>=t&&a<=t?c=1:c||i!==r?!c&&N(r,i,o)&&((i<r&&o>r||i>r&&o<r)&&(h+=(u=n+(r-i)/(o-i)*(a-n))>t,p+=u<t),c=N(t,n,a)&&0>=j(r,t,i,n,o,a)?2:0):(o===r&&(n<t&&a>t||n>t&&a<t)||(u<=r&&o>r||u>=r&&o<r)&&(n>=t?++h:++p),c=N(t,n,a)&&0>=j(r,t,i,n,o,a)?2:0),u=i;return!c&&0!==p&&0!=h%2&&(c=3),c!==D.NONE}function z(t,e){this.x=+t,this.y=+e}function U(t,e,r,i,n,o){var a=t.x;t=-t.y;var s=e.x;if(e=-e.y,r=-r,o=-o,a>s){if(s>n||a<i)return;var l=a,u=t;a=s,t=e,s=l,e=u,l=1}else if(a>n||s<i)return;if(t>e){if(e>r||t<o)return;var c=1;t=-t,e=-e,u=o,o=-r,r=-u}else if(t>r||e<o)return;if(a<i){if((t+=(i-a)*(e-t)/(s-a))>r)return;a=i}if(t<o){if((a+=(o-t)*(s-a)/(e-t))>n)return;t=o}return s>n&&(e=t+(n-a)*(e-t)/(s-a),s=n),e>r&&(s=a+(r-t)*(s-a)/(e-t),e=r),c&&(t=-t,e=-e),l?[new z(s,-e),new z(a,-t)]:[new z(a,-t),new z(s,-e)]}function F(t,e,r,i,n,o,a,s,l,u){return t={x:t,y:e,next:r||null,s:i||null,ta:n||null,X:o||null,o:!!a,T:s||0,O:l||0,alpha:u||0},i&&(t.s.next=t),r&&(t.next.s=t),t}function G(t){for(;t&&t.o;)t=t.next;return t}function $(t){if(t)for(;t.next;)t=t.next;return t}function q(t){var e=t;if(e)do{e=e.next}while(e!=t&&(!e.o||e.o&&e.O));return e}function H(t){var e=$(t);e.s.next=t,t.s=e.s}function V(t,e,r,i,n){var o,a=e.x-t.x,s=e.y-t.y,l=i.x-r.x,u=i.y-r.y,c=a*u-s*l;return c?(l=((r.x-t.x)*u-(r.y-t.y)*l)/c,c=(s*(r.x-t.x)-a*(r.y-t.y))/c,0>l||1<l||0>c||1<c?0:(0===l?o=t:1===l?o=e:0===c?o=r:1===c&&(o=i),o?(o.x+=2480549651603763e-20,o.y+=7321997314118067e-20,o.M&&(o.M.x=o.x,o.M.y=o.y),V(t,e,r,i,n)):(n.xa=t.x+l*a,n.ya=t.y+l*s,n.fa=l,n.ga=c,1))):0}function Y(t){for(var e=[];t;)e.push(t.x,t.y),t=t.next;return e}function W(t,e,r){for(e=e.next;e!==r&&e.alpha<=t.alpha;)e=e.next;t.next=e,t.s=e.s,t.next.s=t,t.s.next=t}function X(t,e){for(var r,i=null,n=0,o=t.length;n<o;n++)(r=F(t[n].x,t[n].y,i)).qa=e,(r.next=i)&&(i.s=r),i=r;return i}function K(t,e,r,i){return(t-=r)*t+(e-=i)*e}function Z(t,e,r,i,n){var o=0,a=i,s=t[i].x,l=t[i].y,u=t[n].x,c=t[n].y,h=i+1,p=K(s,l,u,c);if(p)for(;h<n;){var f=t[h++],d=f.x,y=((d-s)*(u-s)+((f=f.y)-l)*(c-l))/p;(d=0>y?K(d,f,s,l):1<y?K(d,f,u,c):K(d,f,s+y*(u-s),l+y*(c-l)))>o&&(o=d,a=h-1)}else for(;h<n;)(d=K(d=(f=t[h++]).x,f=f.y,s,l))>o&&(o=d,a=h-1);return o>=e||0<r&&a-i?(--r,1<a-i?(i=Z(t,e,r,i,a)).splice(i.length-1,1):i=[t[i]],i=1<n-a?i.concat(Z(t,e,r,a,n)):i.concat(t.slice(a,n+1))):i=[t[i],t[n]],i}c("H.math.CoverType",D),c("H.math.isPointInsidePolygon",B),c("H.math.flatten",(function(t){for(var e=t.length,r=new Float64Array(2*e),i=e&&t[0].x!==tt;e--;){var n=t[e],o=e<<1;r[o]=i?n.x:n[0],r[o+1]=i?n.y:n[1]}return r})),c("H.math.Point",z),z.prototype.set=z,z.prototype.set=z.prototype.set,z.prototype.clone=function(t){return t?(t.x=this.x,t.y=this.y):t=new z(this.x,this.y),t},z.prototype.clone=z.prototype.clone,z.prototype.add=function(t){return this.x+=t.x,this.y+=t.y,this},z.prototype.add=z.prototype.add,z.prototype.sub=function(t){return this.x-=t.x,this.y-=t.y,this},z.prototype.sub=z.prototype.sub,z.prototype.scale=function(t,e){return this.x*=t,this.y*=void 0===e?t:e,this},z.prototype.scale=z.prototype.scale,z.prototype.round=function(){return this.x=y(this.x),this.y=y(this.y),this},z.prototype.round=z.prototype.round,z.prototype.floor=function(){return this.x=g(this.x),this.y=g(this.y),this},z.prototype.floor=z.prototype.floor,z.prototype.ceil=function(){return this.x=v(this.x),this.y=v(this.y),this},z.prototype.ceil=z.prototype.ceil,z.prototype.w=function(t){return!(!t||this.x!==t.x||this.y!==t.y)},z.prototype.equals=z.prototype.w,z.prototype.la=function(t,e){var r=e.x-t.x,i=e.y-t.y,n=t;if(r||i){var o=((this.x-t.x)*r+(this.y-t.y)*i)/(r*r+i*i);n=0>=o?t:1<=o?e:new z(t.x+o*r,t.y+o*i)}return n},z.prototype.getNearest=z.prototype.la,z.prototype.R=function(t){return b(x(this.x-t.x,2)+x(this.y-t.y,2))},z.prototype.distance=z.prototype.R,z.fromIPoint=function(t){if(!t)throw Error("invalid argument");return t instanceof z?t:new z(t.x,t.y)},c("H.math.clipping.clipStrips",(function(t,e,r,i,n,o){var a,s,l,u,c=t.length;if(c)for(a=[];c--;){var h=t[c],p=h.length,f=0;for(l=1;l<p;l++)if(u=U(h[l-1],h[l],r,e,i,n)){var d=u[0],y=u[1];f&&f.w(d)?s.push(y):a.push(s=u),f=y,o&&(l=p,c=0)}}else a=t;return a})),c("H.math.clipping.clipPolygon",(function(t,e,r){var i,n;t=X(t,!0),e=X(e,!1);var o={},a=i=1;switch(~~(r||0)){case 1:a=i=0;break;case 2:i=0,a=1;break;case 3:i=1,a=0}r=i;var s=a;if(e&&t){for(e.M=F(e.x,e.y,null,$(e)),t.M=F(t.x,t.y,null,$(t)),a=e;a.next;a=a.next)if(!a.o)for(i=t;i.next;i=i.next)if(!i.o){var l=G(a.next),u=G(i.next);if(n=V(a,l,i,u,o)){n=o.fa;var c=o.ga,h=o.xa,p=o.ya;W(n=F(h,p,null,null,null,null,!0,0,0,n),a,l),W(l=F(h,p,null,null,null,null,!0,0,0,c),i,u),n.X=l,l.X=n}}for(o=B(e,Y(t)),r&&(o=!o),a=e;a;a=a.next)a.o&&(a.T=o,o=!o);for(o=B(t,Y(e)),s&&(o=!o),i=t;i.next;i=i.next)i.o&&(i.T=o,o=!o);for(H(e),H(t);(t=q(e))!=e;){for(r=null;!t.O;t=t.X){for(o=t.T;(r=F(t.x,t.y,r)).artificial=t.o||t.qa,t.O=1,t=o?t.next:t.s;)if(t.o){t.O=1;break}if(!t)break}r.ta=f;var f=r}return f}})),c("H.math.simplifyDP",(function(t,e,r){return Z(t,e*e,r||0,0,t.length-1)}));var J=this,Q=String,tt=[].pop(),et=/x/.exec(""),rt="prototype constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function it(t,e){if(1==(t instanceof e&&t.constructor===e))throw new TypeError("Illegal constructor "+lt(e))}c("H.lang.isArray",(function(t,e,r,i){var n;if(!(n="Array"===at(t))&&e)throw new ft(e,r,i!==tt?i:t);return n})),c("H.lang.isString",(function(t){return"string"==typeof t}));var nt=isNaN;function ot(t){return t===+t}function at(t){var e=Object[rt[0]][rt[6]].call(t).match(/^\[object (\w+)\]$/);return e?e[1]:_typeof(t)}c("H.lang.isNumber",ot),c("H.lang.isInteger",Number.isInteger?Number.isInteger:function(t){return"number"==typeof t&&0==t%1});var st=[];function lt(t,e,r,i){var n,o="",a=2>arguments.length;return a&&(e={H:J.H},r="",i=st.slice()),ht(e,!0,(function(e,a){try{if(a=function(t,e){var r=[];return ht(t,!1,(function(t,i){t[i]===e&&r.push(i)})),r.sort(ut)[0]}(e,n=e[a]),!(u(n)&&n.window===n&&n.self===n||u(n)&&0<n.nodeType&&l(n.cloneNode))&&u(n)){if(n===t)return o=r+"."+a,!0;if(0>i.indexOf(n)&&(i.push(n),o=lt(t,n,r+"."+a,i)))return!0}}catch(t){}})),a&&(o=o?o.substr(1).replace("."+rt[0]+".","#"):"~"+(l(t)?function(t){return(t=/^\s*function ([^\( ]+)/.exec(t))?t[1]:"anonymous"}(t)+"()":at(t))),o}function ut(t,e){return e.length-t.length}0>st.indexOf(st)&&st.push(st);var ct=Object[rt[0]][rt[2]];function ht(t,e,r){var i;if(t){for(n in t)if((!e||ct.call(t,n))&&r(t,n,!0))return;for(i=rt.length;i--;){var n=rt[i];if((!e||ct.call(t,n))&&r(t,n,!1))break}}}function pt(t,e,r){r[e]="#"+e}function ft(t,e,r){var i=arguments.length;if((e=e!==tt?+e:e)!==tt){var n,o=/^.*?\(([^\)]+)/.exec((""+t).replace(/(\/\*([\s\S]*?)\*\/)|(\/\/(.*)$)/gm,""));n=o?Q(o[1].replace(/\s+/g,"")).split(","!==tt?",":" "):[],(o=n).forEach(pt),o=o[e]||"#"+e}return n=t?lt(t):"",i=2<i?Q(r):"",(o||i)&&(n+=" (Argument "+(o||"")+(i?" "+i:"")+")"),i=Error(n),Object.setPrototypeOf(i,ft.prototype),i}function dt(t,e,r){var i=M(+t,-90,90);if(e&&nt(i))throw new ft(e,r,t);return i}function yt(t,e,r){var i,n=+t;if((-180>n||180<n)&&(n=(0==0>(i=(n+180)%360)?i:i+360)-180),e&&nt(n))throw new ft(e,r,t);return n}function gt(t,e,r){var i;if(t!==tt&&nt(i=+t)&&e)throw new ft(e,r,t);return i}function vt(){it(this,vt)}function mt(t,e,r){this.lat=dt(t,mt,0),this.lng=yt(e,mt,1),r!==tt&&(this.alt=gt(r,mt,2))}function _t(t,e,r){var i=u(t)&&!(nt(t.lat=dt(t.lat))||nt(t.lng=yt(t.lng))||t.alt!==tt&&nt(t.alt=gt(t.alt)));if(!i&&e)throw new ft(e,r,t);return i}function bt(t,e,r,i){xt(this,dt(t,bt,0),yt(e,bt,1),dt(r,bt,2),yt(i,bt,3))}function xt(t,e,r,i,n){return t.f=r,t.g=n,e<i&&(r=e,e=i,i=r),t.i=e,t.h=i,t.m=t.b=t.c=null,t}function wt(t,e){return(t=e-t)+(0>t?360:0)}function Et(t,e){return(t+=e/2)-(180<t?360:0)}function Tt(t,e,r,i,n,o,a,s,l){r=f(r,a),t=d(t,n);var u=Et(e,n=wt(e,i)),c=Et(o,a=wt(o,s))-u;if(180>(c+=0>c-1e-6?360:0)-1e-6){u=e;var h=s}else c=360-c,u=o,h=i;return 360<=(c=c+n/2+a/2)+5e-7?(u=-180,h=180):c-5e-7<n?(u=e,h=i):c-5e-7<a&&(u=o,h=s),l?xt(l,t,u,r,h):new bt(t,u,r,h)}function At(t,e,r){return r||(_t(t,At,0),_t(e,At,1)),new bt(t.lat,t.lng,e.lat,e.lng)}function St(t,e,r,i,n,o){it(this,St),this.sa=t||10,this.c=this.b=null,this.j=i||0,this.l=n||0,this.m=e||1,this.u=r||1,this.I=!!o,this.flush()}function kt(t,e){var r,i,n,o,a=0;for(r=3;0<=r;r--){var s=r+4,l=0<r%3,u=[],c=e[r],h=t[r];for(i=h.length;i--;){var p=h[i];if(n=p.entries)for(o=n.length;o--;){var f=n[o][r];(l?f>c:f<c)&&(c=f)}for(o=4;o--;)(n=p[o])&&(l?n[s]>c:n[s]<c)&&u.push(n)}a+=u.length,e[r]=c,t[r]=u}return a&&(e=kt(t,e)),e}function It(t,e,r){var i,n;if(t.I&&(i=t.c))for(n=3;0<=n;n--){var o=e[n];if(n%3?o>=i[n]:o<=i[n]){if(!r){t.c=null;break}i[n]=o}}}function Pt(t,e){var r,i=t.a;if(e){var n=e;if(n!==i)for(i=n;n=n.c;)(n.entries||1<n.a)&&(i=n)}else for(;!i.entries&&2>(r=i.a)&&r;)i=n;t.a=i}function Ot(t,e,r,i,n,o,a,s,l){var u,c=e.entries,h=e[7],p=e[4],f=e[5],d=e[6],y=e[8],g=e[9];if(c){var v=c.length;if(n>p||i>h||a<d||o<f)for(;v--;)p=(h=c[v])[3],f=h[0],d=h[1],h[2]>=n&&d>=i&&(f<a||s&&f==a)&&(p<o||l&&p==o)&&r.push(h);else for(;v--;)r.push(c[v])}(o>y||l&&o==y)&&(n<g&&(u=e[1])&&Ot(t,u,r,i,n,o,a,s,l),(a>g||s&&a==g)&&(u=e[3])&&Ot(t,u,r,i,n,o,a,s,l)),i<y&&(n<g&&(u=e[0])&&Ot(t,u,r,i,n,o,a,s,l),(a>g||s&&a==g)&&(u=e[2])&&Ot(t,u,r,i,n,o,a,s,l))}h(ft,Error),c("H.lang.InvalidArgumentError",ft),ft.prototype.name="InvalidArgumentError",c("H.geo.isDBC",(function(t,e){return!!(0>t^0>e)&&180<m(e-t)})),c("H.geo.AbstractGeometry",vt),vt.prototype.getBoundingBox=vt.prototype.D,vt.prototype.equals=vt.prototype.w,vt.prototype.a="",vt.prototype.l="",vt.prototype.toString=function(){return this.I([this.a.toUpperCase()," "]).join("")},vt.prototype.toString=vt.prototype.toString,vt.prototype.va=function(){return{type:this.l,coordinates:this.u()}},vt.prototype.toGeoJSON=vt.prototype.va,vt.prototype.U=function(){return{type:this.a,coordinates:this.j(),boundingBox:this.D().U()}},vt.prototype.forWorkerMessage=vt.prototype.U,h(mt,vt),c("H.geo.Point",mt),mt.prototype.w=function(t){return this===t||!!t&&this.lat===t.lat&&this.lng===t.lng&&(this.alt||0)===(t.alt||0)},mt.prototype.equals=mt.prototype.w,mt.prototype.R=function(t){if(this===t||this.lat===t.lat&&this.lng===t.lng)t=0;else{var e=this.lat*C,r=t.lat*C;t=12742001.58*E(f(1,b(x(w((e-r)/2),2)+T(e)*T(r)*x(w((this.lng*C-t.lng*C)/2),2))))}return t},mt.prototype.distance=mt.prototype.R,mt.prototype.wa=function(t,e,r){if(r){if(e/=6371000.79){t*=C;var i=C*this.lat,n=w(i),o=w(e),a=T(e),s=C*this.lng,l=T(i);i=E(l*T(t)*o+n*a),l=(t=(s+(t=S(w(t)*l*o,a-n*w(i)))+k)%(2*k)-k)*R}return e?new mt(i*R,(l+540)%360-180):this}if(0==(90+(t=(t%360+360)%360))%180)return i=this.lng+e/(6371000.79*O*T(this.lat*C))*(270===t?-360:360),new mt(this.lat,(i+540)%360-180);if(e/=6371000.79){t*=C,s=this.lat*C,n=this.lng*C,a=(o=s+e*T(t))-s,i=_(A(o/2+P)/A(s/2+P)),i=nt(a/i)?T(s):a/i;var u=e*w(t)/i;m(o)>I&&(o=0<o?k-o:-(k+o))}return e?new mt(o*R,((n+u+L+(m(s+a)>I?k:0))%O-k)*R):this},mt.prototype.walk=mt.prototype.wa,mt.prototype.D=function(){return new bt(this.lat,this.lng,this.lat,this.lng)},mt.prototype.getBoundingBox=mt.prototype.D,mt.validate=_t,mt.fromIPoint=function t(e){if(!e)throw new ft(t,0,e);return new mt(e.lat,e.lng,e.alt)},mt.prototype.a="Point",mt.prototype.I=function(t){return t.push("(",this.lng," ",this.lat,")"),t},mt.prototype.l="Point",mt.prototype.u=function(){return[this.lng,this.lat,this.alt||0]},mt.prototype.j=function(){return[this.lat,this.lng,this.alt||0]},h(bt,vt),c("H.geo.Rect",bt),bt.prototype.a="Polygon",bt.prototype.I=function(t){var e=this.i,r=this.f,i=this.h,n=this.g;return t.push("(","(",r," ",e,",",n," ",e,",",n," ",i,",",r," ",i,",",r," ",e,")",")"),t},bt.prototype.w=function(t){return this===t||!!t&&this.i===t.i&&this.f===t.f&&this.h===t.h&&this.g===t.g},bt.prototype.equals=bt.prototype.w,bt.prototype.clone=function(){return new bt(this.i,this.f,this.h,this.g)},bt.prototype.clone=bt.prototype.clone,bt.prototype.W=function(){return this.m||(this.m=new mt(this.i,this.f)),this.m},bt.prototype.getTopLeft=bt.prototype.W,bt.prototype.V=function(){return this.b||(this.b=new mt(this.h,this.g)),this.b},bt.prototype.getBottomRight=bt.prototype.V,bt.prototype.na=function(){return this.i},bt.prototype.getTop=bt.prototype.na,bt.prototype.ha=function(){return this.h},bt.prototype.getBottom=bt.prototype.ha,bt.prototype.ja=function(){return this.f},bt.prototype.getLeft=bt.prototype.ja,bt.prototype.ma=function(){return this.g},bt.prototype.getRight=bt.prototype.ma,bt.prototype.F=function(){return this.c||(this.c=new mt(this.h+(this.i-this.h)/2,Et(this.f,this.A()))),this.c},bt.prototype.getCenter=bt.prototype.F,bt.prototype.A=function(){return wt(this.f,this.g)},bt.prototype.getWidth=bt.prototype.A,bt.prototype.G=function(){return this.i-this.h},bt.prototype.getHeight=bt.prototype.G,bt.prototype.N=function(){return this.f>this.g},bt.prototype.isCDB=bt.prototype.N,bt.prototype.ra=function(){return!this.A()&&!this.G()},bt.prototype.isEmpty=bt.prototype.ra,bt.prototype.D=function(){return new bt(this.i,this.f,this.h,this.g)},bt.prototype.getBoundingBox=bt.prototype.D,bt.prototype.L=function(t,e,r){var i=this.F();return r||(t=dt(t,this.L,0),e=yt(e,this.L,1)),(t=(e=this.B(t,e,r)).F()).lat===i.lat&&t.lng===i.lng&&this.G()===e.G()&&this.A()===e.A()},bt.prototype.containsLatLng=bt.prototype.L,bt.prototype.$=function(t,e){return e||_t(t,this.$,0),this.L(t.lat,t.lng,e)},bt.prototype.containsPoint=bt.prototype.$,bt.prototype.aa=function(t,e){var r=this.F();if(!(e||t instanceof bt))throw new ft(this.aa,0,t);return(t=(e=this.J(t,e)).F()).lat===r.lat&&t.lng===r.lng&&this.G()===e.G()&&this.A()===e.A()},bt.prototype.containsRect=bt.prototype.aa,bt.prototype.B=function(t,e,r,i){if(!r){if(nt(t=dt(t)))throw new ft(this.B,0,t);if(nt(e=yt(e)))throw new ft(this.B,1,e)}return Tt(this.i,this.f,this.h,this.g,t,e,t,e,i)},bt.prototype.mergeLatLng=bt.prototype.B,bt.prototype.ca=function(t,e,r){return e||_t(t,this.ca,0),this.B(t.lat,t.lng,e,r)},bt.prototype.mergePoint=bt.prototype.ca,bt.prototype.J=function(t,e,r){if(!(e||t instanceof bt))throw new ft(this.J,0,t);return Tt(this.i,this.f,this.h,this.g,t.i,t.f,t.h,t.g,r)},bt.prototype.mergeRect=bt.prototype.J,bt.prototype.C=function(t,e,r,i,n,o){return n||(t=dt(t,this.C,0),e=yt(e,this.C,1),r=dt(r,this.C,2),i=yt(i,this.C,3)),Tt(this.i,this.f,this.h,this.g,t,e,r,i,o)},bt.prototype.mergeTopLeftBottomRight=bt.prototype.C,bt.prototype.ba=function(t,e){var r=this.f<=this.g,i=t.f<=t.g,n=this.f<t.g,o=t.f<this.g;if(!(e||t instanceof bt))throw new ft(this.ba,0,t);return this.h<=t.i&&t.h<=this.i&&(!r&&(!i||n||o)||!i&&(n||o)||n&&o)},bt.prototype.intersects=bt.prototype.ba,bt.merge=Tt,bt.fromPoints=At,bt.coverPoints=function t(e,r){var i=1,n=e.length,o=null,a=s(e);if("array"!=a&&("object"!=a||"number"!=typeof e.length))throw new ft(t,0,e);if(0<n)for(o=At(a=e[0],a,r);i<n;i++)a=e[i],o.B(a.lat,a.lng,r,o);return o},bt.coverLatLngAlts=function t(e,r){var i,n=3,o=e.length;if(!(r||e&&null!=e.length))throw new ft(t,0,e);if(0<o)for(i=new bt(e[0],e[1],e[0],e[1]);n<o;n+=3)i.B(e[n],e[n+1],r,i);return i},bt.coverRects=function t(e,r){var i,n=1,o=e.length;if(r&&(!e||null==e.length))throw new ft(t,0,e);if(0<o)for(i=new bt(e[0].i,e[0].f,e[0].h,e[0].g);n<o;n++)i.J(e[n],r,i);return i},bt.prototype.da=function(t,e){var r=this.f,i=this.i,n=this.g,o=this.h,a=this.F().lng;_t(t,this.da,0);var s=t.lat-o-(i-o)/2,l=t.lng-a;return t=-180>(t=r+(0>(l=180<l||-180>l?-(a+t.lng):l)?2*l:0))?360+t:t,n=180<(n+=0<l?2*l:0)?n-360:n,90<=(i=0<s?i+2*s:i)&&(i=90),-90>=(o=0>s?o+2*s:o)&&(o=-90),e?xt(e,i,t,o,n):new bt(i,t,o,n)},bt.prototype.resizeToCenter=bt.prototype.da,bt.prototype.l="Polygon",bt.prototype.u=function(){return[[this.f,this.i,0],[this.g,this.i,0],[this.g,this.h,0],[this.f,this.h,0],[this.f,this.i,0]]},bt.prototype.U=function(){return this.j()},bt.prototype.j=function(){return[this.i,this.f,this.h,this.g]},St.prototype.remove=function(t){var e,r,i,n=!1;if(t&&(e=t.a)&&e.b===this&&(r=e.entries)&&0<=(i=r.indexOf(t))){var o,a;for(r.splice(i,1),r=this.a;e;)if((o=e.entries)&&o.length||(o&&delete e.entries,e.a||!(a=e.c)))e=et;else{i=a;var s=(n=e).j;i[s]===n&&(delete i[s],delete n.c,--i.a),r===e&&(r=a),e=a}this.a!==r&&(this.a=r,Pt(this)),It(this,t,!1),n=!0}return n},St.prototype.flush=function(){var t=new Ct(null,NaN,this.j-this.m,this.l-this.u,this.j+this.m,this.l+this.u);t.b=this,this.a=this.b=t,this.c=null},St.prototype.o=function(t,e,r,i,n,o){var a=[],s=this.a,l=this.b;return t<=s[5]&&e<=s[6]&&(n?r>=s[7]:r>s[7])&&(o?i>=s[4]:i>s[4])&&Ot(this,s,a,t,e,r,i,o||i>=l[6],n||r>=l[5]),a};var Lt=0;function Ct(t,e,r,i,n,o){this.j=e,t&&(this.c=t,this.b=t.b,1&e?(r=t[8],n=t[5]):(r=t[7],n=t[8]),2&e?(i=t[9],o=t[6]):(i=t[4],o=t[9])),this[7]=r,this[5]=n,this[8]=(r+n)/2,this[4]=i,this[6]=o,this[9]=(i+o)/2}function Rt(t,e,r,i,n,o){Rt.ua.constructor.apply(this,arguments)}function Mt(t,e,r,i,n,o,a){var s,l,u=e[8],c=e[9];return a&&(n<u||(s=r>=u))&&(o<c||(l=i>=c))?r=(u=Mt)(t,e=e[s|=l<<1]||(++e.a,e[s]=new Ct(e,s)),r,i,n,o,a-1):(i=r=new Nt(r,i,n,o),(e.entries||(e.entries=[])).push(i),i.a=e,It(t,r,!0),Pt(t,e)),r}function Nt(t,e,r,i){this.id=Lt++,this[0]=e,this[1]=r,this[2]=i,this[3]=t}function jt(t){this.l=new Rt(+t||10,180,90,0,0,!0),this.j=[],this.m=!1,this.a=this.b=this.c=null}function Dt(t,e,r,i,n,o){if(o)o=new Nt(n,-e,r+360,-i),t.j.push(o),t.m=!0,t.a&&t.a.C(e,r,i,n,!0,t.a);else{var a=-e,s=-i,l=(o=t.l).b,u=l[5],c=l[6];if(!(l[7]<=r&&l[4]<=a&&(u>n||u===n&&u===l.b.b[5])&&(c>s||c===s&&c===l.b.b[6])))throw Error("Coordinates out of bounds");o=Mt(o,o.b,r,a,n,s,o.sa),t.b&&t.b.C(e,r,i,n,!0,t.b)}return t.c=null,o}function Bt(t,e,r,i,n,o,a){var s,l=(t=t.j).length,u=[];if(l){var c=r+360;for(s=n+360;l--;){var h=t[l];(zt(h,e,r,i,n,o,a)||zt(h,e,c,i,s,o,a))&&u.push(h)}}return u}function zt(t,e,r,i,n,o,a){var s=t[3],l=t[0],u=t[1];return t=t[2],(o?l<=i:l<i)&&(a?s<=n:s<n)&&t>=e&&u>=r}function Ut(t,e){var r,i,n;if(r=e.length){var o=t.length;for(i={};o--;)i[t[o].id]=1;for(;r--;)(n=e[r]).id in i||t.push(n)}}function Ft(){}function Gt(t,e,r){if(this.l=[],e&&this.K(e),r&&!l(r))throw new ft(Gt,2,r);this.b=0,this.m=r,this.a={},this.j=this.c=null,this.Z(t)}function $t(t,e){return e&&(t.c=Ht(t,e,t.c)),e}function qt(t){for(;t.b>t.u&&t.j;)Vt(t,t.j,!0)}function Ht(t,e,r){return r!==e&&((e.H||e.v)&&Vt(t,e,!1),(e.H=r)&&(e.v=r.v,r.v=e),e.v||(t.c=e),e.H||(t.j=e),t.b+=e.size),e}function Vt(t,e,r){var i=e.v,n=e.H;(i||n||e==t.c&&e==t.j)&&(i?i.H=n:t.c=n,n?n.v=i:t.j=i,t.b-=e.size,r&&(delete t.a[e.id],Yt(t,e))),e.H=e.v=null}function Yt(t,e){for(var r=t.l.length;r--;)t.l[r].call(t,e.id,e.data,e.size)}Ct.prototype.a=0,h(Rt,St),c("H.geo.QuadTree",jt),jt.prototype.N=function(){return this.m},jt.prototype.D=function(){var t;if(!this.c){var e,r,i,n,o=[];if(e=!this.b){var a=this.l,s=a.c;a.I&&!s&&((e=a.a).entries||e[0]||e[1]||e[2]||e[3])&&(s=kt([s=[e],s,s,s],[e[6],e[7],e[4],e[5]]),a.c=s),e=a=s}if(e&&(this.b=new bt(-a[0],a[3],-a[2],a[1])),(t=this.b)&&o.push(t),!this.a&&(n=(i=this.j).length)){for(a=90,e=360,s=-90,r=0;n--;){var l=i[n];a=f(a,l[0]),e=f(e,l[3]),s=d(s,l[2]),r=d(r,l[1])}this.a=new bt(-a,e,-s,r-360)}(t=this.a)&&o.push(t),(t=o[0])&&(o[1]&&(t=t.J(o[1],!0)),this.c=t)}return this.c},jt.prototype.oa=function(t){var e=t.W(),r=t.V();return(t=t.N())?Dt(this,e.lat,r.lng,r.lat,e.lng,t):Dt(this,e.lat,e.lng,r.lat,r.lng,t)},jt.prototype.insertBoundingBox=jt.prototype.oa,jt.prototype.remove=function(t){var e;if(t.a){var r=this.l.remove(t);this.b=null}else(r=0<=(t=(e=this.j).indexOf(t)))&&(e.splice(t,1),this.m=0<e.length,this.a=null);return r&&(this.c=null),r},jt.prototype.remove=jt.prototype.remove,jt.prototype.pa=function(t,e,r){var i=this.l,n=t.W(),o=t.V(),a=-n.lat;n=n.lng;var s=-o.lat;return o=o.lng,!e&&a===s||!r&&n===o?t=[]:t.N()?(Ut(t=i.o(-180,a,o,s,r,e),i.o(n,a,180,s,!1,e)),Ut(t,Bt(this,a,o,s,n+360,e,r))):Ut(t=i.o(n,a,o,s,r,e),Bt(this,a,n,s,o,e,r)),t},jt.prototype.intersectBoundingBox=jt.prototype.pa,c("H.util.ICache",Ft),Ft.prototype.add=function(){},Ft.prototype.add=Ft.prototype.add,Ft.prototype.get=function(){},Ft.prototype.get=Ft.prototype.get,Ft.prototype.S=function(){},Ft.prototype.drop=Ft.prototype.S,Ft.prototype.forEach=function(){},Ft.prototype.forEach=Ft.prototype.forEach,Ft.prototype.Y=function(){},Ft.prototype.removeAll=Ft.prototype.Y,Ft.prototype.K=function(){},Ft.prototype.registerOnDrop=Ft.prototype.K,Ft.prototype.P=function(){},Ft.prototype.deRegisterOnDrop=Ft.prototype.P,c("H.util.Cache",Gt),Gt.prototype.add=function(t,e,r){var i,n;if(!ot(r=+r)||0>r)throw new ft(this.add,2,r);return t=String(t),(n=!this.m||this.m(t,e,r))&&((i=this.a[t])?(i.data!==e&&Yt(this,i),this.b+=r-i.size,i.size=r,i.data=e,$t(this,i)):this.a[t]=Ht(this,{id:t,data:e,size:r,H:null,v:null},this.c),qt(this)),n},Gt.prototype.add=Gt.prototype.add,Gt.prototype.K=function(t){if(!l(t))throw new ft(this.K,0,t);this.l.push(t)},Gt.prototype.registerOnDrop=Gt.prototype.K,Gt.prototype.P=function(t){this.l=this.l.filter((function(e){return e!==t}))},Gt.prototype.deRegisterOnDrop=Gt.prototype.P,Gt.prototype.get=function(t,e){return(t=e?this.a[t]:$t(this,this.a[t]))&&t.data},Gt.prototype.get=Gt.prototype.get,Gt.prototype.S=function(t){var e;(e=this.a[t])&&Vt(this,e,!0)},Gt.prototype.drop=Gt.prototype.S,Gt.prototype.forEach=function(t,e,r){var i;for(i in this.a){var n=this.a[i];(!r||r(i,n.data,n.size))&&t.call(e,i,n.data,n.size)}},Gt.prototype.forEach=Gt.prototype.forEach,Gt.prototype.Y=function(t){var e;for(e in this.a){var r=this.a[e];(!t||t(e,r.data,r.size))&&Vt(this,this.a[e],!0)}},Gt.prototype.removeAll=Gt.prototype.Y,Gt.prototype.Z=function(t){if(!(0<+t))throw new ft(Gt.prototype.Z,0,t);return this.u=+t,qt(this),this},Gt.prototype.setMaxSize=Gt.prototype.Z,Gt.prototype.ka=function(){return this.u},Gt.prototype.getMaxSize=Gt.prototype.ka,Gt.prototype.ia=function(){return this.b},Gt.prototype.getCurrentSize=Gt.prototype.ia}).call(ns);var MathUtils$1=MathUtils={},Geo;function _xyToArr(t){return[t.x,t.y]}function _arrToXy(t){return _construct(ns.H.math.Point,_toConsumableArray(t))}MathUtils.clipPolygon=function(t,e){var r,i,n,o=[];if(r=ns.H.math.clipping.clipPolygon(t.map(_arrToXy),e.map(_arrToXy)))do{i=[],n=r;do{i.push(_xyToArr(n))}while(n=n.next);o.push(i)}while(r=r.nextPoly);else MathUtils.isPointInsidePolygon(e[0],t)?o.push(e):MathUtils.isPointInsidePolygon(t[0],e)&&o.push(t);return o},MathUtils.isPointInsidePolygon=function(t,e){return ns.H.math.isPointInsidePolygon({x:t[0],y:t[1]},ns.H.math.flatten(e))},MathUtils.clamp=function(t,e,r){return(t-=0)>r?r:t<e?e:t},MathUtils.splitLegs=function(t,e){var r=[];t.push(t[0]);for(var i=0;i<t.length-1;i++){var n=t[i],o=t[i+1];if(r.push(n),Math.abs(o[0]-n[0])>=e){var a=[(n[0]+o[0])/2,(n[1]+o[1])/2];r.push(a)}}return r.length!==t.length-1?MathUtils.splitLegs(r,e):r},MathUtils.getBBox=function(t){var e=1/0,r=1/0,i=-1/0,n=-1/0;return t.forEach((function(t){t[0]<e&&(e=t[0]),t[1]<r&&(r=t[1]),t[0]>i&&(i=t[0]),t[1]>n&&(n=t[1])})),[e,r,i,n]},MathUtils.getBBoxCenter=function(t){var e=_slicedToArray(t,4),r=e[0],i=e[1];return[r+(e[2]-r)/2,i+(e[3]-i)/2]},MathUtils.getLineLength=function(t,e,r,i){return Math.sqrt(Math.pow(t-r,2)+Math.pow(e-i,2))},MathUtils.modulo=function(t,e){var r;return(r=t%e)<0==e<0?r:r+e};var Geo$1=Geo={};Geo.default_source_max_zoom=18,Geo.default_view_max_zoom=20,Geo.tile_size=256,Geo.half_circumference_meters=20037508.342789244,Geo.circumference_meters=2*Geo.half_circumference_meters,Geo.min_zoom_meters_per_pixel=Geo.circumference_meters/Geo.tile_size;var meters_per_pixel=[];Geo.metersPerPixel=function(t){return meters_per_pixel[t]=meters_per_pixel[t]||Geo.min_zoom_meters_per_pixel/Math.pow(2,t),meters_per_pixel[t]};var meters_per_tile=[];Geo.metersPerTile=function(t){return meters_per_tile[t]=meters_per_tile[t]||Geo.circumference_meters/Math.pow(2,t),meters_per_tile[t]},Geo.tile_scale=4096,Geo.units_per_pixel=Geo.tile_scale/Geo.tile_size,Geo.height_scale=16;var units_per_meter=[];Geo.unitsPerMeter=function(t){return units_per_meter[t]=units_per_meter[t]||Geo.tile_scale/(Geo.tile_size*Geo.metersPerPixel(t)),units_per_meter[t]},Geo.metersForTile=function(t){return{x:t.x*Geo.circumference_meters/Math.pow(2,t.z)-Geo.half_circumference_meters,y:-(t.y*Geo.circumference_meters/Math.pow(2,t.z)-Geo.half_circumference_meters)}},Geo.tileForMeters=function(t,e){var r=_slicedToArray(t,2),i=r[0],n=r[1];return{x:Math.floor((i+Geo.half_circumference_meters)/(Geo.circumference_meters/Math.pow(2,e))),y:Math.floor((-n+Geo.half_circumference_meters)/(Geo.circumference_meters/Math.pow(2,e))),z:e}},Geo.metersToExactTileCoords=function(t,e){var r=_slicedToArray(t,2),i=r[0],n=r[1];return{x:Math.pow(2,e-1)*(1+i/Geo.half_circumference_meters),y:Math.pow(2,e-1)*(1-n/Geo.half_circumference_meters),z:e}},Geo.wrapTile=function(t){var e=t.x,r=t.y,i=t.z,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{x:!0,y:!1},o=(1<<i)-1;return n.x&&(e&=o),n.y&&(r&=o),{x:e,y:r,z:i}},Geo.wrapMeters=function(t){var e=t.x,r=t.y;return{x:MathUtils$1.modulo(e+Geo.half_circumference_meters,Geo.circumference_meters)-Geo.half_circumference_meters,y:r}},Geo.metersToLatLng=function(t){var e=_slicedToArray(t,2),r=e[0],i=e[1];return r/=Geo.half_circumference_meters,i/=Geo.half_circumference_meters,i=(2*Math.atan(Math.exp(i*Math.PI))-Math.PI/2)/Math.PI,[r*=180,i*=180]},Geo.latLngToMeters=function(t){var e=_slicedToArray(t,2),r=e[0],i=e[1];return i=Math.log(Math.tan(i*Math.PI/360+Math.PI/4))/Math.PI,i*=Geo.half_circumference_meters,i=Math.min(Math.max(i,-Geo.half_circumference_meters),Geo.half_circumference_meters),[r*=Geo.half_circumference_meters/180,i]},Geo.tileSpaceToMeters=function(t,e,r){var i=_slicedToArray(t,2),n=i[0],o=i[1],a=Geo.unitsPerMeter(e);return[n/a+r.x,o/a+r.y]},Geo.tileSpaceToLatlng=function(t,e,r){var i=Geo.unitsPerMeter(e);return Geo.transformGeometry(t,(function(t){t[0]=t[0]/i+r.x,t[1]=t[1]/i+r.y;var e=_slicedToArray(Geo.metersToLatLng(t),2),n=e[0],o=e[1];t[0]=n,t[1]=o})),t},Geo.copyGeometry=function(t){if(null!=t){var e={type:t.type};return"Point"===t.type?e.coordinates=[t.coordinates[0],t.coordinates[1]]:"LineString"===t.type||"MultiPoint"===t.type?e.coordinates=t.coordinates.map((function(t){return[t[0],t[1]]})):"Polygon"===t.type||"MultiLineString"===t.type?e.coordinates=t.coordinates.map((function(t){return t.map((function(t){return[t[0],t[1]]}))})):"MultiPolygon"===t.type&&(e.coordinates=t.coordinates.map((function(t){return t.map((function(t){return t.map((function(t){return[t[0],t[1]]}))}))}))),e}},Geo.transformGeometry=function(t,e){null!=t&&("Point"===t.type?e(t.coordinates):"LineString"===t.type||"MultiPoint"===t.type?t.coordinates.forEach(e):"Polygon"===t.type||"MultiLineString"===t.type?t.coordinates.forEach((function(t){return t.forEach(e)})):"MultiPolygon"===t.type&&t.coordinates.forEach((function(t){t.forEach((function(t){return t.forEach(e)}))})))},Geo.boxIntersect=function(t,e){return!(e.sw.x>t.ne.x||e.ne.x<t.sw.x||e.sw.y>t.ne.y||e.ne.y<t.sw.y)},Geo.findBoundingBox=function(t){for(var e=1/0,r=-1/0,i=1/0,n=-1/0,o=t[0].length,a=0;a<o;a++){var s=t[0][a];s[0]<e&&(e=s[0]),s[1]<i&&(i=s[1]),s[0]>r&&(r=s[0]),s[1]>n&&(n=s[1])}return[e,i,r,n]},Geo.geometryType=function(t){return"Polygon"===t||"MultiPolygon"===t?"polygon":"LineString"===t||"MultiLineString"===t?"line":"Point"===t||"MultiPoint"===t?"point":void 0},Geo.centroid=function(t){var e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(t&&0!==t.length){var r,i=0,n=0,o=0,a=t[0],s=a.length;e&&(r=a[0],a=a.map((function(t){return[t[0]-r[0],t[1]-r[1]]})));for(var l=0,u=s-1;l<s;u=l,l++){var c=a[l],h=a[u],p=c[1]*h[0]-h[1]*c[0];i+=(c[0]+h[0])*p,n+=(c[1]+h[1])*p,o+=3*p}var f=[i/o,n/o];return e&&(f[0]+=r[0],f[1]+=r[1]),f}},Geo.multiCentroid=function(t){for(var e=t.length,r=[0,0],i=0;i<t.length;i++){var n=Geo.centroid(t[i]);r[0]+=n[0],r[1]+=n[1]}return r[0]/=e,r[1]/=e,r},Geo.signedPolygonRingAreaSum=function(t){for(var e=0,r=t.length,i=0;i<r-1;i++){var n=t[i],o=t[i+1];e+=n[0]*o[1]-o[0]*n[1]}return e+(t[r-1][0]*t[0][1]-t[0][0]*t[r-1][1])},Geo.polygonRingArea=function(t){return Math.abs(Geo.signedPolygonRingAreaSum(t))/2},Geo.polygonArea=function(t){if(t)return Geo.polygonRingArea(t[0])},Geo.multiPolygonArea=function(t){for(var e=0,r=0;r<t.length;r++)e+=Geo.polygonArea(t[r]);return e},Geo.ringWinding=function(t){var e=Geo.signedPolygonRingAreaSum(t);return e>0?"CW":e<0?"CCW":void 0},Geo.getTileBoundingBox=function(t,e){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=Geo.wrapTile(t,{x:!0}),n=Geo.metersForTile(i),o=Geo.metersPerPixel(i.z),a=Geo.metersToLatLng([n.x-r*o,n.y+r*o]),s=Geo.metersToLatLng([n.x+(e+r)*o,n.y-(e+r)*o]),l=Geo.isLastTile(i);return new ns.H.geo.Rect(0===t.y?90:MathUtils$1.clamp(a[1],-90,90),MathUtils$1.clamp(a[0],-180,180),l.row?-90:MathUtils$1.clamp(s[1],-90,90),l.column?180:MathUtils$1.clamp(s[0],-180,180))},Geo.isLastTile=function(t){var e=t.x,r=t.y,i=t.z;return{row:r===Math.pow(2,i)-1,column:e===Math.pow(2,i)-1}};var MethodNotImplemented=function(t){function e(t){var r;return _classCallCheck(this,e),(r=_callSuper(this,e)).name="MethodNotImplemented",r.message="Method "+t+" must be implemented in subclass",r}return _inherits(e,t),_createClass(e)}(_wrapNativeSuper(Error)),is_worker=!1,is_main=!1,force_main,force_worker;try{window.document!==HTMLDocument&&(is_main=!0)}catch(e){void 0!==self&&(is_worker=!0,self.window={document:{}},self.document=self.window.document)}var Thread={get is_fake_worker(){return self.is_fake_worker},get is_worker(){return void 0!==force_worker?force_worker:is_worker||self.is_fake_worker},set is_worker(t){force_worker=t},get is_main(){return void 0!==force_main?force_main:is_main&&!self.is_fake_worker},set is_main(t){force_main=t},is_native_worker:is_worker},WorkerBroker={},message_id=0,messages={},targets={},main_worker_targets={};function findTarget(t,e){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:targets,i=[];if("string"==typeof t&&(i=t.split("."),t=i.pop()),Thread.is_main&&e&&1===i.length&&"self"===i[0])r=e;else for(var n=0;n<i.length;n++){if(!r[i[n]])return[];r=r[i[n]]}return[t,r]}WorkerBroker.addTarget=function(t,e){Thread.is_fake_worker?main_worker_targets[t]=e:targets[t]=e},WorkerBroker.removeTarget=function(t){delete targets[t],delete main_worker_targets[t]};var ERROR_NO_TARGET=" No object with that name is registered on main thread.",ERROR_NO_METHOD=" Object has no method with that name.",ERROR_NOT_SET="_worker_broker_error_not_set_";function setupMainThread(){WorkerBroker.postMessage=function(t,e){for(var r=arguments.length,i=new Array(r>2?r-2:0),n=2;n<r;n++)i[n-2]=arguments[n];if(Array.isArray(t))return Promise.all(t.map((function(t){return WorkerBroker.postMessage.apply(WorkerBroker,[t,e].concat(_toConsumableArray(i)))})));var o,a={};"object"===_typeof(e)&&(a=e,e=e.method);var s="main_send";"string"==typeof t?(e=t,i=Array.prototype.slice.call(arguments,1),o=!0,s="worker_send"):t.init&&(o=!0);var l,u=[];if(i&&1===i.length&&i[0]instanceof WorkerBroker.withTransferables&&(u=i[0].transferables,i=i[0].value),l={type:s,message_id:++message_id,method:e,message:i},o)return function(t,e){var r=t.type,i=_slicedToArray(findTarget(t.method,e,"main_send"===r?main_worker_targets:targets),2),n=i[0],o=i[1],a="Worker broker could not dispatch message type ".concat(t.method," on target ").concat(t.target,".");if(!o)throw Error(a+ERROR_NO_TARGET);var s="function"==typeof o[n]&&o[n];if(!s)throw Error(a+ERROR_NO_METHOD);return new Promise((function(e,r){var i;try{i=s.apply(o,t.message)}catch(t){return void r(t)}i instanceof Promise?i.then((function(t){t instanceof WorkerBroker.withTransferables&&(t=t.value[0]),e(t)}),(function(t){r(t instanceof Error?"".concat(t.message,": ").concat(t.stack):t)})):(i instanceof WorkerBroker.withTransferables&&(i=i.value[0]),e(i))}))}(l,t&&t.init?t:void 0);var c=new Promise((function(t,r){messages[message_id]={method:e,message:i,resolve:t,reject:r}}));return a.stringify&&(l=JSON.stringify(l)),t.postMessage(l,u.map((function(t){return t.object}))),freeTransferables(u),c},WorkerBroker.addWorker=function(t){if(!(t instanceof Worker))throw Error("Worker broker could not add non-Worker object",t);t.addEventListener("message",(function(e){var r="string"==typeof e.data?JSON.parse(e.data):e.data,i=r.message_id;if("worker_reply"===r.type)messages[i]&&(r.error?messages[i].reject(r.error):messages[i].resolve(r.message),delete messages[i]);else if("worker_send"===r.type&&null!=i){var n=_slicedToArray(findTarget(r.method),2),o=n[0],a=n[1],s="Worker broker could not dispatch message type ".concat(r.method," on target ").concat(r.target,".");if(!a)throw Error(s+ERROR_NO_TARGET);var l="function"==typeof a[o]&&a[o];if(!l)throw Error(s+ERROR_NO_METHOD);var u,c=ERROR_NOT_SET;try{u=l.apply(a,r.message)}catch(t){c=t}var h,p=[];u&&"function"==typeof u.then?u.then((function(e){e instanceof WorkerBroker.withTransferables&&(p=e.transferables,e=e.value[0]),h={type:"main_reply",message_id:i,message:e},t.postMessage(h,p.map((function(t){return t.object}))),freeTransferables(p)}),(function(e){t.postMessage({type:"main_reply",message_id:i,error:e instanceof Error?"".concat(e.message,": ").concat(e.stack):e})})):(u instanceof WorkerBroker.withTransferables&&(p=u.transferables,u=u.value[0]),h={type:"main_reply",message_id:i,message:u,error:c instanceof Error?"".concat(c.message,": ").concat(c.stack):c},t.postMessage(h,p.map((function(t){return t.object}))),freeTransferables(p))}}))},WorkerBroker.getMessages=function(){return messages},WorkerBroker.getMessageId=function(){return message_id}}function setupWorkerThread(){WorkerBroker.postMessage=function(t){for(var e=arguments.length,r=new Array(e>1?e-1:0),i=1;i<e;i++)r[i-1]=arguments[i];var n={};"object"===_typeof(t)&&(n=t,t=t.method);var o,a=new Promise((function(e,i){messages[message_id]={method:t,message:r,resolve:e,reject:i}})),s=[];return r&&1===r.length&&r[0]instanceof WorkerBroker.withTransferables&&(s=r[0].transferables,r=r[0].value),o={type:"worker_send",message_id,method:t,message:r},n.stringify&&(o=JSON.stringify(o)),self.postMessage(o,s.map((function(t){return t.object}))),freeTransferables(s),message_id++,a},self.addEventListener("message",(function(t){var e="string"==typeof t.data?JSON.parse(t.data):t.data,r=e.message_id;if("main_reply"===e.type)messages[r]&&(e.hasOwnProperty("error")&&e.error!==ERROR_NOT_SET?messages[r].reject(e.error):messages[r].resolve(e.message),delete messages[r]);else if("main_send"===e.type&&null!=r){var i=_slicedToArray(findTarget(e.method),2),n=i[0],o=i[1],a="Worker broker could not dispatch message type ".concat(e.method," on target ").concat(e.target,".");if(!o)throw Error(a+ERROR_NO_TARGET);var s,l,u="function"==typeof o[n]&&o[n];if(!u)throw Error(a+ERROR_NO_METHOD);try{s=u.apply(o,e.message)}catch(t){l=t}var c,h=[];s instanceof Promise?s.then((function(t){t instanceof WorkerBroker.withTransferables&&(h=t.transferables,t=t.value[0]),c={type:"worker_reply",message_id:r,message:t},self.postMessage(c,h.map((function(t){return t.object}))),freeTransferables(h)}),(function(t){self.postMessage({type:"worker_reply",message_id:r,error:t instanceof Error?"".concat(t.message,": ").concat(t.stack):t})})):(s instanceof WorkerBroker.withTransferables&&(h=s.transferables,s=s.value[0]),c={type:"worker_reply",message_id:r,message:s,error:l instanceof Error?"".concat(l.message,": ").concat(l.stack):l},self.postMessage(c,h.map((function(t){return t.object}))),freeTransferables(h))}}))}function findTransferables(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[];if(!t)return i;if(Array.isArray(t))t.forEach((function(e,r){return findTransferables(e,t,r,i)}));else if("object"===_typeof(t))if(t instanceof ArrayBuffer)i.push({object:t,parent:e,property:r});else if(t.buffer instanceof ArrayBuffer)i.push({object:t.buffer,parent:e,property:r});else for(var n in t)findTransferables(t[n],t,n,i);return i}function freeTransferables(t){Array.isArray(t)&&t.filter((function(t){return t.parent&&t.property})).forEach((function(t){return delete t.parent[t.property]}))}WorkerBroker.withTransferables=function(){for(var t=arguments.length,e=new Array(t),r=0;r<t;r++)e[r]=arguments[r];if(!(this instanceof WorkerBroker.withTransferables))return _construct(WorkerBroker.withTransferables,e);this.value=e,this.transferables=findTransferables(this.value)},Thread.is_main&&setupMainThread(),Thread.is_worker&&setupWorkerThread();var LEVELS={silent:-1,error:0,warn:1,info:2,debug:3,trace:4},methods={},logged_once={},Utils;function methodForLevel(t){return methods[t]=methods[t]||(console[t]?console[t]:console.log).bind(console),methods[t]}function log(t){var e="object"===_typeof(t)?t.level:t;if(LEVELS[e]<=LEVELS[log.level]){for(var r=arguments.length,i=new Array(r>1?r-1:0),n=1;n<r;n++)i[n-1]=arguments[n];if(Thread.is_native_worker)WorkerBroker.postMessage.apply(WorkerBroker,[{method:"_logProxy",stringify:!0},t].concat(i));else{if("object"===_typeof(t)&&!0===t.once){if(logged_once[JSON.stringify(i)])return;logged_once[JSON.stringify(i)]=!0}var o=methodForLevel(e);i.length>1?o.apply(void 0,["Tangram [".concat(e,"]: ").concat(i[0])].concat(_toConsumableArray(i.slice(1)))):o("Tangram [".concat(e,"]: ").concat(i[0]))}}}function debounce(t,e,r){var i,n;return r=r||0,function(){var o=this,a=arguments;function s(){n=0,t.apply(o,a)}clearTimeout(i),n&&r&&Date.now()-n>=r?s():(n||(n=Date.now()),i=setTimeout((function(){s()}),e))}}log.level="info",log.workers=null,log.setLevel=function(t){log.level=t,Thread.is_main&&Array.isArray(log.workers)&&WorkerBroker.postMessage(log.workers,"_logSetLevelProxy",t)},Thread.is_main&&(log.setWorkers=function(t){log.workers=t},log.reset=function(){logged_once={}}),WorkerBroker.addTarget("_logProxy",log),WorkerBroker.addTarget("_logSetLevelProxy",log.setLevel);var Utils$1=Utils={};WorkerBroker.addTarget("Utils",Utils),Utils.isSafari=function(){return/^((?!chrome|android).)*safari/i.test(navigator.userAgent)},Utils.isMicrosoft=function(){return/(Trident\/7.0|Edge[ /](\d+[\.\d]+))/i.test(navigator.userAgent)},Utils._requests={},Utils._proxy_requests={},Utils.io=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:6e4,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"text",i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"GET",n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{},o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,a=arguments.length>6&&void 0!==arguments[6]&&arguments[6];if(Thread.is_worker&&Utils.isMicrosoft())return log("debug","Proxying request for URL to worker",t),o&&(Utils._proxy_requests[o]=!0),WorkerBroker.postMessage("Utils.io",t,e,r,i,n,o,!0);var s=new XMLHttpRequest,l=new Promise((function(n,o){s.open(i,t,!0),s.timeout=e,s.responseType=r,s.onload=function(){200===s.status?["text","json"].indexOf(s.responseType)>-1?n(s.responseText):n(s.response):o(Error("Request error with a status of "+s.statusText))},s.onerror=function(t){o(Error("There was a network error"+t.toString()))},s.ontimeout=function(t){o(Error("timeout "+t.toString()))},s.send()}));return l=l.then((function(t){return o&&delete Utils._requests[o],a?WorkerBroker.withTransferables(t):t})),o&&(Utils._requests[o]=s),l},Utils.cancelRequest=function(t){if(Thread.is_worker&&Utils._proxy_requests[t])return WorkerBroker.postMessage("Utils.cancelRequest",t);Utils._requests[t]?(log("trace","Cancelling network request key '".concat(t,"'")),Utils._requests[t].abort(),delete Utils._requests[t]):log("trace","Could not find network request key '".concat(t,"'"))},Utils.requestAnimationFramePolyfill=function(){"function"!=typeof window.requestAnimationFrame&&(window.requestAnimationFrame=window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(t){setTimeout(t,1e3/60)})},Utils.serializeWithFunctions=function(t){return"function"==typeof t?t.toString():JSON.stringify(t,(function(t,e){return"function"==typeof e?e.toString():e}))},Utils.stringsToFunctions=function(t,e){if("string"==typeof t)t=Utils.stringToFunction(t,e);else if(null!=t&&"object"===_typeof(t))for(var r in t)t[r]=Utils.stringsToFunctions(t[r],e);return t},Utils._use_count=0,Utils._function_cache={};var _clear_function_cache=debounce((function(){log("trace","Cleared cached ".concat(Object.keys(Utils._function_cache).length," functions (reused ").concat(Utils._use_count," times)")),Utils._use_count=0,Utils._function_cache={}}),1e4),FUNCTION_MATCH_RGX=/^\s*function[^(]*\(([^)]*)\)\s*?\{([\s\S]*)\}$/m,_createObjectURL,_revokeObjectURL;function addBaseURL(t,e){if(!t||!isRelativeURL(t))return t;var r,i="/"!==t[0];if(e?(r=document.createElement("a")).href=e:r=window.location,i)t=pathForURL(r.href)+t;else{var n=r.origin;n||(n=r.protocol+"//"+r.host),t=n+t}return t}function pathForURL(t){if("string"==typeof t&&-1===t.search(/^(data|blob):/)){var e=t.indexOf("?");e>-1&&(t=t.substr(0,e));var r=t.indexOf("#");return r>-1&&(t=t.substr(0,r)),t.substr(0,t.lastIndexOf("/")+1)||""}return""}function extensionForURL(t){var e=(t=t.split("/").pop()).lastIndexOf(".");if(e>-1)return t.substring(e+1)}function isRelativeURL(t){if("string"==typeof t)return!(t.search(/^(http|https|data|blob):/)>-1||"//"===t.substr(0,2))}function addParamsToURL(t,e){if(!e||0===Object.keys(e).length)return[t,[]];var r=t.indexOf("?"),i=t.indexOf("#"),n="";i>-1&&(n=t.slice(i),t=t.slice(0,i)),-1===r&&(r=t.length,t+="?"),r++;var o="",a=[];for(var s in e)""===getURLParameter(s,t)?o+="".concat(s,"=").concat(e[s],"&"):a.push([s,e[s]]);return[t=t.slice(0,r)+o+t.slice(r)+n,a]}function createObjectURL(t){return void 0===_createObjectURL&&"function"!=typeof(_createObjectURL=window.URL&&window.URL.createObjectURL||window.webkitURL&&window.webkitURL.createObjectURL)&&(_createObjectURL=null,log("warn","window.URL.createObjectURL (or vendor prefix) not found, unable to create local blob URLs")),_createObjectURL?_createObjectURL(t):t}function revokeObjectURL(t){return void 0===_revokeObjectURL&&"function"!=typeof(_revokeObjectURL=window.URL&&window.URL.revokeObjectURL||window.webkitURL&&window.webkitURL.revokeObjectURL)&&(_revokeObjectURL=null,log("warn","window.URL.revokeObjectURL (or vendor prefix) not found, unable to create local blob URLs")),_revokeObjectURL?_revokeObjectURL(t):t}function getURLParameter(t,e){t=t.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var r=new RegExp("[\\?&]"+t+"=([^&#]*)").exec(e);return null===r?"":decodeURIComponent(r[1].replace(/\+/g," "))}Utils.stringToFunction=function(t,e){var r=t;e&&(r+=e.toString());var i=Utils._function_cache[r];if(_clear_function_cache(),i)return Utils._use_count++,i;var n="string"==typeof t&&t.match(FUNCTION_MATCH_RGX);if(n&&n.length>2)try{var o=n[2],a=n[1].length>0&&n[1].split(",").map((function(t){return t.trim()})).filter((function(t){return t}));a=a.length>0?a:["context"];var s=new Function(a.toString(),"function"==typeof e?e(o):o);return Utils._function_cache[r]=s,s}catch(e){return t}return t},Utils.device_pixel_ratio=1,Utils.isPowerOf2=function(t){return!(t&t-1)},Utils.interpolate=function(t,e,r){if(!Array.isArray(e)||!Array.isArray(e[0]))return e;if(e.length<1)return e;var i,n,o,a,s;if(t<=e[0][0])a=e[0][1],"function"==typeof r&&(a=r(a));else if(t>=e[e.length-1][0])a=e[e.length-1][1],"function"==typeof r&&(a=r(a));else for(var l=0;l<e.length-1;l++)if(t>=e[l][0]&&t<e[l+1][0]){if(i=e[l][0],n=e[l+1][0],Array.isArray(e[l][1])){a=[];for(var u=0;u<e[l][1].length;u++)"function"==typeof r?(s=r(e[l][1][u]),o=r(e[l+1][1][u])-s,a[u]=o*(t-i)/(n-i)+s):(o=e[l+1][1][u]-e[l][1][u],a[u]=o*(t-i)/(n-i)+e[l][1][u])}else"function"==typeof r?(s=r(e[l][1]),a=(o=r(e[l+1][1])-s)*(t-i)/(n-i)+s):a=(o=e[l+1][1]-e[l][1])*(t-i)/(n-i)+e[l][1];break}return a},Utils.toCSSColor=function(t){return 1===t[3]?"rgb(".concat(t.slice(0,3).map((function(t){return Math.round(255*t)})).join(", "),")"):"rgba(".concat(t.map((function(t,e){return e<3&&Math.round(255*t)||t})).join(", "),")")},Utils.pointInTile=function(t){return t[0]>=0&&t[1]>-Geo$1.tile_scale&&t[0]<Geo$1.tile_scale&&t[1]<=0},Utils.zoomToTileLevel=function(t){return Math.floor(t)};var DataSource=function(){function t(e,r){var i=this;if(_classCallCheck(this,t),this.config=e,this.sources=r,this.id=e.id,this.name=e.name,this.pad_scale=e.pad_scale||1e-4,this.default_winding=null,this.rasters=[],Array.isArray(e.rasters)&&e.rasters.forEach((function(t){-1===i.rasters.indexOf(t)&&i.rasters.push(t)})),this.preprocess=e.preprocess,"function"==typeof this.preprocess&&this.preprocess.bind(this),this.transform=e.transform,"function"==typeof this.transform)this.transform=this.transform.bind(this);else if("object"===_typeof(this.transform))for(var n in this.transform)"function"==typeof this.transform[n]&&(this.transform[n]=this.transform[n].bind(this));this.extra_data=e.extra_data,this.scripts=e.scripts,this.max_zoom=null!=e.max_zoom?e.max_zoom:Geo$1.default_source_max_zoom,this.setTileSize(e.tile_size),this.max_coord_zoom=this.max_zoom+this.zoom_bias,this.min_display_zoom=null!=e.min_display_zoom?e.min_display_zoom:0,this.max_display_zoom=null!=e.max_display_zoom?e.max_display_zoom:null,this._has_volatile_data=!!e.has_volatile_data}return _createClass(t,[{key:"has_volatile_data",get:function(){return this._has_volatile_data},set:function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._has_volatile_data=t}},{key:"hasLabeledData",value:function(){return!0}},{key:"_transformTile",value:function(t){if(t.source_data.layers){var e={coords:t.coords},r=[];if("function"==typeof this.transform)r.push(this.transform);else if("object"===_typeof(this.transform))for(var i=Object.keys(this.transform).sort(),n=0;n<i.length;n++)r.push(this.transform[i[n]]);for(var o=1===Object.keys(t.source_data.layers).length&&t.source_data.layers._default,a=0;a<r.length;a++)o?t.source_data.layers._default=r[a](t.source_data.layers._default,this.extra_data,e):t.source_data.layers=r[a](t.source_data.layers,this.extra_data,e)}}},{key:"_postProcessTile",value:function(t){var e=this;for(var r in this._transformTile(t),t.source_data.layers){var i=t.source_data.layers[r];i&&i.features&&i.features.forEach((function(t){Geo$1.transformGeometry(t.geometry,(function(t){t[1]=-t[1],e.pad_scale&&(t[0]=Math.round(t[0]*(1+e.pad_scale)-Geo$1.tile_scale*e.pad_scale/2),t[1]=Math.round(t[1]*(1+e.pad_scale)-Geo$1.tile_scale*e.pad_scale/2))})),e.updateDefaultWinding(t.geometry)}))}t.default_winding=this.default_winding||"CCW"}},{key:"load",value:function(t){return t.source_data={},t.source_data.layers={},t.pad_scale=this.pad_scale,t.rasters=_toConsumableArray(this.rasters),this._load(t)}},{key:"_load",value:function(t){throw new MethodNotImplemented("_load")}},{key:"setTileSize",value:function(t){this.tile_size=t||256,("number"!=typeof this.tile_size||this.tile_size<256||!Utils$1.isPowerOf2(this.tile_size))&&(log({level:"warn",once:!0},"Data source '".concat(this.name,"': 'tile_size' parameter must be a number that is a power of 2 greater than or equal to 256, but was '").concat(t,"'")),this.tile_size=256),this.zoom_bias=Math.log2(this.tile_size)-8}},{key:"updateDefaultWinding",value:function(t){return null==this.default_winding&&("Polygon"===t.type?this.default_winding=Geo$1.ringWinding(t.coordinates[0]):"MultiPolygon"===t.type&&(this.default_winding=Geo$1.ringWinding(t.coordinates[0][0]))),this.default_winding}},{key:"includesTile",value:function(t,e){if(t.z<this.min_display_zoom||null!=this.max_display_zoom&&e>this.max_display_zoom)return!1;for(var r=0;r<this.rasters.length;r++){var i=this.rasters[r];if(this.sources[i]&&this.sources[i]!==this&&!this.sources[i].includesTile(t,t.z))return!1}return!0}}],[{key:"create",value:function(e,r){for(var i in r)if(r[i].config.name===e.name&&t.sameConfig(r[i],{config:e}))return r[i];if(t.types[e.type])return new t.types[e.type](e,r)}},{key:"sameConfig",value:function(t,e){if(!t||!e)return!1;var r=Object.assign({},t.config,{id:null,tiled:null,url:null}),i=Object.assign({},e.config,{id:null,tiled:null,url:null});return JSON.stringify(r)===JSON.stringify(i)}},{key:"coordsToMeters",value:function(t){var e=_slicedToArray(Geo$1.latLngToMeters(t),2),r=e[0],i=e[1];t[0]=r,t[1]=i}},{key:"projectData",value:function(e){for(var r in e.layers)for(var i=e.layers[r].features.length,n=0;n<i;n++){var o=e.layers[r].features[n];Geo$1.transformGeometry(o.geometry,t.coordsToMeters)}}},{key:"metersToTileUnits",value:function(t,e,r){r[0]=Math.round((r[0]-e.x)*t),r[1]=-1*Math.round((r[1]-e.y)*t)}},{key:"scaleData",value:function(e,r){var i=r.coords.z,n=r.min;r.max;var o=t.metersToTileUnits.bind(this,Geo$1.unitsPerMeter(i),n);for(var a in e.layers)for(var s=e.layers[a].features.length,l=0;l<s;l++){var u=e.layers[a].features[l];Geo$1.transformGeometry(u.geometry,o)}}},{key:"register",value:function(e,r){e&&r&&(t.types[r]=e)}}])}();DataSource.types={};var network_request_id=0,NetworkSource=function(t){function e(t,r){var i;_classCallCheck(this,e),(i=_callSuper(this,e,[t,r])).response_type="";var n=_slicedToArray(addParamsToURL(t.url,t.url_params),2),o=n[0],a=n[1];if(i.url=o,a.forEach((function(e){var r=_slicedToArray(e,2),n=r[0],o=r[1];log({level:"warn",once:!0},"Data source '".concat(i.name,"': parameter '").concat(n,"' already present in URL '").concat(t.url,"', ")+"skipping value '".concat(n,"=").concat(o,"' specified in 'url_params'"))})),"string"!=typeof i.url)throw Error("Network data source must provide a string `url` property");return i}return _inherits(e,t),_createClass(e,[{key:"_load",value:function(t){var e=this,r=this.formatUrl(this.url,t),i=t.source_data;return i.url=r,new Promise((function(n,o){i.error=null;var a=network_request_id+++"-"+r,s=Utils$1.io(r,6e4,e.response_type,"GET",{},a);i.request_id=a,s.then((function(r){"function"==typeof e.preprocess&&(r=e.preprocess(r)),(r=r instanceof Promise?r:Promise.resolve(r)).then((function(r){e.parseSourceData(t,i,r),e._postProcessTile(t),n(t)}))}),(function(r){i.error=r.stack,e._postProcessTile(t),n(t)}))}))}},{key:"formatUrl",value:function(t,e){throw new MethodNotImplemented("formatUrl")}},{key:"parseSourceData",value:function(t,e,r){throw new MethodNotImplemented("parseSourceData")}}])}(DataSource),NetworkTileSource=function(t){function e(t,r){var i;return _classCallCheck(this,e),(i=_callSuper(this,e,[t,r])).tiled=!0,i.parseBounds(t),i.builds_geometry_tiles=!1,i.tms=!0===t.tms,i.url.search("{s}")>-1&&(Array.isArray(t.url_subdomains)&&t.url_subdomains.length>0?(i.url_subdomains=t.url_subdomains,i.next_url_subdomain=0):log({level:"warn",once:!0},"Data source '".concat(i.name,"': source URL includes '{s}' subdomain marker ('").concat(i.url,"'), but no subdomains ")+"were specified in 'url_subdomains' parameter")),i}return _inherits(e,t),_createClass(e,[{key:"parseBounds",value:function(t){if(Array.isArray(t.bounds)&&4===t.bounds.length){this.bounds=t.bounds;var e=_slicedToArray(this.bounds,4),r=e[0],i=e[1],n=e[2],o=e[3];this.bounds_meters={min:Geo$1.latLngToMeters([r,o]),max:Geo$1.latLngToMeters([n,i])},this.bounds_tiles={min:{},max:{}}}}},{key:"checkBounds",value:function(t){if(this.bounds){t=Geo$1.wrapTile(t,{x:!0});var e=this.bounds_tiles.min[t.z];e||(e=this.bounds_tiles.min[t.z]=Geo$1.tileForMeters(this.bounds_meters.min,t.z));var r=this.bounds_tiles.max[t.z];if(r||(r=this.bounds_tiles.max[t.z]=Geo$1.tileForMeters(this.bounds_meters.max,t.z)),t.x<e.x||t.x>r.x||t.y<e.y||t.y>r.y)return!1}return!0}},{key:"includesTile",value:function(t,r){return!!_get(_getPrototypeOf(e.prototype),"includesTile",this).call(this,t,r)&&!!this.checkBounds(t)}},{key:"formatUrl",value:function(t,e){var r=Geo$1.wrapTile(e.coords,{x:!0});this.tms&&(r.y=Math.pow(2,r.z)-1-r.y);var i=t.replace("{x}",r.x).replace("{y}",r.y).replace("{z}",r.z);return null!=this.url_subdomains&&(i=i.replace("{s}",this.url_subdomains[this.next_url_subdomain]),this.next_url_subdomain=(this.next_url_subdomain+1)%this.url_subdomains.length),i}},{key:"urlHasTilePattern",value:function(t){return t&&t.search("{x}")>-1&&t.search("{y}")>-1&&t.search("{z}")>-1}}])}(NetworkSource),MapsJsSource=function(t){function e(t,r){var i;return _classCallCheck(this,e),(i=_callSuper(this,e,[t,r])).target_name="MapsJsSource"+t.uid,i.tiled=!!t.tiled,WorkerBroker.addTarget(i.target_name,i),Thread.is_worker&&WorkerBroker.postMessage(i.target_name+".onWorkerInitialized"),Thread.is_main&&(i._workers_left=0),i}return _inherits(e,t),_createClass(e,[{key:"initialize",value:function(t,e,r,i){this._main_initialized||(this.provider=t,this.worker=i,this._workers_left+=r,this._on_update=e,this._main_initialized=!0,this._onProviderUpdate=this._onProviderUpdate.bind(this),t.addEventListener("update",this._onProviderUpdate),this._isReady()&&this.onReady())}},{key:"onWorkerInitialized",value:function(){--this._workers_left,this._isReady()&&this.onReady()}},{key:"onReady",value:function(){}},{key:"_isReady",value:function(){return this._main_initialized&&!this._workers_left}},{key:"_onProviderUpdate",value:function(t){this._isReady()&&this.onProviderUpdate(t)}},{key:"onProviderUpdate",value:function(t){this.dispatchUpdate(void 0,t.data)}},{key:"dispatchUpdate",value:function(t,e){this._on_update(this.name,t,e)}},{key:"dispose",value:function(){WorkerBroker.removeTarget(this.target_name),this.provider.removeEventListener("update",this._onProviderUpdate)}}])}(DataSource),ieee754$1={read:function(t,e,r,i,n){var o,a,s=8*n-i-1,l=(1<<s)-1,u=l>>1,c=-7,h=r?n-1:0,p=r?-1:1,f=t[e+h];for(h+=p,o=f&(1<<-c)-1,f>>=-c,c+=s;c>0;o=256*o+t[e+h],h+=p,c-=8);for(a=o&(1<<-c)-1,o>>=-c,c+=i;c>0;a=256*a+t[e+h],h+=p,c-=8);if(0===o)o=1-u;else{if(o===l)return a?NaN:1/0*(f?-1:1);a+=Math.pow(2,i),o-=u}return(f?-1:1)*a*Math.pow(2,o-i)},write:function(t,e,r,i,n,o){var a,s,l,u=8*o-n-1,c=(1<<u)-1,h=c>>1,p=23===n?Math.pow(2,-24)-Math.pow(2,-77):0,f=i?0:o-1,d=i?1:-1,y=e<0||0===e&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(s=isNaN(e)?1:0,a=c):(a=Math.floor(Math.log(e)/Math.LN2),e*(l=Math.pow(2,-a))<1&&(a--,l*=2),(e+=a+h>=1?p/l:p*Math.pow(2,1-h))*l>=2&&(a++,l/=2),a+h>=c?(s=0,a=c):a+h>=1?(s=(e*l-1)*Math.pow(2,n),a+=h):(s=e*Math.pow(2,h-1)*Math.pow(2,n),a=0));n>=8;t[r+f]=255&s,f+=d,s/=256,n-=8);for(a=a<<n|s,u+=n;u>0;t[r+f]=255&a,f+=d,a/=256,u-=8);t[r+f-d]|=128*y}},pbf=Pbf,ieee754=ieee754$1;function Pbf(t){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(t)?t:new Uint8Array(t||0),this.pos=0,this.type=0,this.length=this.buf.length}Pbf.Varint=0,Pbf.Fixed64=1,Pbf.Bytes=2,Pbf.Fixed32=5;var SHIFT_LEFT_32=4294967296,SHIFT_RIGHT_32=1/SHIFT_LEFT_32;function readVarintRemainder(t,e,r){var i,n,o=r.buf;if(i=(112&(n=o[r.pos++]))>>4,n<128)return toNum(t,i,e);if(i|=(127&(n=o[r.pos++]))<<3,n<128)return toNum(t,i,e);if(i|=(127&(n=o[r.pos++]))<<10,n<128)return toNum(t,i,e);if(i|=(127&(n=o[r.pos++]))<<17,n<128)return toNum(t,i,e);if(i|=(127&(n=o[r.pos++]))<<24,n<128)return toNum(t,i,e);if(i|=(1&(n=o[r.pos++]))<<31,n<128)return toNum(t,i,e);throw new Error("Expected varint not more than 10 bytes")}function readPackedEnd(t){return t.type===Pbf.Bytes?t.readVarint()+t.pos:t.pos+1}function toNum(t,e,r){return r?4294967296*e+(t>>>0):4294967296*(e>>>0)+(t>>>0)}function writeBigVarint(t,e){var r,i;if(t>=0?(r=t%4294967296|0,i=t/4294967296|0):(i=~(-t/4294967296),4294967295^(r=~(-t%4294967296))?r=r+1|0:(r=0,i=i+1|0)),t>=0x10000000000000000||t<-0x10000000000000000)throw new Error("Given varint doesn't fit into 10 bytes");e.realloc(10),writeBigVarintLow(r,i,e),writeBigVarintHigh(i,e)}function writeBigVarintLow(t,e,r){r.buf[r.pos++]=127&t|128,t>>>=7,r.buf[r.pos++]=127&t|128,t>>>=7,r.buf[r.pos++]=127&t|128,t>>>=7,r.buf[r.pos++]=127&t|128,t>>>=7,r.buf[r.pos]=127&t}function writeBigVarintHigh(t,e){var r=(7&t)<<4;e.buf[e.pos++]|=r|((t>>>=3)?128:0),t&&(e.buf[e.pos++]=127&t|((t>>>=7)?128:0),t&&(e.buf[e.pos++]=127&t|((t>>>=7)?128:0),t&&(e.buf[e.pos++]=127&t|((t>>>=7)?128:0),t&&(e.buf[e.pos++]=127&t|((t>>>=7)?128:0),t&&(e.buf[e.pos++]=127&t)))))}function makeRoomForExtraLength(t,e,r){var i=e<=16383?1:e<=2097151?2:e<=268435455?3:Math.ceil(Math.log(e)/(7*Math.LN2));r.realloc(i);for(var n=r.pos-1;n>=t;n--)r.buf[n+i]=r.buf[n]}function writePackedVarint(t,e){for(var r=0;r<t.length;r++)e.writeVarint(t[r])}function writePackedSVarint(t,e){for(var r=0;r<t.length;r++)e.writeSVarint(t[r])}function writePackedFloat(t,e){for(var r=0;r<t.length;r++)e.writeFloat(t[r])}function writePackedDouble(t,e){for(var r=0;r<t.length;r++)e.writeDouble(t[r])}function writePackedBoolean(t,e){for(var r=0;r<t.length;r++)e.writeBoolean(t[r])}function writePackedFixed32(t,e){for(var r=0;r<t.length;r++)e.writeFixed32(t[r])}function writePackedSFixed32(t,e){for(var r=0;r<t.length;r++)e.writeSFixed32(t[r])}function writePackedFixed64(t,e){for(var r=0;r<t.length;r++)e.writeFixed64(t[r])}function writePackedSFixed64(t,e){for(var r=0;r<t.length;r++)e.writeSFixed64(t[r])}function readUInt32(t,e){return(t[e]|t[e+1]<<8|t[e+2]<<16)+16777216*t[e+3]}function writeInt32(t,e,r){t[r]=e,t[r+1]=e>>>8,t[r+2]=e>>>16,t[r+3]=e>>>24}function readInt32(t,e){return(t[e]|t[e+1]<<8|t[e+2]<<16)+(t[e+3]<<24)}function readUtf8(t,e,r){for(var i="",n=e;n<r;){var o,a,s,l=t[n],u=null,c=l>239?4:l>223?3:l>191?2:1;if(n+c>r)break;1===c?l<128&&(u=l):2===c?128==(192&(o=t[n+1]))&&(u=(31&l)<<6|63&o)<=127&&(u=null):3===c?(o=t[n+1],a=t[n+2],128==(192&o)&&128==(192&a)&&((u=(15&l)<<12|(63&o)<<6|63&a)<=2047||u>=55296&&u<=57343)&&(u=null)):4===c&&(o=t[n+1],a=t[n+2],s=t[n+3],128==(192&o)&&128==(192&a)&&128==(192&s)&&((u=(15&l)<<18|(63&o)<<12|(63&a)<<6|63&s)<=65535||u>=1114112)&&(u=null)),null===u?(u=65533,c=1):u>65535&&(u-=65536,i+=String.fromCharCode(u>>>10&1023|55296),u=56320|1023&u),i+=String.fromCharCode(u),n+=c}return i}function writeUtf8(t,e,r){for(var i,n,o=0;o<e.length;o++){if((i=e.charCodeAt(o))>55295&&i<57344){if(!n){i>56319||o+1===e.length?(t[r++]=239,t[r++]=191,t[r++]=189):n=i;continue}if(i<56320){t[r++]=239,t[r++]=191,t[r++]=189,n=i;continue}i=n-55296<<10|i-56320|65536,n=null}else n&&(t[r++]=239,t[r++]=191,t[r++]=189,n=null);i<128?t[r++]=i:(i<2048?t[r++]=i>>6|192:(i<65536?t[r++]=i>>12|224:(t[r++]=i>>18|240,t[r++]=i>>12&63|128),t[r++]=i>>6&63|128),t[r++]=63&i|128)}return r}Pbf.prototype={destroy:function(){this.buf=null},readFields:function(t,e,r){for(r=r||this.length;this.pos<r;){var i=this.readVarint(),n=i>>3,o=this.pos;this.type=7&i,t(n,e,this),this.pos===o&&this.skip(i)}return e},readMessage:function(t,e){return this.readFields(t,e,this.readVarint()+this.pos)},readFixed32:function(){var t=readUInt32(this.buf,this.pos);return this.pos+=4,t},readSFixed32:function(){var t=readInt32(this.buf,this.pos);return this.pos+=4,t},readFixed64:function(){var t=readUInt32(this.buf,this.pos)+readUInt32(this.buf,this.pos+4)*SHIFT_LEFT_32;return this.pos+=8,t},readSFixed64:function(){var t=readUInt32(this.buf,this.pos)+readInt32(this.buf,this.pos+4)*SHIFT_LEFT_32;return this.pos+=8,t},readFloat:function(){var t=ieee754.read(this.buf,this.pos,!0,23,4);return this.pos+=4,t},readDouble:function(){var t=ieee754.read(this.buf,this.pos,!0,52,8);return this.pos+=8,t},readVarint:function(t){var e,r,i=this.buf;return e=127&(r=i[this.pos++]),r<128?e:(e|=(127&(r=i[this.pos++]))<<7,r<128?e:(e|=(127&(r=i[this.pos++]))<<14,r<128?e:(e|=(127&(r=i[this.pos++]))<<21,r<128?e:readVarintRemainder(e|=(15&(r=i[this.pos]))<<28,t,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var t=this.readVarint();return t%2==1?(t+1)/-2:t/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var t=this.readVarint()+this.pos,e=readUtf8(this.buf,this.pos,t);return this.pos=t,e},readBytes:function(){var t=this.readVarint()+this.pos,e=this.buf.subarray(this.pos,t);return this.pos=t,e},readPackedVarint:function(t,e){var r=readPackedEnd(this);for(t=t||[];this.pos<r;)t.push(this.readVarint(e));return t},readPackedSVarint:function(t){var e=readPackedEnd(this);for(t=t||[];this.pos<e;)t.push(this.readSVarint());return t},readPackedBoolean:function(t){var e=readPackedEnd(this);for(t=t||[];this.pos<e;)t.push(this.readBoolean());return t},readPackedFloat:function(t){var e=readPackedEnd(this);for(t=t||[];this.pos<e;)t.push(this.readFloat());return t},readPackedDouble:function(t){var e=readPackedEnd(this);for(t=t||[];this.pos<e;)t.push(this.readDouble());return t},readPackedFixed32:function(t){var e=readPackedEnd(this);for(t=t||[];this.pos<e;)t.push(this.readFixed32());return t},readPackedSFixed32:function(t){var e=readPackedEnd(this);for(t=t||[];this.pos<e;)t.push(this.readSFixed32());return t},readPackedFixed64:function(t){var e=readPackedEnd(this);for(t=t||[];this.pos<e;)t.push(this.readFixed64());return t},readPackedSFixed64:function(t){var e=readPackedEnd(this);for(t=t||[];this.pos<e;)t.push(this.readSFixed64());return t},skip:function(t){var e=7&t;if(e===Pbf.Varint)for(;this.buf[this.pos++]>127;);else if(e===Pbf.Bytes)this.pos=this.readVarint()+this.pos;else if(e===Pbf.Fixed32)this.pos+=4;else{if(e!==Pbf.Fixed64)throw new Error("Unimplemented type: "+e);this.pos+=8}},writeTag:function(t,e){this.writeVarint(t<<3|e)},realloc:function(t){for(var e=this.length||16;e<this.pos+t;)e*=2;if(e!==this.length){var r=new Uint8Array(e);r.set(this.buf),this.buf=r,this.length=e}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(t){this.realloc(4),writeInt32(this.buf,t,this.pos),this.pos+=4},writeSFixed32:function(t){this.realloc(4),writeInt32(this.buf,t,this.pos),this.pos+=4},writeFixed64:function(t){this.realloc(8),writeInt32(this.buf,-1&t,this.pos),writeInt32(this.buf,Math.floor(t*SHIFT_RIGHT_32),this.pos+4),this.pos+=8},writeSFixed64:function(t){this.realloc(8),writeInt32(this.buf,-1&t,this.pos),writeInt32(this.buf,Math.floor(t*SHIFT_RIGHT_32),this.pos+4),this.pos+=8},writeVarint:function(t){(t=+t||0)>268435455||t<0?writeBigVarint(t,this):(this.realloc(4),this.buf[this.pos++]=127&t|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=t>>>7&127))))},writeSVarint:function(t){this.writeVarint(t<0?2*-t-1:2*t)},writeBoolean:function(t){this.writeVarint(Boolean(t))},writeString:function(t){t=String(t),this.realloc(4*t.length),this.pos++;var e=this.pos;this.pos=writeUtf8(this.buf,t,this.pos);var r=this.pos-e;r>=128&&makeRoomForExtraLength(e,r,this),this.pos=e-1,this.writeVarint(r),this.pos+=r},writeFloat:function(t){this.realloc(4),ieee754.write(this.buf,t,this.pos,!0,23,4),this.pos+=4},writeDouble:function(t){this.realloc(8),ieee754.write(this.buf,t,this.pos,!0,52,8),this.pos+=8},writeBytes:function(t){var e=t.length;this.writeVarint(e),this.realloc(e);for(var r=0;r<e;r++)this.buf[this.pos++]=t[r]},writeRawMessage:function(t,e){this.pos++;var r=this.pos;t(e,this);var i=this.pos-r;i>=128&&makeRoomForExtraLength(r,i,this),this.pos=r-1,this.writeVarint(i),this.pos+=i},writeMessage:function(t,e,r){this.writeTag(t,Pbf.Bytes),this.writeRawMessage(e,r)},writePackedVarint:function(t,e){this.writeMessage(t,writePackedVarint,e)},writePackedSVarint:function(t,e){this.writeMessage(t,writePackedSVarint,e)},writePackedBoolean:function(t,e){this.writeMessage(t,writePackedBoolean,e)},writePackedFloat:function(t,e){this.writeMessage(t,writePackedFloat,e)},writePackedDouble:function(t,e){this.writeMessage(t,writePackedDouble,e)},writePackedFixed32:function(t,e){this.writeMessage(t,writePackedFixed32,e)},writePackedSFixed32:function(t,e){this.writeMessage(t,writePackedSFixed32,e)},writePackedFixed64:function(t,e){this.writeMessage(t,writePackedFixed64,e)},writePackedSFixed64:function(t,e){this.writeMessage(t,writePackedSFixed64,e)},writeBytesField:function(t,e){this.writeTag(t,Pbf.Bytes),this.writeBytes(e)},writeFixed32Field:function(t,e){this.writeTag(t,Pbf.Fixed32),this.writeFixed32(e)},writeSFixed32Field:function(t,e){this.writeTag(t,Pbf.Fixed32),this.writeSFixed32(e)},writeFixed64Field:function(t,e){this.writeTag(t,Pbf.Fixed64),this.writeFixed64(e)},writeSFixed64Field:function(t,e){this.writeTag(t,Pbf.Fixed64),this.writeSFixed64(e)},writeVarintField:function(t,e){this.writeTag(t,Pbf.Varint),this.writeVarint(e)},writeSVarintField:function(t,e){this.writeTag(t,Pbf.Varint),this.writeSVarint(e)},writeStringField:function(t,e){this.writeTag(t,Pbf.Bytes),this.writeString(e)},writeFloatField:function(t,e){this.writeTag(t,Pbf.Fixed32),this.writeFloat(e)},writeDoubleField:function(t,e){this.writeTag(t,Pbf.Fixed64),this.writeDouble(e)},writeBooleanField:function(t,e){this.writeVarintField(t,Boolean(e))}};var Pbf$1=getDefaultExportFromCjs(pbf),pointGeometry=Point$1;function Point$1(t,e){this.x=t,this.y=e}Point$1.prototype={clone:function(){return new Point$1(this.x,this.y)},add:function(t){return this.clone()._add(t)},sub:function(t){return this.clone()._sub(t)},multByPoint:function(t){return this.clone()._multByPoint(t)},divByPoint:function(t){return this.clone()._divByPoint(t)},mult:function(t){return this.clone()._mult(t)},div:function(t){return this.clone()._div(t)},rotate:function(t){return this.clone()._rotate(t)},rotateAround:function(t,e){return this.clone()._rotateAround(t,e)},matMult:function(t){return this.clone()._matMult(t)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(t){return this.x===t.x&&this.y===t.y},dist:function(t){return Math.sqrt(this.distSqr(t))},distSqr:function(t){var e=t.x-this.x,r=t.y-this.y;return e*e+r*r},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(t){return Math.atan2(this.y-t.y,this.x-t.x)},angleWith:function(t){return this.angleWithSep(t.x,t.y)},angleWithSep:function(t,e){return Math.atan2(this.x*e-this.y*t,this.x*t+this.y*e)},_matMult:function(t){var e=t[0]*this.x+t[1]*this.y,r=t[2]*this.x+t[3]*this.y;return this.x=e,this.y=r,this},_add:function(t){return this.x+=t.x,this.y+=t.y,this},_sub:function(t){return this.x-=t.x,this.y-=t.y,this},_mult:function(t){return this.x*=t,this.y*=t,this},_div:function(t){return this.x/=t,this.y/=t,this},_multByPoint:function(t){return this.x*=t.x,this.y*=t.y,this},_divByPoint:function(t){return this.x/=t.x,this.y/=t.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var t=this.y;return this.y=this.x,this.x=-t,this},_rotate:function(t){var e=Math.cos(t),r=Math.sin(t),i=e*this.x-r*this.y,n=r*this.x+e*this.y;return this.x=i,this.y=n,this},_rotateAround:function(t,e){var r=Math.cos(t),i=Math.sin(t),n=e.x+r*(this.x-e.x)-i*(this.y-e.y),o=e.y+i*(this.x-e.x)+r*(this.y-e.y);return this.x=n,this.y=o,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},Point$1.convert=function(t){return t instanceof Point$1?t:Array.isArray(t)?new Point$1(t[0],t[1]):t};var Point=pointGeometry,vectortilefeature=VectorTileFeature$2;function VectorTileFeature$2(t,e,r,i,n){this.properties={},this.extent=r,this.type=0,this._pbf=t,this._geometry=-1,this._keys=i,this._values=n,t.readFields(readFeature,this,e)}function readFeature(t,e,r){1==t?e.id=r.readVarint():2==t?readTag(r,e):3==t?e.type=r.readVarint():4==t&&(e._geometry=r.pos)}function readTag(t,e){for(var r=t.readVarint()+t.pos;t.pos<r;){var i=e._keys[t.readVarint()],n=e._values[t.readVarint()];e.properties[i]=n}}function classifyRings(t){var e=t.length;if(e<=1)return[t];for(var r,i,n=[],o=0;o<e;o++){var a=signedArea$1(t[o]);0!==a&&(void 0===i&&(i=a<0),i===a<0?(r&&n.push(r),r=[t[o]]):r.push(t[o]))}return r&&n.push(r),n}function signedArea$1(t){for(var e,r,i=0,n=0,o=t.length,a=o-1;n<o;a=n++)e=t[n],i+=((r=t[a]).x-e.x)*(e.y+r.y);return i}VectorTileFeature$2.types=["Unknown","Point","LineString","Polygon"],VectorTileFeature$2.prototype.loadGeometry=function(){var t=this._pbf;t.pos=this._geometry;for(var e,r=t.readVarint()+t.pos,i=1,n=0,o=0,a=0,s=[];t.pos<r;){if(!n){var l=t.readVarint();i=7&l,n=l>>3}if(n--,1===i||2===i)o+=t.readSVarint(),a+=t.readSVarint(),1===i&&(e&&s.push(e),e=[]),e.push(new Point(o,a));else{if(7!==i)throw new Error("unknown command "+i);e&&e.push(e[0].clone())}}return e&&s.push(e),s},VectorTileFeature$2.prototype.bbox=function(){var t=this._pbf;t.pos=this._geometry;for(var e=t.readVarint()+t.pos,r=1,i=0,n=0,o=0,a=1/0,s=-1/0,l=1/0,u=-1/0;t.pos<e;){if(!i){var c=t.readVarint();r=7&c,i=c>>3}if(i--,1===r||2===r)(n+=t.readSVarint())<a&&(a=n),n>s&&(s=n),(o+=t.readSVarint())<l&&(l=o),o>u&&(u=o);else if(7!==r)throw new Error("unknown command "+r)}return[a,l,s,u]},VectorTileFeature$2.prototype.toGeoJSON=function(t,e,r){var i,n,o=this.extent*Math.pow(2,r),a=this.extent*t,s=this.extent*e,l=this.loadGeometry(),u=VectorTileFeature$2.types[this.type];function c(t){for(var e=0;e<t.length;e++){var r=t[e],i=180-360*(r.y+s)/o;t[e]=[360*(r.x+a)/o-180,360/Math.PI*Math.atan(Math.exp(i*Math.PI/180))-90]}}switch(this.type){case 1:var h=[];for(i=0;i<l.length;i++)h[i]=l[i][0];c(l=h);break;case 2:for(i=0;i<l.length;i++)c(l[i]);break;case 3:for(l=classifyRings(l),i=0;i<l.length;i++)for(n=0;n<l[i].length;n++)c(l[i][n])}1===l.length?l=l[0]:u="Multi"+u;var p={type:"Feature",geometry:{type:u,coordinates:l},properties:this.properties};return"id"in this&&(p.id=this.id),p};var VectorTileFeature$1=vectortilefeature;function VectorTileLayer$1(t,e){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=t,this._keys=[],this._values=[],this._features=[],t.readFields(readLayer$1,this,e),this.length=this._features.length}function readLayer$1(t,e,r){15===t?e.version=r.readVarint():1===t?e.name=r.readString():5===t?e.extent=r.readVarint():2===t?e._features.push(r.pos):3===t?e._keys.push(r.readString()):4===t&&e._values.push(readValueMessage$1(r))}function readValueMessage$1(t){for(var e=null,r=t.readVarint()+t.pos;t.pos<r;){var i=t.readVarint()>>3;e=1===i?t.readString():2===i?t.readFloat():3===i?t.readDouble():4===i?t.readVarint64():5===i?t.readVarint():6===i?t.readSVarint():7===i?t.readBoolean():null}return e}VectorTileLayer$1.prototype.feature=function(t){if(t<0||t>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[t];var e=this._pbf.readVarint()+this._pbf.pos;return new VectorTileFeature$1(this._pbf,e,this.extent,this._keys,this._values)};var VectorTileFeature=vectortilefeature,long=Long,wasm=null;try{wasm=new WebAssembly.Instance(new WebAssembly.Module(new Uint8Array([0,97,115,109,1,0,0,0,1,13,2,96,0,1,127,96,4,127,127,127,127,1,127,3,7,6,0,1,1,1,1,1,6,6,1,127,1,65,0,11,7,50,6,3,109,117,108,0,1,5,100,105,118,95,115,0,2,5,100,105,118,95,117,0,3,5,114,101,109,95,115,0,4,5,114,101,109,95,117,0,5,8,103,101,116,95,104,105,103,104,0,0,10,191,1,6,4,0,35,0,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,126,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,127,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,128,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,129,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,130,34,4,66,32,135,167,36,0,32,4,167,11])),{}).exports}catch(e){}function Long(t,e,r){this.low=0|t,this.high=0|e,this.unsigned=!!r}function isLong(t){return!0===(t&&t.__isLong__)}Long.prototype.__isLong__,Object.defineProperty(Long.prototype,"__isLong__",{value:!0}),Long.isLong=isLong;var INT_CACHE={},UINT_CACHE={};function fromInt(t,e){var r,i,n;return e?(n=0<=(t>>>=0)&&t<256)&&(i=UINT_CACHE[t])?i:(r=fromBits(t,(0|t)<0?-1:0,!0),n&&(UINT_CACHE[t]=r),r):(n=-128<=(t|=0)&&t<128)&&(i=INT_CACHE[t])?i:(r=fromBits(t,t<0?-1:0,!1),n&&(INT_CACHE[t]=r),r)}function fromNumber(t,e){if(isNaN(t))return e?UZERO:ZERO;if(e){if(t<0)return UZERO;if(t>=TWO_PWR_64_DBL)return MAX_UNSIGNED_VALUE}else{if(t<=-TWO_PWR_63_DBL)return MIN_VALUE;if(t+1>=TWO_PWR_63_DBL)return MAX_VALUE$1}return t<0?fromNumber(-t,e).neg():fromBits(t%TWO_PWR_32_DBL|0,t/TWO_PWR_32_DBL|0,e)}function fromBits(t,e,r){return new Long(t,e,r)}Long.fromInt=fromInt,Long.fromNumber=fromNumber,Long.fromBits=fromBits;var pow_dbl=Math.pow;function fromString$1(t,e,r){if(0===t.length)throw Error("empty string");if("NaN"===t||"Infinity"===t||"+Infinity"===t||"-Infinity"===t)return ZERO;if("number"==typeof e?(r=e,e=!1):e=!!e,(r=r||10)<2||36<r)throw RangeError("radix");var i;if((i=t.indexOf("-"))>0)throw Error("interior hyphen");if(0===i)return fromString$1(t.substring(1),e,r).neg();for(var n=fromNumber(pow_dbl(r,8)),o=ZERO,a=0;a<t.length;a+=8){var s=Math.min(8,t.length-a),l=parseInt(t.substring(a,a+s),r);if(s<8){var u=fromNumber(pow_dbl(r,s));o=o.mul(u).add(fromNumber(l))}else o=(o=o.mul(n)).add(fromNumber(l))}return o.unsigned=e,o}function fromValue(t,e){return"number"==typeof t?fromNumber(t,e):"string"==typeof t?fromString$1(t,e):fromBits(t.low,t.high,"boolean"==typeof e?e:t.unsigned)}Long.fromString=fromString$1,Long.fromValue=fromValue;var TWO_PWR_16_DBL=65536,TWO_PWR_24_DBL=1<<24,TWO_PWR_32_DBL=TWO_PWR_16_DBL*TWO_PWR_16_DBL,TWO_PWR_64_DBL=TWO_PWR_32_DBL*TWO_PWR_32_DBL,TWO_PWR_63_DBL=TWO_PWR_64_DBL/2,TWO_PWR_24=fromInt(TWO_PWR_24_DBL),ZERO=fromInt(0);Long.ZERO=ZERO;var UZERO=fromInt(0,!0);Long.UZERO=UZERO;var ONE=fromInt(1);Long.ONE=ONE;var UONE=fromInt(1,!0);Long.UONE=UONE;var NEG_ONE=fromInt(-1);Long.NEG_ONE=NEG_ONE;var MAX_VALUE$1=fromBits(-1,2147483647,!1);Long.MAX_VALUE=MAX_VALUE$1;var MAX_UNSIGNED_VALUE=fromBits(-1,-1,!0);Long.MAX_UNSIGNED_VALUE=MAX_UNSIGNED_VALUE;var MIN_VALUE=fromBits(0,-2147483648,!1);Long.MIN_VALUE=MIN_VALUE;var LongPrototype=Long.prototype;LongPrototype.toInt=function(){return this.unsigned?this.low>>>0:this.low},LongPrototype.toNumber=function(){return this.unsigned?(this.high>>>0)*TWO_PWR_32_DBL+(this.low>>>0):this.high*TWO_PWR_32_DBL+(this.low>>>0)},LongPrototype.toString=function(t){if((t=t||10)<2||36<t)throw RangeError("radix");if(this.isZero())return"0";if(this.isNegative()){if(this.eq(MIN_VALUE)){var e=fromNumber(t),r=this.div(e),i=r.mul(e).sub(this);return r.toString(t)+i.toInt().toString(t)}return"-"+this.neg().toString(t)}for(var n=fromNumber(pow_dbl(t,6),this.unsigned),o=this,a="";;){var s=o.div(n),l=(o.sub(s.mul(n)).toInt()>>>0).toString(t);if((o=s).isZero())return l+a;for(;l.length<6;)l="0"+l;a=""+l+a}},LongPrototype.getHighBits=function(){return this.high},LongPrototype.getHighBitsUnsigned=function(){return this.high>>>0},LongPrototype.getLowBits=function(){return this.low},LongPrototype.getLowBitsUnsigned=function(){return this.low>>>0},LongPrototype.getNumBitsAbs=function(){if(this.isNegative())return this.eq(MIN_VALUE)?64:this.neg().getNumBitsAbs();for(var t=0!=this.high?this.high:this.low,e=31;e>0&&!(t&1<<e);e--);return 0!=this.high?e+33:e+1},LongPrototype.isZero=function(){return 0===this.high&&0===this.low},LongPrototype.eqz=LongPrototype.isZero,LongPrototype.isNegative=function(){return!this.unsigned&&this.high<0},LongPrototype.isPositive=function(){return this.unsigned||this.high>=0},LongPrototype.isOdd=function(){return!(1&~this.low)},LongPrototype.isEven=function(){return!(1&this.low)},LongPrototype.equals=function(t){return isLong(t)||(t=fromValue(t)),(this.unsigned===t.unsigned||this.high>>>31!=1||t.high>>>31!=1)&&this.high===t.high&&this.low===t.low},LongPrototype.eq=LongPrototype.equals,LongPrototype.notEquals=function(t){return!this.eq(t)},LongPrototype.neq=LongPrototype.notEquals,LongPrototype.ne=LongPrototype.notEquals,LongPrototype.lessThan=function(t){return this.comp(t)<0},LongPrototype.lt=LongPrototype.lessThan,LongPrototype.lessThanOrEqual=function(t){return this.comp(t)<=0},LongPrototype.lte=LongPrototype.lessThanOrEqual,LongPrototype.le=LongPrototype.lessThanOrEqual,LongPrototype.greaterThan=function(t){return this.comp(t)>0},LongPrototype.gt=LongPrototype.greaterThan,LongPrototype.greaterThanOrEqual=function(t){return this.comp(t)>=0},LongPrototype.gte=LongPrototype.greaterThanOrEqual,LongPrototype.ge=LongPrototype.greaterThanOrEqual,LongPrototype.compare=function(t){if(isLong(t)||(t=fromValue(t)),this.eq(t))return 0;var e=this.isNegative(),r=t.isNegative();return e&&!r?-1:!e&&r?1:this.unsigned?t.high>>>0>this.high>>>0||t.high===this.high&&t.low>>>0>this.low>>>0?-1:1:this.sub(t).isNegative()?-1:1},LongPrototype.comp=LongPrototype.compare,LongPrototype.negate=function(){return!this.unsigned&&this.eq(MIN_VALUE)?MIN_VALUE:this.not().add(ONE)},LongPrototype.neg=LongPrototype.negate,LongPrototype.add=function(t){isLong(t)||(t=fromValue(t));var e=this.high>>>16,r=65535&this.high,i=this.low>>>16,n=65535&this.low,o=t.high>>>16,a=65535&t.high,s=t.low>>>16,l=0,u=0,c=0,h=0;return c+=(h+=n+(65535&t.low))>>>16,u+=(c+=i+s)>>>16,l+=(u+=r+a)>>>16,l+=e+o,fromBits((c&=65535)<<16|(h&=65535),(l&=65535)<<16|(u&=65535),this.unsigned)},LongPrototype.subtract=function(t){return isLong(t)||(t=fromValue(t)),this.add(t.neg())},LongPrototype.sub=LongPrototype.subtract,LongPrototype.multiply=function(t){if(this.isZero())return ZERO;if(isLong(t)||(t=fromValue(t)),wasm)return fromBits(wasm.mul(this.low,this.high,t.low,t.high),wasm.get_high(),this.unsigned);if(t.isZero())return ZERO;if(this.eq(MIN_VALUE))return t.isOdd()?MIN_VALUE:ZERO;if(t.eq(MIN_VALUE))return this.isOdd()?MIN_VALUE:ZERO;if(this.isNegative())return t.isNegative()?this.neg().mul(t.neg()):this.neg().mul(t).neg();if(t.isNegative())return this.mul(t.neg()).neg();if(this.lt(TWO_PWR_24)&&t.lt(TWO_PWR_24))return fromNumber(this.toNumber()*t.toNumber(),this.unsigned);var e=this.high>>>16,r=65535&this.high,i=this.low>>>16,n=65535&this.low,o=t.high>>>16,a=65535&t.high,s=t.low>>>16,l=65535&t.low,u=0,c=0,h=0,p=0;return h+=(p+=n*l)>>>16,c+=(h+=i*l)>>>16,h&=65535,c+=(h+=n*s)>>>16,u+=(c+=r*l)>>>16,c&=65535,u+=(c+=i*s)>>>16,c&=65535,u+=(c+=n*a)>>>16,u+=e*l+r*s+i*a+n*o,fromBits((h&=65535)<<16|(p&=65535),(u&=65535)<<16|(c&=65535),this.unsigned)},LongPrototype.mul=LongPrototype.multiply,LongPrototype.divide=function(t){if(isLong(t)||(t=fromValue(t)),t.isZero())throw Error("division by zero");var e,r,i;if(wasm)return this.unsigned||-2147483648!==this.high||-1!==t.low||-1!==t.high?fromBits((this.unsigned?wasm.div_u:wasm.div_s)(this.low,this.high,t.low,t.high),wasm.get_high(),this.unsigned):this;if(this.isZero())return this.unsigned?UZERO:ZERO;if(this.unsigned){if(t.unsigned||(t=t.toUnsigned()),t.gt(this))return UZERO;if(t.gt(this.shru(1)))return UONE;i=UZERO}else{if(this.eq(MIN_VALUE))return t.eq(ONE)||t.eq(NEG_ONE)?MIN_VALUE:t.eq(MIN_VALUE)?ONE:(e=this.shr(1).div(t).shl(1)).eq(ZERO)?t.isNegative()?ONE:NEG_ONE:(r=this.sub(t.mul(e)),i=e.add(r.div(t)));if(t.eq(MIN_VALUE))return this.unsigned?UZERO:ZERO;if(this.isNegative())return t.isNegative()?this.neg().div(t.neg()):this.neg().div(t).neg();if(t.isNegative())return this.div(t.neg()).neg();i=ZERO}for(r=this;r.gte(t);){e=Math.max(1,Math.floor(r.toNumber()/t.toNumber()));for(var n=Math.ceil(Math.log(e)/Math.LN2),o=n<=48?1:pow_dbl(2,n-48),a=fromNumber(e),s=a.mul(t);s.isNegative()||s.gt(r);)s=(a=fromNumber(e-=o,this.unsigned)).mul(t);a.isZero()&&(a=ONE),i=i.add(a),r=r.sub(s)}return i},LongPrototype.div=LongPrototype.divide,LongPrototype.modulo=function(t){return isLong(t)||(t=fromValue(t)),wasm?fromBits((this.unsigned?wasm.rem_u:wasm.rem_s)(this.low,this.high,t.low,t.high),wasm.get_high(),this.unsigned):this.sub(this.div(t).mul(t))},LongPrototype.mod=LongPrototype.modulo,LongPrototype.rem=LongPrototype.modulo,LongPrototype.not=function(){return fromBits(~this.low,~this.high,this.unsigned)},LongPrototype.and=function(t){return isLong(t)||(t=fromValue(t)),fromBits(this.low&t.low,this.high&t.high,this.unsigned)},LongPrototype.or=function(t){return isLong(t)||(t=fromValue(t)),fromBits(this.low|t.low,this.high|t.high,this.unsigned)},LongPrototype.xor=function(t){return isLong(t)||(t=fromValue(t)),fromBits(this.low^t.low,this.high^t.high,this.unsigned)},LongPrototype.shiftLeft=function(t){return isLong(t)&&(t=t.toInt()),0==(t&=63)?this:t<32?fromBits(this.low<<t,this.high<<t|this.low>>>32-t,this.unsigned):fromBits(0,this.low<<t-32,this.unsigned)},LongPrototype.shl=LongPrototype.shiftLeft,LongPrototype.shiftRight=function(t){return isLong(t)&&(t=t.toInt()),0==(t&=63)?this:t<32?fromBits(this.low>>>t|this.high<<32-t,this.high>>t,this.unsigned):fromBits(this.high>>t-32,this.high>=0?0:-1,this.unsigned)},LongPrototype.shr=LongPrototype.shiftRight,LongPrototype.shiftRightUnsigned=function(t){if(isLong(t)&&(t=t.toInt()),0==(t&=63))return this;var e=this.high;return t<32?fromBits(this.low>>>t|e<<32-t,e>>>t,this.unsigned):fromBits(32===t?e:e>>>t-32,0,this.unsigned)},LongPrototype.shru=LongPrototype.shiftRightUnsigned,LongPrototype.shr_u=LongPrototype.shiftRightUnsigned,LongPrototype.toSigned=function(){return this.unsigned?fromBits(this.low,this.high,!1):this},LongPrototype.toUnsigned=function(){return this.unsigned?this:fromBits(this.low,this.high,!0)},LongPrototype.toBytes=function(t){return t?this.toBytesLE():this.toBytesBE()},LongPrototype.toBytesLE=function(){var t=this.high,e=this.low;return[255&e,e>>>8&255,e>>>16&255,e>>>24,255&t,t>>>8&255,t>>>16&255,t>>>24]},LongPrototype.toBytesBE=function(){var t=this.high,e=this.low;return[t>>>24,t>>>16&255,t>>>8&255,255&t,e>>>24,e>>>16&255,e>>>8&255,255&e]},Long.fromBytes=function(t,e,r){return r?Long.fromBytesLE(t,e):Long.fromBytesBE(t,e)},Long.fromBytesLE=function(t,e){return new Long(t[0]|t[1]<<8|t[2]<<16|t[3]<<24,t[4]|t[5]<<8|t[6]<<16|t[7]<<24,e)},Long.fromBytesBE=function(t,e){return new Long(t[4]<<24|t[5]<<16|t[6]<<8|t[7],t[0]<<24|t[1]<<16|t[2]<<8|t[3],e)};var Long$1=getDefaultExportFromCjs(long),indexMinimal={},minimal$1={},aspromise,hasRequiredAspromise;function requireAspromise(){return hasRequiredAspromise||(hasRequiredAspromise=1,aspromise=function(t,e){for(var r=new Array(arguments.length-1),i=0,n=2,o=!0;n<arguments.length;)r[i++]=arguments[n++];return new Promise((function(n,a){r[i]=function(t){if(o)if(o=!1,t)a(t);else{for(var e=new Array(arguments.length-1),r=0;r<e.length;)e[r++]=arguments[r];n.apply(null,e)}};try{t.apply(e||null,r)}catch(t){o&&(o=!1,a(t))}}))}),aspromise}var base64$1={},hasRequiredBase64,eventemitter,hasRequiredEventemitter,float$1,hasRequiredFloat,inquire_1,hasRequiredInquire;function requireBase64(){return hasRequiredBase64||(hasRequiredBase64=1,function(t){var e=t;e.length=function(t){var e=t.length;if(!e)return 0;for(var r=0;--e%4>1&&"="===t.charAt(e);)++r;return Math.ceil(3*t.length)/4-r};for(var r=new Array(64),i=new Array(123),n=0;n<64;)i[r[n]=n<26?n+65:n<52?n+71:n<62?n-4:n-59|43]=n++;e.encode=function(t,e,i){for(var n,o=null,a=[],s=0,l=0;e<i;){var u=t[e++];switch(l){case 0:a[s++]=r[u>>2],n=(3&u)<<4,l=1;break;case 1:a[s++]=r[n|u>>4],n=(15&u)<<2,l=2;break;case 2:a[s++]=r[n|u>>6],a[s++]=r[63&u],l=0}s>8191&&((o||(o=[])).push(String.fromCharCode.apply(String,a)),s=0)}return l&&(a[s++]=r[n],a[s++]=61,1===l&&(a[s++]=61)),o?(s&&o.push(String.fromCharCode.apply(String,a.slice(0,s))),o.join("")):String.fromCharCode.apply(String,a.slice(0,s))};var o="invalid encoding";e.decode=function(t,e,r){for(var n,a=r,s=0,l=0;l<t.length;){var u=t.charCodeAt(l++);if(61===u&&s>1)break;if(void 0===(u=i[u]))throw Error(o);switch(s){case 0:n=u,s=1;break;case 1:e[r++]=n<<2|(48&u)>>4,n=u,s=2;break;case 2:e[r++]=(15&n)<<4|(60&u)>>2,n=u,s=3;break;case 3:e[r++]=(3&n)<<6|u,s=0}}if(1===s)throw Error(o);return r-a},e.test=function(t){return/^(?:[A-Za-z0-9+/]{4})*(?:[A-Za-z0-9+/]{2}==|[A-Za-z0-9+/]{3}=)?$/.test(t)}}(base64$1)),base64$1}function requireEventemitter(){if(hasRequiredEventemitter)return eventemitter;function t(){this._listeners={}}return hasRequiredEventemitter=1,eventemitter=t,t.prototype.on=function(t,e,r){return(this._listeners[t]||(this._listeners[t]=[])).push({fn:e,ctx:r||this}),this},t.prototype.off=function(t,e){if(void 0===t)this._listeners={};else if(void 0===e)this._listeners[t]=[];else for(var r=this._listeners[t],i=0;i<r.length;)r[i].fn===e?r.splice(i,1):++i;return this},t.prototype.emit=function(t){var e=this._listeners[t];if(e){for(var r=[],i=1;i<arguments.length;)r.push(arguments[i++]);for(i=0;i<e.length;)e[i].fn.apply(e[i++].ctx,r)}return this},eventemitter}function requireFloat(){if(hasRequiredFloat)return float$1;function t(t){return"undefined"!=typeof Float32Array?function(){var e=new Float32Array([-0]),r=new Uint8Array(e.buffer),i=128===r[3];function n(t,i,n){e[0]=t,i[n]=r[0],i[n+1]=r[1],i[n+2]=r[2],i[n+3]=r[3]}function o(t,i,n){e[0]=t,i[n]=r[3],i[n+1]=r[2],i[n+2]=r[1],i[n+3]=r[0]}function a(t,i){return r[0]=t[i],r[1]=t[i+1],r[2]=t[i+2],r[3]=t[i+3],e[0]}function s(t,i){return r[3]=t[i],r[2]=t[i+1],r[1]=t[i+2],r[0]=t[i+3],e[0]}t.writeFloatLE=i?n:o,t.writeFloatBE=i?o:n,t.readFloatLE=i?a:s,t.readFloatBE=i?s:a}():function(){function o(t,e,r,i){var n=e<0?1:0;if(n&&(e=-e),0===e)t(1/e>0?0:2147483648,r,i);else if(isNaN(e))t(2143289344,r,i);else if(e>34028234663852886e22)t((n<<31|2139095040)>>>0,r,i);else if(e<11754943508222875e-54)t((n<<31|Math.round(e/1401298464324817e-60))>>>0,r,i);else{var o=Math.floor(Math.log(e)/Math.LN2);t((n<<31|o+127<<23|8388607&Math.round(e*Math.pow(2,-o)*8388608))>>>0,r,i)}}function a(t,e,r){var i=t(e,r),n=2*(i>>31)+1,o=i>>>23&255,a=8388607&i;return 255===o?a?NaN:n*(1/0):0===o?1401298464324817e-60*n*a:n*Math.pow(2,o-150)*(a+8388608)}t.writeFloatLE=o.bind(null,e),t.writeFloatBE=o.bind(null,r),t.readFloatLE=a.bind(null,i),t.readFloatBE=a.bind(null,n)}(),"undefined"!=typeof Float64Array?function(){var e=new Float64Array([-0]),r=new Uint8Array(e.buffer),i=128===r[7];function n(t,i,n){e[0]=t,i[n]=r[0],i[n+1]=r[1],i[n+2]=r[2],i[n+3]=r[3],i[n+4]=r[4],i[n+5]=r[5],i[n+6]=r[6],i[n+7]=r[7]}function o(t,i,n){e[0]=t,i[n]=r[7],i[n+1]=r[6],i[n+2]=r[5],i[n+3]=r[4],i[n+4]=r[3],i[n+5]=r[2],i[n+6]=r[1],i[n+7]=r[0]}function a(t,i){return r[0]=t[i],r[1]=t[i+1],r[2]=t[i+2],r[3]=t[i+3],r[4]=t[i+4],r[5]=t[i+5],r[6]=t[i+6],r[7]=t[i+7],e[0]}function s(t,i){return r[7]=t[i],r[6]=t[i+1],r[5]=t[i+2],r[4]=t[i+3],r[3]=t[i+4],r[2]=t[i+5],r[1]=t[i+6],r[0]=t[i+7],e[0]}t.writeDoubleLE=i?n:o,t.writeDoubleBE=i?o:n,t.readDoubleLE=i?a:s,t.readDoubleBE=i?s:a}():function(){function o(t,e,r,i,n,o){var a=i<0?1:0;if(a&&(i=-i),0===i)t(0,n,o+e),t(1/i>0?0:2147483648,n,o+r);else if(isNaN(i))t(0,n,o+e),t(2146959360,n,o+r);else if(i>17976931348623157e292)t(0,n,o+e),t((a<<31|2146435072)>>>0,n,o+r);else{var s;if(i<22250738585072014e-324)t((s=i/5e-324)>>>0,n,o+e),t((a<<31|s/4294967296)>>>0,n,o+r);else{var l=Math.floor(Math.log(i)/Math.LN2);1024===l&&(l=1023),t(4503599627370496*(s=i*Math.pow(2,-l))>>>0,n,o+e),t((a<<31|l+1023<<20|1048576*s&1048575)>>>0,n,o+r)}}}function a(t,e,r,i,n){var o=t(i,n+e),a=t(i,n+r),s=2*(a>>31)+1,l=a>>>20&2047,u=4294967296*(1048575&a)+o;return 2047===l?u?NaN:s*(1/0):0===l?5e-324*s*u:s*Math.pow(2,l-1075)*(u+4503599627370496)}t.writeDoubleLE=o.bind(null,e,0,4),t.writeDoubleBE=o.bind(null,r,4,0),t.readDoubleLE=a.bind(null,i,0,4),t.readDoubleBE=a.bind(null,n,4,0)}(),t}function e(t,e,r){e[r]=255&t,e[r+1]=t>>>8&255,e[r+2]=t>>>16&255,e[r+3]=t>>>24}function r(t,e,r){e[r]=t>>>24,e[r+1]=t>>>16&255,e[r+2]=t>>>8&255,e[r+3]=255&t}function i(t,e){return(t[e]|t[e+1]<<8|t[e+2]<<16|t[e+3]<<24)>>>0}function n(t,e){return(t[e]<<24|t[e+1]<<16|t[e+2]<<8|t[e+3])>>>0}return hasRequiredFloat=1,float$1=t(t)}function requireInquire(){if(hasRequiredInquire)return inquire_1;function inquire(moduleName){try{var mod=eval("quire".replace(/^/,"re"))(moduleName);if(mod&&(mod.length||Object.keys(mod).length))return mod}catch(t){}return null}return hasRequiredInquire=1,inquire_1=inquire,inquire_1}var utf8$2={},hasRequiredUtf8,pool_1,hasRequiredPool,longbits,hasRequiredLongbits,hasRequiredMinimal;function requireUtf8(){return hasRequiredUtf8||(hasRequiredUtf8=1,function(t){var e=t;e.length=function(t){for(var e=0,r=0,i=0;i<t.length;++i)(r=t.charCodeAt(i))<128?e+=1:r<2048?e+=2:55296==(64512&r)&&56320==(64512&t.charCodeAt(i+1))?(++i,e+=4):e+=3;return e},e.read=function(t,e,r){if(r-e<1)return"";for(var i,n=null,o=[],a=0;e<r;)(i=t[e++])<128?o[a++]=i:i>191&&i<224?o[a++]=(31&i)<<6|63&t[e++]:i>239&&i<365?(i=((7&i)<<18|(63&t[e++])<<12|(63&t[e++])<<6|63&t[e++])-65536,o[a++]=55296+(i>>10),o[a++]=56320+(1023&i)):o[a++]=(15&i)<<12|(63&t[e++])<<6|63&t[e++],a>8191&&((n||(n=[])).push(String.fromCharCode.apply(String,o)),a=0);return n?(a&&n.push(String.fromCharCode.apply(String,o.slice(0,a))),n.join("")):String.fromCharCode.apply(String,o.slice(0,a))},e.write=function(t,e,r){for(var i,n,o=r,a=0;a<t.length;++a)(i=t.charCodeAt(a))<128?e[r++]=i:i<2048?(e[r++]=i>>6|192,e[r++]=63&i|128):55296==(64512&i)&&56320==(64512&(n=t.charCodeAt(a+1)))?(i=65536+((1023&i)<<10)+(1023&n),++a,e[r++]=i>>18|240,e[r++]=i>>12&63|128,e[r++]=i>>6&63|128,e[r++]=63&i|128):(e[r++]=i>>12|224,e[r++]=i>>6&63|128,e[r++]=63&i|128);return r-o}}(utf8$2)),utf8$2}function requirePool(){return hasRequiredPool||(hasRequiredPool=1,pool_1=function(t,e,r){var i=r||8192,n=i>>>1,o=null,a=i;return function(r){if(r<1||r>n)return t(r);a+r>i&&(o=t(i),a=0);var s=e.call(o,a,a+=r);return 7&a&&(a=1+(7|a)),s}}),pool_1}function requireLongbits(){if(hasRequiredLongbits)return longbits;hasRequiredLongbits=1,longbits=e;var t=requireMinimal();function e(t,e){this.lo=t>>>0,this.hi=e>>>0}var r=e.zero=new e(0,0);r.toNumber=function(){return 0},r.zzEncode=r.zzDecode=function(){return this},r.length=function(){return 1};var i=e.zeroHash="\0\0\0\0\0\0\0\0";e.fromNumber=function(t){if(0===t)return r;var i=t<0;i&&(t=-t);var n=t>>>0,o=(t-n)/4294967296>>>0;return i&&(o=~o>>>0,n=~n>>>0,++n>4294967295&&(n=0,++o>4294967295&&(o=0))),new e(n,o)},e.from=function(i){if("number"==typeof i)return e.fromNumber(i);if(t.isString(i)){if(!t.Long)return e.fromNumber(parseInt(i,10));i=t.Long.fromString(i)}return i.low||i.high?new e(i.low>>>0,i.high>>>0):r},e.prototype.toNumber=function(t){if(!t&&this.hi>>>31){var e=1+~this.lo>>>0,r=~this.hi>>>0;return e||(r=r+1>>>0),-(e+4294967296*r)}return this.lo+4294967296*this.hi},e.prototype.toLong=function(e){return t.Long?new t.Long(0|this.lo,0|this.hi,Boolean(e)):{low:0|this.lo,high:0|this.hi,unsigned:Boolean(e)}};var n=String.prototype.charCodeAt;return e.fromHash=function(t){return t===i?r:new e((n.call(t,0)|n.call(t,1)<<8|n.call(t,2)<<16|n.call(t,3)<<24)>>>0,(n.call(t,4)|n.call(t,5)<<8|n.call(t,6)<<16|n.call(t,7)<<24)>>>0)},e.prototype.toHash=function(){return String.fromCharCode(255&this.lo,this.lo>>>8&255,this.lo>>>16&255,this.lo>>>24,255&this.hi,this.hi>>>8&255,this.hi>>>16&255,this.hi>>>24)},e.prototype.zzEncode=function(){var t=this.hi>>31;return this.hi=((this.hi<<1|this.lo>>>31)^t)>>>0,this.lo=(this.lo<<1^t)>>>0,this},e.prototype.zzDecode=function(){var t=-(1&this.lo);return this.lo=((this.lo>>>1|this.hi<<31)^t)>>>0,this.hi=(this.hi>>>1^t)>>>0,this},e.prototype.length=function(){var t=this.lo,e=(this.lo>>>28|this.hi<<4)>>>0,r=this.hi>>>24;return 0===r?0===e?t<16384?t<128?1:2:t<2097152?3:4:e<16384?e<128?5:6:e<2097152?7:8:r<128?9:10},longbits}function requireMinimal(){return hasRequiredMinimal||(hasRequiredMinimal=1,function(t){var e=t;function r(t,e,r){for(var i=Object.keys(e),n=0;n<i.length;++n)void 0!==t[i[n]]&&r||(t[i[n]]=e[i[n]]);return t}function i(t){function e(t,i){if(!(this instanceof e))return new e(t,i);Object.defineProperty(this,"message",{get:function(){return t}}),Error.captureStackTrace?Error.captureStackTrace(this,e):Object.defineProperty(this,"stack",{value:(new Error).stack||""}),i&&r(this,i)}return(e.prototype=Object.create(Error.prototype)).constructor=e,Object.defineProperty(e.prototype,"name",{get:function(){return t}}),e.prototype.toString=function(){return this.name+": "+this.message},e}e.asPromise=requireAspromise(),e.base64=requireBase64(),e.EventEmitter=requireEventemitter(),e.float=requireFloat(),e.inquire=requireInquire(),e.utf8=requireUtf8(),e.pool=requirePool(),e.LongBits=requireLongbits(),e.isNode=Boolean(void 0!==commonjsGlobal&&commonjsGlobal&&commonjsGlobal.process&&commonjsGlobal.process.versions&&commonjsGlobal.process.versions.node),e.global=e.isNode&&commonjsGlobal||"undefined"!=typeof window&&window||"undefined"!=typeof self&&self||commonjsGlobal,e.emptyArray=Object.freeze?Object.freeze([]):[],e.emptyObject=Object.freeze?Object.freeze({}):{},e.isInteger=Number.isInteger||function(t){return"number"==typeof t&&isFinite(t)&&Math.floor(t)===t},e.isString=function(t){return"string"==typeof t||t instanceof String},e.isObject=function(t){return t&&"object"==typeof t},e.isset=e.isSet=function(t,e){var r=t[e];return!(null==r||!t.hasOwnProperty(e))&&("object"!=typeof r||(Array.isArray(r)?r.length:Object.keys(r).length)>0)},e.Buffer=function(){try{var t=e.inquire("buffer").Buffer;return t.prototype.utf8Write?t:null}catch(t){return null}}(),e._Buffer_from=null,e._Buffer_allocUnsafe=null,e.newBuffer=function(t){return"number"==typeof t?e.Buffer?e._Buffer_allocUnsafe(t):new e.Array(t):e.Buffer?e._Buffer_from(t):"undefined"==typeof Uint8Array?t:new Uint8Array(t)},e.Array="undefined"!=typeof Uint8Array?Uint8Array:Array,e.Long=e.global.dcodeIO&&e.global.dcodeIO.Long||e.global.Long||e.inquire("long"),e.key2Re=/^true|false|0|1$/,e.key32Re=/^-?(?:0|[1-9][0-9]*)$/,e.key64Re=/^(?:[\\x00-\\xff]{8}|-?(?:0|[1-9][0-9]*))$/,e.longToHash=function(t){return t?e.LongBits.from(t).toHash():e.LongBits.zeroHash},e.longFromHash=function(t,r){var i=e.LongBits.fromHash(t);return e.Long?e.Long.fromBits(i.lo,i.hi,r):i.toNumber(Boolean(r))},e.merge=r,e.lcFirst=function(t){return t.charAt(0).toLowerCase()+t.substring(1)},e.newError=i,e.ProtocolError=i("ProtocolError"),e.oneOfGetter=function(t){for(var e={},r=0;r<t.length;++r)e[t[r]]=1;return function(){for(var t=Object.keys(this),r=t.length-1;r>-1;--r)if(1===e[t[r]]&&void 0!==this[t[r]]&&null!==this[t[r]])return t[r]}},e.oneOfSetter=function(t){return function(e){for(var r=0;r<t.length;++r)t[r]!==e&&delete this[t[r]]}},e.toJSONOptions={longs:String,enums:String,bytes:String,json:!0},e._configure=function(){var t=e.Buffer;t?(e._Buffer_from=t.from!==Uint8Array.from&&t.from||function(e,r){return new t(e,r)},e._Buffer_allocUnsafe=t.allocUnsafe||function(e){return new t(e)}):e._Buffer_from=e._Buffer_allocUnsafe=null}}(minimal$1)),minimal$1}var writer=Writer$1,util$4=requireMinimal(),BufferWriter$1,LongBits$1=util$4.LongBits,base64=util$4.base64,utf8$1=util$4.utf8;function Op(t,e,r){this.fn=t,this.len=e,this.next=void 0,this.val=r}function noop(){}function State$2(t){this.head=t.head,this.tail=t.tail,this.len=t.len,this.next=t.states}function Writer$1(){this.len=0,this.head=new Op(noop,0,0),this.tail=this.head,this.states=null}var create$1=function(){return util$4.Buffer?function(){return(Writer$1.create=function(){return new BufferWriter$1})()}:function(){return new Writer$1}};function writeByte(t,e,r){e[r]=255&t}function writeVarint32(t,e,r){for(;t>127;)e[r++]=127&t|128,t>>>=7;e[r]=t}function VarintOp(t,e){this.len=t,this.next=void 0,this.val=e}function writeVarint64(t,e,r){for(;t.hi;)e[r++]=127&t.lo|128,t.lo=(t.lo>>>7|t.hi<<25)>>>0,t.hi>>>=7;for(;t.lo>127;)e[r++]=127&t.lo|128,t.lo=t.lo>>>7;e[r++]=t.lo}function writeFixed32(t,e,r){e[r]=255&t,e[r+1]=t>>>8&255,e[r+2]=t>>>16&255,e[r+3]=t>>>24}Writer$1.create=create$1(),Writer$1.alloc=function(t){return new util$4.Array(t)},util$4.Array!==Array&&(Writer$1.alloc=util$4.pool(Writer$1.alloc,util$4.Array.prototype.subarray)),Writer$1.prototype._push=function(t,e,r){return this.tail=this.tail.next=new Op(t,e,r),this.len+=e,this},VarintOp.prototype=Object.create(Op.prototype),VarintOp.prototype.fn=writeVarint32,Writer$1.prototype.uint32=function(t){return this.len+=(this.tail=this.tail.next=new VarintOp((t>>>=0)<128?1:t<16384?2:t<2097152?3:t<268435456?4:5,t)).len,this},Writer$1.prototype.int32=function(t){return t<0?this._push(writeVarint64,10,LongBits$1.fromNumber(t)):this.uint32(t)},Writer$1.prototype.sint32=function(t){return this.uint32((t<<1^t>>31)>>>0)},Writer$1.prototype.uint64=function(t){var e=LongBits$1.from(t);return this._push(writeVarint64,e.length(),e)},Writer$1.prototype.int64=Writer$1.prototype.uint64,Writer$1.prototype.sint64=function(t){var e=LongBits$1.from(t).zzEncode();return this._push(writeVarint64,e.length(),e)},Writer$1.prototype.bool=function(t){return this._push(writeByte,1,t?1:0)},Writer$1.prototype.fixed32=function(t){return this._push(writeFixed32,4,t>>>0)},Writer$1.prototype.sfixed32=Writer$1.prototype.fixed32,Writer$1.prototype.fixed64=function(t){var e=LongBits$1.from(t);return this._push(writeFixed32,4,e.lo)._push(writeFixed32,4,e.hi)},Writer$1.prototype.sfixed64=Writer$1.prototype.fixed64,Writer$1.prototype.float=function(t){return this._push(util$4.float.writeFloatLE,4,t)},Writer$1.prototype.double=function(t){return this._push(util$4.float.writeDoubleLE,8,t)};var writeBytes=util$4.Array.prototype.set?function(t,e,r){e.set(t,r)}:function(t,e,r){for(var i=0;i<t.length;++i)e[r+i]=t[i]};Writer$1.prototype.bytes=function(t){var e=t.length>>>0;if(!e)return this._push(writeByte,1,0);if(util$4.isString(t)){var r=Writer$1.alloc(e=base64.length(t));base64.decode(t,r,0),t=r}return this.uint32(e)._push(writeBytes,e,t)},Writer$1.prototype.string=function(t){var e=utf8$1.length(t);return e?this.uint32(e)._push(utf8$1.write,e,t):this._push(writeByte,1,0)},Writer$1.prototype.fork=function(){return this.states=new State$2(this),this.head=this.tail=new Op(noop,0,0),this.len=0,this},Writer$1.prototype.reset=function(){return this.states?(this.head=this.states.head,this.tail=this.states.tail,this.len=this.states.len,this.states=this.states.next):(this.head=this.tail=new Op(noop,0,0),this.len=0),this},Writer$1.prototype.ldelim=function(){var t=this.head,e=this.tail,r=this.len;return this.reset().uint32(r),r&&(this.tail.next=t.next,this.tail=e,this.len+=r),this},Writer$1.prototype.finish=function(){for(var t=this.head.next,e=this.constructor.alloc(this.len),r=0;t;)t.fn(t.val,e,r),r+=t.len,t=t.next;return e},Writer$1._configure=function(t){BufferWriter$1=t,Writer$1.create=create$1(),BufferWriter$1._configure()};var writer_buffer=BufferWriter,Writer=writer;(BufferWriter.prototype=Object.create(Writer.prototype)).constructor=BufferWriter;var util$3=requireMinimal();function BufferWriter(){Writer.call(this)}function writeStringBuffer(t,e,r){t.length<40?util$3.utf8.write(t,e,r):e.utf8Write?e.utf8Write(t,r):e.write(t,r)}BufferWriter._configure=function(){BufferWriter.alloc=util$3._Buffer_allocUnsafe,BufferWriter.writeBytesBuffer=util$3.Buffer&&util$3.Buffer.prototype instanceof Uint8Array&&"set"===util$3.Buffer.prototype.set.name?function(t,e,r){e.set(t,r)}:function(t,e,r){if(t.copy)t.copy(e,r,0,t.length);else for(var i=0;i<t.length;)e[r++]=t[i++]}},BufferWriter.prototype.bytes=function(t){util$3.isString(t)&&(t=util$3._Buffer_from(t,"base64"));var e=t.length>>>0;return this.uint32(e),e&&this._push(BufferWriter.writeBytesBuffer,e,t),this},BufferWriter.prototype.string=function(t){var e=util$3.Buffer.byteLength(t);return this.uint32(e),e&&this._push(writeStringBuffer,e,t),this},BufferWriter._configure();var reader=Reader$1,util$2=requireMinimal(),BufferReader$1,LongBits=util$2.LongBits,utf8=util$2.utf8;function indexOutOfRange(t,e){return RangeError("index out of range: "+t.pos+" + "+(e||1)+" > "+t.len)}function Reader$1(t){this.buf=t,this.pos=0,this.len=t.length}var create_array="undefined"!=typeof Uint8Array?function(t){if(t instanceof Uint8Array||Array.isArray(t))return new Reader$1(t);throw Error("illegal buffer")}:function(t){if(Array.isArray(t))return new Reader$1(t);throw Error("illegal buffer")},create=function(){return util$2.Buffer?function(t){return(Reader$1.create=function(t){return util$2.Buffer.isBuffer(t)?new BufferReader$1(t):create_array(t)})(t)}:create_array},value;function readLongVarint(){var t=new LongBits(0,0),e=0;if(!(this.len-this.pos>4)){for(;e<3;++e){if(this.pos>=this.len)throw indexOutOfRange(this);if(t.lo=(t.lo|(127&this.buf[this.pos])<<7*e)>>>0,this.buf[this.pos++]<128)return t}return t.lo=(t.lo|(127&this.buf[this.pos++])<<7*e)>>>0,t}for(;e<4;++e)if(t.lo=(t.lo|(127&this.buf[this.pos])<<7*e)>>>0,this.buf[this.pos++]<128)return t;if(t.lo=(t.lo|(127&this.buf[this.pos])<<28)>>>0,t.hi=(t.hi|(127&this.buf[this.pos])>>4)>>>0,this.buf[this.pos++]<128)return t;if(e=0,this.len-this.pos>4){for(;e<5;++e)if(t.hi=(t.hi|(127&this.buf[this.pos])<<7*e+3)>>>0,this.buf[this.pos++]<128)return t}else for(;e<5;++e){if(this.pos>=this.len)throw indexOutOfRange(this);if(t.hi=(t.hi|(127&this.buf[this.pos])<<7*e+3)>>>0,this.buf[this.pos++]<128)return t}throw Error("invalid varint encoding")}function readFixed32_end(t,e){return(t[e-4]|t[e-3]<<8|t[e-2]<<16|t[e-1]<<24)>>>0}function readFixed64(){if(this.pos+8>this.len)throw indexOutOfRange(this,8);return new LongBits(readFixed32_end(this.buf,this.pos+=4),readFixed32_end(this.buf,this.pos+=4))}Reader$1.create=create(),Reader$1.prototype._slice=util$2.Array.prototype.subarray||util$2.Array.prototype.slice,Reader$1.prototype.uint32=(value=4294967295,function(){if(value=(127&this.buf[this.pos])>>>0,this.buf[this.pos++]<128)return value;if(value=(value|(127&this.buf[this.pos])<<7)>>>0,this.buf[this.pos++]<128)return value;if(value=(value|(127&this.buf[this.pos])<<14)>>>0,this.buf[this.pos++]<128)return value;if(value=(value|(127&this.buf[this.pos])<<21)>>>0,this.buf[this.pos++]<128)return value;if(value=(value|(15&this.buf[this.pos])<<28)>>>0,this.buf[this.pos++]<128)return value;if((this.pos+=5)>this.len)throw this.pos=this.len,indexOutOfRange(this,10);return value}),Reader$1.prototype.int32=function(){return 0|this.uint32()},Reader$1.prototype.sint32=function(){var t=this.uint32();return t>>>1^-(1&t)},Reader$1.prototype.bool=function(){return 0!==this.uint32()},Reader$1.prototype.fixed32=function(){if(this.pos+4>this.len)throw indexOutOfRange(this,4);return readFixed32_end(this.buf,this.pos+=4)},Reader$1.prototype.sfixed32=function(){if(this.pos+4>this.len)throw indexOutOfRange(this,4);return 0|readFixed32_end(this.buf,this.pos+=4)},Reader$1.prototype.float=function(){if(this.pos+4>this.len)throw indexOutOfRange(this,4);var t=util$2.float.readFloatLE(this.buf,this.pos);return this.pos+=4,t},Reader$1.prototype.double=function(){if(this.pos+8>this.len)throw indexOutOfRange(this,4);var t=util$2.float.readDoubleLE(this.buf,this.pos);return this.pos+=8,t},Reader$1.prototype.bytes=function(){var t=this.uint32(),e=this.pos,r=this.pos+t;if(r>this.len)throw indexOutOfRange(this,t);return this.pos+=t,Array.isArray(this.buf)?this.buf.slice(e,r):e===r?new this.buf.constructor(0):this._slice.call(this.buf,e,r)},Reader$1.prototype.string=function(){var t=this.bytes();return utf8.read(t,0,t.length)},Reader$1.prototype.skip=function(t){if("number"==typeof t){if(this.pos+t>this.len)throw indexOutOfRange(this,t);this.pos+=t}else do{if(this.pos>=this.len)throw indexOutOfRange(this)}while(128&this.buf[this.pos++]);return this},Reader$1.prototype.skipType=function(t){switch(t){case 0:this.skip();break;case 1:this.skip(8);break;case 2:this.skip(this.uint32());break;case 3:for(;4!=(t=7&this.uint32());)this.skipType(t);break;case 5:this.skip(4);break;default:throw Error("invalid wire type "+t+" at offset "+this.pos)}return this},Reader$1._configure=function(t){BufferReader$1=t,Reader$1.create=create(),BufferReader$1._configure();var e=util$2.Long?"toLong":"toNumber";util$2.merge(Reader$1.prototype,{int64:function(){return readLongVarint.call(this)[e](!1)},uint64:function(){return readLongVarint.call(this)[e](!0)},sint64:function(){return readLongVarint.call(this).zzDecode()[e](!1)},fixed64:function(){return readFixed64.call(this)[e](!0)},sfixed64:function(){return readFixed64.call(this)[e](!1)}})};var reader_buffer=BufferReader,Reader=reader;(BufferReader.prototype=Object.create(Reader.prototype)).constructor=BufferReader;var util$1=requireMinimal();function BufferReader(t){Reader.call(this,t)}BufferReader._configure=function(){util$1.Buffer&&(BufferReader.prototype._slice=util$1.Buffer.prototype.slice)},BufferReader.prototype.string=function(){var t=this.uint32();return this.buf.utf8Slice?this.buf.utf8Slice(this.pos,this.pos=Math.min(this.pos+t,this.len)):this.buf.toString("utf-8",this.pos,this.pos=Math.min(this.pos+t,this.len))},BufferReader._configure();var rpc={},service=Service,util=requireMinimal(),exports;function Service(t,e,r){if("function"!=typeof t)throw TypeError("rpcImpl must be a function");util.EventEmitter.call(this),this.rpcImpl=t,this.requestDelimited=Boolean(e),this.responseDelimited=Boolean(r)}(Service.prototype=Object.create(util.EventEmitter.prototype)).constructor=Service,Service.prototype.rpcCall=function t(e,r,i,n,o){if(!n)throw TypeError("request must be specified");var a=this;if(!o)return util.asPromise(t,a,e,r,i,n);if(a.rpcImpl)try{return a.rpcImpl(e,r[a.requestDelimited?"encodeDelimited":"encode"](n).finish(),(function(t,r){if(t)return a.emit("error",t,e),o(t);if(null!==r){if(!(r instanceof i))try{r=i[a.responseDelimited?"decodeDelimited":"decode"](r)}catch(t){return a.emit("error",t,e),o(t)}return a.emit("data",r,e),o(null,r)}a.end(!0)}))}catch(t){return a.emit("error",t,e),void setTimeout((function(){o(t)}),0)}else setTimeout((function(){o(Error("already ended"))}),0)},Service.prototype.end=function(t){return this.rpcImpl&&(t||this.rpcImpl(null,null,null),this.rpcImpl=null,this.emit("end").off()),this},exports=rpc,exports.Service=service;var roots={};!function(t){var e=t;function r(){e.util._configure(),e.Writer._configure(e.BufferWriter),e.Reader._configure(e.BufferReader)}e.build="minimal",e.Writer=writer,e.BufferWriter=writer_buffer,e.Reader=reader,e.BufferReader=reader_buffer,e.util=requireMinimal(),e.rpc=rpc,e.roots=roots,e.configure=r,r()}(indexMinimal);var minimal=indexMinimal,protobuf=getDefaultExportFromCjs(minimal);protobuf.util.Long=Long$1,protobuf.configure(),VectorTileFeature.prototype.loadGeometry=function(t){var e=this._pbf;e.pos=this._geometry;for(var r,i=e.readVarint()+e.pos,n=1,o=0,a=0,s=0,l=[];e.pos<i;){if(o<=0){var u=e.readVarint();n=7&u,o=u>>3}if(o--,1===n||2===n)a+=e.readSVarint(),s+=e.readSVarint(),1===n&&(r&&l.push(r),r=[]),r.push([a*t,s*t]);else{if(7!==n)throw new Error("unknown command "+n);r&&r.push(r[0].slice())}}return r&&l.push(r),l};var MAX_SAFE_INTEGER=Long$1.fromNumber(Number.MAX_SAFE_INTEGER,!0),MIN_SAFE_INTEGER=Long$1.fromNumber(Number.MIN_SAFE_INTEGER,!1);function readLong(t,e,r){e.pos=t.pos;var i=r.call(e);return t.pos=e.pos,Long$1.isLong(i)?i.comp(MAX_SAFE_INTEGER)>0||i.comp(MIN_SAFE_INTEGER)<0?i.toString():i.toNumber():i}var VectorTileLayer=_createClass((function t(e,r){_classCallCheck(this,t),this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=e,this._keys=[],this._values=[],this._features=[],this._protobufjsReader=protobuf.Reader.create(e.buf),e.readFields(readLayer,this,r),this.length=this._features.length}),[{key:"feature",value:function(t){if(t<0||t>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[t];var e=this._pbf.readVarint()+this._pbf.pos;return new VectorTileFeature(this._pbf,e,this.extent,this._keys,this._values)}}]);function readLayer(t,e,r){15===t?e.version=r.readVarint():1===t?e.name=r.readString():5===t?e.extent=r.readVarint():2===t?e._features.push(r.pos):3===t?e._keys.push(r.readString()):4===t&&e._values.push(readValueMessage(r,e._protobufjsReader))}function readValueMessage(t,e){for(var r=null,i=t.readVarint()+t.pos;t.pos<i;){var n=t.readVarint()>>3;r=1===n?t.readString():2===n?t.readFloat():3===n?t.readDouble():4===n?readLong(t,e,e.int64):5===n?readLong(t,e,e.uint64):6===n?readLong(t,e,e.sint64):7===n?t.readBoolean():null}return r}var VectorTile=_createClass((function t(e,r){_classCallCheck(this,t),this.layers=e.readFields(readTile,{},r)}));function readTile(t,e,r){if(3===t){var i=new VectorTileLayer(r,r.readVarint()+r.pos);i.length&&(e[i.name]=i)}}function getLayersFromMVT(t){var e={};for(var r in t.layers){for(var i=t.layers[r],n=[],o=Geo$1.tile_scale/i.extent,a=0,s=i.length;a<s;a++){var l,u=i.feature(a),c=VectorTileFeature.types[u.type];l=u.loadGeometry(o);var h=null;switch(c){case"Point":h=decodePoint({coordinates:l});break;case"LineString":h=1===l.length?{type:c,coordinates:l[0]}:{type:"MultiLineString",coordinates:l};break;case"Polygon":h=decodeMultiPolygon({coordinates:l})}h&&h.coordinates&&n.push({type:"Feature",geometry:h,properties:u.properties})}e[r]={type:"FeatureCollection",features:n}}return e}var GeomType={UNKNOWN:0,POINT:1,LINESTRING:2,POLYGON:3};function parseGeoJSONVectorTile(t){var e=[],r=t&&t.features;if(r)for(var i=0,n=r.length;i<n;i++){var o=r[i],a=o.type,s=void 0;switch(a){case GeomType.POINT:s={type:"MultiPoint",coordinates:o.geometry.map((function(t){return t.slice()}))};break;case GeomType.LINESTRING:case GeomType.POLYGON:if(s={type:"MultiLineString",coordinates:o.geometry.map((function(t){return t.map((function(t){return t.slice()}))}))},a===GeomType.POLYGON&&null==(s=decodeMultiPolygon(s)))continue;break;default:continue}e.push({id:o.id,type:"Feature",geometry:s,properties:o.tags})}return{type:"FeatureCollection",features:e}}function decodeMultiPolygon(t){for(var e,r=[],i=[],n=0,o=t.coordinates.length;n<o;n++){var a=t.coordinates[n],s=Geo$1.ringWinding(a);null!=s&&(s===(e=e||s)&&i.length&&(r.push(i),i=[]),i.push(a))}return i.length>0&&r.push(i),1===r.length?(t.type="Polygon",t.coordinates=r[0]):r.length>1?(t.type="MultiPolygon",t.coordinates=r):t=null,t}function decodePoint(t){var e=t.coordinates.length;if(e>1){t.type="MultiPoint";for(var r=[],i=0;i<e;i++)r.push(t.coordinates[i][0]);t.coordinates=r}else t.type="Point",t.coordinates=t.coordinates[0][0];return t}var EMPTY_FEATURE_COLLECTION$1={type:"FeatureCollection",features:[]},MVTSource=function(t){function e(t,r){return _classCallCheck(this,e),t.tiled=!0,_callSuper(this,e,[t,r])}return _inherits(e,t),_createClass(e,[{key:"fetchTile",value:function(t,e,r){return this.provider?this.provider.requestTileAsPromise(t,e,r).then((function(t){return t.data})):Promise.resolve()}},{key:"_load",value:function(t){var e=this,r=Geo$1.wrapTile(t.coords,{x:!0,y:!0}),i=r.x,n=r.y,o=r.z;return WorkerBroker.postMessage(this.target_name+".fetchTile",i,n,o).then((function(r){if(r instanceof ArrayBuffer){var i=new Pbf$1(new Uint8Array(r));t.source_data.layers=getLayersFromMVT(new VectorTile(i))}else r?t.source_data.error=r:t.source_data.layers={_default:EMPTY_FEATURE_COLLECTION$1};return e._postProcessTile(t),t}))}},{key:"onReady",value:function(){this.dispatchUpdate()}}])}(MapsJsSource);DataSource.register(MVTSource,"MVT"),DataSource.register(MVTSource,"OMV");var csscolorparser={},parseCSSColor_1,kCSSColorTable={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function clamp_css_byte(t){return(t=Math.round(t))<0?0:t>255?255:t}function clamp_css_float(t){return t<0?0:t>1?1:t}function parse_css_int(t){return"%"===t[t.length-1]?clamp_css_byte(parseFloat(t)/100*255):clamp_css_byte(parseInt(t))}function parse_css_float(t){return"%"===t[t.length-1]?clamp_css_float(parseFloat(t)/100):clamp_css_float(parseFloat(t))}function css_hue_to_rgb(t,e,r){return r<0?r+=1:r>1&&(r-=1),6*r<1?t+(e-t)*r*6:2*r<1?e:3*r<2?t+(e-t)*(2/3-r)*6:t}function parseCSSColor(t){var e,r=t.replace(/ /g,"").toLowerCase();if(r in kCSSColorTable)return kCSSColorTable[r].slice();if("#"===r[0])return 4===r.length?(e=parseInt(r.substr(1),16))>=0&&e<=4095?[(3840&e)>>4|(3840&e)>>8,240&e|(240&e)>>4,15&e|(15&e)<<4,1]:null:7===r.length&&(e=parseInt(r.substr(1),16))>=0&&e<=16777215?[(16711680&e)>>16,(65280&e)>>8,255&e,1]:null;var i=r.indexOf("("),n=r.indexOf(")");if(-1!==i&&n+1===r.length){var o=r.substr(0,i),a=r.substr(i+1,n-(i+1)).split(","),s=1;switch(o){case"rgba":if(4!==a.length)return null;s=parse_css_float(a.pop());case"rgb":return 3!==a.length?null:[parse_css_int(a[0]),parse_css_int(a[1]),parse_css_int(a[2]),s];case"hsla":if(4!==a.length)return null;s=parse_css_float(a.pop());case"hsl":if(3!==a.length)return null;var l=(parseFloat(a[0])%360+360)%360/360,u=parse_css_float(a[1]),c=parse_css_float(a[2]),h=c<=.5?c*(u+1):c+u-c*u,p=2*c-h;return[clamp_css_byte(255*css_hue_to_rgb(p,h,l+1/3)),clamp_css_byte(255*css_hue_to_rgb(p,h,l)),clamp_css_byte(255*css_hue_to_rgb(p,h,l-1/3)),s];default:return null}}return null}try{parseCSSColor_1=csscolorparser.parseCSSColor=parseCSSColor}catch(e){}var StyleParser={},clampPositive=function(t){return Math.max(t,0)},noNaN=function(t){return isNaN(t)?0:t},parseNumber=function(t){return Array.isArray(t)?t.map(parseFloat).map(noNaN):noNaN(parseFloat(t))},parsePositiveNumber=function(t){return Array.isArray(t)?t.map(parseNumber).map(clampPositive):clampPositive(parseNumber(t))};Object.assign(StyleParser,{clampPositive,noNaN,parseNumber,parsePositiveNumber}),StyleParser.wrapFunction=function(t){return"\n        var feature = context.feature.properties;\n        var global = context.global;\n        var $zoom = context.zoom;\n        var $layer = context.layer;\n        var $source = context.source;\n        var sources = context.sources;\n        var $geometry = context.geometry;\n        var $meters_per_pixel = context.meters_per_pixel;\n\n        var val = (function(){ ".concat(t," }());\n\n        if (typeof val === 'number' && isNaN(val)) {\n            val = null; // convert NaNs to nulls\n        }\n\n        return val;\n    ")},StyleParser.zeroPair=Object.freeze([0,0]),StyleParser.defaults={color:[1,1,1,1],width:1,size:1,extrude:!1,height:20,min_height:0,order:0,z:0,outline:{color:[0,0,0,0],width:0},material:{ambient:1,diffuse:1}},StyleParser.macros={"Style.color.pseudoRandomColor":function(){return[parseInt(feature.id,16)/100%1*.7,parseInt(feature.id,16)/1e4%1*.7,parseInt(feature.id,16)/1e6%1*.7,1]},"Style.color.randomColor":function(){return[.7*Math.random(),.7*Math.random(),.7*Math.random(),1]}},StyleParser.getFeatureParseContext=function(t,e,r,i){return{feature:t,tile:e,global:r,sources:i,zoom:e.style_zoom,geometry:Geo$1.geometryType(t.geometry.type),meters_per_pixel:e.meters_per_pixel,meters_per_pixel_sq:e.meters_per_pixel_sq,units_per_meter_overzoom:e.units_per_meter_overzoom}};var CACHE_TYPE={STATIC:0,DYNAMIC:1,ZOOM:2};StyleParser.CACHE_TYPE=CACHE_TYPE,StyleParser.createPropertyCache=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(null!=t){if(t.value)return{value:t.value,zoom:t.zoom?{}:null,type:t.type};var r={value:t,type:CACHE_TYPE.STATIC};return Array.isArray(r.value)&&Array.isArray(r.value[0])?(r.zoom={},r.type=CACHE_TYPE.ZOOM):"function"==typeof r.value&&(r.type=CACHE_TYPE.DYNAMIC),"function"==typeof e&&(r.zoom?r.value=r.value.map((function(t,r){return[t[0],e(t[1],r)]})):"function"!=typeof r.value&&(r.value=e(r.value,0))),r}},StyleParser.createColorPropertyCache=function(t){return StyleParser.createPropertyCache(t,(function(t){return"Style.color.pseudoRandomColor"===t?Utils$1.stringToFunction(StyleParser.wrapFunction(StyleParser.macros["Style.color.pseudoRandomColor"])):"Style.color.randomColor"===t?StyleParser.macros["Style.color.randomColor"]:t}))};var isPercent=function(t){return"string"==typeof t&&"%"===t[t.length-1]},isRatio=function(t){return"auto"===t},isComputed=function(t){return isPercent(t)||isRatio(t)},dualRatioError="'size' can specify either width or height as derived from aspect ratio, but not both";StyleParser.createPointSizePropertyCache=function(t){var e=null,r=null;if(isPercent(t))e=[!0];else if(Array.isArray(t))if(Array.isArray(t[0])){if(t.some((function(t){return Array.isArray(t[1])?t[1].some((function(t){return isComputed(t)})):isPercent(t[1])}))&&(e=t.map((function(t){return Array.isArray(t[1])?t[1].map((function(t){return isPercent(t)})):isPercent(t[1])})),(r=t.map((function(t){return Array.isArray(t[1])&&t[1].map((function(t){return isRatio(t)}))}))).some((function(t){return Array.isArray(t)&&t.every((function(t){return t}))}))))throw dualRatioError}else if(t.some(isComputed)&&(e=[t.map(isPercent)],(r=[t.map(isRatio)])[0].every((function(t){return t}))))throw dualRatioError;return e?((t={value:t}).has_pct=e,t.has_ratio=r,t.sprites={}):t=StyleParser.createPropertyCache(t,parsePositiveNumber),t},StyleParser.evalCachedPointSizeProperty=function(t,e,r){return t.has_pct||t.has_ratio?e?(t.sprites[e.sprite]||(t.sprites[e.sprite]=StyleParser.createPropertyCache(t.value,(function(r,i){return Array.isArray(r)?(r=r.map((function(e,r){return t.has_ratio[i][r]?e:parsePositiveNumber(e)})).map((function(r,n){return t.has_pct[i][n]?e.css_size[n]*r/100:r})),t.has_ratio[i][0]?r[0]=r[1]*e.aspect:t.has_ratio[i][1]&&(r[1]=r[0]/e.aspect)):(r=parsePositiveNumber(r),r=t.has_pct[i]?e.css_size.map((function(t){return t*r/100})):[r,r]),r}))),StyleParser.evalCachedProperty(t.sprites[e.sprite],r)):void 0:StyleParser.evalCachedProperty(t,r)},StyleParser.evalCachedProperty=function(t,e){if(null!=t)return t.dynamic?t.dynamic(e):t.static?t.static:t.zoom&&t.zoom[e.zoom]?t.zoom[e.zoom]:"function"==typeof t.value?(t.dynamic=t.value,t.dynamic(e)):Array.isArray(t.value)&&Array.isArray(t.value[0])?(t.zoom=t.zoom||{},t.zoom[e.zoom]=Utils$1.interpolate(e.zoom,t.value),t.zoom[e.zoom]):(t.static=t.value,t.static)},StyleParser.convertUnits=function(t,e){if(null!=t.val)return"px"===t.units?t.val*Geo$1.metersPerPixel(e.zoom):t.val;if("string"==typeof t)"px"===t.trim().slice(-2)?(t=parseNumber(t),t*=Geo$1.metersPerPixel(e.zoom)):t=parseNumber(t);else if(Array.isArray(t))return Array.isArray(t[0])?t.map((function(t){return[t[0],StyleParser.convertUnits(t[1],e)]})):t.map((function(t){return StyleParser.convertUnits(t,e)}));return t},StyleParser.parseUnits=function(t){var e={val:parseNumber(t)};return 0!==e.val&&"string"==typeof t&&"px"===t.trim().slice(-2)&&(e.units="px"),e},StyleParser.evalCachedDistanceProperty=function(t,e){return t.dynamic?t.dynamic(e):t.zoom&&t.zoom[e.zoom]?t.zoom[e.zoom]:"function"==typeof t.value?(t.dynamic=t.value,t.dynamic(e)):t.zoom?(t.zoom[e.zoom]=Utils$1.interpolate(e.zoom,t.value,(function(t){return StyleParser.convertUnits(t,e)})),t.zoom[e.zoom]):StyleParser.convertUnits(t.value,e)},StyleParser.string_colors={},StyleParser.colorForString=function(t){if(StyleParser.string_colors[t])return StyleParser.string_colors[t];var e=null;return"none"!==t&&((e=csscolorparser.parseCSSColor(t))&&4===e.length?(e[0]/=255,e[1]/=255,e[2]/=255):e=StyleParser.defaults.color),StyleParser.string_colors[t]=e,e},StyleParser.evalCachedColorProperty=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(t.dynamic){var r=t.dynamic(e);return"string"==typeof r&&(r=StyleParser.colorForString(r)),r&&null==r[3]&&(r[3]=1),r}if(t.static)return t.static;if(t.zoom&&t.zoom[e.zoom])return t.zoom[e.zoom];if("function"==typeof t.value){t.dynamic=t.value;var i=t.dynamic(e);return"string"==typeof i&&(i=StyleParser.colorForString(i)),i&&null==i[3]&&(i[3]=1),i}if("string"==typeof t.value)return t.static=StyleParser.colorForString(t.value),t.static;if(t.zoom){if(!t.zoom_preprocessed){for(var n=0;n<t.value.length;n++){var o=t.value[n];o&&"string"==typeof o[1]&&(o[1]=StyleParser.colorForString(o[1]))}t.zoom_preprocessed=!0}return t.zoom[e.zoom]=Utils$1.interpolate(e.zoom,t.value),t.zoom[e.zoom][3]=t.zoom[e.zoom][3]||1,t.zoom[e.zoom]}return t.static=t.value.map((function(t){return t})),t.static&&null==t.static[3]&&(t.static[3]=1),t.static},StyleParser.parseColor=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if("function"==typeof t&&(t=t(e)),"string"==typeof t)t=StyleParser.colorForString(t);else if(Array.isArray(t)&&Array.isArray(t[0])){for(var r=0;r<t.length;r++){var i=t[r];"string"==typeof i[1]&&(i[1]=StyleParser.colorForString(i[1]))}e.zoom&&(t=Utils$1.interpolate(e.zoom,t))}return Array.isArray(t)?null==(t=t.map((function(t){return t})))[3]&&(t[3]=1):t=[0,0,0,1],t},StyleParser.calculateOrder=function(t,e){return"function"==typeof t?t=t(e):"string"==typeof t&&(t=e.feature.properties[t]?e.feature.properties[t]:parsePositiveNumber(t)),t},StyleParser.evalProperty=function(t,e){return"function"==typeof t?t(e):t};var RepeatGroup=function(){function t(e,r){_classCallCheck(this,t),this.key=e,this.repeat_dist=r,this.repeat_dist_sq=this.repeat_dist*this.repeat_dist,this.positions=[]}return _createClass(t,[{key:"check",value:function(t){for(var e=t.position,r=0;r<this.positions.length;r++){var i=this.positions[r],n=e[0]-i[0],o=e[1]-i[1],a=n*n+o*o;if(a<this.repeat_dist_sq)return{dist_sq:a,repeat_dist_sq:this.repeat_dist_sq}}}},{key:"add",value:function(t){t&&t.position&&this.positions.push(t.position)}}],[{key:"clear",value:function(t){this.groups[t]={}}},{key:"check",value:function(t,e,r){if(e.repeat_distance&&e.repeat_group&&this.groups[r][e.repeat_group])return this.groups[r][e.repeat_group].check(t)}},{key:"add",value:function(e,r,i){r.repeat_distance&&r.repeat_group&&(null==this.groups[i][r.repeat_group]&&(this.groups[i][r.repeat_group]=new t(r.repeat_group,r.repeat_distance*r.repeat_scale)),this.groups[i][r.repeat_group].add(e))}}])}();RepeatGroup.groups={};var GridIndex=_createClass((function t(e,r,i){_classCallCheck(this,t);var n=this.boxCells=[],o=this.circleCells=[];this.xCellCount=Math.ceil(e/i),this.yCellCount=Math.ceil(r/i);for(var a=0;a<this.xCellCount*this.yCellCount;a++)n.push([]),o.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=e,this.height=r,this.xScale=this.xCellCount/e,this.yScale=this.yCellCount/r,this.boxUid=0,this.circleUid=0}),[{key:"keysLength",value:function(){return this.boxKeys.length+this.circleKeys.length}},{key:"insert",value:function(t,e,r,i,n){this._forEachCell(e,r,i,n,this._insertBoxCell,this.boxUid++),this.boxKeys.push(t),this.bboxes.push(e),this.bboxes.push(r),this.bboxes.push(i),this.bboxes.push(n)}},{key:"insertCircle",value:function(t,e,r,i){this._forEachCell(e-i,r-i,e+i,r+i,this._insertCircleCell,this.circleUid++),this.circleKeys.push(t),this.circles.push(e),this.circles.push(r),this.circles.push(i)}},{key:"insertCircleList",value:function(t,e){for(var r=0;r<e.length-2;r+=3)this.insertCircle("".concat(t,"/").concat(r),e[r],e[r+1],e[r+2])}},{key:"_insertBoxCell",value:function(t,e,r,i,n,o){this.boxCells[n].push(o)}},{key:"_insertCircleCell",value:function(t,e,r,i,n,o){this.circleCells[n].push(o)}},{key:"_query",value:function(t,e,r,i,n,o){if(r<0||t>this.width||i<0||e>this.height)return!n&&[];var a=[];if(t<=0&&e<=0&&this.width<=r&&this.height<=i){if(n)return!0;for(var s=0;s<this.boxKeys.length;s++)a.push({key:this.boxKeys[s],x1:this.bboxes[4*s],y1:this.bboxes[4*s+1],x2:this.bboxes[4*s+2],y2:this.bboxes[4*s+3]});for(var l=0;l<this.circleKeys.length;l++){var u=this.circles[3*l],c=this.circles[3*l+1],h=this.circles[3*l+2];a.push({key:this.circleKeys[l],x1:u-h,y1:c-h,x2:u+h,y2:c+h})}return o?a.filter(o):a}var p={hitTest:n,seenUids:{box:{},circle:{}}};return this._forEachCell(t,e,r,i,this._queryCell,a,p,o),n?a.length>0:a}},{key:"_queryCircle",value:function(t,e,r,i,n){var o=t-r,a=t+r,s=e-r,l=e+r;if(a<0||o>this.width||l<0||s>this.height)return!i&&[];var u=[],c={hitTest:i,circle:{x:t,y:e,radius:r},seenUids:{box:{},circle:{}}};return this._forEachCell(o,s,a,l,this._queryCellCircle,u,c,n),i?u.length>0:u}},{key:"query",value:function(t,e,r,i,n){return this._query(t,e,r,i,!1,n)}},{key:"hitTest",value:function(t,e,r,i,n){return this._query(t,e,r,i,!0,n)}},{key:"hitTestCircle",value:function(t,e,r,i){return this._queryCircle(t,e,r,!0,i)}},{key:"hitTestCircleList",value:function(t,e){for(var r=0;r<t.length-2;r+=3)if(this.hitTestCircle(t[r],t[r+1],t[r+2],e))return!0;return!1}},{key:"_queryCell",value:function(t,e,r,i,n,o,a,s){var l=a.seenUids,u=this.boxCells[n];if(null!==u){var c,h=this.bboxes,p=_createForOfIteratorHelper(u);try{for(p.s();!(c=p.n()).done;){var f=c.value;if(!l.box[f]){l.box[f]=!0;var d=4*f;if(t<=h[d+2]&&e<=h[d+3]&&r>=h[d+0]&&i>=h[d+1]&&(!s||s(this.boxKeys[f]))){if(a.hitTest)return o.push(!0),!0;o.push({key:this.boxKeys[f],x1:h[d],y1:h[d+1],x2:h[d+2],y2:h[d+3]})}}}}catch(t){p.e(t)}finally{p.f()}}var y=this.circleCells[n];if(null!==y){var g,v=this.circles,m=_createForOfIteratorHelper(y);try{for(m.s();!(g=m.n()).done;){var _=g.value;if(!l.circle[_]){l.circle[_]=!0;var b=3*_;if(this._circleAndRectCollide(v[b],v[b+1],v[b+2],t,e,r,i)&&(!s||s(this.circleKeys[_]))){if(a.hitTest)return o.push(!0),!0;var x=v[b],w=v[b+1],E=v[b+2];o.push({key:this.circleKeys[_],x1:x-E,y1:w-E,x2:x+E,y2:w+E})}}}}catch(t){m.e(t)}finally{m.f()}}}},{key:"_queryCellCircle",value:function(t,e,r,i,n,o,a,s){var l=a.circle,u=a.seenUids,c=this.boxCells[n];if(null!==c){var h,p=this.bboxes,f=_createForOfIteratorHelper(c);try{for(f.s();!(h=f.n()).done;){var d=h.value;if(!u.box[d]){u.box[d]=!0;var y=4*d;if(this._circleAndRectCollide(l.x,l.y,l.radius,p[y+0],p[y+1],p[y+2],p[y+3])&&(!s||s(this.boxKeys[d])))return o.push(!0),!0}}}catch(t){f.e(t)}finally{f.f()}}var g=this.circleCells[n];if(null!==g){var v,m=this.circles,_=_createForOfIteratorHelper(g);try{for(_.s();!(v=_.n()).done;){var b=v.value;if(!u.circle[b]){u.circle[b]=!0;var x=3*b;if(this._circlesCollide(m[x],m[x+1],m[x+2],l.x,l.y,l.radius)&&(!s||s(this.circleKeys[b])))return o.push(!0),!0}}}catch(t){_.e(t)}finally{_.f()}}}},{key:"_forEachCell",value:function(t,e,r,i,n,o,a,s){for(var l=this._convertToXCellCoord(t),u=this._convertToYCellCoord(e),c=this._convertToXCellCoord(r),h=this._convertToYCellCoord(i),p=l;p<=c;p++)for(var f=u;f<=h;f++){var d=this.xCellCount*f+p;if(n.call(this,t,e,r,i,d,o,a,s))return}}},{key:"_convertToXCellCoord",value:function(t){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(t*this.xScale)))}},{key:"_convertToYCellCoord",value:function(t){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(t*this.yScale)))}},{key:"_circlesCollide",value:function(t,e,r,i,n,o){var a=i-t,s=n-e,l=r+o;return l*l>a*a+s*s}},{key:"_circleAndRectCollide",value:function(t,e,r,i,n,o,a){var s=(o-i)/2,l=Math.abs(t-(i+s));if(l>s+r)return!1;var u=(a-n)/2,c=Math.abs(e-(n+u));if(c>u+r)return!1;if(l<=s||c<=u)return!0;var h=l-s,p=c-u;return h*h+p*p<=r*r}}]),CollisionUtils={toDiscardLabel:function(t,e,r,i){var n;if(i&&(n=function(t){return t!==i.id}),!e){if("point"===t.type&&!t.angle){var o=t.getAABB(),a=o.left,s=o.top,l=o.right,u=o.bottom;if(r.hitTest(a,-s,l,-u,n)){if(Array.isArray(t.layout.anchor))for(var c=1;c<t.layout.anchor.length;c++){t.setAnchor(t.layout.anchor[c]);var h=t.getAABB(),p=h.left,f=h.top,d=h.right,y=h.bottom;if(!r.hitTest(p,-f,d,-y,n))return!1}return!0}return!1}var g=t.getBoundingCircles();return r.hitTestCircleList(g,n)}if(e){if("point"===t.type&&!t.isFlat()){var v=t.getScreenSpaceBoundingBox(),m=v.left,_=v.top,b=v.right,x=v.bottom;return r.hitTest(m,_,b,x,n)}var w=t.getBoundingCircles();return r.hitTestCircleList(w,n)}return!1},addLabel:function(t,e,r){var i=t.id;if(t.placed=!0,!e)if("point"!==t.type||t.angle){var n=t.getBoundingCircles();r.insertCircleList(i,n)}else{var o=t.getAABB(),a=o.left,s=o.top,l=o.right,u=o.bottom;r.insert(i,a,-s,l,-u)}if(e)if("point"!==t.type||t.isFlat()){var c=t.getBoundingCircles();r.insertCircleList(i,c)}else{var h=t.getScreenSpaceBoundingBox(),p=h.left,f=h.top,d=h.right,y=h.bottom;r.insert(i,p,f,d,y)}}},Collision={tiles:{},startTile:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=e.apply_repeat_groups,i=void 0===r||r,n=e.return_hidden,o=void 0!==n&&n,a=e.grid_index,s=void 0===a?null:a,l=this.tiles[t]={grid_index:s||new GridIndex(Geo$1.tile_scale,Geo$1.tile_scale,240),objects:{},labels:{},styles:{},repeat:i,return_hidden:o};null==l.complete&&(l.complete=new Promise((function(t,e){l.resolve=t,l.reject=e})))},resetTile:function(t){delete this.tiles[t]},abortTile:function(t){this.tiles[t]&&this.tiles[t].resolve&&this.tiles[t].resolve([]),this.resetTile(t)},addStyle:function(t,e){this.tiles[e].styles[t]=!0},collide:function(t,e,r){var i=this.tiles[r];if(!i)return Promise.resolve([]);for(var n=i.objects,o=0;o<t.length;o++){var a=t[o],s=a.label.layout.priority;n[s]=n[s]||{},n[s][e]=n[s][e]||[],n[s][e].push(a)}return delete i.styles[e],0===Object.keys(i.styles).length&&this.endTile(r),i.complete.then((function(){return i.resolve=null,i.labels[e]||[]}))},endTile:function(t){var e=this.tiles[t],r=e.labels;e.repeat&&RepeatGroup.clear(t);for(var i=Object.keys(e.objects).sort((function(t,e){return t-e})),n=0;n<i.length;n++){var o=e.objects[i[n]];if(o)for(var a in o){var s=o[a];r[a]=r[a]||[];for(var l=0;l<s.length;l++){var u=s[l];this.canBePlaced(u,t,u.linked,e)?u.linked?this.canBePlaced(u.linked,t,u,e)?(u.show=!0,(u.label.breach||u.linked.label.breach)&&(u.label.breach=!0,u.linked.label.breach=!0),r[a].push(u),this.place(u,t,e),this.place(u.linked,t,e)):e.return_hidden&&(u.show=!1,r[a].push(u)):(u.show=!0,r[a].push(u),this.place(u,t,e)):e.return_hidden&&(u.show=!1,r[a].push(u))}}}delete this.tiles[t],e.resolve()},canBePlaced:function(t,e){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,i=(arguments.length>3&&void 0!==arguments[3]?arguments[3]:{}).repeat,n=void 0===i||i,o=t.label,a=t.label.layout;if(null!==o.placed)return o.placed;var s=this.tiles[e].grid_index;if(a.collide&&CollisionUtils.toDiscardLabel(o,"main"===e,s,r&&r.label))a.collide&&(o.placed=!1);else{if(!n||!RepeatGroup.check(o,a,e))return!0;o.placed=!1}return o.placed},place:function(t,e,r){var i=t.label,n=r.repeat,o=void 0===n||n;null===i.placed&&(o&&RepeatGroup.add(i,i.layout,e),CollisionUtils.addLabel(i,"main"===e,this.tiles[e].grid_index))}},Task={id:0,queue:[],max_time:20,start_time:null,state:{},ignore_user_moving_view:!1,_ignoreViewMoveWithDebounce:debounce((function(){Task.ignore_user_moving_view=!0}),0,500),add:function(t){t.id=Task.id++,t.max_time=t.max_time||Task.max_time,t.pause_factor=t.pause_factor||1;var e=new Promise((function(e,r){t.resolve=e,t.reject=r}));return t.promise=e,t.total_elapsed=0,t.stats={calls:0},this.queue.push(t),this.start_time=this.start_time||performance.now(),this.elapsed=performance.now()-this.start_time,this.elapsed<Task.max_time&&this.process(t),t.promise},remove:function(t){var e=this.queue.indexOf(t);e>-1&&this.queue.splice(e,1)},process:function(t){if(!this.state.user_moving_view||!1!==t.user_moving_view||this.ignore_user_moving_view)return t.pause?(t.pause--,!0):(t.stats.calls++,t.start_time=performance.now(),t.run(t));Task._ignoreViewMoveWithDebounce()},processAll:function(){this.start_time=this.start_time||performance.now(),this.ignore_user_moving_view&&!this.hasPendingTasks()&&(this.ignore_user_moving_view=!1);for(var t=0;t<this.queue.length;t++){var e=this.queue[t];if(!0!==this.process(e)&&(e.pause||(e.pause=e.elapsed>e.max_time?e.pause_factor:0),e.total_elapsed+=e.elapsed),this.elapsed=performance.now()-this.start_time,this.elapsed>=Task.max_time){this.start_time=null;break}}},finish:function(t,e){return t.elapsed=performance.now()-t.start_time,t.total_elapsed+=t.elapsed,this.remove(t),t.resolve(e),t.promise},cancel:function(t){var e;t.cancel instanceof Function&&(e=t.cancel(t)),t.resolve(e||{})},shouldContinue:function(t){return t.elapsed=performance.now()-t.start_time,this.elapsed=performance.now()-this.start_time,t.elapsed<t.max_time&&this.elapsed<Task.max_time},removeForTile:function(t){for(var e=this.queue.length-1;e>=0;e--)this.queue[e].tile_id===t&&(this.cancel(this.queue[e]),this.queue.splice(e,1))},setState:function(t){this.state=t},hasPendingTasks:function(){return!!this.queue.length}};function sliceOptions(t){return{coords:t.coords,uid:t.uid,filtering:t.filtering,sprites:t.sprites,url:t.url,element:t.element,data:t.data,width:t.width,height:t.height,density:t.density,repeat:t.repeat,TEXTURE_WRAP_S:t.TEXTURE_WRAP_S,TEXTURE_WRAP_T:t.TEXTURE_WRAP_T,UNPACK_FLIP_Y_WEBGL:t.UNPACK_FLIP_Y_WEBGL,UNPACK_PREMULTIPLY_ALPHA_WEBGL:t.UNPACK_PREMULTIPLY_ALPHA_WEBGL}}var Texture=_createClass((function t(e,r,i){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};_classCallCheck(this,t),n=sliceOptions(n),this.gl=e,this.texture=e.createTexture(),this.texture&&(this.valid=!0),this.manager=i,this.bind(),this.name=r,this.retain_count=0,this.config_type=null,this.loading=null,this.loaded=!1,this.filtering=n.filtering,this.density=n.density||1,this.sprites=n.sprites,this.texcoords={},this.sizes={},this.css_sizes={},this.aspects={},this._byte_length=0,this.setData(1,1,new Uint8Array([0,0,0,0]),{filtering:"nearest"}),this.loaded=!1,this.manager.textures[this.name]&&(this.retain_count=this.manager.textures[this.name].retain_count,this.manager.textures[this.name].retain_count=0,this.manager.textures[this.name].destroy()),this.manager.textures[this.name]=this,this.manager.texture_configs[this.name]=JSON.stringify(Object.assign({name:r},n)),this.load(n),log("trace","creating Texture ".concat(this.name))}),[{key:"destroy",value:function(){var t=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).force;this.retain_count>0&&!t?log("error","Texture '".concat(this.name,"': destroying texture with retain count of '").concat(this.retain_count,"'")):this.valid&&(this.gl.deleteTexture(this.texture),this.texture=null,delete this.data,this.data=null,delete this.manager.textures[this.name],delete this.manager.texture_configs[this.name],this.valid=!1,this._byte_length=0,log("trace","destroying Texture ".concat(this.name)))}},{key:"retain",value:function(){this.retain_count++}},{key:"release",value:function(){this.retain_count<=0&&log("error","Texture '".concat(this.name,"': releasing texture with retain count of '").concat(this.retain_count,"'")),this.retain_count--,this.retain_count<=0&&this.destroy()}},{key:"bind",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;this.valid&&(this.manager.activeUnit!==t&&(this.gl.activeTexture(this.gl.TEXTURE0+t),this.manager.activeUnit=t,this.manager.boundTexture=null),this.manager.boundTexture!==this.texture&&(this.gl.bindTexture(this.gl.TEXTURE_2D,this.texture),this.manager.boundTexture=this.texture))}},{key:"load",value:function(t){var e=this;return t?(this.loading=null,"string"==typeof t.url?(this.config_type="url",this.setUrl(t.url,t)):t.element?(this.config_type="element",this.setElement(t.element,t)):t.data&&t.width&&t.height&&(this.config_type="data",this.setData(t.width,t.height,t.data,t)),this.loading=this.loading&&this.loading.then((function(){return e.calculateSprites(),e}))||Promise.resolve(this),this.loading):this.loading||Promise.resolve(this)}},{key:"setUrl",value:function(t){var e=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(this.valid)return this.url=t,this.loading=new Promise((function(t,i){var n=new Image;n.onload=function(){try{e.setElement(n,r)}catch(t){e.loaded=!1,log("warn","Texture '".concat(e.name,"': failed to load url: '").concat(e.url,"'"),t,r),e.manager.trigger("warning",{message:"Failed to load texture from ".concat(e.url),error:t,texture:r})}e.loaded=!0,t(e)},n.onerror=function(i){e.loaded=!1,log("warn","Texture '".concat(e.name,"': failed to load url: '").concat(e.url,"'"),i,r),e.manager.trigger("warning",{message:"Failed to load texture from ".concat(e.url),error:i,texture:r}),t(e)},Utils$1.isSafari()&&"data:"===e.url.slice(0,5)||(n.crossOrigin="anonymous"),n.src=e.url})),this.loading}},{key:"setData",value:function(t,e,r){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};return this.width=t,this.height=e,Array.isArray(r)&&(r=new Uint8Array(r)),this.update(r,i),this.setFiltering(i),this.loaded=!0,this.loading=Promise.resolve(this),this.loading}},{key:"setElement",value:function(t,e){var r=t;if("string"==typeof t&&(t=document.querySelector(t)),t instanceof HTMLCanvasElement||t instanceof HTMLImageElement||t instanceof HTMLVideoElement)this.update(t,e),this.setFiltering(e);else{this.loaded=!1;var i="the 'element' parameter (`element: ".concat(JSON.stringify(r),"`) must be a CSS ");i+="selector string, or a <canvas>, <image> or <video> object",log("warn","Texture '".concat(this.name,"': ").concat(i),e),this.manager.trigger("warning",{message:"Failed to load texture because ".concat(i),texture:e})}return this.loaded=!0,this.loading=Promise.resolve(this),this.loading}},{key:"update",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.valid&&(this.bind(),t instanceof HTMLCanvasElement||t instanceof HTMLVideoElement||t instanceof HTMLImageElement&&t.complete?(this.width=t.width,this.height=t.height,this._byte_length=this.width*this.height*4,this.gl.pixelStorei(this.gl.UNPACK_FLIP_Y_WEBGL,!1!==e.UNPACK_FLIP_Y_WEBGL),this.gl.pixelStorei(this.gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL,e.UNPACK_PREMULTIPLY_ALPHA_WEBGL||!1),this.gl.texImage2D(this.gl.TEXTURE_2D,0,this.gl.RGBA,this.gl.RGBA,this.gl.UNSIGNED_BYTE,t)):(this._byte_length=t?t.byteLength:0,this.gl.pixelStorei(this.gl.UNPACK_FLIP_Y_WEBGL,!1),this.gl.pixelStorei(this.gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1),this.gl.texImage2D(this.gl.TEXTURE_2D,0,this.gl.RGBA,this.width,this.height,0,this.gl.RGBA,this.gl.UNSIGNED_BYTE,t)),this.manager.trigger("update",this))}},{key:"getByteLength",value:function(){return this._byte_length}},{key:"setFiltering",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(this.valid){t.filtering=t.filtering||"linear";var e=this.gl;this.bind(),Utils$1.isPowerOf2(this.width)&&Utils$1.isPowerOf2(this.height)?(this.power_of_2=!0,e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,t.TEXTURE_WRAP_S||t.repeat&&e.REPEAT||e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,t.TEXTURE_WRAP_T||t.repeat&&e.REPEAT||e.CLAMP_TO_EDGE),"mipmap"===t.filtering?(this.filtering="mipmap",e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR_MIPMAP_LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.LINEAR),e.generateMipmap(e.TEXTURE_2D)):"linear"===t.filtering?(this.filtering="linear",e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.LINEAR)):"nearest"===t.filtering&&(this.filtering="nearest",e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.NEAREST))):(this.power_of_2=!1,e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),"nearest"===t.filtering?(this.filtering="nearest",e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.NEAREST)):(this.filtering="linear",e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.LINEAR))),this.manager.trigger("update",this)}}},{key:"calculateSprites",value:function(){if(this.sprites)for(var t in this.sprites){var e=this.sprites[t];this.texcoords[t]=this.manager.getTexcoordsForSprite([e[0],e[1]],[e[2],e[3]],[this.width,this.height]),this.sizes[t]=[e[2],e[3]],this.css_sizes[t]=[e[2]/this.density,e[3]/this.density],this.aspects[t]=e[2]/e[3]}}}]);function subscribeMixin(t){var e=[];return Object.assign(t,{subscribe:function(t){-1===e.indexOf(t)&&e.push(t)},unsubscribe:function(t){var r=e.indexOf(t);r>-1&&e.splice(r,1)},unsubscribeAll:function(){e=[]},trigger:function(t){for(var r=arguments.length,i=new Array(r>1?r-1:0),n=1;n<r;n++)i[n-1]=arguments[n];e.forEach((function(e){if("function"==typeof e[t])try{e[t].apply(e,i)}catch(e){log("warn","Caught exception in listener for event '".concat(t,"':"),e)}}))},hasSubscribersFor:function(t){var r=!1;return e.forEach((function(e){"function"==typeof e[t]&&(r=!0)})),r}})}var TextureManager=function(){function t(e){_classCallCheck(this,t),this.default=t.DEFAULT_TEXTURE_NAME,this.textures={},this.texture_configs={},this.boundTexture=null,this.activeUnit=null,this.scene_id=e,WorkerBroker.addTarget("Texture"+this.scene_id,this),subscribeMixin(this)}return _createClass(t,[{key:"create",value:function(e,r,i){for(var n=t.matchers_,o=0;o<n.length;o++){var a=n[o][0],s=n[o][1];if(s&&s(i))return new a(e,r,this,i)}return new Texture(e,r,this,i)}},{key:"retain",value:function(t){this.textures[t]&&this.textures[t].retain()}},{key:"release",value:function(t){this.textures[t]&&this.textures[t].release()}},{key:"getRetainCount",value:function(t){if(this.textures[t])return this.textures[t].retain_count}},{key:"getByteLength",value:function(t){if(this.textures[t])return this.textures[t].getByteLength()}},{key:"destroy",value:function(t){var e=this;Object.keys(this.textures).forEach((function(r){var i=e.textures[r];r!==e.default&&i.gl===t&&i.destroy({force:!0})}))}},{key:"getSpriteInfo",value:function(t,e){var r=this.textures[t];return r&&{size:r.sizes[e],css_size:r.css_sizes[e],aspect:r.aspects[e],texcoords:r.texcoords[e]}}},{key:"getTexcoordsForSprite",value:function(t,e,r){var i=r[1]-t[1]-e[1];return[t[0]/r[0],i/r[1],(e[0]+t[0])/r[0],(e[1]+i)/r[1]]}},{key:"createFromObject",value:function(t,e){var r=[];if(e)for(var i in e){var n=e[i];if(this.changed(i,n)){var o=this.create(t,i,n);r.push(o.loading)}}return Promise.all(r)}},{key:"createDefault",value:function(t){return this.create(t,this.default)}},{key:"changed",value:function(t,e){var r=this.textures[t];if(r){if("element"===r.config_type||null!=e.element)return!0;if(e=sliceOptions(e),this.texture_configs[t]===JSON.stringify(Object.assign({name:t},e)))return!1}return!0}},{key:"getInfo",value:function(t){var e=this;if(t||(t=Object.keys(this.textures)),Array.isArray(t))return Promise.all(t.map((function(t){return e.getInfo(t)})));var r=this.textures[t];return r?(r.loading||Promise.resolve(r)).then((function(){return{name:r.name,width:r.width,height:r.height,density:r.density,sprites:r.sprites,texcoords:r.texcoords,sizes:r.sizes,css_sizes:r.css_sizes,aspects:r.aspects,filtering:r.filtering,power_of_2:r.power_of_2,valid:r.valid}})):Promise.resolve(null)}},{key:"syncTexturesToWorker",value:function(t){var e=this;return Thread.is_main?Promise.all(t.map((function(t){var r=e.textures[t];return r&&r.loading||Promise.resolve()}))).then((function(){return e.textures})):WorkerBroker.postMessage("Texture"+this.scene_id+".getInfo",t).then((function(t){return t.forEach((function(t){e.textures[t.name]=t})),e.textures}))}},{key:"getMaxTextureSize",value:function(t){return t.getParameter(t.MAX_TEXTURE_SIZE)}}],[{key:"register",value:function(e,r){var i=t.matchers_;if(!(e instanceof Function&&r instanceof Function))throw"Invalid texture constructor or matcher";this.deRegister(e),i.push([e,r])}},{key:"deRegister",value:function(e){for(var r=t.matchers_,i=0;i<r.length;i++)r[i][0]===e&&r.splice(i,1)}}])}();TextureManager.DEFAULT_TEXTURE_NAME="__default",TextureManager.matchers_=[];var Registry={};function getTextureManager(t){return Registry[t]||(Registry[t]=new TextureManager(t)),Registry[t]}var transformMat4_1$1=transformMat4$1;function transformMat4$1(t,e,r){var i=e[0],n=e[1],o=e[2],a=r[3]*i+r[7]*n+r[11]*o+r[15];return a=a||1,t[0]=(r[0]*i+r[4]*n+r[8]*o+r[12])/a,t[1]=(r[1]*i+r[5]*n+r[9]*o+r[13])/a,t[2]=(r[2]*i+r[6]*n+r[10]*o+r[14])/a,t}var vec3_transformMat4=getDefaultExportFromCjs(transformMat4_1$1),normalFromMat4_1=normalFromMat4;function normalFromMat4(t,e){var r=e[0],i=e[1],n=e[2],o=e[3],a=e[4],s=e[5],l=e[6],u=e[7],c=e[8],h=e[9],p=e[10],f=e[11],d=e[12],y=e[13],g=e[14],v=e[15],m=r*s-i*a,_=r*l-n*a,b=r*u-o*a,x=i*l-n*s,w=i*u-o*s,E=n*u-o*l,T=c*y-h*d,A=c*g-p*d,S=c*v-f*d,k=h*g-p*y,I=h*v-f*y,P=p*v-f*g,O=m*P-_*I+b*k+x*S-w*A+E*T;return O?(O=1/O,t[0]=(s*P-l*I+u*k)*O,t[1]=(l*S-a*P-u*A)*O,t[2]=(a*I-s*S+u*T)*O,t[3]=(n*I-i*P-o*k)*O,t[4]=(r*P-n*S+o*A)*O,t[5]=(i*S-r*I-o*T)*O,t[6]=(y*E-g*w+v*x)*O,t[7]=(g*b-d*E-v*_)*O,t[8]=(d*w-y*b+v*m)*O,t):null}var mat3_normalFromMat4=getDefaultExportFromCjs(normalFromMat4_1),invert_1$1=invert$1;function invert$1(t,e){var r=e[0],i=e[1],n=e[2],o=e[3],a=e[4],s=e[5],l=e[6],u=e[7],c=e[8],h=c*a-s*u,p=-c*o+s*l,f=u*o-a*l,d=r*h+i*p+n*f;return d?(d=1/d,t[0]=h*d,t[1]=(-c*i+n*u)*d,t[2]=(s*i-n*a)*d,t[3]=p*d,t[4]=(c*r-n*l)*d,t[5]=(-s*r+n*o)*d,t[6]=f*d,t[7]=(-u*r+i*l)*d,t[8]=(a*r-i*o)*d,t):null}var mat3_invert=getDefaultExportFromCjs(invert_1$1),identity_1$1=identity$2;function identity$2(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t}var mat3_identity=getDefaultExportFromCjs(identity_1$1),multiply_1=multiply;function multiply(t,e,r){var i=e[0],n=e[1],o=e[2],a=e[3],s=e[4],l=e[5],u=e[6],c=e[7],h=e[8],p=e[9],f=e[10],d=e[11],y=e[12],g=e[13],v=e[14],m=e[15],_=r[0],b=r[1],x=r[2],w=r[3];return t[0]=_*i+b*s+x*h+w*y,t[1]=_*n+b*l+x*p+w*g,t[2]=_*o+b*u+x*f+w*v,t[3]=_*a+b*c+x*d+w*m,_=r[4],b=r[5],x=r[6],w=r[7],t[4]=_*i+b*s+x*h+w*y,t[5]=_*n+b*l+x*p+w*g,t[6]=_*o+b*u+x*f+w*v,t[7]=_*a+b*c+x*d+w*m,_=r[8],b=r[9],x=r[10],w=r[11],t[8]=_*i+b*s+x*h+w*y,t[9]=_*n+b*l+x*p+w*g,t[10]=_*o+b*u+x*f+w*v,t[11]=_*a+b*c+x*d+w*m,_=r[12],b=r[13],x=r[14],w=r[15],t[12]=_*i+b*s+x*h+w*y,t[13]=_*n+b*l+x*p+w*g,t[14]=_*o+b*u+x*f+w*v,t[15]=_*a+b*c+x*d+w*m,t}var mat4_multiply=getDefaultExportFromCjs(multiply_1),translate_1=translate;function translate(t,e,r){var i,n,o,a,s,l,u,c,h,p,f,d,y=r[0],g=r[1],v=r[2];return e===t?(t[12]=e[0]*y+e[4]*g+e[8]*v+e[12],t[13]=e[1]*y+e[5]*g+e[9]*v+e[13],t[14]=e[2]*y+e[6]*g+e[10]*v+e[14],t[15]=e[3]*y+e[7]*g+e[11]*v+e[15]):(i=e[0],n=e[1],o=e[2],a=e[3],s=e[4],l=e[5],u=e[6],c=e[7],h=e[8],p=e[9],f=e[10],d=e[11],t[0]=i,t[1]=n,t[2]=o,t[3]=a,t[4]=s,t[5]=l,t[6]=u,t[7]=c,t[8]=h,t[9]=p,t[10]=f,t[11]=d,t[12]=i*y+s*g+h*v+e[12],t[13]=n*y+l*g+p*v+e[13],t[14]=o*y+u*g+f*v+e[14],t[15]=a*y+c*g+d*v+e[15]),t}var mat4_translate=getDefaultExportFromCjs(translate_1),scale_1$1=scale$1;function scale$1(t,e,r){var i=r[0],n=r[1],o=r[2];return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t[3]=e[3]*i,t[4]=e[4]*n,t[5]=e[5]*n,t[6]=e[6]*n,t[7]=e[7]*n,t[8]=e[8]*o,t[9]=e[9]*o,t[10]=e[10]*o,t[11]=e[11]*o,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}var mat4_scale=getDefaultExportFromCjs(scale_1$1),perspective_1=perspective;function perspective(t,e,r,i,n){var o=1/Math.tan(e/2),a=1/(i-n);return t[0]=o/r,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=o,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=(n+i)*a,t[11]=-1,t[12]=0,t[13]=0,t[14]=2*n*i*a,t[15]=0,t}var mat4_perspective=getDefaultExportFromCjs(perspective_1),identity_1=identity$1;function identity$1(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}var mat4_identity=getDefaultExportFromCjs(identity_1),identity=identity_1,lookAt_1=lookAt;function lookAt(t,e,r,i){var n,o,a,s,l,u,c,h,p,f,d=e[0],y=e[1],g=e[2],v=i[0],m=i[1],_=i[2],b=r[0],x=r[1],w=r[2];return Math.abs(d-b)<1e-6&&Math.abs(y-x)<1e-6&&Math.abs(g-w)<1e-6?identity(t):(c=d-b,h=y-x,p=g-w,n=m*(p*=f=1/Math.sqrt(c*c+h*h+p*p))-_*(h*=f),o=_*(c*=f)-v*p,a=v*h-m*c,(f=Math.sqrt(n*n+o*o+a*a))?(n*=f=1/f,o*=f,a*=f):(n=0,o=0,a=0),s=h*a-p*o,l=p*n-c*a,u=c*o-h*n,(f=Math.sqrt(s*s+l*l+u*u))?(s*=f=1/f,l*=f,u*=f):(s=0,l=0,u=0),t[0]=n,t[1]=s,t[2]=c,t[3]=0,t[4]=o,t[5]=l,t[6]=h,t[7]=0,t[8]=a,t[9]=u,t[10]=p,t[11]=0,t[12]=-(n*d+o*y+a*g),t[13]=-(s*d+l*y+u*g),t[14]=-(c*d+h*y+p*g),t[15]=1,t)}var mat4_lookAt=getDefaultExportFromCjs(lookAt_1),copy_1=copy;function copy(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}var mat4_copy=getDefaultExportFromCjs(copy_1),invert_1=invert;function invert(t,e){var r=e[0],i=e[1],n=e[2],o=e[3],a=e[4],s=e[5],l=e[6],u=e[7],c=e[8],h=e[9],p=e[10],f=e[11],d=e[12],y=e[13],g=e[14],v=e[15],m=r*s-i*a,_=r*l-n*a,b=r*u-o*a,x=i*l-n*s,w=i*u-o*s,E=n*u-o*l,T=c*y-h*d,A=c*g-p*d,S=c*v-f*d,k=h*g-p*y,I=h*v-f*y,P=p*v-f*g,O=m*P-_*I+b*k+x*S-w*A+E*T;return O?(O=1/O,t[0]=(s*P-l*I+u*k)*O,t[1]=(n*I-i*P-o*k)*O,t[2]=(y*E-g*w+v*x)*O,t[3]=(p*w-h*E-f*x)*O,t[4]=(l*S-a*P-u*A)*O,t[5]=(r*P-n*S+o*A)*O,t[6]=(g*b-d*E-v*_)*O,t[7]=(c*E-p*b+f*_)*O,t[8]=(a*I-s*S+u*T)*O,t[9]=(i*S-r*I-o*T)*O,t[10]=(d*w-y*b+v*m)*O,t[11]=(h*b-c*w-f*m)*O,t[12]=(s*A-a*k-l*T)*O,t[13]=(r*k-i*A+n*T)*O,t[14]=(y*_-d*x-g*m)*O,t[15]=(c*x-h*_+p*m)*O,t):null}var mat4_invert=getDefaultExportFromCjs(invert_1),transformMat4_1=transformMat4;function transformMat4(t,e,r){var i=e[0],n=e[1],o=e[2],a=e[3];return t[0]=r[0]*i+r[4]*n+r[8]*o+r[12]*a,t[1]=r[1]*i+r[5]*n+r[9]*o+r[13]*a,t[2]=r[2]*i+r[6]*n+r[10]*o+r[14]*a,t[3]=r[3]*i+r[7]*n+r[11]*o+r[15]*a,t}var vec4_transformMat4=getDefaultExportFromCjs(transformMat4_1),normalize_1=normalize;function normalize(t,e){var r=e[0],i=e[1],n=e[2],o=e[3],a=r*r+i*i+n*n+o*o;return a>0&&(a=1/Math.sqrt(a),t[0]=r*a,t[1]=i*a,t[2]=n*a,t[3]=o*a),t}var vec4_normalize=getDefaultExportFromCjs(normalize_1),scale_1=scale;function scale(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t}var vec4_scale=getDefaultExportFromCjs(scale_1),vec3={fromValues:function(t,e,r){var i=new Float64Array(3);return i[0]=t,i[1]=e,i[2]=r,i},transformMat4:vec3_transformMat4},mat3={normalFromMat4:mat3_normalFromMat4,invert:mat3_invert,identity:mat3_identity},mat4={multiply:mat4_multiply,translate:mat4_translate,scale:mat4_scale,perspective:mat4_perspective,lookAt:mat4_lookAt,identity:mat4_identity,copy:mat4_copy,invert:mat4_invert},vec4={transformMat4:vec4_transformMat4,normalize:vec4_normalize,scale:vec4_scale},FeatureSelection=function(){function t(e,r){_classCallCheck(this,t),this._gl=e,this._requests={},this._pixels=null,this._has_dirty_buffer=!1,this._fbo=this._gl.createFramebuffer(),this._gl.bindFramebuffer(this._gl.FRAMEBUFFER,this._fbo),this._fbo_size={width:256,height:256};var i=getTextureManager(r).create(this._gl,"selection_fbo",{filtering:"nearest"});i.setData(this._fbo_size.width,this._fbo_size.height,null,{filtering:"nearest"}),this._gl.framebufferTexture2D(this._gl.FRAMEBUFFER,this._gl.COLOR_ATTACHMENT0,this._gl.TEXTURE_2D,i.texture,0);var n=this._gl.createRenderbuffer();this._gl.bindRenderbuffer(this._gl.RENDERBUFFER,n),this._gl.renderbufferStorage(this._gl.RENDERBUFFER,this._gl.DEPTH_COMPONENT16,this._fbo_size.width,this._fbo_size.height),this._gl.framebufferRenderbuffer(this._gl.FRAMEBUFFER,this._gl.DEPTH_ATTACHMENT,this._gl.RENDERBUFFER,n),this._gl.bindFramebuffer(this._gl.FRAMEBUFFER,null)}return _createClass(t,[{key:"destroy",value:function(){this._gl&&this._fbo&&(this._gl.deleteFramebuffer(this._fbo),this._fbo=null,this._gl.bindFramebuffer(this._gl.FRAMEBUFFER,null))}},{key:"bind",value:function(){var e;this._gl.bindFramebuffer(this._gl.FRAMEBUFFER,this._fbo),this._gl.viewport(0,0,this._fbo_size.width,this._fbo_size.height),(e=this._gl).clearColor.apply(e,_toConsumableArray(t.defaultColor))}},{key:"getFeatureAt",value:function(e,r,i){var n=r.radius,o=r.top_most_only,a=void 0===o||o;!e||e.x<0||e.y<0||e.x>1||e.y>1?i({features:null}):(this.selection_request_id=this.selection_request_id+1||0,this._requests[this.selection_request_id]={id:this.selection_request_id,point:e,radius:n,top_most_only:a,ttl:a?1:t.MAX_PICKING_TRIES,callback:i})}},{key:"has_dirty_buffer",get:function(){return this._has_dirty_buffer},set:function(t){this._has_dirty_buffer=!!this._pending_deep_request}},{key:"hasPendingRequests",value:function(){return Object.keys(this._requests).length>0}},{key:"clearPendingRequests",value:function(){for(var t in this._requests)this._requests[t].callback(new Error("cleared")),delete this._requests[t];this._pending_deep_request=null}},{key:"read",value:function(t){if(this.hasPendingRequests()){var e=this._gl;for(var r in e.bindFramebuffer(e.FRAMEBUFFER,this._fbo),this._pending_deep_request&&this.processRequest(this._pending_deep_request,t),this._requests)if(this.processRequest(this._requests[r],t))break;e.bindFramebuffer(e.FRAMEBUFFER,null)}}},{key:"processRequest",value:function(e,r){var i,n,o=this._gl,a=255,s=e.point,l=e.radius;if(l){var u=Math.min(this._fbo_size.width,this._fbo_size.height);n={x:Math.min(Math.ceil(2*l.x*this._fbo_size.width),u),y:Math.min(Math.ceil(2*l.y*this._fbo_size.height),u)}}else l={x:0,y:0},n={x:1,y:1};var c=n.x*n.y*4;if(null==this._pixels||this._pixels.byteLength<c)this._pixels=new Uint8Array(c);else if(this._pixels.fill instanceof Function)this._pixels.fill(0,0,c);else for(var h=0;h<c;h++)this._pixels[h]=0;o.readPixels(Math.round((s.x-l.x)*this._fbo_size.width),Math.round((1-s.y-l.y)*this._fbo_size.height),n.x,n.y,o.RGBA,o.UNSIGNED_BYTE,this._pixels),e.ttl--;var p=Math.floor(n.x/2),f=Math.floor(n.y/2),d=4*(f*n.x+p),y=this._pixels.slice(d,d+4),g=y[0]+(y[1]<<8)+(y[2]<<16);if(g>0)i=g+(y[3]<<24)>>>0,a=y[3];else if(c>4){var v=1/0;d=0;for(var m=0;m<n.y;m++)for(var _=0;_<n.x;_++,d+=4)if((g=(y=this._pixels.slice(d,d+4))[0]+(y[1]<<8)+(y[2]<<16))>0){var b=Math.pow(_-p,2)+Math.pow(m-f,2);b<v&&(i=g+(y[3]<<24)>>>0,a=y[3],v=b)}}if(255!==a){var x=this._getFeatureByKey(i,r);if(e.features||(e.features=[]),!x)return void this._finishRead(e);if(e.features.every((function(t){return t.id!==x.id}))&&e.features.push(x),e.ttl)return this._pending_deep_request=e,t._discardColor(y),this._has_dirty_buffer=!0,!0;this._finishRead(e)}else this._finishRead(e)}},{key:"_finishRead",value:function(e){var r=e.features||t.EMPTY_ARRAY;e.top_most_only||(this._pending_deep_request=null,t._resetDiscardedColors()),delete this._requests[e.id],e.callback({features:r})}},{key:"_getFeatureByKey",value:function(t,e){for(var r=null,i=0;i<e.length;i++){var n=e[i];if(n.selection_data&&(r=n.selection_data[t])){r.tile={coords:n.coords};break}}return r}},{key:"setupDiscards",value:function(e){for(var r=t.MAX_PICKING_TRIES;r--;)e.uniform("4fv","u_selection_discard".concat(r),t._discarded_colors[r]||t.defaultColor)}}],[{key:"makeEntry",value:function(){this.map_entry++;var t=255&this.map_entry,e=this.map_entry>>8&255,r=this.map_entry>>16&255,i=this.map_prefix;return{key:t+(e<<8)+(r<<16)+(i<<24)>>>0,color:[t/255,e/255,r/255,i/255]}}},{key:"reset",value:function(){this.map_entry=0}},{key:"setPrefix",value:function(t){this.map_prefix=t}},{key:"_discardColor",value:function(t){this._discarded_colors.push([t[0]/255,t[1]/255,t[2]/255,t[3]/255])}},{key:"_resetDiscardedColors",value:function(){this._discarded_colors.length=0}}])}();FeatureSelection._discarded_colors=[],FeatureSelection.map_entry=0,FeatureSelection.map_prefix=0,FeatureSelection.defaultColor=[0,0,0,1],FeatureSelection.MAX_PICKING_TRIES=10,FeatureSelection.EMPTY_ARRAY=Object.freeze([]);var GLSL={parseUniforms:function(t){var e=[];for(var r in t){var i,n=r,o=t[r];if("number"==typeof o)e.push({type:"float",method:"1f",name:r,value:o,key:n,uniforms:t});else if(Array.isArray(o)){if("number"==typeof o[0])o.length>=2&&o.length<=4?e.push({type:"vec"+o.length,method:o.length+"fv",name:r,value:o,key:n,uniforms:t}):o.length>4&&e.push({type:"float[]",method:"1fv",name:r+"[0]",value:o,key:n,uniforms:t});else if("string"==typeof o[0])for(i=0;i<o.length;i++)e.push({type:"sampler2D",method:"1i",name:r+"["+i+"]",value:o[i],key:i,uniforms:o});else if(Array.isArray(o[0])&&"number"==typeof o[0][0]&&o[0].length>=2&&o[0].length<=4)for(i=0;i<o.length;i++)e.push({type:"vec"+o[0].length,method:o[i].length+"fv",name:r+"["+i+"]",value:o[i],key:i,uniforms:o})}else"boolean"==typeof o?e.push({type:"bool",method:"1i",name:r,value:o,key:n,uniforms:t}):"string"==typeof o&&e.push({type:"sampler2D",method:"1i",name:r,value:o,key:n,uniforms:t})}return e},defineVariable:function(t,e){var r,i;if("number"==typeof e)r="float";else if(Array.isArray(e))"number"==typeof e[0]?e.length>=2&&e.length<=4?r="vec"+e.length:(r="float",i=e.length):"string"==typeof e[0]&&(r="sampler2D",i=e.length);else if("boolean"==typeof e)r="bool";else{if("string"!=typeof e)return;r="sampler2D"}var n="";return n+="".concat(r," ").concat(t),i&&(n+="[".concat(i,"]")),n+";\n"},defineUniform:function(t,e){var r=GLSL.defineVariable(t,e);if(r)return"uniform "+r},isUniformDefined:function(t,e){var r=new RegExp("uniform[^;]+(?:{[\\s\\S]*})?[^;]*\\b"+t+"\\b","g");return!!e.match(r)},isSymbolReferenced:function(t,e){var r=new RegExp("\\b"+t+"\\b","g");return e.search(r)>=0},expandVec3:function(t){var e,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;if(Array.isArray(t)){if(2!==t.length)return t;e=[].concat(_toConsumableArray(t),[r]).map(parseFloat)}else e=[t,t,t].map(parseFloat);if(e&&e.every((function(t){return"number"==typeof t&&!isNaN(t)})))return e},expandVec4:function(t){var e,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;if(Array.isArray(t)){if(3!==t.length)return t;e=[].concat(_toConsumableArray(t),[r]).map(parseFloat)}else e=[t,t,t,r].map(parseFloat);if(e&&e.every((function(t){return"number"==typeof t&&!isNaN(t)})))return e}},extensions=[];function getExtension(t,e){var r=extensions.filter((function(e){return e[0]===t}))[0];return(r=r&&r[1])||(extensions.push([t,{}]),r=extensions[extensions.length-1][1]),r[e]||(r[e]=t.getExtension(e)),r[e]}function hashString(t){var e,r,i=0;if(0===t.length)return i;for(e=0,r=t.length;e<r;e++)i=(i<<5)-i+t.charCodeAt(e),i|=0;return i}var stripComments={exports:{}},reBlock="\\/\\*",reBlockIgnore="\\/\\*(?!\\*?\\!)",reBlockEnd="(.|[\\r\\n]|\\n)*?\\*\\/\\n?\\n?",reLine=/(^|[^\S\n])(?:\/\/)([\s\S]+?)$/gm,reLineIgnore=/(^|[^\S\n])(?:\/\/[^!])([\s\S]+?)$/gm,strip=stripComments.exports=function(t,e){return t?strip.block(strip.line(t,e),e):""};strip.block=function(t,e){e=e||{};var r=new RegExp(reBlock+reBlockEnd,"gm");return e.safe&&(r=new RegExp(reBlockIgnore+reBlockEnd,"gm")),t?t.replace(r,""):""},strip.line=function(t,e){var r=reLine;return(e=e||{}).safe&&(r=reLineIgnore),t?t.replace(r,""):""};var stripCommentsExports=stripComments.exports,strip$1=getDefaultExportFromCjs(stripCommentsExports),glShaderErrors=parseErrors;function parseErrors(t){t=String(t);for(var e,r=[];e=t.match(/ERROR\:([^\n]+)/);){t=t.slice(e.index+1);var i=(a=e[1].trim()).split(":"),n=i.slice(2).join(":").trim(),o=parseInt(i[0],10),a=parseInt(i[1],10);r.push({message:n,file:o,line:a})}return r}var parseShaderErrors=getDefaultExportFromCjs(glShaderErrors),re_pragma=/^\s*#pragma.*$/gm,re_continue_line=/\\\s*\n/gm,ShaderProgram=function(){function t(e,r,i,n,o){if(_classCallCheck(this,t),o=o||{},this.textureManager=getTextureManager(n),this.gl=e,this.program=null,this.compiled=!1,this.compiling=!1,this.error=null,!t.polyfills[n]){t.polyfills[n]={};try{this.gl.uniformMatrix3fv(null,!1,new Float64Array(9))}catch(e){t.polyfills[n].uniformMatrix3fv=this.gl.uniformMatrix3fv,this.gl.uniformMatrix3fv=function(e,r,i){t.polyfills[n].uniformMatrix3fv.call(this,e,r,new Float32Array(i))}}try{this.gl.uniformMatrix4fv(null,!1,new Float64Array(16))}catch(e){t.polyfills[n].uniformMatrix4fv=this.gl.uniformMatrix4fv,this.gl.uniformMatrix4fv=function(e,r,i){t.polyfills[n].uniformMatrix4fv.call(this,e,r,new Float32Array(i))}}}this.defines=Object.assign({},o.defines||{}),this.blocks=Object.assign({},o.blocks||{}),this.block_scopes=Object.assign({},o.block_scopes||{}),this.extensions=o.extensions||[],this.dependent_uniforms=o.uniforms,this.uniforms={},this.attribs={},this.vertex_source=r,this.fragment_source=i,this.id=t.id++,this.name=o.name}return _createClass(t,[{key:"destroy",value:function(){this.gl.useProgram(null),this.gl.deleteProgram(this.program),this.program=null,this.uniforms={},this.attribs={},this.compiled=!1}},{key:"use",value:function(){this.compiled&&(t.current!==this&&this.gl.useProgram(this.program),t.current=this)}},{key:"compile",value:function(){var e=this;if(this.compiling)throw new Error("ShaderProgram.compile(): skipping for ".concat(this.id," (").concat(this.name,") because already compiling"));this.compiling=!0,this.compiled=!1,this.error=null,this.computed_vertex_source=this.vertex_source,this.computed_fragment_source=this.fragment_source;var r,i=this.checkExtensions(),n=this.buildDefineList(),o=this.buildShaderBlockList();for(var a in o){var s=o[a];if(s&&(!Array.isArray(s)||0!==s.length)){r=new RegExp("^\\s*#pragma\\s+tangram:\\s+"+a+"\\s*$","m");var l=this.computed_vertex_source.match(r),u=this.computed_fragment_source.match(r);if(null!=l||null!=u){var c="";s.forEach((function(t){var e="".concat(t.scope,", ").concat(t.key,", ").concat(t.num);c+="\n// tangram-block-start: ".concat(e,"\n"),c+=t.source,c+="\n// tangram-block-end: ".concat(e,"\n")})),null!=l&&(this.computed_vertex_source=this.computed_vertex_source.replace(r,c)),null!=u&&(this.computed_fragment_source=this.computed_fragment_source.replace(r,c)),n["TANGRAM_BLOCK_"+a.replace(/[\s-]+/g,"_").toUpperCase()]=!0}}}this.computed_vertex_source=this.computed_vertex_source.replace(re_pragma,""),this.computed_fragment_source=this.computed_fragment_source.replace(re_pragma,""),this.ensureUniforms(this.dependent_uniforms);var h,p=this.gl.getShaderPrecisionFormat(this.gl.FRAGMENT_SHADER,this.gl.HIGH_FLOAT);h=p&&p.precision>0?"precision highp float;\n":"precision mediump float;\n",n.TANGRAM_VERTEX_SHADER=!0,n.TANGRAM_FRAGMENT_SHADER=!1,this.computed_vertex_source=h+t.buildDefineString(n)+this.computed_vertex_source,n.TANGRAM_VERTEX_SHADER=!1,n.TANGRAM_FRAGMENT_SHADER=!0,this.computed_fragment_source=t.buildExtensionString(i)+h+t.buildDefineString(n)+this.computed_fragment_source,this.computed_vertex_source=this.computed_vertex_source.replace(re_continue_line,""),this.computed_fragment_source=this.computed_fragment_source.replace(re_continue_line,"");try{this.program=t.updateProgram(this.gl,this.program,this.computed_vertex_source,this.computed_fragment_source),this.compiled=!0,this.compiling=!1}catch(t){throw this.program=null,this.compiled=!1,this.compiling=!1,this.error=t,"vertex"!==t.type&&"fragment"!==t.type||(this.shader_errors=t.errors,this.shader_errors.forEach((function(r){r.type=t.type,r.block=e.block(t.type,r.line)}))),t}this.computed_vertex_source=null,this.computed_fragment_source=null,this.use(),this.refreshUniforms(),this.refreshAttributes()}},{key:"buildDefineList",value:function(){var e,r={};for(e in t.defines)r[e]=t.defines[e];for(e in this.defines)r[e]=this.defines[e];return r}},{key:"buildShaderBlockList",value:function(){var e,r={};for(e in t.blocks){var i;r[e]=[],Array.isArray(t.blocks[e])?(i=r[e]).push.apply(i,_toConsumableArray(t.blocks[e].map((function(t,r){return{key:e,source:t,num:r,scope:"ShaderProgram"}})))):r[e]=[{key:e,source:t.blocks[e],num:0,scope:"ShaderProgram"}]}for(e in this.blocks)if(r[e]=r[e]||[],Array.isArray(this.blocks[e]))for(var n=this.block_scopes&&this.block_scopes[e]||[],o=null,a=0,s=0;s<this.blocks[e].length;s++)n[s]!==o&&(o=n[s],a=0),r[e].push({key:e,source:this.blocks[e][s],num:a,scope:o||this.name}),a++;else r[e].push({key:e,source:this.blocks[e],num:0,scope:this.name});return r}},{key:"ensureUniforms",value:function(t){if(t){var e,r=strip$1(this.computed_vertex_source),i=strip$1(this.computed_fragment_source),n=[],o=[];for(var a in t){var s=GLSL.isUniformDefined(a,r),l=GLSL.isUniformDefined(a,i);if(!s||!l){if(!(e=GLSL.defineUniform(a,t[a])))continue;s||(log("trace","Program ".concat(this.name,": ").concat(a," not defined in vertex shader, injecting: '").concat(e,"'")),n.push(e)),l||(log("trace","Program ".concat(this.name,": ").concat(a," not defined in fragment shader, injecting: '").concat(e,"'")),o.push(e))}}n.length>0&&(this.computed_vertex_source=n.join("\n")+this.computed_vertex_source),o.length>0&&(this.computed_fragment_source=o.join("\n")+this.computed_fragment_source)}}},{key:"setUniforms",value:function(t){var e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(this.compiled){e&&(this.texture_unit=0);for(var r=GLSL.parseUniforms(t),i=0;i<r.length;i++){var n=r[i];"sampler2D"===n.type?this.setTextureUniform(n.name,n.value):this.uniform(n.method,n.name,n.value)}}}},{key:"saveUniforms",value:function(t){var e=t||this.uniforms;for(var r in e){var i=this.uniforms[r];i&&(i.saved_value=i.value)}this.saved_texture_unit=this.texture_unit||0}},{key:"restoreUniforms",value:function(t){var e=t||this.uniforms;for(var r in e){var i=this.uniforms[r];i&&i.saved_value&&(i.value=i.saved_value,this.updateUniform(i))}this.texture_unit=this.saved_texture_unit||0}},{key:"setTextureUniform",value:function(t,e){var r=this.textureManager.textures[e];null!=r?(r.bind(this.texture_unit),this.uniform("1i",t,this.texture_unit),this.texture_unit++):log("warn","Cannot find texture '".concat(e,"'"))}},{key:"uniform",value:function(t,e,r){if(this.compiled){this.uniforms[e]=this.uniforms[e]||{};var i=this.uniforms[e];i.name=e,void 0===i.location&&(i.location=this.gl.getUniformLocation(this.program,e)),i.method=t,i.value=r,this.updateUniform(i)}}},{key:"updateUniform",value:function(t){this.compiled&&t&&null!=t.location&&(this.use(),this.commitUniform(t))}},{key:"commitUniform",value:function(t){var e=t.location,r=t.value;switch(t.method){case"1i":this.gl.uniform1i(e,r);break;case"1f":this.gl.uniform1f(e,r);break;case"2f":this.gl.uniform2f(e,r[0],r[1]);break;case"3f":this.gl.uniform3f(e,r[0],r[1],r[2]);break;case"4f":this.gl.uniform4f(e,r[0],r[1],r[2],r[3]);break;case"1iv":this.gl.uniform1iv(e,r);break;case"3iv":this.gl.uniform3iv(e,r);break;case"1fv":this.gl.uniform1fv(e,r);break;case"2fv":this.gl.uniform2fv(e,r);break;case"3fv":this.gl.uniform3fv(e,r);break;case"4fv":this.gl.uniform4fv(e,r);break;case"Matrix3fv":this.gl.uniformMatrix3fv(e,!1,r);break;case"Matrix4fv":this.gl.uniformMatrix4fv(e,!1,r)}}},{key:"refreshUniforms",value:function(){if(this.compiled)for(var t in this.uniforms){var e=this.uniforms[t];e.location=this.gl.getUniformLocation(this.program,t),this.updateUniform(e)}}},{key:"refreshAttributes",value:function(){this.attribs={}}},{key:"attribute",value:function(t){if(this.compiled){var e=this.attribs[t]=this.attribs[t]||{};return null!=e.location||(e.name=t,e.location=this.gl.getAttribLocation(this.program,t)),e}}},{key:"source",value:function(t){return"vertex"===t?this.computed_vertex_source:"fragment"===t?this.computed_fragment_source:void 0}},{key:"lines",value:function(t){var e=this.source(t);return e?e.split("\n"):[]}},{key:"line",value:function(t,e){var r=this.lines(t);if(r)return r[e]}},{key:"block",value:function(t,e){for(var r,i=this.lines(t),n=0;n<e&&n<i.length;n++){var o=i[n],a=o.match(/\/\/ tangram-block-start: ([A-Za-z0-9_-]+), ([A-Za-z0-9_-]+), (\d+)/);a&&a.length>1?r={scope:a[1],name:a[2],num:a[3]}:(a=o.match(/\/\/ tangram-block-end: ([A-Za-z0-9_-]+), ([A-Za-z0-9_-]+), (\d+)/))&&a.length>1&&(r=null),r&&(r.line=null==r.line?-1:r.line+1,r.source=o)}return r}},{key:"checkExtensions",value:function(){var t=this,e=[];return this.extensions.forEach((function(r){var i=getExtension(t.gl,r),n="TANGRAM_EXTENSION_".concat(r);t.defines[n]=null!=i,i?e.push(r):log("debug","Could not enable extension '".concat(r,"'"))})),e}}])}();ShaderProgram.polyfills={},ShaderProgram.id=0,ShaderProgram.current=null,ShaderProgram.defines={},ShaderProgram.blocks={},ShaderProgram.reset=function(){ShaderProgram.programs_by_source={},ShaderProgram.shaders_by_source={}},ShaderProgram.reset(),ShaderProgram.buildDefineString=function(t){var e="";for(var r in t)null!=t[r]&&!1!==t[r]&&("boolean"==typeof t[r]&&!0===t[r]?e+="#define "+r+"\n":"number"==typeof t[r]&&Math.floor(t[r])===t[r]?e+="#define "+r+" "+t[r].toFixed(1)+"\n":e+="#define "+r+" "+t[r]+"\n");return e},ShaderProgram.buildExtensionString=function(t){var e="";return(t=t||[]).forEach((function(t){e+="#ifdef GL_".concat(t,"\n#extension GL_").concat(t," : enable\n#endif\n")})),e},ShaderProgram.addBlock=function(t){var e;ShaderProgram.blocks[t]=ShaderProgram.blocks[t]||[];for(var r=arguments.length,i=new Array(r>1?r-1:0),n=1;n<r;n++)i[n-1]=arguments[n];(e=ShaderProgram.blocks[t]).push.apply(e,i)},ShaderProgram.removeBlock=function(t){ShaderProgram.blocks[t]=[]},ShaderProgram.replaceBlock=function(t){ShaderProgram.removeBlock(t);for(var e=arguments.length,r=new Array(e>1?e-1:0),i=1;i<e;i++)r[i-1]=arguments[i];ShaderProgram.addBlock.apply(ShaderProgram,[t].concat(r))},ShaderProgram.updateProgram=function(t,e,r,i){var n=hashString(t._tangram_id+"::"+r+"::"+i);if(ShaderProgram.programs_by_source[n])return log("trace","Reusing identical source GL program object"),ShaderProgram.programs_by_source[n];var o=ShaderProgram.createShader(t,r,t.VERTEX_SHADER),a=ShaderProgram.createShader(t,i,t.FRAGMENT_SHADER);if(t.useProgram(null),null!=e)for(var s=t.getAttachedShaders(e),l=0;l<s.length;l++)t.detachShader(e,s[l]);else e=t.createProgram();if(null==o||null==a)return e;if(t.attachShader(e,o),t.attachShader(e,a),t.linkProgram(e),!t.getProgramParameter(e,t.LINK_STATUS)){var u=new Error("WebGL program error:\n            VALIDATE_STATUS: ".concat(t.getProgramParameter(e,t.VALIDATE_STATUS),"\n            ERROR: ").concat(t.getError(),"\n            --- Vertex Shader ---\n            ").concat(r,"\n            --- Fragment Shader ---\n            ").concat(i));throw Object.assign(new Error(u),{type:"program"})}return ShaderProgram.programs_by_source[n]=e,e},ShaderProgram.createShader=function(t,e,r){var i=hashString(t._tangram_id+"::"+e);if(ShaderProgram.shaders_by_source[i])return log("trace","Reusing identical source GL shader object"),ShaderProgram.shaders_by_source[i];var n=t.createShader(r);if(t.shaderSource(n,e),t.compileShader(n),!t.getShaderParameter(n,t.COMPILE_STATUS)){var o=r===t.VERTEX_SHADER?"vertex":"fragment",a=t.getShaderInfoLog(n),s=parseShaderErrors(a);throw Object.assign(new Error(a),{type:o,errors:s})}return ShaderProgram.shaders_by_source[i]=n,n};var VertexArrayObject={disabled:!1,bound_vao:[],init:function(t){var e;!0!==this.disabled&&(e=getExtension(t,"OES_vertex_array_object")),null!=e?log("info","Vertex Array Object extension available"):!0!==this.disabled?log("warn","Vertex Array Object extension NOT available"):log("warn","Vertex Array Object extension force disabled")},create:function(t,e,r){var i={};i.setup=e,i.teardown=r;var n=getExtension(t,"OES_vertex_array_object");return null!=n&&(i._vao=n.createVertexArrayOES(),n.bindVertexArrayOES(i._vao)),i.setup(!0),i},getCurrentBinding:function(t){var e=this.bound_vao.filter((function(e){return e[0]===t}))[0];return e&&e[1]},setCurrentBinding:function(t,e){var r=this.bound_vao,i=r.filter((function(e){return e[0]===t}))[0];null==i?r.push([t,e]):i[1]=e},bind:function(t,e){var r=getExtension(t,"OES_vertex_array_object");if(null!=e)null!=r&&null!=e._vao?(r.bindVertexArrayOES(e._vao),this.setCurrentBinding(t,e)):e.setup(!1);else{var i=this.getCurrentBinding(t);null!=r?r.bindVertexArrayOES(null):null!=i&&"function"==typeof i.teardown&&i.teardown(),this.setCurrentBinding(t,null)}},destroy:function(t,e){var r=getExtension(t,"OES_vertex_array_object");null!=r&&null!=e&&null!=e._vao&&(r.deleteVertexArrayOES(e._vao),e._vao=null)}},VBOMesh=_createClass((function t(e,r,i,n,o,a){_classCallCheck(this,t),a=a||{},this.textureManager=getTextureManager(o),this.gl=e,this.vertex_data=r,this.element_data=i,this.vertex_layout=n,this.vertex_buffer=this.gl.createBuffer(),this.buffer_size=this.vertex_data.byteLength,this.draw_mode=a.draw_mode||this.gl.TRIANGLES,this.data_usage=a.data_usage||this.gl.STATIC_DRAW,this.vertices_per_geometry=3,this.uniforms=a.uniforms,this.textures=a.textures,this.retain=a.retain||!1,this.created_at=+new Date,this.fade_in_time=a.fade_in_time||0,this.vertex_count=this.vertex_data.byteLength/this.vertex_layout.stride,this.element_count=0,this.vaos={},this.toggle_element_array=!1,this.element_data?(this.toggle_element_array=!0,this.element_count=this.element_data.length,this.geometry_count=this.element_count/this.vertices_per_geometry,this.element_type=this.element_data.constructor===Uint16Array?this.gl.UNSIGNED_SHORT:this.gl.UNSIGNED_INT,this.element_buffer=this.gl.createBuffer(),this.buffer_size+=this.element_data.byteLength,this.gl.bindBuffer(this.gl.ELEMENT_ARRAY_BUFFER,this.element_buffer),this.gl.bufferData(this.gl.ELEMENT_ARRAY_BUFFER,this.element_data,this.data_usage)):this.geometry_count=this.vertex_count/this.vertices_per_geometry,this.upload(),this.retain||(delete this.vertex_data,delete this.element_data),this.valid=!0}),[{key:"render",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(!this.valid)return!1;var e=t.program||ShaderProgram.current;e.use(),this.uniforms&&(e.saveUniforms(this.uniforms),e.setUniforms(this.uniforms,!1));var r=(+new Date-this.created_at)/1e3;return e.uniform("1f","u_visible_time",r),this.bind(e),this.toggle_element_array?this.gl.drawElements(this.draw_mode,this.element_count,this.element_type,0):this.gl.drawArrays(this.draw_mode,0,this.vertex_count),VertexArrayObject.bind(this.gl,null),this.uniforms&&e.restoreUniforms(this.uniforms),r<this.fade_in_time}},{key:"bind",value:function(t){var e=this,r=this.vaos[t.id];r?VertexArrayObject.bind(this.gl,r):this.vaos[t.id]=VertexArrayObject.create(this.gl,(function(r){e.gl.bindBuffer(e.gl.ARRAY_BUFFER,e.vertex_buffer),e.toggle_element_array&&e.gl.bindBuffer(e.gl.ELEMENT_ARRAY_BUFFER,e.element_buffer),e.vertex_layout.enable(e.gl,t,r)}))}},{key:"upload",value:function(){this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.vertex_buffer),this.gl.bufferData(this.gl.ARRAY_BUFFER,this.vertex_data,this.data_usage)}},{key:"destroy",value:function(){var t=this;if(!this.valid)return!1;for(var e in this.valid=!1,this.vaos)VertexArrayObject.destroy(this.gl,this.vaos[e]);return this.gl.deleteBuffer(this.vertex_buffer),this.vertex_buffer=null,this.element_buffer&&(this.gl.deleteBuffer(this.element_buffer),this.element_buffer=null),delete this.vertex_data,delete this.element_data,this.textures&&this.textures.forEach((function(e){return t.textureManager.release(e)})),!0}}]),shaderSrc_material="/*Defines globals:materiallight_accumulator_**/struct Material{\n#ifdef TANGRAM_MATERIAL_EMISSION\nvec4 emission;\n#ifdef TANGRAM_MATERIAL_EMISSION_TEXTURE\nvec3 emissionScale;\n#endif\n#endif\n#ifdef TANGRAM_MATERIAL_AMBIENT\nvec4 ambient;\n#ifdef TANGRAM_MATERIAL_AMBIENT_TEXTURE\nvec3 ambientScale;\n#endif\n#endif\n#ifdef TANGRAM_MATERIAL_DIFFUSE\nvec4 diffuse;\n#ifdef TANGRAM_MATERIAL_DIFFUSE_TEXTURE\nvec3 diffuseScale;\n#endif\n#endif\n#ifdef TANGRAM_MATERIAL_SPECULAR\nvec4 specular;float shininess;\n#ifdef TANGRAM_MATERIAL_SPECULAR_TEXTURE\nvec3 specularScale;\n#endif\n#endif\n#ifdef TANGRAM_MATERIAL_NORMAL_TEXTURE\nvec3 normalScale;float normalAmount;\n#endif\n};uniform Material u_material;Material material;\n#ifdef TANGRAM_MATERIAL_EMISSION_TEXTURE\nuniform sampler2D u_material_emission_texture;\n#endif\n#ifdef TANGRAM_MATERIAL_AMBIENT_TEXTURE\nuniform sampler2D u_material_ambient_texture;\n#endif\n#ifdef TANGRAM_MATERIAL_DIFFUSE_TEXTURE\nuniform sampler2D u_material_diffuse_texture;\n#endif\n#ifdef TANGRAM_MATERIAL_SPECULAR_TEXTURE\nuniform sampler2D u_material_specular_texture;\n#endif\n#ifdef TANGRAM_MATERIAL_NORMAL_TEXTURE\nuniform sampler2D u_material_normal_texture;\n#endif\nvec4 light_accumulator_ambient=vec4(vec3(0.0),1.);vec4 light_accumulator_diffuse=vec4(vec3(0.0),1.);\n#ifdef TANGRAM_MATERIAL_SPECULAR\nvec4 light_accumulator_specular=vec4(vec3(0.0),1.);\n#endif\n#ifdef TANGRAM_MATERIAL_TEXTURE_SPHEREMAP\nvec4 getSphereMap(in sampler2D _tex,in vec3 _eyeToPoint,in vec3 _normal,in vec2 _skew){vec3 eye=normalize(_eyeToPoint);eye.xy-=_skew;eye=normalize(eye);vec3 r=reflect(eye,_normal);r.z+=1.0;float m=2.*length(r);vec2 uv=r.xy/m+.5;return texture2D(_tex,uv);}\n#endif\n#ifdef TANGRAM_MATERIAL_TEXTURE_TRIPLANAR\nvec3 getTriPlanarBlend(in vec3 _normal){vec3 blending=abs(_normal);blending=normalize(max(blending,0.00001));float b=(blending.x+blending.y+blending.z);return blending/b;}vec4 getTriPlanar(in sampler2D _tex,in vec3 _pos,in vec3 _normal,in vec3 _scale){vec3 blending=getTriPlanarBlend(_normal);vec4 xaxis=texture2D(_tex,fract(_pos.yz*_scale.x));vec4 yaxis=texture2D(_tex,fract(_pos.xz*_scale.y));vec4 zaxis=texture2D(_tex,fract(_pos.xy*_scale.z));return xaxis*blending.x+yaxis*blending.y+zaxis*blending.z;}\n#endif\n#ifdef TANGRAM_MATERIAL_TEXTURE_PLANAR\nvec4 getPlanar(in sampler2D _tex,in vec3 _pos,in vec2 _scale){return texture2D(_tex,fract(_pos.xy*_scale.x));}\n#endif\n#ifdef TANGRAM_MATERIAL_NORMAL_TEXTURE\nvoid calculateNormal(inout vec3 _normal){\n#ifdef TANGRAM_MATERIAL_NORMAL_TEXTURE_UV\n_normal+=texture2D(u_material_normal_texture,fract(v_texcoord*material.normalScale.xy)).rgb*2.0-1.0;\n#endif\n#ifdef TANGRAM_MATERIAL_NORMAL_TEXTURE_PLANAR\nvec3 normalTex=getPlanar(u_material_normal_texture,v_world_position.xyz,material.normalScale.xy).rgb*2.0-1.0;_normal+=normalTex;\n#endif\n#ifdef TANGRAM_MATERIAL_NORMAL_TEXTURE_TRIPLANAR\nvec3 normalTex=getTriPlanar(u_material_normal_texture,v_world_position.xyz,_normal,material.normalScale).rgb*2.0-1.0;_normal+=normalTex;\n#endif\n_normal=normalize(_normal);}\n#endif\nvoid calculateMaterial(in vec3 _eyeToPoint,inout vec3 _normal){\n#ifdef TANGRAM_MATERIAL_EMISSION_TEXTURE\n#ifdef TANGRAM_MATERIAL_EMISSION_TEXTURE_UV\nmaterial.emission*=texture2D(u_material_emission_texture,v_texcoord);\n#endif\n#ifdef TANGRAM_MATERIAL_EMISSION_TEXTURE_PLANAR\nmaterial.emission*=getPlanar(u_material_emission_texture,v_world_position.xyz,material.emissionScale.xy);\n#endif\n#ifdef TANGRAM_MATERIAL_EMISSION_TEXTURE_TRIPLANAR\nmaterial.emission*=getTriPlanar(u_material_emission_texture,v_world_position.xyz,_normal,material.emissionScale);\n#endif\n#ifdef TANGRAM_MATERIAL_EMISSION_TEXTURE_SPHEREMAP\nmaterial.emission*=getSphereMap(u_material_emission_texture,_eyeToPoint,_normal,u_center_offset);\n#endif\n#endif\n#ifdef TANGRAM_MATERIAL_AMBIENT_TEXTURE\n#ifdef TANGRAM_MATERIAL_AMBIENT_TEXTURE_UV\nmaterial.ambient*=texture2D(u_material_ambient_texture,v_texcoord);\n#endif\n#ifdef TANGRAM_MATERIAL_AMBIENT_TEXTURE_PLANAR\nmaterial.ambient*=getPlanar(u_material_ambient_texture,v_world_position.xyz,material.ambientScale.xy);\n#endif\n#ifdef TANGRAM_MATERIAL_AMBIENT_TEXTURE_TRIPLANAR\nmaterial.ambient*=getTriPlanar(u_material_ambient_texture,v_world_position.xyz,_normal,material.ambientScale);\n#endif\n#ifdef TANGRAM_MATERIAL_AMBIENT_TEXTURE_SPHEREMAP\nmaterial.ambient*=getSphereMap(u_material_ambient_texture,_eyeToPoint,_normal,u_center_offset);\n#endif\n#endif\n#ifdef TANGRAM_MATERIAL_DIFFUSE_TEXTURE\n#ifdef TANGRAM_MATERIAL_DIFFUSE_TEXTURE_UV\nmaterial.diffuse*=texture2D(u_material_diffuse_texture,v_texcoord);\n#endif\n#ifdef TANGRAM_MATERIAL_DIFFUSE_TEXTURE_PLANAR\nmaterial.diffuse*=getPlanar(u_material_diffuse_texture,v_world_position.xyz,material.diffuseScale.xy);\n#endif\n#ifdef TANGRAM_MATERIAL_DIFFUSE_TEXTURE_TRIPLANAR\nmaterial.diffuse*=getTriPlanar(u_material_diffuse_texture,v_world_position.xyz,_normal,material.diffuseScale);\n#endif\n#ifdef TANGRAM_MATERIAL_DIFFUSE_TEXTURE_SPHEREMAP\nmaterial.diffuse*=getSphereMap(u_material_diffuse_texture,_eyeToPoint,_normal,u_center_offset);\n#endif\n#endif\n#ifdef TANGRAM_MATERIAL_SPECULAR_TEXTURE\n#ifdef TANGRAM_MATERIAL_SPECULAR_TEXTURE_UV\nmaterial.specular*=texture2D(u_material_specular_texture,v_texcoord);\n#endif\n#ifdef TANGRAM_MATERIAL_SPECULAR_TEXTURE_PLANAR\nmaterial.specular*=getPlanar(u_material_specular_texture,v_world_position.xyz,material.specularScale.xy);\n#endif\n#ifdef TANGRAM_MATERIAL_SPECULAR_TEXTURE_TRIPLANAR\nmaterial.specular*=getTriPlanar(u_material_specular_texture,v_world_position.xyz,_normal,material.specularScale);\n#endif\n#ifdef TANGRAM_MATERIAL_SPECULAR_TEXTURE_SPHEREMAP\nmaterial.specular*=getSphereMap(u_material_specular_texture,_eyeToPoint,_normal,u_center_offset);\n#endif\n#endif\n}",material_props=["emission","ambient","diffuse","specular"],Material=function(){function t(e){var r=this;_classCallCheck(this,t),e=e||{},material_props.forEach((function(t){var i=e[t];null!=i&&(i.texture?r[t]={texture:i.texture,mapping:i.mapping||"spheremap",scale:GLSL.expandVec3(null!=i.scale?i.scale:1),amount:GLSL.expandVec4(null!=i.amount?i.amount:1)}:"number"==typeof i||Array.isArray(i)?r[t]={amount:GLSL.expandVec4(i)}:r[t]="string"==typeof i?{amount:StyleParser.parseColor(i)}:i)})),this.specular&&(this.specular.shininess=e.shininess?parseFloat(e.shininess):.2),null!=e.normal&&(this.normal={texture:e.normal.texture,mapping:e.normal.mapping||"triplanar",scale:GLSL.expandVec3(null!=e.normal.scale?e.normal.scale:1),amount:null!=e.normal.amount?e.normal.amount:1})}return _createClass(t,[{key:"inject",value:function(e){var r=this;material_props.forEach((function(t){var i="TANGRAM_MATERIAL_".concat(t.toUpperCase()),n=i+"_TEXTURE";e.defines[i]=null!=r[t],r[t]&&r[t].texture&&(e.defines[n]=!0,e.defines[n+"_"+r[t].mapping.toUpperCase()]=!0,e.defines["TANGRAM_MATERIAL_TEXTURE_".concat(r[t].mapping.toUpperCase())]=!0,e.texcoords=e.texcoords||"uv"===r[t].mapping)})),this.normal&&this.normal.texture&&(e.defines.TANGRAM_MATERIAL_NORMAL_TEXTURE=!0,e.defines["TANGRAM_MATERIAL_NORMAL_TEXTURE_"+this.normal.mapping.toUpperCase()]=!0,e.defines["TANGRAM_MATERIAL_TEXTURE_".concat(this.normal.mapping.toUpperCase())]=!0,e.texcoords=e.texcoords||"uv"===this.normal.mapping),e.replaceShaderBlock(t.block,shaderSrc_material,"Material"),e.addShaderBlock("setup","\nmaterial = u_material;\n","Material")}},{key:"setupProgram",value:function(t){var e=this;material_props.forEach((function(r){e[r]&&(e[r].texture?(t.setTextureUniform("u_material_".concat(r,"_texture"),e[r].texture),t.uniform("3fv","u_material.".concat(r,"Scale"),e[r].scale),t.uniform("4fv","u_material.".concat(r),e[r].amount)):e[r].amount&&t.uniform("4fv","u_material.".concat(r),e[r].amount))})),this.specular&&t.uniform("1f","u_material.shininess",this.specular.shininess),this.normal&&this.normal.texture&&(t.setTextureUniform("u_material_normal_texture",this.normal.texture),t.uniform("3fv","u_material.normalScale",this.normal.scale),t.uniform("1f","u_material.normalAmount",this.normal.amount))}}],[{key:"isValid",value:function(t){return null!=t&&(null!=t.emission||null!=t.ambient||null!=t.diffuse||null!=t.specular)}}])}(),Vector;Material.block="material";var Vector$1=Vector={};Vector.copy=function(t){for(var e=[],r=t.length,i=0;i<r;i++)e[i]=t[i];return e},Vector.neg=function(t){for(var e=[],r=t.length,i=0;i<r;i++)e[i]=-t[i];return e},Vector.add=function(t,e){for(var r=[],i=Math.min(t.length,e.length),n=0;n<i;n++)r[n]=t[n]+e[n];return r},Vector.sub=function(t,e){for(var r=[],i=Math.min(t.length,e.length),n=0;n<i;n++)r[n]=t[n]-e[n];return r},Vector.signed_area=function(t,e,r){return(e[0]-t[0])*(r[1]-t[1])-(r[0]-t[0])*(e[1]-t[1])},Vector.mult=function(t,e){var r,i=[],n=t.length;if("number"==typeof e)for(r=0;r<n;r++)i[r]=t[r]*e;else for(n=Math.min(t.length,e.length),r=0;r<n;r++)i[r]=t[r]*e[r];return i},Vector.multMatrix=function(t,e){return[t[0][0]*e[0]+t[0][1]*e[1],t[1][0]*e[0]+t[1][1]*e[1]]},Vector.div=function(t,e){var r,i=[];if("number"==typeof e)for(r=0;r<t.length;r++)i[r]=t[r]/e;else{var n=Math.min(t.length,e.length);for(r=0;r<n;r++)i[r]=t[r]/e[r]}return i},Vector.perp=function(t,e){return[e[1]-t[1],t[0]-e[0]]},Vector.rot=function(t,e){var r=Math.cos(e),i=Math.sin(e);return[t[0]*r-t[1]*i,t[0]*i+t[1]*r]},Vector.angle=function(t){var e=_slicedToArray(t,2),r=e[0],i=e[1];return Math.atan2(i,r)},Vector.angleBetween=function(t,e){var r=Vector.dot(Vector.normalize(Vector.copy(t)),Vector.normalize(Vector.copy(e)));return r>1&&(r=1),Math.acos(r)},Vector.signedAngleBetween=function(t,e){return Math.atan2(t[0]*e[1]-t[1]*e[0],t[0]*e[0]+t[1]*e[1])},Vector.isEqual=function(t,e){for(var r=t.length,i=0;i<r;i++)if(t[i]!==e[i])return!1;return!0},Vector.lengthSq=function(t){return 2===t.length?t[0]*t[0]+t[1]*t[1]:t.length>=3?t[0]*t[0]+t[1]*t[1]+t[2]*t[2]:0},Vector.length=function(t){return Math.sqrt(Vector.lengthSq(t))},Vector.normalize=function(t){var e;if(2===t.length){if(1==(e=t[0]*t[0]+t[1]*t[1]))return t;0!==(e=Math.sqrt(e))?(t[0]/=e,t[1]/=e):(t[0]=0,t[1]=0)}else if(t.length>=3){if(1==(e=t[0]*t[0]+t[1]*t[1]+t[2]*t[2]))return t;0!==(e=Math.sqrt(e))?(t[0]/=e,t[1]/=e,t[2]/=e):(t[0]=0,t[1]=0,t[2]=0)}return t},Vector.cross=function(t,e){return 2===t.length?t[0]*e[1]-t[1]*e[0]:3===t.length?[t[1]*e[2]-t[2]*e[1],t[2]*e[0]-t[0]*e[2],t[0]*e[1]-t[1]*e[0]]:void 0},Vector.dot=function(t,e){for(var r=0,i=Math.min(t.length,e.length),n=0;n<i;n++)r+=t[n]*e[n];return r};var shaderSrc_ambientLight="/*Expected globals:light_accumulator_**/struct AmbientLight{vec3 ambient;};void calculateLight(in AmbientLight _light,in vec3 _eyeToPoint,in vec3 _normal){light_accumulator_ambient.rgb+=_light.ambient;}",shaderSrc_directionalLight="/*Expected globals:materiallight_accumulator_**/struct DirectionalLight{vec3 ambient;vec3 diffuse;vec3 specular;vec3 direction;};void calculateLight(in DirectionalLight _light,in vec3 _eyeToPoint,in vec3 _normal){light_accumulator_ambient.rgb+=_light.ambient;float nDotVP=clamp(dot(_normal,-_light.direction),0.0,1.0);\n#ifdef TANGRAM_MATERIAL_DIFFUSE\nlight_accumulator_diffuse.rgb+=_light.diffuse*nDotVP;\n#endif\n#ifdef TANGRAM_MATERIAL_SPECULAR\nfloat pf=0.0;if(nDotVP>0.0){vec3 reflectVector=reflect(_light.direction,_normal);float eyeDotR=max(dot(normalize(_eyeToPoint),reflectVector),0.0);pf=pow(eyeDotR,material.shininess);}light_accumulator_specular.rgb+=_light.specular*pf;\n#endif\n}",shaderSrc_pointLight="/*Expected globals:materiallight_accumulator_**/struct PointLight{vec3 ambient;vec3 diffuse;vec3 specular;vec4 position;\n#ifdef TANGRAM_POINTLIGHT_ATTENUATION_EXPONENT\nfloat attenuationExponent;\n#endif\n#ifdef TANGRAM_POINTLIGHT_ATTENUATION_INNER_RADIUS\nfloat innerRadius;\n#endif\n#ifdef TANGRAM_POINTLIGHT_ATTENUATION_OUTER_RADIUS\nfloat outerRadius;\n#endif\n};void calculateLight(in PointLight _light,in vec3 _eyeToPoint,in vec3 _normal){float dist=length(_light.position.xyz-_eyeToPoint);vec3 VP=(_light.position.xyz-_eyeToPoint)/dist;float nDotVP=clamp(dot(VP,_normal),0.0,1.0);float attenuation=1.0;\n#ifdef TANGRAM_POINTLIGHT_ATTENUATION_EXPONENT\nfloat Rin=1.0;float e=_light.attenuationExponent;\n#ifdef TANGRAM_POINTLIGHT_ATTENUATION_INNER_RADIUS\nRin=_light.innerRadius;\n#endif\n#ifdef TANGRAM_POINTLIGHT_ATTENUATION_OUTER_RADIUS\nfloat Rdiff=_light.outerRadius-Rin;float d=clamp(max(0.0,dist-Rin)/Rdiff,0.0,1.0);attenuation=1.0-(pow(d,e));\n#else\nfloat d=max(0.0,dist-Rin)/Rin+1.0;attenuation=clamp(1.0/(pow(d,e)),0.0,1.0);\n#endif\n#else\nfloat Rin=0.0;\n#ifdef TANGRAM_POINTLIGHT_ATTENUATION_INNER_RADIUS\nRin=_light.innerRadius;\n#ifdef TANGRAM_POINTLIGHT_ATTENUATION_OUTER_RADIUS\nfloat Rdiff=_light.outerRadius-Rin;float d=clamp(max(0.0,dist-Rin)/Rdiff,0.0,1.0);attenuation=1.0-d*d;\n#else\nfloat d=max(0.0,dist-Rin)/Rin+1.0;attenuation=clamp(1.0/d,0.0,1.0);\n#endif\n#else\n#ifdef TANGRAM_POINTLIGHT_ATTENUATION_OUTER_RADIUS\nfloat d=clamp(dist/_light.outerRadius,0.0,1.0);attenuation=1.0-d*d;\n#else\nattenuation=1.0;\n#endif\n#endif\n#endif\nlight_accumulator_ambient.rgb+=_light.ambient*attenuation;\n#ifdef TANGRAM_MATERIAL_DIFFUSE\nlight_accumulator_diffuse.rgb+=_light.diffuse*nDotVP*attenuation;\n#endif\n#ifdef TANGRAM_MATERIAL_SPECULAR\nfloat pf=0.0;if(nDotVP>0.0){vec3 reflectVector=reflect(-VP,_normal);float eyeDotR=max(0.0,dot(-normalize(_eyeToPoint),reflectVector));pf=pow(eyeDotR,material.shininess);}light_accumulator_specular.rgb+=_light.specular*pf*attenuation;\n#endif\n}",shaderSrc_spotLight="/*Expected globals:materiallight_accumulator_**/struct SpotLight{vec3 ambient;vec3 diffuse;vec3 specular;vec4 position;\n#ifdef TANGRAM_POINTLIGHT_ATTENUATION_EXPONENT\nfloat attenuationExponent;\n#endif\n#ifdef TANGRAM_POINTLIGHT_ATTENUATION_INNER_RADIUS\nfloat innerRadius;\n#endif\n#ifdef TANGRAM_POINTLIGHT_ATTENUATION_OUTER_RADIUS\nfloat outerRadius;\n#endif\nvec3 direction;float spotCosCutoff;float spotExponent;};void calculateLight(in SpotLight _light,in vec3 _eyeToPoint,in vec3 _normal){float dist=length(_light.position.xyz-_eyeToPoint);vec3 VP=(_light.position.xyz-_eyeToPoint)/dist;float nDotVP=clamp(dot(_normal,VP),0.0,1.0);float attenuation=1.0;\n#ifdef TANGRAM_POINTLIGHT_ATTENUATION_EXPONENT\nfloat Rin=1.0;float e=_light.attenuationExponent;\n#ifdef TANGRAM_POINTLIGHT_ATTENUATION_INNER_RADIUS\nRin=_light.innerRadius;\n#endif\n#ifdef TANGRAM_POINTLIGHT_ATTENUATION_OUTER_RADIUS\nfloat Rdiff=_light.outerRadius-Rin;float d=clamp(max(0.0,dist-Rin)/Rdiff,0.0,1.0);attenuation=1.0-(pow(d,e));\n#else\nfloat d=max(0.0,dist-Rin)/Rin+1.0;attenuation=clamp(1.0/(pow(d,e)),0.0,1.0);\n#endif\n#else\nfloat Rin=0.0;\n#ifdef TANGRAM_POINTLIGHT_ATTENUATION_INNER_RADIUS\nRin=_light.innerRadius;\n#ifdef TANGRAM_POINTLIGHT_ATTENUATION_OUTER_RADIUS\nfloat Rdiff=_light.outerRadius-Rin;float d=clamp(max(0.0,dist-Rin)/Rdiff,0.0,1.0);attenuation=1.0-d*d;\n#else\nfloat d=max(0.0,dist-Rin)/Rin+1.0;attenuation=clamp(1.0/d,0.0,1.0);\n#endif\n#else\n#ifdef TANGRAM_POINTLIGHT_ATTENUATION_OUTER_RADIUS\nfloat d=clamp(dist/_light.outerRadius,0.0,1.0);attenuation=1.0-d*d;\n#else\nattenuation=1.0;\n#endif\n#endif\n#endif\nfloat spotAttenuation=0.0;float spotDot=clamp(dot(-VP,_light.direction),0.0,1.0);if(spotDot>=_light.spotCosCutoff){spotAttenuation=pow(spotDot,_light.spotExponent);}light_accumulator_ambient.rgb+=_light.ambient*attenuation*spotAttenuation;\n#ifdef TANGRAM_MATERIAL_DIFFUSE\nlight_accumulator_diffuse.rgb+=_light.diffuse*nDotVP*attenuation*spotAttenuation;\n#endif\n#ifdef TANGRAM_MATERIAL_SPECULAR\nfloat pf=0.0;if(nDotVP>0.0){vec3 reflectVector=reflect(-VP,_normal);float eyeDotR=max(dot(-normalize(_eyeToPoint),reflectVector),0.0);pf=pow(eyeDotR,material.shininess);}light_accumulator_specular.rgb+=_light.specular*pf*attenuation*spotAttenuation;\n#endif\n}",Light=function(){function t(e,r){_classCallCheck(this,t),this.name=r.name,this.view=e,null==r.ambient||"number"==typeof r.ambient?this.ambient=GLSL.expandVec3(r.ambient||0):this.ambient=StyleParser.parseColor(r.ambient).slice(0,3),null==r.diffuse||"number"==typeof r.diffuse?this.diffuse=GLSL.expandVec3(null!=r.diffuse?r.diffuse:1):this.diffuse=StyleParser.parseColor(r.diffuse).slice(0,3),null==r.specular||"number"==typeof r.specular?this.specular=GLSL.expandVec3(r.specular||0):this.specular=StyleParser.parseColor(r.specular).slice(0,3)}return _createClass(t,[{key:"inject",value:function(){var e="\n            uniform ".concat(this.struct_name," u_").concat(this.name,";\n            ").concat(this.struct_name," ").concat(this.name,";\n            "),r="\n            ".concat(this.name," = u_").concat(this.name,";\n\n        ");ShaderProgram.addBlock(t.block,e),ShaderProgram.addBlock("setup",r)}},{key:"update",value:function(){}},{key:"setupProgram",value:function(t){t.uniform("3fv","u_".concat(this.name,".ambient"),this.ambient),t.uniform("3fv","u_".concat(this.name,".diffuse"),this.diffuse),t.uniform("3fv","u_".concat(this.name,".specular"),this.specular)}}],[{key:"create",value:function(e,r){if(t.types[r.type])return new t.types[r.type](e,r)}},{key:"setMode",value:function(e,r){!0===e&&(e="fragment"),e=t.enabled&&(null!=e?e:"fragment"),r.defines.TANGRAM_LIGHTING_FRAGMENT="fragment"===e,r.defines.TANGRAM_LIGHTING_VERTEX="vertex"===e}},{key:"inject",value:function(e){if(ShaderProgram.removeBlock(t.block),t.enabled){var r="";if(e&&Object.keys(e).length>0){var i={};for(var n in e)i[e[n].type]=!0;for(var o in i)t.types[o].inject();for(var a in e)e[a].inject(),r+="calculateLight(".concat(a,", _eyeToPoint, _normal);\n")}var s="\n            vec4 calculateLighting(in vec3 _eyeToPoint, in vec3 _normal, in vec4 _color) {\n\n                // Do initial material calculations over normal, emission, ambient, diffuse and specular values\n                calculateMaterial(_eyeToPoint,_normal);\n\n                // Un roll the loop of individual ligths to calculate\n                ".concat(r,"\n\n                //  Final light intensity calculation\n                vec4 color = vec4(vec3(0.), _color.a); // start with vertex color alpha\n\n                #ifdef TANGRAM_MATERIAL_EMISSION\n                    color.rgb = material.emission.rgb;\n                    color.a *= material.emission.a;\n                #endif\n\n                #ifdef TANGRAM_MATERIAL_AMBIENT\n                    color.rgb += light_accumulator_ambient.rgb * _color.rgb * material.ambient.rgb;\n                    color.a *= material.ambient.a;\n                #else\n                    #ifdef TANGRAM_MATERIAL_DIFFUSE\n                        color.rgb += light_accumulator_ambient.rgb * _color.rgb * material.diffuse.rgb;\n                    #endif\n                #endif\n\n                #ifdef TANGRAM_MATERIAL_DIFFUSE\n                    color.rgb += light_accumulator_diffuse.rgb * _color.rgb * material.diffuse.rgb;\n                    color.a *= material.diffuse.a;\n                #endif\n\n                #ifdef TANGRAM_MATERIAL_SPECULAR\n                    color.rgb += light_accumulator_specular.rgb * material.specular.rgb;\n                    color.a *= material.specular.a;\n                #endif\n\n                // Clamp final color\n                color = clamp(color, 0.0, 1.0);\n\n                return color;\n            }");ShaderProgram.addBlock(t.block,s)}}}])}();Light.types={},Light.block="lighting",Light.enabled=!0;var AmbientLight=function(t){function e(t,r){var i;return _classCallCheck(this,e),(i=_callSuper(this,e,[t,r])).type="ambient",i.struct_name="AmbientLight",i}return _inherits(e,t),_createClass(e,[{key:"setupProgram",value:function(t){t.uniform("3fv","u_".concat(this.name,".ambient"),this.ambient)}}],[{key:"inject",value:function(){ShaderProgram.addBlock(Light.block,shaderSrc_ambientLight)}}])}(Light);Light.types.ambient=AmbientLight;var DirectionalLight=function(t){function e(t,r){var i;if(_classCallCheck(this,e),(i=_callSuper(this,e,[t,r])).type="directional",i.struct_name="DirectionalLight",r.direction)i._direction=r.direction;else{var n=Math.sin(60*Math.PI/180);i._direction=[Math.cos(135*Math.PI/180)*n,Math.sin(135*Math.PI/180)*n,-.5]}return null==r.ambient&&(i.ambient=GLSL.expandVec3(.5)),i.direction=i._direction.map(parseFloat),i._initial_direction=[i.direction[0],i.direction[1],i.direction[2]],i}return _inherits(e,t),_createClass(e,[{key:"direction",get:function(){return this._direction},set:function(t){this._direction=Vector$1.normalize(Vector$1.copy(t))}},{key:"update",value:function(){vec3.transformMat4(this.direction,this._initial_direction,this.view.lookAtManipulator.getTransformationMatrix())}},{key:"setupProgram",value:function(t){_get(_getPrototypeOf(e.prototype),"setupProgram",this).call(this,t),t.uniform("3fv","u_".concat(this.name,".direction"),this.direction)}}],[{key:"inject",value:function(){ShaderProgram.addBlock(Light.block,shaderSrc_directionalLight)}}])}(Light);Light.types.directional=DirectionalLight;var PointLight=function(t){function e(t,r){var i;return _classCallCheck(this,e),(i=_callSuper(this,e,[t,r])).type="point",i.struct_name="PointLight",i.position=r.position||[0,0,"100px"],i.position_eye=[],i.origin=r.origin||"ground",i.attenuation=isNaN(parseFloat(r.attenuation))?0:parseFloat(r.attenuation),r.radius?Array.isArray(r.radius)&&2===r.radius.length?i.radius=r.radius:i.radius=[null,r.radius]:i.radius=null,i}return _inherits(e,t),_createClass(e,[{key:"inject",value:function(){_get(_getPrototypeOf(e.prototype),"inject",this).call(this),ShaderProgram.defines.TANGRAM_POINTLIGHT_ATTENUATION_EXPONENT=0!==this.attenuation,ShaderProgram.defines.TANGRAM_POINTLIGHT_ATTENUATION_INNER_RADIUS=null!=this.radius&&null!=this.radius[0],ShaderProgram.defines.TANGRAM_POINTLIGHT_ATTENUATION_OUTER_RADIUS=null!=this.radius}},{key:"update",value:function(){var t=this.view.lookAtManipulator.getLookAtData().zoom;if("world"===this.origin){var e=_slicedToArray(Geo$1.latLngToMeters(this.position),2),r=e[0],i=e[1];this.position_eye[0]=r-this.view.lookAtManipulator.getLookAtData().position[0],this.position_eye[1]=i-this.view.lookAtManipulator.getLookAtData().position[1],this.position_eye[2]=StyleParser.convertUnits(this.position[2],{zoom:t,meters_per_pixel:Geo$1.metersPerPixel(t)}),this.position_eye[2]=this.position_eye[2]-this.view.lookAtManipulator.getLookAtData().distance}else"ground"!==this.origin&&"camera"!==this.origin||(this.position_eye=StyleParser.convertUnits(this.position,{zoom:t,meters_per_pixel:Geo$1.metersPerPixel(t)}),"ground"===this.origin&&(this.position_eye[2]=this.position_eye[2]-this.view.lookAtManipulator.getLookAtData().distance));this.position_eye[3]=1}},{key:"setupProgram",value:function(t){_get(_getPrototypeOf(e.prototype),"setupProgram",this).call(this,t),t.uniform("4fv","u_".concat(this.name,".position"),this.position_eye),ShaderProgram.defines.TANGRAM_POINTLIGHT_ATTENUATION_EXPONENT&&t.uniform("1f","u_".concat(this.name,".attenuationExponent"),this.attenuation);var r=this.view.lookAtManipulator.getLookAtData().zoom;ShaderProgram.defines.TANGRAM_POINTLIGHT_ATTENUATION_INNER_RADIUS&&t.uniform("1f","u_".concat(this.name,".innerRadius"),StyleParser.convertUnits(this.radius[0],{zoom:r,meters_per_pixel:Geo$1.metersPerPixel(r)})),ShaderProgram.defines.TANGRAM_POINTLIGHT_ATTENUATION_OUTER_RADIUS&&t.uniform("1f","u_".concat(this.name,".outerRadius"),StyleParser.convertUnits(this.radius[1],{zoom:r,meters_per_pixel:Geo$1.metersPerPixel(r)}))}}],[{key:"inject",value:function(){ShaderProgram.addBlock(Light.block,shaderSrc_pointLight)}}])}(Light);Light.types.point=PointLight;var SpotLight=function(t){function e(t,r){var i;return _classCallCheck(this,e),(i=_callSuper(this,e,[t,r])).type="spotlight",i.struct_name="SpotLight",i.direction=i._direction=(r.direction||[0,0,-1]).map(parseFloat),i._initial_direction=[i.direction[0],i.direction[1],i.direction[2]],i.exponent=r.exponent?parseFloat(r.exponent):.2,i.angle=r.angle?parseFloat(r.angle):20,i}return _inherits(e,t),_createClass(e,[{key:"direction",get:function(){return this._direction},set:function(t){this._direction=Vector$1.normalize(Vector$1.copy(t))}},{key:"setupProgram",value:function(t){_get(_getPrototypeOf(e.prototype),"setupProgram",this).call(this,t),t.uniform("3fv","u_".concat(this.name,".direction"),this.direction),t.uniform("1f","u_".concat(this.name,".spotCosCutoff"),Math.cos(3.14159*this.angle/180)),t.uniform("1f","u_".concat(this.name,".spotExponent"),this.exponent)}},{key:"update",value:function(){_get(_getPrototypeOf(e.prototype),"update",this).call(this),vec3.transformMat4(this.direction,this._initial_direction,this.view.lookAtManipulator.getTransformationMatrix())}}],[{key:"inject",value:function(){ShaderProgram.addBlock(Light.block,shaderSrc_spotLight)}}])}(PointLight);function mergeObjects(t){for(var e=0;e<(arguments.length<=1?0:arguments.length-1);e++){var r=e+1<1||arguments.length<=e+1?void 0:arguments[e+1];if(r)for(var i in r){var n=r[i];null===n||"object"!==_typeof(n)||Array.isArray(n)?void 0!==n&&(t[i]=n):null===t[i]||"object"!==_typeof(t[i])||Array.isArray(t[i])?t[i]=mergeObjects({},n):t[i]=mergeObjects(t[i],n)}}return t}Light.types.spotlight=SpotLight;var shaderSrc_selectionFragment="\n#ifdef TANGRAM_FEATURE_SELECTION\nvarying vec4 v_selection_color;\n#endif\nvoid main(void){\n#ifdef TANGRAM_FEATURE_SELECTION\ngl_FragColor=v_selection_color;\n#else\ngl_FragColor=vec4(0.,0.,0.,1.);\n#endif\n}",shaderSrc_selectionCropFragment="\n#pragma tangram: utils\n#ifdef TANGRAM_FEATURE_SELECTION\nuniform float u_meters_per_pixel;varying vec4 v_selection_color;varying vec4 v_local_space_position;\n#endif\nvoid main(void){\n#ifdef TANGRAM_FEATURE_SELECTION\nif(isLocalSpacePixelOutsideTile(v_local_space_position,TANGRAM_TILE_SCALE.x)){discard;}else{gl_FragColor=v_selection_color;}\n#else\ngl_FragColor=vec4(0.,0.,0.,1.);\n#endif\n}",shaderSrc_rasters="#ifdef TANGRAM_FRAGMENT_SHADER\nuniform sampler2D u_raster;uniform vec3 u_raster_offset;\n#define sampleRaster() (texture2D(u_raster, v_modelpos_base_zoom.xy * u_raster_offset.z + u_raster_offset.xy))\n#endif\n",Style={init:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=t.generation,r=t.styles,i=t.sources,n=void 0===i?{}:i,o=t.introspection,a=t.id,s=void 0!==a?a+"/":"";this.scene_id=a,this.textureManager=getTextureManager(a),this.main_thread_target="".concat(s,"Style/").concat(this.name),this.setGeneration(e),this.styles=r,this.sources=n,this.defines=this.hasOwnProperty("defines")&&this.defines||{},this.shaders=this.hasOwnProperty("shaders")&&this.shaders||{},this.introspection=o||!1,this.selection=this.selection||this.introspection||!1,this.compile_setup=!1,this.program=null,this.selection_program=null,this.feature_style={},this.vertex_template=[],this.tile_data={},this.defines.TANGRAM_WORLD_POSITION_WRAP=1e5,this.blend=this.blend||"opaque",this.defines["TANGRAM_BLEND_".concat(this.blend.toUpperCase())]=!0,null==this.blend_order&&(this.blend_order=-1),this.removeShaderBlock("setup"),this.material instanceof Material||(Material.isValid(this.material)||(this.material=StyleParser.defaults.material),this.material=new Material(this.material)),this.material.inject(this),Light.setMode(this.lighting,this),this.setupRasters(),this.initialized=!0},destroy:function(){this.program&&(this.program.destroy(),this.program=null),this.selection_program&&(this.selection_program.destroy(),this.selection_program=null),WorkerBroker.removeTarget(this.main_thread_target),this.gl=null,this.initialized=!1},reset:function(){},baseStyle:function(){return this.base||this.name},setGeneration:function(t){this.generation=t,Thread.is_main&&WorkerBroker.addTarget(this.main_thread_target,this)},fillVertexTemplate:function(t,e,r,i){var n=i.size,o=i.offset;o=void 0===o?0:o;var a=t.index[e];if(void 0!==a)for(var s=0;s<n;++s){var l=r.length>s?r[s]:r;this.vertex_template[a+s+o]=l}else log("warn","Style: in style '".concat(this.name,"', no index found in vertex layout for attribute '").concat(e,"'"))},startData:function(t){this.tile_data[t.id]=this.tile_data[t.id]||{meshes:{},uniforms:{},textures:[]}},endData:function(t){var e=this.tile_data[t.id];if(this.tile_data[t.id]=null,e&&Object.keys(e.meshes).length>0){for(var r in e.meshes){var i=e.meshes[r];0!==i.vertex_data.vertex_count?(i.vertex_data.end(),i.vertex_elements=i.vertex_data.element_buffer,i.vertex_data=i.vertex_data.vertex_buffer):delete e.meshes[r]}return t.mesh_data[this.name]=e,this.buildRasterTextures(t,e).then((function(t){return t}))}return Promise.resolve(null)},hasDataForTile:function(t){return null!=this.tile_data[t.id]},getTileMesh:function(t,e){var r=this.tile_data[t.id].meshes;return null==r[e.key]&&(r[e.key]={variant:e,vertex_data:this.vertexLayoutForMeshVariant(e).createVertexData()}),r[e.key]},vertexLayoutForMeshVariant:function(t){return this.vertex_layout},default_mesh_variant:{key:0},style_mesh_variants:{default:{variants:{0:{variant:{key:0},times_unref:0}}}},addMeshVariantForDraw:function(t,e){this.style_mesh_variants[t]||(this.style_mesh_variants[t]={variants:{}});var r=this.computeVariantForDraw(e);return this.style_mesh_variants[t].variants[r.key]={variant:r,times_unref:0},this.style_mesh_variants[t].variants[r.key].variant},getMeshVariantTypeForDraw:function(t){return this.getMeshVariantType(this.base,t)},getMeshVariantType:function(t,e){void 0===t&&(t="default");var r=this.style_mesh_variants[t];if(void 0===e.variantKey||!r||!r.variants[e.variantKey])return this.addMeshVariantForDraw(t,e);var i=e.variantKey,n=r.variants[i];return n.times_unref=0,n.variant},updateMeshVariantTypeCache:function(t){for(var e in this.style_mesh_variants){var r=this.style_mesh_variants[e].variants;for(var i in r){var n=r[i];n.times_unref++,n.times_unref>t&&("default"!==e||0!=+i)&&(delete r[i],0===Object.keys(r).length&&delete this.style_mesh_variants[e])}}},computeVariantForDraw:function(t){return this.default_mesh_variant},addFeature:function(t,e,r){var i=r.tile;this.tile_data[i.id]||this.startData(i);var n=this.parseFeature(t,e,r);if(n){var o="lines"===this.base?this.getMeshVariantTypeForDraw(e):this.getMeshVariantTypeForDraw(n),a=this.getTileMesh(i,o),s=a.vertex_data.offset,l=a.vertex_data.vertex_count;this.buildGeometry(t.geometry,n,a,r)>0?t.generation=this.generation:a.vertex_data.vertex_count>l&&(a.vertex_data.vertex_buffer.fill(0,s,a.vertex_data.offset),a.vertex_data.vertex_count=l,a.vertex_data.offset=s)}},buildGeometry:function(t,e,r,i){var n;return"Polygon"===t.type?n=this.buildPolygons([t.coordinates],e,r,i):"MultiPolygon"===t.type?n=this.buildPolygons(t.coordinates,e,r,i):"LineString"===t.type?n=this.buildLines([t.coordinates],e,r,i):"MultiLineString"===t.type?n=this.buildLines(t.coordinates,e,r,i):"Point"===t.type?n=this.buildPoints([t.coordinates],e,r,i):"MultiPoint"===t.type&&(n=this.buildPoints(t.coordinates,e,r,i)),n},parseFeature:function(t,e,r){try{var i=this.feature_style;if(i.order=this.parseOrder(e.order,r),null==i.order&&"overlay"!==this.blend){var n="Layer '".concat(e.layers.join(", "),"', draw group '").concat(e.group,"': ");return n+="'order' parameter is required unless blend mode is 'overlay'",null!=e.order&&(n+="; 'order' was set to a dynamic value (e.g. string tied to feature property, ",n+="or JS function), but evaluated to null for one or more features"),void log({level:"warn",once:!0},n)}if(!(i=this._parseFeature(t,e,r)))return;if(this.selection?i.interactive=StyleParser.evalProperty(this.introspection||e.interactive,r):i.interactive=!1,!0===i.interactive){var o=FeatureSelection.makeEntry(),a=o.color,s=o.key;i.selection_color=a,r.tile.selection_data||(r.tile.selection_data={}),r.tile.selection_data[s]={id:t.id||s,properties:t.properties,source_name:r.source,source_layer:r.layer,layers:r.layers}}else i.selection_color=FeatureSelection.defaultColor;return i}catch(e){log("error","Style.parseFeature: style parsing error",t,i,e.stack)}},_parseFeature:function(t,e,r){return this.feature_style},preprocess:function(t,e){if(!t.preprocessed){if(this.draw)for(var r in this.draw){var i=this.draw[r];"object"!==_typeof(i)||Array.isArray(i)?null==t[r]&&(t[r]=i):t[r]=mergeObjects({},i,t[r])}var n=e||"";if(!(t=this._preprocess(t,n)))return;t.preprocessed=!0}return t},_preprocess:function(t,e){return t},parseOrder:function(t,e){return"number"!=typeof t?StyleParser.calculateOrder(t,e):t},scaleOrder:function(t){return 2*t},parseColor:function(t,e){return t?StyleParser.evalCachedColorProperty(t,e):this.shaders.blocks.color||this.shaders.blocks.filter?StyleParser.defaults.color:void 0},buildPolygons:function(){return 0},buildLines:function(){return 0},buildPoints:function(){return 0},setGL:function(t){this.gl=t,this.max_texture_size=this.textureManager.getMaxTextureSize(this.gl)},makeMesh:function(t,e){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},i=this.vertexLayoutForMeshVariant(r.variant);return new VBOMesh(this.gl,t,e,i,this.scene_id,r)},render:function(t){return t.render()},getProgram:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"program";this.compileSetup();var e=this[t];if(e&&!e.error){if(!e.compiled)try{e.compile()}catch(e){log("error","Style: error compiling program for style '".concat(this.name,"' (program key '").concat(t,"')"),this,e.stack)}return e}},compileSetup:function(){if(!this.compile_setup){if(!this.gl)throw new Error("style.compile(): skipping for ".concat(this.name," because no GL context"));var t=this.buildDefineList();if(this.selection){var e=Object.assign({},t);e.TANGRAM_FEATURE_SELECTION=!0}var r=this.shaders&&this.shaders.blocks,i=this.shaders&&this.shaders.block_scopes,n=Object.assign({},this.shaders&&this.shaders.uniforms);for(var o in n)null==n[o]&&log({level:"warn",once:!0},"Style '".concat(this.name,"' has invalid uniform '").concat(o,"': uniform values must be non-null"));var a=this.shaders&&this.shaders.extensions;"string"==typeof a&&(a=[a]),this.program=new ShaderProgram(this.gl,this.vertex_shader_src,this.fragment_shader_src,this.scene_id,{name:this.name,defines:t,uniforms:n,blocks:r,block_scopes:i,extensions:a}),this.selection?this.selection_program=new ShaderProgram(this.gl,this.vertex_shader_src,this.crop_by_tile?shaderSrc_selectionCropFragment:shaderSrc_selectionFragment,this.scene_id,{name:this.name+" (selection)",defines:e,uniforms:n,blocks:r,block_scopes:i,extensions:a}):this.selection_program=null,this.compile_setup=!0}},addShaderBlock:function(t,e){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;this.shaders.blocks=this.shaders.blocks||{},this.shaders.blocks[t]=this.shaders.blocks[t]||[],this.shaders.blocks[t].push(e),this.shaders.block_scopes=this.shaders.block_scopes||{},this.shaders.block_scopes[t]=this.shaders.block_scopes[t]||[],this.shaders.block_scopes[t].push(r)},removeShaderBlock:function(t){this.shaders.blocks&&(this.shaders.blocks[t]=null)},replaceShaderBlock:function(t,e){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;this.removeShaderBlock(t),this.addShaderBlock(t,e,r)},buildDefineList:function(){var t={};if(null!=this.defines)for(var e in this.defines)t[e]=this.defines[e];if(null!=this.shaders&&null!=this.shaders.defines)for(e in this.shaders.defines)t[e]=this.shaders.defines[e];return t},hasRasters:function(){return["color","normal","custom"].indexOf(this.raster)>-1},setupRasters:function(){if(!Thread.is_main)return!1;if(!this.hasRasters())return!1;"color"===this.raster?this.defines.TANGRAM_RASTER_TEXTURE_COLOR=!0:"normal"===this.raster&&(this.defines.TANGRAM_RASTER_TEXTURE_NORMAL=!0);var t=!1;for(var e in this.sources)if(this.sources[e]instanceof RasterTileSource){t=!0;break}return!!t&&(this.defines.TANGRAM_MODEL_POSITION_BASE_ZOOM_VARYING=!0,this.replaceShaderBlock("raster",shaderSrc_rasters,"Raster"),!0)},buildRasterTextures:function(t,e){var r=this;if(!this.hasRasters())return Promise.resolve(e);var i={};return t.rasters.map((function(t){return r.sources[t]})).filter((function(t){return t})).forEach((function(e,r){if(e instanceof RasterTileSource){var n=e.tileTexture(t);i[n.url]=n}})),0===Object.keys(i).length?Promise.resolve(e):WorkerBroker.postMessage(this.main_thread_target+".loadTextures",i).then((function(r){if(!r||r.length<1)return log("trace","Missing texture info for tile ".concat(t.key)),null;if(r.some((function(t){return!t.loaded})))return null;e.uniforms=e.uniforms||{},e.textures=e.textures||[];var n=r[0].name,o=i[n].coords;if(e.uniforms.u_raster=n,e.textures.push(n),t.coords.z>o.z){var a=t.coords.z-o.z,s=Math.pow(2,a);e.uniforms.u_raster_offset=[(t.coords.x%s+s)%s/s,(s-1-t.coords.y%s)/s,1/s]}else e.uniforms.u_raster_offset=[0,0,1];return e}))},loadTextures:function(t){var e=this;return this.textureManager.createFromObject(this.gl,t).then((function(){return Promise.all(Object.keys(t).map((function(t){return e.textureManager.textures[t]&&e.textureManager.textures[t].load()})).filter((function(t){return t})))})).then((function(t){return t.forEach((function(t){return t.retain()})),t.map((function(t){return{name:t.name,width:t.width,height:t.height,loaded:t.loaded}}))}))},setup:function(){this.setUniforms(),this.material.setupProgram(ShaderProgram.current)},setUniforms:function(){var t=ShaderProgram.current;t&&t.setUniforms(this.shaders&&this.shaders.uniforms,!0)},render_states:{opaque:{depth_test:!0,depth_write:!0},translucent:{depth_test:!0,depth_write:!0},add:{depth_test:!0,depth_write:!1},multiply:{depth_test:!0,depth_write:!1},inlay:{depth_test:!0,depth_write:!1},overlay:{depth_test:!1,depth_write:!1}},default_blend_orders:{opaque:0,add:1,multiply:2,inlay:3,translucent:4,overlay:5},sortByBlendOrderWithinLayers:function(t){var e=[],r={};for(var i in t.forEach((function(t){var e=parseInt(t.name,10)||0;r[e]||(r[e]=[]),r[e].push(t)})),r)e.push.apply(e,_toConsumableArray(r[i].sort(Style.blendOrderSort)));return e},blendOrderSort:function(t,e){return"opaque"===t.blend||"opaque"===e.blend?"opaque"===t.blend&&"opaque"===e.blend?t.name<e.name?-1:1:"opaque"===t.blend?-1:1:t.blend_order<e.blend_order?-1:t.blend_order>e.blend_order?1:Style.default_blend_orders[t.blend]<Style.default_blend_orders[e.blend]?-1:Style.default_blend_orders[t.blend]>Style.default_blend_orders[e.blend]?1:t.name<e.name?-1:1}},id$1=0,build_id=0,Tile=function(){function t(e){var r=e.coords,i=e.style_zoom,n=e.source,o=e.worker,a=e.view,s=e.sceneId;_classCallCheck(this,t),this.textureManager=getTextureManager(s),this.id=id$1++,this.worker=o,this.view=a,this.source=n,this.generation=null,this.valid=!0,this.proxy_for=null,this.proxy_depth=0,this.proxied_as=null,this.fade_in=!0,this.loading=!1,this.loaded=!1,this.built=!1,this.labeled=!1,this.error=null,this.style_zoom=i,this.coords=t.normalizedCoordinate(r,this.source,this.style_zoom),this.key=t.key(this.coords,this.source,this.style_zoom),this.overzoom=Math.max(this.style_zoom-this.coords.z,0),this.overzoom2=Math.pow(2,this.overzoom),this.min=Geo$1.metersForTile(this.coords),this.max=Geo$1.metersForTile({x:this.coords.x+1,y:this.coords.y+1,z:this.coords.z}),this.span={x:this.max.x-this.min.x,y:this.max.y-this.min.y},this.bounds={sw:{x:this.min.x,y:this.max.y},ne:{x:this.max.x,y:this.min.y}},this.center_dist=0,this.meters_per_pixel=Geo$1.metersPerPixel(this.style_zoom),this.meters_per_pixel_sq=this.meters_per_pixel*this.meters_per_pixel,this.units_per_pixel=Geo$1.units_per_pixel/this.overzoom2,this.units_per_meter_overzoom=Geo$1.unitsPerMeter(this.coords.z)*this.overzoom2,this.meshes={},this.new_mesh_styles=[]}return _createClass(t,[{key:"freeResources",value:function(){for(var t in this.meshes)this.meshes[t].forEach((function(t){return t.destroy()}));this.meshes={}}},{key:"destroy",value:function(){Task.removeForTile(this.id),this.workerMessage("self.removeTile",this.id),this.freeResources(),this.worker=null,this.valid=!1}},{key:"buildAsMessage",value:function(){return{id:this.id,key:this.key,source:this.source.name,coords:this.coords,min:this.min,max:this.max,units_per_pixel:this.units_per_pixel,meters_per_pixel:this.meters_per_pixel,meters_per_pixel_sq:this.meters_per_pixel_sq,units_per_meter_overzoom:this.units_per_meter_overzoom,style_zoom:this.style_zoom,overzoom:this.overzoom,overzoom2:this.overzoom2,generation:this.generation}}},{key:"workerMessage",value:function(){for(var t=arguments.length,e=new Array(t),r=0;r<t;r++)e[r]=arguments[r];return WorkerBroker.postMessage.apply(WorkerBroker,[this.worker].concat(e))}},{key:"build",value:function(t){var e=(arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}).fade_in,r=void 0===e||e;return this.generation=t,this.fade_in=r,this.loaded||(this.loading=!0,this.built=!1,this.labeled=!1),this.workerMessage("self.buildTile",{tile:this.buildAsMessage()})}},{key:"buildMeshes",value:function(t,e){if(!this.error){this.build_id=build_id++;var r={},i=this.mesh_data;if(i)for(var n in i){for(var o in i[n].meshes){var a=i[n].meshes[o];if(a.vertex_data){if(!t[n]){log("warn","Could not create mesh because style '".concat(n,"' not found, for tile ").concat(this.key,", aborting tile"));break}var s=Object.assign({},i[n]);s.uniforms=Object.assign({},s.uniforms,a.uniforms),s.variant=a.variant,a.textures&&(s.textures=a.textures),a.labels&&(s.retain=!0);var l=t[n].makeMesh(a.vertex_data,a.vertex_elements,s);l.variant=s.variant,l.labels=a.labels,r[n]=r[n]||[],r[n].push(l),null==l.variant.order&&(l.variant.order=r[n].length-1)}}r[n]&&r[n].sort((function(t,e){var r=t.variant.order,i=e.variant.order;return null==r?1:null==i||r<i?-1:1}))}for(var u in delete this.mesh_data,r)this.meshes[u]&&this.meshes[u].forEach((function(t){return t.destroy()})),this.meshes[u]=r[u],this.new_mesh_styles.push(u);if(e.done){for(var c in this.meshes)-1===this.new_mesh_styles.indexOf(c)&&(this.meshes[c].forEach((function(t){return t.destroy()})),delete this.meshes[c]);this.new_mesh_styles=[]}}}},{key:"setProxyFor",value:function(t){t?(this.proxy_for=this.proxy_for||[],this.proxy_for.push(t),this.proxy_depth=1,t.proxied_as=t.style_zoom>this.style_zoom?"child":"parent"):(this.proxy_for=null,this.proxy_depth=0)}},{key:"isProxy",value:function(){return null!=this.proxy_for}},{key:"shouldProxyForStyle",value:function(t){return!this.proxy_for||this.proxy_for.some((function(e){return null==e.meshes[t]}))}},{key:"setupProgram",value:function(t,e){var r=t.model,i=t.model32;e.uniform("4fv","u_tile_origin",[this.min.x,this.min.y,this.style_zoom,this.coords.z]),e.uniform("1f","u_tile_proxy_depth",this.proxy_depth),mat4.identity(r),mat4.translate(r,r,vec3.fromValues(this.min.x,this.min.y,0)),mat4.scale(r,r,vec3.fromValues(this.span.x/Geo$1.tile_scale,-1*this.span.y/Geo$1.tile_scale,1)),mat4.copy(i,r),e.uniform("Matrix4fv","u_model",i),e.uniform("1i","u_tile_fade_in",this.fade_in&&"child"!==this.proxied_as)}},{key:"merge",value:function(t){return this.loading=t.loading,this.loaded=t.loaded,this.generation=t.generation,this.error=t.error,this.mesh_data=t.mesh_data,this.selection_data?Object.assign(this.selection_data,t.selection_data):this.selection_data=t.selection_data,this}}],[{key:"coord",value:function(e){return{x:e.x,y:e.y,z:e.z,key:t.coordKey(e)}}},{key:"coordKey",value:function(t){return t.x+"/"+t.y+"/"+t.z}},{key:"key",value:function(t,e,r){if(!(t.y<0||t.y>=1<<t.z||t.z<0))return[e.name,r,t.x,t.y,t.z].join("/")}},{key:"normalizedKey",value:function(e,r,i){return t.key(t.normalizedCoordinate(e,r,i),r,i)}},{key:"normalizedCoordinate",value:function(e,r,i){return r.zoom_bias&&(e=t.coordinateAtZoom(e,Math.max(0,e.z-r.zoom_bias))),t.coordinateWithMaxZoom(e,r.max_zoom)}},{key:"coordinateAtZoom",value:function(e,r){var i=e.x,n=e.y,o=e.z;if(o!==r){var a=Math.pow(2,o-r);i=Math.floor(i/a),n=Math.floor(n/a),o=r}return t.coord({x:i,y:n,z:o})}},{key:"coordinateWithMaxZoom",value:function(e,r){var i=e.x,n=e.y,o=e.z;return void 0!==r&&o>r?t.coordinateAtZoom({x:i,y:n,z:o},r):t.coord({x:i,y:n,z:o})}},{key:"childrenForCoordinate",value:function(e){var r=e.x,i=e.y,n=e.z,o=e.key;return t.coord_children[o]||(n++,r*=2,i*=2,t.coord_children[o]=[t.coord({x:r,y:i,z:n}),t.coord({x:r+1,y:i,z:n}),t.coord({x:r,y:i+1,z:n}),t.coord({x:r+1,y:i+1,z:n})]),t.coord_children[o]}},{key:"isDescendant",value:function(e,r){if(r.z>e.z){var i=t.coordinateAtZoom(r,e.z),n=i.x,o=i.y;return e.x===n&&e.y===o}return!1}},{key:"cancel",value:function(e){e&&(e.canceled=!0,e.source_data&&e.source_data.request_id&&(Utils$1.cancelRequest(e.source_data.request_id),e.source_data.request_id=null),t.abortBuild(e))}},{key:"buildGeometry",value:function(e,r){var i=r.scene_id,n=r.layers,o=r.styles,a=r.global,s=r.sources,l=r.meshVariantMaxLife,u=e.source_data;for(var c in Collision.startTile(e.id,{apply_repeat_groups:!0}),n){var h=n[c];if(h&&h.config_data){if(h.config_data.source===e.source)for(var p=t._getDataForSource(u,h.config_data,c),f=0;f<p.length;f++){var d=p[f],y=d.geom;if(y)for(var g=0;g<y.features.length;g++){var v=y.features[g];if(null!=v.geometry){var m=StyleParser.getFeatureParseContext(v,e,a,s);m.winding=e.default_winding,m.source=e.source,m.layer=d.layer;var _=h.buildDrawGroups(m,!0);if(_)for(var b in _){var x=_[b],w=x.style||b,E=o[w];E?null!=(x=E.preprocess(x,e.source))&&!1!==x.visible&&(m.layers=x.layers,E.addFeature(v,x,m)):log("warn","Style '".concat(w,"' not found, skipping layer '").concat(c,"':"),x,v)}}}}}else log("warn","Layer ".concat(c," was defined without a geometry data source and will not be rendered."))}var T=t._stylesForTile(e,o);t._sendStyleGroups(e,T,{scene_id:i,meshVariantMaxLife:l},(function(t){return t.collision?"collision":"non-collision"}))}},{key:"_stylesForTile",value:function(t,e){var r=[];for(var i in e)e[i].hasDataForTile(t)&&r.push(e[i]);return r}},{key:"_sendStyleGroups",value:function(e,r,i,n){var o=i.scene_id,a=i.meshVariantMaxLife,s={};if(r.forEach((function(t){var e=n(t);s[e]=s[e]||[],s[e].push(t)})),Object.keys(s).length>0){var l={start:!0};e.mesh_data={};var u=function(r){var i=s[r];Promise.all(i.map((function(t){return t.endData(e)}))).then((function(){log("trace","Finished style group '".concat(r,"' for tile ").concat(e.key)),s[r]=[],Object.keys(s).every((function(t){return 0===s[t].length}))&&(l.done=!0),WorkerBroker.postMessage("TileManager_".concat(o,".buildTileStylesCompleted"),WorkerBroker.withTransferables({tile:t.slice(e,["mesh_data","selection_data"]),progress:l})),l.start=null,e.mesh_data={},e.selection_data={},l.done&&Collision.resetTile(e.id)}),(function(t){log("error","Error for style group '".concat(r,"' for tile ").concat(e.key),t)}))};for(var c in s)u(c);Style.updateMeshVariantTypeCache(a)}else WorkerBroker.postMessage("TileManager_".concat(o,".buildTileStylesCompleted"),WorkerBroker.withTransferables({tile:t.slice(e),progress:{start:!0,done:!0}})),Collision.resetTile(e.id)}},{key:"_getDataForSource",value:function(t,e){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,i=[];return null!=e&&null!=t&&null!=t.layers&&(!e.layer&&t.layers._default||"string"==typeof e.layer&&!t.layers[e.layer]&&new RegExp("^\\d+_"+e.layer+"$").test(r)&&t.layers._default?i.push({geom:t.layers._default}):!e.layer&&r?i.push({layer:r,geom:t.layers[r]}):"string"==typeof e.layer?i.push({layer:e.layer,geom:t.layers[e.layer]}):Array.isArray(e.layer)&&e.layer.forEach((function(e){t.layers[e]&&t.layers[e].features&&i.push({layer:e,geom:t.layers[e]})}))),i}},{key:"abortBuild",value:function(t,e){if(Task.removeForTile(t.id),Collision.abortTile(t.id),t.mesh_data)for(var r in t.mesh_data){var i=t.mesh_data[r].textures;i&&i.forEach((function(r){var i=getTextureManager(e).textures[r];i&&(log("trace","releasing texture ".concat(r," for tile ").concat(t.key)),i.release())}))}}},{key:"slice",value:function(t,e){var r=["id","key","loading","loaded","generation","error","debug"];Array.isArray(e)&&r.push.apply(r,_toConsumableArray(e));for(var i={},n=0;n<r.length;n++){var o=r[n];i[o]=t[o]}return i}}])}();Tile.coord_children={};var RasterTileSource=function(t){function e(t,r){var i;return _classCallCheck(this,e),-1===(i=_callSuper(this,e,[t,r])).rasters.indexOf(i.name)&&i.rasters.unshift(i.name),i.filtering=t.filtering,i.textures={},i}return _inherits(e,t),_createClass(e,[{key:"load",value:function(t){t.source_data={},t.source_data.layers={},t.pad_scale=this.pad_scale,t.rasters=_toConsumableArray(this.rasters);var e=Geo$1.tile_scale;return t.source_data.layers={_default:{type:"FeatureCollection",features:[{geometry:{type:"Polygon",coordinates:[[[0,0],[e,0],[e,-e],[0,-e],[0,0]]]},properties:{}}]}},t.default_winding="CW",Promise.resolve(t)}},{key:"tileTexture",value:function(t){var e=t.coords.key;if(!this.textures[e]){var r=Tile.coordinateWithMaxZoom(t.coords,this.max_zoom),i=this.formatUrl(this.url,{coords:r});this.textures[e]={url:i,filtering:this.filtering,coords:r}}return this.textures[e]}}])}(NetworkTileSource),ArrayUtils;DataSource.register(RasterTileSource,"Raster");var ArrayUtils$1=ArrayUtils={};function simplify(t,e,r,i){for(var n,o=i,a=r-e>>1,s=r-e,l=t[e],u=t[e+1],c=t[r],h=t[r+1],p=e+3;p<r;p+=3){var f=getSqSegDist(t[p],t[p+1],l,u,c,h);if(f>o)n=p,o=f;else if(f===o){var d=Math.abs(p-a);d<s&&(n=p,s=d)}}o>i&&(n-e>3&&simplify(t,e,n,i),t[n+2]=o,r-n>3&&simplify(t,n,r,i))}function getSqSegDist(t,e,r,i,n,o){var a=n-r,s=o-i;if(0!==a||0!==s){var l=((t-r)*a+(e-i)*s)/(a*a+s*s);l>1?(r=n,i=o):l>0&&(r+=a*l,i+=s*l)}return(a=t-r)*a+(s=e-i)*s}function createFeature(t,e,r,i){var n={id:void 0===t?null:t,type:e,geometry:r,tags:i,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return calcBBox(n),n}function calcBBox(t){var e=t.geometry,r=t.type;if("Point"===r||"MultiPoint"===r||"LineString"===r)calcLineBBox(t,e);else if("Polygon"===r||"MultiLineString"===r)for(var i=0;i<e.length;i++)calcLineBBox(t,e[i]);else if("MultiPolygon"===r)for(i=0;i<e.length;i++)for(var n=0;n<e[i].length;n++)calcLineBBox(t,e[i][n])}function calcLineBBox(t,e){for(var r=0;r<e.length;r+=3)t.minX=Math.min(t.minX,e[r]),t.minY=Math.min(t.minY,e[r+1]),t.maxX=Math.max(t.maxX,e[r]),t.maxY=Math.max(t.maxY,e[r+1])}function convert(t,e){var r=[];if("FeatureCollection"===t.type)for(var i=0;i<t.features.length;i++)convertFeature(r,t.features[i],e,i);else"Feature"===t.type?convertFeature(r,t,e):convertFeature(r,{geometry:t},e);return r}function convertFeature(t,e,r,i){if(e.geometry){var n=e.geometry.coordinates,o=e.geometry.type,a=Math.pow(r.tolerance/((1<<r.maxZoom)*r.extent),2),s=[],l=e.id;if(r.promoteId?l=e.properties[r.promoteId]:r.generateId&&(l=i||0),"Point"===o)convertPoint(n,s);else if("MultiPoint"===o)for(var u=0;u<n.length;u++)convertPoint(n[u],s);else if("LineString"===o)convertLine(n,s,a,!1);else if("MultiLineString"===o){if(r.lineMetrics){for(u=0;u<n.length;u++)s=[],convertLine(n[u],s,a,!1),t.push(createFeature(l,"LineString",s,e.properties));return}convertLines(n,s,a,!1)}else if("Polygon"===o)convertLines(n,s,a,!0);else{if("MultiPolygon"!==o){if("GeometryCollection"===o){for(u=0;u<e.geometry.geometries.length;u++)convertFeature(t,{id:l,geometry:e.geometry.geometries[u],properties:e.properties},r,i);return}throw new Error("Input data is not a valid GeoJSON object.")}for(u=0;u<n.length;u++){var c=[];convertLines(n[u],c,a,!0),s.push(c)}}t.push(createFeature(l,o,s,e.properties))}}function convertPoint(t,e){e.push(projectX(t[0])),e.push(projectY(t[1])),e.push(0)}function convertLine(t,e,r,i){for(var n,o,a=0,s=0;s<t.length;s++){var l=projectX(t[s][0]),u=projectY(t[s][1]);e.push(l),e.push(u),e.push(0),s>0&&(a+=i?(n*u-l*o)/2:Math.sqrt(Math.pow(l-n,2)+Math.pow(u-o,2))),n=l,o=u}var c=e.length-3;e[2]=1,simplify(e,0,c,r),e[c+2]=1,e.size=Math.abs(a),e.start=0,e.end=e.size}function convertLines(t,e,r,i){for(var n=0;n<t.length;n++){var o=[];convertLine(t[n],o,r,i),e.push(o)}}function projectX(t){return t/360+.5}function projectY(t){var e=Math.sin(t*Math.PI/180),r=.5-.25*Math.log((1+e)/(1-e))/Math.PI;return r<0?0:r>1?1:r}function clip(t,e,r,i,n,o,a,s){if(i/=e,o>=(r/=e)&&a<i)return t;if(a<r||o>=i)return null;for(var l=[],u=0;u<t.length;u++){var c=t[u],h=c.geometry,p=c.type,f=0===n?c.minX:c.minY,d=0===n?c.maxX:c.maxY;if(f>=r&&d<i)l.push(c);else if(!(d<r||f>=i)){var y=[];if("Point"===p||"MultiPoint"===p)clipPoints(h,y,r,i,n);else if("LineString"===p)clipLine(h,y,r,i,n,!1,s.lineMetrics);else if("MultiLineString"===p)clipLines(h,y,r,i,n,!1);else if("Polygon"===p)clipLines(h,y,r,i,n,!0);else if("MultiPolygon"===p)for(var g=0;g<h.length;g++){var v=[];clipLines(h[g],v,r,i,n,!0),v.length&&y.push(v)}if(y.length){if(s.lineMetrics&&"LineString"===p){for(g=0;g<y.length;g++)l.push(createFeature(c.id,p,y[g],c.tags));continue}"LineString"!==p&&"MultiLineString"!==p||(1===y.length?(p="LineString",y=y[0]):p="MultiLineString"),"Point"!==p&&"MultiPoint"!==p||(p=3===y.length?"Point":"MultiPoint"),l.push(createFeature(c.id,p,y,c.tags))}}}return l.length?l:null}function clipPoints(t,e,r,i,n){for(var o=0;o<t.length;o+=3){var a=t[o+n];a>=r&&a<=i&&(e.push(t[o]),e.push(t[o+1]),e.push(t[o+2]))}}function clipLine(t,e,r,i,n,o,a){for(var s,l,u=newSlice(t),c=0===n?intersectX:intersectY,h=t.start,p=0;p<t.length-3;p+=3){var f=t[p],d=t[p+1],y=t[p+2],g=t[p+3],v=t[p+4],m=0===n?f:d,_=0===n?g:v,b=!1;a&&(s=Math.sqrt(Math.pow(f-g,2)+Math.pow(d-v,2))),m<r?_>r&&(l=c(u,f,d,g,v,r),a&&(u.start=h+s*l)):m>i?_<i&&(l=c(u,f,d,g,v,i),a&&(u.start=h+s*l)):addPoint(u,f,d,y),_<r&&m>=r&&(l=c(u,f,d,g,v,r),b=!0),_>i&&m<=i&&(l=c(u,f,d,g,v,i),b=!0),!o&&b&&(a&&(u.end=h+s*l),e.push(u),u=newSlice(t)),a&&(h+=s)}var x=t.length-3;f=t[x],d=t[x+1],y=t[x+2],(m=0===n?f:d)>=r&&m<=i&&addPoint(u,f,d,y),x=u.length-3,o&&x>=3&&(u[x]!==u[0]||u[x+1]!==u[1])&&addPoint(u,u[0],u[1],u[2]),u.length&&e.push(u)}function newSlice(t){var e=[];return e.size=t.size,e.start=t.start,e.end=t.end,e}function clipLines(t,e,r,i,n,o){for(var a=0;a<t.length;a++)clipLine(t[a],e,r,i,n,o,!1)}function addPoint(t,e,r,i){t.push(e),t.push(r),t.push(i)}function intersectX(t,e,r,i,n,o){var a=(o-e)/(i-e);return t.push(o),t.push(r+(n-r)*a),t.push(1),a}function intersectY(t,e,r,i,n,o){var a=(o-r)/(n-r);return t.push(e+(i-e)*a),t.push(o),t.push(1),a}function wrap$1(t,e){var r=e.buffer/e.extent,i=t,n=clip(t,1,-1-r,r,0,-1,2,e),o=clip(t,1,1-r,2+r,0,-1,2,e);return(n||o)&&(i=clip(t,1,-r,1+r,0,-1,2,e)||[],n&&(i=shiftFeatureCoords(n,1).concat(i)),o&&(i=i.concat(shiftFeatureCoords(o,-1)))),i}function shiftFeatureCoords(t,e){for(var r=[],i=0;i<t.length;i++){var n,o=t[i],a=o.type;if("Point"===a||"MultiPoint"===a||"LineString"===a)n=shiftCoords(o.geometry,e);else if("MultiLineString"===a||"Polygon"===a){n=[];for(var s=0;s<o.geometry.length;s++)n.push(shiftCoords(o.geometry[s],e))}else if("MultiPolygon"===a)for(n=[],s=0;s<o.geometry.length;s++){for(var l=[],u=0;u<o.geometry[s].length;u++)l.push(shiftCoords(o.geometry[s][u],e));n.push(l)}r.push(createFeature(o.id,a,n,o.tags))}return r}function shiftCoords(t,e){var r=[];r.size=t.size,void 0!==t.start&&(r.start=t.start,r.end=t.end);for(var i=0;i<t.length;i+=3)r.push(t[i]+e,t[i+1],t[i+2]);return r}function transformTile(t,e){if(t.transformed)return t;var r,i,n,o=1<<t.z,a=t.x,s=t.y;for(r=0;r<t.features.length;r++){var l=t.features[r],u=l.geometry,c=l.type;if(l.geometry=[],1===c)for(i=0;i<u.length;i+=2)l.geometry.push(transformPoint(u[i],u[i+1],e,o,a,s));else for(i=0;i<u.length;i++){var h=[];for(n=0;n<u[i].length;n+=2)h.push(transformPoint(u[i][n],u[i][n+1],e,o,a,s));l.geometry.push(h)}}return t.transformed=!0,t}function transformPoint(t,e,r,i,n,o){return[Math.round(r*(t*i-n)),Math.round(r*(e*i-o))]}function createTile(t,e,r,i,n){for(var o=e===n.maxZoom?0:n.tolerance/((1<<e)*n.extent),a={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:r,y:i,z:e,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},s=0;s<t.length;s++){a.numFeatures++,addFeature(a,t[s],o,n);var l=t[s].minX,u=t[s].minY,c=t[s].maxX,h=t[s].maxY;l<a.minX&&(a.minX=l),u<a.minY&&(a.minY=u),c>a.maxX&&(a.maxX=c),h>a.maxY&&(a.maxY=h)}return a}function addFeature(t,e,r,i){var n=e.geometry,o=e.type,a=[];if("Point"===o||"MultiPoint"===o)for(var s=0;s<n.length;s+=3)a.push(n[s]),a.push(n[s+1]),t.numPoints++,t.numSimplified++;else if("LineString"===o)addLine(a,n,t,r,!1,!1);else if("MultiLineString"===o||"Polygon"===o)for(s=0;s<n.length;s++)addLine(a,n[s],t,r,"Polygon"===o,0===s);else if("MultiPolygon"===o)for(var l=0;l<n.length;l++){var u=n[l];for(s=0;s<u.length;s++)addLine(a,u[s],t,r,!0,0===s)}if(a.length){var c=e.tags||null;if("LineString"===o&&i.lineMetrics){for(var h in c={},e.tags)c[h]=e.tags[h];c.mapbox_clip_start=n.start/n.size,c.mapbox_clip_end=n.end/n.size}var p={geometry:a,type:"Polygon"===o||"MultiPolygon"===o?3:"LineString"===o||"MultiLineString"===o?2:1,tags:c};null!==e.id&&(p.id=e.id),t.features.push(p)}}function addLine(t,e,r,i,n,o){var a=i*i;if(i>0&&e.size<(n?a:i))r.numPoints+=e.length/3;else{for(var s=[],l=0;l<e.length;l+=3)(0===i||e[l+2]>a)&&(r.numSimplified++,s.push(e[l]),s.push(e[l+1])),r.numPoints++;n&&rewind(s,o),t.push(s)}}function rewind(t,e){for(var r=0,i=0,n=t.length,o=n-2;i<n;o=i,i+=2)r+=(t[i]-t[o])*(t[i+1]+t[o+1]);if(r>0===e)for(i=0,n=t.length;i<n/2;i+=2){var a=t[i],s=t[i+1];t[i]=t[n-2-i],t[i+1]=t[n-1-i],t[n-2-i]=a,t[n-1-i]=s}}ArrayUtils.deepClone=function(t){return Array.isArray(t)?t.map(ArrayUtils.deepClone):t};var defaults={maxZoom:14,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1};function createGeoJsonTile(t,e,r,i,n){var o=Object.assign({},defaults,n),a=convert(t,o),s=getBBox(a=wrap$1(a,o)),l=s.minX,u=s.minY,c=s.maxX,h=s.maxY,p=1<<e,f=o.buffer/o.extent,d=1+f;return a=clip(a,p,r-f,r+d,0,l,c,o)||[],transformTile(createTile(a=clip(a,p,i-f,i+d,1,u,h,o)||[],e,r,i,o),o.extent)}function getBBox(t){var e,r=2,i=-1,n=1,o=0,a=_createForOfIteratorHelper(t);try{for(a.s();!(e=a.n()).done;){var s=e.value;s.minX<r&&(r=s.minX),s.maxX>i&&(i=s.maxX),s.minY<n&&(n=s.minY),s.maxY>o&&(o=s.maxY)}}catch(t){a.e(t)}finally{a.f()}return{minX:r,maxX:i,minY:n,maxY:o}}function PackingSmith$1(t,e){this.items=[],this.algorithm=t;var r=void 0===(e=e||{}).sort||e.sort;this.sort=r}PackingSmith$1.prototype={addItem:function(t){this.items.push(t)},normalizeCoordinates:function(){var t=this.items,e=1/0,r=1/0;t.forEach((function(t){var i=t;e=Math.min(e,i.x),r=Math.min(r,i.y)})),t.forEach((function(t){var i=t;i.x-=e,i.y-=r}))},getStats:function(){var t=this.items.map((function(t){return t})),e=t.map((function(t){return t.x})),r=t.map((function(t){return t.y})),i=t.map((function(t){return t.x+t.width})),n=t.map((function(t){return t.y+t.height}));return{minX:Math.max.apply(Math,e),minY:Math.max.apply(Math,r),maxX:Math.max.apply(Math,i),maxY:Math.max.apply(Math,n)}},getItems:function(){return this.items},processItems:function(){var t=this.items;return this.sort&&(t=this.algorithm.sort(t)),t=this.algorithm.placeItems(t),this.items=t,t},exportItems:function(){return this.processItems(),this.normalizeCoordinates(),this.items},export:function(){var t=this.exportItems(),e=this.getStats();return{height:e.maxY,width:e.maxX,items:t}}};var packing_smith=PackingSmith$1,lookup=[],revLookup=[],Arr="undefined"!=typeof Uint8Array?Uint8Array:Array,inited=!1;function init(){inited=!0;for(var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",e=0;e<64;++e)lookup[e]=t[e],revLookup[t.charCodeAt(e)]=e;revLookup["-".charCodeAt(0)]=62,revLookup["_".charCodeAt(0)]=63}function toByteArray(t){var e,r,i,n,o,a;inited||init();var s=t.length;if(s%4>0)throw new Error("Invalid string. Length must be a multiple of 4");o="="===t[s-2]?2:"="===t[s-1]?1:0,a=new Arr(3*s/4-o),i=o>0?s-4:s;var l=0;for(e=0,r=0;e<i;e+=4,r+=3)n=revLookup[t.charCodeAt(e)]<<18|revLookup[t.charCodeAt(e+1)]<<12|revLookup[t.charCodeAt(e+2)]<<6|revLookup[t.charCodeAt(e+3)],a[l++]=n>>16&255,a[l++]=n>>8&255,a[l++]=255&n;return 2===o?(n=revLookup[t.charCodeAt(e)]<<2|revLookup[t.charCodeAt(e+1)]>>4,a[l++]=255&n):1===o&&(n=revLookup[t.charCodeAt(e)]<<10|revLookup[t.charCodeAt(e+1)]<<4|revLookup[t.charCodeAt(e+2)]>>2,a[l++]=n>>8&255,a[l++]=255&n),a}function tripletToBase64(t){return lookup[t>>18&63]+lookup[t>>12&63]+lookup[t>>6&63]+lookup[63&t]}function encodeChunk(t,e,r){for(var i,n=[],o=e;o<r;o+=3)i=(t[o]<<16)+(t[o+1]<<8)+t[o+2],n.push(tripletToBase64(i));return n.join("")}function fromByteArray(t){var e;inited||init();for(var r=t.length,i=r%3,n="",o=[],a=16383,s=0,l=r-i;s<l;s+=a)o.push(encodeChunk(t,s,s+a>l?l:s+a));return 1===i?(e=t[r-1],n+=lookup[e>>2],n+=lookup[e<<4&63],n+="=="):2===i&&(e=(t[r-2]<<8)+t[r-1],n+=lookup[e>>10],n+=lookup[e>>4&63],n+=lookup[e<<2&63],n+="="),o.push(n),o.join("")}function read(t,e,r,i,n){var o,a,s=8*n-i-1,l=(1<<s)-1,u=l>>1,c=-7,h=r?n-1:0,p=r?-1:1,f=t[e+h];for(h+=p,o=f&(1<<-c)-1,f>>=-c,c+=s;c>0;o=256*o+t[e+h],h+=p,c-=8);for(a=o&(1<<-c)-1,o>>=-c,c+=i;c>0;a=256*a+t[e+h],h+=p,c-=8);if(0===o)o=1-u;else{if(o===l)return a?NaN:1/0*(f?-1:1);a+=Math.pow(2,i),o-=u}return(f?-1:1)*a*Math.pow(2,o-i)}function write(t,e,r,i,n,o){var a,s,l,u=8*o-n-1,c=(1<<u)-1,h=c>>1,p=23===n?Math.pow(2,-24)-Math.pow(2,-77):0,f=i?0:o-1,d=i?1:-1,y=e<0||0===e&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(s=isNaN(e)?1:0,a=c):(a=Math.floor(Math.log(e)/Math.LN2),e*(l=Math.pow(2,-a))<1&&(a--,l*=2),(e+=a+h>=1?p/l:p*Math.pow(2,1-h))*l>=2&&(a++,l/=2),a+h>=c?(s=0,a=c):a+h>=1?(s=(e*l-1)*Math.pow(2,n),a+=h):(s=e*Math.pow(2,h-1)*Math.pow(2,n),a=0));n>=8;t[r+f]=255&s,f+=d,s/=256,n-=8);for(a=a<<n|s,u+=n;u>0;t[r+f]=255&a,f+=d,a/=256,u-=8);t[r+f-d]|=128*y}var toString={}.toString,isArray$1=Array.isArray||function(t){return"[object Array]"==toString.call(t)},INSPECT_MAX_BYTES=50;function kMaxLength(){return Buffer.TYPED_ARRAY_SUPPORT?2147483647:1073741823}function createBuffer(t,e){if(kMaxLength()<e)throw new RangeError("Invalid typed array length");return Buffer.TYPED_ARRAY_SUPPORT?(t=new Uint8Array(e)).__proto__=Buffer.prototype:(null===t&&(t=new Buffer(e)),t.length=e),t}function Buffer(t,e,r){if(!(Buffer.TYPED_ARRAY_SUPPORT||this instanceof Buffer))return new Buffer(t,e,r);if("number"==typeof t){if("string"==typeof e)throw new Error("If encoding is specified then the first argument must be a string");return allocUnsafe(this,t)}return from(this,t,e,r)}function from(t,e,r,i){if("number"==typeof e)throw new TypeError('"value" argument must not be a number');return"undefined"!=typeof ArrayBuffer&&e instanceof ArrayBuffer?fromArrayBuffer(t,e,r,i):"string"==typeof e?fromString(t,e,r):fromObject(t,e)}function assertSize(t){if("number"!=typeof t)throw new TypeError('"size" argument must be a number');if(t<0)throw new RangeError('"size" argument must not be negative')}function alloc(t,e,r,i){return assertSize(e),e<=0?createBuffer(t,e):void 0!==r?"string"==typeof i?createBuffer(t,e).fill(r,i):createBuffer(t,e).fill(r):createBuffer(t,e)}function allocUnsafe(t,e){if(assertSize(e),t=createBuffer(t,e<0?0:0|checked(e)),!Buffer.TYPED_ARRAY_SUPPORT)for(var r=0;r<e;++r)t[r]=0;return t}function fromString(t,e,r){if("string"==typeof r&&""!==r||(r="utf8"),!Buffer.isEncoding(r))throw new TypeError('"encoding" must be a valid string encoding');var i=0|byteLength(e,r),n=(t=createBuffer(t,i)).write(e,r);return n!==i&&(t=t.slice(0,n)),t}function fromArrayLike(t,e){var r=e.length<0?0:0|checked(e.length);t=createBuffer(t,r);for(var i=0;i<r;i+=1)t[i]=255&e[i];return t}function fromArrayBuffer(t,e,r,i){if(e.byteLength,r<0||e.byteLength<r)throw new RangeError("'offset' is out of bounds");if(e.byteLength<r+(i||0))throw new RangeError("'length' is out of bounds");return e=void 0===r&&void 0===i?new Uint8Array(e):void 0===i?new Uint8Array(e,r):new Uint8Array(e,r,i),Buffer.TYPED_ARRAY_SUPPORT?(t=e).__proto__=Buffer.prototype:t=fromArrayLike(t,e),t}function fromObject(t,e){if(internalIsBuffer(e)){var r=0|checked(e.length);return 0===(t=createBuffer(t,r)).length||e.copy(t,0,0,r),t}if(e){if("undefined"!=typeof ArrayBuffer&&e.buffer instanceof ArrayBuffer||"length"in e)return"number"!=typeof e.length||isnan(e.length)?createBuffer(t,0):fromArrayLike(t,e);if("Buffer"===e.type&&isArray$1(e.data))return fromArrayLike(t,e.data)}throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.")}function checked(t){if(t>=kMaxLength())throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+kMaxLength().toString(16)+" bytes");return 0|t}function internalIsBuffer(t){return!(null==t||!t._isBuffer)}function byteLength(t,e){if(internalIsBuffer(t))return t.length;if("undefined"!=typeof ArrayBuffer&&"function"==typeof ArrayBuffer.isView&&(ArrayBuffer.isView(t)||t instanceof ArrayBuffer))return t.byteLength;"string"!=typeof t&&(t=""+t);var r=t.length;if(0===r)return 0;for(var i=!1;;)switch(e){case"ascii":case"latin1":case"binary":return r;case"utf8":case"utf-8":case void 0:return utf8ToBytes(t).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*r;case"hex":return r>>>1;case"base64":return base64ToBytes(t).length;default:if(i)return utf8ToBytes(t).length;e=(""+e).toLowerCase(),i=!0}}function slowToString(t,e,r){var i=!1;if((void 0===e||e<0)&&(e=0),e>this.length)return"";if((void 0===r||r>this.length)&&(r=this.length),r<=0)return"";if((r>>>=0)<=(e>>>=0))return"";for(t||(t="utf8");;)switch(t){case"hex":return hexSlice(this,e,r);case"utf8":case"utf-8":return utf8Slice(this,e,r);case"ascii":return asciiSlice(this,e,r);case"latin1":case"binary":return latin1Slice(this,e,r);case"base64":return base64Slice(this,e,r);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return utf16leSlice(this,e,r);default:if(i)throw new TypeError("Unknown encoding: "+t);t=(t+"").toLowerCase(),i=!0}}function swap(t,e,r){var i=t[e];t[e]=t[r],t[r]=i}function bidirectionalIndexOf(t,e,r,i,n){if(0===t.length)return-1;if("string"==typeof r?(i=r,r=0):r>2147483647?r=2147483647:r<-2147483648&&(r=-2147483648),r=+r,isNaN(r)&&(r=n?0:t.length-1),r<0&&(r=t.length+r),r>=t.length){if(n)return-1;r=t.length-1}else if(r<0){if(!n)return-1;r=0}if("string"==typeof e&&(e=Buffer.from(e,i)),internalIsBuffer(e))return 0===e.length?-1:arrayIndexOf(t,e,r,i,n);if("number"==typeof e)return e&=255,Buffer.TYPED_ARRAY_SUPPORT&&"function"==typeof Uint8Array.prototype.indexOf?n?Uint8Array.prototype.indexOf.call(t,e,r):Uint8Array.prototype.lastIndexOf.call(t,e,r):arrayIndexOf(t,[e],r,i,n);throw new TypeError("val must be string, number or Buffer")}function arrayIndexOf(t,e,r,i,n){var o,a=1,s=t.length,l=e.length;if(void 0!==i&&("ucs2"===(i=String(i).toLowerCase())||"ucs-2"===i||"utf16le"===i||"utf-16le"===i)){if(t.length<2||e.length<2)return-1;a=2,s/=2,l/=2,r/=2}function u(t,e){return 1===a?t[e]:t.readUInt16BE(e*a)}if(n){var c=-1;for(o=r;o<s;o++)if(u(t,o)===u(e,-1===c?0:o-c)){if(-1===c&&(c=o),o-c+1===l)return c*a}else-1!==c&&(o-=o-c),c=-1}else for(r+l>s&&(r=s-l),o=r;o>=0;o--){for(var h=!0,p=0;p<l;p++)if(u(t,o+p)!==u(e,p)){h=!1;break}if(h)return o}return-1}function hexWrite(t,e,r,i){r=Number(r)||0;var n=t.length-r;i?(i=Number(i))>n&&(i=n):i=n;var o=e.length;if(o%2!=0)throw new TypeError("Invalid hex string");i>o/2&&(i=o/2);for(var a=0;a<i;++a){var s=parseInt(e.substr(2*a,2),16);if(isNaN(s))return a;t[r+a]=s}return a}function utf8Write(t,e,r,i){return blitBuffer(utf8ToBytes(e,t.length-r),t,r,i)}function asciiWrite(t,e,r,i){return blitBuffer(asciiToBytes(e),t,r,i)}function latin1Write(t,e,r,i){return asciiWrite(t,e,r,i)}function base64Write(t,e,r,i){return blitBuffer(base64ToBytes(e),t,r,i)}function ucs2Write(t,e,r,i){return blitBuffer(utf16leToBytes(e,t.length-r),t,r,i)}function base64Slice(t,e,r){return 0===e&&r===t.length?fromByteArray(t):fromByteArray(t.slice(e,r))}function utf8Slice(t,e,r){r=Math.min(t.length,r);for(var i=[],n=e;n<r;){var o,a,s,l,u=t[n],c=null,h=u>239?4:u>223?3:u>191?2:1;if(n+h<=r)switch(h){case 1:u<128&&(c=u);break;case 2:128==(192&(o=t[n+1]))&&(l=(31&u)<<6|63&o)>127&&(c=l);break;case 3:o=t[n+1],a=t[n+2],128==(192&o)&&128==(192&a)&&(l=(15&u)<<12|(63&o)<<6|63&a)>2047&&(l<55296||l>57343)&&(c=l);break;case 4:o=t[n+1],a=t[n+2],s=t[n+3],128==(192&o)&&128==(192&a)&&128==(192&s)&&(l=(15&u)<<18|(63&o)<<12|(63&a)<<6|63&s)>65535&&l<1114112&&(c=l)}null===c?(c=65533,h=1):c>65535&&(c-=65536,i.push(c>>>10&1023|55296),c=56320|1023&c),i.push(c),n+=h}return decodeCodePointsArray(i)}Buffer.TYPED_ARRAY_SUPPORT=void 0===global$1.TYPED_ARRAY_SUPPORT||global$1.TYPED_ARRAY_SUPPORT,kMaxLength(),Buffer.poolSize=8192,Buffer._augment=function(t){return t.__proto__=Buffer.prototype,t},Buffer.from=function(t,e,r){return from(null,t,e,r)},Buffer.TYPED_ARRAY_SUPPORT&&(Buffer.prototype.__proto__=Uint8Array.prototype,Buffer.__proto__=Uint8Array,"undefined"!=typeof Symbol&&Symbol.species&&Buffer[Symbol.species]),Buffer.alloc=function(t,e,r){return alloc(null,t,e,r)},Buffer.allocUnsafe=function(t){return allocUnsafe(null,t)},Buffer.allocUnsafeSlow=function(t){return allocUnsafe(null,t)},Buffer.isBuffer=isBuffer,Buffer.compare=function(t,e){if(!internalIsBuffer(t)||!internalIsBuffer(e))throw new TypeError("Arguments must be Buffers");if(t===e)return 0;for(var r=t.length,i=e.length,n=0,o=Math.min(r,i);n<o;++n)if(t[n]!==e[n]){r=t[n],i=e[n];break}return r<i?-1:i<r?1:0},Buffer.isEncoding=function(t){switch(String(t).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},Buffer.concat=function(t,e){if(!isArray$1(t))throw new TypeError('"list" argument must be an Array of Buffers');if(0===t.length)return Buffer.alloc(0);var r;if(void 0===e)for(e=0,r=0;r<t.length;++r)e+=t[r].length;var i=Buffer.allocUnsafe(e),n=0;for(r=0;r<t.length;++r){var o=t[r];if(!internalIsBuffer(o))throw new TypeError('"list" argument must be an Array of Buffers');o.copy(i,n),n+=o.length}return i},Buffer.byteLength=byteLength,Buffer.prototype._isBuffer=!0,Buffer.prototype.swap16=function(){var t=this.length;if(t%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var e=0;e<t;e+=2)swap(this,e,e+1);return this},Buffer.prototype.swap32=function(){var t=this.length;if(t%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var e=0;e<t;e+=4)swap(this,e,e+3),swap(this,e+1,e+2);return this},Buffer.prototype.swap64=function(){var t=this.length;if(t%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var e=0;e<t;e+=8)swap(this,e,e+7),swap(this,e+1,e+6),swap(this,e+2,e+5),swap(this,e+3,e+4);return this},Buffer.prototype.toString=function(){var t=0|this.length;return 0===t?"":0===arguments.length?utf8Slice(this,0,t):slowToString.apply(this,arguments)},Buffer.prototype.equals=function(t){if(!internalIsBuffer(t))throw new TypeError("Argument must be a Buffer");return this===t||0===Buffer.compare(this,t)},Buffer.prototype.inspect=function(){var t="",e=INSPECT_MAX_BYTES;return this.length>0&&(t=this.toString("hex",0,e).match(/.{2}/g).join(" "),this.length>e&&(t+=" ... ")),"<Buffer "+t+">"},Buffer.prototype.compare=function(t,e,r,i,n){if(!internalIsBuffer(t))throw new TypeError("Argument must be a Buffer");if(void 0===e&&(e=0),void 0===r&&(r=t?t.length:0),void 0===i&&(i=0),void 0===n&&(n=this.length),e<0||r>t.length||i<0||n>this.length)throw new RangeError("out of range index");if(i>=n&&e>=r)return 0;if(i>=n)return-1;if(e>=r)return 1;if(this===t)return 0;for(var o=(n>>>=0)-(i>>>=0),a=(r>>>=0)-(e>>>=0),s=Math.min(o,a),l=this.slice(i,n),u=t.slice(e,r),c=0;c<s;++c)if(l[c]!==u[c]){o=l[c],a=u[c];break}return o<a?-1:a<o?1:0},Buffer.prototype.includes=function(t,e,r){return-1!==this.indexOf(t,e,r)},Buffer.prototype.indexOf=function(t,e,r){return bidirectionalIndexOf(this,t,e,r,!0)},Buffer.prototype.lastIndexOf=function(t,e,r){return bidirectionalIndexOf(this,t,e,r,!1)},Buffer.prototype.write=function(t,e,r,i){if(void 0===e)i="utf8",r=this.length,e=0;else if(void 0===r&&"string"==typeof e)i=e,r=this.length,e=0;else{if(!isFinite(e))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");e|=0,isFinite(r)?(r|=0,void 0===i&&(i="utf8")):(i=r,r=void 0)}var n=this.length-e;if((void 0===r||r>n)&&(r=n),t.length>0&&(r<0||e<0)||e>this.length)throw new RangeError("Attempt to write outside buffer bounds");i||(i="utf8");for(var o=!1;;)switch(i){case"hex":return hexWrite(this,t,e,r);case"utf8":case"utf-8":return utf8Write(this,t,e,r);case"ascii":return asciiWrite(this,t,e,r);case"latin1":case"binary":return latin1Write(this,t,e,r);case"base64":return base64Write(this,t,e,r);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return ucs2Write(this,t,e,r);default:if(o)throw new TypeError("Unknown encoding: "+i);i=(""+i).toLowerCase(),o=!0}},Buffer.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};var MAX_ARGUMENTS_LENGTH=4096;function decodeCodePointsArray(t){var e=t.length;if(e<=MAX_ARGUMENTS_LENGTH)return String.fromCharCode.apply(String,t);for(var r="",i=0;i<e;)r+=String.fromCharCode.apply(String,t.slice(i,i+=MAX_ARGUMENTS_LENGTH));return r}function asciiSlice(t,e,r){var i="";r=Math.min(t.length,r);for(var n=e;n<r;++n)i+=String.fromCharCode(127&t[n]);return i}function latin1Slice(t,e,r){var i="";r=Math.min(t.length,r);for(var n=e;n<r;++n)i+=String.fromCharCode(t[n]);return i}function hexSlice(t,e,r){var i=t.length;(!e||e<0)&&(e=0),(!r||r<0||r>i)&&(r=i);for(var n="",o=e;o<r;++o)n+=toHex(t[o]);return n}function utf16leSlice(t,e,r){for(var i=t.slice(e,r),n="",o=0;o<i.length;o+=2)n+=String.fromCharCode(i[o]+256*i[o+1]);return n}function checkOffset(t,e,r){if(t%1!=0||t<0)throw new RangeError("offset is not uint");if(t+e>r)throw new RangeError("Trying to access beyond buffer length")}function checkInt(t,e,r,i,n,o){if(!internalIsBuffer(t))throw new TypeError('"buffer" argument must be a Buffer instance');if(e>n||e<o)throw new RangeError('"value" argument is out of bounds');if(r+i>t.length)throw new RangeError("Index out of range")}function objectWriteUInt16(t,e,r,i){e<0&&(e=65535+e+1);for(var n=0,o=Math.min(t.length-r,2);n<o;++n)t[r+n]=(e&255<<8*(i?n:1-n))>>>8*(i?n:1-n)}function objectWriteUInt32(t,e,r,i){e<0&&(e=4294967295+e+1);for(var n=0,o=Math.min(t.length-r,4);n<o;++n)t[r+n]=e>>>8*(i?n:3-n)&255}function checkIEEE754(t,e,r,i,n,o){if(r+i>t.length)throw new RangeError("Index out of range");if(r<0)throw new RangeError("Index out of range")}function writeFloat(t,e,r,i,n){return n||checkIEEE754(t,e,r,4),write(t,e,r,i,23,4),r+4}function writeDouble(t,e,r,i,n){return n||checkIEEE754(t,e,r,8),write(t,e,r,i,52,8),r+8}Buffer.prototype.slice=function(t,e){var r,i=this.length;if((t=~~t)<0?(t+=i)<0&&(t=0):t>i&&(t=i),(e=void 0===e?i:~~e)<0?(e+=i)<0&&(e=0):e>i&&(e=i),e<t&&(e=t),Buffer.TYPED_ARRAY_SUPPORT)(r=this.subarray(t,e)).__proto__=Buffer.prototype;else{var n=e-t;r=new Buffer(n,void 0);for(var o=0;o<n;++o)r[o]=this[o+t]}return r},Buffer.prototype.readUIntLE=function(t,e,r){t|=0,e|=0,r||checkOffset(t,e,this.length);for(var i=this[t],n=1,o=0;++o<e&&(n*=256);)i+=this[t+o]*n;return i},Buffer.prototype.readUIntBE=function(t,e,r){t|=0,e|=0,r||checkOffset(t,e,this.length);for(var i=this[t+--e],n=1;e>0&&(n*=256);)i+=this[t+--e]*n;return i},Buffer.prototype.readUInt8=function(t,e){return e||checkOffset(t,1,this.length),this[t]},Buffer.prototype.readUInt16LE=function(t,e){return e||checkOffset(t,2,this.length),this[t]|this[t+1]<<8},Buffer.prototype.readUInt16BE=function(t,e){return e||checkOffset(t,2,this.length),this[t]<<8|this[t+1]},Buffer.prototype.readUInt32LE=function(t,e){return e||checkOffset(t,4,this.length),(this[t]|this[t+1]<<8|this[t+2]<<16)+16777216*this[t+3]},Buffer.prototype.readUInt32BE=function(t,e){return e||checkOffset(t,4,this.length),16777216*this[t]+(this[t+1]<<16|this[t+2]<<8|this[t+3])},Buffer.prototype.readIntLE=function(t,e,r){t|=0,e|=0,r||checkOffset(t,e,this.length);for(var i=this[t],n=1,o=0;++o<e&&(n*=256);)i+=this[t+o]*n;return i>=(n*=128)&&(i-=Math.pow(2,8*e)),i},Buffer.prototype.readIntBE=function(t,e,r){t|=0,e|=0,r||checkOffset(t,e,this.length);for(var i=e,n=1,o=this[t+--i];i>0&&(n*=256);)o+=this[t+--i]*n;return o>=(n*=128)&&(o-=Math.pow(2,8*e)),o},Buffer.prototype.readInt8=function(t,e){return e||checkOffset(t,1,this.length),128&this[t]?-1*(255-this[t]+1):this[t]},Buffer.prototype.readInt16LE=function(t,e){e||checkOffset(t,2,this.length);var r=this[t]|this[t+1]<<8;return 32768&r?4294901760|r:r},Buffer.prototype.readInt16BE=function(t,e){e||checkOffset(t,2,this.length);var r=this[t+1]|this[t]<<8;return 32768&r?4294901760|r:r},Buffer.prototype.readInt32LE=function(t,e){return e||checkOffset(t,4,this.length),this[t]|this[t+1]<<8|this[t+2]<<16|this[t+3]<<24},Buffer.prototype.readInt32BE=function(t,e){return e||checkOffset(t,4,this.length),this[t]<<24|this[t+1]<<16|this[t+2]<<8|this[t+3]},Buffer.prototype.readFloatLE=function(t,e){return e||checkOffset(t,4,this.length),read(this,t,!0,23,4)},Buffer.prototype.readFloatBE=function(t,e){return e||checkOffset(t,4,this.length),read(this,t,!1,23,4)},Buffer.prototype.readDoubleLE=function(t,e){return e||checkOffset(t,8,this.length),read(this,t,!0,52,8)},Buffer.prototype.readDoubleBE=function(t,e){return e||checkOffset(t,8,this.length),read(this,t,!1,52,8)},Buffer.prototype.writeUIntLE=function(t,e,r,i){t=+t,e|=0,r|=0,i||checkInt(this,t,e,r,Math.pow(2,8*r)-1,0);var n=1,o=0;for(this[e]=255&t;++o<r&&(n*=256);)this[e+o]=t/n&255;return e+r},Buffer.prototype.writeUIntBE=function(t,e,r,i){t=+t,e|=0,r|=0,i||checkInt(this,t,e,r,Math.pow(2,8*r)-1,0);var n=r-1,o=1;for(this[e+n]=255&t;--n>=0&&(o*=256);)this[e+n]=t/o&255;return e+r},Buffer.prototype.writeUInt8=function(t,e,r){return t=+t,e|=0,r||checkInt(this,t,e,1,255,0),Buffer.TYPED_ARRAY_SUPPORT||(t=Math.floor(t)),this[e]=255&t,e+1},Buffer.prototype.writeUInt16LE=function(t,e,r){return t=+t,e|=0,r||checkInt(this,t,e,2,65535,0),Buffer.TYPED_ARRAY_SUPPORT?(this[e]=255&t,this[e+1]=t>>>8):objectWriteUInt16(this,t,e,!0),e+2},Buffer.prototype.writeUInt16BE=function(t,e,r){return t=+t,e|=0,r||checkInt(this,t,e,2,65535,0),Buffer.TYPED_ARRAY_SUPPORT?(this[e]=t>>>8,this[e+1]=255&t):objectWriteUInt16(this,t,e,!1),e+2},Buffer.prototype.writeUInt32LE=function(t,e,r){return t=+t,e|=0,r||checkInt(this,t,e,4,4294967295,0),Buffer.TYPED_ARRAY_SUPPORT?(this[e+3]=t>>>24,this[e+2]=t>>>16,this[e+1]=t>>>8,this[e]=255&t):objectWriteUInt32(this,t,e,!0),e+4},Buffer.prototype.writeUInt32BE=function(t,e,r){return t=+t,e|=0,r||checkInt(this,t,e,4,4294967295,0),Buffer.TYPED_ARRAY_SUPPORT?(this[e]=t>>>24,this[e+1]=t>>>16,this[e+2]=t>>>8,this[e+3]=255&t):objectWriteUInt32(this,t,e,!1),e+4},Buffer.prototype.writeIntLE=function(t,e,r,i){if(t=+t,e|=0,!i){var n=Math.pow(2,8*r-1);checkInt(this,t,e,r,n-1,-n)}var o=0,a=1,s=0;for(this[e]=255&t;++o<r&&(a*=256);)t<0&&0===s&&0!==this[e+o-1]&&(s=1),this[e+o]=(t/a|0)-s&255;return e+r},Buffer.prototype.writeIntBE=function(t,e,r,i){if(t=+t,e|=0,!i){var n=Math.pow(2,8*r-1);checkInt(this,t,e,r,n-1,-n)}var o=r-1,a=1,s=0;for(this[e+o]=255&t;--o>=0&&(a*=256);)t<0&&0===s&&0!==this[e+o+1]&&(s=1),this[e+o]=(t/a|0)-s&255;return e+r},Buffer.prototype.writeInt8=function(t,e,r){return t=+t,e|=0,r||checkInt(this,t,e,1,127,-128),Buffer.TYPED_ARRAY_SUPPORT||(t=Math.floor(t)),t<0&&(t=255+t+1),this[e]=255&t,e+1},Buffer.prototype.writeInt16LE=function(t,e,r){return t=+t,e|=0,r||checkInt(this,t,e,2,32767,-32768),Buffer.TYPED_ARRAY_SUPPORT?(this[e]=255&t,this[e+1]=t>>>8):objectWriteUInt16(this,t,e,!0),e+2},Buffer.prototype.writeInt16BE=function(t,e,r){return t=+t,e|=0,r||checkInt(this,t,e,2,32767,-32768),Buffer.TYPED_ARRAY_SUPPORT?(this[e]=t>>>8,this[e+1]=255&t):objectWriteUInt16(this,t,e,!1),e+2},Buffer.prototype.writeInt32LE=function(t,e,r){return t=+t,e|=0,r||checkInt(this,t,e,4,2147483647,-2147483648),Buffer.TYPED_ARRAY_SUPPORT?(this[e]=255&t,this[e+1]=t>>>8,this[e+2]=t>>>16,this[e+3]=t>>>24):objectWriteUInt32(this,t,e,!0),e+4},Buffer.prototype.writeInt32BE=function(t,e,r){return t=+t,e|=0,r||checkInt(this,t,e,4,2147483647,-2147483648),t<0&&(t=4294967295+t+1),Buffer.TYPED_ARRAY_SUPPORT?(this[e]=t>>>24,this[e+1]=t>>>16,this[e+2]=t>>>8,this[e+3]=255&t):objectWriteUInt32(this,t,e,!1),e+4},Buffer.prototype.writeFloatLE=function(t,e,r){return writeFloat(this,t,e,!0,r)},Buffer.prototype.writeFloatBE=function(t,e,r){return writeFloat(this,t,e,!1,r)},Buffer.prototype.writeDoubleLE=function(t,e,r){return writeDouble(this,t,e,!0,r)},Buffer.prototype.writeDoubleBE=function(t,e,r){return writeDouble(this,t,e,!1,r)},Buffer.prototype.copy=function(t,e,r,i){if(r||(r=0),i||0===i||(i=this.length),e>=t.length&&(e=t.length),e||(e=0),i>0&&i<r&&(i=r),i===r)return 0;if(0===t.length||0===this.length)return 0;if(e<0)throw new RangeError("targetStart out of bounds");if(r<0||r>=this.length)throw new RangeError("sourceStart out of bounds");if(i<0)throw new RangeError("sourceEnd out of bounds");i>this.length&&(i=this.length),t.length-e<i-r&&(i=t.length-e+r);var n,o=i-r;if(this===t&&r<e&&e<i)for(n=o-1;n>=0;--n)t[n+e]=this[n+r];else if(o<1e3||!Buffer.TYPED_ARRAY_SUPPORT)for(n=0;n<o;++n)t[n+e]=this[n+r];else Uint8Array.prototype.set.call(t,this.subarray(r,r+o),e);return o},Buffer.prototype.fill=function(t,e,r,i){if("string"==typeof t){if("string"==typeof e?(i=e,e=0,r=this.length):"string"==typeof r&&(i=r,r=this.length),1===t.length){var n=t.charCodeAt(0);n<256&&(t=n)}if(void 0!==i&&"string"!=typeof i)throw new TypeError("encoding must be a string");if("string"==typeof i&&!Buffer.isEncoding(i))throw new TypeError("Unknown encoding: "+i)}else"number"==typeof t&&(t&=255);if(e<0||this.length<e||this.length<r)throw new RangeError("Out of range index");if(r<=e)return this;var o;if(e>>>=0,r=void 0===r?this.length:r>>>0,t||(t=0),"number"==typeof t)for(o=e;o<r;++o)this[o]=t;else{var a=internalIsBuffer(t)?t:utf8ToBytes(new Buffer(t,i).toString()),s=a.length;for(o=0;o<r-e;++o)this[o+e]=a[o%s]}return this};var INVALID_BASE64_RE=/[^+\/0-9A-Za-z-_]/g;function base64clean(t){if((t=stringtrim(t).replace(INVALID_BASE64_RE,"")).length<2)return"";for(;t.length%4!=0;)t+="=";return t}function stringtrim(t){return t.trim?t.trim():t.replace(/^\s+|\s+$/g,"")}function toHex(t){return t<16?"0"+t.toString(16):t.toString(16)}function utf8ToBytes(t,e){var r;e=e||1/0;for(var i=t.length,n=null,o=[],a=0;a<i;++a){if((r=t.charCodeAt(a))>55295&&r<57344){if(!n){if(r>56319){(e-=3)>-1&&o.push(239,191,189);continue}if(a+1===i){(e-=3)>-1&&o.push(239,191,189);continue}n=r;continue}if(r<56320){(e-=3)>-1&&o.push(239,191,189),n=r;continue}r=65536+(n-55296<<10|r-56320)}else n&&(e-=3)>-1&&o.push(239,191,189);if(n=null,r<128){if((e-=1)<0)break;o.push(r)}else if(r<2048){if((e-=2)<0)break;o.push(r>>6|192,63&r|128)}else if(r<65536){if((e-=3)<0)break;o.push(r>>12|224,r>>6&63|128,63&r|128)}else{if(!(r<1114112))throw new Error("Invalid code point");if((e-=4)<0)break;o.push(r>>18|240,r>>12&63|128,r>>6&63|128,63&r|128)}}return o}function asciiToBytes(t){for(var e=[],r=0;r<t.length;++r)e.push(255&t.charCodeAt(r));return e}function utf16leToBytes(t,e){for(var r,i,n,o=[],a=0;a<t.length&&!((e-=2)<0);++a)i=(r=t.charCodeAt(a))>>8,n=r%256,o.push(n),o.push(i);return o}function base64ToBytes(t){return toByteArray(base64clean(t))}function blitBuffer(t,e,r,i){for(var n=0;n<i&&!(n+r>=e.length||n>=t.length);++n)e[n+r]=t[n];return n}function isnan(t){return t!=t}function isBuffer(t){return null!=t&&(!!t._isBuffer||isFastBuffer(t)||isSlowBuffer(t))}function isFastBuffer(t){return!!t.constructor&&"function"==typeof t.constructor.isBuffer&&t.constructor.isBuffer(t)}function isSlowBuffer(t){return"function"==typeof t.readFloatLE&&"function"==typeof t.slice&&isFastBuffer(t.slice(0,0))}global$1.setTimeout,global$1.clearTimeout;var performance$1=global$1.performance||{},inherits;performance$1.now||performance$1.mozNow||performance$1.msNow||performance$1.oNow||performance$1.webkitNow,inherits="function"==typeof Object.create?function(t,e){t.super_=e,t.prototype=Object.create(e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}})}:function(t,e){t.super_=e;var r=function(){};r.prototype=e.prototype,t.prototype=new r,t.prototype.constructor=t};var inherits$1=inherits;function inspect$1(t,e){var r={seen:[],stylize:stylizeNoColor};return arguments.length>=3&&(r.depth=arguments[2]),arguments.length>=4&&(r.colors=arguments[3]),isBoolean$1(e)?r.showHidden=e:e&&_extend(r,e),isUndefined(r.showHidden)&&(r.showHidden=!1),isUndefined(r.depth)&&(r.depth=2),isUndefined(r.colors)&&(r.colors=!1),isUndefined(r.customInspect)&&(r.customInspect=!0),r.colors&&(r.stylize=stylizeWithColor),formatValue(r,t,r.depth)}function stylizeWithColor(t,e){var r=inspect$1.styles[e];return r?"["+inspect$1.colors[r][0]+"m"+t+"["+inspect$1.colors[r][1]+"m":t}function stylizeNoColor(t,e){return t}function arrayToHash(t){var e={};return t.forEach((function(t,r){e[t]=!0})),e}function formatValue(t,e,r){if(t.customInspect&&e&&isFunction(e.inspect)&&e.inspect!==inspect$1&&(!e.constructor||e.constructor.prototype!==e)){var i=e.inspect(r,t);return isString(i)||(i=formatValue(t,i,r)),i}var n=formatPrimitive(t,e);if(n)return n;var o=Object.keys(e),a=arrayToHash(o);if(t.showHidden&&(o=Object.getOwnPropertyNames(e)),isError(e)&&(o.indexOf("message")>=0||o.indexOf("description")>=0))return formatError$1(e);if(0===o.length){if(isFunction(e)){var s=e.name?": "+e.name:"";return t.stylize("[Function"+s+"]","special")}if(isRegExp(e))return t.stylize(RegExp.prototype.toString.call(e),"regexp");if(isDate(e))return t.stylize(Date.prototype.toString.call(e),"date");if(isError(e))return formatError$1(e)}var l,u="",c=!1,h=["{","}"];return isArray(e)&&(c=!0,h=["[","]"]),isFunction(e)&&(u=" [Function"+(e.name?": "+e.name:"")+"]"),isRegExp(e)&&(u=" "+RegExp.prototype.toString.call(e)),isDate(e)&&(u=" "+Date.prototype.toUTCString.call(e)),isError(e)&&(u=" "+formatError$1(e)),0!==o.length||c&&0!=e.length?r<0?isRegExp(e)?t.stylize(RegExp.prototype.toString.call(e),"regexp"):t.stylize("[Object]","special"):(t.seen.push(e),l=c?formatArray(t,e,r,a,o):o.map((function(i){return formatProperty(t,e,r,a,i,c)})),t.seen.pop(),reduceToSingleString(l,u,h)):h[0]+u+h[1]}function formatPrimitive(t,e){if(isUndefined(e))return t.stylize("undefined","undefined");if(isString(e)){var r="'"+JSON.stringify(e).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return t.stylize(r,"string")}return isNumber(e)?t.stylize(""+e,"number"):isBoolean$1(e)?t.stylize(""+e,"boolean"):isNull$1(e)?t.stylize("null","null"):void 0}function formatError$1(t){return"["+Error.prototype.toString.call(t)+"]"}function formatArray(t,e,r,i,n){for(var o=[],a=0,s=e.length;a<s;++a)hasOwnProperty(e,String(a))?o.push(formatProperty(t,e,r,i,String(a),!0)):o.push("");return n.forEach((function(n){n.match(/^\d+$/)||o.push(formatProperty(t,e,r,i,n,!0))})),o}function formatProperty(t,e,r,i,n,o){var a,s,l;if((l=Object.getOwnPropertyDescriptor(e,n)||{value:e[n]}).get?s=l.set?t.stylize("[Getter/Setter]","special"):t.stylize("[Getter]","special"):l.set&&(s=t.stylize("[Setter]","special")),hasOwnProperty(i,n)||(a="["+n+"]"),s||(t.seen.indexOf(l.value)<0?(s=isNull$1(r)?formatValue(t,l.value,null):formatValue(t,l.value,r-1)).indexOf("\n")>-1&&(s=o?s.split("\n").map((function(t){return"  "+t})).join("\n").substr(2):"\n"+s.split("\n").map((function(t){return"   "+t})).join("\n")):s=t.stylize("[Circular]","special")),isUndefined(a)){if(o&&n.match(/^\d+$/))return s;(a=JSON.stringify(""+n)).match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)?(a=a.substr(1,a.length-2),a=t.stylize(a,"name")):(a=a.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'"),a=t.stylize(a,"string"))}return a+": "+s}function reduceToSingleString(t,e,r){return t.reduce((function(t,e){return e.indexOf("\n"),t+e.replace(/\u001b\[\d\d?m/g,"").length+1}),0)>60?r[0]+(""===e?"":e+"\n ")+" "+t.join(",\n  ")+" "+r[1]:r[0]+e+" "+t.join(", ")+" "+r[1]}function isArray(t){return Array.isArray(t)}function isBoolean$1(t){return"boolean"==typeof t}function isNull$1(t){return null===t}function isNumber(t){return"number"==typeof t}function isString(t){return"string"==typeof t}function isUndefined(t){return void 0===t}function isRegExp(t){return isObject$1(t)&&"[object RegExp]"===objectToString(t)}function isObject$1(t){return"object"==typeof t&&null!==t}function isDate(t){return isObject$1(t)&&"[object Date]"===objectToString(t)}function isError(t){return isObject$1(t)&&("[object Error]"===objectToString(t)||t instanceof Error)}function isFunction(t){return"function"==typeof t}function isPrimitive(t){return null===t||"boolean"==typeof t||"number"==typeof t||"string"==typeof t||"symbol"==typeof t||void 0===t}function objectToString(t){return Object.prototype.toString.call(t)}function _extend(t,e){if(!e||!isObject$1(e))return t;for(var r=Object.keys(e),i=r.length;i--;)t[r[i]]=e[r[i]];return t}function hasOwnProperty(t,e){return Object.prototype.hasOwnProperty.call(t,e)}function compare(t,e){if(t===e)return 0;for(var r=t.length,i=e.length,n=0,o=Math.min(r,i);n<o;++n)if(t[n]!==e[n]){r=t[n],i=e[n];break}return r<i?-1:i<r?1:0}inspect$1.colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]},inspect$1.styles={special:"cyan",number:"yellow",boolean:"yellow",undefined:"grey",null:"bold",string:"green",date:"magenta",regexp:"red"};var hasOwn=Object.prototype.hasOwnProperty,objectKeys=Object.keys||function(t){var e=[];for(var r in t)hasOwn.call(t,r)&&e.push(r);return e},pSlice=Array.prototype.slice,_functionsHaveNames;function functionsHaveNames(){return void 0!==_functionsHaveNames?_functionsHaveNames:_functionsHaveNames="foo"===function(){}.name}function pToString(t){return Object.prototype.toString.call(t)}function isView(t){return!isBuffer(t)&&"function"==typeof global$1.ArrayBuffer&&("function"==typeof ArrayBuffer.isView?ArrayBuffer.isView(t):!!t&&(t instanceof DataView||!!(t.buffer&&t.buffer instanceof ArrayBuffer)))}function assert$1(t,e){t||fail(t,!0,e,"==",ok)}var regex=/\s*function\s+([^\(\s]*)\s*/;function getName(t){if(isFunction(t)){if(functionsHaveNames())return t.name;var e=t.toString().match(regex);return e&&e[1]}}function AssertionError(t){this.name="AssertionError",this.actual=t.actual,this.expected=t.expected,this.operator=t.operator,t.message?(this.message=t.message,this.generatedMessage=!1):(this.message=getMessage(this),this.generatedMessage=!0);var e=t.stackStartFunction||fail;if(Error.captureStackTrace)Error.captureStackTrace(this,e);else{var r=new Error;if(r.stack){var i=r.stack,n=getName(e),o=i.indexOf("\n"+n);if(o>=0){var a=i.indexOf("\n",o+1);i=i.substring(a+1)}this.stack=i}}}function truncate(t,e){return"string"==typeof t?t.length<e?t:t.slice(0,e):t}function inspect(t){if(functionsHaveNames()||!isFunction(t))return inspect$1(t);var e=getName(t);return"[Function"+(e?": "+e:"")+"]"}function getMessage(t){return truncate(inspect(t.actual),128)+" "+t.operator+" "+truncate(inspect(t.expected),128)}function fail(t,e,r,i,n){throw new AssertionError({message:r,actual:t,expected:e,operator:i,stackStartFunction:n})}function ok(t,e){t||fail(t,!0,e,"==",ok)}function equal(t,e,r){t!=e&&fail(t,e,r,"==",equal)}function notEqual(t,e,r){t==e&&fail(t,e,r,"!=",notEqual)}function deepEqual(t,e,r){_deepEqual(t,e,!1)||fail(t,e,r,"deepEqual",deepEqual)}function deepStrictEqual(t,e,r){_deepEqual(t,e,!0)||fail(t,e,r,"deepStrictEqual",deepStrictEqual)}function _deepEqual(t,e,r,i){if(t===e)return!0;if(isBuffer(t)&&isBuffer(e))return 0===compare(t,e);if(isDate(t)&&isDate(e))return t.getTime()===e.getTime();if(isRegExp(t)&&isRegExp(e))return t.source===e.source&&t.global===e.global&&t.multiline===e.multiline&&t.lastIndex===e.lastIndex&&t.ignoreCase===e.ignoreCase;if(null!==t&&"object"==typeof t||null!==e&&"object"==typeof e){if(isView(t)&&isView(e)&&pToString(t)===pToString(e)&&!(t instanceof Float32Array||t instanceof Float64Array))return 0===compare(new Uint8Array(t.buffer),new Uint8Array(e.buffer));if(isBuffer(t)!==isBuffer(e))return!1;var n=(i=i||{actual:[],expected:[]}).actual.indexOf(t);return-1!==n&&n===i.expected.indexOf(e)||(i.actual.push(t),i.expected.push(e),objEquiv(t,e,r,i))}return r?t===e:t==e}function isArguments(t){return"[object Arguments]"==Object.prototype.toString.call(t)}function objEquiv(t,e,r,i){if(null==t||null==e)return!1;if(isPrimitive(t)||isPrimitive(e))return t===e;if(r&&Object.getPrototypeOf(t)!==Object.getPrototypeOf(e))return!1;var n=isArguments(t),o=isArguments(e);if(n&&!o||!n&&o)return!1;if(n)return _deepEqual(t=pSlice.call(t),e=pSlice.call(e),r);var a,s,l=objectKeys(t),u=objectKeys(e);if(l.length!==u.length)return!1;for(l.sort(),u.sort(),s=l.length-1;s>=0;s--)if(l[s]!==u[s])return!1;for(s=l.length-1;s>=0;s--)if(!_deepEqual(t[a=l[s]],e[a],r,i))return!1;return!0}function notDeepEqual(t,e,r){_deepEqual(t,e,!1)&&fail(t,e,r,"notDeepEqual",notDeepEqual)}function notDeepStrictEqual(t,e,r){_deepEqual(t,e,!0)&&fail(t,e,r,"notDeepStrictEqual",notDeepStrictEqual)}function strictEqual(t,e,r){t!==e&&fail(t,e,r,"===",strictEqual)}function notStrictEqual(t,e,r){t===e&&fail(t,e,r,"!==",notStrictEqual)}function expectedException(t,e){if(!t||!e)return!1;if("[object RegExp]"==Object.prototype.toString.call(e))return e.test(t);try{if(t instanceof e)return!0}catch(t){}return!Error.isPrototypeOf(e)&&!0===e.call({},t)}function _tryBlock(t){var e;try{t()}catch(t){e=t}return e}function _throws(t,e,r,i){var n;if("function"!=typeof e)throw new TypeError('"block" argument must be a function');"string"==typeof r&&(i=r,r=null),n=_tryBlock(e),i=(r&&r.name?" ("+r.name+").":".")+(i?" "+i:"."),t&&!n&&fail(n,r,"Missing expected exception"+i);var o="string"==typeof i,a=!t&&n&&!r;if((!t&&isError(n)&&o&&expectedException(n,r)||a)&&fail(n,r,"Got unwanted exception"+i),t&&n&&r&&!expectedException(n,r)||!t&&n)throw n}function throws(t,e,r){_throws(!0,t,e,r)}function doesNotThrow(t,e,r){_throws(!1,t,e,r)}function ifError(t){if(t)throw t}assert$1.AssertionError=AssertionError,inherits$1(AssertionError,Error),assert$1.fail=fail,assert$1.ok=ok,assert$1.equal=equal,assert$1.notEqual=notEqual,assert$1.deepEqual=deepEqual,assert$1.deepStrictEqual=deepStrictEqual,assert$1.notDeepEqual=notDeepEqual,assert$1.notDeepStrictEqual=notDeepStrictEqual,assert$1.strictEqual=strictEqual,assert$1.notStrictEqual=notStrictEqual,assert$1.throws=throws,assert$1.doesNotThrow=doesNotThrow,assert$1.ifError=ifError;var assert$2=Object.freeze({__proto__:null,default:assert$1,AssertionError,fail,ok,assert:ok,equal,notEqual,deepEqual,deepStrictEqual,notDeepEqual,notDeepStrictEqual,strictEqual,notStrictEqual,throws,doesNotThrow,ifError}),require$$1=getAugmentedNamespace(assert$2),topDown_algorithm={},hasRequiredTopDown_algorithm;function requireTopDown_algorithm(){return hasRequiredTopDown_algorithm||(hasRequiredTopDown_algorithm=1,topDown_algorithm.sort=function(t){return t.sort((function(t,e){return t.height-e.height})),t},topDown_algorithm.placeItems=function(t){var e=0;return t.forEach((function(t){t.x=0,t.y=e,e+=t.height})),t}),topDown_algorithm}var leftRight_algorithm={},hasRequiredLeftRight_algorithm;function requireLeftRight_algorithm(){return hasRequiredLeftRight_algorithm||(hasRequiredLeftRight_algorithm=1,leftRight_algorithm.sort=function(t){return t.sort((function(t,e){return t.width-e.width})),t},leftRight_algorithm.placeItems=function(t){var e=0;return t.forEach((function(t){t.x=e,t.y=0,e+=t.width})),t}),leftRight_algorithm}var diagonal_algorithm={},hasRequiredDiagonal_algorithm;function requireDiagonal_algorithm(){return hasRequiredDiagonal_algorithm||(hasRequiredDiagonal_algorithm=1,diagonal_algorithm.sort=function(t){return t.sort((function(t,e){return Math.sqrt(Math.pow(t.height,2)+Math.pow(t.width,2))-Math.sqrt(Math.pow(e.height,2)+Math.pow(e.width,2))})),t},diagonal_algorithm.placeItems=function(t){var e=0,r=0;return t.forEach((function(t){t.x=e,t.y=r,e+=t.width,r+=t.height})),t}),diagonal_algorithm}var altDiagonal_algorithm={},hasRequiredAltDiagonal_algorithm;function requireAltDiagonal_algorithm(){return hasRequiredAltDiagonal_algorithm||(hasRequiredAltDiagonal_algorithm=1,altDiagonal_algorithm.sort=function(t){return t.sort((function(t,e){return Math.sqrt(Math.pow(t.height,2)+Math.pow(t.width,2))-Math.sqrt(Math.pow(e.height,2)+Math.pow(e.width,2))})),t},altDiagonal_algorithm.placeItems=function(t){var e=0,r=0;return t.forEach((function(t){var i=t.width;t.x=e-i,t.y=r,e-=i,r+=t.height})),t}),altDiagonal_algorithm}var binaryTree_algorithm={},packer_growing,hasRequiredPacker_growing,binPack,hasRequiredBinPack,hasRequiredBinaryTree_algorithm;function requirePacker_growing(){if(hasRequiredPacker_growing)return packer_growing;hasRequiredPacker_growing=1;var t=function(){};return t.prototype={fit:function(t){var e,r,i,n,o=t.length,a=o>0?t[0].width:0,s=o>0?t[0].height:0;for(this.root={x:0,y:0,width:a,height:s},e=0;e<o;e++)i=t[e],(r=this.findNode(this.root,i.width,i.height))?(n=this.splitNode(r,i.width,i.height),i.x=n.x,i.y=n.y):(n=this.growNode(i.width,i.height),i.x=n.x,i.y=n.y)},findNode:function(t,e,r){return t.used?this.findNode(t.right,e,r)||this.findNode(t.down,e,r):e<=t.width&&r<=t.height?t:null},splitNode:function(t,e,r){return t.used=!0,t.down={x:t.x,y:t.y+r,width:t.width,height:t.height-r},t.right={x:t.x+e,y:t.y,width:t.width-e,height:r},t},growNode:function(t,e){var r=t<=this.root.width,i=e<=this.root.height,n=i&&this.root.height>=this.root.width+t,o=r&&this.root.width>=this.root.height+e;return n?this.growRight(t,e):o?this.growDown(t,e):i?this.growRight(t,e):r?this.growDown(t,e):null},growRight:function(t,e){var r;return this.root={used:!0,x:0,y:0,width:this.root.width+t,height:this.root.height,down:this.root,right:{x:this.root.width,y:0,width:t,height:this.root.height}},(r=this.findNode(this.root,t,e))?this.splitNode(r,t,e):null},growDown:function(t,e){var r;return this.root={used:!0,x:0,y:0,width:this.root.width,height:this.root.height+e,down:{x:0,y:this.root.height,width:this.root.width,height:e},right:this.root},(r=this.findNode(this.root,t,e))?this.splitNode(r,t,e):null}},packer_growing=t}function requireBinPack(){if(hasRequiredBinPack)return binPack;hasRequiredBinPack=1;var t=requirePacker_growing();return binPack=function(e,r){r=r||{};var i=new t,n=r.inPlace||!1,o=e.map((function(t){return n?t:{width:t.width,height:t.height,item:t}}));o=o.sort((function(t,e){return e.width*e.height-t.width*t.height})),i.fit(o);var a={width:o.reduce((function(t,e){return Math.max(t,e.x+e.width)}),0),height:o.reduce((function(t,e){return Math.max(t,e.y+e.height)}),0)};return n||(a.items=o),a}}function requireBinaryTree_algorithm(){if(hasRequiredBinaryTree_algorithm)return binaryTree_algorithm;hasRequiredBinaryTree_algorithm=1;var t=requireBinPack();return binaryTree_algorithm.sort=function(t){return t},binaryTree_algorithm.placeItems=function(e){return t(e,{inPlace:!0}),e},binaryTree_algorithm}var PackingSmith=packing_smith,assert=require$$1,algorithms={};function Layout(t,e){var r=t||"top-down";return"string"==typeof r&&(r=algorithms[t],assert(r,"Sorry, the '"+t+"' algorithm could not be loaded.")),new PackingSmith(r,e)}function addAlgorithm(t,e){algorithms[t]=e}Layout.PackingSmith=PackingSmith,Layout.addAlgorithm=addAlgorithm,Layout.algorithms=algorithms,addAlgorithm("top-down",requireTopDown_algorithm()),addAlgorithm("left-right",requireLeftRight_algorithm()),addAlgorithm("diagonal",requireDiagonal_algorithm()),addAlgorithm("alt-diagonal",requireAltDiagonal_algorithm()),addAlgorithm("binary-tree",requireBinaryTree_algorithm());var layout=Layout,layout$1=getDefaultExportFromCjs(layout);function isTainting(t){var e;try{t.getContext("2d",{willReadFrequently:!0}).getImageData(0,0,1,1)}catch(t){e=t.message}return e}function bitmapToCanvas(t,e,r){if(t instanceof HTMLImageElement){var i=t.ownerDocument.createElement("canvas");i.width=e,i.height=r,i.getContext("2d").drawImage(t,0,0,e,r),t=i}return t}var MAX_LNG_LAT=Geo$1.metersToLatLng([Geo$1.half_circumference_meters,Geo$1.half_circumference_meters]),TILE_EXPONENT=Math.log(Geo$1.tile_size)/Math.LN2,ICON_READY=1,DOM_MARKER_TYPE=8,GROUP_TYPE=16,TILE_MARGIN=100,AFFECTED_BBOX_CALC_THRESHOLD=10,ObjectSource=function(t){function e(t,r){var i;return _classCallCheck(this,e),i=_callSuper(this,e,[t,r]),Thread.is_worker&&(i._quad_tree=new ns.H.geo.QuadTree,i._marker_quad_tree=new ns.H.geo.QuadTree,i._tree_entries_by_object_id={},i._groups_by_id={},i._layersCache=new ns.H.util.Cache(100)),Thread.is_main&&(i._objects_by_id={},i._commands=[],i._sendCommands=debounce(i._sendCommands,100,200),i.dispatchUpdate=i.dispatchUpdate.bind(i)),i}return _inherits(e,t),_createClass(e,[{key:"hasLabeledData",value:function(){return!1}},{key:"onReady",value:function(){this._synced_at=this.provider.getInvalidations().getMark();var t,e,r=this.provider.getRootGroup(),i=r.getObjects(!0),n=[];for(i.push(r),t=i.length;t--;)e=i[t],this._isObjectSupported(e)&&this._shouldBeStored(e)&&(this._objects_by_id[e.getId()]=e,n.push(e.forWorkerMessage()));var o=[{method_name:"addObjects",arguments:[n]}];this._sendImmediateCommands(o)}},{key:"onProviderUpdate",value:function(t){var e=t.target,r=t.currentTarget.getInvalidations(e.type);if(this._isObjectSupported(e)){var i=this._synced_at,n=e.getId();if(r.isRemove(i))delete this._objects_by_id[n],this._commands.push({method_name:"removeObjectsByIds",arguments:[[n],!0]});else if(r.isAdd(i))this._shouldBeStored(e)&&(this._objects_by_id[n]=e,this._commands.push({method_name:"addObjects",arguments:[[e.forWorkerMessage()]]}));else if(r.isSpatial(i)||r.isZOrder(i)){if(this._shouldBeStored(e)){this._objects_by_id[n]=e;var o=[{method_name:"removeObjectsByIds",arguments:[[n],!0]},{method_name:"addObjects",arguments:[[e.forWorkerMessage()]]}];this.has_volatile_data&&!this.hasPendingCommands()?this._sendImmediateCommands(o):this._commands.push(o[0],o[1])}}else if(r.isVisual(i)){if(this._shouldBeStored(e)){this._objects_by_id[n]=e;var a={method_name:"updateObjectProperties",arguments:[e.forWorkerMessage()]};this.has_volatile_data&&!this.hasPendingCommands()?this._sendImmediateCommands([a]):this._commands.push(a)}}else r.isVolatility(i)&&(delete this._objects_by_id[n],this._commands.push({method_name:"removeObjectsByIds",arguments:[[n],!0]}),this._shouldBeStored(e)&&(this._objects_by_id[n]=e,this._commands.push({method_name:"addObjects",arguments:[[e.forWorkerMessage()]]})));this._commands.length&&this._sendCommands()}this._synced_at=r.getMark()}},{key:"_shouldBeStored",value:function(t){return t.type===GROUP_TYPE||(!t.getIcon||t.getIcon().getState()===ICON_READY)&&this._hasSameVolatility(t)}},{key:"_hasSameVolatility",value:function(t){return t.getVolatility(!0)===this.has_volatile_data}},{key:"hasPendingCommands",value:function(){return this._commands.length>0}},{key:"_sendCommands",value:function(){this._sendImmediateCommands(this._commands),this._commands=[]}},{key:"_sendImmediateCommands",value:function(t){t.length&&WorkerBroker.postMessage(this.worker,this.target_name+".executeCommands",t).then(this.dispatchUpdate)}},{key:"_isObjectSupported",value:function(t){return t.forWorkerMessage&&t.type!==DOM_MARKER_TYPE}},{key:"getSyncedAt",value:function(){return this._synced_at}},{key:"getMapObjectById",value:function(t){return this._objects_by_id[t]}},{key:"getIconBitmapByObjectId",value:function(t,e){var r=this.getMapObjectById(t);if(r){var i=r.getIcon();if(i.uid===e&&i.getState()===ICON_READY){var n=i.getSize();return bitmapToCanvas(i.getBitmap(),n.w,n.h)}}}},{key:"_getRastersForMarkers",value:function(t){for(var e={},r=layout$1("binary-tree"),i=0;i<t.length;i++){var n=t[i],o=n.properties.icon;e[o.id]||(r.addItem({width:o.size.w,height:o.size.h,meta:{objectId:n.id,id:o.id}}),e[o.id]=!0)}return r.export()}},{key:"fetchFeaturesForTile",value:function(t){var r=[],i=[],n=[],o=[],a=[],s=this._marker_quad_tree.intersectBoundingBox(Geo$1.getTileBoundingBox(t.coords,this.tile_size));t.source_data.error=null;for(var l=0;l<s.length;l++){var u={id:s[l].$feature$.id,properties:Object.assign({},s[l].$feature$.properties),geometry:{type:s[l].$feature$.geometry.type,coordinates:ArrayUtils$1.deepClone(s[l].$feature$.geometry.coordinates)}};r.push(u)}s=this._quad_tree.intersectBoundingBox(Geo$1.getTileBoundingBox(t.coords,this.tile_size,TILE_MARGIN));for(var c=0;c<s.length;c++){var h={id:s[c].$feature$.id,properties:Object.assign({},s[c].$feature$.properties),geometry:{type:s[c].$feature$.geometry.type,coordinates:ArrayUtils$1.deepClone(s[c].$feature$.geometry.coordinates)}};if(h.properties.overlay)i.push(h);else if(h.geometry.type.includes("LineString"))n.push(h);else if(h.geometry.type.includes("Polygon")){o.push(h);var p={id:h.id,properties:h.properties,geometry:{type:h.geometry.type,coordinates:ArrayUtils$1.deepClone(h.geometry.coordinates)}};a.push(p)}}r.sort(e._compareZInfo),o.sort(e._compareZInfo),i.sort(e._compareZInfo);var f=this.has_volatile_data?4096:0;a.sort(e._compareZInfo);for(var d=0;d<a.length;d++)a[d].properties.effectiveZIdx=f++;n.sort(e._compareZInfo);for(var y=0;y<n.length;y++)n[y].properties.effectiveZIdx=f++;t.source_data.layers.markers={type:"FeatureCollection",features:r},t.source_data.layers.polylines={type:"FeatureCollection",features:n},t.source_data.layers.polygons={type:"FeatureCollection",features:o},t.source_data.layers.outlines={type:"FeatureCollection",features:a},t.source_data.layers.overlays={type:"FeatureCollection",features:i}}},{key:"tileTexture",value:function(t){var e=t.source_data.layers.overlays;if(e){var r=this.name+"_"+t.coords.key,i=Tile.coordinateWithMaxZoom(t.coords,this.max_zoom),n=e.features[0].properties.overlays_config;return{name:r,filtering:this.filtering,coords:i,width:Geo$1.tile_size,height:Geo$1.tile_size,overlays_config:n,source:this.name}}}},{key:"_load",value:function(t){var e=Geo$1.wrapTile(t.coords,{x:!0}),r=e.z,i=e.x,n=e.y,o="".concat(r,"_").concat(i,"_").concat(n),a=this._layersCache.get(o),s=!1;if(a)t.source_data.layers=a;else{this.fetchFeaturesForTile(t);var l={maxZoom:this.max_zoom,tolerance:1.5,extent:Geo$1.tile_scale},u=t.source_data.layers.overlays;u.features.length&&delete t.source_data.layers.overlays;var c=t.source_data.layers.markers;for(var h in c.features.length&&delete t.source_data.layers.markers,t.source_data.layers){var p=t.source_data.layers[h];if(p.features.length){l.buffer=h.includes("lines")?TILE_MARGIN*Geo$1.units_per_pixel:0;var f=createGeoJsonTile(p,r,i,n,l);t.source_data.layers[h]=parseGeoJSONVectorTile(f)}}t.source_data.layers.overlays=this._processOverlays(t,u);for(var d=t.source_data.layers.overlays.features.length;d--;)if(!t.source_data.layers.overlays.features[d].id){s=!0,this._layersCache.drop(o);break}t.source_data.layers.markers=this._processMarkers(t,c),this._postProcessTile(t),s||this._layersCache.add(o,t.source_data.layers,1)}return t.rasters=this._getRastersForMarkers(t.source_data.layers.markers.features),Promise.resolve(t)}},{key:"_processMarkers",value:function(t,e){var r=e.features.length;if(r){for(var i=Geo$1.unitsPerMeter(t.coords.z),n=Geo$1.wrapTile(t.coords,{x:!0}),o=Geo$1.metersForTile(n),a=Geo$1.isLastTile(n),s=Geo$1.wrapMeters(t.min),l=Geo$1.wrapMeters(t.max),u=function(e){DataSource.coordsToMeters(e);var r=_slicedToArray(e,2),n=r[0],u=r[1],c=n>=s.x&&(a.column||n<l.x)&&u>=l.y&&(a.row||!t.coords.y||u<s.y);return DataSource.metersToTileUnits(i,o,e),c},c=[],h=0;h<r;h++){var p=e.features[h].geometry,f=!1;if("Point"===p.type){var d=p.coordinates;u(d)?p.coordinates=d:f=!0}else"MultiPoint"===p.type&&(p.coordinates=p.coordinates.filter(u),0===p.coordinates.length&&(f=!0));f||c.push(e.features[h])}e.features=c}return e}},{key:"_processOverlays",value:function(t,e){var r=this;if(!e.features.length)return e;var i={coords:t.coords,min:Geo$1.metersForTile(Geo$1.wrapTile(t.coords,{x:!0}))},n={coords:t.coords,source_data:{layers:{_default:{type:"FeatureCollection",features:e.features}}}},o=Math.pow(2,t.coords.z+TILE_EXPONENT);MapsJsSource.projectData(n.source_data),MapsJsSource.scaleData(n.source_data,i);var a=e.features.map((function(t){var e=t.geometry.coordinates[0],r=e[0],i=e[5===e.length?2:3],n=Math.floor(r[0]/Geo$1.tile_scale*Geo$1.tile_size),a=Math.floor(r[1]/Geo$1.tile_scale*Geo$1.tile_size),s=Math.floor(i[0]/Geo$1.tile_scale*Geo$1.tile_size),l=Math.floor(i[1]/Geo$1.tile_scale*Geo$1.tile_size)-a,u=n>=s,c=u?o-(n-s):s-n,h=[];return n<=Geo$1.tile_size&&h.push([n,a,c,l]),u&&s>0&&h.push([n-o,a,c,l]),{id:t.id,properties:t.properties,texcoords:h}})).filter((function(e){return r._isVisible(e.properties)&&r.isInMinMaxRange(e.properties,t.style_zoom)})),s=Geo$1.tile_scale;return t.pad_scale=this.pad_scale,t.default_winding="CW",e.features=a.length?[{geometry:{type:"Polygon",coordinates:[[[0,0],[s,0],[s,s],[0,s],[0,0]]]},properties:{overlays_config:a}}]:a,e}},{key:"executeCommands",value:function(t){for(var e,r=t.length<AFFECTED_BBOX_CALC_THRESHOLD,i=0;i<t.length;i++){var n=t[i];n.arguments.push(r);var o=this[n.method_name].apply(this,n.arguments);r&&(o&&e?e.mergeRect(o,!0,e):o&&(e=o))}return e?e.forWorkerMessage():void 0}},{key:"_getClampedGeoRectForFeature",value:function(t){var e=t.geometry.boundingBox;return new ns.H.geo.Rect(MathUtils$1.clamp(e[0],-MAX_LNG_LAT[1],MAX_LNG_LAT[1]),e[1],MathUtils$1.clamp(e[2],-MAX_LNG_LAT[1],MAX_LNG_LAT[1]),e[3])}},{key:"addObjects",value:function(t){for(var r,i=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=0;n<t.length;n++){var o=t[n];if("Group"===o.type)o.$children_ids$={},this._groups_by_id[o.id]=o;else{e._preprocessGeometry(o.geometry);var a=this._getClampedGeoRectForFeature(o);i&&(r?r.mergeRect(a,!0,r):r=a);var s=-1!==o.geometry.type.indexOf("Point")?this._marker_quad_tree:this._quad_tree,l=s.insertBoundingBox(a);l.$tree=s,l.$feature$=o,this._tree_entries_by_object_id[o.id]=l}}for(var u=0;u<t.length;u++){var c=t[u];c.properties.parent&&(this._groups_by_id[c.properties.parent].$children_ids$[c.id]=c.id),c.properties.ref={effectiveVisibility:this._isVisible(c.properties),zInfo:this._getZInfo([],c)}}return this._layersCache.removeAll(),r}},{key:"removeObjectsByIds",value:function(t,e){for(var r,i=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=0;n<t.length;n++){var o=t[n],a=void 0,s=void 0;if(a=this._tree_entries_by_object_id[o]){if(i){var l=this._getClampedGeoRectForFeature(a.$feature$);r?r.mergeRect(l,!0,r):r=l}delete this._groups_by_id[a.$feature$.properties.parent].$children_ids$[o],a.$tree.remove(a),delete this._tree_entries_by_object_id[o]}else(s=this._groups_by_id[o])&&(s.properties.parent&&delete this._groups_by_id[s.properties.parent].$children_ids$[o],e&&this.removeObjectsByIds(Object.keys(s.$children_ids$),!0),delete this._groups_by_id[o])}return this._layersCache.removeAll(),r}},{key:"updateObjectProperties",value:function(t){var e,r=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return"Group"===t.type?(mergeObjects(this._groups_by_id[t.id].properties,t.properties),this._groups_by_id[t.id].properties.ref.effectiveVisibility=this._isVisible(t.properties)):(this._tree_entries_by_object_id[t.id]||this.addObjects([t]),mergeObjects(this._tree_entries_by_object_id[t.id].$feature$.properties,t.properties),this._tree_entries_by_object_id[t.id].$feature$.properties.ref.effectiveVisibility=this._isVisible(t.properties),r&&(e=this._getClampedGeoRectForFeature(t))),e}},{key:"_getZInfo",value:function(t,e){var r=e.properties.zIdx,i=e.properties.sIdx;return t[0]|=void 0!==r,t.splice(1,0,r||0,i<0?e.id:i),0===e.properties.parent?t:this._getZInfo(t,this._groups_by_id[e.properties.parent])}},{key:"_isVisible",value:function(t){var e=t.visible,r=!t.parent||this._isVisible(this._groups_by_id[t.parent].properties);return e&&r}},{key:"isInMinMaxRange",value:function(t,e){var r=t.min<=e&&t.max>=e,i=!t.parent||this.isInMinMaxRange(this._groups_by_id[t.parent].properties,e);return r&&i}},{key:"dispose",value:function(){this._commands=[],_get(_getPrototypeOf(e.prototype),"dispose",this).call(this)}}],[{key:"_compareZInfo",value:function(t,e){for(var r,i=t.properties.ref.zInfo,n=e.properties.ref.zInfo,o=i.length,a=n.length,s=Math.min(o,a),l=1;l<s;l++)if(r=i[l]-n[l])return r;return o-a}},{key:"_preprocessGeometry",value:function(t){var r=t.type;t.coordinates="Point"===r?e._processPointCoordinates(t.coordinates):"MultiPoint"===r?t.coordinates.map(e._processPointCoordinates):"LineString"===r?e._processLineStringCoordinates(t.coordinates):"MultiLineString"===r?t.coordinates.map(e._processLineStringCoordinates):"Polygon"===r?t.coordinates.map(e._processPolygonCoordinates):"MultiPolygon"===r?t.coordinates.map(e._processMultiPolygonCoordinates):[]}},{key:"_processPointCoordinates",value:function(t){return[t[1],t[0],t[2]]}},{key:"_processLineStringCoordinates",value:function(t){return e._latLngAltArrayToLineString(t,!1)}},{key:"_processPolygonCoordinates",value:function(t){return e._latLngAltArrayToLineString(t,!0)}},{key:"_processMultiPolygonCoordinates",value:function(t){return t.map(e._processPolygonCoordinates)}},{key:"_latLngAltArrayToLineString",value:function(t,e){for(var r=[],i=t.length,n=0;n<i;n+=3)r.push([t[n+1],t[n]]);return e&&r.push([t[1],t[0]]),r}}])}(MapsJsSource);MapsJsSource.register(ObjectSource,"ObjectSource");var GEOMETRY_TYPE={POLYGON:1,POLYLINE:2,OUTLINE:3},IconMap=_createClass((function t(){_classCallCheck(this,t),this._map={}}),[{key:"set",value:function(t,e,r){if(this._map[t])this._map[t].accumulator.add(r);else{var i=new Set;i.add(r),this._map[t]={value:e,accumulator:i}}}},{key:"get",value:function(t){return this._map[t]&&this._map[t].value}},{key:"delete",value:function(t,e){var r=this._map[t];r&&r.accumulator&&(r.accumulator.delete(e),0===r.accumulator.size&&delete this._map[t])}}]),ObjectTileSource=function(t){function e(t,r){var i;return _classCallCheck(this,e),i=_callSuper(this,e,[t,r]),Thread.is_worker||(i._icons=new IconMap),i}return _inherits(e,t),_createClass(e,[{key:"onProviderUpdate",value:function(t){t.target instanceof H.map.provider.Tile?this.dispatchUpdate(t.target,t.data):this.dispatchUpdate(void 0,t.data)}},{key:"onReady",value:function(){var t=this.provider;t.setTileCanvasRendering&&t.setTileCanvasRendering(!1),t.providesMarkers()&&(this._onCacheDrop=this._onCacheDrop.bind(this),t.getCache().registerOnDrop(this._onCacheDrop)),this.dispatchUpdate()}},{key:"dispose",value:function(){_get(_getPrototypeOf(e.prototype),"dispose",this).call(this);var t=this.provider;t.providesMarkers()&&t.getCache().deRegisterOnDrop(this._onCacheDrop)}},{key:"_onCacheDrop",value:function(t,e,r){this.provider.cacheFilter(t)&&this._deleteIcons(t,e.data)}},{key:"_deleteIcons",value:function(t,e){for(var r=0,i=e.length;r<i;r++){var n=e[r].getIcon();this._icons.delete(n.uid,t)}}},{key:"getIconBitmapByObjectId",value:function(t,e){var r=this._icons.get(e);return r&&r.getBitmap()}},{key:"requestMarkerTile",value:function(t){var e=this,r=new Promise((function(r,i){e.provider?e.provider.requestTileAsPromise(t.x,t.y,t.z,!1).then((function(t){var i,n,o=[];if(t.data)for(n=(i=t.data).length;n--;){var a=i[n],s=a.getIcon();e._icons.set(s.uid,s,t.key),o.push(a.forWorkerMessage())}r(o)})):r([])}));return r}},{key:"requestSpatialTile",value:function(t){var e=this,r=new Promise((function(r,i){e.provider?e.provider.requestTileAsPromise(t.x,t.y,t.z,!1).then((function(t){var e,i=[];if(t.getObjects){e=t.getObjects();for(var n=0;n<e.length;n++){var o=e[n];i.push({id:o.getId(),geometries:o.getGeometriesForTile(t),isClosed:o.isClosed(),style:o.getStyle().forWorkerMessage()})}}r(i)})):r([])}));return r}},{key:"_pointToArray",value:function(t){var e=Geo$1.tile_scale/this.tile_size;return[t.x*e,t.y*e]}},{key:"_getGeoJsonMultiPolygon",value:function(t){for(var e=t.geometries,r=e.length,i=[],n={coordinates:i,type:"MultiPolygon"},o=0;o<r;o++){var a=e[o],s=a.paths,l=s.length,u=a.interiorsIndex,c=a.outlinesIndex,h=Math.min(u,c,l),p=void 0,f=void 0;for(f=0;f<h;f++)p=[s[f].map(this._pointToArray,this)],i.push(p);if(1===h)for(h=Math.min(c,l),f=u;f<h;f++)p.push(s[f].map(this._pointToArray,this))}return n}},{key:"_getGeoJsonMultiLineString",value:function(t){for(var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r={coordinates:[],type:"MultiLineString"},i=t.geometries,n=0;n<i.length;n++)for(var o=i[n],a=e?o.outlinesIndex:0,s=e?o.paths.length:Math.min(o.interiorsIndex,o.outlinesIndex,o.paths.length),l=a;l<s;l++){var u=o.paths[l].map(this._pointToArray,this);r.coordinates.push(u)}return r}},{key:"_getGeoJsonGeometry",value:function(t,e){var r;return(r=e===GEOMETRY_TYPE.POLYGON?this._getGeoJsonMultiPolygon(t):this._getGeoJsonMultiLineString(t,e===GEOMETRY_TYPE.OUTLINE)).coordinates.length?r:null}},{key:"_load",value:function(t){var e,r=this;return e=new Promise((function(e,i){var n=WorkerBroker.postMessage(r.target_name+".requestMarkerTile",t.coords).then(r._prepareTileData.bind(r,t)),o=new Promise((function(e,i){WorkerBroker.postMessage(r.target_name+".requestSpatialTile",t.coords).then((function(i){for(var n=[],o=[],a=[],s=0;s<i.length;s++){var l=i[s],u=void 0,c=void 0;l.isClosed?(u=o,c=GEOMETRY_TYPE.POLYGON):(u=n,c=GEOMETRY_TYPE.POLYLINE);var h=r._getGeoJsonGeometry(l,c);if(h){var p={id:l.id,type:"Feature",properties:{height:0,style:l.style},geometry:h};c===GEOMETRY_TYPE.POLYLINE&&(p.properties.effectiveZIdx=n.length),u.push(p)}var f=r._getGeoJsonGeometry(l,GEOMETRY_TYPE.OUTLINE);f&&a.push({id:l.id,type:"Feature",properties:{height:0,style:l.style,effectiveZIdx:a.length},geometry:f})}t.source_data.layers.polylines={type:"FeatureCollection",features:n},t.source_data.layers.polygons={type:"FeatureCollection",features:o},t.source_data.layers.outlines={type:"FeatureCollection",features:a},e(t)}))}));Promise.all([n,o]).then((function(i){r._postProcessTile(t),e(t)}))})),e}},{key:"_prepareTileData",value:function(t,e){var r=Geo$1.wrapTile(t.coords,{x:!0,y:!0}),i=Geo$1.metersForTile(r);t.source_data.layers={markers:{features:e,type:"FeatureCollection"}};var n={coords:r,min:i},o=t.source_data,a=layout$1("binary-tree"),s={};for(var l in o.layers)for(var u=o.layers[l].features.length,c=0;c<u;c++){var h=o.layers[l].features[c],p=h.properties.icon;s[p.id]||(a.addItem({width:p.size.w,height:p.size.h,meta:{objectId:h.id,id:p.id}}),s[p.id]=!0),Geo$1.transformGeometry(h.geometry,(function(t){var e=t[0];t[0]=t[1],t[1]=e}))}return t.rasters=a.export(),MapsJsSource.projectData(t.source_data),MapsJsSource.scaleData(t.source_data,n),t}}])}(MapsJsSource);MapsJsSource.register(ObjectTileSource,"ObjectTileSource");var RemoteRasterTileSource=function(t){function e(t,r){var i;return _classCallCheck(this,e),(i=_callSuper(this,e,[t,r])).uid_=t.uid,i}return _inherits(e,t),_createClass(e,[{key:"initialize",value:function(t,e,r,i){this.provider=t,this._on_update=e,this._onProviderUpdate=this._onProviderUpdate.bind(this),t.addEventListener("update",this._onProviderUpdate)}},{key:"_onProviderUpdate",value:function(t){this._on_update(this.name)}},{key:"tileTexture",value:function(t){return Object.assign(_get(_getPrototypeOf(e.prototype),"tileTexture",this).call(this,t),{uid:this.uid_,url:this.uid_+"_"+t.coords.key,coords:t.coords})}},{key:"dispose",value:function(){this.provider.removeEventListener("update",this._onProviderUpdate)}}])}(RasterTileSource);function geojsonvt(t,e){return new GeoJSONVT(t,e)}function GeoJSONVT(t,e){var r=(e=this.options=extend$1(Object.create(this.options),e)).debug;if(r&&console.time("preprocess data"),e.maxZoom<0||e.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(e.promoteId&&e.generateId)throw new Error("promoteId and generateId cannot be used together.");var i=convert(t,e);this.tiles={},this.tileCoords=[],r&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",e.indexMaxZoom,e.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),(i=wrap$1(i,e)).length&&this.splitTile(i,0,0,0),r&&(i.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function toID(t,e,r){return 32*((1<<t)*r+e)+t}function extend$1(t,e){for(var r in e)t[r]=e[r];return t}DataSource.register(RemoteRasterTileSource,"RemoteRasterTileSource"),GeoJSONVT.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},GeoJSONVT.prototype.splitTile=function(t,e,r,i,n,o,a){for(var s=[t,e,r,i],l=this.options,u=l.debug;s.length;){i=s.pop(),r=s.pop(),e=s.pop(),t=s.pop();var c=1<<e,h=toID(e,r,i),p=this.tiles[h];if(!p&&(u>1&&console.time("creation"),p=this.tiles[h]=createTile(t,e,r,i,l),this.tileCoords.push({z:e,x:r,y:i}),u)){u>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",e,r,i,p.numFeatures,p.numPoints,p.numSimplified),console.timeEnd("creation"));var f="z"+e;this.stats[f]=(this.stats[f]||0)+1,this.total++}if(p.source=t,n){if(e===l.maxZoom||e===n)continue;var d=1<<n-e;if(r!==Math.floor(o/d)||i!==Math.floor(a/d))continue}else if(e===l.indexMaxZoom||p.numPoints<=l.indexMaxPoints)continue;if(p.source=null,0!==t.length){u>1&&console.time("clipping");var y,g,v,m,_,b,x=.5*l.buffer/l.extent,w=.5-x,E=.5+x,T=1+x;y=g=v=m=null,_=clip(t,c,r-x,r+E,0,p.minX,p.maxX,l),b=clip(t,c,r+w,r+T,0,p.minX,p.maxX,l),t=null,_&&(y=clip(_,c,i-x,i+E,1,p.minY,p.maxY,l),g=clip(_,c,i+w,i+T,1,p.minY,p.maxY,l),_=null),b&&(v=clip(b,c,i-x,i+E,1,p.minY,p.maxY,l),m=clip(b,c,i+w,i+T,1,p.minY,p.maxY,l),b=null),u>1&&console.timeEnd("clipping"),s.push(y||[],e+1,2*r,2*i),s.push(g||[],e+1,2*r,2*i+1),s.push(v||[],e+1,2*r+1,2*i),s.push(m||[],e+1,2*r+1,2*i+1)}}},GeoJSONVT.prototype.getTile=function(t,e,r){var i=this.options,n=i.extent,o=i.debug;if(t<0||t>24)return null;var a=1<<t,s=toID(t,e=(e%a+a)%a,r);if(this.tiles[s])return transformTile(this.tiles[s],n);o>1&&console.log("drilling down to z%d-%d-%d",t,e,r);for(var l,u=t,c=e,h=r;!l&&u>0;)u--,c=Math.floor(c/2),h=Math.floor(h/2),l=this.tiles[toID(u,c,h)];return l&&l.source?(o>1&&console.log("found parent tile z%d-%d-%d",u,c,h),o>1&&console.time("drilling down"),this.splitTile(l.source,u,c,h,t,e,r),o>1&&console.timeEnd("drilling down"),this.tiles[s]?transformTile(this.tiles[s],n):null):null};var EMPTY_FEATURE_COLLECTION={type:"FeatureCollection",features:[]},GeoJSONTileSource=function(t){function e(t,r){return _classCallCheck(this,e),t.tiled=!0,t.url="",_callSuper(this,e,[t,r])}return _inherits(e,t),_createClass(e,[{key:"fetchTile",value:function(t,e,r){return this.provider?this.provider.requestTileAsPromise(t,e,r).then((function(t){return t.data})):Promise.resolve(EMPTY_FEATURE_COLLECTION)}},{key:"_load",value:function(t){var e=this,r=Geo$1.wrapTile(t.coords,{x:!0,y:!0}),i={indexMaxZoom:0,maxZoom:this.max_zoom,tolerance:1.5,extent:Geo$1.tile_scale};return WorkerBroker.postMessage(this.target_name+".fetchTile",r.x,r.y,r.z).then((function(n){for(var o in t.source_data.layers="FeatureCollection"===n.type?{_default:n}:n,t.source_data.layers){var a=geojsonvt(t.source_data.layers[o],i).getTile(r.z,r.x,r.y);t.source_data.layers[o]=parseGeoJSONVectorTile(a)}return e._postProcessTile(t),t}))}},{key:"onReady",value:function(){this.dispatchUpdate()}}])}(MapsJsSource);DataSource.register(GeoJSONTileSource,"GeoJSONTileSource");var DEFAULT_RESPONSE={layers:{_default:{type:"FeatureCollection",features:[{type:"Point",geometry:{}}]}}},SkyBoxSource=function(t){function e(t,r){return _classCallCheck(this,e),t.max_zoom=0,_callSuper(this,e,[t,r])}return _inherits(e,t),_createClass(e,[{key:"load",value:function(t){return t.source_data="0/0/0"===t.coords.key?DEFAULT_RESPONSE:void 0,Promise.resolve(t)}}])}(DataSource),debugSettings;DataSource.register(SkyBoxSource,"SkyBox");var debugSettings$1=debugSettings={draw_label_collision_boxes:!1,draw_label_texture_boxes:!1,suppress_label_fade_in:!1,suppress_snap_animation:!1,show_hidden_labels:!1,layer_stats:!1};function mergeDebugSettings(t){Object.assign(debugSettings,t)}var WorkerType={NATIVE:0,FAKE:1},Context;function sliceObject(t,e){var r={};return e.forEach((function(e){return r[e]=t[e]})),r}var Context$1=Context={},context_id=0,gl;Context.getContext=function(t,e){var r=!1;null==t&&((t=document.createElement("canvas")).style.position="absolute",t.style.top=0,t.style.left=0,t.style.zIndex=-1,document.body.appendChild(t),r=!0);var i=t.getContext("webgl",e)||t.getContext("experimental-webgl",e);if(!i)throw new Error("Couldn't create WebGL context.");return i._tangram_id=context_id++,r?(Context.resize(i,window.innerWidth,window.innerHeight,e.device_pixel_ratio),window.addEventListener("resize",(function(){Context.resize(i,window.innerWidth,window.innerHeight,e.device_pixel_ratio)}))):Context.resize(i,parseFloat(t.style.width),parseFloat(t.style.height),e.device_pixel_ratio),i},Context.resize=function(t,e,r,i){t.canvas.style.width=e+"px",t.canvas.style.height=r+"px",t.canvas.width=Math.round(e*i),t.canvas.height=Math.round(r*i),t.bindFramebuffer(t.FRAMEBUFFER,null),t.viewport(0,0,t.canvas.width,t.canvas.height)};var gl$1=gl={};gl.BYTE=5120,gl.UNSIGNED_BYTE=5121,gl.SHORT=5122,gl.UNSIGNED_SHORT=5123,gl.INT=5124,gl.UNSIGNED_INT=5125,gl.FLOAT=5126;var MAX_VALUE=Math.pow(2,16)-1,DEFAULT_SIZE=1024,HAS_ELEMENT_INDEX_UINT=!1,VertexElements=_createClass((function t(e){_classCallCheck(this,t),this.size_=e||DEFAULT_SIZE,this.position_=0,this.ArrayType_=Uint16Array,this.buffer_=new this.ArrayType_(this.size_),this.overflows_=!1}),[{key:"push",value:function(t){if(!this.overflows_||HAS_ELEMENT_INDEX_UINT){if(t>MAX_VALUE){if(this.overflows_=!0,!HAS_ELEMENT_INDEX_UINT)return;this.ArrayType_===Uint16Array&&(this.ArrayType_=Uint32Array,this.buffer_=new this.ArrayType_(this.buffer_))}this.position_===this.size_&&this.expand_(),this.buffer_[this.position_]=t,this.position_+=1}}},{key:"end",value:function(){if(0!==this.position_){var t=this.buffer_,e=this.position_;return this.buffer_=new this.ArrayType_(this.size_),this.position_=0,this.overflows_=!1,t.subarray(0,e)}return!1}},{key:"expand_",value:function(){this.size_=this.size_<<1;var t=new this.ArrayType_(this.size_);t.set(this.buffer_),this.buffer_=t}}]);VertexElements.setElementIndexUint=function(t){HAS_ELEMENT_INDEX_UINT=t};var array_types=_defineProperty(_defineProperty(_defineProperty(_defineProperty(_defineProperty(_defineProperty(_defineProperty({},gl$1.FLOAT,Float32Array),gl$1.BYTE,Int8Array),gl$1.UNSIGNED_BYTE,Uint8Array),gl$1.INT,Int32Array),gl$1.UNSIGNED_INT,Uint32Array),gl$1.SHORT,Int16Array),gl$1.UNSIGNED_SHORT,Uint16Array),VertexData=function(){function t(e){var r=(arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}).prealloc,i=void 0===r?500:r;_classCallCheck(this,t),this.vertex_layout=e,this.vertex_elements=new VertexElements,this.stride=this.vertex_layout.stride,t.array_pool.length>0?(this.vertex_buffer=t.array_pool.pop(),this.byte_length=this.vertex_buffer.byteLength,this.size=Math.floor(this.byte_length/this.stride),log("trace","VertexData: reused buffer of bytes ".concat(this.byte_length,", ").concat(this.size," vertices"))):(this.size=i,this.byte_length=this.stride*this.size,this.vertex_buffer=new Uint8Array(this.byte_length)),this.offset=0,this.vertex_count=0,this.realloc_count=0,this.setBufferViews(),this.setAddVertexFunction()}return _createClass(t,[{key:"setBufferViews",value:function(){var t=this;this.views={},this.views[gl$1.UNSIGNED_BYTE]=this.vertex_buffer,this.vertex_layout.dynamic_attribs.forEach((function(e){if(null==t.views[e.type]){var r=array_types[e.type];t.views[e.type]=new r(t.vertex_buffer.buffer)}}))}},{key:"checkBufferSize",value:function(){if(this.offset+this.stride>this.byte_length){this.size=Math.floor(1.5*this.size),this.size-=this.size%4,this.byte_length=this.stride*this.size;var e=new Uint8Array(this.byte_length);e.set(this.vertex_buffer),t.array_pool.push(this.vertex_buffer),this.vertex_buffer=e,this.setBufferViews(),this.realloc_count++}}},{key:"setAddVertexFunction",value:function(){this.vertexLayoutAddVertex=this.vertex_layout.getAddVertexFunction()}},{key:"addVertex",value:function(t){this.checkBufferSize(),this.vertexLayoutAddVertex(t,this.views,this.offset),this.offset+=this.stride,this.vertex_count++}},{key:"end",value:function(){return this.vertex_buffer=this.vertex_buffer.subarray(0,this.offset),this.element_buffer=this.vertex_elements.end(),log("trace","VertexData: ".concat(this.size," vertices total, realloc count ").concat(this.realloc_count)),this}}])}();VertexData.array_pool=[];var VertexLayout=function(){function t(e){_classCallCheck(this,t),this.attribs=e,this.dynamic_attribs=this.attribs.filter((function(t){return!t.static})),this.components=[],this.index={},this.offset={},this.stride=0;for(var r=0,i=0,n=0;n<this.attribs.length;n++){var o=this.attribs[n];if(null==o.static){o.offset=this.stride,o.byte_size=o.size;var a=0;switch(o.type){case gl$1.FLOAT:case gl$1.INT:case gl$1.UNSIGNED_INT:o.byte_size*=4,a=2;break;case gl$1.SHORT:case gl$1.UNSIGNED_SHORT:o.byte_size*=2,a=1}3&o.byte_size&&(o.byte_size+=4-(3&o.byte_size)),this.stride+=o.byte_size;for(var s=o.offset>>a,l=0;l<o.size;l++)this.components.push({type:o.type,shift:a,offset:s++,index:i++});this.index[o.name]=r,r+=o.size,this.offset[o.name]=o.offset}else o.static=Array.isArray(o.static)?o.static:[o.static],o.method="vertexAttrib".concat(o.static.length,"fv")}}return _createClass(t,[{key:"enable",value:function(e,r,i){for(var n,o,a=0;a<this.attribs.length;a++)n=this.attribs[a],-1!==(o=r.attribute(n.name).location)&&(null==n.static?(t.enabled_attribs[o]&&!i||e.enableVertexAttribArray(o),e.vertexAttribPointer(o,n.size,n.type,n.normalized,this.stride,n.offset),t.enabled_attribs[o]=r):e[n.method]instanceof Function&&(e.enableVertexAttribArray(o),e[n.method](o,n.static),e.disableVertexAttribArray(o),delete t.enabled_attribs[o]));for(o in t.enabled_attribs)this.disableUnusedAttribute(e,o,r)}},{key:"disableUnusedAttribute",value:function(e,r,i){t.enabled_attribs[r]!==i&&(e.disableVertexAttribArray(r),delete t.enabled_attribs[r])}},{key:"createVertexData",value:function(){return new VertexData(this)}},{key:"getAddVertexFunction",value:function(){return null==this.addVertex&&this.createAddVertexFunction(),this.addVertex}},{key:"createAddVertexFunction",value:function(){var e=hashString(JSON.stringify(this.attribs));if(null==t.add_vertex_funcs[e]){var r,i=["var t, o;"],n=_toConsumableArray(this.components);n.sort((function(t,e){return t.type!==e.type?t.type-e.type:t.index-e.index}));for(var o=0;o<n.length;o++){var a=n[o];r!==a.type&&(i.push("t = vs[".concat(a.type,"];")),i.push("o = off".concat(a.shift?" >> "+a.shift:"",";")),r=a.type),i.push("t[o + ".concat(a.offset,"] = v[").concat(a.index,"];"))}i=i.join("\n");var s=new Function("v","vs","off",i);t.add_vertex_funcs[e]=s}this.addVertex=t.add_vertex_funcs[e]}}])}();VertexLayout.enabled_attribs={},VertexLayout.add_vertex_funcs={};var tile_bounds=[{x:0,y:0},{x:Geo$1.tile_scale,y:-Geo$1.tile_scale}],default_uvs=[0,0,1,1];function outsideTile(t,e,r){var i=tile_bounds[0],n=tile_bounds[1];return t[0]<=i.x+r&&e[0]<=i.x+r||t[0]>=n.x-r&&e[0]>=n.x-r||t[1]>=i.y-r&&e[1]>=i.y-r||t[1]<=n.y+r&&e[1]<=n.y+r}function isCoordOutsideTile(t,e){e=e||0;var r=tile_bounds[0],i=tile_bounds[1];return t[0]<=r.x+e||t[0]>=i.x-e||t[1]>=r.y-e||t[1]<=i.y+e}var earcut_1=earcut;function earcut(t,e,r){r=r||2;var i,n,o,a,s,l,u,c=e&&e.length,h=c?e[0]*r:t.length,p=linkedList(t,0,h,r,!0),f=[];if(!p)return f;if(c&&(p=eliminateHoles(t,e,p,r)),t.length>80*r){i=o=t[0],n=a=t[1];for(var d=r;d<h;d+=r)(s=t[d])<i&&(i=s),(l=t[d+1])<n&&(n=l),s>o&&(o=s),l>a&&(a=l);u=Math.max(o-i,a-n)}return earcutLinked(p,f,r,i,n,u),f}function linkedList(t,e,r,i,n){var o,a;if(n===signedArea(t,e,r,i)>0)for(o=e;o<r;o+=i)a=insertNode(o,t[o],t[o+1],a);else for(o=r-i;o>=e;o-=i)a=insertNode(o,t[o],t[o+1],a);return a&&equals(a,a.next)&&(removeNode(a),a=a.next),a}function filterPoints(t,e){if(!t)return t;e||(e=t);var r,i=t;do{if(r=!1,i.steiner||!equals(i,i.next)&&0!==area(i.prev,i,i.next))i=i.next;else{if(removeNode(i),(i=e=i.prev)===i.next)return null;r=!0}}while(r||i!==e);return e}function earcutLinked(t,e,r,i,n,o,a){if(t){!a&&o&&indexCurve(t,i,n,o);for(var s,l,u=t;t.prev!==t.next;)if(s=t.prev,l=t.next,o?isEarHashed(t,i,n,o):isEar(t))e.push(s.i/r),e.push(t.i/r),e.push(l.i/r),removeNode(t),t=l.next,u=l.next;else if((t=l)===u){a?1===a?earcutLinked(t=cureLocalIntersections(t,e,r),e,r,i,n,o,2):2===a&&splitEarcut(t,e,r,i,n,o):earcutLinked(filterPoints(t),e,r,i,n,o,1);break}}}function isEar(t){var e=t.prev,r=t,i=t.next;if(area(e,r,i)>=0)return!1;for(var n=t.next.next;n!==t.prev;){if(pointInTriangle(e.x,e.y,r.x,r.y,i.x,i.y,n.x,n.y)&&area(n.prev,n,n.next)>=0)return!1;n=n.next}return!0}function isEarHashed(t,e,r,i){var n=t.prev,o=t,a=t.next;if(area(n,o,a)>=0)return!1;for(var s=n.x<o.x?n.x<a.x?n.x:a.x:o.x<a.x?o.x:a.x,l=n.y<o.y?n.y<a.y?n.y:a.y:o.y<a.y?o.y:a.y,u=n.x>o.x?n.x>a.x?n.x:a.x:o.x>a.x?o.x:a.x,c=n.y>o.y?n.y>a.y?n.y:a.y:o.y>a.y?o.y:a.y,h=zOrder(s,l,e,r,i),p=zOrder(u,c,e,r,i),f=t.nextZ;f&&f.z<=p;){if(f!==t.prev&&f!==t.next&&pointInTriangle(n.x,n.y,o.x,o.y,a.x,a.y,f.x,f.y)&&area(f.prev,f,f.next)>=0)return!1;f=f.nextZ}for(f=t.prevZ;f&&f.z>=h;){if(f!==t.prev&&f!==t.next&&pointInTriangle(n.x,n.y,o.x,o.y,a.x,a.y,f.x,f.y)&&area(f.prev,f,f.next)>=0)return!1;f=f.prevZ}return!0}function cureLocalIntersections(t,e,r){var i=t;do{var n=i.prev,o=i.next.next;!equals(n,o)&&intersects(n,i,i.next,o)&&locallyInside(n,o)&&locallyInside(o,n)&&(e.push(n.i/r),e.push(i.i/r),e.push(o.i/r),removeNode(i),removeNode(i.next),i=t=o),i=i.next}while(i!==t);return i}function splitEarcut(t,e,r,i,n,o){var a=t;do{for(var s=a.next.next;s!==a.prev;){if(a.i!==s.i&&isValidDiagonal(a,s)){var l=splitPolygon(a,s);return a=filterPoints(a,a.next),l=filterPoints(l,l.next),earcutLinked(a,e,r,i,n,o),void earcutLinked(l,e,r,i,n,o)}s=s.next}a=a.next}while(a!==t)}function eliminateHoles(t,e,r,i){var n,o,a,s=[];for(n=0,o=e.length;n<o;n++)(a=linkedList(t,e[n]*i,n<o-1?e[n+1]*i:t.length,i,!1))===a.next&&(a.steiner=!0),s.push(getLeftmost(a));for(s.sort(compareX),n=0;n<s.length;n++)eliminateHole(s[n],r),r=filterPoints(r,r.next);return r}function compareX(t,e){return t.x-e.x}function eliminateHole(t,e){if(e=findHoleBridge(t,e)){var r=splitPolygon(e,t);filterPoints(r,r.next)}}function findHoleBridge(t,e){var r,i=e,n=t.x,o=t.y,a=-1/0;do{if(o<=i.y&&o>=i.next.y){var s=i.x+(o-i.y)*(i.next.x-i.x)/(i.next.y-i.y);if(s<=n&&s>a){if(a=s,s===n){if(o===i.y)return i;if(o===i.next.y)return i.next}r=i.x<i.next.x?i:i.next}}i=i.next}while(i!==e);if(!r)return null;if(n===a)return r.prev;var l,u=r,c=r.x,h=r.y,p=1/0;for(i=r.next;i!==u;)n>=i.x&&i.x>=c&&pointInTriangle(o<h?n:a,o,c,h,o<h?a:n,o,i.x,i.y)&&((l=Math.abs(o-i.y)/(n-i.x))<p||l===p&&i.x>r.x)&&locallyInside(i,t)&&(r=i,p=l),i=i.next;return r}function indexCurve(t,e,r,i){var n=t;do{null===n.z&&(n.z=zOrder(n.x,n.y,e,r,i)),n.prevZ=n.prev,n.nextZ=n.next,n=n.next}while(n!==t);n.prevZ.nextZ=null,n.prevZ=null,sortLinked(n)}function sortLinked(t){var e,r,i,n,o,a,s,l,u=1;do{for(r=t,t=null,o=null,a=0;r;){for(a++,i=r,s=0,e=0;e<u&&(s++,i=i.nextZ);e++);for(l=u;s>0||l>0&&i;)0===s?(n=i,i=i.nextZ,l--):0!==l&&i?r.z<=i.z?(n=r,r=r.nextZ,s--):(n=i,i=i.nextZ,l--):(n=r,r=r.nextZ,s--),o?o.nextZ=n:t=n,n.prevZ=o,o=n;r=i}o.nextZ=null,u*=2}while(a>1);return t}function zOrder(t,e,r,i,n){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-r)/n)|t<<8))|t<<4))|t<<2))|t<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-i)/n)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function getLeftmost(t){var e=t,r=t;do{e.x<r.x&&(r=e),e=e.next}while(e!==t);return r}function pointInTriangle(t,e,r,i,n,o,a,s){return(n-a)*(e-s)-(t-a)*(o-s)>=0&&(t-a)*(i-s)-(r-a)*(e-s)>=0&&(r-a)*(o-s)-(n-a)*(i-s)>=0}function isValidDiagonal(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!intersectsPolygon(t,e)&&locallyInside(t,e)&&locallyInside(e,t)&&middleInside(t,e)}function area(t,e,r){return(e.y-t.y)*(r.x-e.x)-(e.x-t.x)*(r.y-e.y)}function equals(t,e){return t.x===e.x&&t.y===e.y}function intersects(t,e,r,i){return!!(equals(t,e)&&equals(r,i)||equals(t,i)&&equals(r,e))||area(t,e,r)>0!=area(t,e,i)>0&&area(r,i,t)>0!=area(r,i,e)>0}function intersectsPolygon(t,e){var r=t;do{if(r.i!==t.i&&r.next.i!==t.i&&r.i!==e.i&&r.next.i!==e.i&&intersects(r,r.next,t,e))return!0;r=r.next}while(r!==t);return!1}function locallyInside(t,e){return area(t.prev,t,t.next)<0?area(t,e,t.next)>=0&&area(t,t.prev,e)>=0:area(t,e,t.prev)<0||area(t,t.next,e)<0}function middleInside(t,e){var r=t,i=!1,n=(t.x+e.x)/2,o=(t.y+e.y)/2;do{r.y>o!=r.next.y>o&&n<(r.next.x-r.x)*(o-r.y)/(r.next.y-r.y)+r.x&&(i=!i),r=r.next}while(r!==t);return i}function splitPolygon(t,e){var r=new Node(t.i,t.x,t.y),i=new Node(e.i,e.x,e.y),n=t.next,o=e.prev;return t.next=e,e.prev=t,r.next=n,n.prev=r,i.next=r,r.prev=i,o.next=i,i.prev=o,i}function insertNode(t,e,r,i){var n=new Node(t,e,r);return i?(n.next=i.next,n.prev=i,i.next.prev=n,i.next=n):(n.prev=n,n.next=n),n}function removeNode(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function Node(t,e,r){this.i=t,this.x=e,this.y=r,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function signedArea(t,e,r,i){for(var n=0,o=e,a=r-i;o<r;o+=i)n+=(t[a]-t[o])*(t[o+1]+t[a+1]),a=o;return n}earcut.deviation=function(t,e,r,i){var n=e&&e.length,o=n?e[0]*r:t.length,a=Math.abs(signedArea(t,0,o,r));if(n)for(var s=0,l=e.length;s<l;s++){var u=e[s]*r,c=s<l-1?e[s+1]*r:t.length;a-=Math.abs(signedArea(t,u,c,r))}var h=0;for(s=0;s<i.length;s+=3){var p=i[s]*r,f=i[s+1]*r,d=i[s+2]*r;h+=Math.abs((t[p]-t[d])*(t[f+1]-t[p+1])-(t[p]-t[f])*(t[d+1]-t[p+1]))}return 0===a&&0===h?0:Math.abs((h-a)/a)},earcut.flatten=function(t){for(var e=t[0][0].length,r={vertices:[],holes:[],dimensions:e},i=0,n=0;n<t.length;n++){for(var o=0;o<t[n].length;o++)for(var a=0;a<e;a++)r.vertices.push(t[n][o][a]);n>0&&(i+=t[n-1].length,r.holes.push(i))}return r};var earcut$1=getDefaultExportFromCjs(earcut_1),up_vec3=[0,0,1];function buildPolygons(t,e,r,i){var n=i.texcoord_index,o=i.texcoord_scale,a=i.texcoord_normalize,s=e.vertex_elements;if(n){a=a||1;var l=_slicedToArray(o||default_uvs,4),u=l[0],c=l[1],h=l[2],p=l[3]}for(var f=0,d=t.length,y=0;y<d;y++){var g=e.vertex_count,v=t[y];if(n)var m=_slicedToArray(Geo$1.findBoundingBox(v),4),_=m[0],b=m[1],x=(h-u)/(m[2]-_),w=(p-c)/(m[3]-b);for(var E=0;E<v.length;E++)for(var T=v[E],A=0;A<T.length;A++){var S=T[A];r[0]=S[0],r[1]=S[1],n&&(r[n+0]=((S[0]-_)*x+u)*a,r[n+1]=((S[1]-b)*w+c)*a),e.addVertex(r)}for(var k=triangulatePolygon(earcut$1.flatten(v)),I=0;I<k.length;I++)s.push(g+k[I]);f+=k.length/3}return f}function buildExtrudedPolygons(t,e,r,i,n,o,a,s,l){var u=l.remove_tile_edges,c=l.tile_edge_tolerance,h=l.texcoord_index,p=l.texcoord_scale,f=l.texcoord_normalize,d=l.winding,y=e+(i||0),g=e+r;o[2]=g;var v=buildPolygons(t,n,o,{texcoord_index:h,texcoord_scale:p,texcoord_normalize:f}),m=n.vertex_elements,_=n.vertex_count;if(h){f=f||1;var b=_slicedToArray(p||default_uvs,4),x=b[0],w=b[1],E=b[2],T=b[3],A=[[x,T],[x,w],[E,w],[E,T]]}for(var S=t.length,k=0;k<S;k++)for(var I=t[k],P=0;P<I.length;P++)for(var O=I[P],L=0;L<O.length-1;L++)if(!u||!outsideTile(O[L],O[L+1],c)){var C=void 0,R=void 0;"CCW"===d?(C=L,R=L+1):(C=L+1,R=L);var M=[[O[R][0],O[R][1],g],[O[R][0],O[R][1],y],[O[C][0],O[C][1],y],[O[C][0],O[C][1],g]],N=Vector$1.normalize([O[R][0]-O[C][0],O[R][1]-O[C][1],0]),j=Vector$1.cross(up_vec3,N);o[a+0]=j[0]*s,o[a+1]=j[1]*s,o[a+2]=j[2]*s;for(var D=0;D<M.length;D++)o[0]=M[D][0],o[1]=M[D][1],o[2]=M[D][2],h&&(o[h+0]=A[D][0]*f,o[h+1]=A[D][1]*f),n.addVertex(o);m.push(_+0),m.push(_+1),m.push(_+2),m.push(_+2),m.push(_+3),m.push(_+0),_+=4,v+=2}return v}function triangulatePolygon(t){return earcut$1(t.vertices,t.holes,t.dimensions)}var shaderSrc_polygonsVertex="uniform vec2 u_resolution;uniform vec3 u_map_position;uniform vec4 u_tile_origin;uniform float u_tile_proxy_depth;uniform float u_meters_per_pixel;uniform float u_device_pixel_ratio;uniform mat4 u_model;uniform mat4 u_modelView;uniform mat3 u_normalMatrix;uniform mat3 u_inverseNormalMatrix;attribute vec4 a_position;attribute vec4 a_color;\n#ifdef TANGRAM_NORMAL_ATTRIBUTE\nattribute vec3 a_normal;\n#define TANGRAM_NORMAL a_normal\n#else\n#define TANGRAM_NORMAL vec3(0., 0., 1.)\n#endif\n#ifdef TANGRAM_EXTRUDE_LINES\nattribute vec2 a_extrude;attribute vec2 a_offset;attribute vec2 a_scaling;uniform float u_v_scale_adjust;\n#endif\nvarying vec4 v_position;varying vec4 v_local_space_position;varying vec3 v_normal;varying vec4 v_color;varying vec4 v_world_position;\n#if defined(TANGRAM_TEXTURE_COORDS) || defined(TANGRAM_EXTRUDE_LINES)\nattribute vec2 a_texcoord;varying vec2 v_texcoord;\n#endif\n#ifdef TANGRAM_MODEL_POSITION_BASE_ZOOM_VARYING\nvarying vec4 v_modelpos_base_zoom;\n#endif\n#if defined(TANGRAM_LIGHTING_VERTEX)\nvarying vec4 v_lighting;\n#endif\n#define UNPACK_SCALING(x) (x / 1024.)\n#pragma tangram: camera\n#pragma tangram: material\n#pragma tangram: lighting\n#pragma tangram: raster\n#pragma tangram: global\nvoid main(){\n#pragma tangram: setup\n#ifdef TANGRAM_TEXTURE_COORDS\nv_texcoord=a_texcoord;\n#ifdef TANGRAM_EXTRUDE_LINES\nv_texcoord.y*=u_v_scale_adjust;\n#endif\n#endif\n#ifdef TANGRAM_MODEL_POSITION_BASE_ZOOM_VARYING\nv_modelpos_base_zoom=modelPositionBaseZoom();\n#endif\nvec4 position=vec4(a_position.xy,a_position.z/TANGRAM_HEIGHT_SCALE,1.);\n#ifdef TANGRAM_EXTRUDE_LINES\nvec2 extrude=a_extrude.xy;vec2 offset=a_offset.xy;float dz=clamp(u_map_position.z-u_tile_origin.z,0.,4.);dz+=step(1.,dz)*(1.-dz)+mix(0.,2.,clamp((dz-2.)/2.,0.,1.));float mdz=(dz-0.5)*2.;extrude-=extrude*UNPACK_SCALING(a_scaling.x)*mdz;float dwdz=UNPACK_SCALING(a_scaling.y);float sdwdz=sign(step(0.,dwdz)-0.5);offset-=offset*abs(dwdz)*((1.-step(0.,sdwdz))-(dz*-sdwdz));float ssz=exp2(-dz-(u_tile_origin.z-u_tile_origin.w));extrude*=ssz;offset*=ssz;\n#ifdef TANGRAM_BLOCK_WIDTH\nfloat width=1.;\n#pragma tangram: width\nextrude*=width;\n#endif\nposition.xy+=extrude+offset;\n#endif\nv_world_position=wrapWorldPosition(u_model*position);v_local_space_position=position;position=u_modelView*position;\n#pragma tangram: position\nv_position=position;v_normal=normalize(u_normalMatrix*TANGRAM_NORMAL);v_color=a_color;\n#if defined(TANGRAM_LIGHTING_VERTEX)\nvec3 normal=v_normal;\n#pragma tangram: normal\nv_lighting=calculateLighting(position.xyz-u_eye,normal,vec4(1.));\n#endif\ncameraProjection(position);applyLayerOrder(a_position.w+u_tile_proxy_depth+1.,position);\n#if defined(SNAP_TO_PIXEL_GRID)\nsnapToPixelGrid(position);\n#endif\ngl_Position=position;}",shaderSrc_polygonsFragment="uniform vec2 u_resolution;uniform vec3 u_map_position;uniform vec4 u_tile_origin;uniform float u_meters_per_pixel;uniform float u_device_pixel_ratio;uniform mat3 u_normalMatrix;uniform mat3 u_inverseNormalMatrix;varying vec4 v_position;varying vec4 v_local_space_position;varying vec3 v_normal;varying vec4 v_color;varying vec4 v_world_position;\n#ifdef TANGRAM_EXTRUDE_LINES\nuniform bool u_has_line_texture;uniform sampler2D u_texture;uniform float u_texture_ratio;uniform vec4 u_dash_background_color;\n#endif\n#define TANGRAM_NORMAL v_normal\n#if defined(TANGRAM_TEXTURE_COORDS) || defined(TANGRAM_EXTRUDE_LINES)\nvarying vec2 v_texcoord;\n#endif\n#ifdef TANGRAM_MODEL_POSITION_BASE_ZOOM_VARYING\nvarying vec4 v_modelpos_base_zoom;\n#endif\n#if defined(TANGRAM_LIGHTING_VERTEX)\nvarying vec4 v_lighting;\n#endif\n#pragma tangram: camera\n#pragma tangram: material\n#pragma tangram: lighting\n#pragma tangram: raster\n#pragma tangram: global\n#pragma tangram: utils\nvoid main(void){\n#pragma tangram: setup\nvec4 color=v_color;vec3 normal=TANGRAM_NORMAL;\n#ifdef TANGRAM_CROP_BY_TILE\nif(isLocalSpacePixelOutsideTile(v_local_space_position,TANGRAM_TILE_SCALE.x)){discard;}\n#endif\n#ifdef TANGRAM_RASTER_TEXTURE_COLOR\ncolor*=sampleRaster();\n#endif\n#ifdef TANGRAM_EXTRUDE_LINES\nif(u_has_line_texture){vec2 _line_st=vec2(v_texcoord.x,fract(v_texcoord.y/u_texture_ratio));vec4 _line_color=texture2D(u_texture,_line_st);if(_line_color.a<TANGRAM_ALPHA_TEST){\n#if !defined(TANGRAM_BLEND_OVERLAY) && !defined(TANGRAM_BLEND_INLAY)\nif(u_dash_background_color.a==0.){discard;}color=u_dash_background_color;\n#else\ncolor=vec4(u_dash_background_color.rgb,color.a*step(TANGRAM_EPSILON,u_dash_background_color.a));\n#endif\n}else{color*=_line_color;}}\n#endif\n#ifdef TANGRAM_RASTER_TEXTURE_NORMAL\nnormal=normalize(sampleRaster().rgb*2.-1.);\n#endif\n#if defined(TANGRAM_LIGHTING_FRAGMENT) && defined(TANGRAM_MATERIAL_NORMAL_TEXTURE)\ncalculateNormal(normal);\n#endif\n#if !defined(TANGRAM_LIGHTING_VERTEX)\n#pragma tangram: normal\n#endif\n#pragma tangram: color\n#if defined(TANGRAM_LIGHTING_FRAGMENT)\ncolor=calculateLighting(v_position.xyz-u_eye,normal,color);\n#elif defined(TANGRAM_LIGHTING_VERTEX)\ncolor*=v_lighting;\n#endif\n#pragma tangram: filter\ngl_FragColor=color;}",Polygons=Object.create(Style);Object.assign(Polygons,{name:"polygons",built_in:!0,vertex_shader_src:shaderSrc_polygonsVertex,fragment_shader_src:shaderSrc_polygonsFragment,selection:!0,init:function(){Style.init.apply(this,arguments),this.defines.TANGRAM_NORMAL_ATTRIBUTE=!0,this.defines.TANGRAM_LAYER_ORDER=!0,this.defines.TANGRAM_CROP_BY_TILE=this.crop_by_tile,this.texcoords&&(this.defines.TANGRAM_TEXTURE_COORDS=!0)},vertexLayoutForMeshVariant:function(t){if(!this.vertex_layout){var e=[{name:"a_position",size:4,type:gl$1.SHORT,normalized:!1},{name:"a_normal",size:3,type:gl$1.BYTE,normalized:!0},{name:"a_color",size:4,type:gl$1.UNSIGNED_BYTE,normalized:!0},{name:"a_selection_color",size:4,type:gl$1.UNSIGNED_BYTE,normalized:!0}];this.texcoords&&e.push({name:"a_texcoord",size:2,type:gl$1.UNSIGNED_SHORT,normalized:!0}),this.vertex_layout=new VertexLayout(e)}return this.vertex_layout},_parseFeature:function(t,e,r){var i=this.feature_style;return i.color=this.parseColor(e.color,r),i.color?(i.z=e.z&&StyleParser.evalCachedDistanceProperty(e.z,r)||StyleParser.defaults.z,i.z*=Geo$1.height_scale,i.extrude=StyleParser.evalProperty(e.extrude,r),i.extrude&&(!0===i.extrude?(i.height=void 0!==t.properties.height?t.properties.height:StyleParser.defaults.height,i.min_height=void 0!==t.properties.min_height?t.properties.min_height:StyleParser.defaults.min_height):"number"==typeof i.extrude?(i.height=i.extrude,i.min_height=0):Array.isArray(i.extrude)&&(i.min_height=i.extrude[0],i.height=i.extrude[1]),i.height*=Geo$1.height_scale,i.min_height*=Geo$1.height_scale),i.tile_edges=e.tile_edges,i):null},_preprocess:function(t){return t.color=StyleParser.createColorPropertyCache(t.color),t.z=StyleParser.createPropertyCache(t.z,StyleParser.parseUnits),t},makeVertexTemplate:function(t){var e=0;return this.vertex_template[e++]=0,this.vertex_template[e++]=0,this.vertex_template[e++]=t.z||0,this.vertex_template[e++]=this.scaleOrder(t.order),this.vertex_template[e++]=0,this.vertex_template[e++]=0,this.vertex_template[e++]=127,this.vertex_template[e++]=255*t.color[0],this.vertex_template[e++]=255*t.color[1],this.vertex_template[e++]=255*t.color[2],this.vertex_template[e++]=255*t.color[3],this.selection&&(this.vertex_template[e++]=255*t.selection_color[0],this.vertex_template[e++]=255*t.selection_color[1],this.vertex_template[e++]=255*t.selection_color[2],this.vertex_template[e++]=255*t.selection_color[3]),this.texcoords&&(this.vertex_template[e++]=0,this.vertex_template[e++]=0),this.vertex_template},buildPolygons:function(t,e,r,i){var n=this.makeVertexTemplate(e),o={texcoord_index:this.vertex_layout.index.a_texcoord,texcoord_normalize:65535,remove_tile_edges:!e.tile_edges,tile_edge_tolerance:Geo$1.tile_scale*i.tile.pad_scale*4,winding:i.winding};return e.extrude&&e.height?buildExtrudedPolygons(t,e.z,e.height,e.min_height,r.vertex_data,n,this.vertex_layout.index.a_normal,127,o):buildPolygons(t,r.vertex_data,n,o)}});var zero_vec2=[0,0],CAP_TYPE$1={butt:0,square:1,round:2},JOIN_TYPE$1={miter:0,bevel:1,round:2},DEFAULT={MITER_LIMIT:3,TEXCOORD_NORMALIZE:1,TEXCOORD_RATIO:1,MIN_FAN_WIDTH:5},v_scale_adjust=Geo$1.tile_scale,zero_v=[0,0],one_v=[1,0],mid_v=[.5,0];function buildPolylines$1(t,e,r,i,n){var o=n.closed_polygon,a=n.remove_tile_edges,s=n.tile_edge_tolerance,l=n.texcoord_index;n.texcoord_scale;var u,c=n.texcoord_width,h=n.texcoord_ratio,p=n.texcoord_normalize,f=n.extrude_index,d=n.offset_index,y=n.join,g=n.cap,v=n.miter_limit,m=n.offset,_=n.crop_by_tile,b=g?CAP_TYPE$1[g]:CAP_TYPE$1.butt,x=y?JOIN_TYPE$1[y]:JOIN_TYPE$1.miter;if(x===JOIN_TYPE$1.miter)var w=(v=v||DEFAULT.MITER_LIMIT)*v;l&&(p=p||DEFAULT.TEXCOORD_NORMALIZE,u=1/(c*(h=h||DEFAULT.TEXCOORD_RATIO)*v_scale_adjust));for(var E={closed_polygon:o,remove_tile_edges:a,tile_edge_tolerance:s,miter_len_sq:w,join_type:x,cap_type:b,vertex_data:r,vertex_template:i,half_width:e/2,extrude_index:f,offset_index:d,v_scale:u,texcoord_index:l,texcoord_width:c,texcoord_normalize:p,offset:m,geom_count:0,crop_by_tile:_},T=0;T<t.length;T++)buildPolyline$1(t[T],E);if(E.extra_lines)for(var A=0;A<E.extra_lines.length;A++)buildPolyline$1(E.extra_lines[A],E);return E.geom_count}function buildPolyline$1(t,e){if(!(t.length<2)){var r,i,n,o,a=e.join_type,s=e.cap_type,l=e.closed_polygon,u=e.remove_tile_edges,c=e.tile_edge_tolerance,h=e.v_scale,p=e.miter_len_sq,f=e.crop_by_tile,d=null!=e.texcoord_index,y=0;if(l&&a===JOIN_TYPE$1.miter){var g=getTileBoundaryIndex(t);if(0!==g){var v=permuteLine(t,g);return e.extra_lines=e.extra_lines||[],void e.extra_lines.push(v)}}var m=0,_=t.length-1,b=0;for(r=t[m],i=t[m+1];Vector$1.isEqual(r,i);)if(r=i,i=t[1+ ++m],b++,m===t.length-1)return;for(;Vector$1.isEqual(t[_],t[_-1]);)if(b++,0==--_)return;if(!(t.length<2+b))if(o=Vector$1.normalize(Vector$1.perp(r,i)),u&&outsideTile(r,i,c)){var x=getNextNonBoundarySegment(t,m,c);x&&(e.extra_lines=e.extra_lines||[],e.extra_lines.push(x))}else{l?startPolygon(r,n=Vector$1.normalize(Vector$1.perp(t[_-1],r)),o,a,e):(!f&&isCoordOutsideTile(r)||(addCap(r,y,o,s,!0,e),d&&s!==CAP_TYPE$1.butt&&(y+=.5*h*e.texcoord_width)),addVertex$1(r,o,o,1,y,e,1),addVertex$1(r,o,o,0,y,e,-1)),d&&(y+=h*Vector$1.length(Vector$1.sub(i,r)));for(var w=m+1;w<_;w++){var E=w,T=w+1;if(r=t[E],i=t[T],!Vector$1.isEqual(r,i)){if(u&&outsideTile(r,i,c)){addVertex$1(r,o,o,1,y,e,1),addVertex$1(r,o,o,0,y,e,-1),indexPairs(1,e);var A=getNextNonBoundarySegment(t,E+1,c);return void(A&&(e.extra_lines=e.extra_lines||[],e.extra_lines.push(A)))}n=o,o=Vector$1.normalize(Vector$1.perp(r,i)),a===JOIN_TYPE$1.miter?addMiter(y,r,n,o,p,!1,e):addJoin(a,y,r,n,o,!1,e),d&&(y+=h*Vector$1.length(Vector$1.sub(i,r)))}}r=i,n=o,l?endPolygon(r,n,o=Vector$1.normalize(Vector$1.perp(r,t[1])),a,y,e):(addVertex$1(r,n,o,1,y,e,1),addVertex$1(r,n,o,0,y,e,-1),indexPairs(1,e),!f&&isCoordOutsideTile(r)||addCap(r,y,n,s,!1,e))}}}function getTileBoundaryIndex(t){if(isCoordOutsideTile(t[0]))return 0;for(var e=0;e<t.length;e++)if(isCoordOutsideTile(t[t.length-1-e]))return t.length-1-e;return 0}function getNextNonBoundarySegment(t,e,r){for(var i=e;t[i+1]&&outsideTile(t[i],t[i+1],r);)i++;return t.length-i>=2&&t.slice(i)}function startPolygon(t,e,r,i,n){void 0===i||isCoordOutsideTile(t)&&!n.crop_by_tile?(addVertex$1(t,r,r,1,0,n,1),addVertex$1(t,r,r,0,0,n,-1)):i===JOIN_TYPE$1.miter?addMiter(0,t,e,r,n.miter_len_sq,!0,n):addJoin(i,0,t,e,r,!0,n)}function endPolygon(t,e,r,i,n,o){if(isCoordOutsideTile(t)&&!o.crop_by_tile)addVertex$1(t,e,e,1,n,o,1),addVertex$1(t,e,e,0,n,o,-1),indexPairs(1,o);else{var a=createMiterVec(e,r);i===JOIN_TYPE$1.miter&&Vector$1.lengthSq(a)>o.miter_len_sq&&(i=JOIN_TYPE$1.bevel),i===JOIN_TYPE$1.miter?(addVertex$1(t,a,e,1,n,o,1),addVertex$1(t,a,e,0,n,o,-1),indexPairs(1,o)):(addVertex$1(t,e,e,1,n,o,1),addVertex$1(t,e,e,0,n,o,-1),indexPairs(1,o))}}function createMiterVec(t,e){var r=Vector$1.normalize(Vector$1.add(t,e)),i=2/(1+Math.abs(Vector$1.dot(t,r)));return Vector$1.mult(r,i*i)}function addMiter(t,e,r,i,n,o,a){var s=createMiterVec(r,i);Vector$1.lengthSq(s)>n?addJoin(JOIN_TYPE$1.bevel,t,e,r,i,o,a):(addVertex$1(e,s,s,1,t,a,1),addVertex$1(e,s,s,0,t,a,-1),o||indexPairs(1,a))}function addJoin(t,e,r,i,n,o,a){var s=createMiterVec(i,n),l=n[0]*i[1]-n[1]*i[0]>0;null!=a.texcoord_index&&(zero_v[1]=e,one_v[1]=e),l?(addVertex$1(r,s,s,1,e,a,1),addVertex$1(r,i,s,0,e,a,-1),o||indexPairs(1,a),addFan(r,Vector$1.neg(i),s,Vector$1.neg(n),s,zero_v,one_v,zero_v,!1,t===JOIN_TYPE$1.bevel,a),addVertex$1(r,s,s,1,e,a,1),addVertex$1(r,n,s,0,e,a,-1)):(addVertex$1(r,i,s,1,e,a,1),addVertex$1(r,s,s,0,e,a,-1),o||indexPairs(1,a),addFan(r,i,Vector$1.neg(s),n,s,one_v,zero_v,one_v,!1,t===JOIN_TYPE$1.bevel,a),addVertex$1(r,n,s,1,e,a,1),addVertex$1(r,s,s,0,e,a,-1))}function indexPairs(t,e){for(var r=e.vertex_data.vertex_elements,i=e.vertex_data.vertex_count-2*t-2,n=0;n<t;n++)r.push(i+2*n+2),r.push(i+2*n+1),r.push(i+2*n+0),r.push(i+2*n+2),r.push(i+2*n+3),r.push(i+2*n+1),e.geom_count+=2}function addVertex$1(t,e,r,i,n,o,a){var s=o.vertex_template,l=o.vertex_data;s[0]=t[0],s[1]=t[1];var u=o.half_width*a;s[o.extrude_index+0]=e[0]*u,s[o.extrude_index+1]=e[1]*u,o.offset&&(s[o.offset_index+0]=r[0]*o.offset,s[o.offset_index+1]=r[1]*o.offset),null!=o.texcoord_index&&(s[o.texcoord_index+0]=i*o.texcoord_normalize,s[o.texcoord_index+1]=n*o.texcoord_normalize),l.addVertex(s)}var uvCurr=[0,0];function addFan(t,e,r,i,n,o,a,s,l,u,c){for(var h=e[0]*i[1]-e[1]*i[0],p=Vector$1.dot(e,i),f=Math.atan2(h,p);f>=Math.PI;)f-=2*Math.PI;if(u)d=1;else{var d=trianglesPerArc(f,c.half_width);if(d<1)return}var y=c.vertex_data.vertex_count,g=c.vertex_data.vertex_elements;addVertex$1(t,r,n,a[0],a[1],c,1),addVertex$1(t,e,n,o[0],o[1],c,1);var v=e,m=null!=c.texcoord_index;if(m)if(l)var _=Vector$1.sub(o,a);else{uvCurr=Vector$1.copy(o);var b=Vector$1.div(Vector$1.sub(s,o),d)}var x,w,E=f/d,T=f<0?-1:1;h>0?(x=2,w=1):(x=1,w=2);for(var A=0;A<d;A++)0===A&&f<0&&(v=Vector$1.neg(v)),v=Vector$1.rot(v,E),m&&(l?(_=Vector$1.rot(_,E),uvCurr[0]=_[0]+a[0],uvCurr[1]=_[1]*c.texcoord_width*c.v_scale+a[1]):uvCurr=Vector$1.add(uvCurr,b)),addVertex$1(t,v,n,uvCurr[0],uvCurr[1],c,T),g.push(y+A+x),g.push(y),g.push(y+A+w)}function addCap(t,e,r,i,n,o){var a=Vector$1.neg(r),s=null!=o.texcoord_index;switch(i){case CAP_TYPE$1.square:var l;n?(l=[r[1],-r[0]],addVertex$1(t,Vector$1.add(r,l),r,1,e,o,1),addVertex$1(t,Vector$1.add(a,l),r,0,e,o,1),s&&(e+=.5*o.texcoord_width*o.v_scale),addVertex$1(t,r,r,1,e,o,1),addVertex$1(t,a,r,0,e,o,1)):(l=[-r[1],r[0]],addVertex$1(t,r,r,1,e,o,1),addVertex$1(t,a,r,0,e,o,1),s&&(e+=.5*o.texcoord_width*o.v_scale),addVertex$1(t,Vector$1.add(r,l),r,1,e,o,1),addVertex$1(t,Vector$1.add(a,l),r,0,e,o,1)),indexPairs(1,o);break;case CAP_TYPE$1.round:var u,c,h=zero_v,p=one_v,f=mid_v;n?(u=r,c=a,s&&(e+=.5*o.texcoord_width*o.v_scale,h=one_v,p=zero_v,f=mid_v)):(u=a,c=r),s&&(zero_v[1]=e,one_v[1]=e,mid_v[1]=e),addFan(t,u,zero_vec2,c,r,h,f,p,!0,!1,o);break;case CAP_TYPE$1.butt:return}}function trianglesPerArc(t,e){t<0&&(t=-t);var r=e>2*DEFAULT.MIN_FAN_WIDTH?Math.log2(e/DEFAULT.MIN_FAN_WIDTH):1;return Math.ceil(t/Math.PI*r)}function permuteLine(t,e){for(var r=[],i=0;i<t.length;i++){var n=(i+e)%t.length;0!==n&&r.push(t[n])}return r.push(r[0]),r}var default_dash_color=[255,255,255,255],default_background_color=[0,0,0,0];function renderDashArray(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=e.dash_color||default_dash_color,i=e.background_color||default_background_color,n=t,o=e.scale||1;n.length%2==1&&Array.prototype.push.apply(n,n);for(var a=!0,s=[],l=0;l<n.length;l++){for(var u=Math.floor(n[l]*o),c=0;c<u;c++)Array.prototype.push.apply(s,a?r:i);a=!a}return{pixels:s=new Uint8Array(s),length:s.length/4}}var Lines=Object.create(Style);Lines.vertex_layouts=[[],[]],Lines.dash_textures={};var DASH_SCALE=20;function buildPolylines(t,e,r,i,n,o){for(var a={closed:o,vertex_data:r,vertex_template:i,half_width:e/2,vertex_layout_index:n,geom_count:0},s=0,l=t.length;s<l;s++)buildPolyline(t[s],a);return a.geom_count}function buildPolyline(t,e){if(!(t.length<2)){for(var r=[t[0]],i=0,n=[],o=[],a=1,s=t.length;a<s;a++)if(t[a][0]!==t[a-1][0]||t[a][1]!==t[a-1][1]){r.push(t[a]);var l=Vector$1.sub(t[a],t[a-1]),u=Vector$1.length(l);n.push(l),o.push([i,i+u]),i+=u}if(!(r.length<2)){var c=0,h=n[n.length-1],p=n[0],f=n[1],d=[0,0];r.length>2&&(e.closed&&(d[0]=Vector$1.signedAngleBetween(h,p)),d[1]=Vector$1.signedAngleBetween(p,f));var y=r[0],g=o[0];e.closed?(addVertex(y,e,c++,g,i,d,[h,p]),addVertex(y,e,c++,g,i,d,[h,p])):(addVertex(y,e,c++,g,i,d,[p,p]),addVertex(y,e,c++,g,i,d,[p,p]));for(var v=1,m=r.length-1;v<m;v++)y=r[v],h=n[v-1],p=n[v],f=n[v+1],addVertex(y,e,c++,g=o[v-1],i,d,[h,p]),addVertex(y,e,c++,g,i,d,[h,p]),triangulate(e),g=o[v],d[0]=d[1],d[1]=v!==m-1?Vector$1.signedAngleBetween(p,f):e.closed?Vector$1.signedAngleBetween(p,n[0]):0,addVertex(y,e,c++,g,i,d,[h,p]),addVertex(y,e,c++,g,i,d,[h,p]);y=r[r.length-1],g=o[o.length-1],p=n[n.length-1],e.closed?(addVertex(y,e,c++,g,i,d,[p,n[0]]),addVertex(y,e,c++,g,i,d,[p,n[0]])):(addVertex(y,e,c++,g,i,d,[p,p]),addVertex(y,e,c++,g,i,d,[p,p])),triangulate(e)}}}function triangulate(t){var e=t.vertex_data.vertex_elements,r=t.vertex_data.vertex_count-4;e.push(r+2),e.push(r+1),e.push(r+0),e.push(r+2),e.push(r+3),e.push(r+1),t.geom_count+=2}Object.assign(Lines,{name:"lines",built_in:!0,vertex_shader_src:shaderSrc_polygonsVertex,fragment_shader_src:shaderSrc_polygonsFragment,selection:!0,init:function(){Style.init.apply(this,arguments),this.styles=this.styles||{},this.defines.TANGRAM_LAYER_ORDER=!0,this.defines.TANGRAM_EXTRUDE_LINES=!0,this.defines.TANGRAM_CROP_BY_TILE=this.crop_by_tile,this.defines.TANGRAM_TEXTURE_COORDS=!0,this.outline_feature_style={},this.inline_feature_style=this.feature_style},calcDistance:function(t,e){return t&&StyleParser.evalCachedDistanceProperty(t,e)||0},calcDistanceNextZoom:function(t,e){e.zoom++;var r=this.calcDistance(t,e);return e.zoom--,r},calcWidth:function(t,e,r){var i=this.calcDistance(t.width,r);if(!(i<0)){var n;if(n=t.next_width?this.calcDistanceNextZoom(t.next_width,r):i/2,0===i&&0===n||n<0)return!1;if(e.width_unscaled=i,e.next_width_unscaled=n,t.next_width){var o=.5*(i+(n*=2));e.width=o*r.units_per_meter_overzoom,e.width_scale=1-n/o}else e.width=i*r.units_per_meter_overzoom,e.width_scale=0;return t.texcoords&&(t.inline_texcoord_width?e.texcoord_width=t.inline_texcoord_width:e.texcoord_width=(e.width_unscaled||e.next_width_unscaled)*r.units_per_meter_overzoom/r.tile.overzoom2),!0}},calcOffset:function(t,e,r){if(t.offset_precalc)e.offset=t.offset_precalc,e.offset_scale=t.offset_scale_precalc;else if(t.offset){var i=this.calcDistance(t.offset,r);if(t.next_offset){var n=2*this.calcDistanceNextZoom(t.next_offset,r);Math.abs(i)>=Math.abs(n)?(e.offset=i*r.units_per_meter_overzoom,e.offset_scale=0!==i?1-n/i:0):(e.offset=n*r.units_per_meter_overzoom,e.offset_scale=0!==n?-1*(1-i/n):0)}else e.offset=i*r.units_per_meter_overzoom,e.offset_scale=0}else e.offset=0,e.offset_scale=0;StyleParser.evalProperty(t.offset_reverse,r)&&(e.offset*=-1)},_parseFeature:function(t,e,r){var i=this.feature_style;if(!1!==this.calcWidth(e,i,r)&&(this.calcOffset(e,i,r),i.color=this.parseColor(e.color,r),i.color)){if(i.variantKey=e.variantKey,i.z=e.z&&StyleParser.evalCachedDistanceProperty(e.z||0,r)||StyleParser.defaults.z,i.height=t.properties.height||StyleParser.defaults.height,i.extrude=StyleParser.evalProperty(e.extrude,r),i.extrude&&("number"==typeof i.extrude?i.height=i.extrude:Array.isArray(i.extrude)&&(i.height=i.extrude[1])),i.extrude&&i.height&&(i.z+=i.height),i.z*=Geo$1.height_scale,i.height*=Geo$1.height_scale,i.cap=StyleParser.evalProperty(e.cap,r),i.join=StyleParser.evalProperty(e.join,r),i.miter_limit=StyleParser.evalProperty(e.miter_limit,r),i.tile_edges=e.tile_edges,i.outline=i.outline||{width:{},next_width:{},preprocessed:!0},e.outline&&!1!==e.outline.visible&&e.outline.color&&e.outline.width){var n=2*this.calcDistance(e.outline.width,r),o=2*this.calcDistanceNextZoom(e.outline.next_width,r);0===n&&0===o||n<0||o<0?(i.outline.width.value=null,i.outline.next_width.value=null,i.outline.color=null,i.outline.inline_texcoord_width=null,i.outline.texcoords=!1):(i.outline.width.value=n+i.width_unscaled,i.outline.next_width.value=o+i.next_width_unscaled,i.outline.inline_texcoord_width=i.texcoord_width,i.outline.offset_precalc=i.offset,i.outline.offset_scale_precalc=i.offset_scale,i.outline.color=e.outline.color,i.outline.cap=e.outline.cap,i.outline.join=e.outline.join,i.outline.miter_limit=e.outline.miter_limit,i.outline.texcoords=e.outline.texcoords,i.outline.style=e.outline.style,i.outline.variantKey=e.outline.variantKey,e.outline.order?i.outline.order=this.parseOrder(e.outline.order,r):i.outline.order=i.order,i.outline.order>i.order&&(i.outline.order=i.order),i.outline.order-=.5,i.outline.variant_order=0)}else i.outline.width.value=null,i.outline.next_width.value=null,i.outline.color=null,i.outline.inline_texcoord_width=null;return i}},_preprocess:function(t,e){var r=this.sources[e]?this.sources[e].config.uid:"";if(t.color=StyleParser.createColorPropertyCache(t.color),t.width=StyleParser.createPropertyCache(t.width,StyleParser.parseUnits),t.width&&t.width.type!==StyleParser.CACHE_TYPE.STATIC&&(t.next_width=StyleParser.createPropertyCache(t.width,StyleParser.parseUnits)),t.offset=t.offset&&StyleParser.createPropertyCache(t.offset,StyleParser.parseUnits),t.offset&&t.offset.type!==StyleParser.CACHE_TYPE.STATIC&&(t.next_offset=StyleParser.createPropertyCache(t.offset,StyleParser.parseUnits)),t.z=StyleParser.createPropertyCache(t.z,StyleParser.parseUnits),t.dash=void 0!==t.dash?t.dash:this.dash,t.dash_key=t.dash&&this.dashTextureKey(t.dash,r),t.dash_background_color=void 0!==t.dash_background_color?t.dash_background_color:this.dash_background_color,t.dash_background_color=t.dash_background_color&&StyleParser.parseColor(t.dash_background_color),t.texture_merged=t.dash_key||(void 0!==t.texture?t.texture:this.texture),t.texcoords=this.texcoords||t.texture_merged?1:0,this.addMeshVariantForDraw(this.base,t),t.outline){t.outline.style=t.outline.style||this.name,t.outline.color=StyleParser.createColorPropertyCache(t.outline.color),t.outline.width=StyleParser.createPropertyCache(t.outline.width,StyleParser.parseUnits),t.outline.next_width=StyleParser.createPropertyCache(t.outline.width,StyleParser.parseUnits),t.outline.cap=t.outline.cap||t.cap,t.outline.join=t.outline.join||t.join,t.outline.miter_limit=t.outline.miter_limit||t.miter_limit,t.outline.offset=t.offset;var i=this.styles[t.outline.style];i?(t.outline.dash=void 0!==t.outline.dash?t.outline.dash:i.dash,t.outline.texture=void 0!==t.outline.texture?t.outline.texture:i.texture,null!=t.outline.dash?(t.outline.dash_key=t.outline.dash&&this.dashTextureKey(t.outline.dash,r),t.outline.texture_merged=t.outline.dash_key):null===t.outline.dash||null!=t.outline.texture?(t.outline.dash_key=null,t.outline.texture_merged=t.outline.texture):(t.outline.dash=t.dash,t.outline.dash_key=t.outline.dash&&this.dashTextureKey(t.outline.dash,r),t.outline.texture_merged=t.outline.dash_key),t.outline.dash_background_color=void 0!==t.outline.dash_background_color?t.outline.dash_background_color:i.dash_background_color,t.outline.dash_background_color=void 0!==t.outline.dash_background_color?t.outline.dash_background_color:t.dash_background_color,t.outline.dash_background_color=t.outline.dash_background_color&&StyleParser.parseColor(t.outline.dash_background_color),t.outline.texcoords=i.texcoords||t.outline.texture_merged?1:0,this.addMeshVariantForDraw(this.base,t.outline)):(log({level:"warn",once:!0},"Layer '".concat(t.layers[t.layers.length-1],"': ")+"line 'outline' specifies non-existent draw style '".concat(t.outline.style,"' (or maybe the style is ")+"defined but is missing a 'base' or has another error), skipping outlines in layer"),t.outline=null)}return t},dashTextureKey:function(t,e){return"__dash_"+e+"_"+this.scene_id+"_"+JSON.stringify(t)},getDashTexture:function(t,e){var r=this.dashTextureKey(t,this.sources[e].config.uid);if(null==Lines.dash_textures[r]){Lines.dash_textures[r]=!0;var i=renderDashArray(t,{scale:DASH_SCALE});this.textureManager.create(this.gl,r,{data:i.pixels,height:i.length,width:1,filtering:"nearest"})}},endData:function(t){var e=this;return Style.endData.call(this,t).then((function(r){if(r){r.uniforms.u_has_line_texture=!1,r.uniforms.u_texture=e.textureManager.default,r.uniforms.u_v_scale_adjust=Geo$1.tile_scale;var i=[],n=function(){var n=r.meshes[o].variant;if(n.texture){var a=r.meshes[o].uniforms=r.meshes[o].uniforms||{};if(a.u_has_line_texture=!0,a.u_texture=n.texture,a.u_texture_ratio=1,n.dash&&(a.u_v_scale_adjust=Geo$1.tile_scale*DASH_SCALE,a.u_dash_background_color=n.dash_background_color||[0,0,0,0]),n.dash_key&&null==Lines.dash_textures[n.dash_key]&&(Lines.dash_textures[n.dash_key]=!0,WorkerBroker.postMessage(e.main_thread_target+".getDashTexture",n.dash,t.source)),null==e.textureManager.textures[n.texture])i.push(e.textureManager.syncTexturesToWorker([n.texture]).then((function(t){var e=t[n.texture];e&&(a.u_texture_ratio=e.height/e.width)})));else{var s=e.textureManager.textures[n.texture];a.u_texture_ratio=s.height/s.width}}};for(var o in r.meshes)n();return t.mesh_data[e.name]=r,Promise.all(i).then((function(){return r}))}return r}))},computeVariantForDraw:function(t){var e=t.offset?1:0;return t.dash_key&&(e+=t.dash_key,t.dash_background_color&&(e+=t.dash_background_color)),t.texture_merged&&(e+=t.texture_merged),e=hashString(e+="/"+t.texcoords),t.variantKey=e,{key:e,order:t.variant_order,offset:t.offset?1:0,texcoords:t.texcoords,texture:t.texture_merged,dash:t.dash,dash_key:t.dash_key,dash_background_color:t.dash_background_color}},vertexLayoutForMeshVariant:function(t){if(null==Lines.vertex_layouts[t.key]){var e=[{name:"a_position",size:4,type:gl$1.SHORT,normalized:!1},{name:"a_extrude",size:2,type:gl$1.SHORT,normalized:!1},{name:"a_offset",size:2,type:gl$1.SHORT,normalized:!1,static:t.offset?null:[0,0]},{name:"a_scaling",size:2,type:gl$1.SHORT,normalized:!1},{name:"a_texcoord",size:2,type:gl$1.UNSIGNED_SHORT,normalized:!0,static:t.texcoords?null:[0,0]},{name:"a_color",size:4,type:gl$1.UNSIGNED_BYTE,normalized:!0},{name:"a_selection_color",size:4,type:gl$1.UNSIGNED_BYTE,normalized:!0}];Lines.vertex_layouts[t.key]=new VertexLayout(e)}return Lines.vertex_layouts[t.key]},makeVertexTemplate:function(t,e){var r=0;return this.vertex_template[r++]=0,this.vertex_template[r++]=0,this.vertex_template[r++]=t.z||0,this.vertex_template[r++]=this.scaleOrder(t.order),this.vertex_template[r++]=0,this.vertex_template[r++]=0,e.variant.offset&&(this.vertex_template[r++]=0,this.vertex_template[r++]=0),this.vertex_template[r++]=1024*t.width_scale,this.vertex_template[r++]=1024*t.offset_scale,e.variant.texcoords&&(this.vertex_template[r++]=0,this.vertex_template[r++]=0),this.vertex_template[r++]=255*t.color[0],this.vertex_template[r++]=255*t.color[1],this.vertex_template[r++]=255*t.color[2],this.vertex_template[r++]=255*t.color[3],this.selection&&(this.vertex_template[r++]=255*t.selection_color[0],this.vertex_template[r++]=255*t.selection_color[1],this.vertex_template[r++]=255*t.selection_color[2],this.vertex_template[r++]=255*t.selection_color[3]),this.vertex_template},buildLines:function(t,e,r,i,n){if(this.feature_style=this.outline_feature_style,e.outline&&null!=e.outline.color&&null!=e.outline.width.value){var o=this.styles[e.outline.style];o&&o.addFeature(i.feature,e.outline,i)}this.feature_style=this.inline_feature_style;var a=r.vertex_data,s=a.vertex_layout,l=this.makeVertexTemplate(e,r);return buildPolylines$1(t,e.width,a,l,{cap:e.cap,join:e.join,miter_limit:e.miter_limit,extrude_index:s.index.a_extrude,offset_index:s.index.a_offset,texcoord_index:s.index.a_texcoord,texcoord_width:e.texcoord_width,texcoord_normalize:65535,closed_polygon:n&&n.closed_polygon,remove_tile_edges:!e.tile_edges&&n&&n.remove_tile_edges,tile_edge_tolerance:Geo$1.tile_scale*i.tile.pad_scale*2,offset:e.offset,crop_by_tile:this.crop_by_tile})},buildPolygons:function(t,e,r,i){for(var n=0,o=0;o<t.length;o++)n+=this.buildLines(t[o],e,r,i,{closed_polygon:!0,remove_tile_edges:!this.crop_by_tile});return n}});var TEX_COORDS=[[1,1],[1,-1],[-1,1],[-1,-1]];function addVertex(t,e,r,i,n,o,a){var s=e.vertex_template,l=e.vertex_data;if(setAttribute(e,"a_position",t),setAttribute(e,"a_width",e.half_width),e.vertex_layout_index.a_barycentric){var u=[0,0,0];u[r%3]=1,setAttribute(e,"a_barycentric",u)}setAttribute(e,"a_tangents",a[0].concat(a[1])),setAttribute(e,"a_segment",i),setAttribute(e,"a_texcoord",TEX_COORDS[r%4]),setAttribute(e,"a_length",n),setAttribute(e,"a_closed",e.closed?1:0),setAttribute(e,"a_angles",o),l.addVertex(s)}function setAttribute(t,e,r){var i=r.length,n=t.vertex_template,o=t.vertex_layout_index[e],a=0;if(i)for(;a!==i;)n[o+a]=r[a],a++;else n[o+a]=r}function buildPatternBuffer(t,e){for(var r=t.reduce((function(t,e){return t+e})),i=0,n=[],o=0,a=t.length;o<=a;o+=2){var s=Math.max(1e-4,t[o%a]),l=Math.max(1e-4,t[(o+1)%a]);n.push(i,i+s),i+=s+l}for(var u=new Uint8Array(4*e),c=0,h=function(){var t,i,o,a=r*p/(e-1),s=minIdx(n.map((function(t){return Math.abs(t-a)})));s%2==0?(t=a<=n[s]?1:0,i=n[s],o=n[s+1]):(t=a>n[s]?2:0,i=n[s-1],o=n[s]),u[c++]=n[s],u[c++]=t,u[c++]=i,u[c++]=o},p=0;p<e;p++)h();return u}function minIdx(t){for(var e=t[0],r=0,i=1,n=t.length;i<n;i++)t[i]<e&&(r=i,e=t[i]);return r}var vertex_shader_src="uniform vec2 u_resolution;uniform vec4 u_tile_origin;uniform float u_tile_proxy_depth;uniform float u_meters_per_pixel;uniform float u_device_pixel_ratio;uniform sampler2D u_uniforms;uniform mat4 u_model;uniform mat4 u_modelView;uniform mat3 u_normalMatrix;uniform mat3 u_inverseNormalMatrix;uniform vec3 u_map_position;uniform float u_antialias;uniform vec2 u_linecaps;uniform float u_linejoin;uniform float u_miter_limit;uniform float u_dash_index;uniform vec2 u_dash_caps;uniform float u_dash_phase;uniform float u_dash_period;attribute vec4 a_position;attribute vec4 a_color;attribute float a_width;\n#ifdef TANGRAM_DEBUG_TRIANGLES\nattribute vec3 a_barycentric;\n#endif\nattribute vec2 a_normal;attribute float a_length;attribute vec2 a_segment;attribute vec2 a_texcoord;attribute vec2 a_angles;attribute vec4 a_tangents;attribute float a_closed;varying vec4 v_position;varying vec4 v_local_space_position;varying vec3 v_normal;varying vec4 v_color;varying vec4 v_world_position;\n#ifdef TANGRAM_DEBUG_TRIANGLES\nvarying vec3 v_barycentric;\n#endif\nvarying vec2 v_segment;varying vec2 v_angles;varying vec2 v_texcoord;varying vec2 v_distances;varying vec2 v_miter;varying float v_length;varying float v_linewidth_and_closed;varying float v_joinIndicator;\n#define TANGRAM_NORMAL vec3(0., 0., 1.)\n#ifdef TANGRAM_MODEL_POSITION_BASE_ZOOM_VARYING\nvarying vec4 v_modelpos_base_zoom;\n#endif\n#if defined(TANGRAM_LIGHTING_VERTEX)\nvarying vec4 v_lighting;\n#endif\n#ifndef TANGRAM_HEIGHT_SCALE\nfloat TANGRAM_HEIGHT_SCALE=16.0;\n#endif\n#define UNPACK_SCALING(x) (x / 1024.)\n#pragma tangram: camera\n#pragma tangram: material\n#pragma tangram: lighting\n#pragma tangram: global\nconst float PI=3.141592653589793;const float THETA=15.0*PI/180.0;float cross(in vec2 v1,in vec2 v2){return v1.x*v2.y-v1.y*v2.x;}float signed_distance(in vec2 v1,in vec2 v2,in vec2 v3){return cross(v2-v1,v1-v3)/length(v2-v1);}void rotate(in vec2 v,in float angle,out vec2 result){float cosine=cos(angle);float sine=sin(angle);result=vec2(cosine*v.x-sine*v.y,sine*v.x+cosine*v.y);}void main(){\n#pragma tangram: setup\n#ifdef TANGRAM_MODEL_POSITION_BASE_ZOOM_VARYING\nv_modelpos_base_zoom=modelPositionBaseZoom();\n#endif\nfloat linewidth=a_width*2.0;v_angles=a_angles;v_segment=a_segment;v_color=a_color;v_length=a_length;v_texcoord=a_texcoord;\n#ifdef TANGRAM_DEBUG_TRIANGLES\nv_barycentric=a_barycentric;\n#endif\nv_color.a=min(linewidth,v_color.a);linewidth=max(linewidth,1.0);linewidth/=exp2(u_map_position.z-u_tile_origin.w);v_linewidth_and_closed=linewidth*(a_closed>0.0 ?-1.0 : 1.0);if(v_color.a<=0.0){gl_Position=vec4(0.0,0.0,0.0,1.0);return;}float width=ceil(1.25*u_antialias+linewidth)/2.0;vec2 t1=normalize(a_tangents.xy);vec2 t2=normalize(a_tangents.zw);float u=a_texcoord.x;u*=-1.0;float v=a_texcoord.y;vec4 position=vec4(a_position.xy,a_position.z/TANGRAM_HEIGHT_SCALE,1.0);if(t1!=t2){float angle=a_texcoord.x==1.0 ? a_angles.x : a_angles.y;vec2 t=normalize(t1+t2);vec2 o=vec2(+t.y,-t.x);float segmentLength=a_segment.y-a_segment.x;float magnitude=width/cos(angle/2.0);float sqMagnitude=magnitude*magnitude;float seg1SqMagnitude=dot(a_tangents.xy,a_tangents.xy);float seg2SqMagnitude=dot(a_tangents.zw,a_tangents.zw);if((abs(magnitude)>linewidth)&&(sqMagnitude>=min(seg1SqMagnitude,seg2SqMagnitude))){if(u==1.0){o=vec2(-t2.y,+t2.x);}else{o=vec2(-t1.y,+t1.x);}magnitude=width;angle=0.0;v_angles.x=0.0;v_angles.y=0.0;}if(u_dash_index>0.0){if((abs(angle)>THETA)){position.xy+=v*width*o/cos(angle/2.0);float s=sign(angle);if(angle<0.0){if(u==+1.0){u=v_segment.y+v*width*tan(angle/2.0);if(v==1.0){position.xy-=2.0*width*t1/sin(angle);u-=2.0*width/sin(angle);}}else{u=v_segment.x-v*width*tan(angle/2.0);if(v==1.0){position.xy+=2.0*width*t2/sin(angle);u+=2.0*width/sin(angle);}}}else{if(u==+1.0){u=v_segment.y+v*width*tan(angle/2.0);if(v==-1.0){position.xy+=2.0*width*t1/sin(angle);u+=2.0*width/sin(angle);}}else{u=v_segment.x-v*width*tan(angle/2.0);if(v==-1.0){position.xy-=2.0*width*t2/sin(angle);u-=2.0*width/sin(angle);}}}}else{position.xy+=v*width*o/cos(angle/2.0);if(u==+1.0){u=v_segment.y;}else{u=v_segment.x;}}}else{position.xy+=v*o*magnitude;if(u==+1.0){u=v_segment.y+v*width*tan(angle/2.0);}else{u=v_segment.x-v*width*tan(angle/2.0);}}v_joinIndicator=(segmentLength+v*width*tan(angle/2.0))/segmentLength;}else{v_joinIndicator=-1.0;vec2 o=vec2(+t1.y,-t1.x);position.xy+=v*width*o;if(u==-1.0){u=v_segment.x-width;position.xy-=width*t1;}else{u=v_segment.y+width;position.xy+=width*t2;}}vec2 t;vec2 curr=a_position.xy;if(a_texcoord.x>=0.0){vec2 next=curr+t2*(v_segment.y-v_segment.x);rotate(t1,+a_angles.x/2.0,t);v_miter.x=signed_distance(curr,curr+t,position.xy);rotate(t2,+a_angles.y/2.0,t);v_miter.y=signed_distance(next,next+t,position.xy);}else{vec2 prev=curr-t1*(v_segment.y-v_segment.x);rotate(t1,-a_angles.x/2.0,t);v_miter.x=signed_distance(prev,prev+t,position.xy);rotate(t2,-a_angles.y/2.0,t);v_miter.y=signed_distance(curr,curr+t,position.xy);}v_distances=vec2(u,v*width);v_world_position=wrapWorldPosition(u_model*position);v_local_space_position=position;position=u_modelView*position;\n#pragma tangram: position\nv_position=position;v_normal=normalize(u_normalMatrix*TANGRAM_NORMAL);\n#if defined(TANGRAM_LIGHTING_VERTEX)\nvec3 normal=v_normal;\n#pragma tangram: normal\nv_lighting=calculateLighting(position.xyz-u_eye,normal,vec4(1.));\n#endif\ncameraProjection(position);\n#ifdef TANGRAM_LAYER_ORDER\napplyLayerOrder(a_position.w+u_tile_proxy_depth+1.,position);\n#endif\ngl_Position=position;}",fragment_shader_src="uniform vec2 u_resolution;uniform vec4 u_tile_origin;uniform float u_meters_per_pixel;uniform float u_device_pixel_ratio;uniform mat3 u_normalMatrix;uniform mat3 u_inverseNormalMatrix;uniform sampler2D u_dash_atlas;uniform float u_antialias;uniform vec2 u_linecaps;uniform float u_linejoin;uniform float u_miter_limit;uniform float u_dash_phase;uniform float u_dash_period;uniform float u_dash_index;uniform vec2 u_dash_caps;varying vec4 v_position;varying vec4 v_local_space_position;varying vec3 v_normal;varying vec4 v_color;varying vec4 v_world_position;\n#ifdef TANGRAM_DEBUG_TRIANGLES\nvarying vec3 v_barycentric;\n#endif\nvarying vec2 v_segment;varying vec2 v_angles;varying vec2 v_texcoord;varying vec2 v_distances;varying vec2 v_miter;varying float v_length;varying float v_linewidth_and_closed;varying float v_joinIndicator;\n#define TANGRAM_NORMAL v_normal\n#ifdef TANGRAM_MODEL_POSITION_BASE_ZOOM_VARYING\nvarying vec4 v_modelpos_base_zoom;\n#endif\n#if defined(TANGRAM_LIGHTING_VERTEX)\nvarying vec4 v_lighting;\n#endif\n#pragma tangram: camera\n#pragma tangram: material\n#pragma tangram: lighting\n#pragma tangram: global\n#pragma tangram: utils\nconst float PI=3.141592653589793;const float HALF_PI=PI/2.0;const float THETA=15.0*PI/180.0;/***Compute distance to cap.*@param{int}type The Type of the cap(see CAP_TYPE in pattern_lines)*@param{float}dx The distance of the pixel from the beginning of the line(not straight distance,but along the legs)*@param{float}dy The distance of the pixel from the midline(see v_distances in vertex shader,aka ±1*half_line_width)*@param{float}aa_radius The distance from the mid-line from where antialiasing starts.*For example for a linewidth 10px width and 2px filter radius it is 10px/2-2px=3px.*@return{float}distance*/float cap(int type,float dx,float dy,float aa_radius){float dist=0.0;dx=abs(dx);dy=abs(dy);if(type==1)dist=sqrt(dx*dx+dy*dy);else if(type==3)dist=(dx+abs(dy));else if(type==2)dist=max(abs(dy),(aa_radius+dx-abs(dy)));else if(type==4)dist=max(dx,dy);else if(type==5)dist=max(dx+aa_radius,dy);return dist;}/***Compute distance to join.*@param{int}type The type of the join(see JOIN_TYPE in pattern_lines)*@param{vec2}segment Interpolated a_segment attribute from the vertex shader*@param{vec2}texcoord Pair of u/v coordinates to identify the 4 different extruded points of the segment.*@param{vec2}distances 2 component vector where:*x is the distance of the pixel from the beginning of the line(along the legs)*y is the  distance of the pixel from the midline(see v_distances in vertex shader,±1*half_line_width)*@param{vec2}miter Miter point coordiante*@param{float}miter_limit The miter limit*@param{float}linewidth The width of the line*@return{float}computed distance*/float join(in int type,in vec2 segment,in vec2 texcoord,in vec2 distances,in vec2 miter,in float miter_limit,in float linewidth){float dx=distances.x;float result=abs(distances.y);if((dx<segment.x)||(dx>segment.y)){if(type==1){float s=dx<segment.x ? segment.x : segment.y;result=max(result,length(distances-vec2(s,0.0)));}else{float m=abs(texcoord.x>=0.0 ? miter.x : miter.y);if(type==2){result=max(result,m);}else if(type==0){result=max(result,m-miter_limit*linewidth/2.0);}}}return result;}void main(void){\n#pragma tangram: setup\nvec4 color=v_color;vec3 normal=TANGRAM_NORMAL;\n#ifdef TANGRAM_CROP_BY_TILE\nif(isLocalSpacePixelOutsideTile(v_local_space_position,TANGRAM_TILE_SCALE.x)){discard;}\n#endif\n#if defined(TANGRAM_LIGHTING_FRAGMENT) && defined(TANGRAM_MATERIAL_NORMAL_TEXTURE)\ncalculateNormal(normal);\n#endif\n#if !defined(TANGRAM_LIGHTING_VERTEX)\n#pragma tangram: normal\n#endif\n#pragma tangram: color\n#if defined(TANGRAM_LIGHTING_FRAGMENT)\ncolor=calculateLighting(v_position.xyz-u_eye,normal,color);\n#elif defined(TANGRAM_LIGHTING_VERTEX)\ncolor*=v_lighting;\n#endif\n#pragma tangram: filter\nif(v_color.a<=0.0){discard;}bool solid=(u_dash_index==0.0);bool closed=v_linewidth_and_closed<0.0;float dx=v_distances.x;float dy=v_distances.y;float linewidth=abs(v_linewidth_and_closed);float aa_radius=linewidth/2.0-u_antialias;float dist=0.0;vec2 linecaps=u_linecaps;vec2 dash_caps=u_dash_caps;float line_start=0.0;float line_stop=v_length;if(solid){dist=abs(dy);bool potentialCap=!closed&&v_joinIndicator<0.0;if(potentialCap&&dx<line_start){dist=cap(int(u_linecaps.x),abs(dx),abs(dy),aa_radius);}else if(potentialCap&&dx>line_stop){dist=cap(int(u_linecaps.y),abs(dx)-line_stop,abs(dy),aa_radius);}else{dist=join(int(u_linejoin),v_segment,v_texcoord,v_distances,v_miter,u_miter_limit,linewidth);}}else{float segment_start=v_segment.x;float segment_stop=v_segment.y;float segment_center=(segment_start+segment_stop)/2.0;float freq=u_dash_period*linewidth;float dash_phase=u_dash_phase-1e-5;float u=mod(dx+dash_phase*linewidth,freq);vec4 tex=texture2D(u_dash_atlas,vec2(u/freq,u_dash_index));float dash_center=float(tex.x)*255.0*linewidth;float dash_type=floor(float(tex.y)*255.0+0.5);float _start=float(tex.z)*255.0*linewidth;float _stop=float(tex.a)*255.0*linewidth;float dash_start=dx-u+_start;float dash_stop=dx-u+_stop;if((dash_stop<segment_start)&&(dash_caps.x!=5.0)){float u=mod(segment_start+dash_phase*linewidth,freq);vec4 tex=texture2D(u_dash_atlas,vec2(u/freq,u_dash_index));dash_center=float(tex.x)*255.0*linewidth;float _start=float(tex.z)*255.0*linewidth;float _stop=float(tex.a)*255.0*linewidth;dash_start=segment_start-u+_start;dash_stop=segment_start-u+_stop;}else if((dash_start>segment_stop)&&(dash_caps.y!=5.0)){float u=mod(segment_stop+dash_phase*linewidth,freq);vec4 tex=texture2D(u_dash_atlas,vec2(u/freq,u_dash_index));dash_center=float(tex.x)*255.0*linewidth;float _start=float(tex.z)*255.0*linewidth;float _stop=float(tex.a)*255.0*linewidth;dash_start=segment_stop-u+_start;dash_stop=segment_stop-u+_stop;}bool discontinuous=((dx<segment_center)&&abs(v_angles.x)>THETA)||((dx>=segment_center)&&abs(v_angles.y)>THETA);float d_join=join(int(u_linejoin),v_segment,v_texcoord,v_distances,v_miter,u_miter_limit,linewidth);if(closed){line_start+=linewidth/2.0;line_stop-=linewidth/2.0;}if(dash_stop<=line_start){discard;}if(dash_start>=line_stop){discard;}if(discontinuous){if((dash_start>segment_stop)){discard;}if((dash_stop<segment_start)){discard;}if(dash_caps.x==1.0){if((u>_stop)&&(dash_stop>segment_stop)&&(abs(v_angles.y)<HALF_PI)){discard;}}if(dash_caps.y==1.0){if((u<_start)&&(dash_start<segment_start)&&(abs(v_angles.x)<HALF_PI)){discard;}}if((dash_caps.x!=1.0)&&(dash_caps.x!=5.0)){if((dash_start<segment_start)&&(abs(v_angles.x)<HALF_PI)){float a=v_angles.x/2.0;float cos_a=cos(a);float sin_a=sin(a);float x=(segment_start-dx)*cos_a-dy*sin_a;float y=(segment_start-dx)*sin_a+dy*cos_a;if(x>0.0){discard;}dash_caps.x=4.0;}}if((dash_caps.y!=1.0)&&(dash_caps.y!=5.0)){if((dash_stop>segment_stop)&&(abs(v_angles.y)<HALF_PI)){float a=v_angles.y/2.0;float cos_a=cos(a);float sin_a=sin(a);float x=(dx-segment_stop)*cos_a-dy*sin_a;float y=(dx-segment_stop)*sin_a+dy*cos_a;if(x>0.0){discard;}dash_caps.y=4.0;}}}if((dx<line_start)&&(dash_start<=line_start)&&(dash_stop>line_start)){dist=cap(int(linecaps.x),dx-line_start,dy,aa_radius);}else if((dx>line_stop)&&(dash_stop>line_stop)&&(dash_start<line_stop)){dist=cap(int(linecaps.y),dx-line_stop,dy,aa_radius);}else if(dash_type==1.0){dist=cap(int(dash_caps.x),abs(dash_center-u),dy,aa_radius);if((dx>line_start)&&(dx<line_stop)){dist=max(dist,d_join);}}else if(dash_type==0.0){dist=abs(dy);}else if(dash_type==2.0){dist=cap(int(dash_caps.y),abs(u-dash_center),dy,aa_radius);if((dx>line_start)&&(dx<line_stop)){dist=max(dist,d_join);}}if((dx>line_start)&&(dx<line_stop)){if((dx<=segment_start)&&(dash_start<=segment_start)&&(dash_stop>=segment_start)){dist=d_join;float angle=HALF_PI+v_angles.x;float f=abs((segment_start-dx)*cos(angle)-dy*sin(angle));dist=max(f,dist);}else if((dx>segment_stop)&&(dash_start<=segment_stop)&&(dash_stop>=segment_stop)){dist=d_join;float angle=HALF_PI+v_angles.y;float f=abs((dx-segment_stop)*cos(angle)-dy*sin(angle));dist=max(f,dist);}else if(dx<(segment_start-linewidth/2.)){discard;}else if(dx>(segment_stop+linewidth/2.)){discard;}}else if(dx<(segment_start-linewidth/2.)){discard;}else if(dx>(segment_stop+linewidth/2.)){discard;}}dist=dist-aa_radius;if(dist>=0.0){if(u_antialias==0.0){discard;}else{color=vec4(color.rgb,exp(-dist*dist)*color.a);}}\n#ifdef TANGRAM_DEBUG_TRIANGLES\nif(any(lessThan(v_barycentric,vec3(0.0085)))){color=vec4(0.0,1.0,0.0,1.0);}\n#endif\ngl_FragColor=color;}",PatternLines=Object.create(Style),CAP_TYPE={round:1,"arrow-tail":2,"arrow-head":3,square:4,butt:5},JOIN_TYPE={miter:0,round:1,bevel:2},PATTERN_MAX_WIDTH=1024,DEFAULT_LINE_CAP=CAP_TYPE.round,DEFAULT_JOIN_TYPE=JOIN_TYPE.miter,DEFAULT_DASH_PATTERN=[0,0],VARIANT_UNIQUE_PROP_NAMES="antialias join linecaps miter_limit dash_index dash dash_caps dash_phase".split(" ");function getHashForStyle(t){for(var e=[],r=0,i=VARIANT_UNIQUE_PROP_NAMES.length;r<i;r++){var n=t[VARIANT_UNIQUE_PROP_NAMES[r]];Array.isArray(n)?e.push(n.join("_")):"boolean"==typeof n?e.push(n?1:0):n&&e.push(n.toString())}return e.join("/")}Object.assign(PatternLines,{name:"pattern-lines",built_in:!0,vertex_shader_src,fragment_shader_src,selection:!0,init:function(){Style.init.apply(this,arguments),this.defines.TANGRAM_LAYER_ORDER=!0,this.defines.TANGRAM_CROP_BY_TILE=this.crop_by_tile,this.defines.TANGRAM_DEBUG_TRIANGLES=!1,this.defines.TANGRAM_DEBUG_NO_TEXTURE_FLOAT_SUPPORT=!1,this.styles=this.styles||{},PatternLines.vertex_layouts=[]},calcDistance:function(t,e){return t&&StyleParser.evalCachedDistanceProperty(t,e)||0},calcDash:function(t,e){var r=StyleParser.evalProperty(t.dash,e),i=0;return r&&((r=Array.isArray(r)&&r.length?r:DEFAULT_DASH_PATTERN).length%2==1&&(r=r.concat(r)),i=r.reduce((function(t,e){return t+e})),i=+i||0),{dash:r,dash_period:i}},calcWidth:function(t,e,r){var i=this.calcDistance(t.width,r);return!(i<0||(e.width=i*r.units_per_meter_overzoom,0))},getCapType:function(t,e,r){var i=StyleParser.evalProperty(t,e);return void 0!==CAP_TYPE[i]?CAP_TYPE[i]:r},_parseFeature:function(t,e,r){if(!1!==this.calcWidth(e,this.feature_style,r)){var i=this.parseColor(e.color,r);if(i&&0!==i[3]){var n=this.getCapType(e.cap,r,DEFAULT_LINE_CAP),o=StyleParser.evalProperty(e.join,r),a=+StyleParser.evalProperty(e.miter_limit,r),s=this.calcDash(e,r),l=s.dash,u=s.dash_period,c=Object.assign({color:i,antialias:e.antialias,linecaps:[this.getCapType(e.tail_cap,r,n),this.getCapType(e.head_cap,r,n)],join:void 0!==JOIN_TYPE[o]?JOIN_TYPE[o]:DEFAULT_JOIN_TYPE,miter_limit:a>=0?a:3,dash_index:0===u?0:1,dash:l,dash_caps:[this.getCapType(e.tail_cap,r,n),this.getCapType(e.head_cap,r,n)],dash_phase:+StyleParser.evalProperty(e.dash_phase,r)||0,dash_period:u},this.feature_style);return c.z=e.z&&StyleParser.evalCachedDistanceProperty(e.z||0,r)||StyleParser.defaults.z,c.z*=Geo$1.height_scale,c.extrude=StyleParser.evalProperty(e.extrude,r),c.extrude&&(!0===c.extrude?(c.height=void 0!==t.properties.height?t.properties.height:StyleParser.defaults.height,c.min_height=void 0!==t.properties.min_height?t.properties.min_height:StyleParser.defaults.min_height):"number"==typeof c.extrude?(c.height=c.extrude,c.min_height=0):Array.isArray(c.extrude)&&(c.min_height=c.extrude[0],c.height=c.extrude[1]),c.height*=Geo$1.height_scale,c.min_height*=Geo$1.height_scale),this.addMeshVariantForDraw(this.base,c),c}}},_preprocess:function(t,e){t.color=StyleParser.createColorPropertyCache(t.color),t.width=StyleParser.createPropertyCache(t.width,StyleParser.parseUnits),t.width&&t.width.type!==StyleParser.CACHE_TYPE.STATIC&&(t.next_width=StyleParser.createPropertyCache(t.width,StyleParser.parseUnits)),t.z=StyleParser.createPropertyCache(t.z,StyleParser.parseUnits);var r=+t.antialias;return t.antialias=isNaN(r)?0:r,t},buildRasterTextures:function(t,e){var r=[];for(var i in e.meshes){var n=this.getMeshVariantTypeForDraw({variantKey:i}),o=n.uniforms,a=n.pattern;if(o.u_dash_index){var s="__dash_"+a.join("_")+"_"+t.key+"_"+t.id;r.push({name:s,data:buildPatternBuffer(a,PATTERN_MAX_WIDTH)}),o.u_dash_atlas=s,e.meshes[i].textures=[s]}e.meshes[i].uniforms=o}return e.uniforms=e.uniforms||{},r.length?WorkerBroker.postMessage(this.main_thread_target+".loadTextures",r).then((function(t){return e})):Promise.resolve(e)},loadTextures:function(t){for(var e=[],r=0;r<t.length;r++){var i=t[r],n=this.textureManager.textures[i.name];n||(n=this.textureManager.create(this.gl,i.name,{filtering:"nearest",repeat:!0,width:PATTERN_MAX_WIDTH,height:1,data:i.data})),e.push(n.loading)}return Promise.all(e).then((function(t){return t.map((function(t){return t.retain(),t.name}))}))},computeVariantForDraw:function(t){var e=getHashForStyle(t);return t.variantKey=e,{key:e,order:t.variant_order,uniforms:{u_antialias:t.antialias,u_linecaps:t.linecaps,u_linejoin:t.join,u_miter_limit:t.miter_limit,u_dash_index:t.dash_index,u_dash_caps:t.dash_caps,u_dash_phase:t.dash_phase,u_dash_period:t.dash_period},pattern:t.dash}},vertexLayoutForMeshVariant:function(t){if(null==PatternLines.vertex_layouts[t.key]){var e=[{name:"a_position",size:4,type:gl$1.SHORT,normalized:!1},{name:"a_color",size:4,type:gl$1.UNSIGNED_BYTE,normalized:!0},{name:"a_width",size:1,type:gl$1.FLOAT,normalized:!1},{name:"a_tangents",size:4,type:gl$1.FLOAT,normalized:!1},{name:"a_segment",size:2,type:gl$1.FLOAT,normalized:!1},{name:"a_angles",size:2,type:gl$1.FLOAT,normalized:!1},{name:"a_texcoord",size:2,type:gl$1.FLOAT,normalized:!0},{name:"a_length",size:1,type:gl$1.FLOAT,normalized:!1},{name:"a_closed",size:1,type:gl$1.FLOAT,normalized:!1},{name:"a_selection_color",size:4,type:gl$1.UNSIGNED_BYTE,normalized:!0}];this.defines.TANGRAM_DEBUG_TRIANGLES&&e.push({name:"a_barycentric",size:3,type:gl$1.SHORT,normalized:!1}),PatternLines.vertex_layouts[t.key]=new VertexLayout(e)}return PatternLines.vertex_layouts[t.key]},makeVertexTemplate:function(t,e){var r=0;return this.vertex_template[r++]=0,this.vertex_template[r++]=0,this.vertex_template[r++]=t.z+t.height||0,this.vertex_template[r++]=this.scaleOrder(t.order),this.vertex_template[r++]=255*t.color[0],this.vertex_template[r++]=255*t.color[1],this.vertex_template[r++]=255*t.color[2],this.vertex_template[r++]=255*t.color[3],this.vertex_template[r++]=0,this.vertex_template[r++]=0,this.vertex_template[r++]=0,this.vertex_template[r++]=0,this.vertex_template[r++]=0,this.vertex_template[r++]=0,this.vertex_template[r++]=0,this.vertex_template[r++]=0,this.vertex_template[r++]=0,this.vertex_template[r++]=0,this.vertex_template[r++]=0,this.vertex_template[r++]=0,this.vertex_template[r++]=0,this.selection&&(this.vertex_template[r++]=255*t.selection_color[0],this.vertex_template[r++]=255*t.selection_color[1],this.vertex_template[r++]=255*t.selection_color[2],this.vertex_template[r++]=255*t.selection_color[3]),this.defines.TANGRAM_DEBUG_TRIANGLES&&(this.vertex_template[r++]=0,this.vertex_template[r++]=0,this.vertex_template[r++]=0),this.vertex_template},buildLines:function(t,e,r,i){var n=arguments.length>4&&void 0!==arguments[4]&&arguments[4],o=r.vertex_data,a=o.vertex_layout,s=this.makeVertexTemplate(e,r);return buildPolylines(t,e.width,o,s,a.index,n)},buildPolygons:function(t,e,r,i){for(var n=0,o=0,a=t.length;o<a;o++)n+=this.buildLines(t[o],e,r,i,!0);return n}});var STICK_WIDTH=1;function buildQuadsForPoints(t,e,r,i){var n=i.quad,o=i.quad_normalize,a=i.offset,s=i.offsets,l=i.offsets_alt,u=i.pre_angles,c=i.pre_angles_alt,h=i.angle,p=i.angles,f=i.angles_alt,d=i.is_flat,y=i.elevate_by_altitude,g=i.build_stick_points,v=i.color,m=i.stick_color,_=i.curve,b=i.texcoord_scale,x=i.texcoord_normalize,w=i.pre_angles_normalize,E=i.angles_normalize,T=i.offsets_normalize;o=o||1;var A,S=n[0]/2*o,k=n[1]/2*o,I=[[-S,-k],[S,-k],[S,k],[-S,k]],P=e.vertex_elements,O=e.vertex_count,L=e.vertex_layout.index,C=L.a_texcoord,R=L.a_position,M=L.a_shape,N=L.a_offset,j=L.a_offsets,D=L.a_offsets_alt,B=L.a_pre_angles,z=L.a_pre_angles_alt,U=L.a_angles,F=L.a_angles_alt,G=L.a_is_flat,$=L.a_is_stick,q=L.a_color;if(C){x=x||1;var H=_slicedToArray(b||default_uvs,4),V=H[0],Y=H[1],W=H[2],X=H[3];A=[[V,Y],[W,Y],[W,X],[V,X]]}for(var K=0,Z=t.length,J=0;J<Z;J++){var Q=t[J];if(g){for(var tt=STICK_WIDTH/2*o,et=1*o,rt=[[-tt,0],[+tt,0],[+tt,et],[-tt,et]],it=0;it<4;it++)C&&(r[C+0]=A[it][0]*x,r[C+1]=A[it][1]*x),r[R+0]=Q[0],r[R+1]=Q[1],y&&(r[R+2]=MathUtils$1.clamp(Q[2],0,32767)),r[M+0]=rt[it][0],r[M+1]=rt[it][1],r[M+2]=0,r[q+0]=m[0],r[q+1]=m[1],r[q+2]=m[2],r[q+3]=m[3],r[$+0]=255,e.addVertex(r);P.push(O+0),P.push(O+1),P.push(O+2),P.push(O+2),P.push(O+3),P.push(O+0),O+=4,K+=2}for(var nt=0;nt<4;nt++)C&&(r[C+0]=A[nt][0]*x,r[C+1]=A[nt][1]*x),r[R+0]=Q[0],r[R+1]=Q[1],y&&(r[R+2]=MathUtils$1.clamp(Q[2],0,32767)),r[M+0]=I[nt][0],r[M+1]=I[nt][1],r[M+2]=h,r[q+0]=v[0],r[q+1]=v[1],r[q+2]=v[2],r[q+3]=v[3],r[N+0]=a[0],r[N+1]=a[1],r[G+0]=d?255:0,g&&(r[$+0]=0),_&&(r[B+0]=w*u[0],r[B+1]=w*u[1],r[B+2]=w*u[2],r[B+3]=w*u[3],r[U+0]=E*p[0],r[U+1]=E*p[1],r[U+2]=E*p[2],r[U+3]=E*p[3],r[j+0]=T*s[0],r[j+1]=T*s[1],r[j+2]=T*s[2],r[j+3]=T*s[3],l&&(r[D+0]=T*l[0],r[D+1]=T*l[1],r[D+2]=T*l[2],r[D+3]=T*l[3],r[z+0]=w*c[0],r[z+1]=w*c[1],r[z+2]=w*c[2],r[z+3]=w*c[3],r[F+0]=E*f[0],r[F+1]=E*f[1],r[F+2]=E*f[2],r[F+3]=E*f[3])),e.addVertex(r);P.push(O+0),P.push(O+1),P.push(O+2),P.push(O+2),P.push(O+3),P.push(O+0),O+=4,K+=2}return K}var id=0,Label={id_prefix:"",nextLabelId:function(){return"".concat(Label.id_prefix,"/").concat(id++)}};function textLayoutToJSON(t){return{priority:t.priority,collide:t.collide,repeat_distance:t.repeat_distance,repeat_group:t.repeat_group,buffer:t.buffer,italic:t.italic}}var lefts=["left","top-left","bottom-left"],rights=["right","top-right","bottom-right"],tops=["top","top-left","top-right"],bottoms=["bottom","bottom-left","bottom-right"],PointAnchor={computeOffset:function(t,e,r){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;if(!r||"center"===r)return t;var n=[t[0],t[1]];return i=i||this.default_buffer,this.isLeftAnchor(r)?(n[0]-=e[0]/2,"left"===r&&(n[0]-=i[0])):this.isRightAnchor(r)&&(n[0]+=e[0]/2,"right"===r&&(n[0]+=i[1])),this.isTopAnchor(r)?(n[1]-=e[1]/2,"top"===r&&(n[1]-=i[2])):this.isBottomAnchor(r)&&(n[1]+=e[1]/2,"bottom"===r&&(n[1]+=i[3])),n},alignForAnchor:function(t){if(t&&"center"!==t){if(this.isLeftAnchor(t))return"right";if(this.isRightAnchor(t))return"left"}return"center"},isLeftAnchor:function(t){return lefts.indexOf(t)>-1},isRightAnchor:function(t){return rights.indexOf(t)>-1},isTopAnchor:function(t){return tops.indexOf(t)>-1},isBottomAnchor:function(t){return bottoms.indexOf(t)>-1},default_buffer:[2.5,2.5,1.5,.75],zero_buffer:[0,0,0,0]};function encircleLine(t,e,r,i,n){var o=[],a=r-t,s=i-e,l=MathUtils$1.getLineLength(t,e,r,i),u=2*n,c=l/u;if(c<=1)o.push(t+a/2,e+s/2,n);else{var h=u/l,p=a*h,f=s*h;(c=l/n/2)%1&&o.push(r-p/2,i-f/2,n),c|=0;for(var d=t+p/2,y=e+f/2;c--;)o.push(d,y,n),d+=p,y+=f}return o}var LabelPoint=_createClass((function t(e,r,i,n){_classCallCheck(this,t),this.id=Label.nextLabelId(),this.position=[e[0],e[1]],void 0!==e[2]&&this.position.push(e[2]),this.size=r,this.layout=n,this.anchor=Array.isArray(this.layout.anchor)?this.layout.anchor[0]:this.layout.anchor,this.placed=null,this.type="point",this.parent=this.layout.parent,this.offset=this.computeOffset(),this.align=this.layout.align||PointAnchor.alignForAnchor(this.anchor),this._is_flat=i}),[{key:"toJSON",value:function(){return{id:this.id,type:this.type,is_flat:this._is_flat,position:this.position,size:this.size,offset:this.offset,align:this.align,sides:this.getSides(),breach:!this.inTileBounds(),layout:textLayoutToJSON(this.layout)}}},{key:"inTileBounds",value:function(){var t=this.getAABB(),e=t.left,r=t.top,i=t.right,n=t.bottom;return Utils$1.pointInTile([e,r])&&Utils$1.pointInTile([i,n])}},{key:"isFlat",value:function(){return this._is_flat}},{key:"setAnchor",value:function(t){this._circles=void 0,this._aabb=void 0,this.anchor=t,this.offset=this.computeOffset()}},{key:"computeOffset",value:function(){var t=[this.layout.offset[0],this.layout.offset[1]];if(this.parent){var e=this.parent;t=PointAnchor.computeOffset(t,e.size,e.anchor,PointAnchor.zero_buffer),t=PointAnchor.computeOffset(t,e.size,this.anchor,PointAnchor.zero_buffer),e.offset!==StyleParser.zeroPair&&(t===StyleParser.zeroPair?t=e.offset:(t[0]+=e.offset[0],t[1]+=e.offset[1]))}return PointAnchor.computeOffset(t,this.size,this.anchor)}},{key:"getBoundingCircles",value:function(){if(!this.angle)return[];if(!this._circles){var t=this.layout.units_per_pixel,e=this.size[0]/2*t,r=e*Math.cos(this.angle),i=e*Math.sin(this.angle),n=-r,o=-i,a=_slicedToArray(this.position,2),s=a[0],l=a[1];r+=s,i+=l*=-1,n+=s,o+=l;var u=this.size[1]/2*t;this._circles=encircleLine(r,i,n,o,u)}return this._circles}},{key:"getAABB",value:function(){if(!this._aabb){var t=this.layout.units_per_pixel,e=(this.size[0]/2+this.layout.buffer[0])*t,r=(this.size[1]/2+this.layout.buffer[1])*t,i=this.position[0]+this.offset[0]*t,n=this.position[1]-this.offset[1]*t;this._aabb={left:i-e,top:n+r,right:i+e,bottom:n-r}}return this._aabb}},{key:"getSides",value:function(){var t=this.getAABB(),e=t.left,r=t.top,i=t.right,n=(r+t.bottom)/2;return[e,n,i,n]}}]);LabelPoint.PLACEMENT={VERTEX:0,MIDPOINT:1,SPACED:2,CENTROID:3};var PLACEMENT$1=LabelPoint.PLACEMENT,default_spacing=80;function placePointsOnLine(t,e,r,i){var n=[],o=i.placement,a=Math.max(e[0],e[1])*i.placement_min_length_ratio*i.units_per_pixel;switch(o){case PLACEMENT$1.SPACED:var s=getPositionsAndAngles(t,a,i);if(!s)return[];for(var l=s.positions,u=s.angles,c=0;c<l.length;c++){var h=l[c],p=u[c];if(!0===i.tile_edges||!isCoordOutsideTile(h)){var f=new LabelPoint(h,e,r,i);f.angle=p,n.push(f)}}break;case PLACEMENT$1.VERTEX:for(var d,y,g,v=0;v<t.length-1;v++)d=t[v],y=t[v+1],!0!==i.tile_edges&&isCoordOutsideTile(d)||((g=new LabelPoint(d,e,r,i)).angle=getAngle(d,y,i.angle),n.push(g));(g=new LabelPoint(y,e,r,i)).angle=getAngle(d,y,i.angle),n.push(g);break;case PLACEMENT$1.MIDPOINT:for(var m=0;m<t.length-1;m++){var _=t[m],b=t[m+1],x=[.5*(_[0]+b[0]),.5*(_[1]+b[1])];if((!0===i.tile_edges||!isCoordOutsideTile(x))&&(!a||norm(_,b)>a)){var w=new LabelPoint(x,e,r,i);w.angle=getAngle(_,b,i.angle),n.push(w)}}}return n}function getPositionsAndAngles(t,e,r){var i=r.units_per_pixel,n=(r.placement_spacing||default_spacing)*i,o=getLineLength(t);if(o<=e)return!1;for(var a=Math.max(Math.floor(o/n),1),s=[],l=[],u=.5*(o-(a-1)*n),c=0;c<a;c++){var h=interpolateLine(t,u,e,r),p=h.position,f=h.angle;null!=p&&null!=f&&(s.push(p),l.push(f)),u+=n}return{positions:s,angles:l}}function getAngle(t,e){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return"auto"===r?Math.atan2(e[0]-t[0],e[1]-t[1]):r}function getLineLength(t){for(var e=0,r=0;r<t.length-1;r++)e+=norm(t[r],t[r+1]);return e}function norm(t,e){return Math.sqrt(Math.pow(t[0]-e[0],2)+Math.pow(t[1]-e[1],2))}function interpolateLine(t,e,r,i){for(var n,o,a=0,s=0;s<t.length-1;s++){var l=t[s],u=t[s+1],c=norm(l,u);if(!(c<=r)&&(a+=c)>e){n=interpolateSegment(l,u,a-e),o=getAngle(l,u,i.angle);break}}return{position:n,angle:o}}function interpolateSegment(t,e,r){var i=r/norm(t,e);return[i*t[0]+(1-i)*e[0],i*t[1]+(1-i)*e[1]]}var TextSettings={key:function(t){return[t.style,t.weight,t.family,t.px_size,t.fill,t.stroke,t.stroke_width,t.transform,t.text_wrap,t.max_lines,t.supersample,t.background_color,t.outline_color,t.outline_width,t.padding,Utils$1.device_pixel_ratio].join("/")},defaults:{style:"normal",weight:null,size:"12px",px_size:12,family:"Helvetica",fill:"white",text_wrap:15,max_lines:5,align:"center",stroke:null,stroke_width:0,background_color:null,outline_color:null,outline_width:0,padding:[0,0,0,0]},compute:function(t,e,r){var i={};if(e.font=e.font||this.defaults,i.can_articulate=e.can_articulate,i.fill=e.font.fill&&Utils$1.toCSSColor(StyleParser.evalCachedColorProperty(e.font.fill,r))||this.defaults.fill,i.style=e.font.style||this.defaults.style,i.weight=e.font.weight||this.defaults.weight,e.font.family?(i.family=e.font.family,i.family!==this.defaults.family&&(i.family+=", "+this.defaults.family)):i.family=this.defaults.family,i.transform=e.font.transform,i.size=e.font.size||this.defaults.size,i.supersample=e.supersample_text?1.5:1,i.px_size=StyleParser.evalCachedProperty(e.font.px_size,r)*i.supersample,0!==i.px_size){e.font.stroke&&e.font.stroke.color&&(i.stroke=Utils$1.toCSSColor(StyleParser.evalCachedColorProperty(e.font.stroke.color,r)||this.defaults.stroke),i.stroke_width=StyleParser.evalCachedProperty(e.font.stroke.width,r)||this.defaults.stroke_width),i.font_css=this.fontCSS(i);var n=e.text_wrap;return null==n&&"line"!==Geo$1.geometryType(t.geometry.type)&&(n=!0),!0===n&&(n=this.defaults.text_wrap),i.text_wrap=n,i.max_lines=e.max_lines||this.defaults.max_lines,i.background_color=e.background&&e.background.color&&!e.can_articulate?Utils$1.toCSSColor(StyleParser.evalCachedColorProperty(e.background.color,r)):this.defaults.background_color,i.outline_color=e.outline&&e.outline.color&&!e.can_articulate?Utils$1.toCSSColor(StyleParser.evalCachedColorProperty(e.outline.color,r)):this.defaults.outline_color,i.outline_width=e.outline&&e.outline.width&&!e.can_articulate?StyleParser.evalCachedProperty(e.outline.width,r):this.defaults.outline_width,i.padding=e.padding&&!e.can_articulate?StyleParser.evalCachedProperty(e.padding,r):this.defaults.padding,i}},fontCSS:function(t){return[t.style,t.weight,t.px_size+"px",t.family].filter((function(t){return t})).join(" ")}},fontfaceobserver_standalone={exports:{}},e;fontfaceobserver_standalone.exports,e=fontfaceobserver_standalone,function(){function t(t,e){document.addEventListener?t.addEventListener("scroll",e,!1):t.attachEvent("scroll",e)}function r(t){this.a=document.createElement("div"),this.a.setAttribute("aria-hidden","true"),this.a.appendChild(document.createTextNode(t)),this.b=document.createElement("span"),this.c=document.createElement("span"),this.h=document.createElement("span"),this.f=document.createElement("span"),this.g=-1,this.b.style.cssText="max-width:none;display:inline-block;position:absolute;height:100%;width:100%;overflow:scroll;font-size:16px;",this.c.style.cssText="max-width:none;display:inline-block;position:absolute;height:100%;width:100%;overflow:scroll;font-size:16px;",this.f.style.cssText="max-width:none;display:inline-block;position:absolute;height:100%;width:100%;overflow:scroll;font-size:16px;",this.h.style.cssText="display:inline-block;width:200%;height:200%;font-size:16px;max-width:none;",this.b.appendChild(this.h),this.c.appendChild(this.f),this.a.appendChild(this.b),this.a.appendChild(this.c)}function i(t,e){t.a.style.cssText="max-width:none;min-width:20px;min-height:20px;display:inline-block;overflow:hidden;position:absolute;width:auto;margin:0;padding:0;top:-999px;left:-999px;white-space:nowrap;font:"+e+";"}function n(t){var e=t.a.offsetWidth,r=e+100;return t.f.style.width=r+"px",t.c.scrollLeft=r,t.b.scrollLeft=t.b.scrollWidth+100,t.g!==e&&(t.g=e,!0)}function o(e,r){function i(){var t=o;n(t)&&t.a.parentNode&&r(t.g)}var o=e;t(e.b,i),t(e.c,i),n(e)}function a(t,e){var r=e||{};this.family=t,this.style=r.style||"normal",this.weight=r.weight||"normal",this.stretch=r.stretch||"normal"}var s=null,l=null,u=null,c=null;function h(){if(null===u){var t=document.createElement("div");try{t.style.font="condensed 100px sans-serif"}catch(t){}u=""!==t.style.font}return u}function p(t,e){return[t.style,t.weight,h()?t.stretch:"","100px",e].join(" ")}a.prototype.load=function(t,e){var n=this,a=t||"BESbswy",u=0,h=e||3e3,f=(new Date).getTime();return new Promise((function(t,e){var d;if(null===c&&(c=!!document.fonts),(d=c)&&(null===l&&(l=/OS X.*Version\/10\..*Safari/.test(navigator.userAgent)&&/Apple/.test(navigator.vendor)),d=!l),d){d=new Promise((function(t,e){!function r(){(new Date).getTime()-f>=h?e():document.fonts.load(p(n,'"'+n.family+'"'),a).then((function(e){1<=e.length?t():setTimeout(r,25)}),(function(){e()}))}()}));var y=new Promise((function(t,e){u=setTimeout(e,h)}));Promise.race([y,d]).then((function(){clearTimeout(u),t(n)}),(function(){e(n)}))}else!function(t){document.body?t():document.addEventListener?document.addEventListener("DOMContentLoaded",(function e(){document.removeEventListener("DOMContentLoaded",e),t()})):document.attachEvent("onreadystatechange",(function e(){"interactive"!=document.readyState&&"complete"!=document.readyState||(document.detachEvent("onreadystatechange",e),t())}))}((function(){function l(){var e;(e=-1!=g&&-1!=v||-1!=g&&-1!=m||-1!=v&&-1!=m)&&((e=g!=v&&g!=m&&v!=m)||(null===s&&(e=/AppleWebKit\/([0-9]+)(?:\.([0-9]+))/.exec(window.navigator.userAgent),s=!!e&&(536>parseInt(e[1],10)||536===parseInt(e[1],10)&&11>=parseInt(e[2],10))),e=s&&(g==_&&v==_&&m==_||g==b&&v==b&&m==b||g==x&&v==x&&m==x)),e=!e),e&&(w.parentNode&&w.parentNode.removeChild(w),clearTimeout(u),t(n))}var c=new r(a),d=new r(a),y=new r(a),g=-1,v=-1,m=-1,_=-1,b=-1,x=-1,w=document.createElement("div");w.dir="ltr",i(c,p(n,"sans-serif")),i(d,p(n,"serif")),i(y,p(n,"monospace")),w.appendChild(c.a),w.appendChild(d.a),w.appendChild(y.a),document.body.appendChild(w),_=c.a.offsetWidth,b=d.a.offsetWidth,x=y.a.offsetWidth,function t(){if((new Date).getTime()-f>=h)w.parentNode&&w.parentNode.removeChild(w),e(n);else{var r=document.hidden;!0!==r&&void 0!==r||(g=c.a.offsetWidth,v=d.a.offsetWidth,m=y.a.offsetWidth,l()),u=setTimeout(t,50)}}(),o(c,(function(t){g=t,l()})),i(c,p(n,'"'+n.family+'",sans-serif')),o(d,(function(t){v=t,l()})),i(d,p(n,'"'+n.family+'",serif')),o(y,(function(t){m=t,l()})),i(y,p(n,'"'+n.family+'",monospace'))}))}))},e.exports=a}();var fontfaceobserver_standaloneExports=fontfaceobserver_standalone.exports,FontFaceObserver=getDefaultExportFromCjs(fontfaceobserver_standaloneExports),FontManager={fonts_loaded:Promise.resolve(),last_loaded:null,loadFonts:function(t){var e=this,r=JSON.stringify(t)===this.last_loaded;if(t&&!r){var i=[],n=function(r){Array.isArray(t[r])?t[r].forEach((function(t){return i.push(e.loadFontFace(r,t))})):i.push(e.loadFontFace(r,t[r]))};for(var o in t)n(o);this.last_loaded=JSON.stringify(t),this.fonts_loaded=Promise.all(i.filter((function(t){return t})))}return this.fonts_loaded},loadFontFace:function(t,e){if(null!=e&&("object"===_typeof(e)||"external"===e)){var r={family:t},i=Promise.resolve();"object"===_typeof(e)&&(Object.assign(r,e),"string"==typeof e.url&&(i=this.injectFontFace(r)));var n=new FontFaceObserver(t,r);return i.then((function(){return n.load()})).then((function(){log("debug","Font face '".concat(t,"' is available"),r)}),(function(){log("debug","Font face '".concat(t,"' is NOT available"),r)}))}},injectFontFace:function(t){var e=this,r=t.family,i=t.url,n=t.weight,o=t.style;void 0===this.supports_native_font_loading&&(this.supports_native_font_loading=void 0!==window.FontFace);var a=Promise.resolve(i);return"blob:"===i.slice(0,5)&&(a=Utils$1.io(i,6e4,"arraybuffer").then((function(t){var r=new Uint8Array(t);if(e.supports_native_font_loading)return r;for(var i="",n=0;n<r.length;n++)i+=String.fromCharCode(r[n]);return"data:font/opentype;base64,"+btoa(i)}))),a.then((function(t){if(e.supports_native_font_loading){var i;"string"==typeof t?i=new FontFace(r,"url(".concat(encodeURI(t),")"),{weight:n,style:o}):t instanceof Uint8Array&&(i=new FontFace(r,t,{weight:n,style:o})),document.fonts.add(i),log("trace","Adding FontFace to document.fonts:",i)}else{var a="\n                    @font-face {\n                        font-family: '".concat(r,"';\n                        font-weight: ").concat(n||"normal",";\n                        font-style: ").concat(o||"normal",";\n                        src: url(").concat(encodeURI(t),");\n                    }\n                "),s=document.createElement("style");s.appendChild(document.createTextNode("")),document.head.appendChild(s),s.sheet.insertRule(a,0),log("trace","Injecting CSS font face:",a)}}))}},CanvasText=function(){function t(){_classCallCheck(this,t),this.vertical_text_buffer=1,this.horizontal_text_buffer=1,this.layout=layout$1("binary-tree")}return _createClass(t,[{key:"createCanvas",value:function(t,e){var r=document.createElement("canvas");return t&&e&&(r.width=t,r.height=e),r.style.backgroundColor="transparent",r}},{key:"setFont",value:function(t,e){var r=e.font_css,i=e.fill,n=e.stroke,o=e.stroke_width,a=e.px_size,s=e.supersample;this.px_size=a;var l=Utils$1.device_pixel_ratio*s;n&&o>0&&(t.strokeStyle=n,t.lineWidth=o*l),t.fillStyle=i,t.textBaseline="bottom",t.font=r,t.miterLimit=2}},{key:"textSizes",value:function(t,e,r){var i=this;return FontManager.loadFonts().then((function(){return Task.add({type:"textSizes",run:i.processTextSizesTask.bind(i),texts:e,tile_id:t,cursor:{ctx:r,styles:Object.keys(e),texts:null,style_idx:null,text_idx:null}})}))}},{key:"processTextSizesTask",value:function(t){var e=t.cursor,r=t.texts,i=e.ctx;for(e.style_idx=e.style_idx||0;e.style_idx<e.styles.length;){var n=e.styles[e.style_idx];null==e.text_idx&&(e.text_idx=0,e.texts=Object.keys(r[n]));for(var o=r[n],a=!0;e.text_idx<e.texts.length;){var s=e.texts[e.text_idx],l=o[s],u=l.text_settings;if(a&&(this.setFont(i,u),a=!1),l.size=this.textSize(i,n,s,u).size,u.can_articulate){var c=!1,h=!1;if(isTextRTL(s)&&(isTextNeutral(s)?c=!0:h=!0),l.isRTL=c,l.no_curving=h||isTextCurveBlacklisted(s),l.vertical_buffer=this.vertical_text_buffer+u.outline_width+(u.padding[0]+u.padding[2])/2,l.segment_sizes=[],!l.no_curving){var p=splitLabelText(s,c);l.segments=p;for(var f=0;f<p.length;f++)l.segment_sizes.push(this.textSize(i,n,p[f],u).size)}}if(e.text_idx++,!Task.shouldContinue(t))return!1}e.text_idx=null,e.style_idx++}return Task.finish(t,{texts:r}),!0}},{key:"textSize",value:function(e,r,i,n){var o=n.transform,a=n.text_wrap,s=n.max_lines,l=n.stroke_width,u=void 0===l?0:l,c=n.supersample,h=n.padding,p=n.outline_width,f=n.can_articulate;if(t.cache.text[r]=t.cache.text[r]||{},t.cache.text[r][i])return t.cache.stats.text_hits++,t.cache.text[r][i];t.cache.stats.text_misses++,t.cache.text_count++;var d=Utils$1.device_pixel_ratio*c,y=this.applyTextTransform(i,o),g=d*(this.vertical_text_buffer+p+(h[0]+h[2])/2),v=d*(this.horizontal_text_buffer+p+u+(h[1]+h[3])/2),m=2*d,_=this.px_size+m,b=MultiLine.parse(y,a,s,_,e),x=b.height,w=b.width,E=b.lines,T=[w/d,x/d];f||(T[0]+=2*v/d,T[1]+=2*g/d);var A=[w+2*v,x+2*g],S=[A[0]/d,A[1]/d];return t.cache.text[r][i]={lines:E,size:{collision_size:T,texture_size:A,logical_size:S,line_height:_}},t.cache.text[r][i]}},{key:"drawTextMultiLine",value:function(t,e,r,i,n,o){var a=_slicedToArray(r,2),s=a[0],l=a[1],u=Utils$1.device_pixel_ratio*n.supersample,c=n.stroke_width||0,h=n.stroke;n.background_color&&(t.fillStyle=n.background_color,t.fillRect(s,l,i.texture_size[0],i.texture_size[1]));var p=n.outline_width*u,f=n.outline_color;p&&f&&(t.strokeStyle=f,t.lineWidth=p,t.strokeRect(s+p/2,l+p/2,i.texture_size[0]-p,i.texture_size[1]-p)),(n.background_color||p&&f)&&this.setFont(t,n);for(var d=i.line_height,y=l,g=0;g<e.length;g++){var v=e[g];this.drawTextLine(t,v,[s,y],i,n,o),y+=d}if(debugSettings$1.draw_label_collision_boxes){t.save();var m=u*(this.horizontal_text_buffer+n.outline_width+c+(n.padding[1]+n.padding[3])/2),_=u*(this.vertical_text_buffer+n.outline_width+(n.padding[0]+n.padding[2])/2),b=i.collision_size;t.strokeStyle="blue",t.lineWidth=2,t.strokeRect(s+m,l+_,u*b[0],u*b[1]),"curved"===o&&h&&c>0&&t.strokeRect(s+i.texture_size[0]+m,l+_,u*b[0],u*b[1]),t.restore()}if(debugSettings$1.draw_label_texture_boxes){t.save();var x=i.texture_size;t.strokeStyle="green",t.lineWidth=2,t.strokeRect(s+2,l+2,x[0]-4,x[1]-4),"curved"===o&&h&&c>0&&t.strokeRect(s+2+i.texture_size[0],l+2,x[0]-4,x[1]-4),t.restore()}}},{key:"drawTextLine",value:function(t,e,r,i,n,o){var a=_slicedToArray(r,2),s=a[0],l=a[1],u=n.stroke,c=n.stroke_width,h=void 0===c?0:c,p=n.transform,f=n.align,d=n.supersample,y=n.padding,g=n.outline_width,v=Utils$1.device_pixel_ratio*d;f=f||"center";var m,_=i.texture_size,b=i.line_height,x=v*(this.vertical_text_buffer+g),w=v*(this.horizontal_text_buffer+g+h),E=this.applyTextTransform(e.text,p);"left"===f?m=s+w+y[3]*v:"center"===f?m=s+_[0]/2-e.width/2-(y[1]-y[3])*v/2:"right"===f&&(m=s+_[0]-e.width-w-y[1]*v);var T=l+x+b+y[0]*v;if(u&&h>0){var A="curved"===o?_[0]:0;t.strokeText(E,m+A,T)}t.fillText(E,m,T)}},{key:"rasterize",value:function(e,r,i,n,o,a){return Task.removeForTile(i),Task.add({type:"rasterizeLabels",run:this.processRasterizeTask.bind(this),cancel:t.returnNoTextures,pause_factor:2,user_moving_view:!1,texts:e,textures:r,texture_prefix:n,gl:o,tile_id:i,texture_manager:a,cursor:{styles:Object.keys(e),texts:null,style_idx:0,text_idx:null,texture_idx:0,texture_names:[]}})}},{key:"processRasterizeTask",value:function(t){if(!Task.shouldContinue(t))return!1;for(var e,r=t.cursor,i=t.texts,n=t.textures;r.texture_idx<t.textures.length;){var o=!1;e=n[r.texture_idx];for(var a=this.createCanvas.apply(this,_toConsumableArray(e.texture_size)),s=a.getContext("2d");r.style_idx<r.styles.length;){var l=r.styles[r.style_idx];null==r.text_idx&&(r.text_idx=0,r.texts=Object.keys(i[l]));for(var u=i[l],c=!0;r.text_idx<r.texts.length;){var h=r.texts[r.text_idx],p=u[h],f=p.text_settings;if(c&&(this.setFont(s,f),c=!1),f.can_articulate){p.texcoords=p.texcoords||{};for(var d=0;d<p.type.length;d++){var y=p.type[d];switch(y){case"straight":if(p.textures[d]!==r.texture_idx)continue;var g=p.isRTL?h.split().reverse().join():h,v=e.texcoord_cache[l][g],m=void 0;if(v.texcoord)m=v.texcoord;else{var _=v.texture_position,b=this.textSize(s,l,g,f),x=b.size,w=b.lines;this.drawTextMultiLine(s,w,_,x,f,y),m=t.texture_manager.getTexcoordsForSprite(_,x.texture_size,e.texture_size),v.texcoord=m}p.texcoords[y]={texcoord:m,texture_id:v.texture_id};break;case"curved":var E=p.segments;p.texcoords.curved=[],p.texcoords_stroke=[];for(var T=0;T<E.length;T++)if(p.textures[d][T]===r.texture_idx){var A=E[T],S=e.texcoord_cache[l][A],k=void 0,I=void 0;if(S.texcoord&&S.texcoord_stroke)k=S.texcoord,I=S.texcoord_stroke,p.texcoords_stroke.push(I);else{var P=S.texture_position,O=this.textSize(s,l,A,f),L=O.size,C=O.lines;this.drawTextMultiLine(s,C,P,L,f,y),k=t.texture_manager.getTexcoordsForSprite(P,L.texture_size,e.texture_size),f.stroke&&f.stroke_width>0?I=t.texture_manager.getTexcoordsForSprite([P[0]+L.texture_size[0],P[1]],L.texture_size,e.texture_size):(o=!0,I=t.texture_manager.getTexcoordsForSprite([e.texture_size[0],e.texture_size[1]],[0,0],e.texture_size)),S.texcoord=k,S.texcoord_stroke=I,p.texcoords_stroke.push(I)}p.texcoords.curved.push({texcoord:k,texture_id:S.texture_id})}}}}else{var R=this.textSize(s,l,h,f).lines;for(var M in p.align)p.align[M].texture_id===r.texture_idx&&(this.drawTextMultiLine(s,R,p.align[M].texture_position,p.size,{stroke:f.stroke,stroke_width:f.stroke_width,transform:f.transform,supersample:f.supersample,align:M,background_color:f.background_color,outline_width:f.outline_width,outline_color:f.outline_color,padding:f.padding,fill:f.fill,font_css:f.font_css,px_size:f.px_size}),p.align[M].texcoords=t.texture_manager.getTexcoordsForSprite(p.align[M].texture_position,p.size.texture_size,e.texture_size))}r.text_idx++}r.text_idx=null,r.style_idx++}!0===o&&(s.fillStyle="rgba(0, 0, 0, 0)",s.fillRect(a.width-1,a.height-1,1,1));var N=t.texture_prefix+r.texture_idx;t.texture_manager.create(t.gl,N,{element:a,filtering:"linear",UNPACK_PREMULTIPLY_ALPHA_WEBGL:!0}),r.texture_names.push(N),r.texture_idx++,r.style_idx=0,a.width=0,a.height=0}return Task.finish(t,r.texture_names),!0}},{key:"setTextureTextPositions",value:function(t){var e={texture_id:0,texcoord_cache:{}},r=[];for(var i in t){var n=t[i];for(var o in n){var a=n[o],s=a.text_settings,l=s.can_articulate,u=s.stroke,c=s.stroke_width;if(l){a.textures=[],e.texcoord_cache[i]=e.texcoord_cache[i]||{};for(var h=0;h<a.type.length;h++)switch(a.type[h]){case"straight":var p=a.isRTL?o.split().reverse().join():o;if(!e.texcoord_cache[i][p]){var f=a.size.texture_size;e.texcoord_cache[i][p]={},this.placeText(f[0],f[1],{can_articulate:l,style:i,word:p})}a.textures[h]=e.texture_id;break;case"curved":a.textures[h]=[];for(var d=0;d<a.segment_sizes.length;d++){var y=a.segments[d];if(!e.texcoord_cache[i][y]){var g=a.segment_sizes[d].texture_size,v=g[0];u&&c>0&&(v*=2),e.texcoord_cache[i][y]={},this.placeText(v,g[1],{can_articulate:l,style:i,word:y})}a.textures[h].push(e.texture_id)}}}else{var m=a.size.texture_size;this.placeText(m[0],m[1],{can_articulate:l,text_info:a})}}}var _=this.layout.export(),b=_.items,x=_.width,w=_.height;e.texcoord_cache={};for(var E=0,T=b.length;E<T;E++){var A=b[E],S=A.x,k=A.y;if(A.meta.can_articulate){var I=A.meta,P=I.style,O=I.word;e.texcoord_cache[P]=e.texcoord_cache[P]||{},e.texcoord_cache[P][O]||(e.texcoord_cache[P][O]={texture_id:e.texture_id,texture_position:[S,k]})}else{var L=A.meta.text_info;for(var C in L.align)L.align[C].texture_id=e.texture_id,L.align[C].texture_position=[S,k]}}return x>0&&w>0&&(r[e.texture_id]={texture_size:[x,w],texcoord_cache:e.texcoord_cache}),r}},{key:"placeText",value:function(t,e,r){this.layout.addItem({width:t+this.vertical_text_buffer,height:e+this.vertical_text_buffer,meta:r})}},{key:"applyTextTransform",value:function(t,e){return"capitalize"===e?t.replace(/\w\S*/g,(function(t){return t.charAt(0).toUpperCase()+t.substr(1)})):"uppercase"===e?t.toUpperCase():"lowercase"===e?t.toLowerCase():t}}],[{key:"fontPixelSize",value:function(e){if(null!=e){var r=_slicedToArray((e="string"==typeof e?e:String(e)).match(t.font_size_re)||[],3),i=r[1],n=r[2];return"em"===(n=n||"px")?i*=16:"pt"===n?i/=.75:"%"===n&&(i/=6.25),(i=StyleParser.parsePositiveNumber(i))*Utils$1.device_pixel_ratio}}},{key:"pruneTextCache",value:function(){t.cache.text_count>t.cache.text_count_max&&(t.cache.text={},t.cache.text_count=0,log("debug","CanvasText: pruning text cache")),Object.keys(t.cache.segment).length>t.cache.segment_count_max&&(t.cache.segment={},log("debug","CanvasText: pruning segment cache"))}}])}();CanvasText.font_size_re=/((?:[0-9]*\.)?[0-9]+)\s*(px|pt|em|%)?/,CanvasText.cache={text:{},text_count:0,text_count_max:2e3,segment:{},segment_count_max:2e3,stats:{text_hits:0,text_misses:0,segment_hits:0,segment_misses:0}},CanvasText.EMPTY_TEXTURES_ARR=[],CanvasText.returnNoTextures=function(){return CanvasText.EMPTY_TEXTURES_ARR};var rtlDirCheck=new RegExp("[֑-߿‏‫‮יִ-﷽ﹰ-ﻼ]");function isTextRTL(t){return rtlDirCheck.test(t)}var neutral_chars="\0-/:-@[-`{-¿×÷ʹ-˿ -⯿‐-\u2029‬ -⯿",neutralDirCheck=new RegExp("["+neutral_chars+"]+");function isTextNeutral(t){return neutralDirCheck.test(t)}var markRTL="‏",arabic_range=new RegExp("^["+neutral_chars+"؀-ۿ]+"),arabic_splitters=new RegExp("["+neutral_chars+"آ-إاد-زوٱ-ٷڈ-ڙۄ-ۋۏےۓۮۯ]"),arabic_vowels=new RegExp("^[ؐ-ًؚ-ٰٟۖ-ۜ۟-۪ۤۧۨ-ۭ]+"),accents_and_vowels="[̀-֑ͯ-ׇֽֿׁׂׅׄަ-ްऀ-ःऺ-ौॎॏ॑-ॗॢॣঁ-ঃ়া-ৌৗৢৣਁ-ਃ਼-ੌੑઁ-ઃ઼ા-ૌૢૣଁ-ଃ଼ା-ୌୖୗୢୣஂா-்ௗఀ-ఃా-ౌౕౖౢౣಁ-ಃ಼ಾ-ೌೕೖೢೣഁ-ഃാ-ൌൎൗൢൣංඃ්-ෟෲෳัิ-ฺ็-๎ັິ-ຼ່-ໍ༹༘༙༵༷༾༿ཱ-ྃ྆྇ྍ-ྼ࿆ါ-း်-ှၖ-ၙၞ-ၠၢ-ၤၧ-ၭၱ-ၴႂ-ႍႏႚ-ႝ឴-៑៓ᩕ-ᩞᩡ-᩼᷀-᷿⃐-⃿]",combo_characters="[्্੍્୍్್്྄္្᩠᩿]",graphemeRegex=new RegExp("^.(?:"+accents_and_vowels+"+)?("+combo_characters+"\\W(?:"+accents_and_vowels+"+)?)*"),curve_blacklist={Mongolian:"᠀-᢯"},curve_blacklist_range=Object.keys(curve_blacklist).map((function(t){return curve_blacklist[t]})).join(""),curve_blacklist_test=new RegExp("["+curve_blacklist_range+"]");function isTextCurveBlacklisted(t){return curve_blacklist_test.test(t)}var default_segment_length=2;function splitLabelText(t,e){var r=e?1:default_segment_length;if(t.length<r)return[t];var i=t;if(CanvasText.cache.segment[i])return CanvasText.cache.stats.segment_hits++,CanvasText.cache.segment[i];var n=[];if(arabic_range.exec(t)){n=t.split(arabic_splitters);for(var o=-1,a=0;a<n.length-1;a++){if(a>0){var s=arabic_vowels.exec(n[a]);s&&(n[a]=n[a].substring(s[0].length),n[a-1]+=s[0],o+=s[0].length)}o+=1+n[a].length,n[a]+=t.slice(o,o+1)}t=""}for(;t.length;){for(var l="",u=t,c=0;c<r&&u.length;c++){var h=(graphemeRegex.exec(u)||u)[0];l+=h,u=u.substring(h.length)}n.push(l),t=t.substring(l.length)}return e&&n.reverse(),CanvasText.cache.stats.segment_misses++,CanvasText.cache.segment[i]=n,n}var MultiLine=function(){function t(e){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1/0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1/0;_classCallCheck(this,t),this.width=0,this.height=0,this.lines=[],this.max_lines=r,this.text_wrap=i,this.context=e}return _createClass(t,[{key:"createLine",value:function(t){return this.lines.length<this.max_lines&&new Line(t,this.text_wrap)}},{key:"push",value:function(t){if(this.lines.length<this.max_lines){var e=this.context.measureText(t.text).width;return t.width=e,e>this.width&&(this.width=Math.ceil(e)),this.lines.push(t),this.height+=t.height,!0}return this.addEllipsis(),!1}},{key:"advance",value:function(t,e){return!!this.push(t)&&this.createLine(e)}},{key:"addEllipsis",value:function(){var e=this.lines[this.lines.length-1],r=Math.ceil(this.context.measureText(t.ellipsis).width);e.append(t.ellipsis),e.width+=r,e.width>this.width&&(this.width=e.width)}},{key:"finish",value:function(t){t?this.push(t):this.addEllipsis()}}],[{key:"parse",value:function(e,r,i,n,o){var a;a="number"==typeof r?e.split(" "):[e];for(var s=new t(o,i,r),l=s.createLine(n),u=0;u<a.length;u++){for(var c=a[u].split("\n"),h=0===u,p=0;p<c.length&&l;p++){var f=c[p];isTextRTL(f)&&isTextNeutral(f[f.length-1])&&(f+=markRTL);var d=h?f:" "+f;if(r&&u>0&&l.exceedsTextwrap(d)){if(!(l=s.advance(l,n)))break;l.append(f),h=!0}else l.append(d);p<c.length-1&&(l=s.advance(l,n),h=!0)}u===a.length-1&&s.finish(l)}return s}}])}();MultiLine.ellipsis="...";var Line=_createClass((function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;_classCallCheck(this,t),this.chars=0,this.text="",this.height=Math.ceil(e),this.text_wrap=r}),[{key:"append",value:function(t){this.chars+=t.length,this.text+=t}},{key:"exceedsTextwrap",value:function(t){return t.length+this.chars>this.text_wrap}}]),TextLabels={resetText:function(){this.texts={}},freeText:function(t){delete this.texts[t.id]},parseTextFeature:function(t,e,r,i){var n=this.parseTextSource(t,e,r);if(null!=n&&""!==n){var o=TextSettings.compute(t,e,r);if(o){var a=TextSettings.key(o);this.texts[i.id]=this.texts[i.id]||{};var s=this.texts[i.id][a]=this.texts[i.id][a]||{};if(n instanceof Object){var l=[],u=n.left+"-"+n.right;for(var c in n){var h=n[c];if(h){var p=this.computeTextLayout({},t,e,r,i,h,o,u,c);s[h]||(s[h]={text_settings:o,ref:0}),l.push({draw:e,text:h,text_settings_key:a,layout:p})}}return l.length>0&&l}var f=this.computeTextLayout({},t,e,r,i,n,o);return s[n]||(s[n]={text_settings:o,ref:0}),{draw:e,text:n,text_settings_key:a,layout:f}}}},parseTextSource:function(t,e,r){var i,n=e.text_source||"name";if(null!=n&&"object"===_typeof(n))for(var o in i={},n)i[o]=this.parseTextSourceValue(n[o],t,r);else i=this.parseTextSourceValue(n,t,r);return i},parseTextSourceValue:function(t,e,r){var i;if(Array.isArray(t)){for(var n=0;n<t.length;n++)if("string"==typeof t[n]?i=e.properties[t[n]]:"function"==typeof t[n]&&(i=t[n](r)),i)return i}else"string"==typeof t?i=e.properties[t]:t instanceof Function&&(i=t(r));return i},prepareTextLabels:function(t,e,r){var i=this;return 0===Object.keys(this.texts[t.id]||{}).length?Promise.resolve([]):WorkerBroker.postMessage(this.main_thread_target+".calcTextSizes",t.id,this.texts[t.id]).then((function(e){var n=e.texts;return t.canceled?(log("trace","Style ".concat(i.name,": stop tile build because tile was canceled: ").concat(t.key,", post-calcTextSizes()")),[]):(i.texts[t.id]=n||[],n?i.buildTextLabels(t,r):(Collision.abortTile(t.id),[]))}))},collideAndRenderTextLabels:function(t,e,r){var i=this;return this.prepareTextLabels(t,e,r).then((function(r){return 0===r.length?(Collision.collide([],e,t.id),Promise.resolve({})):Collision.collide(r,e,t.id).then((function(e){if(t.canceled)return log("trace","stop tile build because tile was canceled: ".concat(t.key,", post-collide()")),{};var r=i.texts[t.id];return null==r||0===e.length?{}:(i.cullTextStyles(r,e),e.forEach((function(t){var e=t.text_settings_key,i=r[e]&&r[e][t.text];i.text_settings.can_articulate?(i.type||(i.type=[]),-1===i.type.indexOf(t.label.type)&&i.type.push(t.label.type)):(i.align=i.align||{},i.align[t.label.align]={})})),{labels:e,texts:r,textures:[]})}))}))},cullTextStyles:function(t,e){for(var r=0;r<e.length;r++){var i=e[r];t[i.text_settings_key][i.text].ref++}for(var n in t)for(var o in t[n])t[n][o].ref<1&&delete t[n][o];for(var a in t)0===Object.keys(t[a]).length&&delete t[a]},calcTextSizes:function(t,e){return this._canvas_text||(this._canvas_text=new CanvasText,this._canvas_ctx_for_sizes=this._canvas_text.createCanvas().getContext("2d")),this._canvas_text.textSizes(t,e,this._canvas_ctx_for_sizes)},preprocessText:function(t){if(t&&t.font&&"object"===_typeof(t.font))return t.font.fill=StyleParser.createPropertyCache(t.font.fill),t.font.stroke&&(t.font.stroke.color=StyleParser.createPropertyCache(t.font.stroke.color)),t.background&&t.background.color&&(t.background.color=StyleParser.createPropertyCache(t.background.color)),t.outline&&(t.outline.color&&(t.outline.color=StyleParser.createPropertyCache(t.outline.color)),t.outline.width&&(t.outline.width=StyleParser.createPropertyCache(t.outline.width,StyleParser.parsePositiveNumber))),t.padding&&(Array.isArray(t.padding)?2===t.padding.length&&(t.padding=[t.padding[0],t.padding[1],t.padding[0],t.padding[1]]):t.padding=Array(4).fill(t.padding),t.padding=StyleParser.createPropertyCache(t.padding,(function(t){return t.map(StyleParser.parsePositiveNumber)}))),t.font.px_size=StyleParser.createPropertyCache(t.font.size||TextSettings.defaults.size,CanvasText.fontPixelSize),t.font.stroke&&null!=t.font.stroke.width&&(t.font.stroke.width=StyleParser.createPropertyCache(t.font.stroke.width,StyleParser.parsePositiveNumber)),t.offset=StyleParser.createPropertyCache(t.offset,(function(t){return Array.isArray(t)&&t.map(StyleParser.parseNumber)})),t.buffer=StyleParser.createPropertyCache(t.buffer,(function(t){return(Array.isArray(t)?t:[t,t]).map(StyleParser.parsePositiveNumber)})),t.repeat_distance=StyleParser.createPropertyCache(t.repeat_distance||Geo$1.tile_size,StyleParser.parsePositiveNumber),t},computeTextLayout:function(t,e,r,i,n,o,a,s,l){var u=t||{};return(u=this.computeLayout(u,e,r,i,n)).repeat_distance&&(s&&(u.repeat_group+="/"+s),u.repeat_group+="/"+o),u.subdiv=n.overzoom2,u.align=r.align,u.italic="normal"!==a.style,"right"===l?u.orientation=1:"left"===l&&(u.orientation=-1),u}};function degToRad(t){return t*Math.PI/180}var PI_OVER_180=Math.PI/180,HORIZON_THRESHOLD_MULTIPLIER=.75,ZOOM_FOR_BOUNDS_EPSILON=.001,NEAR_PLANE=1,LookAtManipulator=function(){function t(e,r){_classCallCheck(this,t),this._min_zoom=H.util.constants.DEFAULT_MIN_ZOOM_LEVEL,this._max_zoom=H.util.constants.DEFAULT_MAX_ZOOM_LEVEL,this._viewport=e,this._center_offset=[],this._center_offset_normalized=[],this._viewport_aspect_ratio=1,this._focal_length=[[16,2],[17,2.5],[18,3],[19,4],[20,6]],this._view_matrix=new Float64Array(16),this._projection_matrix=new Float64Array(16),this._heading_matrix=new Float64Array(16),this._tilt_matrix=new Float64Array(16),this._transformation_matrix=new Float64Array(16),this._camera_matrix=new Float64Array(16),this._lookAtData={position:[0,0,0],zoom:0,tile_level:0,tetragon:void 0,bounds:void 0,unpadded_bounds:void 0,distance:void 0,tilt:0,incline:0,heading:180},this._zoom_direction=0,this._horizon=0,this.handleViewportUpdate(!0),r?this.setLookAtData(r):this._updateMatrices(),ShaderProgram.replaceBlock("camera","\n            uniform mat4 u_projection;\n            uniform vec3 u_eye;\n            uniform vec2 u_center_offset;\n\n            void cameraProjection (inout vec4 position) {\n                position = u_projection * position;\n            }")}return _createClass(t,[{key:"getZoomForBounds",value:function(t,e,r,i){var n=this.clone(),o=this._max_zoom,a=this._min_zoom,s=(o-a)/2,l=o-s,u=e,c=MathUtils$1.getBBoxCenter(MathUtils$1.getBBox(t));if(void 0===u)u=c;else{var h=c[0]-u[0];Math.abs(h)>Geo$1.half_circumference_meters+1e-8&&(u[0]+=Math.round(h/Geo$1.circumference_meters)*Geo$1.circumference_meters)}for(var p=function(){n.setLookAtData({zoom:l,position:u,tilt:r,heading:i});var e=n.getLookAtData().bounds;if(t.every((function(t){return MathUtils$1.isPointInsidePolygon(t,e)})))a=l;else{var c=_slicedToArray(MathUtils$1.getBBox(e),4),h=c[0],p=c[1],f=c[2],d=c[3];f-h+1e-8>=Geo$1.circumference_meters&&d-p+1e-8>=Geo$1.circumference_meters?a=l:o=l}l=o-(s=(o-a)/2)};s>ZOOM_FOR_BOUNDS_EPSILON;)p();return a}},{key:"setZoomConstraints",value:function(t,e){this._min_zoom=t,this._max_zoom=e,this.setLookAtData(this.getLookAtData())}},{key:"setLookAtData",value:function(t,e){var r,i,n=t.position,o=t.zoom;if(n===r&&t.bounds!==r&&(n=MathUtils$1.getBBoxCenter(MathUtils$1.getBBox(t.bounds))),o===r&&t.bounds!==r&&(o=this.getZoomForBounds(t.bounds,n,t.tilt,t.heading)),e!==r&&(i=n||this.screenToWorld(e)),o!==r){o=MathUtils$1.clamp(o,this._min_zoom,this._max_zoom);var a=Utils$1.zoomToTileLevel(o),s=this._lookAtData.tile_level;a!==s&&(this._zoom_direction=a>s?1:-1),this._lookAtData.zoom=o,this._lookAtData.tile_level=a}if(t.tilt!==r&&(this._lookAtData.tilt=t.tilt),t.heading!==r&&(this._lookAtData.heading=t.heading),e!==r){this._updateMatrices();var l=this.screenToWorld(e);this._lookAtData.position[0]-=l[0]-i[0],this._lookAtData.position[1]-=l[1]-i[1]}else n&&(this._lookAtData.position=n);this._lookAtData.position[2]=0,this._lookAtData.position[1]=MathUtils$1.clamp(this._lookAtData.position[1],-Geo$1.half_circumference_meters,Geo$1.half_circumference_meters),this._updateMatrices(),this._updateVisibleBounds()}},{key:"getZoomDirection",value:function(){return this._zoom_direction}},{key:"resetZoomDirection",value:function(){this._zoom_direction=0}},{key:"getLookAtData",value:function(){return this._lookAtData}},{key:"handleViewportUpdate",value:function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],e=this._viewport,r=e.width,i=e.height;this._viewport_aspect_ratio=r/i;var n=this._viewport.center.x-(r/2|0),o=this._viewport.center.y-(i/2|0);this._center_offset[0]=n,this._center_offset[1]=o,this._center_offset_normalized[0]=n/r,this._center_offset_normalized[1]=o/-i,t||(this._updateMatrices(),this._updateVisibleBounds())}},{key:"setupMatrices",value:function(t,e){mat4.multiply(t.model_view32,this._view_matrix,t.model),e.uniform("Matrix4fv","u_modelView",t.model_view32),mat3.normalFromMat4(t.normal32,t.model_view32),mat3.invert(t.inverse_normal32,t.normal32),e.uniform("Matrix3fv","u_normalMatrix",t.normal32),e.uniform("Matrix3fv","u_inverseNormalMatrix",t.inverse_normal32)}},{key:"_updateMatrices",value:function(){var t=this._viewport.height*Geo$1.metersPerPixel(this._lookAtData.zoom),e=Utils$1.interpolate(this._lookAtData.zoom,this._focal_length);this._lookAtData.distance=t/2*e;var r=this._lookAtData.position[0],i=this._lookAtData.position[1];mat4.lookAt(this._view_matrix,vec3.fromValues(r,i,0),vec3.fromValues(r,i,-1),vec3.fromValues(0,1,0)),this._heading_matrix=mat4.identity(this._heading_matrix);var n=180-this._lookAtData.heading;n*=PI_OVER_180,this._heading_matrix[0]=Math.cos(n),this._heading_matrix[1]=-Math.sin(n),this._heading_matrix[4]=Math.sin(n),this._heading_matrix[5]=Math.cos(n),this._tilt_matrix=mat4.identity(this._tilt_matrix),n=(n=this._lookAtData.tilt?this._lookAtData.tilt*PI_OVER_180:0)>0?-n:n,this._tilt_matrix[5]=Math.cos(n),this._tilt_matrix[6]=Math.sin(n),this._tilt_matrix[9]=-Math.sin(n),this._tilt_matrix[10]=Math.cos(n),mat4.multiply(this._transformation_matrix,this._tilt_matrix,this._heading_matrix),mat4.multiply(this._view_matrix,this._transformation_matrix,this._view_matrix);var o=2*Math.atan(1/e),a=2*this._lookAtData.distance;this._depth_buffer_adjustment=2/Math.log(a/NEAR_PLANE),mat4.perspective(this._projection_matrix,o,this._viewport_aspect_ratio,NEAR_PLANE,a),this._projection_matrix[8]=2*-this._center_offset_normalized[0],this._projection_matrix[9]=2*-this._center_offset_normalized[1],mat4.translate(this._projection_matrix,this._projection_matrix,vec3.fromValues(0,0,-this._lookAtData.distance)),this._camera_matrix=mat4.multiply(this._camera_matrix,this._projection_matrix,this._view_matrix)}},{key:"_updateVisibleBounds",value:function(){var t=this._viewport,e=t.width,r=t.height,i=t.padding,n=degToRad(this._lookAtData.tilt);if(this._horizon=Math.max((i.top+r)/2-Math.cos(n)*(i.top*(1-Math.sin(n))+r*HORIZON_THRESHOLD_MULTIPLIER),0),this._lookAtData.tetragon=[this.screenToWorld([0,this._horizon]),this.screenToWorld([e,this._horizon]),this.screenToWorld([e,r]),this.screenToWorld([0,r])],this._lookAtData.unpadded_bounds=this._clipAgainstGeoBounds(this._lookAtData.tetragon),0===i.left&&0===i.top&&0===i.right&&0===i.bottom)this._lookAtData.bounds=this._lookAtData.unpadded_bounds;else{var o=i.left,a=Math.max(this._horizon,i.top),s=e-i.right,l=r-i.bottom,u=[this.screenToWorld([o,a]),this.screenToWorld([s,a]),this.screenToWorld([s,l]),this.screenToWorld([o,l])];this._lookAtData.bounds=this._clipAgainstGeoBounds(u)}}},{key:"_clipAgainstGeoBounds",value:function(t){var e=_slicedToArray(MathUtils$1.getBBox(t),4),r=e[0],i=e[1],n=e[2],o=e[3],a=Geo$1.half_circumference_meters,s=[[r-1,+a],[n+1,+a],[n+1,-a],[r-1,-a]],l=MathUtils$1.clipPolygon(s,t)[0],u=_slicedToArray(MathUtils$1.getBBox(l),4);if(r=u[0],i=u[1],n=u[2],o=u[3],n-r>=Geo$1.circumference_meters){var c=(n-r)/2;l=[[c-a,o],[c+a,o],[c+a,i],[c-a,i]]}var h=[];return l&&(h=MathUtils$1.splitLegs(l,a)),h}},{key:"applyPxOffset",value:function(t){var e=_slicedToArray(t,2),r=e[0],i=e[1],n=Math.PI-this._lookAtData.heading*PI_OVER_180,o=Geo$1.metersPerPixel(this._lookAtData.zoom);this._lookAtData.position[0]+=(r*Math.cos(n)+i*Math.sin(n))*o,this._lookAtData.position[1]-=(i*Math.cos(n)-r*Math.sin(n))*o,this._lookAtData.position[1]=MathUtils$1.clamp(this._lookAtData.position[1],-Geo$1.half_circumference_meters,Geo$1.half_circumference_meters),this._updateMatrices(),this._updateVisibleBounds()}},{key:"screenToWorld",value:function(t){var e=_slicedToArray(t,2),r=e[0],i=e[1],n=this._viewport,o=n.width,a=n.height;return 0===o||0===a?[0,0]:(r-=o/2,i-=a/2,this._clipCoordsToWorldPlaneCoords([2*(r+o/2)/o-1,1-2*(i+a/2)/a,-1,1]))}},{key:"_clipToScreenCoords",value:function(t){var e=this._viewport,r=e.width,i=e.height;return[(.5*t[0]+.5)*r,i-(.5*t[1]+.5)*i]}},{key:"_isScreenPointInViewPort",value:function(t){var e=this._viewport,r=e.width,i=e.height;return t[0]>=0&&t[0]<=r&&t[1]>=0&&t[1]<=i}},{key:"worldToScreen",value:function(t){var e,r=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(t[2]||(t[2]=0),r){var i=this._worldToClipCoords(t);e=this._clipToScreenCoords(i)}else{var n=Math.sign(this._lookAtData.position[0]),o=Math.trunc(this._lookAtData.position[0]/Geo$1.circumference_meters+n/2);t[0]+=Geo$1.circumference_meters*o;var a=this._worldToClipCoords(t),s=e=this._clipToScreenCoords(a);this._isScreenPointInViewPort(e)||(a=this._worldToClipCoords([t[0]+Geo$1.circumference_meters,t[1],t[2]]),e=this._clipToScreenCoords(a),this._isScreenPointInViewPort(e)||(a=this._worldToClipCoords([t[0]-Geo$1.circumference_meters,t[1],t[2]]),e=this._clipToScreenCoords(a)),this._isScreenPointInViewPort(e)||(e=s))}return e}},{key:"getHorizon",value:function(){return this._horizon}},{key:"_clipCoordsToWorldPlaneCoords",value:function(t){var e=[],r=this._lookAtData.distance,i=this._lookAtData.position,n=[0,0,r,0],o=0,a=r*Math.sin(PI_OVER_180*this._lookAtData.tilt)*Math.cos(PI_OVER_180*this._lookAtData.heading),s=r*Math.sin(PI_OVER_180*this._lookAtData.tilt)*Math.sin(PI_OVER_180*this._lookAtData.heading),l=new Float64Array(16),u=new Float64Array(16);return mat4.invert(l,this._projection_matrix),vec4.transformMat4(e,t,l),e[2]=-1,e[3]=0,mat4.invert(u,this._view_matrix),vec4.transformMat4(e,e,u),vec4.normalize(e,e),vec4.transformMat4(n,n,this._transformation_matrix),0!==e[2]&&(o=-n[2]/e[2]),vec4.scale(e,e,o),[i[0]+(e[0]+s),i[1]+(e[1]+a)]}},{key:"_worldToClipCoords",value:function(t){var e=[t[0],t[1],t[2],1];return vec4.transformMat4(e,e,this._view_matrix),vec4.transformMat4(e,e,this._projection_matrix),vec4.scale(e,e,1/e[3]),e}},{key:"setupProgram",value:function(t){t.uniform("Matrix4fv","u_projection",this._projection_matrix),t.uniform("3f","u_eye",[0,0,this._lookAtData.distance]),t.uniform("2fv","u_center_offset",this._center_offset_normalized),t.uniform("1f","u_tilt",this._lookAtData.tilt*PI_OVER_180),t.uniform("1f","u_heading",this._lookAtData.heading*PI_OVER_180),t.uniform("1f","u_near_plane",NEAR_PLANE),t.uniform("1f","u_depth_buffer_adjustment",this._depth_buffer_adjustment)}},{key:"getTransformationMatrix",value:function(){return this._transformation_matrix}},{key:"getCameraMatrix",value:function(){return this._camera_matrix}},{key:"clone",value:function(){var e=new t(this._viewport,this._lookAtData);return e.setZoomConstraints(this._min_zoom,this._max_zoom),e}},{key:"getViewport",value:function(){return this._viewport}}])}();function getX(t){return void 0===t.x?t[0]:t.x}function getY(t){return void 0===t.y?t[1]:t.y}function xAscendingComparator(t,e){return getX(t)-getX(e)}function yAscendingComparator(t,e){return getY(t)-getY(e)}function sortByX(t){return t.sort(xAscendingComparator)}function sortByY(t){return t.sort(yAscendingComparator)}function getMinMax(t,e){for(var r,i=t[0],n=i,o=0;o<t.length;o+=1)e(r=t[o],i)<0?i=r:e(r,n)>0&&(n=r);return[i,n]}function groupByCoord(t,e){return Object.values(e.reduce((function(e,r){var i=r[+t];return e[i]||(e[i]=[]),e[i].push(r),e}),{}))}function groupByX(t){return groupByCoord(!1,t)}function groupByY(t){return groupByCoord(!0,t)}function createTileRangeByCoord(t,e,r){var i=+t,n=e[i],o=r[i];if(n>o)return[];var a=[e];if(n>o)return a;for(var s=e[(i+1)%2],l=t?function(t){return a.push([s,t])}:function(t){return a.push([t,s])},u=n+1;u<o;u+=1)l(u);return a.push(r),a}function createTileRangeByX(t,e){return createTileRangeByCoord(!1,t,e)}function createTileRangeByY(t,e){return createTileRangeByCoord(!0,t,e)}function deduplicate(t){var e={},r=[];return t.forEach((function(t){var i=t.key||(Array.isArray(t)?"".concat(t[0],"/").concat(t[1]):"".concat(t.x,"/").concat(t.y));e[i]||(e[i]=!0,r.push(t))})),r}function flat(t){return t.reduce((function(t,e){return t.concat(e)}))}function applyMargin(t,e){if(e<=0)return t;var r=function(t){var r=_slicedToArray(getMinMax(t,xAscendingComparator),2),i=r[0],n=r[1],o=[i[0]-e,i[1]],a=[n[0]+e,n[1]];return t.concat(createTileRangeByX(o,i),createTileRangeByX(n,a))};return deduplicate(function(t){return flat(t.map(r))}(groupByY(flat(groupByX(t).map((function(t){var r=_slicedToArray(getMinMax(t,yAscendingComparator),2),i=r[0],n=r[1],o=[i[0],i[1]-e],a=[n[0],n[1]+e];return t.concat(createTileRangeByY(o,i),createTileRangeByY(n,a))}))))))}function constructTiles(t,e,r){return t.map((function(t){var i=_slicedToArray(t,2),n=i[0],o=i[1];return Tile.coord(Geo$1.wrapTile({x:n,y:o,z:e},{x:!r,y:!0}))}))}function getTileGrid(t,e,r){var i=function(e){return Object.values(Geo$1.metersToExactTileCoords(e,t.tile_level))};return deduplicate(constructTiles(applyMargin(rasterizeTetragon(i(t.tetragon[0]),i(t.tetragon[1]),i(t.tetragon[3]),i(t.tetragon[2])),e),t.tile_level,r))}function rasterizeTetragon(t,e,r,i){var n=rasterizeTriangle(e,t,r),o=rasterizeTriangle(r,i,e);return deduplicate(n.concat(o))}function rasterizeTriangle(t,e,r){var i=_slicedToArray(sliceTriangle.apply(void 0,_toConsumableArray(sortByY([t,e,r]))),2),n=i[0],o=i[1];return deduplicate(rasterizeBottomFlatTriangle.apply(void 0,_toConsumableArray(n)).concat(rasterizeTopFlatTriangle.apply(void 0,_toConsumableArray(o))))}function sliceTriangle(t,e,r){var i=_slicedToArray(t,2),n=i[0],o=i[1],a=_slicedToArray(e,2),s=a[0],l=a[1],u=_slicedToArray(r,2),c=u[0],h=u[1],p=n+(l-o)/(h-o)*(c-n);return[[[n,o]].concat(_toConsumableArray(sortByX([[s,l],[p,l]]))),[].concat(_toConsumableArray(sortByX([[s,l],[p,l]])),[[c,h]])]}function rasterizeBottomFlatTriangle(t,e,r){var i=_slicedToArray(t,2),n=i[0],o=i[1],a=_slicedToArray(e,2),s=a[0],l=a[1];return scanFlatTriangle(n,s,_slicedToArray(r,1)[0],o,l)}function rasterizeTopFlatTriangle(t,e,r){var i=_slicedToArray(t,2),n=i[0],o=i[1],a=_slicedToArray(e,1)[0],s=_slicedToArray(r,2);return scanFlatTriangle(s[0],n,a,s[1],o)}var scanStepStatic=.125;function getScanStep(t,e){return scanStepStatic*(e-t)/(Math.ceil(e)-Math.floor(t))}function scanFlatTriangle(t,e,r,i,n){var o=Math.min(t,e),a=Math.max(t,r),s=Math.min(i,n),l=Math.max(i,n);if(Math.floor(i)===Math.floor(n))return scanRow(o,a,i);if(l-s<scanStepStatic)return scanRectangle([o,s],[a,l]);var u=getScanStep(s,l),c=(l-s)/u,h=(e-t)/c,p=(r-t)/c,f=[],d=t,y=t,g=function(t){f=f.concat(scanRow(d,y,Math.floor(t))),d+=h,y+=p};if(i<n)for(var v=s;v<=l;v+=u)g(v);else for(var m=l;m>=s;m-=u)g(m);return deduplicate(f)}function xCoordsToPoints(t,e){return t.map((function(t){return[t,e]}))}function createCoordRange(t,e){var r=Math.floor(t),i=Math.floor(e);if(r>i)return[];if(r===i)return[r];for(var n=[],o=r;o<=i;o+=1)n.push(o);return n}function scanRow(t,e,r){return xCoordsToPoints(createCoordRange(t,e),r)}function scanRectangle(t,e){var r=_slicedToArray(t,2),i=r[0],n=r[1],o=_slicedToArray(e,2),a=o[0],s=o[1],l=createCoordRange(i,a),u=xCoordsToPoints(l,n),c=xCoordsToPoints(l,s);return u.concat(c)}var VIEW_PAN_SNAP_TIME=.5,Z_PRECISION=1e5,View=function(){function t(e,r){_classCallCheck(this,t),subscribeMixin(this),this.scene=e,this.createMatrices(),this.bounds=null,this.center_tile=null,this.panning=!1,this.panning_stop_at=0,this.pan_snap_timer=0,this.user_input_at=0,this.user_input_timeout=50,this.user_input_active=!1,this.size={},this.buffer=0,this.wrap=!1!==r.wrapView,this.preserve_tiles_within_zoom=1,this.lookAtManipulator=new LookAtManipulator(r.viewport),this._viewport=r.viewport,this._offset_buffer=[0,0],this.handleViewportUpdate(!0)}return _createClass(t,[{key:"update",value:function(){this.pan_snap_timer=(+new Date-this.panning_stop_at)/1e3,this.user_input_active=+new Date-this.user_input_at<this.user_input_timeout,this.scene.tile_manager.updateTilesVisibilityCounters()}},{key:"handleViewportUpdate",value:function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],e=this._viewport,r=e.width,i=e.height;this.size.css={width:r,height:i},this.size.device={width:Math.round(r*Utils$1.device_pixel_ratio),height:Math.round(i*Utils$1.device_pixel_ratio)},this.lookAtManipulator.handleViewportUpdate(),t||this.updateBounds()}},{key:"setLookAtData",value:function(e,r){t._setLookAtDataForManipulator(this.lookAtManipulator,e,r),this.updateBounds()}},{key:"getLookAtData",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return t._getLookAtDataFromManipulator(this.lookAtManipulator,e)}},{key:"getBestLookAtData",value:function(e,r){var i=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=this.lookAtManipulator.clone();return t._setLookAtDataForManipulator(n,e,r),t._getLookAtDataFromManipulator(n,i)}},{key:"getTileLevel",value:function(){return this.lookAtManipulator.getLookAtData().tile_level}},{key:"applyPxOffset",value:function(t){var e=this._offset_buffer;e[0]+=t[0],e[1]+=t[1];var r=Math.abs(e[0]),i=Math.abs(e[1]);if(r>=1||i>=1){var n=~~e[0],o=~~e[1];this.lookAtManipulator.applyPxOffset([r<1?0:n,i<1?0:o]),r>=1&&(e[0]-=n),i>=1&&(e[1]-=o),this.updateBounds()}}},{key:"setPanning",value:function(t){this.panning=t,this.panning||(this.panning_stop_at=+new Date)}},{key:"markUserInput",value:function(){this.user_input_at=+new Date}},{key:"ready",value:function(){return"number"==typeof this.size.css.width&&"number"==typeof this.size.css.height}},{key:"updateBounds",value:function(){if(this.markUserInput(),this.ready()){this.center_tile=Geo$1.tileForMeters(this.lookAtManipulator.getLookAtData().position,this.lookAtManipulator.getLookAtData().tile_level);var t=this.lookAtManipulator.screenToWorld([0,this.size.css.height]),e=this.lookAtManipulator.screenToWorld([this.size.css.width,0]);this.bounds={sw:{x:t[0],y:t[1]},ne:{x:e[0],y:e[1]}},this.scene.tile_manager.updateTilesForView(!0),this.trigger("move"),this.scene.requestRedraw()}}},{key:"getTileGridFlatForBBox",value:function(t,e,r,i){var n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,o=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],a=this.lookAtManipulator.getLookAtData().tile_level,s=Geo$1.tileForMeters([e,t],a),l=Geo$1.tileForMeters([i,r],a);if(s.x-=n,s.y-=n,l.x+=n,l.y+=n,!1===o){var u=(1<<a)-1;s.x=Math.min(Math.max(0,s.x),u),s.y=Math.min(Math.max(0,s.y),u),l.x=Math.min(Math.max(0,l.x),u),l.y=Math.min(Math.max(0,l.y),u)}for(var c=[],h={},p=s.x;p<=l.x;p++)for(var f=s.y;f<=l.y;f++){var d=Tile.coord(Geo$1.wrapTile({x:p,y:f,z:a},{x:!o,y:!0}));h[d.key]||(h[d.key]=!0,c.push(d))}return c}},{key:"getTileGridFlat",value:function(){return this.getTileGridFlatForBBox(this.bounds.ne.y,this.bounds.sw.x,this.bounds.sw.y,this.bounds.ne.x,this.buffer,this.wrap)}},{key:"getTileGridDistorted",value:function(){return getTileGrid(this.lookAtManipulator.getLookAtData(),this.buffer,this.wrap)}},{key:"findVisibleTileCoordinates",value:function(){if(!this.bounds)return[];var t=this.lookAtManipulator.getLookAtData(),e=t.tilt,r=t.heading;return 0===e&&180===r?this.getTileGridFlat():this.getTileGridDistorted()}},{key:"createMatrices",value:function(){this.matrices={},this.matrices.model=new Float64Array(16),this.matrices.model32=new Float32Array(16),this.matrices.model_view=new Float64Array(16),this.matrices.model_view32=new Float32Array(16),this.matrices.normal=new Float64Array(9),this.matrices.normal32=new Float32Array(9),this.matrices.inverse_normal32=new Float32Array(9)}},{key:"setupTile",value:function(t,e){t.setupProgram(this.matrices,e),this.lookAtManipulator.setupMatrices(this.matrices,e)}},{key:"setupProgram",value:function(t){var e=this.lookAtManipulator.getLookAtData();t.uniform("2fv","u_resolution",[this.size.device.width,this.size.device.height]),t.uniform("3fv","u_map_position",[e.position[0],e.position[1],Math.trunc(e.zoom*Z_PRECISION)/Z_PRECISION]),t.uniform("1f","u_meters_per_pixel",Geo$1.metersPerPixel(e.zoom)),t.uniform("1f","u_device_pixel_ratio",Utils$1.device_pixel_ratio),t.uniform("1f","u_view_pan_snap_timer",this.pan_snap_timer),t.uniform("1i","u_view_panning",this.panning),t.uniform("1f","u_horizon",this.lookAtManipulator.getHorizon()/(this.size.css.height/2)),this.lookAtManipulator.setupProgram(t)}},{key:"isAnimating",value:function(){return this.pan_snap_timer<=VIEW_PAN_SNAP_TIME}},{key:"xyToGeo",value:function(t,e){var r=this.lookAtManipulator.screenToWorld([t,e]),i=_slicedToArray(Geo$1.metersToLatLng(r),2),n=i[0];return{lat:i[1],lng:n}}},{key:"geoToPixel",value:function(t){var e=Geo$1.latLngToMeters([t.lng,t.lat]);e.push(t.alt||0);var r=this.lookAtManipulator.worldToScreen(e);return{x:Math.floor(r[0]),y:Math.floor(r[1])}}},{key:"geoToMeters",value:function(t){var e=_slicedToArray(Geo$1.latLngToMeters([t.lng,t.lat]),2);return{x:e[0],y:e[1],z:t.alt||0}}},{key:"metersToGeo",value:function(t){var e=_slicedToArray(Geo$1.metersToLatLng([t.x,t.y]),2),r=e[0];return{lat:e[1],lng:r,alt:t.z||0}}},{key:"setZoomConstraints",value:function(t,e){this.lookAtManipulator.setZoomConstraints(t,e)}}],[{key:"_setLookAtDataForManipulator",value:function(t,e,r){var i=e.position,n=e.zoom,o=e.tilt,a=e.heading,s=e.bounds,l={zoom:n,tilt:o,heading:a};if(i&&"number"==typeof i.lng&&"number"==typeof i.lat&&(l.position=Geo$1.latLngToMeters([i.lng,i.lat])),s){var u=s.getExterior().getLatLngAltArray(),c=u.length/3,h=Array(c);if(s.getBoundingBox().isCDB())for(var p=u[1],f=0,d=0;d<c;d++){var y=u[3*d+1];if(d>0){var g=y-p;Math.abs(g)>180&&(f+=y>p?-360:360)}p=y,h[d]=Geo$1.latLngToMeters([y+f,u[3*d]])}else for(var v=0;v<c;v++)h[v]=Geo$1.latLngToMeters([u[3*v+1],u[3*v]]);l.bounds=h}t.setLookAtData(l,r)}},{key:"_getLookAtDataFromManipulator",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=t.getLookAtData(),i=r.heading,n=r.incline,o=r.tilt,a=r.zoom,s=r.position,l=r.bounds,u=r.unpadded_bounds,c=_slicedToArray(Geo$1.metersToLatLng(s),2),h=c[0],p=c[1],f=new H.geo.LineString;return(e?u:l).forEach((function(t){var e=Geo$1.metersToLatLng(t);f.pushLatLngAlt(e[1],e[0],0)})),{heading:i,incline:n,tilt:o,zoom:a,bounds:new H.geo.Polygon(f),position:{lat:p,lng:h,alt:s[2]}}}}])}(),shaderSrc_pointsVertex="uniform vec2 u_resolution;uniform vec3 u_map_position;uniform vec4 u_tile_origin;uniform float u_tile_proxy_depth;uniform bool u_tile_fade_in;uniform float u_meters_per_pixel;uniform float u_device_pixel_ratio;uniform float u_visible_time;uniform bool u_view_panning;uniform float u_tilt;uniform mat4 u_model;uniform mat4 u_modelView;uniform mat3 u_normalMatrix;uniform mat3 u_inverseNormalMatrix;uniform float u_heading;uniform float u_near_plane;uniform float u_depth_buffer_adjustment;attribute vec4 a_position;attribute vec4 a_shape;attribute vec4 a_color;attribute vec2 a_texcoord;attribute vec2 a_offset;uniform float u_point_type;attribute float a_is_flat;\n#ifdef TANGRAM_IS_TEXT_STYLE\nattribute vec4 a_offsets_alt;attribute vec4 a_pre_angles_alt;attribute vec4 a_angles_alt;attribute vec4 a_offsets;attribute vec4 a_pre_angles;attribute vec4 a_angles;\n#endif\n#ifdef TANGRAM_POINT_DRAW_STICK\nattribute float a_is_stick;attribute float a_stick_height;varying float v_is_stick;\n#endif\nvarying vec4 v_color;varying vec2 v_texcoord;varying vec4 v_world_position;varying float v_alpha_factor;\n#ifdef TANGRAM_HAS_SHADER_POINTS\nattribute float a_outline_edge;attribute vec4 a_outline_color;varying float v_outline_edge;varying vec4 v_outline_color;varying float v_aa_offset;\n#endif\n#ifdef TANGRAM_SHOW_HIDDEN_LABELS\nvarying float v_label_hidden;\n#endif\n#define PI 3.14159265359\n#define TANGRAM_NORMAL vec3(0., 0., 1.)\n#pragma tangram: camera\n#pragma tangram: material\n#pragma tangram: lighting\n#pragma tangram: raster\n#pragma tangram: global\nvec2 rotate2D(vec2 _st,float _angle){return mat2(cos(_angle),-sin(_angle),sin(_angle),cos(_angle))*_st;}vec3 rotateX3D(vec3 _st,float _angle){return mat3(1.,0.,0.,0.,cos(_angle),sin(_angle),0.,-sin(_angle),cos(_angle))*_st;}vec3 rotateZ3D(vec3 _st,float _angle){return mat3(cos(_angle),sin(_angle),0.,-sin(_angle),cos(_angle),0.,0.,0.,1.)*_st;}\n#ifdef TANGRAM_IS_TEXT_STYLE\nfloat mix4linear(float a,float b,float c,float d,float x){return mix(mix(a,b,3.*x),mix(b,mix(c,d,3.*(max(x,.66)-.66)),3.*(clamp(x,.33,.66)-.33)),step(0.33,x));}\n#endif\nvoid main(){\n#pragma tangram: setup\n#ifndef TANGRAM_SHOW_HIDDEN_LABELS\nif(a_shape.w==0.){gl_Position=vec4(0.,0.,0.,1.);return;}\n#else\nif(a_shape.w==0.){v_label_hidden=1.;}else{v_label_hidden=0.;}\n#endif\nv_alpha_factor=1.0;v_color=a_color;v_texcoord=a_texcoord;\n#ifdef TANGRAM_HAS_SHADER_POINTS\nv_outline_color=a_outline_color;v_outline_edge=a_outline_edge;if(u_point_type==TANGRAM_POINT_TYPE_SHADER){v_outline_color=a_outline_color;v_outline_edge=a_outline_edge;float size=abs(a_shape.x/128.);v_texcoord=sign(a_shape.xy)*(size+1.0)/size;size+=2.0;v_aa_offset=2.0/size;}\n#endif\nvec4 position=u_modelView*vec4(a_position.xyz,1.);vec4 shape=vec4(a_shape.xy,0.,0.);vec2 offset=vec2(a_offset.x,-a_offset.y);\n#ifdef TANGRAM_POINT_DRAW_STICK\nv_is_stick=a_is_stick;float scaled_stick_height=(sin(u_tilt+(1.5*PI))+1.0)*a_stick_height;offset.y+=(1.0-a_is_stick)*scaled_stick_height;\n#endif\nfloat zoom=clamp(u_map_position.z-u_tile_origin.z,0.,1.);float theta=a_shape.z/4096.;float heading=u_heading;float delta=(heading-PI);float new_theta=theta-delta;float reversed=abs(new_theta)>PI/2. ? 1. : 0.;if(a_is_flat==1.0){\n#ifdef TANGRAM_IS_TEXT_STYLE\nif(a_offsets[0]!=0.){vec4 angles_scaled;vec4 pre_angles_scaled;vec4 offsets_scaled;if(reversed==1.){offsets_scaled=a_offsets_alt*4.;angles_scaled=(PI/16384.)*a_angles_alt;pre_angles_scaled=(PI/128.)*a_pre_angles_alt;}else{offsets_scaled=a_offsets*4.;angles_scaled=(PI/16384.)*a_angles;pre_angles_scaled=(PI/128.)*a_pre_angles;}float pre_angle=mix4linear(pre_angles_scaled[0],pre_angles_scaled[1],pre_angles_scaled[2],pre_angles_scaled[3],zoom);float angle=mix4linear(angles_scaled[0],angles_scaled[1],angles_scaled[2],angles_scaled[3],zoom);float offset_curve=mix4linear(offsets_scaled[0],offsets_scaled[1],offsets_scaled[2],offsets_scaled[3],zoom);shape.xy=rotate2D(shape.xy,pre_angle+PI*reversed);shape.x+=offset_curve;shape.xy=rotate2D(shape.xy,angle);shape.xy+=rotate2D(offset,theta);}else{shape.xy=rotate2D(shape.xy+offset*256.,theta+(PI*reversed));}\n#else\nshape.xy=rotate2D(shape.xy+offset*256.,theta);\n#endif\nshape.xy/=pow(2.,4.+(u_map_position.z-u_tile_origin.w));shape=u_modelView*shape;position+=shape;}else{shape.xy/=256.;\n#ifdef TANGRAM_POINT_DRAW_STICK\nshape.y*=1.0+(scaled_stick_height-1.0)*a_is_stick;\n#endif\nshape.xy=rotate2D(shape.xy+offset,theta);}\n#ifdef TANGRAM_FADE_IN_RATE\nif(u_tile_fade_in){v_alpha_factor*=clamp(u_visible_time*TANGRAM_FADE_IN_RATE,0.,1.);}\n#endif\n#ifdef TANGRAM_FADE_ON_ZOOM_OUT\nv_alpha_factor*=clamp(1.+TANGRAM_FADE_ON_ZOOM_OUT_RATE*(u_map_position.z-u_tile_origin.z),0.,1.);\n#endif\nv_world_position=u_model*position;v_world_position.xy+=shape.xy*u_meters_per_pixel;v_world_position=wrapWorldPosition(v_world_position);\n#pragma tangram: position\ncameraProjection(position);\n#ifdef TANGRAM_LAYER_ORDER\napplyLayerOrder(a_position.w+u_tile_proxy_depth+1.,position);/***Due to the precision loss on depth buffer,we had a z-fighting of translucent points when the distance to the camera was big.*For more information about the problem see: https:*For more information about the fix see: https:*position.z=(2.0*log(position.w/u_near_plane)/log(u_far_plane/u_near_plane)-1.0)*position.w;*/position.z=(log(position.w/u_near_plane)*u_depth_buffer_adjustment-1.0)*position.w;\n#endif\nif(a_is_flat!=1.){position.xy+=shape.xy*position.w*2.*u_device_pixel_ratio/u_resolution;}\n#ifdef TANGRAM_HAS_SHADER_POINTS\nif(u_point_type==TANGRAM_POINT_TYPE_SHADER){position.xy+=sign(shape.xy)*position.w*u_device_pixel_ratio/u_resolution;}\n#endif\nif(!u_view_panning){snapToPixelGrid(position);}gl_Position=position;}",shaderSrc_pointsFragment="uniform vec2 u_resolution;uniform vec3 u_map_position;uniform vec4 u_tile_origin;uniform float u_meters_per_pixel;uniform float u_device_pixel_ratio;uniform float u_visible_time;uniform mat3 u_normalMatrix;uniform mat3 u_inverseNormalMatrix;uniform sampler2D u_texture;uniform float u_point_type;uniform bool u_apply_color_blocks;varying vec4 v_color;varying vec2 v_texcoord;varying vec4 v_world_position;varying float v_alpha_factor;\n#ifdef TANGRAM_HAS_SHADER_POINTS\nvarying vec4 v_outline_color;varying float v_outline_edge;varying float v_aa_offset;\n#endif\n#ifdef TANGRAM_SHOW_HIDDEN_LABELS\nvarying float v_label_hidden;\n#endif\n#ifdef TANGRAM_POINT_DRAW_STICK\nvarying float v_is_stick;\n#endif\n#define TANGRAM_NORMAL vec3(0., 0., 1.)\n#pragma tangram: camera\n#pragma tangram: material\n#pragma tangram: lighting\n#pragma tangram: raster\n#pragma tangram: global\n#ifdef TANGRAM_HAS_SHADER_POINTS\nfloat _tangram_antialias(float l,float R){float low=R-v_aa_offset;float high=R+v_aa_offset;return 1.-smoothstep(low,high,l);}\n#endif\nvoid mixTextureColor(inout vec4 color){\n#ifdef TANGRAM_HAS_SHADER_POINTS\nif(u_point_type==TANGRAM_POINT_TYPE_TEXTURE){color*=texture2D(u_texture,v_texcoord);}else if(u_point_type==TANGRAM_POINT_TYPE_LABEL){color=texture2D(u_texture,v_texcoord);color.rgb/=max(color.a,0.001);}else if(u_point_type==TANGRAM_POINT_TYPE_SHADER){float outline_edge=v_outline_edge;vec4 outlineColor=v_outline_color;float l=length(v_texcoord);float outer_alpha=_tangram_antialias(l,1.);float fill_alpha=_tangram_antialias(l,1.-v_outline_edge*0.5)*color.a;float stroke_alpha=(outer_alpha-_tangram_antialias(l,1.-v_outline_edge))*outlineColor.a;\n#ifdef TANGRAM_BLEND_ADD\ncolor.a=stroke_alpha+fill_alpha;color.rgb=color.rgb*fill_alpha+outlineColor.rgb*stroke_alpha;\n#else\ncolor.a=stroke_alpha+fill_alpha*(1.-stroke_alpha);color.rgb=mix(color.rgb*fill_alpha,outlineColor.rgb,stroke_alpha)/max(color.a,0.001);\n#endif\n}\n#else\ncolor=texture2D(u_texture,v_texcoord);color.rgb/=max(color.a,0.001);\n#endif\nif(u_apply_color_blocks){\n#pragma tangram: color\n#pragma tangram: filter\n}color.a*=v_alpha_factor;\n#ifdef TANGRAM_SHOW_HIDDEN_LABELS\nif(v_label_hidden>0.){color.a*=0.5;color.rgb=vec3(1.,0.,0.);}\n#endif\n#if !defined(TANGRAM_BLEND_OVERLAY) && !defined(TANGRAM_BLEND_INLAY) && !defined(TANGRAM_BLEND_ADD)\nif(color.a<TANGRAM_ALPHA_TEST){discard;}\n#endif\n}void main(void){\n#pragma tangram: setup\nvec4 color=v_color;\n#ifdef TANGRAM_POINT_DRAW_STICK\nif(v_is_stick==0.0){mixTextureColor(color);}\n#else\nmixTextureColor(color);\n#endif\ngl_FragColor=color;}",PLACEMENT=LabelPoint.PLACEMENT,pre_angles_normalize=128/Math.PI,angles_normalize=16384/Math.PI,offsets_normalize=64,texcoord_normalize=65535,Points=Object.create(Style),TANGRAM_POINT_TYPE_TEXTURE=1,TANGRAM_POINT_TYPE_LABEL=2,TANGRAM_POINT_TYPE_SHADER=3,DEFAULT_POINT_SIZE=16;Object.assign(Points,TextLabels),Object.assign(Points,{name:"points",built_in:!0,vertex_shader_src:shaderSrc_pointsVertex,fragment_shader_src:shaderSrc_pointsFragment,selection:!0,collision:!0,blend:"overlay",init:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};Style.init.call(this,t),this.setupDefines(),this.defines.TANGRAM_HAS_SHADER_POINTS=!0,this.defines.TANGRAM_POINT_TYPE_TEXTURE=TANGRAM_POINT_TYPE_TEXTURE,this.defines.TANGRAM_POINT_TYPE_LABEL=TANGRAM_POINT_TYPE_LABEL,this.defines.TANGRAM_POINT_TYPE_SHADER=TANGRAM_POINT_TYPE_SHADER,this.defines.TANGRAM_POINT_DRAW_STICK=!!this.stick,this.collision_group_points=this.name+"-points",this.collision_group_text=this.name+"-text",this.reset()},setupDefines:function(){"overlay"!==this.blend&&(this.defines.TANGRAM_LAYER_ORDER=!0),this.defines.TANGRAM_FADE_ON_ZOOM_OUT=!0,this.defines.TANGRAM_FADE_ON_ZOOM_OUT_RATE=2,debugSettings$1.suppress_label_fade_in||this.suppress_fade?(this.fade_in_time=0,this.defines.TANGRAM_FADE_IN_RATE=null):(this.fade_in_time=.15,this.defines.TANGRAM_FADE_IN_RATE=1/this.fade_in_time),debugSettings$1.suppress_snap_animation||(this.defines.TANGRAM_VIEW_PAN_SNAP_RATE=1/VIEW_PAN_SNAP_TIME),debugSettings$1.show_hidden_labels&&(this.defines.TANGRAM_SHOW_HIDDEN_LABELS=!0)},reset:function(){this.queues={},this.resetText(),this.texture_missing_sprites={}},addFeature:function(t,e,r){var i=r.tile,n={};if(n.color=this.parseColor(e.color,r),n.texture=e.texture,n.label_texture=null,n.color||n.texture){var o;if(this.hasSprites(n)){if(!(o=this.parseSprite(n,e,r)))return;n.texcoords=o.texcoords}if(n.size=e.size,n.size){if(n.size=StyleParser.evalCachedPointSizeProperty(e.size,o,r),null==n.size)return void log({level:"warn",once:!0},"Layer '".concat(e.layers[e.layers.length-1],"': ")+"'size' includes % and/or ratio-based scaling (".concat(JSON.stringify(e.size.value),"); ")+"these can only applied to sprites, but no sprite was specified, skipping features in layer");"number"==typeof n.size&&(n.size=[n.size,n.size])}else n.size=o&&o.css_size||[DEFAULT_POINT_SIZE,DEFAULT_POINT_SIZE];if(e.outline&&(n.outline_width=StyleParser.evalCachedProperty(e.outline.width,r)||StyleParser.defaults.outline.width,n.outline_color=this.parseColor(e.outline.color,r)),n.outline_edge_pct=0,n.outline_width&&n.outline_color){var a=n.outline_width;n.size[0]+=a,n.size[1]+=a,n.outline_edge_pct=a/Math.min(n.size[0],n.size[1])*2}if(n.size[0]=Math.min(n.size[0],256),n.size[1]=Math.min(n.size[1],256),n.placement=e.placement,n.placement_min_length_ratio=StyleParser.evalCachedProperty(e.placement_min_length_ratio,r),n.placement===PLACEMENT.SPACED&&e.placement_spacing&&(n.placement_spacing=StyleParser.evalCachedProperty(e.placement_spacing,r)),n.angle=StyleParser.evalProperty(e.angle,r)||0,n.elevate_by_altitude=!!e.elevate_by_altitude,n.z=e.z?MathUtils$1.clamp(StyleParser.evalCachedDistanceProperty(e.z,r),0,32767):StyleParser.defaults.z,n.flat=e.flat,n.tile_edges=e.tile_edges,this.computeLayout(n,t,e,r,i),e.stick&&!n.flat){var s=StyleParser.parseNumber(StyleParser.evalProperty(e.stick.height,r));n.stick={color:this.parseColor(e.stick.color,r)||StyleParser.defaults.color,height:s?Math.max(s,0):0}}var l=e.text&&!1!==StyleParser.evalProperty(e.text.visible,r)&&this.parseTextFeature(t,e.text,r,i);Array.isArray(l)&&(l=null,log({level:"warn",once:!0},"Layer '".concat(e.layers[e.layers.length-1],"': ")+"cannot use boundary labels (e.g. 'text_source: { left: ..., right: ... }') for 'text' labels attached to 'points'; "+"provided 'text_source' value was ".concat(JSON.stringify(e.text.text_source)))),l&&(l.layout.parent=n,l.layout.priority=e.text.priority?Math.max(l.layout.priority,n.priority+.5):n.priority+.5,l.layout.move_into_tile=!1,Collision.addStyle(this.collision_group_text,i.id)),this.queueFeature({feature:t,draw:e,context:r,style:n,text_feature:l},i),Collision.addStyle(this.collision_group_points,i.id)}},hasSprites:function(t){return t.texture&&this.textureManager.textures[t.texture]&&this.textureManager.textures[t.texture].sprites},getSpriteInfo:function(t,e){var r=this.textureManager.textures[t.texture].sprites[e]&&this.textureManager.getSpriteInfo(t.texture,e);return e&&!r?(this.texture_missing_sprites[t.texture]=this.texture_missing_sprites[t.texture]||{},this.texture_missing_sprites[t.texture][e]||(log("debug","Style: in style '".concat(this.name,"', could not find sprite '").concat(e,"' for texture '").concat(t.texture,"'")),this.texture_missing_sprites[t.texture][e]=!0)):r&&(r.sprite=e),r},parseSprite:function(t,e,r){var i=StyleParser.evalProperty(e.sprite,r);return this.getSpriteInfo(t,i)||this.getSpriteInfo(t,e.sprite_default)},queueFeature:function(t,e){this.tile_data[e.id]&&this.queues[e.id]||this.startData(e),this.queues[e.id]=this.queues[e.id]||[],this.queues[e.id].push(t)},endData:function(t){var e=this;if(t.canceled)return log("trace","Style ".concat(this.name,": stop tile build because tile was canceled: ").concat(t.key)),Promise.resolve();var r=this.queues[t.id];delete this.queues[t.id];var i=[],n=[];return r.forEach((function(t){for(var r=t.style,o=t.feature,a=o.geometry,s=e.buildLabels(r.size,a,r),l=0;l<s.length;l++){var u=s[l],c={feature:o,draw:t.draw,context:t.context,style:r,label:u};if(n.push(c),t.text_feature){var h={feature:o,draw:t.text_feature.draw,context:t.context,text:t.text_feature.text,text_settings_key:t.text_feature.text_settings_key,layout:t.text_feature.layout,point_label:u,linked:c};i.push(h),t.draw.text.optional||(c.linked=h)}}})),Promise.all([Collision.collide(n,this.collision_group_points,t.id).then((function(t){t.forEach((function(t){e.feature_style=t.style,e.feature_style.label=t.label,e.feature_style.linked=t.linked,Style.addFeature.call(e,t.feature,t.draw,t.context)}))})),this.collideAndRenderTextLabels(t,this.collision_group_text,i)]).then((function(r){var i=_slicedToArray(r,2)[1],n=i.labels,o=i.texts;return n&&o&&n.forEach((function(t){var r=t.text_settings_key,i=o[r]&&o[r][t.text],n=e.feature_style;n.label=t.label,n.linked=t.linked,n.size=i.size.logical_size,n.angle=0,t.label.text_data={text_info:i,text_settings_key:r,text:t.text},n.label_texture=e.textureManager.default,Style.addFeature.call(e,t.feature,t.draw,t.context)})),e.freeText(t),Style.endData.call(e,t)}))},_preprocess:function(t){t.color=StyleParser.createColorPropertyCache(t.color),t.texture=void 0!==t.texture?t.texture:this.texture,t.outline&&(t.outline.color=StyleParser.createColorPropertyCache(t.outline.color),t.outline.width=StyleParser.createPropertyCache(t.outline.width,StyleParser.parsePositiveNumber)),t.z=StyleParser.createPropertyCache(t.z,StyleParser.parseUnits);try{t.size=StyleParser.createPointSizePropertyCache(t.size)}catch(e){return log({level:"warn",once:!0},"Layer '".concat(t.layers[t.layers.length-1],"': ")+"".concat(e," (").concat(JSON.stringify(t.size),"), skipping features in layer")),null}return t.offset=StyleParser.createPropertyCache(t.offset,(function(t){return Array.isArray(t)&&t.map(StyleParser.parseNumber)})),t.buffer=StyleParser.createPropertyCache(t.buffer,(function(t){return(Array.isArray(t)?t:[t,t]).map(StyleParser.parsePositiveNumber)})),t.repeat_distance=StyleParser.createPropertyCache(t.repeat_distance,StyleParser.parseNumber),null==t.repeat_group&&(t.repeat_group=t.layers.join("-")),t.placement=PLACEMENT[t.placement&&t.placement.toUpperCase()],null==t.placement&&(t.placement=PLACEMENT.VERTEX),t.placement_spacing=null!=t.placement_spacing?t.placement_spacing:80,t.placement_spacing=StyleParser.createPropertyCache(t.placement_spacing,StyleParser.parsePositiveNumber),t.placement_min_length_ratio=null!=t.placement_min_length_ratio?t.placement_min_length_ratio:1,t.placement_min_length_ratio=StyleParser.createPropertyCache(t.placement_min_length_ratio,StyleParser.parsePositiveNumber),"number"==typeof t.angle?t.angle=t.angle*Math.PI/180:t.angle=t.angle||0,t.text=this.preprocessText(t.text),t.text&&(t.text.variantKey=t.variantKey,t.text.group=t.group,t.text.layers=t.layers,t.text.order=t.order,t.text.repeat_group=t.text.repeat_group||t.repeat_group,t.text.anchor=t.text.anchor||this.default_anchor,t.text.optional="boolean"==typeof t.text.optional&&t.text.optional,t.text.interactive=t.text.interactive||t.interactive),t.stick&&(t.stick.color=StyleParser.createColorPropertyCache(t.stick.color)),t},default_anchor:["bottom","top","right","left"],computeLayout:function(t,e,r,i,n){var o=t||{};o.id=e,o.units_per_pixel=n.units_per_pixel||1,o.collide=!1!==r.collide,o.anchor=r.anchor,o.offset=StyleParser.evalCachedProperty(r.offset,i)||StyleParser.zeroPair,o.buffer=StyleParser.evalCachedProperty(r.buffer,i)||StyleParser.zeroPair,o.repeat_distance=StyleParser.evalCachedProperty(r.repeat_distance,i),o.repeat_distance&&(o.repeat_distance*=o.units_per_pixel,o.repeat_scale=1,"function"==typeof r.repeat_group?o.repeat_group=r.repeat_group(i):o.repeat_group=r.repeat_group);var a=r.priority;return null!=a?"function"==typeof a&&(a=a(i)):a=-1>>>0,o.priority=a,o},buildTextLabels:function(t,e){for(var r=[],i=0;i<e.length;i++){var n=e[i],o=this.texts[t.id][n.text_settings_key][n.text].size.collision_size;n.label=new LabelPoint(n.point_label.position,o,n.point_label.isFlat(),n.layout),r.push(n)}return r},buildLabels:function(t,e,r){var i=!!r.flat,n=[];if("Point"===e.type)n.push(new LabelPoint(e.coordinates,t,i,r));else if("MultiPoint"===e.type)for(var o=e.coordinates,a=0;a<o.length;++a){var s=o[a];n.push(new LabelPoint(s,t,i,r))}else if("LineString"===e.type)for(var l=placePointsOnLine(e.coordinates,t,i,r),u=0;u<l.length;++u)n.push(l[u]);else if("MultiLineString"===e.type)for(var c=e.coordinates,h=0;h<c.length;h++)for(var p=placePointsOnLine(c[h],t,i,r),f=0;f<p.length;++f)n.push(p[f]);else if("Polygon"===e.type)if(r.placement===PLACEMENT.CENTROID){var d=Geo$1.centroid(e.coordinates);n.push(new LabelPoint(d,t,i,r))}else for(var y=e.coordinates,g=0;g<y.length;g++)for(var v=placePointsOnLine(y[g],t,i,r),m=0;m<v.length;++m)n.push(v[m]);else if("MultiPolygon"===e.type)if(r.placement===PLACEMENT.CENTROID){var _=Geo$1.multiCentroid(e.coordinates);n.push(new LabelPoint(_,t,i,r))}else for(var b=e.coordinates,x=0;x<b.length;x++)for(var w=b[x],E=0;E<w.length;E++)for(var T=placePointsOnLine(w[E],t,i,r),A=0;A<T.length;++A)n.push(T[A]);return n},makeVertexTemplate:function(t,e){var r=t.color||StyleParser.defaults.color,i=e.vertex_data.vertex_layout;if(this.fillVertexTemplate(i,"a_position",0,{size:2}),this.fillVertexTemplate(i,"a_position",t.z||0,{size:1,offset:2}),this.fillVertexTemplate(i,"a_position",this.scaleOrder(t.order),{size:1,offset:3}),this.fillVertexTemplate(i,"a_shape",0,{size:4}),this.fillVertexTemplate(i,"a_shape",t.label.layout.collide?0:1,{size:1,offset:3}),this.fillVertexTemplate(i,"a_texcoord",0,{size:2}),this.fillVertexTemplate(i,"a_offset",0,{size:2}),this.fillVertexTemplate(i,"a_color",Vector$1.mult(r,255),{size:4}),this.defines.TANGRAM_HAS_SHADER_POINTS&&e.variant.shader_point){var n=t.outline_color||StyleParser.defaults.outline.color;this.fillVertexTemplate(i,"a_outline_color",Vector$1.mult(n,255),{size:4}),this.fillVertexTemplate(i,"a_outline_edge",t.outline_edge_pct||StyleParser.defaults.outline.width,{size:1})}return this.selection&&this.fillVertexTemplate(i,"a_selection_color",Vector$1.mult(t.selection_color,255),{size:4}),this.fillVertexTemplate(i,"a_is_flat",0,{size:1}),this.defines.TANGRAM_POINT_DRAW_STICK&&t.stick&&(this.fillVertexTemplate(i,"a_is_stick",0,{size:1}),this.fillVertexTemplate(i,"a_stick_height",t.stick.height,{size:1})),this.vertex_template},buildQuad:function(t,e,r,i,n,o,a,s,l,u,c,h,p,f,d,y,g,v,m){return e[0]<=0||e[1]<=0?0:buildQuadsForPoints(t,d,y,{quad:e,quad_normalize:256,offset:s,offsets:l,offsets_alt:u,pre_angles:o,pre_angles_alt:a,angle:4096*r,angles:i,angles_alt:n,is_flat:p,elevate_by_altitude:f,build_stick_points:g,stick_color:g&&Vector$1.mult(v,255),color:Vector$1.mult(m||StyleParser.defaults.color,255),curve:h,texcoord_scale:c,texcoord_normalize,pre_angles_normalize,angles_normalize,offsets_normalize})},build:function(t,e,r){var i=t.label;return"curved"===i.type?this.buildCurvedLabel(i,t,e,r):this.buildStraightLabel(i,t,e,r)},buildStraightLabel:function(t,e,r,i){var n,o,a=this.makeVertexTemplate(e,r),s=t.angle||e.angle;"point"!==t.type?(n=e.size[t.type],o=default_uvs):(n=e.size,o=e.texcoords||default_uvs),r.uniforms=r.uniforms||{},e.label_texture?(r.uniforms.u_texture=e.label_texture,r.uniforms.u_point_type=TANGRAM_POINT_TYPE_LABEL,r.uniforms.u_apply_color_blocks=!1):e.texture?(r.uniforms.u_texture=e.texture,r.uniforms.u_point_type=TANGRAM_POINT_TYPE_TEXTURE,r.uniforms.u_apply_color_blocks=!0):(r.uniforms.u_texture=this.textureManager.default,r.uniforms.u_point_type=TANGRAM_POINT_TYPE_SHADER,r.uniforms.u_apply_color_blocks=!0);var l=t.offset,u=this.defines.TANGRAM_POINT_DRAW_STICK&&!e.label_texture&&e.stick&&e.stick.height>0,c=this.buildQuad([t.position],n,s,null,null,null,null,l,null,null,o,!1,t.isFlat(),e.elevate_by_altitude,r.vertex_data,a,u,u&&e.stick.color,e.color),h=e.linked&&e.linked.label.id;return this.trackLabel(t,h,r,c,i,u),c},buildCurvedLabel:function(t,e,r,i){for(var n=this.makeVertexTemplate(e,r),o=t.angle,a=0,s=!1,l=0;l<2;l++)for(var u=0;u<t.num_segments;u++){var c=e.size[t.type][u],h=default_uvs,p=this.getTileMesh(i.tile,this.getMeshVariantTypeForDraw(e));p.uniforms=p.uniforms||{},p.uniforms.u_texture=e.label_texture,p.uniforms.u_point_type=TANGRAM_POINT_TYPE_LABEL,p.uniforms.u_apply_color_blocks=!1;var f=t.offset||[0,0],d=t.position,y=t.angles[u],g=t.offsets[u],v=t.pre_angles[u],m=t.num_segments-u-1,_=t.alt_angles[m],b=t.alt_pre_angles[m],x=t.alt_offsets[m],w=this.buildQuad([d],c,o,y,_,v,b,f,g,x,h,!0,t.isFlat(),e.elevate_by_altitude,p.vertex_data,n,s,s,e.color);a+=w;var E=e.linked&&e.linked.label.id;this.trackLabel(t,E,r,w,i,s)}return a},trackLabel:function(t,e,r,i,n){var o=arguments.length>5&&void 0!==arguments[5]&&arguments[5];r.labels=r.labels||{},r.labels.collision=r.labels.collision||{},r.labels["non-collision"]=r.labels["non-collision"]||{};var a=t.layout.collide?r.labels.collision:r.labels["non-collision"];a[t.id]=a[t.id]||{container:{label:t.text_data?Object.assign(t.toJSON(),{text_data:t.text_data}):t.toJSON(),linked:e},ranges:[]};var s=2*i,l=r.vertex_data.offset-r.vertex_data.stride*s;a[t.id].ranges.push([l,s,o])},buildLines:function(t,e,r,i){return this.build(e,r,i)},buildPoints:function(t,e,r,i){return this.build(e,r,i)},buildPolygons:function(t,e,r,i){return this.build(e,r,i)},vertexLayoutForMeshVariant:function(t){if(!this.vertex_layout){var e=[{name:"a_position",size:4,type:gl$1.SHORT,normalized:!1},{name:"a_shape",size:4,type:gl$1.SHORT,normalized:!1},{name:"a_texcoord",size:2,type:gl$1.UNSIGNED_SHORT,normalized:!0},{name:"a_offset",size:2,type:gl$1.SHORT,normalized:!1},{name:"a_color",size:4,type:gl$1.UNSIGNED_BYTE,normalized:!0},{name:"a_outline_color",size:4,type:gl$1.UNSIGNED_BYTE,normalized:!0,static:[0,0,0,0]},{name:"a_outline_edge",size:1,type:gl$1.FLOAT,normalized:!1,static:0},{name:"a_selection_color",size:4,type:gl$1.UNSIGNED_BYTE,normalized:!0},{name:"a_is_flat",size:1,type:gl$1.UNSIGNED_BYTE,normalized:!0}];this.defines&&this.defines.TANGRAM_POINT_DRAW_STICK&&e.push({name:"a_is_stick",size:1,type:gl$1.UNSIGNED_BYTE,normalized:!0},{name:"a_stick_height",size:1,type:gl$1.FLOAT,normalized:!1}),this.vertex_layout=new VertexLayout(e),(e=e.map((function(t){return Object.assign({},t)}))).forEach((function(t){"a_outline_color"!==t.name&&"a_outline_edge"!==t.name||(t.static=null)})),this.vertex_layout_shader_point=new VertexLayout(e)}return t.shader_point?this.vertex_layout_shader_point:this.vertex_layout},computeVariantForDraw:function(t){var e=t.label_texture||t.texture||this.default_mesh_variant.key;return{key:e,shader_point:e===this.default_mesh_variant.key,order:t.label_texture?1:0}},makeMesh:function(t,e){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return r=Object.assign({},r,{fade_in_time:this.fade_in_time}),Style.makeMesh.call(this,t,e,r)}});var STOPS=[0,.33,.66,.99],LINE_EXCEED_STRAIGHT=1.5,LINE_EXCEED_STRAIGHT_NO_CURVE=1.8,LINE_EXCEED_STAIGHT_LOOSE=2.3,STRAIGHT_ANGLE_TOLERANCE=.1,CURVE_MIN_TOTAL_COST=1.3,CURVE_MIN_AVG_COST=.4,CURVE_MAX_ANGLE=1,ORIENTED_LABEL_OFFSET_FACTOR=1.2,VERTICAL_ANGLE_TOLERANCE=.01,LabelLine={create:function(t,e,r,i,n){for(var o=[{type:"straight",tolerance:n.no_curving?LINE_EXCEED_STRAIGHT_NO_CURVE:LINE_EXCEED_STRAIGHT},{type:"curved"},{type:"straight",tolerance:LINE_EXCEED_STAIGHT_LOOSE}],a=0;a<o.length;a++){var s=o[a],l=void 0;if("straight"===s.type?l=new LabelLineStraight(e,r,i,n,s.tolerance):"curved"===s.type&&!n.no_curving&&r.length>2&&(l=new LabelLineCurved(t,r,i,n)),l&&!l.throw_away)return l}return!1}},LabelLineBase=_createClass((function t(e,r){_classCallCheck(this,t),this.id=Label.nextLabelId(),this.layout=r,this.position=[],this.angle=0,this.offset=r.offset.slice(),this.unit_scale=this.layout.units_per_pixel,this.type="",this.throw_away=!1,this._is_flat=e,this._circles=void 0,this.placed=null}),[{key:"toJSON",value:function(){return{id:this.id,type:this.type,is_flat:this._is_flat,position:this.position,size:this.size,offset:this.offset,angle:this.angle,breach:this.breach,layout:textLayoutToJSON(this.layout),circles:this.getBoundingCircles()}}},{key:"inTileBounds",value:function(){var t=this.getAABB(),e=t.left,r=t.top,i=t.right,n=t.bottom;return Utils$1.pointInTile([e,r])&&Utils$1.pointInTile([i,n])}},{key:"getAABBForSegment",value:function(t,e,r,i){var n=this.unit_scale,o=e/2,a=r/2,s=_slicedToArray(t,2),l=s[0],u=s[1];if(0!==this.offset[0]||0!==this.offset[1]){var c=Vector$1.rot(this.offset,this.angle);l+=c[0]*n,u-=c[1]*n}var h=[[Math.cos(i),-Math.sin(i)],[Math.sin(i),Math.cos(i)]],p=Vector$1.multMatrix(h,[-o,-a]),f=Vector$1.multMatrix(h,[o,-a]),d=Vector$1.multMatrix(h,[o,a]),y=Vector$1.multMatrix(h,[-o,a]);return{left:l+Math.min(p[0],f[0],d[0],y[0]),top:u+Math.max(p[1],f[1],d[1],y[1]),right:l+Math.max(p[0],f[0],d[0],y[0]),bottom:u+Math.min(p[1],f[1],d[1],y[1])}}},{key:"isFlat",value:function(){return this._is_flat}},{key:"getBoundingCircles",value:function(){}},{key:"getAABB",value:function(){}}],[{key:"splitLineByOrientation",value:function(t){for(var e=[t[0]],r=0,i=0,n=0,o=e,a=!1,s=1;s<t.length;s++){var l=t[s],u=t[s-1],c=Vector$1.length(Vector$1.sub(l,u));l[0]>u[0]?1===n?(e.push(l),(r+=c)>i&&(o=e,i=r,a=!1)):(e=[u,l],(r=c)>i&&(o=e,i=r,a=!1),n=1):l[0]<u[0]?-1===n?(e.unshift(l),(r+=c)>i&&(o=e,i=r,a=!0)):(e=[l,u],(r=c)>i&&(o=e,i=r,a=!0),n=-1):(-1===n?e.unshift(l):(e.push(l),n=1),(r+=c)>i&&(o=e,i=r,a=-1===n))}return[o,a]}}]),LabelLineStraight=function(t){function e(t,r,i,n,o){var a;return _classCallCheck(this,e),(a=_callSuper(this,e,[i,n])).type="straight",a.size=t,a.throw_away=!a.fit(t,r,n,o),a}return _inherits(e,t),_createClass(e,[{key:"fit",value:function(t,e,r,i){var n,o=this.unit_scale,a=_slicedToArray(LabelLineBase.splitLineByOrientation(e),2);e=a[0],n=a[1],"number"==typeof r.orientation&&(this.offset[1]+=ORIENTED_LABEL_OFFSET_FACTOR*(t[1]-r.vertical_buffer),n&&(this.offset[1]*=-1),-1===r.orientation&&(this.offset[1]*=-1));for(var s=getLineLengths(e),l=t[0]*o,u=0;u<e.length-1;u++)for(var c=e[u],h=0,p=0,f=u+1,d=void 0;f<e.length;){var y=e[f-1],g=e[f],v=getAngleForSegment(y,g);if(f!==u+1&&(h+=getAbsAngleDiff(v,d)),Math.abs(h)>STRAIGHT_ANGLE_TOLERANCE)break;if(calcFitness(p+=s[f-1],l)<i){var m=Vector$1.mult(Vector$1.add(c,g),.5);return this.angle=-v,Math.abs(this.angle-Math.PI/2)<VERTICAL_ANGLE_TOLERANCE&&(this.angle=-Math.PI/2,"number"==typeof r.orientation&&(this.offset[1]*=-1)),this.position=m,this.breach=!this.inTileBounds(),!0}d=v,f++}return!1}},{key:"getBoundingCircles",value:function(){if(!this._circles){var t=this.unit_scale,e=this.size[0]/2*t,r=e*Math.cos(this.angle),i=e*Math.sin(this.angle),n=-r,o=-i,a=this.offset[0]*t,s=this.offset[1]*t,l=_slicedToArray(this.position,2),u=l[0],c=l[1];if(c*=-1,a){var h=[r,i];Vector$1.normalize(h),h[0]*=a,h[1]*=a,u+=h[0],c+=h[1]}if(s){var p=[i,-r];Vector$1.normalize(p),p[0]*=s,p[1]*=s,u-=p[0],c-=p[1]}r+=u,i+=c,n+=u,o+=c;var f=this.size[1]/2*t;this._circles=encircleLine(r,i,n,o,f)}return this._circles}},{key:"getAABB",value:function(){if(!this._aabb){var t=this.unit_scale,e=this.size,r=this.layout.buffer,i=(e[0]+2*r[0])*t,n=(e[1]+2*r[1])*t;this._aabb=this.getAABBForSegment(this.position,i,n,this.angle)}return this._aabb}}])}(LabelLineBase),LabelLineCurved=function(t){function e(t,r,i,n){var o;return _classCallCheck(this,e),(o=_callSuper(this,e,[i,n])).type="curved",o.positions=[],o.angles=[],o._aabbs=[],o.pre_angles=[],o.offsets=[],o.num_segments=t.length,o.sizes=t,o.alt_angles=[],o.alt_pre_angles=[],o.alt_offsets=[],o.throw_away=!o.fit(o.sizes,r,n),o}return _inherits(e,t),_createClass(e,[{key:"toJSON",value:function(){return{id:this.id,type:this.type,is_flat:this._is_flat,position:this.position,breach:this.breach,layout:textLayoutToJSON(this.layout),circles:this.getBoundingCircles()}}},{key:"fit",value:function(t,r,i){var n,o=this.unit_scale,a=Math.max.apply(Math,_toConsumableArray(t.map((function(t){return t[1]})))),s=a*o,l=_slicedToArray(LabelLineBase.splitLineByOrientation(r),2);r=l[0],n=l[1],"number"==typeof i.orientation&&(this.offset[1]+=ORIENTED_LABEL_OFFSET_FACTOR*(a-i.vertical_buffer),n&&(this.offset[1]*=-1),-1===i.orientation&&(this.offset[1]*=-1));var u=getLineLengths(r),c=t.map((function(t){return t[0]*o})),h=u.reduce((function(t,e){return t+e}),0),p=c.reduce((function(t,e){return t+e}),0);if(p>h)return!1;var f=r.length-1;if(f-0<2)return!1;var d=e.curvaturePlacement(r,h,u,p,0,f),y=r[d];if(-1===d||f-d<2)return!1;this.position=y;for(var g=0;g<c.length;g++){this.positions[g]=[],this.offsets[g]=[],this.angles[g]=[],this.pre_angles[g]=[];for(var v=0;v<STOPS.length;v++){var m=STOPS[v],_=_slicedToArray(e.scaleLine(m,r),2),b=_[0],x=_[1];y=b[d];var w=e.placeAtIndex(d,b,x,c),E=w.positions,T=w.offsets,A=w.angles,S=w.pre_angles,k=T.map((function(t){return Math.sqrt(t[0]*t[0]+t[1]*t[1])/o}));if(0===m){this.angle=1/A.length*A.reduce((function(t,e){return t+e}));for(var I=0;I<E.length;I++){var P=E[I],O=S[I],L=c[I],C=O+A[I];this._aabbs.push(this.getAABBForSegment(P,L,s,C))}}this.positions[g].push(E[g]),this.offsets[g].push(k[g]),this.angles[g].push(A[g]),this.pre_angles[g].push(S[g])}}c=t.slice().reverse().map((function(t){return t[0]*o}));for(var R=0;R<c.length;R++){this.alt_offsets[R]=[],this.alt_angles[R]=[],this.alt_pre_angles[R]=[];for(var M=0;M<STOPS.length;M++){var N=STOPS[M],j=_slicedToArray(e.scaleLine(N,r),2),D=j[0],B=j[1];y=D[d];var z=e.placeAtIndex(d,D,B,c),U=z.offsets,F=z.angles,G=z.pre_angles,$=U.map((function(t){return Math.sqrt(t[0]*t[0]+t[1]*t[1])/o}));0===N&&(this.alt_angle=1/F.length*F.reduce((function(t,e){return t+e}))),this.alt_offsets[R].push($[R]),this.alt_angles[R].push(F[R]),this.alt_pre_angles[R].push(G[R])}}return!0}},{key:"getBoundingCircles",value:function(){if(!this._circles){for(var t=[],e=this.unit_scale,r=0;r<this.positions.length;r++){var i=this.sizes[r],n=this.angles[r][0],o=this.positions[r][0],a=i[0]/2*e,s=a*Math.cos(n),l=a*Math.sin(n),u=-s,c=-l,h=_slicedToArray(o,2),p=h[0],f=h[1],d=encircleLine(s+=p,l+=f*=-1,u+=p,c+=f,i[1]/2*e);Array.prototype.push.apply(t,d)}this._circles=t}return this._circles}},{key:"getAABB",value:function(){if(!this._aabb){for(var t=1/0,e=-1/0,r=-1/0,i=1/0,n=0;n<this._aabbs.length;n++){var o=this._aabbs[n];t=Math.min(t,o.left),e=Math.max(e,o.top),r=Math.max(r,o.right),i=Math.min(i,o.bottom)}this._aabb={left:t,top:e,right:r,bottom:i}}return this._aabb}}],[{key:"curvaturePlacement",value:function(t,e,r,i,n,o){n=n||0,o=o||t.length-1;for(var a=[],s=n+1;s<o;s++){var l=t[s-1],u=t[s],c=t[s+1],h=Vector$1.perp(u,l),p=Vector$1.perp(c,u),f=Vector$1.angleBetween(h,p);f>CURVE_MAX_ANGLE&&(f=1/0),a.push(f)}a.push(1/0);for(var d=[],y=[],g=n,v=0,m=0;m<n;m++)v+=r[m];for(;v+i<e;){for(var _=v+i,b=v,x=g,w=0;x<o&&b+r[x]<_&&(w+=a[x])!==1/0;)b+=r[x],x++;if(0===w)return g;var E=w/(x-g);d.push(w),y.push(E),v+=r[g],g++}if(0===d.length)return-1;var T=Math.min.apply(null,d),A=y[d.indexOf(T)];return T<CURVE_MIN_TOTAL_COST&&A<CURVE_MIN_AVG_COST?d.indexOf(T):-1}},{key:"scaleLine",value:function(t,e){var r=[e[0]],i=[];return e.forEach((function(n,o){if(o!==e.length-1){var a=Vector$1.sub(e[o+1],e[o]),s=Vector$1.mult(a,1+t);r.push(Vector$1.add(r[o],s)),i.push(Vector$1.length(s))}})),[r,i]}},{key:"placeAtIndex",value:function(t,r,i,n){var o=r[t],a=_slicedToArray(e.getIndicesAndOffsets(t,i,n),2),s=a[0],l=a[1],u=e.getPositionsFromIndicesAndOffsets(r,s,l),c=_slicedToArray(e.getAnglesFromIndicesAndOffsets(o,s,r,u),3);return{positions:u,offsets:c[0],angles:c[1],pre_angles:c[2]}}},{key:"getIndicesAndOffsets",value:function(t,e,r){for(var i=r.length,n=[],o=[],a=0,s=0,l=0;a<i;){for(var u=r[a];a<i&&s+.5*u<=l+e[t];){var c=s-l+.5*u;o.push(c),n.push(t),s+=u,u=r[++a]}l+=e[t],t++}return[n,o]}},{key:"getPositionsFromIndicesAndOffsets",value:function(t,e,r){for(var i=[],n=0;n<e.length;n++){var o=e[n],a=r[n],s=getAngleForSegment(t[o],t[o+1]),l=Vector$1.rot([a,0],s),u=Vector$1.add(t[o],l);i.push(u)}return i}},{key:"getAnglesFromIndicesAndOffsets",value:function(t,e,r,i){for(var n=[],o=[],a=[],s=0;s<i.length;s++){var l=i[s],u=e[s],c=Vector$1.sub(l,t),h=-Vector$1.angle(c),p=getTextAngleForSegment(r[u],r[u+1])-h;if(s>0){var f=n[s-1],d=o[s-1];Math.abs(h-f)>Math.PI&&(h+=h>f?-2*Math.PI:2*Math.PI),Math.abs(d-p)>Math.PI&&(p+=p>d?-2*Math.PI:2*Math.PI)}n.push(h),o.push(p),a.push(c)}return[a,n,o]}}])}(LabelLineBase);function calcFitness(t,e){return e/t}function getAngleForSegment(t,e){var r=Vector$1.sub(e,t);return Vector$1.angle(r)}function getTextAngleForSegment(t,e){return-getAngleForSegment(t,e)}function getLineLengths(t){for(var e=[],r=0;r<t.length-1;r++){var i=t[r],n=t[r+1],o=Math.hypot(i[0]-n[0],i[1]-n[1]);e.push(o)}return e}function getAbsAngleDiff(t,e){var r,i;for(t>e?(r=e,i=t):(r=t,i=e);i-r>Math.PI;)r+=2*Math.PI;return Math.abs(i-r)}var TextStyle=Object.create(Points);Object.assign(TextStyle,{name:"text",super:Points,built_in:!0,init:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};Style.init.call(this,t),this.setupDefines(),this.defines.TANGRAM_HAS_SHADER_POINTS=!1,this.defines.TANGRAM_IS_TEXT_STYLE=!0,this.reset()},makeVertexTemplate:function(t,e){this.super.makeVertexTemplate.apply(this,arguments);var r=e.vertex_data.vertex_layout;return this.fillVertexTemplate(r,"a_pre_angles",0,{size:4}),this.fillVertexTemplate(r,"a_offsets",0,{size:4}),this.fillVertexTemplate(r,"a_angles",0,{size:4}),this.fillVertexTemplate(r,"a_offsets_alt",0,{size:4}),this.fillVertexTemplate(r,"a_pre_angles_alt",0,{size:4}),this.fillVertexTemplate(r,"a_angles_alt",0,{size:4}),this.vertex_template},reset:function(){this.queues={},this.resetText()},addFeature:function(t,e,r){var i=this,n=r.tile,o=t.geometry.type;e.can_articulate="LineString"===o||"MultiLineString"===o,e.supersample_text="LineString"===o||"MultiLineString"===o;var a=this.parseTextFeature(t,e,r,n);a&&(a instanceof Array?a.forEach((function(e){e.feature=t,e.context=r,e.layout.vertex=!1,i.queueFeature(e,n)})):(a.feature=t,a.context=r,a.layout.vertex=!1,this.queueFeature(a,n)),Collision.addStyle(this.name,n.id))},endData:function(t){var e=this,r=this.queues[t.id];return delete this.queues[t.id],this.collideAndRenderTextLabels(t,this.name,r).then((function(r){var i=r.labels,n=r.texts;return i&&n&&(e.texts[t.id]=n,i.forEach((function(r){var i=r.text_settings_key,n=e.texts[t.id][i]&&e.texts[t.id][i][r.text],o=e.feature_style;o.label=r.label,r.label.text_data={text_info:n,text_settings_key:i,text:r.text},o.label_texture=e.textureManager.default,n.text_settings.can_articulate?(o.size={},"straight"===r.label.type?o.size.straight=n.size.logical_size:o.size.curved=n.segment_sizes.map((function(t){return t.logical_size}))):o.size=n.size.logical_size,Style.addFeature.call(e,r.feature,r.draw,r.context)}))),e.freeText(t),Style.endData.call(e,t).then((function(r){if(r){for(var i in r.meshes)r.meshes[i].uniforms.u_apply_color_blocks=!0;t.mesh_data[e.name]=r}return r}))}))},_preprocess:function(t){return this.preprocessText(t)},buildTextLabels:function(t,e){for(var r=[],i=0;i<e.length;i++){var n=e[i],o=this.texts[t.id][n.text_settings_key][n.text],a=void 0;if(n.layout.vertical_buffer=o.vertical_buffer,o.text_settings.can_articulate){var s=o.segment_sizes.map((function(t){return t.collision_size}));n.layout.no_curving=o.no_curving,a=this.buildLabels(s,n.feature.geometry,n.layout,o.size.collision_size)}else a=this.buildLabels(o.size.collision_size,n.feature.geometry,n.layout);for(var l=0;l<a.length;l++){var u=Object.create(n);u.label=a[l],r.push(u)}}return r},buildLabels:function(t,e,r,i){var n="Point"!==e.type,o=[];if("LineString"===e.type)Array.prototype.push.apply(o,this.buildLineLabels(e.coordinates,t,n,r,i));else if("MultiLineString"===e.type)for(var a=e.coordinates,s=0;s<a.length;++s)Array.prototype.push.apply(o,this.buildLineLabels(a[s],t,n,r,i));else if("Point"===e.type)o.push(new LabelPoint(e.coordinates,t,n,r));else if("MultiPoint"===e.type)for(var l=e.coordinates,u=0;u<l.length;++u)o.push(new LabelPoint(l[u],t,n,r));else if("Polygon"===e.type){var c=Geo$1.centroid(e.coordinates);o.push(new LabelPoint(c,t,n,r))}else if("MultiPolygon"===e.type){var h=Geo$1.multiCentroid(e.coordinates);o.push(new LabelPoint(h,t,n,r))}return o},buildLineLabels:function(t,e,r,i,n){var o=[],a=Math.min(i.subdiv,t.length-1);if(a>1)for(var s=(t.length-1)/a,l=0;l<a;l++){var u=Math.floor(l*s),c=Math.floor((l+1)*s)+1,h=t.slice(u,c),p=LabelLine.create(e,n,h,r,i);p&&o.push(p)}if(o.length<a){var f=LabelLine.create(e,n,t,r,i);f&&o.push(f)}return o},vertexLayoutForMeshVariant:function(){if(!this.vertex_layout){var t=[{name:"a_position",size:4,type:gl$1.SHORT,normalized:!1},{name:"a_shape",size:4,type:gl$1.SHORT,normalized:!1},{name:"a_texcoord",size:2,type:gl$1.UNSIGNED_SHORT,normalized:!0},{name:"a_offset",size:2,type:gl$1.SHORT,normalized:!1},{name:"a_color",size:4,type:gl$1.UNSIGNED_BYTE,normalized:!0},{name:"a_angles",size:4,type:gl$1.SHORT,normalized:!1},{name:"a_offsets",size:4,type:gl$1.UNSIGNED_SHORT,normalized:!1},{name:"a_pre_angles",size:4,type:gl$1.BYTE,normalized:!1},{name:"a_selection_color",size:4,type:gl$1.UNSIGNED_BYTE,normalized:!0},{name:"a_is_flat",size:1,type:gl$1.UNSIGNED_BYTE,normalized:!0},{name:"a_offsets_alt",size:4,type:gl$1.UNSIGNED_SHORT,normalized:!1},{name:"a_pre_angles_alt",size:4,type:gl$1.BYTE,normalized:!1},{name:"a_angles_alt",size:4,type:gl$1.SHORT,normalized:!1}];this.vertex_layout=new VertexLayout(t)}return this.vertex_layout},getMeshVariantTypeForDraw:Points.getMeshVariantTypeForDraw}),TextStyle.texture_id=0;var RasterStyle=Object.create(Polygons);Object.assign(RasterStyle,{name:"raster",super:Polygons,built_in:!0,init:function(){this.raster=this.raster||"color",this.super.init.apply(this,arguments),this.selection=!1,this.defines.SNAP_TO_PIXEL_GRID=!0},_preprocess:function(t){return t.color=t.color||StyleParser.defaults.color,this.super._preprocess.apply(this,arguments)}});var CustomIcons=Object.create(Points);Object.assign(CustomIcons,{name:"custom_icons",collision:!1,init:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};Points.init.call(this,t)},loadTexture:function(t,e,r){var i,n=t.width,o=t.height,a=t.items,s=document.createElement("canvas"),l=Utils$1.device_pixel_ratio,u=this.sources[e],c={sprites:{}};if(s.width=n*l,s.height=o*l,u){var h,p=a.length,f=s.getContext("2d");for(f.scale(l,l);h=a[--p];){var d=u.getIconBitmapByObjectId(h.meta.objectId,h.meta.id);if(d){var y=isTainting(d);y?log("error",y):(f.drawImage(d,h.x,h.y,h.width,h.height),c.sprites[h.meta.id]=[h.x,h.y,h.width,h.height])}}}return c.element=s,(i=this.textureManager.create(this.gl,r,c)).retain(),i.loading.then((function(t){return t.name}))},buildRasterTextures:function(t,e){return WorkerBroker.postMessage(this.main_thread_target+".loadTexture",t.rasters,t.source,t.texture_name).then((function(t){return e.textures.push(t),e}))},addFeature:function(t,e,r){var i=r.tile.rasters,n={};i.items.forEach((function(t){n[t.meta.id]=[t.x,t.y,t.width,t.height]}));var o="".concat(r.tile.source,"_dyn_").concat(r.tile.coords.key,"_").concat(this.generation,"_").concat(r.tile.id);e.texture=r.tile.texture_name=o;var a=Object.assign({},DEFAULT_TEXTURE_INFO,{name:o,width:i.width,height:i.height,sprites:n,manager:this.textureManager});Texture.prototype.calculateSprites.apply(a),this.textureManager.textures[o]=a,Points.addFeature.apply(this,arguments),delete this.textureManager.textures[o]}});var DEFAULT_TEXTURE_INFO={filtering:"linear",density:1,valid:!0,power_of_2:!1,texcoords:{},sizes:{},css_sizes:{},aspects:{}},OverlayStyle=Object.create(Polygons);Object.assign(OverlayStyle,{name:"overlays",super:Polygons,init:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.selection=t.selection||!0,this.raster=this.raster||"color",this.super.init.apply(this,arguments)},setupRasters:function(){if(!Thread.is_main)return!1;if(this.super.setupRasters.call(this))return!0;var t=!1;for(var e in this.sources)if(this.sources[e]instanceof ObjectSource){t=!0;break}return!!t&&(this.defines.TANGRAM_MODEL_POSITION_BASE_ZOOM_VARYING=!0,this.replaceShaderBlock("raster",shaderSrc_rasters,"Raster"),!0)},loadTextures:function(t,e){var r,i,n,o=this.sources[e],a=t.name;if(t.overlays_config.forEach((function(e){var a=e.texcoords,s=e.id,l=o.getMapObjectById(s),u=l.getBitmap();if(u){var c=isTainting(u=bitmapToCanvas(u,u.width,u.height));c?log("error",c):(r||((r=document.createElement("canvas")).width=t.width,r.height=t.height,i=r.getContext("2d")),i.save(),i.globalAlpha=l.getOpacity(),a.forEach((function(t){return i.drawImage(u,t[0],t[1],t[2],t[3])})),i.restore(),n=!0)}})),n){t.element=r;var s={};return s[a]=t,this.super.loadTextures.call(this,s)}var l=this.textureManager.textures[this.textureManager.default];return Promise.resolve([{name:l.name,width:l.width,height:l.height,loaded:l.loaded}])},buildRasterTextures:function(t,e){var r=this.sources[t.source].tileTexture(t);return r?WorkerBroker.postMessage(this.main_thread_target+".loadTextures",r,t.source).then((function(t){if(!t||t.length<1)return e;if(t.some((function(t){return!t.loaded})))return null;var r=t[0].name;return e.uniforms=e.uniforms||{},e.textures=e.textures||[],e.uniforms.u_raster=r,e.uniforms.u_raster_offset=[0,0,1],e.textures.push(r),e})):Promise.resolve(e)}});var shaderSrc_Vertex="uniform float u_horizon;uniform float u_tilt;uniform float u_zoom;attribute vec2 a_position;attribute float a_is_sky;attribute float a_is_top;attribute vec4 a_color;varying vec4 v_color;const float SIN_THRESHOLD_ANGLE=0.96126069082;void main(){v_color=a_color;float sin_tilt=sin(u_tilt);float sky_bottom_alpha=1.-max(sin_tilt-SIN_THRESHOLD_ANGLE,0.)*3.;if((a_position.y==1.&&a_is_sky==0.)||(a_position.y==0.&&a_is_sky==1.)){v_color.w=sky_bottom_alpha;}float fog_height=max((22.-u_zoom)*0.04,0.)*(sin_tilt-.7);float position_z=u_zoom<17. ? .942 : .9418;gl_Position=vec4(a_position.x,a_is_sky*(a_position.y+a_is_top)+1.0-u_horizon-(1.0-a_is_sky)*(1.0-a_position.y)*fog_height,position_z,1.0);}",shaderSrc_Fragment="varying vec4 v_color;void main(void){gl_FragColor=v_color;}",STYLE_NAME="skybox",SkyBox=Object.create(Style),positions=[-1,0,1,0,-1,1,-1,1,1,0,1,1,-1,0,1,0,-1,1,-1,1,1,0,1,1];Object.assign(SkyBox,{name:STYLE_NAME,built_in:!0,vertex_shader_src:shaderSrc_Vertex,fragment_shader_src:shaderSrc_Fragment,selection:!1,blend:"inlay",blend_order:1,init:function(){Style.init.apply(this,arguments),this.selection=!1},_preprocess:function(t){return t.color={top:StyleParser.createColorPropertyCache(t.color.zenith),bottom:StyleParser.createColorPropertyCache(t.color.horizon),fog:StyleParser.createColorPropertyCache(t.color.fog)},t},vertexLayoutForMeshVariant:function(t){if(!this.vertex_layout){var e=[{name:"a_position",size:2,type:gl$1.FLOAT,normalized:!1},{name:"a_is_sky",size:1,type:gl$1.FLOAT,normalized:!0},{name:"a_color",size:4,type:gl$1.UNSIGNED_BYTE,normalized:!0},{name:"a_is_top",size:1,type:gl$1.FLOAT,normalized:!0}];this.vertex_layout=new VertexLayout(e)}return this.vertex_layout},makeVertexTemplate:function(t){var e=0;return this.vertex_template[e++]=0,this.vertex_template[e++]=0,this.vertex_template},parseFeature:function(t,e,r){var i=this.feature_style;return e.color&&e.color.top&&e.color.bottom&&(i.color_top=this.parseColor(e.color.top,r),i.color_bottom=this.parseColor(e.color.bottom,r),i.color_fog=this.parseColor(e.color.fog||"white",r),Array.isArray(i.color_fog)&&(i.color_fog=i.color_fog.slice(),i.color_fog[3]=0)),i},buildGeometry:function(t,e,r,i){for(var n=this.makeVertexTemplate(e),o=r.vertex_data,a=r.vertex_data.vertex_layout,s=o.vertex_layout.index.a_position,l={top:e.color_top,bottom:e.color_bottom},u={top:e.color_bottom,bottom:e.color_fog},c=0,h=positions.length-1;c<h;c+=2){n[s+0]=positions[c],n[s+1]=positions[c+1];var p=c<12,f=positions[c+1]>0,d=p?l:u;this.fillVertexTemplate(a,"a_is_sky",p?1:0,{size:1}),this.fillVertexTemplate(a,"a_is_top",f?1:0,{size:1}),this.fillVertexTemplate(a,"a_color",Vector$1.mult(f?d.top:d.bottom,255),{size:4}),o.addVertex(n)}return 4}});var shaderSrc_accessors="#ifdef TANGRAM_VERTEX_SHADER\nvec4 modelPosition(){return vec4(a_position.xyz/TANGRAM_TILE_SCALE*exp2(u_tile_origin.z-u_tile_origin.w),1.)+vec4(0.,1.,0.,0.);}vec4 modelPositionBaseZoom(){return vec4(a_position.xyz/TANGRAM_TILE_SCALE,1.)+vec4(0.,1.,0.,0.);}\n#endif\nvec4 worldPosition(){return v_world_position;}\n#ifdef TANGRAM_VERTEX_SHADER\nvec4 wrapWorldPosition(vec4 world_position){\n#if defined(TANGRAM_WORLD_POSITION_WRAP)\nvec2 anchor=u_tile_origin.xy-mod(u_tile_origin.xy,TANGRAM_WORLD_POSITION_WRAP);world_position.xy-=anchor;\n#endif\nreturn world_position;}\n#endif\n#if defined(TANGRAM_VERTEX_SHADER)\nvec3 worldNormal(){return TANGRAM_NORMAL;}\n#elif defined(TANGRAM_FRAGMENT_SHADER)\nvec3 worldNormal(){return u_inverseNormalMatrix*TANGRAM_NORMAL;}\n#endif\n",shaderSrc_layerOrder="void applyLayerOrder(float layer,inout vec4 position){position.z-=layer*TANGRAM_LAYER_DELTA*position.w;}",shaderSrc_selectionGlobals="\n#if defined(TANGRAM_FEATURE_SELECTION) && defined(TANGRAM_VERTEX_SHADER)\nattribute vec4 a_selection_color;varying vec4 v_selection_color;uniform vec4 u_selection_discard0;uniform vec4 u_selection_discard1;uniform vec4 u_selection_discard2;uniform vec4 u_selection_discard3;uniform vec4 u_selection_discard4;uniform vec4 u_selection_discard5;uniform vec4 u_selection_discard6;uniform vec4 u_selection_discard7;uniform vec4 u_selection_discard8;uniform vec4 u_selection_discard9;\n#endif\n",shaderSrc_selectionVertex="\n#if defined(TANGRAM_FEATURE_SELECTION) && defined(TANGRAM_VERTEX_SHADER)\nif(a_selection_color.rgb==vec3(0.)||a_selection_color==u_selection_discard0||a_selection_color==u_selection_discard1||a_selection_color==u_selection_discard2||a_selection_color==u_selection_discard3||a_selection_color==u_selection_discard4||a_selection_color==u_selection_discard5||a_selection_color==u_selection_discard6||a_selection_color==u_selection_discard7||a_selection_color==u_selection_discard8||a_selection_color==u_selection_discard9){gl_Position=vec4(0.,0.,0.,1.);return;}v_selection_color=a_selection_color;\n#endif\n",shaderSrc_utils="#ifndef UTILS\n#define UTILS\nbool isLocalSpacePixelOutsideTile(vec4 pixel_local_space_position,float tile_scale){return pixel_local_space_position.x<0.||pixel_local_space_position.x>=tile_scale||pixel_local_space_position.y>0.||pixel_local_space_position.y<=-tile_scale;}\n#endif\n",shaderSrc_snapToPixelGrid="uniform float u_view_pan_snap_timer;void snapToPixelGrid(inout vec4 position){vec2 position_fract=fract((((position.xy/position.w)+1.)*.5)*u_resolution);vec2 position_snap=position.xy+((step(0.5,position_fract)-position_fract)*position.w*2./u_resolution);\n#ifdef TANGRAM_VIEW_PAN_SNAP_RATE\nposition.xy=mix(position.xy,position_snap,clamp(u_view_pan_snap_timer*TANGRAM_VIEW_PAN_SNAP_RATE,0.,1.));\n#else\nposition.xy=position_snap;\n#endif\n}",StyleManager=_createClass((function t(){_classCallCheck(this,t),this.styles={},this.base_styles={},this.register(Object.create(Polygons)),this.register(Object.create(Lines)),this.register(Object.create(PatternLines)),this.register(Object.create(Points)),this.register(Object.create(TextStyle)),this.register(Object.create(RasterStyle)),this.register(Object.create(CustomIcons)),this.register(Object.create(OverlayStyle)),this.register(Object.create(SkyBox))}),[{key:"init",value:function(){ShaderProgram.removeBlock("global"),ShaderProgram.removeBlock("setup"),ShaderProgram.addBlock("global",shaderSrc_accessors),ShaderProgram.addBlock("global",shaderSrc_layerOrder),ShaderProgram.addBlock("global",shaderSrc_selectionGlobals),ShaderProgram.addBlock("global",shaderSrc_snapToPixelGrid),ShaderProgram.replaceBlock("utils",shaderSrc_utils),ShaderProgram.replaceBlock("setup",shaderSrc_selectionVertex),ShaderProgram.defines.TANGRAM_EPSILON=1e-5,ShaderProgram.defines.TANGRAM_LAYER_DELTA=1/16384,ShaderProgram.defines.TANGRAM_TILE_SCALE="vec3(".concat(Geo$1.tile_scale,"., ").concat(Geo$1.tile_scale,"., u_meters_per_pixel * ").concat(Geo$1.tile_size,".)"),ShaderProgram.defines.TANGRAM_HEIGHT_SCALE=Geo$1.height_scale,ShaderProgram.defines.TANGRAM_ALPHA_TEST=.1,Lines.dash_textures={}}},{key:"destroy",value:function(t){var e=this;Object.keys(this.styles).forEach((function(r){var i=e.styles[r];i.gl===t&&(log("trace","StyleManager.destroy: destroying render style ".concat(i.name)),i.base&&e.remove(i.name),i.destroy())}))}},{key:"register",value:function(t){this.styles[t.name]=t,this.base_styles[t.name]=t}},{key:"remove",value:function(t){delete this.styles[t]}},{key:"mix",value:function(t,e){if(t.mixed)return t;t.mixed={};var r,i=[];t.mix&&(Array.isArray(t.mix)?(r=i).push.apply(r,_toConsumableArray(t.mix)):i.push(t.mix),(i=i.map((function(t){return e[t]})).filter((function(e){return e&&e!==t}))).forEach((function(e){return t.mixed[e.name]=!0}))),i.push(t),t.animated=i.some((function(t){return t&&t.animated})),t.texcoords=i.some((function(t){return t&&t.texcoords})),t.base=i.map((function(t){return t.base})).filter((function(t){return t})).pop(),t.lighting=i.map((function(t){return t.lighting})).filter((function(t){return null!=t})).pop(),t.texture=i.map((function(t){return t.texture})).filter((function(t){return t})).pop(),t.raster=i.map((function(t){return t.raster})).filter((function(t){return null!=t})).pop(),t.dash=i.map((function(t){return t.dash})).filter((function(t){return null!=t})).pop(),t.dash_background_color=i.map((function(t){return t.dash_background_color})).filter((function(t){return null!=t})).pop(),i.some((function(t){return t.hasOwnProperty("blend")&&t.blend}))&&(t.blend=i.map((function(t){return t.hasOwnProperty("blend")&&t.blend})).filter((function(t){return t})).pop()),t.blend_order=i.map((function(t){return t.blend_order})).filter((function(t){return null!=t})).pop(),t.defines=Object.assign.apply(Object,[{}].concat(_toConsumableArray(i.map((function(t){return t.defines})).filter((function(t){return t}))))),t.material=Object.assign.apply(Object,[{}].concat(_toConsumableArray(i.map((function(t){return t.material})).filter((function(t){return t})))));var n=i.map((function(t){return t.draw})).filter((function(t){return t}));return n.length>0&&(t.draw=mergeObjects.apply(void 0,[{}].concat(_toConsumableArray(n)))),this.mixShaders(t,e,i),t}},{key:"mixShaders",value:function(t,e,r){var i={},n=r.map((function(t){return t.shaders})).filter((function(t){return t}));if(i.defines=Object.assign.apply(Object,[{}].concat(_toConsumableArray(n.map((function(t){return t.defines})).filter((function(t){return t}))))),i.uniforms={},i._uniforms=t.shaders&&t.shaders.uniforms||{},i._uniform_scopes={},r.filter((function(t){return t.shaders&&t.shaders.uniforms})).forEach((function(t){var r=function(r){i._uniform_scopes[r]=t.name,Object.defineProperty(i.uniforms,r,{enumerable:!0,configurable:!0,get:function(){return void 0!==i._uniforms[r]?i._uniforms[r]:e[i._uniform_scopes[r]].shaders.uniforms!==i.uniforms?e[i._uniform_scopes[r]].shaders.uniforms[r]:void 0},set:function(t){i._uniforms[r]=t}})};for(var n in t.shaders.uniforms)r(n)})),i.extensions=Object.keys(n.map((function(t){return t.extensions})).filter((function(t){return t})).reduce((function(t,e){return"string"==typeof e?t[e]=!0:e.forEach((function(e){return t[e]=!0})),t}),{})||{}),t.shaders&&t.shaders.blocks)for(var o in t.shaders.block_scopes=t.shaders.block_scopes||{},t.shaders.blocks){var a,s=t.shaders.blocks[o];t.shaders.block_scopes[o]=t.shaders.block_scopes[o]||[],Array.isArray(s)?(a=t.shaders.block_scopes[o]).push.apply(a,_toConsumableArray(s.map((function(){return t.name})))):t.shaders.block_scopes[o].push(t.name)}var l={};return n.forEach((function(t){if(t.blocks){i.blocks=i.blocks||{},i.block_scopes=i.block_scopes||{};var e={};for(var r in t.blocks){var n=t.blocks[r],o=t.block_scopes[r];i.blocks[r]=i.blocks[r]||[],i.block_scopes[r]=i.block_scopes[r]||[],n=Array.isArray(n)?n:[n],o=Array.isArray(o)?o:[o];for(var a=0;a<n.length;a++)l[o[a]]||(e[o[a]]=!0,i.blocks[r].push(n[a]),i.block_scopes[r].push(o[a]))}Object.assign(l,e)}})),Object.assign(t.mixed,l),t.shaders=i,t}},{key:"create",value:function(t,e){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},i=mergeObjects({},e);return i.name=t,(i=this.mix(i,r)).base&&this.base_styles[i.base]?this.styles[t]=i=Object.assign(Object.create(this.base_styles[i.base]),i):i.base=null,i}},{key:"build",value:function(t){var e=this,r=Object.keys(t).sort((function(r,i){return e.inheritanceDepth(r,t)-e.inheritanceDepth(i,t)}));for(var i in this.styles)this.base_styles[i]?this.styles[i].reset():delete this.styles[i];var n={};return r.forEach((function(r){n[r]=e.create(r,t[r],n)})),this.styles}},{key:"initStyles",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};for(var e in this.styles)this.styles[e].init(t)}},{key:"inheritanceDepth",value:function(t,e){for(var r=this,i=0;;){var n=e[t];if(!n)break;if(!n.mix)break;if(i++,Array.isArray(n.mix)){i+=Math.max.apply(Math,_toConsumableArray(n.mix.map((function(i){if(t!==i)return r.inheritanceDepth(i,e)}))));break}if(t===n.mix)break;t=n.mix}return i}}]);function isNothing(t){return null==t}function isObject(t){return"object"==typeof t&&null!==t}function toArray(t){return Array.isArray(t)?t:isNothing(t)?[]:[t]}function extend(t,e){var r,i,n,o;if(e)for(r=0,i=(o=Object.keys(e)).length;r<i;r+=1)t[n=o[r]]=e[n];return t}function repeat(t,e){var r,i="";for(r=0;r<e;r+=1)i+=t;return i}function isNegativeZero(t){return 0===t&&Number.NEGATIVE_INFINITY===1/t}var isNothing_1=isNothing,isObject_1=isObject,toArray_1=toArray,repeat_1=repeat,isNegativeZero_1=isNegativeZero,extend_1=extend,common={isNothing:isNothing_1,isObject:isObject_1,toArray:toArray_1,repeat:repeat_1,isNegativeZero:isNegativeZero_1,extend:extend_1};function formatError(t,e){var r="",i=t.reason||"(unknown reason)";return t.mark?(t.mark.name&&(r+='in "'+t.mark.name+'" '),r+="("+(t.mark.line+1)+":"+(t.mark.column+1)+")",!e&&t.mark.snippet&&(r+="\n\n"+t.mark.snippet),i+" "+r):i}function YAMLException$1(t,e){Error.call(this),this.name="YAMLException",this.reason=t,this.mark=e,this.message=formatError(this,!1),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=(new Error).stack||""}YAMLException$1.prototype=Object.create(Error.prototype),YAMLException$1.prototype.constructor=YAMLException$1,YAMLException$1.prototype.toString=function(t){return this.name+": "+formatError(this,t)};var exception=YAMLException$1;function getLine(t,e,r,i,n){var o="",a="",s=Math.floor(n/2)-1;return i-e>s&&(e=i-s+(o=" ... ").length),r-i>s&&(r=i+s-(a=" ...").length),{str:o+t.slice(e,r).replace(/\t/g,"→")+a,pos:i-e+o.length}}function padStart(t,e){return common.repeat(" ",e-t.length)+t}function makeSnippet(t,e){if(e=Object.create(e||null),!t.buffer)return null;e.maxLength||(e.maxLength=79),"number"!=typeof e.indent&&(e.indent=1),"number"!=typeof e.linesBefore&&(e.linesBefore=3),"number"!=typeof e.linesAfter&&(e.linesAfter=2);for(var r,i=/\r?\n|\r|\0/g,n=[0],o=[],a=-1;r=i.exec(t.buffer);)o.push(r.index),n.push(r.index+r[0].length),t.position<=r.index&&a<0&&(a=n.length-2);a<0&&(a=n.length-1);var s,l,u="",c=Math.min(t.line+e.linesAfter,o.length).toString().length,h=e.maxLength-(e.indent+c+3);for(s=1;s<=e.linesBefore&&!(a-s<0);s++)l=getLine(t.buffer,n[a-s],o[a-s],t.position-(n[a]-n[a-s]),h),u=common.repeat(" ",e.indent)+padStart((t.line-s+1).toString(),c)+" | "+l.str+"\n"+u;for(l=getLine(t.buffer,n[a],o[a],t.position,h),u+=common.repeat(" ",e.indent)+padStart((t.line+1).toString(),c)+" | "+l.str+"\n",u+=common.repeat("-",e.indent+c+3+l.pos)+"^\n",s=1;s<=e.linesAfter&&!(a+s>=o.length);s++)l=getLine(t.buffer,n[a+s],o[a+s],t.position-(n[a]-n[a+s]),h),u+=common.repeat(" ",e.indent)+padStart((t.line+s+1).toString(),c)+" | "+l.str+"\n";return u.replace(/\n$/,"")}var snippet=makeSnippet,TYPE_CONSTRUCTOR_OPTIONS=["kind","multi","resolve","construct","instanceOf","predicate","represent","representName","defaultStyle","styleAliases"],YAML_NODE_KINDS=["scalar","sequence","mapping"];function compileStyleAliases(t){var e={};return null!==t&&Object.keys(t).forEach((function(r){t[r].forEach((function(t){e[String(t)]=r}))})),e}function Type$1(t,e){if(e=e||{},Object.keys(e).forEach((function(e){if(-1===TYPE_CONSTRUCTOR_OPTIONS.indexOf(e))throw new exception('Unknown option "'+e+'" is met in definition of "'+t+'" YAML type.')})),this.options=e,this.tag=t,this.kind=e.kind||null,this.resolve=e.resolve||function(){return!0},this.construct=e.construct||function(t){return t},this.instanceOf=e.instanceOf||null,this.predicate=e.predicate||null,this.represent=e.represent||null,this.representName=e.representName||null,this.defaultStyle=e.defaultStyle||null,this.multi=e.multi||!1,this.styleAliases=compileStyleAliases(e.styleAliases||null),-1===YAML_NODE_KINDS.indexOf(this.kind))throw new exception('Unknown kind "'+this.kind+'" is specified for "'+t+'" YAML type.')}var type=Type$1;function compileList(t,e){var r=[];return t[e].forEach((function(t){var e=r.length;r.forEach((function(r,i){r.tag===t.tag&&r.kind===t.kind&&r.multi===t.multi&&(e=i)})),r[e]=t})),r}function compileMap(){var t,e,r={scalar:{},sequence:{},mapping:{},fallback:{},multi:{scalar:[],sequence:[],mapping:[],fallback:[]}};function i(t){t.multi?(r.multi[t.kind].push(t),r.multi.fallback.push(t)):r[t.kind][t.tag]=r.fallback[t.tag]=t}for(t=0,e=arguments.length;t<e;t+=1)arguments[t].forEach(i);return r}function Schema$1(t){return this.extend(t)}Schema$1.prototype.extend=function(t){var e=[],r=[];if(t instanceof type)r.push(t);else if(Array.isArray(t))r=r.concat(t);else{if(!t||!Array.isArray(t.implicit)&&!Array.isArray(t.explicit))throw new exception("Schema.extend argument should be a Type, [ Type ], or a schema definition ({ implicit: [...], explicit: [...] })");t.implicit&&(e=e.concat(t.implicit)),t.explicit&&(r=r.concat(t.explicit))}e.forEach((function(t){if(!(t instanceof type))throw new exception("Specified list of YAML types (or a single Type object) contains a non-Type object.");if(t.loadKind&&"scalar"!==t.loadKind)throw new exception("There is a non-scalar type in the implicit list of a schema. Implicit resolving of such types is not supported.");if(t.multi)throw new exception("There is a multi type in the implicit list of a schema. Multi tags can only be listed as explicit.")})),r.forEach((function(t){if(!(t instanceof type))throw new exception("Specified list of YAML types (or a single Type object) contains a non-Type object.")}));var i=Object.create(Schema$1.prototype);return i.implicit=(this.implicit||[]).concat(e),i.explicit=(this.explicit||[]).concat(r),i.compiledImplicit=compileList(i,"implicit"),i.compiledExplicit=compileList(i,"explicit"),i.compiledTypeMap=compileMap(i.compiledImplicit,i.compiledExplicit),i};var schema=Schema$1,str=new type("tag:yaml.org,2002:str",{kind:"scalar",construct:function(t){return null!==t?t:""}}),seq=new type("tag:yaml.org,2002:seq",{kind:"sequence",construct:function(t){return null!==t?t:[]}}),map=new type("tag:yaml.org,2002:map",{kind:"mapping",construct:function(t){return null!==t?t:{}}}),failsafe=new schema({explicit:[str,seq,map]});function resolveYamlNull(t){if(null===t)return!0;var e=t.length;return 1===e&&"~"===t||4===e&&("null"===t||"Null"===t||"NULL"===t)}function constructYamlNull(){return null}function isNull(t){return null===t}var _null=new type("tag:yaml.org,2002:null",{kind:"scalar",resolve:resolveYamlNull,construct:constructYamlNull,predicate:isNull,represent:{canonical:function(){return"~"},lowercase:function(){return"null"},uppercase:function(){return"NULL"},camelcase:function(){return"Null"},empty:function(){return""}},defaultStyle:"lowercase"});function resolveYamlBoolean(t){if(null===t)return!1;var e=t.length;return 4===e&&("true"===t||"True"===t||"TRUE"===t)||5===e&&("false"===t||"False"===t||"FALSE"===t)}function constructYamlBoolean(t){return"true"===t||"True"===t||"TRUE"===t}function isBoolean(t){return"[object Boolean]"===Object.prototype.toString.call(t)}var bool=new type("tag:yaml.org,2002:bool",{kind:"scalar",resolve:resolveYamlBoolean,construct:constructYamlBoolean,predicate:isBoolean,represent:{lowercase:function(t){return t?"true":"false"},uppercase:function(t){return t?"TRUE":"FALSE"},camelcase:function(t){return t?"True":"False"}},defaultStyle:"lowercase"});function isHexCode(t){return 48<=t&&t<=57||65<=t&&t<=70||97<=t&&t<=102}function isOctCode(t){return 48<=t&&t<=55}function isDecCode(t){return 48<=t&&t<=57}function resolveYamlInteger(t){if(null===t)return!1;var e,r=t.length,i=0,n=!1;if(!r)return!1;if("-"!==(e=t[i])&&"+"!==e||(e=t[++i]),"0"===e){if(i+1===r)return!0;if("b"===(e=t[++i])){for(i++;i<r;i++)if("_"!==(e=t[i])){if("0"!==e&&"1"!==e)return!1;n=!0}return n&&"_"!==e}if("x"===e){for(i++;i<r;i++)if("_"!==(e=t[i])){if(!isHexCode(t.charCodeAt(i)))return!1;n=!0}return n&&"_"!==e}if("o"===e){for(i++;i<r;i++)if("_"!==(e=t[i])){if(!isOctCode(t.charCodeAt(i)))return!1;n=!0}return n&&"_"!==e}}if("_"===e)return!1;for(;i<r;i++)if("_"!==(e=t[i])){if(!isDecCode(t.charCodeAt(i)))return!1;n=!0}return!(!n||"_"===e)}function constructYamlInteger(t){var e,r=t,i=1;if(-1!==r.indexOf("_")&&(r=r.replace(/_/g,"")),"-"!==(e=r[0])&&"+"!==e||("-"===e&&(i=-1),e=(r=r.slice(1))[0]),"0"===r)return 0;if("0"===e){if("b"===r[1])return i*parseInt(r.slice(2),2);if("x"===r[1])return i*parseInt(r.slice(2),16);if("o"===r[1])return i*parseInt(r.slice(2),8)}return i*parseInt(r,10)}function isInteger(t){return"[object Number]"===Object.prototype.toString.call(t)&&t%1==0&&!common.isNegativeZero(t)}var int=new type("tag:yaml.org,2002:int",{kind:"scalar",resolve:resolveYamlInteger,construct:constructYamlInteger,predicate:isInteger,represent:{binary:function(t){return t>=0?"0b"+t.toString(2):"-0b"+t.toString(2).slice(1)},octal:function(t){return t>=0?"0o"+t.toString(8):"-0o"+t.toString(8).slice(1)},decimal:function(t){return t.toString(10)},hexadecimal:function(t){return t>=0?"0x"+t.toString(16).toUpperCase():"-0x"+t.toString(16).toUpperCase().slice(1)}},defaultStyle:"decimal",styleAliases:{binary:[2,"bin"],octal:[8,"oct"],decimal:[10,"dec"],hexadecimal:[16,"hex"]}}),YAML_FLOAT_PATTERN=new RegExp("^(?:[-+]?(?:[0-9][0-9_]*)(?:\\.[0-9_]*)?(?:[eE][-+]?[0-9]+)?|\\.[0-9_]+(?:[eE][-+]?[0-9]+)?|[-+]?\\.(?:inf|Inf|INF)|\\.(?:nan|NaN|NAN))$");function resolveYamlFloat(t){return null!==t&&!(!YAML_FLOAT_PATTERN.test(t)||"_"===t[t.length-1])}function constructYamlFloat(t){var e,r;return r="-"===(e=t.replace(/_/g,"").toLowerCase())[0]?-1:1,"+-".indexOf(e[0])>=0&&(e=e.slice(1)),".inf"===e?1===r?Number.POSITIVE_INFINITY:Number.NEGATIVE_INFINITY:".nan"===e?NaN:r*parseFloat(e,10)}var SCIENTIFIC_WITHOUT_DOT=/^[-+]?[0-9]+e/;function representYamlFloat(t,e){var r;if(isNaN(t))switch(e){case"lowercase":return".nan";case"uppercase":return".NAN";case"camelcase":return".NaN"}else if(Number.POSITIVE_INFINITY===t)switch(e){case"lowercase":return".inf";case"uppercase":return".INF";case"camelcase":return".Inf"}else if(Number.NEGATIVE_INFINITY===t)switch(e){case"lowercase":return"-.inf";case"uppercase":return"-.INF";case"camelcase":return"-.Inf"}else if(common.isNegativeZero(t))return"-0.0";return r=t.toString(10),SCIENTIFIC_WITHOUT_DOT.test(r)?r.replace("e",".e"):r}function isFloat(t){return"[object Number]"===Object.prototype.toString.call(t)&&(t%1!=0||common.isNegativeZero(t))}var float=new type("tag:yaml.org,2002:float",{kind:"scalar",resolve:resolveYamlFloat,construct:constructYamlFloat,predicate:isFloat,represent:representYamlFloat,defaultStyle:"lowercase"}),json=failsafe.extend({implicit:[_null,bool,int,float]}),core=json,YAML_DATE_REGEXP=new RegExp("^([0-9][0-9][0-9][0-9])-([0-9][0-9])-([0-9][0-9])$"),YAML_TIMESTAMP_REGEXP=new RegExp("^([0-9][0-9][0-9][0-9])-([0-9][0-9]?)-([0-9][0-9]?)(?:[Tt]|[ \\t]+)([0-9][0-9]?):([0-9][0-9]):([0-9][0-9])(?:\\.([0-9]*))?(?:[ \\t]*(Z|([-+])([0-9][0-9]?)(?::([0-9][0-9]))?))?$");function resolveYamlTimestamp(t){return null!==t&&(null!==YAML_DATE_REGEXP.exec(t)||null!==YAML_TIMESTAMP_REGEXP.exec(t))}function constructYamlTimestamp(t){var e,r,i,n,o,a,s,l,u=0,c=null;if(null===(e=YAML_DATE_REGEXP.exec(t))&&(e=YAML_TIMESTAMP_REGEXP.exec(t)),null===e)throw new Error("Date resolve error");if(r=+e[1],i=+e[2]-1,n=+e[3],!e[4])return new Date(Date.UTC(r,i,n));if(o=+e[4],a=+e[5],s=+e[6],e[7]){for(u=e[7].slice(0,3);u.length<3;)u+="0";u=+u}return e[9]&&(c=6e4*(60*+e[10]+ +(e[11]||0)),"-"===e[9]&&(c=-c)),l=new Date(Date.UTC(r,i,n,o,a,s,u)),c&&l.setTime(l.getTime()-c),l}function representYamlTimestamp(t){return t.toISOString()}var timestamp=new type("tag:yaml.org,2002:timestamp",{kind:"scalar",resolve:resolveYamlTimestamp,construct:constructYamlTimestamp,instanceOf:Date,represent:representYamlTimestamp});function resolveYamlMerge(t){return"<<"===t||null===t}var merge=new type("tag:yaml.org,2002:merge",{kind:"scalar",resolve:resolveYamlMerge}),BASE64_MAP="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=\n\r";function resolveYamlBinary(t){if(null===t)return!1;var e,r,i=0,n=t.length,o=BASE64_MAP;for(r=0;r<n;r++)if(!((e=o.indexOf(t.charAt(r)))>64)){if(e<0)return!1;i+=6}return i%8==0}function constructYamlBinary(t){var e,r,i=t.replace(/[\r\n=]/g,""),n=i.length,o=BASE64_MAP,a=0,s=[];for(e=0;e<n;e++)e%4==0&&e&&(s.push(a>>16&255),s.push(a>>8&255),s.push(255&a)),a=a<<6|o.indexOf(i.charAt(e));return 0==(r=n%4*6)?(s.push(a>>16&255),s.push(a>>8&255),s.push(255&a)):18===r?(s.push(a>>10&255),s.push(a>>2&255)):12===r&&s.push(a>>4&255),new Uint8Array(s)}function representYamlBinary(t){var e,r,i="",n=0,o=t.length,a=BASE64_MAP;for(e=0;e<o;e++)e%3==0&&e&&(i+=a[n>>18&63],i+=a[n>>12&63],i+=a[n>>6&63],i+=a[63&n]),n=(n<<8)+t[e];return 0==(r=o%3)?(i+=a[n>>18&63],i+=a[n>>12&63],i+=a[n>>6&63],i+=a[63&n]):2===r?(i+=a[n>>10&63],i+=a[n>>4&63],i+=a[n<<2&63],i+=a[64]):1===r&&(i+=a[n>>2&63],i+=a[n<<4&63],i+=a[64],i+=a[64]),i}function isBinary(t){return"[object Uint8Array]"===Object.prototype.toString.call(t)}var binary=new type("tag:yaml.org,2002:binary",{kind:"scalar",resolve:resolveYamlBinary,construct:constructYamlBinary,predicate:isBinary,represent:representYamlBinary}),_hasOwnProperty$3=Object.prototype.hasOwnProperty,_toString$2=Object.prototype.toString;function resolveYamlOmap(t){if(null===t)return!0;var e,r,i,n,o,a=[],s=t;for(e=0,r=s.length;e<r;e+=1){if(i=s[e],o=!1,"[object Object]"!==_toString$2.call(i))return!1;for(n in i)if(_hasOwnProperty$3.call(i,n)){if(o)return!1;o=!0}if(!o)return!1;if(-1!==a.indexOf(n))return!1;a.push(n)}return!0}function constructYamlOmap(t){return null!==t?t:[]}var omap=new type("tag:yaml.org,2002:omap",{kind:"sequence",resolve:resolveYamlOmap,construct:constructYamlOmap}),_toString$1=Object.prototype.toString;function resolveYamlPairs(t){if(null===t)return!0;var e,r,i,n,o,a=t;for(o=new Array(a.length),e=0,r=a.length;e<r;e+=1){if(i=a[e],"[object Object]"!==_toString$1.call(i))return!1;if(1!==(n=Object.keys(i)).length)return!1;o[e]=[n[0],i[n[0]]]}return!0}function constructYamlPairs(t){if(null===t)return[];var e,r,i,n,o,a=t;for(o=new Array(a.length),e=0,r=a.length;e<r;e+=1)i=a[e],n=Object.keys(i),o[e]=[n[0],i[n[0]]];return o}var pairs=new type("tag:yaml.org,2002:pairs",{kind:"sequence",resolve:resolveYamlPairs,construct:constructYamlPairs}),_hasOwnProperty$2=Object.prototype.hasOwnProperty;function resolveYamlSet(t){if(null===t)return!0;var e,r=t;for(e in r)if(_hasOwnProperty$2.call(r,e)&&null!==r[e])return!1;return!0}function constructYamlSet(t){return null!==t?t:{}}var set=new type("tag:yaml.org,2002:set",{kind:"mapping",resolve:resolveYamlSet,construct:constructYamlSet}),_default=core.extend({implicit:[timestamp,merge],explicit:[binary,omap,pairs,set]}),_hasOwnProperty$1=Object.prototype.hasOwnProperty,CONTEXT_FLOW_IN=1,CONTEXT_FLOW_OUT=2,CONTEXT_BLOCK_IN=3,CONTEXT_BLOCK_OUT=4,CHOMPING_CLIP=1,CHOMPING_STRIP=2,CHOMPING_KEEP=3,PATTERN_NON_PRINTABLE=/[\x00-\x08\x0B\x0C\x0E-\x1F\x7F-\x84\x86-\x9F\uFFFE\uFFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF]/,PATTERN_NON_ASCII_LINE_BREAKS=/[\x85\u2028\u2029]/,PATTERN_FLOW_INDICATORS=/[,\[\]\{\}]/,PATTERN_TAG_HANDLE=/^(?:!|!!|![a-z\-]+!)$/i,PATTERN_TAG_URI=/^(?:!|[^,\[\]\{\}])(?:%[0-9a-f]{2}|[0-9a-z\-#;\/\?:@&=\+\$,_\.!~\*'\(\)\[\]])*$/i;function _class(t){return Object.prototype.toString.call(t)}function is_EOL(t){return 10===t||13===t}function is_WHITE_SPACE(t){return 9===t||32===t}function is_WS_OR_EOL(t){return 9===t||32===t||10===t||13===t}function is_FLOW_INDICATOR(t){return 44===t||91===t||93===t||123===t||125===t}function fromHexCode(t){var e;return 48<=t&&t<=57?t-48:97<=(e=32|t)&&e<=102?e-97+10:-1}function escapedHexLen(t){return 120===t?2:117===t?4:85===t?8:0}function fromDecimalCode(t){return 48<=t&&t<=57?t-48:-1}function simpleEscapeSequence(t){return 48===t?"\0":97===t?"":98===t?"\b":116===t||9===t?"\t":110===t?"\n":118===t?"\v":102===t?"\f":114===t?"\r":101===t?"":32===t?" ":34===t?'"':47===t?"/":92===t?"\\":78===t?"":95===t?" ":76===t?"\u2028":80===t?"\u2029":""}function charFromCodepoint(t){return t<=65535?String.fromCharCode(t):String.fromCharCode(55296+(t-65536>>10),56320+(t-65536&1023))}for(var simpleEscapeCheck=new Array(256),simpleEscapeMap=new Array(256),i=0;i<256;i++)simpleEscapeCheck[i]=simpleEscapeSequence(i)?1:0,simpleEscapeMap[i]=simpleEscapeSequence(i);function State$1(t,e){this.input=t,this.filename=e.filename||null,this.schema=e.schema||_default,this.onWarning=e.onWarning||null,this.legacy=e.legacy||!1,this.json=e.json||!1,this.listener=e.listener||null,this.implicitTypes=this.schema.compiledImplicit,this.typeMap=this.schema.compiledTypeMap,this.length=t.length,this.position=0,this.line=0,this.lineStart=0,this.lineIndent=0,this.firstTabInLine=-1,this.documents=[]}function generateError(t,e){var r={name:t.filename,buffer:t.input.slice(0,-1),position:t.position,line:t.line,column:t.position-t.lineStart};return r.snippet=snippet(r),new exception(e,r)}function throwError(t,e){throw generateError(t,e)}function throwWarning(t,e){t.onWarning&&t.onWarning.call(null,generateError(t,e))}var directiveHandlers={YAML:function(t,e,r){var i,n,o;null!==t.version&&throwError(t,"duplication of %YAML directive"),1!==r.length&&throwError(t,"YAML directive accepts exactly one argument"),null===(i=/^([0-9]+)\.([0-9]+)$/.exec(r[0]))&&throwError(t,"ill-formed argument of the YAML directive"),n=parseInt(i[1],10),o=parseInt(i[2],10),1!==n&&throwError(t,"unacceptable YAML version of the document"),t.version=r[0],t.checkLineBreaks=o<2,1!==o&&2!==o&&throwWarning(t,"unsupported YAML version of the document")},TAG:function(t,e,r){var i,n;2!==r.length&&throwError(t,"TAG directive accepts exactly two arguments"),i=r[0],n=r[1],PATTERN_TAG_HANDLE.test(i)||throwError(t,"ill-formed tag handle (first argument) of the TAG directive"),_hasOwnProperty$1.call(t.tagMap,i)&&throwError(t,'there is a previously declared suffix for "'+i+'" tag handle'),PATTERN_TAG_URI.test(n)||throwError(t,"ill-formed tag prefix (second argument) of the TAG directive");try{n=decodeURIComponent(n)}catch(e){throwError(t,"tag prefix is malformed: "+n)}t.tagMap[i]=n}};function captureSegment(t,e,r,i){var n,o,a,s;if(e<r){if(s=t.input.slice(e,r),i)for(n=0,o=s.length;n<o;n+=1)9===(a=s.charCodeAt(n))||32<=a&&a<=1114111||throwError(t,"expected valid JSON character");else PATTERN_NON_PRINTABLE.test(s)&&throwError(t,"the stream contains non-printable characters");t.result+=s}}function mergeMappings(t,e,r,i){var n,o,a,s;for(common.isObject(r)||throwError(t,"cannot merge mappings; the provided source object is unacceptable"),a=0,s=(n=Object.keys(r)).length;a<s;a+=1)o=n[a],_hasOwnProperty$1.call(e,o)||(e[o]=r[o],i[o]=!0)}function storeMappingPair(t,e,r,i,n,o,a,s,l){var u,c;if(Array.isArray(n))for(u=0,c=(n=Array.prototype.slice.call(n)).length;u<c;u+=1)Array.isArray(n[u])&&throwError(t,"nested arrays are not supported inside keys"),"object"==typeof n&&"[object Object]"===_class(n[u])&&(n[u]="[object Object]");if("object"==typeof n&&"[object Object]"===_class(n)&&(n="[object Object]"),n=String(n),null===e&&(e={}),"tag:yaml.org,2002:merge"===i)if(Array.isArray(o))for(u=0,c=o.length;u<c;u+=1)mergeMappings(t,e,o[u],r);else mergeMappings(t,e,o,r);else t.json||_hasOwnProperty$1.call(r,n)||!_hasOwnProperty$1.call(e,n)||(t.line=a||t.line,t.lineStart=s||t.lineStart,t.position=l||t.position,throwError(t,"duplicated mapping key")),"__proto__"===n?Object.defineProperty(e,n,{configurable:!0,enumerable:!0,writable:!0,value:o}):e[n]=o,delete r[n];return e}function readLineBreak(t){var e;10===(e=t.input.charCodeAt(t.position))?t.position++:13===e?(t.position++,10===t.input.charCodeAt(t.position)&&t.position++):throwError(t,"a line break is expected"),t.line+=1,t.lineStart=t.position,t.firstTabInLine=-1}function skipSeparationSpace(t,e,r){for(var i=0,n=t.input.charCodeAt(t.position);0!==n;){for(;is_WHITE_SPACE(n);)9===n&&-1===t.firstTabInLine&&(t.firstTabInLine=t.position),n=t.input.charCodeAt(++t.position);if(e&&35===n)do{n=t.input.charCodeAt(++t.position)}while(10!==n&&13!==n&&0!==n);if(!is_EOL(n))break;for(readLineBreak(t),n=t.input.charCodeAt(t.position),i++,t.lineIndent=0;32===n;)t.lineIndent++,n=t.input.charCodeAt(++t.position)}return-1!==r&&0!==i&&t.lineIndent<r&&throwWarning(t,"deficient indentation"),i}function testDocumentSeparator(t){var e,r=t.position;return!(45!==(e=t.input.charCodeAt(r))&&46!==e||e!==t.input.charCodeAt(r+1)||e!==t.input.charCodeAt(r+2)||(r+=3,0!==(e=t.input.charCodeAt(r))&&!is_WS_OR_EOL(e)))}function writeFoldedLines(t,e){1===e?t.result+=" ":e>1&&(t.result+=common.repeat("\n",e-1))}function readPlainScalar(t,e,r){var i,n,o,a,s,l,u,c,h=t.kind,p=t.result;if(is_WS_OR_EOL(c=t.input.charCodeAt(t.position))||is_FLOW_INDICATOR(c)||35===c||38===c||42===c||33===c||124===c||62===c||39===c||34===c||37===c||64===c||96===c)return!1;if((63===c||45===c)&&(is_WS_OR_EOL(i=t.input.charCodeAt(t.position+1))||r&&is_FLOW_INDICATOR(i)))return!1;for(t.kind="scalar",t.result="",n=o=t.position,a=!1;0!==c;){if(58===c){if(is_WS_OR_EOL(i=t.input.charCodeAt(t.position+1))||r&&is_FLOW_INDICATOR(i))break}else if(35===c){if(is_WS_OR_EOL(t.input.charCodeAt(t.position-1)))break}else{if(t.position===t.lineStart&&testDocumentSeparator(t)||r&&is_FLOW_INDICATOR(c))break;if(is_EOL(c)){if(s=t.line,l=t.lineStart,u=t.lineIndent,skipSeparationSpace(t,!1,-1),t.lineIndent>=e){a=!0,c=t.input.charCodeAt(t.position);continue}t.position=o,t.line=s,t.lineStart=l,t.lineIndent=u;break}}a&&(captureSegment(t,n,o,!1),writeFoldedLines(t,t.line-s),n=o=t.position,a=!1),is_WHITE_SPACE(c)||(o=t.position+1),c=t.input.charCodeAt(++t.position)}return captureSegment(t,n,o,!1),!!t.result||(t.kind=h,t.result=p,!1)}function readSingleQuotedScalar(t,e){var r,i,n;if(39!==(r=t.input.charCodeAt(t.position)))return!1;for(t.kind="scalar",t.result="",t.position++,i=n=t.position;0!==(r=t.input.charCodeAt(t.position));)if(39===r){if(captureSegment(t,i,t.position,!0),39!==(r=t.input.charCodeAt(++t.position)))return!0;i=t.position,t.position++,n=t.position}else is_EOL(r)?(captureSegment(t,i,n,!0),writeFoldedLines(t,skipSeparationSpace(t,!1,e)),i=n=t.position):t.position===t.lineStart&&testDocumentSeparator(t)?throwError(t,"unexpected end of the document within a single quoted scalar"):(t.position++,n=t.position);throwError(t,"unexpected end of the stream within a single quoted scalar")}function readDoubleQuotedScalar(t,e){var r,i,n,o,a,s;if(34!==(s=t.input.charCodeAt(t.position)))return!1;for(t.kind="scalar",t.result="",t.position++,r=i=t.position;0!==(s=t.input.charCodeAt(t.position));){if(34===s)return captureSegment(t,r,t.position,!0),t.position++,!0;if(92===s){if(captureSegment(t,r,t.position,!0),is_EOL(s=t.input.charCodeAt(++t.position)))skipSeparationSpace(t,!1,e);else if(s<256&&simpleEscapeCheck[s])t.result+=simpleEscapeMap[s],t.position++;else if((a=escapedHexLen(s))>0){for(n=a,o=0;n>0;n--)(a=fromHexCode(s=t.input.charCodeAt(++t.position)))>=0?o=(o<<4)+a:throwError(t,"expected hexadecimal character");t.result+=charFromCodepoint(o),t.position++}else throwError(t,"unknown escape sequence");r=i=t.position}else is_EOL(s)?(captureSegment(t,r,i,!0),writeFoldedLines(t,skipSeparationSpace(t,!1,e)),r=i=t.position):t.position===t.lineStart&&testDocumentSeparator(t)?throwError(t,"unexpected end of the document within a double quoted scalar"):(t.position++,i=t.position)}throwError(t,"unexpected end of the stream within a double quoted scalar")}function readFlowCollection(t,e){var r,i,n,o,a,s,l,u,c,h,p,f,d=!0,y=t.tag,g=t.anchor,v=Object.create(null);if(91===(f=t.input.charCodeAt(t.position)))a=93,u=!1,o=[];else{if(123!==f)return!1;a=125,u=!0,o={}}for(null!==t.anchor&&(t.anchorMap[t.anchor]=o),f=t.input.charCodeAt(++t.position);0!==f;){if(skipSeparationSpace(t,!0,e),(f=t.input.charCodeAt(t.position))===a)return t.position++,t.tag=y,t.anchor=g,t.kind=u?"mapping":"sequence",t.result=o,!0;d?44===f&&throwError(t,"expected the node content, but found ','"):throwError(t,"missed comma between flow collection entries"),p=null,s=l=!1,63===f&&is_WS_OR_EOL(t.input.charCodeAt(t.position+1))&&(s=l=!0,t.position++,skipSeparationSpace(t,!0,e)),r=t.line,i=t.lineStart,n=t.position,composeNode(t,e,CONTEXT_FLOW_IN,!1,!0),h=t.tag,c=t.result,skipSeparationSpace(t,!0,e),f=t.input.charCodeAt(t.position),!l&&t.line!==r||58!==f||(s=!0,f=t.input.charCodeAt(++t.position),skipSeparationSpace(t,!0,e),composeNode(t,e,CONTEXT_FLOW_IN,!1,!0),p=t.result),u?storeMappingPair(t,o,v,h,c,p,r,i,n):s?o.push(storeMappingPair(t,null,v,h,c,p,r,i,n)):o.push(c),skipSeparationSpace(t,!0,e),44===(f=t.input.charCodeAt(t.position))?(d=!0,f=t.input.charCodeAt(++t.position)):d=!1}throwError(t,"unexpected end of the stream within a flow collection")}function readBlockScalar(t,e){var r,i,n,o,a=CHOMPING_CLIP,s=!1,l=!1,u=e,c=0,h=!1;if(124===(o=t.input.charCodeAt(t.position)))i=!1;else{if(62!==o)return!1;i=!0}for(t.kind="scalar",t.result="";0!==o;)if(43===(o=t.input.charCodeAt(++t.position))||45===o)CHOMPING_CLIP===a?a=43===o?CHOMPING_KEEP:CHOMPING_STRIP:throwError(t,"repeat of a chomping mode identifier");else{if(!((n=fromDecimalCode(o))>=0))break;0===n?throwError(t,"bad explicit indentation width of a block scalar; it cannot be less than one"):l?throwError(t,"repeat of an indentation width identifier"):(u=e+n-1,l=!0)}if(is_WHITE_SPACE(o)){do{o=t.input.charCodeAt(++t.position)}while(is_WHITE_SPACE(o));if(35===o)do{o=t.input.charCodeAt(++t.position)}while(!is_EOL(o)&&0!==o)}for(;0!==o;){for(readLineBreak(t),t.lineIndent=0,o=t.input.charCodeAt(t.position);(!l||t.lineIndent<u)&&32===o;)t.lineIndent++,o=t.input.charCodeAt(++t.position);if(!l&&t.lineIndent>u&&(u=t.lineIndent),is_EOL(o))c++;else{if(t.lineIndent<u){a===CHOMPING_KEEP?t.result+=common.repeat("\n",s?1+c:c):a===CHOMPING_CLIP&&s&&(t.result+="\n");break}for(i?is_WHITE_SPACE(o)?(h=!0,t.result+=common.repeat("\n",s?1+c:c)):h?(h=!1,t.result+=common.repeat("\n",c+1)):0===c?s&&(t.result+=" "):t.result+=common.repeat("\n",c):t.result+=common.repeat("\n",s?1+c:c),s=!0,l=!0,c=0,r=t.position;!is_EOL(o)&&0!==o;)o=t.input.charCodeAt(++t.position);captureSegment(t,r,t.position,!1)}}return!0}function readBlockSequence(t,e){var r,i,n=t.tag,o=t.anchor,a=[],s=!1;if(-1!==t.firstTabInLine)return!1;for(null!==t.anchor&&(t.anchorMap[t.anchor]=a),i=t.input.charCodeAt(t.position);0!==i&&(-1!==t.firstTabInLine&&(t.position=t.firstTabInLine,throwError(t,"tab characters must not be used in indentation")),45===i)&&is_WS_OR_EOL(t.input.charCodeAt(t.position+1));)if(s=!0,t.position++,skipSeparationSpace(t,!0,-1)&&t.lineIndent<=e)a.push(null),i=t.input.charCodeAt(t.position);else if(r=t.line,composeNode(t,e,CONTEXT_BLOCK_IN,!1,!0),a.push(t.result),skipSeparationSpace(t,!0,-1),i=t.input.charCodeAt(t.position),(t.line===r||t.lineIndent>e)&&0!==i)throwError(t,"bad indentation of a sequence entry");else if(t.lineIndent<e)break;return!!s&&(t.tag=n,t.anchor=o,t.kind="sequence",t.result=a,!0)}function readBlockMapping(t,e,r){var i,n,o,a,s,l,u,c=t.tag,h=t.anchor,p={},f=Object.create(null),d=null,y=null,g=null,v=!1,m=!1;if(-1!==t.firstTabInLine)return!1;for(null!==t.anchor&&(t.anchorMap[t.anchor]=p),u=t.input.charCodeAt(t.position);0!==u;){if(v||-1===t.firstTabInLine||(t.position=t.firstTabInLine,throwError(t,"tab characters must not be used in indentation")),i=t.input.charCodeAt(t.position+1),o=t.line,63!==u&&58!==u||!is_WS_OR_EOL(i)){if(a=t.line,s=t.lineStart,l=t.position,!composeNode(t,r,CONTEXT_FLOW_OUT,!1,!0))break;if(t.line===o){for(u=t.input.charCodeAt(t.position);is_WHITE_SPACE(u);)u=t.input.charCodeAt(++t.position);if(58===u)is_WS_OR_EOL(u=t.input.charCodeAt(++t.position))||throwError(t,"a whitespace character is expected after the key-value separator within a block mapping"),v&&(storeMappingPair(t,p,f,d,y,null,a,s,l),d=y=g=null),m=!0,v=!1,n=!1,d=t.tag,y=t.result;else{if(!m)return t.tag=c,t.anchor=h,!0;throwError(t,"can not read an implicit mapping pair; a colon is missed")}}else{if(!m)return t.tag=c,t.anchor=h,!0;throwError(t,"can not read a block mapping entry; a multiline key may not be an implicit key")}}else 63===u?(v&&(storeMappingPair(t,p,f,d,y,null,a,s,l),d=y=g=null),m=!0,v=!0,n=!0):v?(v=!1,n=!0):throwError(t,"incomplete explicit mapping pair; a key node is missed; or followed by a non-tabulated empty line"),t.position+=1,u=i;if((t.line===o||t.lineIndent>e)&&(v&&(a=t.line,s=t.lineStart,l=t.position),composeNode(t,e,CONTEXT_BLOCK_OUT,!0,n)&&(v?y=t.result:g=t.result),v||(storeMappingPair(t,p,f,d,y,g,a,s,l),d=y=g=null),skipSeparationSpace(t,!0,-1),u=t.input.charCodeAt(t.position)),(t.line===o||t.lineIndent>e)&&0!==u)throwError(t,"bad indentation of a mapping entry");else if(t.lineIndent<e)break}return v&&storeMappingPair(t,p,f,d,y,null,a,s,l),m&&(t.tag=c,t.anchor=h,t.kind="mapping",t.result=p),m}function readTagProperty(t){var e,r,i,n,o=!1,a=!1;if(33!==(n=t.input.charCodeAt(t.position)))return!1;if(null!==t.tag&&throwError(t,"duplication of a tag property"),60===(n=t.input.charCodeAt(++t.position))?(o=!0,n=t.input.charCodeAt(++t.position)):33===n?(a=!0,r="!!",n=t.input.charCodeAt(++t.position)):r="!",e=t.position,o){do{n=t.input.charCodeAt(++t.position)}while(0!==n&&62!==n);t.position<t.length?(i=t.input.slice(e,t.position),n=t.input.charCodeAt(++t.position)):throwError(t,"unexpected end of the stream within a verbatim tag")}else{for(;0!==n&&!is_WS_OR_EOL(n);)33===n&&(a?throwError(t,"tag suffix cannot contain exclamation marks"):(r=t.input.slice(e-1,t.position+1),PATTERN_TAG_HANDLE.test(r)||throwError(t,"named tag handle cannot contain such characters"),a=!0,e=t.position+1)),n=t.input.charCodeAt(++t.position);i=t.input.slice(e,t.position),PATTERN_FLOW_INDICATORS.test(i)&&throwError(t,"tag suffix cannot contain flow indicator characters")}i&&!PATTERN_TAG_URI.test(i)&&throwError(t,"tag name cannot contain such characters: "+i);try{i=decodeURIComponent(i)}catch(e){throwError(t,"tag name is malformed: "+i)}return o?t.tag=i:_hasOwnProperty$1.call(t.tagMap,r)?t.tag=t.tagMap[r]+i:"!"===r?t.tag="!"+i:"!!"===r?t.tag="tag:yaml.org,2002:"+i:throwError(t,'undeclared tag handle "'+r+'"'),!0}function readAnchorProperty(t){var e,r;if(38!==(r=t.input.charCodeAt(t.position)))return!1;for(null!==t.anchor&&throwError(t,"duplication of an anchor property"),r=t.input.charCodeAt(++t.position),e=t.position;0!==r&&!is_WS_OR_EOL(r)&&!is_FLOW_INDICATOR(r);)r=t.input.charCodeAt(++t.position);return t.position===e&&throwError(t,"name of an anchor node must contain at least one character"),t.anchor=t.input.slice(e,t.position),!0}function readAlias(t){var e,r,i;if(42!==(i=t.input.charCodeAt(t.position)))return!1;for(i=t.input.charCodeAt(++t.position),e=t.position;0!==i&&!is_WS_OR_EOL(i)&&!is_FLOW_INDICATOR(i);)i=t.input.charCodeAt(++t.position);return t.position===e&&throwError(t,"name of an alias node must contain at least one character"),r=t.input.slice(e,t.position),_hasOwnProperty$1.call(t.anchorMap,r)||throwError(t,'unidentified alias "'+r+'"'),t.result=t.anchorMap[r],skipSeparationSpace(t,!0,-1),!0}function composeNode(t,e,r,i,n){var o,a,s,l,u,c,h,p,f,d=1,y=!1,g=!1;if(null!==t.listener&&t.listener("open",t),t.tag=null,t.anchor=null,t.kind=null,t.result=null,o=a=s=CONTEXT_BLOCK_OUT===r||CONTEXT_BLOCK_IN===r,i&&skipSeparationSpace(t,!0,-1)&&(y=!0,t.lineIndent>e?d=1:t.lineIndent===e?d=0:t.lineIndent<e&&(d=-1)),1===d)for(;readTagProperty(t)||readAnchorProperty(t);)skipSeparationSpace(t,!0,-1)?(y=!0,s=o,t.lineIndent>e?d=1:t.lineIndent===e?d=0:t.lineIndent<e&&(d=-1)):s=!1;if(s&&(s=y||n),1!==d&&CONTEXT_BLOCK_OUT!==r||(p=CONTEXT_FLOW_IN===r||CONTEXT_FLOW_OUT===r?e:e+1,f=t.position-t.lineStart,1===d?s&&(readBlockSequence(t,f)||readBlockMapping(t,f,p))||readFlowCollection(t,p)?g=!0:(a&&readBlockScalar(t,p)||readSingleQuotedScalar(t,p)||readDoubleQuotedScalar(t,p)?g=!0:readAlias(t)?(g=!0,null===t.tag&&null===t.anchor||throwError(t,"alias node should not have any properties")):readPlainScalar(t,p,CONTEXT_FLOW_IN===r)&&(g=!0,null===t.tag&&(t.tag="?")),null!==t.anchor&&(t.anchorMap[t.anchor]=t.result)):0===d&&(g=s&&readBlockSequence(t,f))),null===t.tag)null!==t.anchor&&(t.anchorMap[t.anchor]=t.result);else if("?"===t.tag){for(null!==t.result&&"scalar"!==t.kind&&throwError(t,'unacceptable node kind for !<?> tag; it should be "scalar", not "'+t.kind+'"'),l=0,u=t.implicitTypes.length;l<u;l+=1)if((h=t.implicitTypes[l]).resolve(t.result)){t.result=h.construct(t.result),t.tag=h.tag,null!==t.anchor&&(t.anchorMap[t.anchor]=t.result);break}}else if("!"!==t.tag){if(_hasOwnProperty$1.call(t.typeMap[t.kind||"fallback"],t.tag))h=t.typeMap[t.kind||"fallback"][t.tag];else for(h=null,l=0,u=(c=t.typeMap.multi[t.kind||"fallback"]).length;l<u;l+=1)if(t.tag.slice(0,c[l].tag.length)===c[l].tag){h=c[l];break}h||throwError(t,"unknown tag !<"+t.tag+">"),null!==t.result&&h.kind!==t.kind&&throwError(t,"unacceptable node kind for !<"+t.tag+'> tag; it should be "'+h.kind+'", not "'+t.kind+'"'),h.resolve(t.result,t.tag)?(t.result=h.construct(t.result,t.tag),null!==t.anchor&&(t.anchorMap[t.anchor]=t.result)):throwError(t,"cannot resolve a node with !<"+t.tag+"> explicit tag")}return null!==t.listener&&t.listener("close",t),null!==t.tag||null!==t.anchor||g}function readDocument(t){var e,r,i,n,o=t.position,a=!1;for(t.version=null,t.checkLineBreaks=t.legacy,t.tagMap=Object.create(null),t.anchorMap=Object.create(null);0!==(n=t.input.charCodeAt(t.position))&&(skipSeparationSpace(t,!0,-1),n=t.input.charCodeAt(t.position),!(t.lineIndent>0||37!==n));){for(a=!0,n=t.input.charCodeAt(++t.position),e=t.position;0!==n&&!is_WS_OR_EOL(n);)n=t.input.charCodeAt(++t.position);for(i=[],(r=t.input.slice(e,t.position)).length<1&&throwError(t,"directive name must not be less than one character in length");0!==n;){for(;is_WHITE_SPACE(n);)n=t.input.charCodeAt(++t.position);if(35===n){do{n=t.input.charCodeAt(++t.position)}while(0!==n&&!is_EOL(n));break}if(is_EOL(n))break;for(e=t.position;0!==n&&!is_WS_OR_EOL(n);)n=t.input.charCodeAt(++t.position);i.push(t.input.slice(e,t.position))}0!==n&&readLineBreak(t),_hasOwnProperty$1.call(directiveHandlers,r)?directiveHandlers[r](t,r,i):throwWarning(t,'unknown document directive "'+r+'"')}skipSeparationSpace(t,!0,-1),0===t.lineIndent&&45===t.input.charCodeAt(t.position)&&45===t.input.charCodeAt(t.position+1)&&45===t.input.charCodeAt(t.position+2)?(t.position+=3,skipSeparationSpace(t,!0,-1)):a&&throwError(t,"directives end mark is expected"),composeNode(t,t.lineIndent-1,CONTEXT_BLOCK_OUT,!1,!0),skipSeparationSpace(t,!0,-1),t.checkLineBreaks&&PATTERN_NON_ASCII_LINE_BREAKS.test(t.input.slice(o,t.position))&&throwWarning(t,"non-ASCII line breaks are interpreted as content"),t.documents.push(t.result),t.position===t.lineStart&&testDocumentSeparator(t)?46===t.input.charCodeAt(t.position)&&(t.position+=3,skipSeparationSpace(t,!0,-1)):t.position<t.length-1&&throwError(t,"end of the stream or a document separator is expected")}function loadDocuments(t,e){e=e||{},0!==(t=String(t)).length&&(10!==t.charCodeAt(t.length-1)&&13!==t.charCodeAt(t.length-1)&&(t+="\n"),65279===t.charCodeAt(0)&&(t=t.slice(1)));var r=new State$1(t,e),i=t.indexOf("\0");for(-1!==i&&(r.position=i,throwError(r,"null byte is not allowed in input")),r.input+="\0";32===r.input.charCodeAt(r.position);)r.lineIndent+=1,r.position+=1;for(;r.position<r.length-1;)readDocument(r);return r.documents}function loadAll$1(t,e,r){null!==e&&"object"==typeof e&&void 0===r&&(r=e,e=null);var i=loadDocuments(t,r);if("function"!=typeof e)return i;for(var n=0,o=i.length;n<o;n+=1)e(i[n])}function load$1(t,e){var r=loadDocuments(t,e);if(0!==r.length){if(1===r.length)return r[0];throw new exception("expected a single document in the stream, but found more")}}var loadAll_1=loadAll$1,load_1=load$1,loader={loadAll:loadAll_1,load:load_1},_toString=Object.prototype.toString,_hasOwnProperty=Object.prototype.hasOwnProperty,CHAR_BOM=65279,CHAR_TAB=9,CHAR_LINE_FEED=10,CHAR_CARRIAGE_RETURN=13,CHAR_SPACE=32,CHAR_EXCLAMATION=33,CHAR_DOUBLE_QUOTE=34,CHAR_SHARP=35,CHAR_PERCENT=37,CHAR_AMPERSAND=38,CHAR_SINGLE_QUOTE=39,CHAR_ASTERISK=42,CHAR_COMMA=44,CHAR_MINUS=45,CHAR_COLON=58,CHAR_EQUALS=61,CHAR_GREATER_THAN=62,CHAR_QUESTION=63,CHAR_COMMERCIAL_AT=64,CHAR_LEFT_SQUARE_BRACKET=91,CHAR_RIGHT_SQUARE_BRACKET=93,CHAR_GRAVE_ACCENT=96,CHAR_LEFT_CURLY_BRACKET=123,CHAR_VERTICAL_LINE=124,CHAR_RIGHT_CURLY_BRACKET=125,ESCAPE_SEQUENCES={0:"\\0",7:"\\a",8:"\\b",9:"\\t",10:"\\n",11:"\\v",12:"\\f",13:"\\r",27:"\\e",34:'\\"',92:"\\\\",133:"\\N",160:"\\_",8232:"\\L",8233:"\\P"},DEPRECATED_BOOLEANS_SYNTAX=["y","Y","yes","Yes","YES","on","On","ON","n","N","no","No","NO","off","Off","OFF"],DEPRECATED_BASE60_SYNTAX=/^[-+]?[0-9_]+(?::[0-9_]+)+(?:\.[0-9_]*)?$/;function compileStyleMap(t,e){var r,i,n,o,a,s,l;if(null===e)return{};for(r={},n=0,o=(i=Object.keys(e)).length;n<o;n+=1)a=i[n],s=String(e[a]),"!!"===a.slice(0,2)&&(a="tag:yaml.org,2002:"+a.slice(2)),(l=t.compiledTypeMap.fallback[a])&&_hasOwnProperty.call(l.styleAliases,s)&&(s=l.styleAliases[s]),r[a]=s;return r}function encodeHex(t){var e,r,i;if(e=t.toString(16).toUpperCase(),t<=255)r="x",i=2;else if(t<=65535)r="u",i=4;else{if(!(t<=4294967295))throw new exception("code point within a string may not be greater than 0xFFFFFFFF");r="U",i=8}return"\\"+r+common.repeat("0",i-e.length)+e}var QUOTING_TYPE_SINGLE=1,QUOTING_TYPE_DOUBLE=2;function State(t){this.schema=t.schema||_default,this.indent=Math.max(1,t.indent||2),this.noArrayIndent=t.noArrayIndent||!1,this.skipInvalid=t.skipInvalid||!1,this.flowLevel=common.isNothing(t.flowLevel)?-1:t.flowLevel,this.styleMap=compileStyleMap(this.schema,t.styles||null),this.sortKeys=t.sortKeys||!1,this.lineWidth=t.lineWidth||80,this.noRefs=t.noRefs||!1,this.noCompatMode=t.noCompatMode||!1,this.condenseFlow=t.condenseFlow||!1,this.quotingType='"'===t.quotingType?QUOTING_TYPE_DOUBLE:QUOTING_TYPE_SINGLE,this.forceQuotes=t.forceQuotes||!1,this.replacer="function"==typeof t.replacer?t.replacer:null,this.implicitTypes=this.schema.compiledImplicit,this.explicitTypes=this.schema.compiledExplicit,this.tag=null,this.result="",this.duplicates=[],this.usedDuplicates=null}function indentString(t,e){for(var r,i=common.repeat(" ",e),n=0,o=-1,a="",s=t.length;n<s;)-1===(o=t.indexOf("\n",n))?(r=t.slice(n),n=s):(r=t.slice(n,o+1),n=o+1),r.length&&"\n"!==r&&(a+=i),a+=r;return a}function generateNextLine(t,e){return"\n"+common.repeat(" ",t.indent*e)}function testImplicitResolving(t,e){var r,i;for(r=0,i=t.implicitTypes.length;r<i;r+=1)if(t.implicitTypes[r].resolve(e))return!0;return!1}function isWhitespace(t){return t===CHAR_SPACE||t===CHAR_TAB}function isPrintable(t){return 32<=t&&t<=126||161<=t&&t<=55295&&8232!==t&&8233!==t||57344<=t&&t<=65533&&t!==CHAR_BOM||65536<=t&&t<=1114111}function isNsCharOrWhitespace(t){return isPrintable(t)&&t!==CHAR_BOM&&t!==CHAR_CARRIAGE_RETURN&&t!==CHAR_LINE_FEED}function isPlainSafe(t,e,r){var i=isNsCharOrWhitespace(t),n=i&&!isWhitespace(t);return(r?i:i&&t!==CHAR_COMMA&&t!==CHAR_LEFT_SQUARE_BRACKET&&t!==CHAR_RIGHT_SQUARE_BRACKET&&t!==CHAR_LEFT_CURLY_BRACKET&&t!==CHAR_RIGHT_CURLY_BRACKET)&&t!==CHAR_SHARP&&!(e===CHAR_COLON&&!n)||isNsCharOrWhitespace(e)&&!isWhitespace(e)&&t===CHAR_SHARP||e===CHAR_COLON&&n}function isPlainSafeFirst(t){return isPrintable(t)&&t!==CHAR_BOM&&!isWhitespace(t)&&t!==CHAR_MINUS&&t!==CHAR_QUESTION&&t!==CHAR_COLON&&t!==CHAR_COMMA&&t!==CHAR_LEFT_SQUARE_BRACKET&&t!==CHAR_RIGHT_SQUARE_BRACKET&&t!==CHAR_LEFT_CURLY_BRACKET&&t!==CHAR_RIGHT_CURLY_BRACKET&&t!==CHAR_SHARP&&t!==CHAR_AMPERSAND&&t!==CHAR_ASTERISK&&t!==CHAR_EXCLAMATION&&t!==CHAR_VERTICAL_LINE&&t!==CHAR_EQUALS&&t!==CHAR_GREATER_THAN&&t!==CHAR_SINGLE_QUOTE&&t!==CHAR_DOUBLE_QUOTE&&t!==CHAR_PERCENT&&t!==CHAR_COMMERCIAL_AT&&t!==CHAR_GRAVE_ACCENT}function isPlainSafeLast(t){return!isWhitespace(t)&&t!==CHAR_COLON}function codePointAt(t,e){var r,i=t.charCodeAt(e);return i>=55296&&i<=56319&&e+1<t.length&&(r=t.charCodeAt(e+1))>=56320&&r<=57343?1024*(i-55296)+r-56320+65536:i}function needIndentIndicator(t){return/^\n* /.test(t)}var STYLE_PLAIN=1,STYLE_SINGLE=2,STYLE_LITERAL=3,STYLE_FOLDED=4,STYLE_DOUBLE=5;function chooseScalarStyle(t,e,r,i,n,o,a,s){var l,u=0,c=null,h=!1,p=!1,f=-1!==i,d=-1,y=isPlainSafeFirst(codePointAt(t,0))&&isPlainSafeLast(codePointAt(t,t.length-1));if(e||a)for(l=0;l<t.length;u>=65536?l+=2:l++){if(!isPrintable(u=codePointAt(t,l)))return STYLE_DOUBLE;y=y&&isPlainSafe(u,c,s),c=u}else{for(l=0;l<t.length;u>=65536?l+=2:l++){if((u=codePointAt(t,l))===CHAR_LINE_FEED)h=!0,f&&(p=p||l-d-1>i&&" "!==t[d+1],d=l);else if(!isPrintable(u))return STYLE_DOUBLE;y=y&&isPlainSafe(u,c,s),c=u}p=p||f&&l-d-1>i&&" "!==t[d+1]}return h||p?r>9&&needIndentIndicator(t)?STYLE_DOUBLE:a?o===QUOTING_TYPE_DOUBLE?STYLE_DOUBLE:STYLE_SINGLE:p?STYLE_FOLDED:STYLE_LITERAL:!y||a||n(t)?o===QUOTING_TYPE_DOUBLE?STYLE_DOUBLE:STYLE_SINGLE:STYLE_PLAIN}function writeScalar(t,e,r,i,n){t.dump=function(){if(0===e.length)return t.quotingType===QUOTING_TYPE_DOUBLE?'""':"''";if(!t.noCompatMode&&(-1!==DEPRECATED_BOOLEANS_SYNTAX.indexOf(e)||DEPRECATED_BASE60_SYNTAX.test(e)))return t.quotingType===QUOTING_TYPE_DOUBLE?'"'+e+'"':"'"+e+"'";var o=t.indent*Math.max(1,r),a=-1===t.lineWidth?-1:Math.max(Math.min(t.lineWidth,40),t.lineWidth-o),s=i||t.flowLevel>-1&&r>=t.flowLevel;switch(chooseScalarStyle(e,s,t.indent,a,(function(e){return testImplicitResolving(t,e)}),t.quotingType,t.forceQuotes&&!i,n)){case STYLE_PLAIN:return e;case STYLE_SINGLE:return"'"+e.replace(/'/g,"''")+"'";case STYLE_LITERAL:return"|"+blockHeader(e,t.indent)+dropEndingNewline(indentString(e,o));case STYLE_FOLDED:return">"+blockHeader(e,t.indent)+dropEndingNewline(indentString(foldString(e,a),o));case STYLE_DOUBLE:return'"'+escapeString(e)+'"';default:throw new exception("impossible error: invalid scalar style")}}()}function blockHeader(t,e){var r=needIndentIndicator(t)?String(e):"",i="\n"===t[t.length-1];return r+(!i||"\n"!==t[t.length-2]&&"\n"!==t?i?"":"-":"+")+"\n"}function dropEndingNewline(t){return"\n"===t[t.length-1]?t.slice(0,-1):t}function foldString(t,e){for(var r,i,n,o=/(\n+)([^\n]*)/g,a=(r=-1!==(r=t.indexOf("\n"))?r:t.length,o.lastIndex=r,foldLine(t.slice(0,r),e)),s="\n"===t[0]||" "===t[0];n=o.exec(t);){var l=n[1],u=n[2];i=" "===u[0],a+=l+(s||i||""===u?"":"\n")+foldLine(u,e),s=i}return a}function foldLine(t,e){if(""===t||" "===t[0])return t;for(var r,i,n=/ [^ ]/g,o=0,a=0,s=0,l="";r=n.exec(t);)(s=r.index)-o>e&&(i=a>o?a:s,l+="\n"+t.slice(o,i),o=i+1),a=s;return l+="\n",t.length-o>e&&a>o?l+=t.slice(o,a)+"\n"+t.slice(a+1):l+=t.slice(o),l.slice(1)}function escapeString(t){for(var e,r="",i=0,n=0;n<t.length;i>=65536?n+=2:n++)i=codePointAt(t,n),!(e=ESCAPE_SEQUENCES[i])&&isPrintable(i)?(r+=t[n],i>=65536&&(r+=t[n+1])):r+=e||encodeHex(i);return r}function writeFlowSequence(t,e,r){var i,n,o,a="",s=t.tag;for(i=0,n=r.length;i<n;i+=1)o=r[i],t.replacer&&(o=t.replacer.call(r,String(i),o)),(writeNode(t,e,o,!1,!1)||void 0===o&&writeNode(t,e,null,!1,!1))&&(""!==a&&(a+=","+(t.condenseFlow?"":" ")),a+=t.dump);t.tag=s,t.dump="["+a+"]"}function writeBlockSequence(t,e,r,i){var n,o,a,s="",l=t.tag;for(n=0,o=r.length;n<o;n+=1)a=r[n],t.replacer&&(a=t.replacer.call(r,String(n),a)),(writeNode(t,e+1,a,!0,!0,!1,!0)||void 0===a&&writeNode(t,e+1,null,!0,!0,!1,!0))&&(i&&""===s||(s+=generateNextLine(t,e)),t.dump&&CHAR_LINE_FEED===t.dump.charCodeAt(0)?s+="-":s+="- ",s+=t.dump);t.tag=l,t.dump=s||"[]"}function writeFlowMapping(t,e,r){var i,n,o,a,s,l="",u=t.tag,c=Object.keys(r);for(i=0,n=c.length;i<n;i+=1)s="",""!==l&&(s+=", "),t.condenseFlow&&(s+='"'),a=r[o=c[i]],t.replacer&&(a=t.replacer.call(r,o,a)),writeNode(t,e,o,!1,!1)&&(t.dump.length>1024&&(s+="? "),s+=t.dump+(t.condenseFlow?'"':"")+":"+(t.condenseFlow?"":" "),writeNode(t,e,a,!1,!1)&&(l+=s+=t.dump));t.tag=u,t.dump="{"+l+"}"}function writeBlockMapping(t,e,r,i){var n,o,a,s,l,u,c="",h=t.tag,p=Object.keys(r);if(!0===t.sortKeys)p.sort();else if("function"==typeof t.sortKeys)p.sort(t.sortKeys);else if(t.sortKeys)throw new exception("sortKeys must be a boolean or a function");for(n=0,o=p.length;n<o;n+=1)u="",i&&""===c||(u+=generateNextLine(t,e)),s=r[a=p[n]],t.replacer&&(s=t.replacer.call(r,a,s)),writeNode(t,e+1,a,!0,!0,!0)&&((l=null!==t.tag&&"?"!==t.tag||t.dump&&t.dump.length>1024)&&(t.dump&&CHAR_LINE_FEED===t.dump.charCodeAt(0)?u+="?":u+="? "),u+=t.dump,l&&(u+=generateNextLine(t,e)),writeNode(t,e+1,s,!0,l)&&(t.dump&&CHAR_LINE_FEED===t.dump.charCodeAt(0)?u+=":":u+=": ",c+=u+=t.dump));t.tag=h,t.dump=c||"{}"}function detectType(t,e,r){var i,n,o,a,s,l;for(o=0,a=(n=r?t.explicitTypes:t.implicitTypes).length;o<a;o+=1)if(((s=n[o]).instanceOf||s.predicate)&&(!s.instanceOf||"object"==typeof e&&e instanceof s.instanceOf)&&(!s.predicate||s.predicate(e))){if(r?s.multi&&s.representName?t.tag=s.representName(e):t.tag=s.tag:t.tag="?",s.represent){if(l=t.styleMap[s.tag]||s.defaultStyle,"[object Function]"===_toString.call(s.represent))i=s.represent(e,l);else{if(!_hasOwnProperty.call(s.represent,l))throw new exception("!<"+s.tag+'> tag resolver accepts not "'+l+'" style');i=s.represent[l](e,l)}t.dump=i}return!0}return!1}function writeNode(t,e,r,i,n,o,a){t.tag=null,t.dump=r,detectType(t,r,!1)||detectType(t,r,!0);var s,l=_toString.call(t.dump),u=i;i&&(i=t.flowLevel<0||t.flowLevel>e);var c,h,p="[object Object]"===l||"[object Array]"===l;if(p&&(h=-1!==(c=t.duplicates.indexOf(r))),(null!==t.tag&&"?"!==t.tag||h||2!==t.indent&&e>0)&&(n=!1),h&&t.usedDuplicates[c])t.dump="*ref_"+c;else{if(p&&h&&!t.usedDuplicates[c]&&(t.usedDuplicates[c]=!0),"[object Object]"===l)i&&0!==Object.keys(t.dump).length?(writeBlockMapping(t,e,t.dump,n),h&&(t.dump="&ref_"+c+t.dump)):(writeFlowMapping(t,e,t.dump),h&&(t.dump="&ref_"+c+" "+t.dump));else if("[object Array]"===l)i&&0!==t.dump.length?(t.noArrayIndent&&!a&&e>0?writeBlockSequence(t,e-1,t.dump,n):writeBlockSequence(t,e,t.dump,n),h&&(t.dump="&ref_"+c+t.dump)):(writeFlowSequence(t,e,t.dump),h&&(t.dump="&ref_"+c+" "+t.dump));else{if("[object String]"!==l){if("[object Undefined]"===l)return!1;if(t.skipInvalid)return!1;throw new exception("unacceptable kind of an object to dump "+l)}"?"!==t.tag&&writeScalar(t,t.dump,e,o,u)}null!==t.tag&&"?"!==t.tag&&(s=encodeURI("!"===t.tag[0]?t.tag.slice(1):t.tag).replace(/!/g,"%21"),s="!"===t.tag[0]?"!"+s:"tag:yaml.org,2002:"===s.slice(0,18)?"!!"+s.slice(18):"!<"+s+">",t.dump=s+" "+t.dump)}return!0}function getDuplicateReferences(t,e){var r,i,n=[],o=[];for(inspectNode(t,n,o),r=0,i=o.length;r<i;r+=1)e.duplicates.push(n[o[r]]);e.usedDuplicates=new Array(i)}function inspectNode(t,e,r){var i,n,o;if(null!==t&&"object"==typeof t)if(-1!==(n=e.indexOf(t)))-1===r.indexOf(n)&&r.push(n);else if(e.push(t),Array.isArray(t))for(n=0,o=t.length;n<o;n+=1)inspectNode(t[n],e,r);else for(n=0,o=(i=Object.keys(t)).length;n<o;n+=1)inspectNode(t[i[n]],e,r)}function dump$1(t,e){var r=new State(e=e||{});r.noRefs||getDuplicateReferences(t,r);var i=t;return r.replacer&&(i=r.replacer.call({"":i},"",i)),writeNode(r,0,i,!0,!0)?r.dump+"\n":""}var dump_1=dump$1,dumper={dump:dump_1};function renamed(t,e){return function(){throw new Error("Function yaml."+t+" is removed in js-yaml 4. Use yaml."+e+" instead, which is now safe by default.")}}var Type=type,Schema=schema,FAILSAFE_SCHEMA=failsafe,JSON_SCHEMA=json,CORE_SCHEMA=core,DEFAULT_SCHEMA=_default,load=loader.load,loadAll=loader.loadAll,dump=dumper.dump,YAMLException=exception,types={binary,float,map,null:_null,pairs,set,timestamp,bool,int,merge,omap,seq,str},safeLoad=renamed("safeLoad","load"),safeLoadAll=renamed("safeLoadAll","loadAll"),safeDump=renamed("safeDump","dump"),jsYaml={Type,Schema,FAILSAFE_SCHEMA,JSON_SCHEMA,CORE_SCHEMA,DEFAULT_SCHEMA,load,loadAll,dump,YAMLException,types,safeLoad,safeLoadAll,safeDump},SceneBundle=_createClass((function t(e,r){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;_classCallCheck(this,t),this.url=e,!r||isRelativeURL(r)&&!isRelativeURL(this.url)?this.path=pathForURL(this.url):this.path=r,this.path_for_parent=r||this.path,this.parent=i,this.container=null,this.parent&&(this.parent.container?this.container=this.parent.container:this.parent.isContainer()&&(this.container=this.parent))}),[{key:"load",value:function(){return loadResource(this.url)}},{key:"resourceFor",value:function(t){return{url:this.urlFor(t),path:this.pathFor(t),type:this.typeFor(t)}}},{key:"urlFor",value:function(t){return isGlobal(t)?t:isRelativeURL(t)&&this.container?this.parent.urlFor(this.path_for_parent+t):addBaseURL(t,this.path)}},{key:"pathFor",value:function(t){return pathForURL(t)}},{key:"typeFor",value:function(t){return extensionForURL(t)}},{key:"isContainer",value:function(){return!1}}]);function createSceneBundle(t,e,r){return new SceneBundle(t,e,r)}function isGlobal(t){return!(!t||"global."!==t.slice(0,7))}function parseResource(t){var e;try{e=jsYaml.load(t,{json:!0})}catch(t){throw t}return e}function loadResource(t){return new Promise((function(e,r){"string"==typeof t?Utils$1.io(t).then((function(t){try{var i=parseResource(t);e(i)}catch(t){r(t)}}),r):(t=Object.assign({},t),e(t))}))}function notNull(t){return null!=t}function wrap(t){return"("+t+")"}function maybeQuote(t){return"string"==typeof t?'"'+t+'"':t}function lookUp(t){return"$"===t[0]?"context['"+t.substring(1)+"']":"context.feature.properties['"+t+"']"}function nullValue(t,e){return" true "}function propertyEqual(t,e){return wrap(maybeQuote(e)+" === "+lookUp(t))}function propertyOr(t,e){return wrap(e.map((function(e){return propertyEqual(t,e)})).join(" || "))}function printNested(t,e){return wrap(t.filter(notNull).map((function(t){return wrap(t.join(" && "))})).join(" "+e+" "))}function any(t,e,r){return e&&e.length>0?printNested(e.map((function(t){return parseFilter(t,r)})),"||"):"true"}function all(t,e,r){return e&&e.length>0?printNested(e.map((function(t){return parseFilter(t,r)})),"&&"):"true"}function not(t,e,r){return"!"+wrap(parseFilter(e,r).join(" && "))}function none(t,e,r){return"!"+wrap(any(null,e,r))}function propertyMatchesBoolean(t,e){return wrap(lookUp(t)+(e?" != ":" == ")+"null")}function rangeMatch(t,e,r){var i=[],n=r&&"function"==typeof r.rangeTransform&&r.rangeTransform;if(e.max){var o=n?n(e.max):e.max;i.push(lookUp(t)+" < "+o)}if(e.min){var a=n?a=n(e.min):e.min;i.push(lookUp(t)+" >= "+a)}return wrap(i.join(" && "))}function parseFilter(t,e){var r=[];if("function"==typeof t)return[wrap(t.toString()+"(context)")];if(Array.isArray(t))return[any(null,t,e)];if(null==t)return["true"];for(var i=Object.keys(t),n=0;n<i.length;n++){var o=i[n],a=t[o],s=_typeof(a);if("string"===s||"number"===s)r.push(propertyEqual(o,a));else if("boolean"===s)r.push(propertyMatchesBoolean(o,a));else if("not"===o)r.push(not(o,a,e));else if("any"===o)r.push(any(o,a,e));else if("all"===o)r.push(all(o,a,e));else if("none"===o)r.push(none(o,a,e));else if(Array.isArray(a))r.push(propertyOr(o,a));else if("object"===s&&null!=a)(a.max||a.min)&&r.push(rangeMatch(o,a,e));else{if(null!=a)throw new Error("Unknown Query syntax: "+a);r.push(nullValue())}}return 0===i.length?["true"]:r}function filterToString(t){return wrap(t.join(" && "))}function buildFilter(t,e){return null==t?function(){return!0}:new Function("context","return "+filterToString(parseFilter(t,e))+";")}var reserved=["filter","draw","visible","enabled","data"],layer_cache={};function cacheKey(t){if(t.length>1){for(var e=t[0],r=1;r<t.length;r++)e+="/"+t[r];return e}return t[0]}function mergeTrees(t,e){for(var r,i=0,n=0;n<t.length;n++)t[n].length>i&&(i=t[n].length);if(0===i)return null;for(var o={visible:!0},a=function(i){if(r=[],t.forEach((function(t){t[i]&&t[i][e]&&-1===r.indexOf(t[i][e])&&r.push(t[i][e])})),0===r.length)return 1;r.sort((function(t,e){return(t&&t.layer_name)>(e&&e.layer_name)?1:-1})),mergeObjects.apply(void 0,[o].concat(_toConsumableArray(r))),delete o.layer_name},s=0;s<i;s++)a(s);return!1===o.visible?null:o}var blacklist=["any","all","not","none"],Layer=_createClass((function t(e){var r=e.layer,i=e.name,n=e.parent,o=e.draw,a=e.visible,s=e.enabled,l=e.filter,u=e.styles;if(_classCallCheck(this,t),this.id=t.id++,this.config_data=r.data,this.parent=n,this.name=i,this.full_name=this.parent?this.parent.full_name+":"+this.name:this.name,this.draw=o,this.filter=l,this.styles=u,this.is_built=!1,s=void 0===s?a:s,this.parent&&!1===this.parent.visible?this.enabled=!1:this.enabled=!1!==s,this.draw)for(var c in this.draw)if(this.draw[c]=null==this.draw[c]?{}:this.draw[c],"object"!==_typeof(this.draw[c])){var h="Draw group '".concat(c,"' for layer ").concat(this.full_name," is invalid, must be an object, ");log("warn",h+="but was set to `".concat(c,": ").concat(this.draw[c],"` instead")),delete this.draw[c]}else this.draw[c].layer_name=this.full_name}),[{key:"build",value:function(){log("trace","Building layer '".concat(this.full_name,"'")),this.buildFilter(),this.buildDraw(),this.is_built=!0}},{key:"buildDraw",value:function(){this.draw=Utils$1.stringsToFunctions(this.draw,StyleParser.wrapFunction),this.calculatedDraw=calculateDraw(this)}},{key:"buildFilter",value:function(){this.filter_original=this.filter,this.filter=Utils$1.stringsToFunctions(this.filter,StyleParser.wrapFunction);var t=_typeof(this.filter);if(null==this.filter||"object"===t||"function"===t)try{this.buildZooms(),this.buildPropMatches(),null!=this.filter&&("function"==typeof this.filter||Object.keys(this.filter).length>0)?this.filter=buildFilter(this.filter,FilterOptions):this.filter=null}catch(t){var e="Filter for layer ".concat(this.full_name," is invalid, `filter: ").concat(JSON.stringify(this.filter),"` ");log("warn",e+="failed with error '".concat(t.message,"', stack trace: ").concat(t.stack))}else{var r="Filter for layer ".concat(this.full_name," is invalid, filter value must be an object or function, ");log("warn",r+="but was set to `filter: ".concat(this.filter,"` instead"))}}},{key:"buildZooms",value:function(){var t=this.filter&&this.filter.$zoom,e=_typeof(t);if(null!=t&&"function"!==e){if(this.zooms={},"number"===e)this.zooms[t]=!0;else if(Array.isArray(t))for(var r=0;r<t.length;r++)this.zooms[t[r]]=!0;else if("object"===e&&(null!=t.min||null!=t.max))for(var i=t.min||0,n=t.max||25,o=i;o<n;o++)this.zooms[o]=!0;delete this.filter.$zoom}}},{key:"buildPropMatches",value:function(){var t=this;this.filter&&!Array.isArray(this.filter)&&"function"!=typeof this.filter&&Object.keys(this.filter).forEach((function(e){if(-1===blacklist.indexOf(e)){var r=t.filter[e],i=_typeof(r),n=Array.isArray(r);if(!n&&"string"!==i&&"number"!==i)return;"$"===e[0]?(t.context_prop_matches=t.context_prop_matches||[],t.context_prop_matches.push([e.substring(1),n?r:[r]])):(t.feature_prop_matches=t.feature_prop_matches||[],t.feature_prop_matches.push([e,n?r:[r]])),delete t.filter[e]}}))}},{key:"doPropMatches",value:function(t){if(this.feature_prop_matches)for(var e=0;e<this.feature_prop_matches.length;e++){var r=this.feature_prop_matches[e],i=t.feature.properties[r[0]];if(null==i||-1===r[1].indexOf(i))return!1}if(this.context_prop_matches)for(var n=0;n<this.context_prop_matches.length;n++){var o=this.context_prop_matches[n],a=t[o[0]];if(null==a||-1===o[1].indexOf(a))return!1}return!0}},{key:"doesMatch",value:function(t){if(!this.enabled)return!1;if(this.is_built||this.build(),null!=this.zooms&&!this.zooms[t.zoom])return!1;if(!this.doPropMatches(t))return!1;var e;if(this.filter instanceof Function)try{e=this.filter(t)}catch(e){var r="Filter for this ".concat(this.full_name,": `filter: ").concat(this.filter_original,"` ");log("error",r+="failed with error '".concat(e.message,"', stack trace: ").concat(e.stack),t.feature)}else e=null==this.filter;return!!e&&(this.children_to_parse&&(parseLayerChildren(this,this.children_to_parse,this.styles),delete this.children_to_parse),!0)}}]);Layer.id=0;var LayerLeaf=function(t){function e(t){var r;return _classCallCheck(this,e),(r=_callSuper(this,e,[t])).is_leaf=!0,r}return _inherits(e,t),_createClass(e)}(Layer),LayerTree=function(t){function e(t){var r;return _classCallCheck(this,e),(r=_callSuper(this,e,[t])).is_tree=!0,r.layers=t.layers||[],r}return _inherits(e,t),_createClass(e,[{key:"addLayer",value:function(t){this.layers.push(t)}},{key:"buildDrawGroups",value:function(t){var e=[],r=[];if(matchFeature(t,[this],e,r),e.length>0){var i=cacheKey(r);if(void 0===layer_cache[i]){for(var n=e.map((function(t){return t&&!1!==t.visible&&t.calculatedDraw})),o={},a=0;a<n.length;a++){var s=n[a];if(s)for(var l=0;l<s.length;l++){var u=s[l];for(var c in u)o[c]=!0}}for(var h in o)layer_cache[i]=layer_cache[i]||{},layer_cache[i][h]=mergeTrees(n,h),layer_cache[i][h]?(layer_cache[i][h].key=i+"/"+h,layer_cache[i][h].layers=e.map((function(t){return t&&t.full_name})),layer_cache[i][h].group=h):delete layer_cache[i][h];layer_cache[i]&&0===Object.keys(layer_cache[i]).length&&(layer_cache[i]=null)}return layer_cache[i]}}}])}(Layer),FilterOptions={rangeTransform:function(t){return"string"==typeof t&&"px2"===t.trim().slice(-3)?"".concat(parseFloat(t)," * context.meters_per_pixel_sq"):t}},SceneLoader;function isReserved(t){return reserved.indexOf(t)>-1}function isEmpty(t){return 0===Object.keys(t).length}function groupProps(t){var e={},r={};for(var i in t)isReserved(i)?e[i]=t[i]:r[i]=t[i];return[e,r]}function calculateDraw(t){var e=[];if(t.parent){var r=t.parent.calculatedDraw||[];e.push.apply(e,_toConsumableArray(r))}return e.push(t.draw),e}function parseLayerNode(t,e,r,i){var n={name:t,layer:e=null==e?{}:e,parent:r,styles:i},o=_slicedToArray(groupProps(e),2),a=o[0],s=o[1],l=isEmpty(s),u=new(l&&null!=r?LayerLeaf:LayerTree)(Object.assign(n,a));return u.enabled&&(r&&r.addLayer(u),u.children_to_parse=l?null:s),u}function parseLayerChildren(t,e,r){for(var i in e){var n=e[i];if("object"!==_typeof(n)||Array.isArray(n)){var o="Layer value must be an object: cannot create layer '".concat(i,": ").concat(JSON.stringify(n),"'");o+=", under parent layer '".concat(t.full_name,"'."),r[t.name]&&(o+=" The parent name '".concat(t.name,"' is also the name of a style, did you mean to create a 'draw' group"),t.parent&&(o+=" under '".concat(t.parent.name,"'")),o+=" instead?"),log("warn",o)}else parseLayerNode(i,n,t,r)}}function parseLayers(t,e){layer_cache={};var r={};for(var i in t){var n=t[i];n&&(r[i]=parseLayerNode(i,n,null,e))}return r}function matchFeature(t,e,r,i){var n=!1;if(0!==e.length){for(var o=0;o<e.length;o++){var a=e[o];a.is_leaf?a.doesMatch(t)&&(n=!0,r.push(a),i.push(a.id)):a.is_tree&&a.doesMatch(t)&&(n=!0,matchFeature(t,a.layers,r,i)||(r.push(a),i.push(a.id)))}return n}}var GLOBAL_PROP_RGX=/^global\.(.+)$/,SceneLoader$1=SceneLoader={loadScene:function(t){var e=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=r.path,n=r.type,o=[];return this.loadSceneRecursive({url:t,path:i,type:n},null,o).then((function(t){return e.finalize(t)})).then((function(t){var r=t.config,i=t.bundle;return r?(o.length>0&&o.forEach((function(t){var r="Failed to import scene: ".concat(t.url);log("error",r,t),e.trigger("error",{type:"scene_import",message:r,error:t,url:t.url})})),{config:r,bundle:i}):Promise.reject(o[0])}))},loadSceneRecursive:function(t,e){var r=this,i=t.url,n=t.path;t.type;var o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];if(!i)return Promise.resolve({});var a=createSceneBundle(i,n,e);return a.load().then((function(t){if(null==t.import)return r.normalize(t,a),{config:t,bundle:a};Array.isArray(t.import)||(t.import=[t.import]);var e=[];return t.import.forEach((function(t){"object"===_typeof(t)&&(t=createObjectURL(new Blob([JSON.stringify(t)]))),e.push(a.resourceFor(t))})),delete t.import,Promise.all(e.map((function(t){return r.loadSceneRecursive(t,a,o)}))).then((function(e){e.forEach((function(t){return r.normalize(t.config,t.bundle)}));var i=e.map((function(t){return t.config}));return t=mergeObjects.apply(void 0,_toConsumableArray(i).concat([t])),r.normalize(t,a),{config:t,bundle:a}}))})).catch((function(t){return t.url=i,o.push(t),{}}))},normalize:function(t,e){return this.normalizeDataSources(t,e),this.normalizeFonts(t,e),this.normalizeTextures(t,e),this.hoistTextures(t,e),{config:t,bundle:e}},normalizeDataSources:function(t,e){for(var r in t.sources=t.sources||{},t.sources)this.normalizeDataSource(t.sources[r],e);return t},normalizeDataSource:function(t,e){if(t.url&&(t.url=e.urlFor(t.url)),t.scripts)for(var r in Array.isArray(t.scripts)&&(t.scripts=t.scripts.reduce((function(t,e){return t[e]=e,t}),{})),t.scripts)t.scripts[r]=e.urlFor(t.scripts[r]);return t},normalizeFonts:function(t,e){for(var r in t.fonts=t.fonts||{},t.fonts)if(Array.isArray(t.fonts[r]))t.fonts[r].forEach((function(t){t.url=t.url&&e.urlFor(t.url)}));else{var i=t.fonts[r];i.url=i.url&&e.urlFor(i.url)}return t},normalizeTextures:function(t,e){if(t.textures=t.textures||{},t.textures)for(var r in t.textures){var i=t.textures[r];i.url&&(i.url=e.urlFor(i.url))}},hoistTextures:function(t,e){var r=this;if(t.styles){var i=function(){var i=t.styles[n],o=i.texture;"string"!=typeof o||t.textures[o]||(i.texture=r.hoistTexture(o,t,e)),i.material&&["emission","ambient","diffuse","specular","normal"].forEach((function(n){var o=null!=i.material[n]&&i.material[n].texture;"string"!=typeof o||t.textures[o]||(i.material[n].texture=r.hoistTexture(o,t,e))}))};for(var n in t.styles)i()}if(this.hoistStyleShaderUniformTextures(t,e,{include_globals:!1}),t.layers)for(var o=[t.layers];o.length>0;){var a=o.pop();if("object"===_typeof(a)&&!Array.isArray(a))for(var s in a)if("draw"===s){var l=a[s];for(var u in l){if(l[u].texture){var c=l[u].texture;"string"!=typeof c||t.textures[c]||(l[u].texture=this.hoistTexture(c,t,e))}if(l[u].outline&&l[u].outline.texture){var h=l[u].outline.texture;"string"!=typeof h||t.textures[h]||(l[u].outline.texture=this.hoistTexture(h,t,e))}}}else{if(isReserved(s))continue;o.push(a[s])}}},hoistStyleShaderUniformTextures:function(t,e,r){var i=this,n=r.include_globals;if(t.styles)for(var o in t.styles){var a=t.styles[o];a.shaders&&a.shaders.uniforms&&GLSL.parseUniforms(a.shaders.uniforms).forEach((function(r){var o=r.type,a=r.value,s=r.key,l=r.uniforms;"sampler2D"!==o||"string"!=typeof a||t.textures[a]||!n&&isGlobal(a)||(l[s]=i.hoistTexture(a,t,e))}))}},hoistTexture:function(t,e,r){var i=isGlobal(t),n=i?t:r.urlFor(t),o=i?"texture-".concat(n):n;return e.textures[o]={url:n},o},applyGlobalProperties:function(t){if(!t.global||0===Object.keys(t.global).length)return t;var e=flattenProperties(t.global);function r(t,e){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];if(i.indexOf(t)>-1)log({level:"warn",once:!0},"Global properties: cyclical reference detected",i);else{i.push(t);var n=GLOBAL_PROP_RGX.exec(t);if(n){var o=n[1];if(o){var a=e[o];if(void 0!==a)return"string"==typeof a&&GLOBAL_PROP_RGX.exec(a)?r(a,e,i):a;log({level:"warn",once:!0},"Global property not found: "+t)}else log({level:"warn",once:!0},"Invalid global property reference: "+t)}}}return function t(i,n,o){if("string"==typeof i){var a=r(i,e);void 0!==a&&(i=a)}else if(Array.isArray(i))for(var s=0;s<i.length;s++)i[s]=t(i[s]);else if("object"===_typeof(i))for(var l in i)i[l]=t(i[l]);return i}(t)},finalize:function(t){var e=t.config,r=t.bundle;return e?(e.global=e.global||{},e.scene=e.scene||{},e.cameras=e.cameras||{},e.lights=e.lights||{},e.styles=e.styles||{},e.layers=e.layers||{},e.camera&&(e.cameras.default=e.camera),0===Object.keys(e.cameras).length&&(e.cameras.default={}),(0===Object.keys(e.lights).length||Object.keys(e.lights).every((function(t){return!1===e.lights[t].visible})))&&(e.lights.default_light={type:"directional"}),{config:e,bundle:r}):{}}};function flattenProperties(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:".",r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};for(var n in r=r?r+e:"",t){var o=r+n,a=t[n];i[o]=a,"object"!==_typeof(a)||Array.isArray(a)||flattenProperties(a,e,o,i)}return i}subscribeMixin(SceneLoader);var TilePyramid=_createClass((function t(){_classCallCheck(this,t),this.coords={},this.max_proxy_descendant_depth=6,this.max_proxy_ancestor_depth=10}),[{key:"sourceTiles",value:function(t,e){return this.coords[t.key]&&this.coords[t.key].sources&&this.coords[t.key].sources[e.name]}},{key:"addTile",value:function(t){var e=t.coords.key,r=this.coords[e];r||(r=this.coords[e]={descendants:0}),r.sources||(r.sources={}),r.sources[t.source.name]||(r.sources[t.source.name]={}),r.sources[t.source.name][t.style_zoom]=t;for(var i=t.coords.z-1;i>=0;i--){var n=Tile.coordinateAtZoom(t.coords,i);this.coords[n.key]||(this.coords[n.key]={descendants:0}),this.coords[n.key].descendants++}}},{key:"removeTile",value:function(t){var e=this.sourceTiles(t.coords,t.source),r=t.coords.key;e&&(delete e[t.style_zoom],0===Object.keys(e).length&&(delete this.coords[r].sources[t.source.name],0===Object.keys(this.coords[r].sources).length&&(delete this.coords[r].sources,0===this.coords[r].descendants&&delete this.coords[r])));for(var i=t.coords.z-1;i>=0;i--){var n=Tile.coordinateAtZoom(t.coords,i);this.coords[n.key]&&this.coords[n.key].descendants>0&&(this.coords[n.key].descendants--,0!==this.coords[n.key].descendants||this.coords[n.key].sources||delete this.coords[n.key])}}},{key:"getAncestor",value:function(t){var e=t.coords,r=t.style_zoom,i=t.source,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;if(!(n>this.max_proxy_ancestor_depth)){if(r>i.max_coord_zoom){var o=this.sourceTiles(e,i);if(o)for(var a=r-1;a>=i.max_coord_zoom;a--)if(o[a]&&o[a].loaded)return o[a];r=i.max_coord_zoom}r--;var s=Tile.coordinateAtZoom(e,e.z-1),l=this.sourceTiles(s,i);return l&&l[r]&&l[r].loaded?l[r]:s.z>0?this.getAncestor({coords:s,style_zoom:r,source:i},n+1):void 0}}},{key:"getDescendants",value:function(t){var e=t.coords,r=t.style_zoom,i=t.source,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,o=[];if(r>=i.max_coord_zoom){var a=this.sourceTiles(e,i);if(a)for(var s=Math.max(Geo$1.default_view_max_zoom,r+this.max_proxy_descendant_depth),l=r+1;l<=s;l++)if(a[l]&&a[l].loaded)return o.push(a[l]),o;return o}if(this.coords[e.key]&&this.coords[e.key].descendants>0){r++;for(var u=Tile.childrenForCoordinate(e),c=0;c<u.length;c++){var h=u[c],p=this.sourceTiles(h,i);p&&p[r]&&p[r].loaded?o.push(p[r]):n<=this.max_proxy_descendant_depth&&h.z<=i.max_coord_zoom&&o.push.apply(o,_toConsumableArray(this.getDescendants({coords:h,source:i,style_zoom:r},n+1)))}}return o}}]),LabelMainPass=_createClass((function t(e,r,i,n){_classCallCheck(this,t),Object.assign(this,e),this.placed=null,this._tile=n;var o=Geo$1.unitsPerMeter(n.coords.z)*Math.pow(2,i-n.style_zoom);this.layout=Object.assign({},e.layout),this.layout.repeat_scale=.75,this.layout.repeat_distance=this.layout.repeat_distance||0,this.layout.repeat_distance/=o,this.position=Geo$1.tileSpaceToMeters(this.position,n.coords.z,n.min),this._worldToScreen=r,this._screenSpaceBoundingBox=void 0,this._boundingCircles=void 0}),[{key:"getTile",value:function(){return this._tile}},{key:"isFlat",value:function(){return this.is_flat}},{key:"getScreenSpaceBoundingBox",value:function(){if(!this._screenSpaceBoundingBox){var t=this._worldToScreen(this.position,!0);t[0]+=this.offset[0],t[1]+=this.offset[1];var e=this.size[0]/2+this.layout.buffer[0],r=this.size[1]/2+this.layout.buffer[1],i=t[0]-e,n=t[0]+e,o=t[1]-r,a=t[1]+r;this._screenSpaceBoundingBox={left:i,bottom:a,right:n,top:o}}return this._screenSpaceBoundingBox}},{key:"getBoundingCircles",value:function(){return this._boundingCircles||(this._boundingCircles="point"===this.type?this._convertSidesToScreenSpaceCircles():this._convertCirclesToScreenSpace()),this._boundingCircles}},{key:"_convertSidesToScreenSpaceCircles",value:function(){var t=this._tile.coords.z,e=this._tile.min,r=Geo$1.tileSpaceToMeters([this.sides[0],this.sides[1]],t,e),i=Geo$1.tileSpaceToMeters([this.sides[2],this.sides[3]],t,e),n=_slicedToArray(this._worldToScreen(r,!0),2),o=n[0],a=n[1],s=_slicedToArray(this._worldToScreen(i,!0),2);return encircleLine(o,a,s[0],s[1],this.size[1]/2+this.layout.buffer[1])}},{key:"_convertCirclesToScreenSpace",value:function(){for(var t=[],e=this.circles,r=this._tile.coords.z,i=this._tile.min,n=0;n<e.length-2;n+=3){var o=Geo$1.tileSpaceToMeters([e[n],-e[n+1]],r,i),a=e[n+2]/Geo$1.unitsPerMeter(r),s=[o[0]+a,o[1]],l=this._worldToScreen(o,!0),u=this._worldToScreen(s,!0),c=MathUtils$1.getLineLength(l[0],l[1],u[0],u[1]);t.push(l[0],l[1],c)}return t}}]),labelsMainPass={mainThreadLabelCollisionPass},visible={},prev_visible={},IS_LITTLE_ENDIAN=120===new Uint8Array(new Uint32Array([305419896]).buffer)[0];function _createContainer(t,e,r,i,n){var o=t.container,a=o.label,s=o.linked,l=t.ranges;return{label:new LabelMainPass(a,r,i,n),linked:s,ranges:l,mesh:e}}function mainThreadLabelCollisionPass(t,e,r,i,n,o){prev_visible=visible,visible={};var a={},s={},l=[],u=r.worldToScreen.bind(r),c=new TextMeshHelper(o);for(var h in t.forEach((function(t){for(var r in t.meshes)t.meshes[r].forEach((function(r){if(r.labels){for(var i in c.trackMesh(r),r.labels["non-collision"]){var n=_createContainer(r.labels["non-collision"][i],r,u,e,t);n.label.text_data&&c.insertLabel(n,t)}for(var o in r.labels.collision)if(!a[o]){var l=_createContainer(r.labels.collision[o],r,u,e,t);a[o]=l.label,s[o]=l}}}))})),s){var p=s[h];p.linked&&(p.linked=s[p.linked]),l.push(p)}var f=r.getViewport(),d=f.width,y=f.height;return Collision.startTile("main",{apply_repeat_groups:!0,return_hidden:!0,grid_index:new GridIndex(d,y,30)}),Collision.addStyle("main","main"),Collision.collide(l,"main","main").then((function(t){return t.forEach((function(t){var e=t.mesh,r=t.label.getTile();if(e.valid){var n=0;!0!==t.show||i&&t.label.breach&&!prev_visible[t.label.id]||(n=1),n&&(visible[t.label.id]=!0),t.label.text_data&&c.insertLabel(t,r);var o=e.vertex_layout.offset.a_shape,a=e.vertex_layout.stride,s=e.vertex_layout.attribs.find((function(t){return"a_shape"===t.name})),l=s.byte_size/s.size;o+=3*l;var u=!0;t.ranges.forEach((function(t){if(u){for(var r=0;r<t[1];r++){if(e.vertex_data[t[0]+r*a+o]===n)return void(u=!1);e.vertex_data[t[0]+r*a+o]=n}c.trackMesh(e)}}))}})),c.createTextures(n).then((function(){return c.updateMeshes()}))})).then((function(e){e.forEach((function(t){return t.valid&&t.upload()})),t.forEach((function(t){t.labeled=!0})),l=[],s={},a={}}))}var TextMeshHelper=_createClass((function t(e){_classCallCheck(this,t),this.textureManager=getTextureManager(e),this.tiles={},this.meshes=[],this.containers=[]}),[{key:"insertLabel",value:function(t,e){var r=t.label.text_data,i=r.text_settings_key,n=r.text,o=r.text_info;this.containers.push(t);var a=this._ensureTextSection(e,i);a[n]?t.label.text_data.text_info=a[n]:a[n]=o}},{key:"trackMesh",value:function(t){-1===this.meshes.indexOf(t)&&this.meshes.push(t)}},{key:"updateMeshes",value:function(){var t=this;return this.containers.forEach((function(e){if(e.label.text_data){var r=e.label.getTile(),i=e.mesh;if(i.valid){var n=e.label.type,o=e.label.text_data.text_info;if(t.tiles[r.id]&&t.tiles[r.id].textures){var a=t.tiles[r.id].textures[0];if(i.uniforms.u_texture=a,-1===i.textures.indexOf(a)&&i.textures.push(a),"point"===n||"straight"===n){var s="point"===n?o.align[e.label.align].texcoords:o.texcoords[n].texcoord;t.setTexCoords(i,e,s)}else if("curved"===n){var l=o.segments.length,u=o.texcoords_stroke,c=o.texcoords.curved;t.setTexCoords(i,e,(function(t){return t<l?u[t]:c[t-l].texcoord}))}}}else if(t.tiles[r.id]&&t.tiles[r.id].textures){var h=t.tiles[r.id].textures[0];t.textureManager.release(h)}}})),this.meshes}},{key:"setTexCoords",value:function(t,e,r){var i,n=r instanceof Function;if(!n){var o=_slicedToArray(r,4),a=o[0],s=o[1],l=o[2],u=o[3];i=[[a,s],[l,s],[l,u],[a,u]]}var c=t.vertex_layout.stride,h=new DataView(t.vertex_data.buffer),p=t.vertex_layout.offset.a_texcoord;e.ranges.forEach((function(t,e){var o=_slicedToArray(t,3),a=o[0],s=o[1],l=o[2];if(n){var u=_slicedToArray(r(e),4),f=u[0],d=u[1],y=u[2],g=u[3];i=[[f,d],[y,d],[y,g],[f,g]]}for(var v=l?s/2:0;v<s;v++){var m=i[v%4],_=a+v*c;h.setUint16(_+p,m[0]*texcoord_normalize,IS_LITTLE_ENDIAN),h.setUint16(_+p+2,m[1]*texcoord_normalize,IS_LITTLE_ENDIAN)}}))}},{key:"createTextures",value:function(t){var e=this;return Promise.all(Object.values(this.tiles).map((function(r){var i=r.id,n=r.key,o=r.texts;return e._createTexturesForTile(t,o,"labels-".concat(n,"-").concat(i),i,e.textureManager).then((function(t){t.length&&(t.forEach((function(t){e.textureManager.retain(t),e.textureManager.getRetainCount(t)>1&&e.textureManager.release(t)})),e.tiles[i].textures=t)}))})))}},{key:"_createTexturesForTile",value:function(t,e,r,i,n){var o=new CanvasText,a=o.setTextureTextPositions(e);return o.rasterize(e,a,i,r,t,n)}},{key:"_ensureTile",value:function(t){var e=t.id,r=t.key;return this.tiles[e]||(this.tiles[e]={id:e,key:r,texts:{}}),this.tiles[e]}},{key:"_ensureTextSection",value:function(t,e){var r=this._ensureTile(t).texts;return r[e]||(r[e]={}),r[e]}}]),TILE_VISIBILITY_COUNTER_THRESHOLD=30,TileManager=_createClass((function t(e){var r=this,i=e.scene,n=e.view;_classCallCheck(this,t),this._scene=i,this._view=n,this._visible_tiles={},this._pyramid=new TilePyramid,this._visible_coords={},this._building_tiles=null,this._renderable_tiles=[],this._active_styles=[],this._tile_visibility_counters={},this._update_labels_on_queue_check=!1,this._all_visible_tiles_are_cached=!1,this._debouncedUpdateLabels=debounce(this._updateLabels.bind(this),100,200),this._main_thread_target=["TileManager",this._scene.id].join("_"),WorkerBroker.addTarget(this._main_thread_target,this),this._keepCoordinate=this._keepCoordinate.bind(this),this._removeTilesFilter=this._removeTilesFilter.bind(this),this._removeCachedTilesFilter=this._removeCachedTilesFilter.bind(this),this._is_labeled=!1,this._tile_cache=new H.util.Cache(getMaxTileCacheSize(),(function(t,e,i){r._visible_tiles[t]&&r._visible_tiles[t]===e||e.destroy()}))}),[{key:"destroy",value:function(){this._tile_cache.removeAll(),this.forEachVisibleTile((function(t){return t.destroy()})),this._visible_tiles={},this._pyramid=null,this._visible_coords={},this._scene=null,this._view=null}},{key:"keepTile",value:function(t){this._visible_tiles[t.key]=t,this._pyramid.addTile(t)}},{key:"hasTile",value:function(t){return void 0!==this._visible_tiles[t]}},{key:"_forgetTile",value:function(t){if(this.hasTile(t)){var e=this._visible_tiles[t];if(this._pyramid.removeTile(e),delete this._visible_tiles[t],e.loaded)this._tile_cache.add(e.key,e,getTileByteLength(e));else{var r=this._tile_cache.get(e.key);r?this._tile_cache.drop(r.key):e.destroy()}this._tileBuildStop(e)}}},{key:"removeTile",value:function(t){this._forgetTile(t),this._scene.requestRedraw()}},{key:"forEachVisibleTile",value:function(t){for(var e in this._visible_tiles)t(this._visible_tiles[e])}},{key:"removeTiles",value:function(t){for(var e in this._visible_tiles)t(this._visible_tiles[e])&&this.removeTile(e)}},{key:"removeCachedTiles",value:function(t){var e=this;this._tile_cache.forEach((function(r,i){t(i)&&e._tile_cache.drop(r)}))}},{key:"updateTilesForView",value:function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._visible_coords={};for(var e=this._view.findVisibleTileCoordinates(),r=0;r<e.length;r++){var i=e[r];this._visible_coords[i.key]=i}this.updateTileStates(t)}},{key:"updateTileStates",value:function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];for(var e in this._all_visible_tiles_are_cached=!0,this._visible_coords)this._keepCoordinate(e,t);this._all_visible_tiles_are_cached&&(this._is_labeled=!1,this._debouncedUpdateLabels()),this._tile_cache.removeAll(this._removeCachedTilesFilter),this._updateProxyTiles(),this.removeTiles(this._removeTilesFilter),this._updateRenderableTiles(),this._updateActiveStyles()}},{key:"_removeTilesFilter",value:function(t){if(t.style_zoom===this._view.lookAtManipulator.getLookAtData().tile_level){if(this._visible_coords[t.coords.key])return!1;for(var e in this._visible_coords)if(Tile.isDescendant(t.coords,this._visible_coords[e]))return!1}return!t.isProxy()}},{key:"_updateLabels",value:function(){var t=this;if(!this._building_tiles||0===Object.keys(this._building_tiles).length){CanvasText.pruneTextCache();var e=this._renderable_tiles.sort(compareTileCoords);labelsMainPass.mainThreadLabelCollisionPass(e,roundPrecision(this._view.lookAtManipulator.getLookAtData().zoom,2),this._view.lookAtManipulator,this.isLoadingVisibleTiles(),this._scene.gl,this._scene.id).then((function(){t._is_labeled=!Task.hasPendingTasks(),t._scene&&t._scene.immediateRedraw(),t._update_labels_on_queue_check=!1}))}}},{key:"_updateProxyTiles",value:function(){var t=this,e=this._view.lookAtManipulator.getZoomDirection();if(0!==e){var r=!1;this.forEachVisibleTile((function(i){if(i.setProxyFor(null),1===e){if(!i.built){var n=t._pyramid.getAncestor(i);n&&(n.setProxyFor(i),r=!0)}}else if(-1===e&&!i.built)for(var o=t._pyramid.getDescendants(i),a=0;a<o.length;a++)o[a].setProxyFor(i),r=!0})),r||this._view.lookAtManipulator.resetZoomDirection()}}},{key:"getRenderableTiles",value:function(){return this._renderable_tiles}},{key:"_updateRenderableTiles",value:function(){for(var t in this._renderable_tiles=[],this._visible_tiles){var e=this._visible_tiles[t],r=this._tile_cache.get(t);e.loaded?(this._renderable_tiles.push(e),r&&r!==e&&this._tile_cache.drop(t)):r&&(r.generation===this._scene.generation?this._renderable_tiles.push(r):this._tile_cache.drop(t))}return this._renderable_tiles}},{key:"getWorkerForTile",value:function(t,e){return e.has_volatile_data?this._scene.getWorkers(WorkerType.FAKE)[0]:e.tiled?this._scene.getWorkers(WorkerType.NATIVE)[Math.abs(t.x+t.y+t.z)%this._scene.num_workers]:this._scene.getWorkers(WorkerType.NATIVE)[e.id%this._scene.num_workers]}},{key:"getActiveStyles",value:function(){return this._active_styles}},{key:"_updateActiveStyles",value:function(){for(var t=this._renderable_tiles,e={},r=0;r<t.length;r++){var i=t[r];Object.keys(i.meshes).forEach((function(t){return e[t]=!0}))}return this._active_styles=Object.keys(e),this._active_styles}},{key:"isLoadingVisibleTiles",value:function(){var t=!1;for(var e in this._visible_tiles)if(!this._visible_tiles[e].built){t=!0;break}return t}},{key:"updateTilesVisibilityCounters",value:function(){var t=this;Object.keys(this._visible_coords).forEach((function(e){e in t._tile_visibility_counters||(t._tile_visibility_counters[e]=0)}));var e=Object.keys(this._tile_visibility_counters),r=[];e.forEach((function(e){e in t._visible_coords?(t._tile_visibility_counters[e]++,t._tile_visibility_counters[e]>=TILE_VISIBILITY_COUNTER_THRESHOLD&&r.push(t._visible_coords[e])):(t._tile_visibility_counters[e]--,t._tile_visibility_counters[e]<=0&&delete t._tile_visibility_counters[e])})),r.length&&this.loadCoordinates(r)}},{key:"loadCoordinates",value:function(t){var e=this;t.sort((function(t,r){var i=e._view.lookAtManipulator.getLookAtData().position,n=Geo$1.metersPerTile(t.z)/2,o=Geo$1.metersForTile(t);o.x+=n,o.y-=n;var a=Geo$1.metersForTile(r);a.x+=n,a.y-=n;var s=Math.abs(i[0]-o.x)+Math.abs(i[1]-o.y),l=Math.abs(i[0]-a.x)+Math.abs(i[1]-a.y);return t.center_dist=s,r.center_dist=l,l>s?-1:l===s?0:1})),t.forEach((function(t){return e.loadCoordinate(t)}))}},{key:"_keepCoordinate",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=this._visible_coords[t];if(r.z===this._view.center_tile.z)for(var i in this._scene.sources){var n=this._scene.sources[i];if(n.builds_geometry_tiles&&n.includesTile(r,this._view.lookAtManipulator.getLookAtData().tile_level)){var o=Tile.normalizedKey(r,n,this._view.lookAtManipulator.getLookAtData().tile_level);if(o&&!this.hasTile(o)){var a=e&&this._tile_cache.get(o);a||(this._all_visible_tiles_are_cached=!1);var s=a||new Tile({source:n,coords:r,worker:this.getWorkerForTile(r,n),style_zoom:Utils$1.zoomToTileLevel(r.z),view:this._view,sceneId:this._scene.id});"ObjectSource"===n.config.type&&(s.syncedAt=n.getSyncedAt()),this.keepTile(s)}}}}},{key:"loadCoordinate",value:function(t){if(t.z===this._view.center_tile.z)for(var e in this._scene.sources){var r=this._scene.sources[e];if(r.builds_geometry_tiles&&r.includesTile(t,this._view.lookAtManipulator.getLookAtData().tile_level)){var i=Tile.normalizedKey(t,r,this._view.lookAtManipulator.getLookAtData().tile_level);this.hasTile(i)&&this.buildTile(this._visible_tiles[i])}}}},{key:"buildTile",value:function(t,e){this._building_tiles&&this._building_tiles[t.key]||t.built&&t.generation===this._scene.generation||(this._tileBuildStart(t.key),t.build(this._scene.generation,e))}},{key:"buildTileStylesCompleted",value:function(t){var e=t.tile,r=t.progress;if(null==this._visible_tiles[e.key])Tile.abortBuild(e,this._scene.id);else if(e.generation!==this._scene.generation)Tile.abortBuild(e,this._scene.id);else{if(e.id<this._visible_tiles[e.key].id)return void Tile.abortBuild(e,this._scene.id);e=this._visible_tiles[e.key].merge(e),r.done&&(e.built=!0),e.buildMeshes(this._scene.styles,r),this.updateTileStates(),this._scene.requestRedraw()}r.done&&this._tileBuildStop(e)}},{key:"buildTileError",value:function(t){this._forgetTile(t.key),Tile.abortBuild(t,this._scene.id)}},{key:"_tileBuildStart",value:function(t){this._is_labeled=!1,this._building_tiles=this._building_tiles||{},this._building_tiles[t]=!0}},{key:"_tileBuildStop",value:function(t){this._building_tiles&&(t.source&&t.source.hasLabeledData()&&(this._update_labels_on_queue_check=!0),delete this._building_tiles[t.key],Task.removeForTile(t.id),this.checkBuildQueue())}},{key:"isReady",value:function(){return this._is_labeled&&!this.isLoadingVisibleTiles()}},{key:"checkBuildQueue",value:function(){this._building_tiles&&0!==Object.keys(this._building_tiles).length||(this._building_tiles=null,this._update_labels_on_queue_check?this._updateLabels():(this._is_labeled=!Task.hasPendingTasks(),this._scene.immediateRedraw()))}},{key:"_removeCachedTilesFilter",value:function(t,e,r){var i=e.source;return!this._visible_tiles[t]&&(e.generation!==this._scene.generation||"ObjectSource"===i.config.type&&i.getSyncedAt()>e.syncedAt)}}]);function compareTileCoords(t,e){var r=t.coords,i=e.coords;return r.z-i.z||r.x-i.x||r.y-i.y}function roundPrecision(t,e){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2,i=Math.pow(10,r);return Math.round(Math.floor(t*e)/e*i)/i}function getTileByteLength(t){var e=0;for(var r in t.meshes)for(var i=t.meshes[r],n=0;n<i.length;n++){var o=i[n];e+=o.buffer_size;for(var a=0;a<o.textures.length;a++)e+=t.textureManager.getByteLength(o.textures[a])}return e}function getMaxTileCacheSize(){var t=.1;return navigator&&navigator.deviceMemory?t=5*navigator.deviceMemory/100:window&&window.screen&&(t=window.screen.width/512*window.screen.height/512*.03*3,t=Math.min(t,1)),1024*t*1024*1024}var RenderState=_createClass((function t(e,r){_classCallCheck(this,t),r(e),this.value=e,this.setup=r}),[{key:"get",value:function(){return this.value}},{key:"set",value:function(t){JSON.stringify(this.value)!==JSON.stringify(t)&&(this.setup(t),this.value=t)}}]),RenderStateManager=_createClass((function t(e){_classCallCheck(this,t),this.defaults={},this.defaults.culling=!0,this.defaults.culling_face=e.BACK,this.defaults.blending=!1,this.defaults.blending_src=e.ONE_MINUS_SRC_ALPHA,this.defaults.blending_dst=e.ONE_MINUS_SRC_ALPHA,this.defaults.blending_src_alpha=e.ONE,this.defaults.blending_dst_alpha=e.ONE_MINUS_SRC_ALPHA,this.defaults.depth_write=!0,this.defaults.depth_test=!0,e.depthFunc(e.LESS),this.culling=new RenderState({cull:this.defaults.culling,face:this.defaults.culling_face},(function(t){t.cull?(e.enable(e.CULL_FACE),e.cullFace(t.face)):e.disable(e.CULL_FACE)})),this.blending=new RenderState({blend:this.defaults.blending,src:this.defaults.blending_src,dst:this.defaults.blending_dst,src_alpha:this.defaults.blending_src_alpha,dst_alpha:this.defaults.blending_dst_alpha},(function(t){t.blend?(e.enable(e.BLEND),t.src_alpha&&t.dst_alpha?e.blendFuncSeparate(t.src,t.dst,t.src_alpha,t.dst_alpha):e.blendFunc(t.src,t.dst)):e.disable(e.BLEND)})),this.depth_write=new RenderState({depth_write:this.defaults.depth_write},(function(t){e.depthMask(t.depth_write)})),this.depth_test=new RenderState({depth_test:this.defaults.depth_test},(function(t){t.depth_test?e.enable(e.DEPTH_TEST):e.disable(e.DEPTH_TEST)}))})),MediaCapture=_createClass((function t(){_classCallCheck(this,t),this.canvas=null,this.gl=null,this.screenshot_canvas=null,this.screenshot_context=null,this.queue_screenshot=null,this.video_capture=null}),[{key:"setCanvas",value:function(t,e){this.canvas=t,this.gl=e}},{key:"screenshot",value:function(){var t=this,e=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).background;return null!=this.queue_screenshot||(this.queue_screenshot={background:e},this.queue_screenshot.promise=new Promise((function(e,r){t.queue_screenshot.resolve=e,t.queue_screenshot.reject=r}))),this.queue_screenshot.promise}},{key:"completeScreenshot",value:function(){if(null!=this.queue_screenshot){var t=this.canvas.width,e=this.canvas.height,r=new Uint8Array(t*e*4);this.gl.readPixels(0,0,t,e,this.gl.RGBA,this.gl.UNSIGNED_BYTE,r);var i=this.queue_screenshot.background;i=i&&"transparent"!==i?StyleParser.parseColor(i).slice(0,3).map((function(t){return 255*t})):null;for(var n=new Uint8ClampedArray(t*e*4),o=0;o<e;o++)for(var a=0;a<t;a++){var s=4*((e-o-1)*t+a),l=4*(o*t+a),u=r[s+3];n[l+0]=255*r[s+0]/u,n[l+1]=255*r[s+1]/u,n[l+2]=255*r[s+2]/u,n[l+3]=u,i&&(u/=255,n[l+0]=n[l+0]*u+i[0]*(1-u),n[l+1]=n[l+1]*u+i[1]*(1-u),n[l+2]=n[l+2]*u+i[2]*(1-u),n[l+3]=255)}this.screenshot_canvas=this.screenshot_canvas||document.createElement("canvas");var c=this.screenshot_canvas;c.width=t,c.height=e,this.screenshot_context=this.screenshot_context||c.getContext("2d");var h=this.screenshot_context,p=new ImageData(n,t,e);h.putImageData(p,0,0);for(var f=c.toDataURL("image/png"),d=atob(f.slice(22)),y=new Uint8Array(d.length),g=0;g<d.length;++g)y[g]=d.charCodeAt(g);var v=new Blob([y],{type:"image/png"});this.queue_screenshot.resolve({url:f,blob:v,type:"png"}),this.queue_screenshot=null}}},{key:"startVideoCapture",value:function(){var t=this;if("function"!=typeof window.MediaRecorder||!this.canvas||"function"!=typeof this.canvas.captureStream)return log("warn","Video capture (Canvas.captureStream and/or MediaRecorder APIs) not supported by browser"),!1;if(this.video_capture)return log("warn","Video capture already in progress, call Scene.stopVideoCapture() first"),!1;try{var e=this.video_capture={};e.chunks=[],e.stream=this.canvas.captureStream(),e.options={mimeType:"video/webm"},e.media_recorder=new MediaRecorder(e.stream,e.options),e.media_recorder.ondataavailable=function(r){if(r.data.size>0&&e.chunks.push(r.data),e.resolve){var i=new Blob(e.chunks,{type:e.options.mimeType}),n=createObjectURL(i);e.stream&&(e.stream.getTracks()||[]).forEach((function(t){t.stop(),e.stream.removeTrack(t)})),e.stream=null,e.media_recorder=null,t.video_capture=null,e.resolve({url:n,blob:i,type:"webm"})}},e.media_recorder.start()}catch(t){return this.video_capture=null,log("error","Scene video capture failed",t),!1}return!0}},{key:"stopVideoCapture",value:function(){var t=this;return this.video_capture?(this.video_capture.promise=new Promise((function(e,r){t.video_capture.resolve=e,t.video_capture.reject=r})),this.video_capture.media_recorder.stop(),this.video_capture.promise):(log("warn","No scene video capture in progress, call Scene.startVideoCapture() first"),Promise.resolve({}))}}]),SceneWorker=_createClass((function t(){_classCallCheck(this,t),this.sources={},this.styles={},this.layers={},this.tiles={},this._isConfigured=!1}),[{key:"init",value:function(t,e,r,i,n,o,a){return this.setMeshVariantMaxLife(a),this.scene_id=t,this.textureManager=getTextureManager(t),this._worker_id=e,log.setLevel(r),Utils$1.device_pixel_ratio=i,VertexElements.setElementIndexUint(n),FeatureSelection.setPrefix(this._worker_id),this._style_manager=new StyleManager,this._importExternalScripts(o),Label.id_prefix=e,this._isConfigured=!1,e}},{key:"dispose",value:function(){this._last_config_sources=null,this._config_sources=null,this.sources=null,this._style_manager=null,this.styles=null,this.layers=null,this.tiles=null}},{key:"_importExternalScripts",value:function(t){if(0!==t.length){log("debug","loading custom data source scripts in worker:",t);var e=Object.getOwnPropertyNames(window);importScripts.apply(void 0,_toConsumableArray(t)),Object.getOwnPropertyNames(window).forEach((function(t){-1===e.indexOf(t)&&(self[t]=window[t])}))}}},{key:"updateConfig",value:function(t,e){var r=t.config,i=t.generation,n=t.introspection;for(var o in r=JSON.parse(r),mergeDebugSettings(e),this._generation=i,this._isConfigured=!1,r.layers)r.layers[o]&&(r.layers[o].data=Utils$1.stringsToFunctions(r.layers[o].data));this.global=Utils$1.stringsToFunctions(r.global),this._createDataSources(r),r.styles=Utils$1.stringsToFunctions(r.styles,StyleParser.wrapFunction),this.styles=this._style_manager.build(r.styles),self.is_fake_worker=Thread.is_main,this._style_manager.initStyles({generation:this._generation,styles:this.styles,sources:this.sources,introspection:n,id:this.scene_id}),delete self.is_fake_worker,this.layers=parseLayers(r.layers,this._style_manager.styles),this._configuring=this._syncTextures(r.textures)}},{key:"setMeshVariantMaxLife",value:function(t){this.meshVariantMaxLife=t}},{key:"_createDataSources",value:function(t){var e=this;this._last_config_sources=this._config_sources||{},this._config_sources=t.sources;var r=this.sources,i=[];for(var n in t.sources=Utils$1.stringsToFunctions(t.sources),this.sources={},self.is_fake_worker=Thread.is_main,t.sources)if(JSON.stringify(this._last_config_sources[n])!==JSON.stringify(t.sources[n])){var o=void 0;try{o=DataSource.create(Object.assign({},t.sources[n],{name:n}),this.sources)}catch(e){log("error","Error creating source.",e.message,t.sources[n]);continue}o&&(this.sources[n]=o,i.push(n))}else this.sources[n]=r[n];delete self.is_fake_worker,i.forEach((function(t){for(var r in e.tiles)e.tiles[r].source===t&&delete e.tiles[r]}))}},{key:"awaitConfiguration",value:function(){return this._configuring}},{key:"_onConfig",value:function(t){var e=this;if(this._isConfigured=!0,!0!==t.loaded)t.loading=!0,t.loaded=!1,t.error=null,this._loadTileSourceData(t).then((function(){if(e.getTile(t.id)){t.loading=!1,t.loaded=!0;try{Tile.buildGeometry(t,e)}catch(r){t.error=r.toString(),WorkerBroker.postMessage("TileManager_".concat(e.scene_id,".buildTileError"),Tile.slice(t))}}else log("trace","stop tile build after data source load because tile was removed. Key: ".concat(t.key,", id: ").concat(t.id))}),(function(r){t.loading=!1,t.loaded=!1,t.error=r.stack,log("error","tile load error for tile with key ".concat(t.key," and id ").concat(t.id,": ").concat(t.error)),WorkerBroker.postMessage("TileManager_".concat(e.scene_id,".buildTileError"),Tile.slice(t))}));else{log("trace","used worker cache for tile with key ".concat(t.key," and id ").concat(t.id));try{Tile.buildGeometry(t,this)}catch(e){t.error=e.toString(),WorkerBroker.postMessage("TileManager_".concat(this.scene_id,".buildTileError"),Tile.slice(t))}}}},{key:"buildTile",value:function(t){var e=t.tile,r=this.getTile(e.id);if(!r||!r.loading)if(e=this.tiles[e.id]=Object.assign(r||{},e),this._isConfigured)this._onConfig(e);else{var i=this;this.awaitConfiguration().then((function(){return i._onConfig(e)}))}}},{key:"_loadTileSourceData",value:function(t){return this.sources[t.source]?this.sources[t.source].load(t):(t.source_data={},Promise.resolve(t))}},{key:"getTile",value:function(t){return this.tiles[t]}},{key:"removeTile",value:function(t){var e=this.tiles[t];null!=e&&(!0===e.loading&&(log("trace","cancel tile load for tile id ".concat(t)),e.loading=!1,Tile.cancel(e)),delete this.tiles[t],log("trace","remove tile from cache, tile id: ".concat(t)))}},{key:"queryFeatures",value:function(t){var e=this,r=t.filter,i=t.visible,n=t.geometry,o=t.tile_ids,a=[],s=o.map((function(t){return e.tiles[t]})).filter((function(t){return t}));return null!=r&&(r=["{","["].indexOf(r[0])>-1?JSON.parse(r):r,r=Utils$1.stringsToFunctions(r,StyleParser.wrapFunction)),r=buildFilter(r,FilterOptions),s.forEach((function(t){var o=function(o){t.source_data.layers[o].features.forEach((function(s){if(!(!0===i&&s.generation!==e._generation||!1===i&&s.generation===e._generation)){var l=StyleParser.getFeatureParseContext(s,t,e.global);if(l.source=t.source,l.layer=o,r(l)){var u={type:s.type,properties:s.properties};!0===n&&(u.geometry=Geo$1.copyGeometry(s.geometry),Geo$1.tileSpaceToLatlng(u.geometry,t.coords.z,t.min)),a.push(u)}}}))};for(var s in t.source_data.layers)o(s)})),a}},{key:"resetFeatureSelection",value:function(){FeatureSelection.reset()}},{key:"_syncTextures",value:function(t){var e=[];return t&&e.push.apply(e,_toConsumableArray(Object.keys(t))),log("trace","sync textures to worker:",e),e.length>0?this.textureManager.syncTexturesToWorker(e):Promise.resolve()}},{key:"profile",value:function(t){console.profile("worker ".concat(this._worker_id,": ").concat(t))}},{key:"profileEnd",value:function(t){console.profileEnd("worker ".concat(this._worker_id,": ").concat(t))}},{key:"terminate",value:function(){this.dispose()}}]);(Thread.is_worker||self.H&&self.H.DEBUG)&&WorkerBroker.addTarget("self",new SceneWorker);var Scene=function(){function t(e,r){_classCallCheck(this,t),r=r||{},subscribeMixin(this),this.id=t.id++,this.textureManager=getTextureManager(this.id),this.initialized=!1,this.initializing=null,this.sources={},this.view=new View(this,r),this.tile_manager=new TileManager({scene:this,view:this.view}),this.num_workers=r.numWorkers||2,!0===r.disableVertexArrayObjects&&(VertexArrayObject.disabled=!0),Utils$1.device_pixel_ratio=r.devicePixelRatio,this.config=null,this.config_source=e,this.config_bundle=null,this.last_valid_config_source=null,this.styles=null,this.style_manager=new StyleManager,this.building=null,this.dirty=!0,r.preUpdate&&this.subscribe({pre_update:r.preUpdate}),r.postUpdate&&this.subscribe({post_update:r.postUpdate}),this.render_loop=!r.disableRenderLoop,this.render_loop_active=!1,this.render_loop_stop=!1,this.render_count=0,this.last_render_count=0,this.render_count_changed=!1,this.frame=0,this.last_main_render=-1,this.last_selection_render=-1,this.media_capture=new MediaCapture,this.selection=null,this.introspection=!0===r.introspection,this.viewport=r.viewport,this.adjustMeshVariantMaxLife(),this.container=r.container,this.canvas=null,this.contextOptions=r.webGLContextOptions,this.lights=null,this.background=null,this.createListeners(),this.updating=0,this.generation=t.generation,this.last_complete_generation=t.generation,this.log_level=r.logLevel||"warn",log.setLevel(this.log_level),log.reset()}return _createClass(t,[{key:"load",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.initializing||(log.reset(),this.updating++,this.initialized=!1,this.initial_build_time=null,(r="string"==typeof r?{base_path:r}:r).blocking=void 0===r.blocking||r.blocking,!1!==this.render_loop?this.setupRenderLoop():document.hidden&&document.addEventListener("visibilitychange",(function(){document.hidden||(t.setupRenderLoop(),setTimeout((function(){t.render_loop_stop=!0}),1e3))})),this.createCanvas(),this.textureManager.destroy(this.gl),this.initializing=this.loadScene(e,r).then((function(){return t.createWorkers()})).then((function(){t.resetFeatureSelection();var e="object"===_typeof(t.config_source)||t.hasSubscribersFor("load"),i=t.updateConfig({serialize_funcs:e,normalize:!1,load_event:!0,fade_in:!0});if(!0===r.blocking)return i})).then((function(){t.updating--,t.initializing=null,t.initialized=!0,t.last_valid_config_source=t.config_source,t.last_valid_options={base_path:r.base_path,file_type:r.file_type},t.requestRedraw()})).catch((function(e){var r,i;if(t.initializing=null,t.updating=0,"YAMLException"===e.name?(r="yaml",i="Error parsing scene YAML"):i="Error initializing scene",t.trigger("error",{type:r,message:i,error:e,url:t.config_source}),i="Scene.load() failed to load ".concat(t.config_source,": ").concat(e.message),t.last_valid_config_source)return log("warn",i,e),log("info","Scene.load() reverting to last valid configuration"),t.load(t.last_valid_config_source,t.last_valid_base_path);throw log("error",i,e),e}))),this.initializing}},{key:"destroy",value:function(){if(this.initialized=!1,this.render_loop_stop=!0,this.destroyListeners(),this.canvas&&this.canvas.parentNode&&(this.canvas.parentNode.removeChild(this.canvas),this.canvas=null),this.container=null,this.selection&&this.selection.destroy(),this.gl){this.textureManager.destroy(this.gl),this.style_manager.destroy(this.gl),this.styles={},ShaderProgram.reset();var t=this.gl.getExtension("WEBGL_lose_context");t&&t.loseContext(),this.gl=null}this.sources={},this.tile_manager.destroy(),this.tile_manager=null,this.destroyWorkers(),log.reset()}},{key:"createCanvas",value:function(){if(!this.canvas){this.container=this.container||document.body,this.canvas=document.createElement("canvas"),this.canvas.style.position="absolute",this.canvas.style.top=0,this.canvas.style.left=0,this.container.style.backgroundColor="transparent",this.container.appendChild(this.canvas);try{this.gl=Context$1.getContext(this.canvas,Object.assign({alpha:!0,premultipliedAlpha:!1,stencil:!0,device_pixel_ratio:Utils$1.device_pixel_ratio},this.contextOptions))}catch(t){throw new Error("Couldn't create WebGL context. Your browser may not support WebGL, or it's turned off? Visit http://webglreport.com/ for more info.")}this.handleViewportUpdate(),VertexArrayObject.init(this.gl),this.render_states=new RenderStateManager(this.gl),this.media_capture.setCanvas(this.canvas,this.gl)}}},{key:"getWorkerUrl",value:function(){var t;if(void 0!==__worker_src__){var e="("+__worker_src__+")()";__worker_src_origin__&&""!==__worker_src_map__&&(e+="\n//# sourceMappingURL="+__worker_src_origin__.slice(0,__worker_src_origin__.lastIndexOf("/")+1)+__worker_src_map__),t=createObjectURL(new Blob([e],{type:"application/javascript"}))}if(!t)throw new Error("Couldn't find internal Tangram source variable (may indicate the library did not build correctly)");return t}},{key:"updateExternalScripts",value:function(){var t=_toConsumableArray(this.external_scripts||[]),e=[];if(this.config.scene.scripts)for(var r in this.config.scene.scripts)-1===e.indexOf(this.config.scene.scripts[r])&&e.push(this.config.scene.scripts[r]);for(var i in this.config.sources){var n=this.config.sources[i];if(n.scripts)for(var o in n.scripts)-1===e.indexOf(n.scripts[o])&&e.push(n.scripts[o])}return this.external_scripts=e,!(this.external_scripts.length===t.length&&this.external_scripts.every((function(e,r){return e===t[r]})))}},{key:"createWorkers",value:function(){return this.updateExternalScripts()&&this.destroyWorkers(),this._workers?Promise.resolve():this.makeWorkers(this.getWorkerUrl())}},{key:"makeWorkers",value:function(t){var e=this,r=!!this.gl.getExtension("OES_element_index_uint"),i=[];this._workers=[];for(var n=0,o=function(){var o=new Worker(t);e._workers[n]=o,WorkerBroker.addWorker(o),log("debug","Scene.makeWorkers: initializing worker ".concat(n));var a=n;i.push(WorkerBroker.postMessage(o,"self.init",e.id,n,e.log_level,Utils$1.device_pixel_ratio,r,e.external_scripts,e.meshVariantMaxLife).then((function(t){return log("debug","Scene.makeWorkers: initialized worker ".concat(t)),t}),(function(t){return log("error","Scene.makeWorkers: failed to initialize worker ".concat(a,":"),t),Promise.reject(t)})))};n<this.num_workers;n++)o();var a=new SceneWorker;return this._workers.push(a),i.push(a.init(this.id,n,this.log_level,Utils$1.device_pixel_ratio,r,[],this.meshVariantMaxLife)),this.next_worker=0,Promise.all(i).then((function(){log.setWorkers(e._workers.slice(0,e.num_workers)),revokeObjectURL(t)}))}},{key:"getWorkers",value:function(t){return this._workers.filter((function(e){switch(t){case WorkerType.NATIVE:return e instanceof Worker;case WorkerType.FAKE:return e instanceof SceneWorker;default:return!0}}))}},{key:"destroyWorkers",value:function(){this.selection=null,Array.isArray(this._workers)&&(log.setWorkers(null),this._workers.forEach((function(t){t.terminate()})),this._workers=null)}},{key:"ready",value:function(){return!(!this.view.ready()||0===Object.keys(this.sources).length)}},{key:"handleViewportUpdate",value:function(){var t=this.viewport,e=t.width,r=t.height;e>0&&r>0&&(this.dirty=!0,this.view.handleViewportUpdate(),this.gl&&Context$1.resize(this.gl,e,r,Utils$1.device_pixel_ratio)),this.adjustMeshVariantMaxLife()&&this.syncMeshVariantMaxLife()}},{key:"adjustMeshVariantMaxLife",value:function(){var t=this.viewport,e=t.width,r=t.height,i=Utils$1.device_pixel_ratio,n=e/i/256*(r/i/256),o=Math.max(Math.ceil(2*n),8);if(this.meshVariantMaxLife!==o)return this.meshVariantMaxLife=o,!0}},{key:"syncMeshVariantMaxLife",value:function(){this._workers&&WorkerBroker.postMessage(this._workers,"self.setMeshVariantMaxLife",this.meshVariantMaxLife)}},{key:"requestRedraw",value:function(){this.dirty=!0}},{key:"immediateRedraw",value:function(){this.dirty=!0,this.update()}},{key:"renderLoop",value:function(){this.render_loop_active=!0,this.initialized&&this.update(),Task.setState({user_moving_view:this.view.user_input_active}),Task.processAll(),this.render_loop_stop?(this.render_loop_stop=!1,this.render_loop_active=!1):window.requestAnimationFrame(this.renderLoop.bind(this))}},{key:"setupRenderLoop",value:function(){var t=this;this.render_loop_active||setTimeout((function(){t.renderLoop()}),0)}},{key:"update",value:function(){var t=this.dirty,e=!!this.selection&&this.selection.hasPendingRequests(),r=!(!1===t&&!1===e||!1===this.initialized||this.updating>0||!1===this.ready());return this.trigger("pre_update",r),this.view.update(),!!r&&(this.dirty=!1,this.render({main:t,selection:e}),this.updateViewComplete(),this.media_capture.completeScreenshot(),this.trigger("post_update",r),(!0===this.animated||this.view.isAnimating())&&(this.dirty=!0),this.frame++,log("trace","Scene.render()"),!0)}},{key:"render",value:function(t){var e=this,r=t.main,i=t.selection,n=this.gl;if(Object.keys(this.lights).forEach((function(t){return e.lights[t].update()})),r&&(this.render_count=this.renderPass(),this.last_main_render=this.frame),i){if(this.view.panning||this.view.user_input_active)return void this.selection.clearPendingRequests();(this.last_selection_render<this.last_main_render||this.selection.has_dirty_buffer)&&(this.selection.bind(),this.renderPass("selection_program",{allow_blend:!1}),n.bindFramebuffer(n.FRAMEBUFFER,null),n.viewport(0,0,this.canvas.width,this.canvas.height),n.clearColor.apply(n,_toConsumableArray(this.background.color)),this.last_selection_render=this.frame,this.selection.has_dirty_buffer=!1),this.selection.read(this.tile_manager.getRenderableTiles()),this.selection.has_dirty_buffer&&this.render({main:!1,selection:i})}return this.render_count_changed=!1,this.render_count!==this.last_render_count&&(this.render_count_changed=!0),this.last_render_count=this.render_count,!0}},{key:"renderPass",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"program",r=(arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}).allow_blend,i=this.gl;r=null==r||r,this.clearFrame();for(var n,o,a=Style.sortByBlendOrderWithinLayers(this.tile_manager.getActiveStyles().map((function(e){return t.styles[e]})).filter((function(t){return t}))),s=0,l=0,u=0;u<a.length;u++){var c=a[u],h=l-(o=parseInt(c.name));if((c.clean_depth||h)&&(this.render_states.depth_write.value.depth_write?i.clear(i.DEPTH_BUFFER_BIT):(i.depthMask(!0),i.clear(i.DEPTH_BUFFER_BIT),i.depthMask(!1)),h&&(l=o)),c.blend!==n){var p=Object.assign({},Style.render_states[c.blend],{blend:r&&c.blend});this.setRenderState(p)}var f="translucent"===c.blend&&"program"===e;f&&(this.gl.colorMask(!1,!1,!1,!1),this.renderStyle(c.name,e),this.gl.colorMask(!0,!0,!0,!0),this.gl.depthFunc(this.gl.EQUAL),this.gl.enable(this.gl.STENCIL_TEST),this.gl.clear(this.gl.STENCIL_BUFFER_BIT),this.gl.stencilFunc(this.gl.EQUAL,this.gl.ZERO,255),this.gl.stencilOp(this.gl.KEEP,this.gl.KEEP,this.gl.INCR)),s+=this.renderStyle(c.name,e),f&&(this.gl.disable(this.gl.STENCIL_TEST),this.gl.depthFunc(this.gl.LESS)),n=c.blend}return s}},{key:"renderStyle",value:function(t,e){for(var r,i,n=this,o=this.styles[t],a=!0,s=0,l=this.tile_manager.getRenderableTiles(),u=Math.max.apply(Math,_toConsumableArray(l.map((function(e){return e.meshes[t]?Math.max.apply(Math,_toConsumableArray(e.meshes[t].map((function(t){return t.variant.order})))):-1})))),c=function(i){for(var u=0;u<l.length;u++){var c=l[u];if(null!=c.meshes[t]&&c.shouldProxyForStyle(t))for(var h=c.meshes[t].filter((function(t){return t.variant.order===i})),p=0,f=h.length;p<f;p+=1){var d=h[p];if(!0===a&&(a=!1,!(r=n.setupStyle(o,e))))return{v:0};n.view.setupTile(c,r),n.selection.setupDiscards(r),o.render(d)&&n.requestRedraw(),s+=d.geometry_count}}},h=0;h<u+1;h++)if(i=c(h))return i.v;return s}},{key:"setupStyle",value:function(t,e){var r;try{if(!(r=t.getProgram(e)))return}catch(e){return void this.trigger("warning",{type:"styles",message:"Error compiling style ".concat(t.name),style:t,shader_errors:t.program&&t.program.shader_errors})}for(var i in r.use(),t.setup(),this.view.setupProgram(r),this.lights)this.lights[i].setupProgram(r);return r}},{key:"clearFrame",value:function(){this.initialized&&(this.render_states.depth_write.set({depth_write:!0}),this.gl.clear(this.gl.COLOR_BUFFER_BIT|this.gl.DEPTH_BUFFER_BIT|this.gl.STENCIL_BUFFER_BIT))}},{key:"setRenderState",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=t.depth_test,r=t.depth_write,i=t.cull_face,n=t.blend;if(this.initialized){var o=this.render_states;e=!1!==e&&o.defaults.depth_test,r=!1!==r&&o.defaults.depth_write,i=!1!==i&&o.defaults.culling,n=null!=n?n:o.defaults.blending;var a=this.gl;o.depth_test.set({depth_test:e}),o.depth_write.set({depth_write:r}),o.culling.set({cull:i,face:o.defaults.culling_face}),n?"opaque"===n?o.blending.set({blend:!1}):"overlay"===n||"inlay"===n||"translucent"===n?o.blending.set({blend:!0,src:a.SRC_ALPHA,dst:a.ONE_MINUS_SRC_ALPHA,src_alpha:a.ONE,dst_alpha:a.ONE_MINUS_SRC_ALPHA}):"add"===n?o.blending.set({blend:!0,src:a.ONE,dst:a.ONE}):"multiply"===n&&o.blending.set({blend:!0,src:a.ZERO,dst:a.SRC_COLOR}):o.blending.set({blend:!1})}}},{key:"getFeatureAt",value:function(t,e,r){var i=e.radius,n=e.top_most_only;if(this.initialized){var o={x:t.x/this.view.size.css.width,y:t.y/this.view.size.css.height};i=i>0?{x:i/this.view.size.css.width,y:i/this.view.size.css.height}:null,this.selection.getFeatureAt(o,{radius:i,top_most_only:n},r)}else log("debug","Scene.getFeatureAt() called before scene was initialized")}},{key:"queryFeatures",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=t.filter,r=t.unique,i=void 0===r||r,n=t.group_by,o=void 0===n?null:n,a=t.visible,s=void 0===a?null:a,l=t.geometry,u=void 0!==l&&l;e=Utils$1.serializeWithFunctions(e);var c=this.tile_manager.getRenderableTiles().map((function(t){return t.id}));return WorkerBroker.postMessage(this._workers,"self.queryFeatures",{filter:e,visible:s,geometry:u,tile_ids:c}).then((function(t){var e=[],r={},n={},a=(i="string"==typeof i?[i]:i)&&function(t){return JSON.stringify(Array.isArray(i)?sliceObject(t,i):t)},s=(o=("string"==typeof o||Array.isArray(o))&&o)&&function(t){return Array.isArray(o)?JSON.stringify(sliceObject(t,o)):t[o]};return t.forEach((function(t){return t.forEach((function(t){if(a){var i=a(t);if(r[i])return;r[i]=!0}if(s){var o=s(t.properties);n[o]=n[o]||[],n[o].push(t)}else e.push(t)}))})),s?n:e}))}},{key:"loadScene",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=r.base_path,n=r.file_type;return this.config_source=e||this.config_source,"string"==typeof this.config_source?this.base_path=pathForURL(i||this.config_source):this.base_path=pathForURL(i),this.config_path=this.base_path,SceneLoader$1.loadScene(this.config_source,{path:this.base_path,type:n}).then((function(e){var r=e.config,i=e.bundle;return t.config=r,t.config_bundle=i,t.config}))}},{key:"createDataSources",value:function(){var t=this,e=[],r=Object.keys(this.sources),i=0;for(var n in this.config.sources){var o=this.config.sources[n],a=this.sources[n];try{var s=Object.assign({},o,{name:n,id:i++});if(this.sources[n]=DataSource.create(s,this.sources),!this.sources[n])throw{}}catch(t){delete this.sources[n];var l="Could not create data source: ".concat(t.message);log("warn","Scene: ".concat(l),o),this.trigger("warning",{type:"sources",source:o,message:l})}DataSource.sameConfig(this.sources[n],a)||e.push(n)}for(var u in r.forEach((function(r){t.config.sources[r]||(delete t.sources[r],e.push(r))})),e.length>0&&this.tile_manager.removeTiles((function(t){return e.indexOf(t.source.name)>-1})),this.config.layers){var c=this.config.layers[u];!1!==c.enabled&&c.data&&this.sources[c.data.source]&&(this.sources[c.data.source].builds_geometry_tiles=!0)}}},{key:"loadTextures",value:function(){var t=this;return this.textureManager.createFromObject(this.gl,this.config.textures).then((function(){return t.textureManager.createDefault(t.gl)}))}},{key:"updateStyles",value:function(){if(!this.initialized&&!this.initializing)throw new Error("Scene.updateStyles() called before scene was initialized");for(var t in this.styles=this.style_manager.build(this.config.styles),this.style_manager.initStyles(this),this.styles)this.styles[t].setGL(this.gl);this.dirty=!0}},{key:"animated",get:function(){var t=this;return void 0!==this.config.scene.animated?this.config.scene.animated:this.tile_manager.getActiveStyles().some((function(e){return t.styles[e]&&t.styles[e].animated}))}},{key:"createLights",value:function(){for(var t in this.lights={},this.config.lights)if(this.config.lights[t]&&"object"===_typeof(this.config.lights[t])){var e=this.config.lights[t];e.name=t.replace("-","_"),e.visible=!1!==e.visible,e.visible&&(this.lights[e.name]=Light.create(this.view,e))}Light.inject(this.lights)}},{key:"setBackground",value:function(){var t,e=this.config.scene.background;this.background={},e&&e.color&&(this.background.color=StyleParser.parseColor(e.color)),this.background.color||(this.background.color=[0,0,0,0]),1===this.background.color[3]?this.canvas.style.backgroundColor="rgba(".concat(this.background.color.map((function(t){return Math.floor(255*t)})).join(", "),")"):this.canvas.style.backgroundColor="transparent",(t=this.gl).clearColor.apply(t,_toConsumableArray(this.background.color))}},{key:"setIntrospection",value:function(t){var e=this;return t!==this.introspection?(this.introspection=t||!1,this.updating++,this.updateConfig({normalize:!1}).then((function(){return e.updating--}))):Promise.resolve()}},{key:"updateConfig",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=e.load_event,i=void 0!==r&&r,n=e.serialize_funcs,o=e.normalize,a=void 0===o||o;e.fade_in,this.generation=++t.generation,this.updating++,this.config=SceneLoader$1.applyGlobalProperties(this.config),a?SceneLoader$1.normalize(this.config,this.config_bundle):(SceneLoader$1.hoistStyleShaderUniformTextures(this.config,this.config_bundle,{include_globals:!0}),SceneLoader$1.normalizeTextures(this.config,this.config_bundle)),this.trigger(i?"load":"update",{config:this.config}),this.style_manager.init(),this.createLights(),this.createDataSources(),this.loadTextures(),this.setBackground(),FontManager.loadFonts(this.config.fonts),this.updateStyles();var s=this.syncConfigToWorker({serialize_funcs:n});return this.updating--,this.view.updateBounds(),this.requestRedraw(),s}},{key:"syncConfigToWorker",value:function(){var t=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).serialize_funcs,e=void 0===t||t?Utils$1.serializeWithFunctions(this.config):JSON.stringify(this.config);return WorkerBroker.postMessage(this._workers,"self.updateConfig",{config:e,generation:this.generation,introspection:this.introspection},debugSettings$1)}},{key:"createListeners",value:function(){var t=this;this.listeners={},this.listeners.view={move:function(){return t.trigger("move")}},this.view.subscribe(this.listeners.view),this.listeners.texture={update:function(){return t.dirty=!0},warning:function(e){return t.trigger("warning",Object.assign({type:"textures"},e))}},this.textureManager.subscribe(this.listeners.texture),this.listeners.scene_loader={error:function(e){return t.trigger("error",Object.assign({type:"scene"},e))}},SceneLoader$1.subscribe(this.listeners.scene_loader)}},{key:"destroyListeners",value:function(){this.unsubscribeAll(),this.view.unsubscribe(this.listeners.view),this.textureManager.unsubscribe(this.listeners.texture),SceneLoader$1.unsubscribe(this.listeners.scene_loader),this.listeners=null}},{key:"resetFeatureSelection",value:function(){this.selection?this._workers&&WorkerBroker.postMessage(this._workers,"self.resetFeatureSelection"):this.selection=new FeatureSelection(this.gl,this.id)}},{key:"updateViewComplete",value:function(){(this.render_count_changed||this.generation!==this.last_complete_generation)&&this.tile_manager.isReady()&&(this.last_complete_generation=this.generation,this.trigger("view_complete"))}},{key:"resetViewComplete",value:function(){this.last_complete_generation=null}},{key:"screenshot",value:function(){var t=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).background,e=void 0===t?"white":t;return this.requestRedraw(),this.media_capture.screenshot({background:e})}},{key:"pixelRatio",value:function(){return Utils$1.device_pixel_ratio}},{key:"startVideoCapture",value:function(){return this.requestRedraw(),this.media_capture.startVideoCapture()}},{key:"stopVideoCapture",value:function(){return this.media_capture.stopVideoCapture()}},{key:"_profile",value:function(t){console.profile("main thread: ".concat(t)),WorkerBroker.postMessage(this._workers,"self.profile",t)}},{key:"_profileEnd",value:function(t){console.profileEnd("main thread: ".concat(t)),WorkerBroker.postMessage(this._workers,"self.profileEnd",t)}},{key:"getCameraMatrix",value:function(){return this.view.lookAtManipulator.getCameraMatrix()}}],[{key:"create",value:function(e){return new t(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:{})}}])}();Scene.id=0,Scene.generation=0;var RemoteTexture=function(t){function e(t,r,i){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};_classCallCheck(this,e);var o,a=Math.pow(2,n.coords.z),s=Math.abs(Math.floor(n.coords.x/a));o=Math.abs(a*s-Math.abs(n.coords.x));var l=n.coords;return n.coords={x:o,y:l.y,z:l.z},_callSuper(this,e,[t,r,i,n])}return _inherits(e,t),_createClass(e,[{key:"load",value:function(t){var r=this;if(!t||!t.uid)return _get(_getPrototypeOf(e.prototype),"load",this).call(this,t);var i=t.coords,n=new Uint8Array([0,0,0,0]);return this.loading=new Promise((function(e,o){var a=H.map.DataModel.invoke(t.uid,"requestTileAsPromise",[i.x,i.y,i.z])||null;a?a.then((function(e){var i=e.data;r.loaded=!0,!i||i instanceof ArrayBuffer?r.setData(1,1,n,{filtering:"nearest"}):"IMG"===i.tagName.toUpperCase()||"CANVAS"===i.tagName.toUpperCase()?r.setElement(i,t):r.setData(1,1,n,{filtering:"nearest"})}),(function(){r.loaded=!1})).then(e,(function(t){return o(t)})):o(new Error("Unable to invoke on target "+t.uid))})),this.loading}}])}(Texture);TextureManager.register(RemoteTexture,(function(t){return t&&t.uid})),self.H=self.H||{},self.H.gl={DataSource,Geo:Geo$1,MathUtils:MathUtils$1,Scene,Task,Tile,WorkerBroker,log,SceneLoader:SceneLoader$1,yaml:jsYaml}})()};f()}(),this.H=this.H||{},this.H.venues=function(t){function e(t,e){void 0===e&&(e={});var r=e.insertAt;if(t&&"undefined"!=typeof document){var i=document.head||document.getElementsByTagName("head")[0],n=document.createElement("style");n.type="text/css","top"===r&&i.firstChild?i.insertBefore(n,i.firstChild):i.appendChild(n),n.styleSheet?n.styleSheet.cssText=t:n.appendChild(document.createTextNode(t))}}function r(t,e,r){return e=g(e),function(t,e){if(e&&("object"==typeof e||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(t,n()?Reflect.construct(e,r||[],g(t).constructor):e.apply(t,r))}function i(t,e,r){if(n())return Reflect.construct.apply(null,arguments);var i=[null];i.push.apply(i,e);var o=new(t.bind.apply(t,i));return r&&v(o,r.prototype),o}function n(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(t){}return(n=function(){return!!t})()}function o(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,i)}return r}function a(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?o(Object(r),!0).forEach((function(e){d(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):o(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}function s(){s=function(){return e};var t,e={},r=Object.prototype,i=r.hasOwnProperty,n=Object.defineProperty||function(t,e,r){t[e]=r.value},o="function"==typeof Symbol?Symbol:{},a=o.iterator||"@@iterator",l=o.asyncIterator||"@@asyncIterator",u=o.toStringTag||"@@toStringTag";function c(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{c({},"")}catch(t){c=function(t,e,r){return t[e]=r}}function h(t,e,r,i){var o=e&&e.prototype instanceof m?e:m,a=Object.create(o.prototype),s=new L(i||[]);return n(a,"_invoke",{value:k(t,r,s)}),a}function p(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}e.wrap=h;var f="suspendedStart",d="suspendedYield",y="executing",g="completed",v={};function m(){}function _(){}function b(){}var x={};c(x,a,(function(){return this}));var w=Object.getPrototypeOf,E=w&&w(w(C([])));E&&E!==r&&i.call(E,a)&&(x=E);var T=b.prototype=m.prototype=Object.create(x);function A(t){["next","throw","return"].forEach((function(e){c(t,e,(function(t){return this._invoke(e,t)}))}))}function S(t,e){function r(n,o,a,s){var l=p(t[n],t,o);if("throw"!==l.type){var u=l.arg,c=u.value;return c&&"object"==typeof c&&i.call(c,"__await")?e.resolve(c.__await).then((function(t){r("next",t,a,s)}),(function(t){r("throw",t,a,s)})):e.resolve(c).then((function(t){u.value=t,a(u)}),(function(t){return r("throw",t,a,s)}))}s(l.arg)}var o;n(this,"_invoke",{value:function(t,i){function n(){return new e((function(e,n){r(t,i,e,n)}))}return o=o?o.then(n,n):n()}})}function k(e,r,i){var n=f;return function(o,a){if(n===y)throw Error("Generator is already running");if(n===g){if("throw"===o)throw a;return{value:t,done:!0}}for(i.method=o,i.arg=a;;){var s=i.delegate;if(s){var l=I(s,i);if(l){if(l===v)continue;return l}}if("next"===i.method)i.sent=i._sent=i.arg;else if("throw"===i.method){if(n===f)throw n=g,i.arg;i.dispatchException(i.arg)}else"return"===i.method&&i.abrupt("return",i.arg);n=y;var u=p(e,r,i);if("normal"===u.type){if(n=i.done?g:d,u.arg===v)continue;return{value:u.arg,done:i.done}}"throw"===u.type&&(n=g,i.method="throw",i.arg=u.arg)}}}function I(e,r){var i=r.method,n=e.iterator[i];if(n===t)return r.delegate=null,"throw"===i&&e.iterator.return&&(r.method="return",r.arg=t,I(e,r),"throw"===r.method)||"return"!==i&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+i+"' method")),v;var o=p(n,e.iterator,r.arg);if("throw"===o.type)return r.method="throw",r.arg=o.arg,r.delegate=null,v;var a=o.arg;return a?a.done?(r[e.resultName]=a.value,r.next=e.nextLoc,"return"!==r.method&&(r.method="next",r.arg=t),r.delegate=null,v):a:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,v)}function P(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function O(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function L(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(P,this),this.reset(!0)}function C(e){if(e||""===e){var r=e[a];if(r)return r.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var n=-1,o=function r(){for(;++n<e.length;)if(i.call(e,n))return r.value=e[n],r.done=!1,r;return r.value=t,r.done=!0,r};return o.next=o}}throw new TypeError(typeof e+" is not iterable")}return _.prototype=b,n(T,"constructor",{value:b,configurable:!0}),n(b,"constructor",{value:_,configurable:!0}),_.displayName=c(b,u,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===_||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,b):(t.__proto__=b,c(t,u,"GeneratorFunction")),t.prototype=Object.create(T),t},e.awrap=function(t){return{__await:t}},A(S.prototype),c(S.prototype,l,(function(){return this})),e.AsyncIterator=S,e.async=function(t,r,i,n,o){void 0===o&&(o=Promise);var a=new S(h(t,r,i,n),o);return e.isGeneratorFunction(r)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},A(T),c(T,u,"Generator"),c(T,a,(function(){return this})),c(T,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),r=[];for(var i in e)r.push(i);return r.reverse(),function t(){for(;r.length;){var i=r.pop();if(i in e)return t.value=i,t.done=!1,t}return t.done=!0,t}},e.values=C,L.prototype={constructor:L,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(O),!e)for(var r in this)"t"===r.charAt(0)&&i.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=t)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var r=this;function n(i,n){return s.type="throw",s.arg=e,r.next=i,n&&(r.method="next",r.arg=t),!!n}for(var o=this.tryEntries.length-1;o>=0;--o){var a=this.tryEntries[o],s=a.completion;if("root"===a.tryLoc)return n("end");if(a.tryLoc<=this.prev){var l=i.call(a,"catchLoc"),u=i.call(a,"finallyLoc");if(l&&u){if(this.prev<a.catchLoc)return n(a.catchLoc,!0);if(this.prev<a.finallyLoc)return n(a.finallyLoc)}else if(l){if(this.prev<a.catchLoc)return n(a.catchLoc,!0)}else{if(!u)throw Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return n(a.finallyLoc)}}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var n=this.tryEntries[r];if(n.tryLoc<=this.prev&&i.call(n,"finallyLoc")&&this.prev<n.finallyLoc){var o=n;break}}o&&("break"===t||"continue"===t)&&o.tryLoc<=e&&e<=o.finallyLoc&&(o=null);var a=o?o.completion:{};return a.type=t,a.arg=e,o?(this.method="next",this.next=o.finallyLoc,v):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),v},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),O(r),v}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var i=r.completion;if("throw"===i.type){var n=i.arg;O(r)}return n}}throw Error("illegal catch attempt")},delegateYield:function(e,r,i){return this.delegate={iterator:C(e),resultName:r,nextLoc:i},"next"===this.method&&(this.arg=t),v}},e}function l(t){var e=function(t){if("object"!=typeof t||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var r=e.call(t,"string");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==typeof e?e:e+""}function u(t){return u="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},u(t)}function c(t,e,r,i,n,o,a){try{var s=t[o](a),l=s.value}catch(t){return void r(t)}s.done?e(l):Promise.resolve(l).then(i,n)}function h(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function p(t,e){for(var r=0;r<e.length;r++){var i=e[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,l(i.key),i)}}function f(t,e,r){return e&&p(t.prototype,e),r&&p(t,r),Object.defineProperty(t,"prototype",{writable:!1}),t}function d(t,e,r){return(e=l(e))in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function y(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&v(t,e)}function g(t){return g=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},g(t)}function v(t,e){return v=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},v(t,e)}function m(){return m="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,e,r){var i=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=g(t)););return t}(t,e);if(i){var n=Object.getOwnPropertyDescriptor(i,e);return n.get?n.get.call(arguments.length<3?t:r):n.value}},m.apply(this,arguments)}function _(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var r=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=r){var i,n,o,a,s=[],l=!0,u=!1;try{if(o=(r=r.call(t)).next,0===e){if(Object(r)!==r)return;l=!1}else for(;!(l=(i=o.call(r)).done)&&(s.push(i.value),s.length!==e);l=!0);}catch(t){u=!0,n=t}finally{try{if(!l&&null!=r.return&&(a=r.return(),Object(a)!==a))return}finally{if(u)throw n}}return s}}(t,e)||x(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function b(t){return function(t){if(Array.isArray(t))return w(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||x(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function x(t,e){if(t){if("string"==typeof t)return w(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?w(t,e):void 0}}function w(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,i=new Array(e);r<e;r++)i[r]=t[r];return i}e(".H_l_right .venues-ui__drawings .trigger.button--active .arrow {\n  transform: rotate(90deg);\n}\n.H_l_right .venues-ui__drawings .drawings {\n  right: 45px;\n  left: initial;\n}");var E=function(){function t(e){var i;return h(this,t),(i=r(this,t)).id=e.id,i.model=e,i}return y(t,H.map.Feature),f(t,[{key:"getData",value:function(){return this.model}},{key:"getAddress",value:function(){return this.model.getInternalAddress()}},{key:"getCenter",value:function(){var t=_(this.model.getCenter(),2),e=t[0],r=t[1];return new H.geo.Point(r,e)}},{key:"getId",value:function(){return this.model.getId()}},{key:"getIdentifier",value:function(){return this.model.getIdentifier()}},{key:"getName",value:function(){return this.model.getDisplayName()}},{key:"toGeoJSON",value:function(){return this.model.toJSON()}},{key:"getLevel",value:function(){return this.getParentEventTarget()}},{key:"getVenue",value:function(){return this.getLevel().getDrawing().getParentEventTarget()}}])}(),T=function(){function t(e){var i;return h(this,t),(i=r(this,t)).id=e.id,i.model=e,i}return y(t,H.map.Feature),f(t,[{key:"getData",value:function(){return this.model}},{key:"getBoundingBox",value:function(){return i(H.geo.Rect,b(this.model.getBoundingBox()))}},{key:"getCenter",value:function(){var t=_(this.model.getCenter(),2),e=t[0],r=t[1];return new H.geo.Point(r,e)}},{key:"getId",value:function(){return this.model.getId()}},{key:"getIdentifier",value:function(){return this.model.getIdentifier()}},{key:"getName",value:function(){return this.model.getDisplayName()}},{key:"getLevel",value:function(t){return this.getLevels().find((function(e){return e.getIdentifier()===t}))}},{key:"getLevels",value:function(){var t=this.getData().getLevels().map((function(t){return t.getIdentifier()}));return this.getVenue().getLevels().filter((function(e){return-1!==t.indexOf(e.id)}))}},{key:"getMainLevel",value:function(){return this.getLevel(this.model.getMainLevel().getIdentifier())}},{key:"getVenue",value:function(){return this.getParentEventTarget()}}])}(),A=function(){function t(e){var i;return h(this,t),(i=r(this,t)).id=e.id,i.model=e,i}return y(t,H.map.Feature),f(t,[{key:"getGeometry",value:function(t){return this.getGeometries().find((function(e){return e.getIdentifier()===t}))}},{key:"getGeometries",value:function(){var t=this.getData().getGeometries().map((function(t){return t.getIdentifier()}));return this.getDrawing().getVenue().getGeometries().filter((function(e){return-1!==t.indexOf(e.id)}))}},{key:"getData",value:function(){return this.model}},{key:"getId",value:function(){return this.model.getId()}},{key:"getIdentifier",value:function(){return this.model.getIdentifier()}},{key:"getName",value:function(){return this.model.getDisplayName()}},{key:"getShortName",value:function(){return this.model.getShortName()}},{key:"getZIndex",value:function(){return this.model.getZIndex()}},{key:"isMain",value:function(){return this.model.isMain()}},{key:"getDrawing",value:function(){return this.getParentEventTarget()}},{key:"getVenue",value:function(){return this.getDrawing().getParentEventTarget()}}])}();function S(t,e,r,i){for(var n,o=i,a=r-e>>1,s=r-e,l=t[e],u=t[e+1],c=t[r],h=t[r+1],p=e+3;p<r;p+=3){var f=k(t[p],t[p+1],l,u,c,h);if(f>o)n=p,o=f;else if(f===o){var d=Math.abs(p-a);d<s&&(n=p,s=d)}}o>i&&(n-e>3&&S(t,e,n,i),t[n+2]=o,r-n>3&&S(t,n,r,i))}function k(t,e,r,i,n,o){var a=n-r,s=o-i;if(0!==a||0!==s){var l=((t-r)*a+(e-i)*s)/(a*a+s*s);l>1?(r=n,i=o):l>0&&(r+=a*l,i+=s*l)}return(a=t-r)*a+(s=e-i)*s}function I(t,e,r,i){var n={id:void 0===t?null:t,type:e,geometry:r,tags:i,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(t){var e=t.geometry,r=t.type;if("Point"===r||"MultiPoint"===r||"LineString"===r)P(t,e);else if("Polygon"===r||"MultiLineString"===r)for(var i=0;i<e.length;i++)P(t,e[i]);else if("MultiPolygon"===r)for(i=0;i<e.length;i++)for(var n=0;n<e[i].length;n++)P(t,e[i][n])}(n),n}function P(t,e){for(var r=0;r<e.length;r+=3)t.minX=Math.min(t.minX,e[r]),t.minY=Math.min(t.minY,e[r+1]),t.maxX=Math.max(t.maxX,e[r]),t.maxY=Math.max(t.maxY,e[r+1])}function O(t,e,r,i){if(e.geometry){var n=e.geometry.coordinates,o=e.geometry.type,a=Math.pow(r.tolerance/((1<<r.maxZoom)*r.extent),2),s=[],l=e.id;if(r.promoteId?l=e.properties[r.promoteId]:r.generateId&&(l=i||0),"Point"===o)L(n,s);else if("MultiPoint"===o)for(var u=0;u<n.length;u++)L(n[u],s);else if("LineString"===o)C(n,s,a,!1);else if("MultiLineString"===o){if(r.lineMetrics){for(u=0;u<n.length;u++)s=[],C(n[u],s,a,!1),t.push(I(l,"LineString",s,e.properties));return}R(n,s,a,!1)}else if("Polygon"===o)R(n,s,a,!0);else{if("MultiPolygon"!==o){if("GeometryCollection"===o){for(u=0;u<e.geometry.geometries.length;u++)O(t,{id:l,geometry:e.geometry.geometries[u],properties:e.properties},r,i);return}throw new Error("Input data is not a valid GeoJSON object.")}for(u=0;u<n.length;u++){var c=[];R(n[u],c,a,!0),s.push(c)}}t.push(I(l,o,s,e.properties))}}function L(t,e){e.push(M(t[0])),e.push(N(t[1])),e.push(0)}function C(t,e,r,i){for(var n,o,a=0,s=0;s<t.length;s++){var l=M(t[s][0]),u=N(t[s][1]);e.push(l),e.push(u),e.push(0),s>0&&(a+=i?(n*u-l*o)/2:Math.sqrt(Math.pow(l-n,2)+Math.pow(u-o,2))),n=l,o=u}var c=e.length-3;e[2]=1,S(e,0,c,r),e[c+2]=1,e.size=Math.abs(a),e.start=0,e.end=e.size}function R(t,e,r,i){for(var n=0;n<t.length;n++){var o=[];C(t[n],o,r,i),e.push(o)}}function M(t){return t/360+.5}function N(t){var e=Math.sin(t*Math.PI/180),r=.5-.25*Math.log((1+e)/(1-e))/Math.PI;return r<0?0:r>1?1:r}function j(t,e,r,i,n,o,a,s){if(i/=e,o>=(r/=e)&&a<i)return t;if(a<r||o>=i)return null;for(var l=[],u=0;u<t.length;u++){var c=t[u],h=c.geometry,p=c.type,f=0===n?c.minX:c.minY,d=0===n?c.maxX:c.maxY;if(f>=r&&d<i)l.push(c);else if(!(d<r||f>=i)){var y=[];if("Point"===p||"MultiPoint"===p)D(h,y,r,i,n);else if("LineString"===p)B(h,y,r,i,n,!1,s.lineMetrics);else if("MultiLineString"===p)U(h,y,r,i,n,!1);else if("Polygon"===p)U(h,y,r,i,n,!0);else if("MultiPolygon"===p)for(var g=0;g<h.length;g++){var v=[];U(h[g],v,r,i,n,!0),v.length&&y.push(v)}if(y.length){if(s.lineMetrics&&"LineString"===p){for(g=0;g<y.length;g++)l.push(I(c.id,p,y[g],c.tags));continue}"LineString"!==p&&"MultiLineString"!==p||(1===y.length?(p="LineString",y=y[0]):p="MultiLineString"),"Point"!==p&&"MultiPoint"!==p||(p=3===y.length?"Point":"MultiPoint"),l.push(I(c.id,p,y,c.tags))}}}return l.length?l:null}function D(t,e,r,i,n){for(var o=0;o<t.length;o+=3){var a=t[o+n];a>=r&&a<=i&&(e.push(t[o]),e.push(t[o+1]),e.push(t[o+2]))}}function B(t,e,r,i,n,o,a){for(var s,l,u=z(t),c=0===n?G:$,h=t.start,p=0;p<t.length-3;p+=3){var f=t[p],d=t[p+1],y=t[p+2],g=t[p+3],v=t[p+4],m=0===n?f:d,_=0===n?g:v,b=!1;a&&(s=Math.sqrt(Math.pow(f-g,2)+Math.pow(d-v,2))),m<r?_>r&&(l=c(u,f,d,g,v,r),a&&(u.start=h+s*l)):m>i?_<i&&(l=c(u,f,d,g,v,i),a&&(u.start=h+s*l)):F(u,f,d,y),_<r&&m>=r&&(l=c(u,f,d,g,v,r),b=!0),_>i&&m<=i&&(l=c(u,f,d,g,v,i),b=!0),!o&&b&&(a&&(u.end=h+s*l),e.push(u),u=z(t)),a&&(h+=s)}var x=t.length-3;f=t[x],d=t[x+1],y=t[x+2],(m=0===n?f:d)>=r&&m<=i&&F(u,f,d,y),x=u.length-3,o&&x>=3&&(u[x]!==u[0]||u[x+1]!==u[1])&&F(u,u[0],u[1],u[2]),u.length&&e.push(u)}function z(t){var e=[];return e.size=t.size,e.start=t.start,e.end=t.end,e}function U(t,e,r,i,n,o){for(var a=0;a<t.length;a++)B(t[a],e,r,i,n,o,!1)}function F(t,e,r,i){t.push(e),t.push(r),t.push(i)}function G(t,e,r,i,n,o){var a=(o-e)/(i-e);return t.push(o),t.push(r+(n-r)*a),t.push(1),a}function $(t,e,r,i,n,o){var a=(o-r)/(n-r);return t.push(e+(i-e)*a),t.push(o),t.push(1),a}function q(t,e){for(var r=[],i=0;i<t.length;i++){var n,o=t[i],a=o.type;if("Point"===a||"MultiPoint"===a||"LineString"===a)n=V(o.geometry,e);else if("MultiLineString"===a||"Polygon"===a){n=[];for(var s=0;s<o.geometry.length;s++)n.push(V(o.geometry[s],e))}else if("MultiPolygon"===a)for(n=[],s=0;s<o.geometry.length;s++){for(var l=[],u=0;u<o.geometry[s].length;u++)l.push(V(o.geometry[s][u],e));n.push(l)}r.push(I(o.id,a,n,o.tags))}return r}function V(t,e){var r=[];r.size=t.size,void 0!==t.start&&(r.start=t.start,r.end=t.end);for(var i=0;i<t.length;i+=3)r.push(t[i]+e,t[i+1],t[i+2]);return r}function Y(t,e){if(t.transformed)return t;var r,i,n,o=1<<t.z,a=t.x,s=t.y;for(r=0;r<t.features.length;r++){var l=t.features[r],u=l.geometry,c=l.type;if(l.geometry=[],1===c)for(i=0;i<u.length;i+=2)l.geometry.push(W(u[i],u[i+1],e,o,a,s));else for(i=0;i<u.length;i++){var h=[];for(n=0;n<u[i].length;n+=2)h.push(W(u[i][n],u[i][n+1],e,o,a,s));l.geometry.push(h)}}return t.transformed=!0,t}function W(t,e,r,i,n,o){return[Math.round(r*(t*i-n)),Math.round(r*(e*i-o))]}function X(t,e,r,i,n){for(var o=e===n.maxZoom?0:n.tolerance/((1<<e)*n.extent),a={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:r,y:i,z:e,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},s=0;s<t.length;s++){a.numFeatures++,K(a,t[s],o,n);var l=t[s].minX,u=t[s].minY,c=t[s].maxX,h=t[s].maxY;l<a.minX&&(a.minX=l),u<a.minY&&(a.minY=u),c>a.maxX&&(a.maxX=c),h>a.maxY&&(a.maxY=h)}return a}function K(t,e,r,i){var n=e.geometry,o=e.type,a=[];if("Point"===o||"MultiPoint"===o)for(var s=0;s<n.length;s+=3)a.push(n[s]),a.push(n[s+1]),t.numPoints++,t.numSimplified++;else if("LineString"===o)Z(a,n,t,r,!1,!1);else if("MultiLineString"===o||"Polygon"===o)for(s=0;s<n.length;s++)Z(a,n[s],t,r,"Polygon"===o,0===s);else if("MultiPolygon"===o)for(var l=0;l<n.length;l++){var u=n[l];for(s=0;s<u.length;s++)Z(a,u[s],t,r,!0,0===s)}if(a.length){var c=e.tags||null;if("LineString"===o&&i.lineMetrics){for(var h in c={},e.tags)c[h]=e.tags[h];c.mapbox_clip_start=n.start/n.size,c.mapbox_clip_end=n.end/n.size}var p={geometry:a,type:"Polygon"===o||"MultiPolygon"===o?3:"LineString"===o||"MultiLineString"===o?2:1,tags:c};null!==e.id&&(p.id=e.id),t.features.push(p)}}function Z(t,e,r,i,n,o){var a=i*i;if(i>0&&e.size<(n?a:i))r.numPoints+=e.length/3;else{for(var s=[],l=0;l<e.length;l+=3)(0===i||e[l+2]>a)&&(r.numSimplified++,s.push(e[l]),s.push(e[l+1])),r.numPoints++;n&&function(t,e){for(var r=0,i=0,n=t.length,o=n-2;i<n;o=i,i+=2)r+=(t[i]-t[o])*(t[i+1]+t[o+1]);if(r>0===e)for(i=0,n=t.length;i<n/2;i+=2){var a=t[i],s=t[i+1];t[i]=t[n-2-i],t[i+1]=t[n-1-i],t[n-2-i]=a,t[n-1-i]=s}}(s,o),t.push(s)}}function J(t,e){var r=(e=this.options=function(t,e){for(var r in e)t[r]=e[r];return t}(Object.create(this.options),e)).debug;if(r&&console.time("preprocess data"),e.maxZoom<0||e.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(e.promoteId&&e.generateId)throw new Error("promoteId and generateId cannot be used together.");var i=function(t,e){var r=[];if("FeatureCollection"===t.type)for(var i=0;i<t.features.length;i++)O(r,t.features[i],e,i);else"Feature"===t.type?O(r,t,e):O(r,{geometry:t},e);return r}(t,e);this.tiles={},this.tileCoords=[],r&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",e.indexMaxZoom,e.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),i=function(t,e){var r=e.buffer/e.extent,i=t,n=j(t,1,-1-r,r,0,-1,2,e),o=j(t,1,1-r,2+r,0,-1,2,e);return(n||o)&&(i=j(t,1,-r,1+r,0,-1,2,e)||[],n&&(i=q(n,1).concat(i)),o&&(i=i.concat(q(o,-1)))),i}(i,e),i.length&&this.splitTile(i,0,0,0),r&&(i.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function Q(t,e,r){return 32*((1<<t)*r+e)+t}J.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},J.prototype.splitTile=function(t,e,r,i,n,o,a){for(var s=[t,e,r,i],l=this.options,u=l.debug;s.length;){i=s.pop(),r=s.pop(),e=s.pop(),t=s.pop();var c=1<<e,h=Q(e,r,i),p=this.tiles[h];if(!p&&(u>1&&console.time("creation"),p=this.tiles[h]=X(t,e,r,i,l),this.tileCoords.push({z:e,x:r,y:i}),u)){u>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",e,r,i,p.numFeatures,p.numPoints,p.numSimplified),console.timeEnd("creation"));var f="z"+e;this.stats[f]=(this.stats[f]||0)+1,this.total++}if(p.source=t,n){if(e===l.maxZoom||e===n)continue;var d=1<<n-e;if(r!==Math.floor(o/d)||i!==Math.floor(a/d))continue}else if(e===l.indexMaxZoom||p.numPoints<=l.indexMaxPoints)continue;if(p.source=null,0!==t.length){u>1&&console.time("clipping");var y,g,v,m,_,b,x=.5*l.buffer/l.extent,w=.5-x,E=.5+x,T=1+x;y=g=v=m=null,_=j(t,c,r-x,r+E,0,p.minX,p.maxX,l),b=j(t,c,r+w,r+T,0,p.minX,p.maxX,l),t=null,_&&(y=j(_,c,i-x,i+E,1,p.minY,p.maxY,l),g=j(_,c,i+w,i+T,1,p.minY,p.maxY,l),_=null),b&&(v=j(b,c,i-x,i+E,1,p.minY,p.maxY,l),m=j(b,c,i+w,i+T,1,p.minY,p.maxY,l),b=null),u>1&&console.timeEnd("clipping"),s.push(y||[],e+1,2*r,2*i),s.push(g||[],e+1,2*r,2*i+1),s.push(v||[],e+1,2*r+1,2*i),s.push(m||[],e+1,2*r+1,2*i+1)}}},J.prototype.getTile=function(t,e,r){var i=this.options,n=i.extent,o=i.debug;if(t<0||t>24)return null;var a=1<<t,s=Q(t,e=(e%a+a)%a,r);if(this.tiles[s])return Y(this.tiles[s],n);o>1&&console.log("drilling down to z%d-%d-%d",t,e,r);for(var l,u=t,c=e,h=r;!l&&u>0;)u--,c=Math.floor(c/2),h=Math.floor(h/2),l=this.tiles[Q(u,c,h)];return l&&l.source?(o>1&&console.log("found parent tile z%d-%d-%d",u,c,h),o>1&&console.time("drilling down"),this.splitTile(l.source,u,c,h,t,e,r),o>1&&console.timeEnd("drilling down"),this.tiles[s]?Y(this.tiles[s],n):null):null};var tt="Point",et="Polygon",rt="MultiLineString",it="MultiPolygon",nt="#e0e0e0",ot="#829DB4",at=1,st={fillColor:"#F2F285",outlineColor:"#0088BF",outlineWidth:1.2},lt={FOOTPRINT:"FOOTPRINT",ICON:"ICON",TEXT:"TEXT",VECTOR:"VECTOR"},ut=Object.freeze({v1:1,v2:2}),ct=function(t){var e=function(t){for(var e=0,r=t.length,i=0;i<r-1;i+=1){var n=t[i],o=t[i+1];e+=n[0]*o[1]-o[0]*n[1]}return e+(t[r-1][0]*t[0][1]-t[0][0]*t[r-1][1])}(t);return e>0?"CW":e<0?"CCW":void 0},ht=function(t){for(var e,r=[],i=[],n=0,o=t.coordinates.length;n<o;n+=1){var a=t.coordinates[n],s=ct(a);null!==s&&(s===(e=e||s)&&i.length&&(r.push(i),i=[]),i.push(a))}return i.length>0&&r.push(i),1===r.length?(t.type=et,t.coordinates=r[0]):r.length>1?(t.type=it,t.coordinates=r):t=null,t},pt=function(t,e,r,i,n){var o,a,s,l,u,c,h=function(t,e,r,i,n){var o=1<<e,a=[];return a[0]=(t[0]/n+r)/o,a[1]=(t[1]/n+i)/o,{x:a[0],y:a[1]}}(t,e,r,i,n);return a=(o=h).x,s=o.y,l=360*(a-.5),u=Math.exp(Math.PI*(.5-s)/.25)-1,c=Math.exp(Math.PI*(.5-s)/.25)+1,[l,180*Math.asin(u/c)/Math.PI]};"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self&&self;var ft,dt,yt,gt=(ft=function(t,e){t.exports=function(t){var e={};function r(i){if(e[i])return e[i].exports;var n=e[i]={i,l:!1,exports:{}};return t[i].call(n.exports,n,n.exports,r),n.l=!0,n.exports}return r.m=t,r.c=e,r.d=function(t,e,i){r.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:i})},r.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},r.t=function(t,e){if(1&e&&(t=r(t)),8&e)return t;if(4&e&&"object"==u(t)&&t&&t.__esModule)return t;var i=Object.create(null);if(r.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var n in t)r.d(i,n,function(e){return t[e]}.bind(null,n));return i},r.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return r.d(e,"a",e),e},r.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},r.p="",r(r.s=0)}([function(t,e,r){function i(t){return(i="function"==typeof Symbol&&"symbol"==u(Symbol.iterator)?function(t){return u(t)}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":u(t)})(t)}var n=r(1),o=r(7),a=o.get,s=(o.deepValue,o.isArray),l=function(){function t(e,r){var i=r.location,n=void 0===i?0:i,o=r.distance,s=void 0===o?100:o,l=r.threshold,u=void 0===l?.6:l,c=r.maxPatternLength,h=void 0===c?32:c,p=r.caseSensitive,f=void 0!==p&&p,d=r.tokenSeparator,y=void 0===d?/ +/g:d,g=r.findAllMatches,v=void 0!==g&&g,m=r.minMatchCharLength,_=void 0===m?1:m,b=r.id,x=void 0===b?null:b,w=r.keys,E=void 0===w?[]:w,T=r.shouldSort,A=void 0===T||T,S=r.getFn,k=void 0===S?a:S,I=r.sortFn,P=void 0===I?function(t,e){return t.score-e.score}:I,O=r.tokenize,L=void 0!==O&&O,C=r.matchAllTokens,R=void 0!==C&&C,M=r.includeMatches,N=void 0!==M&&M,j=r.includeScore,D=void 0!==j&&j,B=r.verbose,z=void 0!==B&&B;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.options={location:n,distance:s,threshold:u,maxPatternLength:h,isCaseSensitive:f,tokenSeparator:y,findAllMatches:v,minMatchCharLength:_,id:x,keys:E,includeMatches:N,includeScore:D,shouldSort:A,getFn:k,sortFn:P,verbose:z,tokenize:L,matchAllTokens:R},this.setCollection(e),this._processKeys(E)}var e;return(e=[{key:"setCollection",value:function(t){return this.list=t,t}},{key:"_processKeys",value:function(t){if(this._keyWeights={},this._keyNames=[],t.length&&"string"==typeof t[0])for(var e=0,r=t.length;e<r;e+=1){var i=t[e];this._keyWeights[i]=1,this._keyNames.push(i)}else{for(var n=null,o=null,a=0,s=0,l=t.length;s<l;s+=1){var u=t[s];if(!u.hasOwnProperty("name"))throw new Error('Missing "name" property in key object');var c=u.name;if(this._keyNames.push(c),!u.hasOwnProperty("weight"))throw new Error('Missing "weight" property in key object');var h=u.weight;if(h<0||h>1)throw new Error('"weight" property in key must bein the range of [0, 1)');o=null==o?h:Math.max(o,h),n=null==n?h:Math.min(n,h),this._keyWeights[c]=h,a+=h}if(a>1)throw new Error("Total of weights cannot exceed 1")}}},{key:"search",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{limit:!1};this._log('---------\nSearch pattern: "'.concat(t,'"'));var r=this._prepareSearchers(t),i=r.tokenSearchers,n=r.fullSearcher,o=this._search(i,n);return this._computeScore(o),this.options.shouldSort&&this._sort(o),e.limit&&"number"==typeof e.limit&&(o=o.slice(0,e.limit)),this._format(o)}},{key:"_prepareSearchers",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",e=[];if(this.options.tokenize)for(var r=t.split(this.options.tokenSeparator),i=0,o=r.length;i<o;i+=1)e.push(new n(r[i],this.options));return{tokenSearchers:e,fullSearcher:new n(t,this.options)}}},{key:"_search",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],e=arguments.length>1?arguments[1]:void 0,r=this.list,i={},n=[];if("string"==typeof r[0]){for(var o=0,a=r.length;o<a;o+=1)this._analyze({key:"",value:r[o],record:o,index:o},{resultMap:i,results:n,tokenSearchers:t,fullSearcher:e});return n}for(var s=0,l=r.length;s<l;s+=1)for(var u=r[s],c=0,h=this._keyNames.length;c<h;c+=1){var p=this._keyNames[c];this._analyze({key:p,value:this.options.getFn(u,p),record:u,index:s},{resultMap:i,results:n,tokenSearchers:t,fullSearcher:e})}return n}},{key:"_analyze",value:function(t,e){var r=this,i=t.key,n=t.arrayIndex,o=void 0===n?-1:n,a=t.value,l=t.record,u=t.index,c=e.tokenSearchers,h=void 0===c?[]:c,p=e.fullSearcher,f=e.resultMap,d=void 0===f?{}:f,y=e.results,g=void 0===y?[]:y;!function t(e,n,o,a){if(null!=n)if("string"==typeof n){var l=!1,u=-1,c=0;r._log("\nKey: ".concat(""===i?"--":i));var f=p.search(n);if(r._log('Full text: "'.concat(n,'", score: ').concat(f.score)),r.options.tokenize){for(var y=n.split(r.options.tokenSeparator),v=y.length,m=[],_=0,b=h.length;_<b;_+=1){var x=h[_];r._log('\nPattern: "'.concat(x.pattern,'"'));for(var w=!1,E=0;E<v;E+=1){var T=y[E],A=x.search(T),S={};A.isMatch?(S[T]=A.score,l=!0,w=!0,m.push(A.score)):(S[T]=1,r.options.matchAllTokens||m.push(1)),r._log('Token: "'.concat(T,'", score: ').concat(S[T]))}w&&(c+=1)}u=m[0];for(var k=m.length,I=1;I<k;I+=1)u+=m[I];u/=k,r._log("Token score average:",u)}var P=f.score;u>-1&&(P=(P+u)/2),r._log("Score average:",P);var O=!r.options.tokenize||!r.options.matchAllTokens||c>=h.length;if(r._log("\nCheck Matches: ".concat(O)),(l||f.isMatch)&&O){var L={key:i,arrayIndex:e,value:n,score:P};r.options.includeMatches&&(L.matchedIndices=f.matchedIndices);var C=d[a];C?C.output.push(L):(d[a]={item:o,output:[L]},g.push(d[a]))}}else if(s(n))for(var R=0,M=n.length;R<M;R+=1)t(R,n[R],o,a)}(o,a,l,u)}},{key:"_computeScore",value:function(t){this._log("\n\nComputing score:\n");for(var e=this._keyWeights,r=!!Object.keys(e).length,i=0,n=t.length;i<n;i+=1){for(var o=t[i],a=o.output,s=a.length,l=1,u=0;u<s;u+=1){var c=a[u],h=c.key,p=r?e[h]:1,f=0===c.score&&e&&e[h]>0?Number.EPSILON:c.score;l*=Math.pow(f,p)}o.score=l,this._log(o)}}},{key:"_sort",value:function(t){this._log("\n\nSorting...."),t.sort(this.options.sortFn)}},{key:"_format",value:function(t){var e=[];if(this.options.verbose){var r=[];this._log("\n\nOutput:\n\n",JSON.stringify(t,(function(t,e){if("object"===i(e)&&null!==e){if(-1!==r.indexOf(e))return;r.push(e)}return e}),2)),r=null}var n=[];this.options.includeMatches&&n.push((function(t,e){var r=t.output;e.matches=[];for(var i=0,n=r.length;i<n;i+=1){var o=r[i];if(0!==o.matchedIndices.length){var a={indices:o.matchedIndices,value:o.value};o.key&&(a.key=o.key),o.hasOwnProperty("arrayIndex")&&o.arrayIndex>-1&&(a.arrayIndex=o.arrayIndex),e.matches.push(a)}}})),this.options.includeScore&&n.push((function(t,e){e.score=t.score}));for(var o=0,a=t.length;o<a;o+=1){var s=t[o];if(this.options.id&&(s.item=this.options.getFn(s.item,this.options.id)[0]),n.length){for(var l={item:s.item},u=0,c=n.length;u<c;u+=1)n[u](s,l);e.push(l)}else e.push(s.item)}return e}},{key:"_log",value:function(){var t;this.options.verbose&&(t=console).log.apply(t,arguments)}}])&&function(t,e){for(var r=0;r<e.length;r++){var i=e[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}(t.prototype,e),t}();t.exports=l},function(t,e,r){var i=r(2),n=r(3),o=r(6),a=function(){function t(e,r){var i=r.location,n=void 0===i?0:i,a=r.distance,s=void 0===a?100:a,l=r.threshold,u=void 0===l?.6:l,c=r.maxPatternLength,h=void 0===c?32:c,p=r.isCaseSensitive,f=void 0!==p&&p,d=r.tokenSeparator,y=void 0===d?/ +/g:d,g=r.findAllMatches,v=void 0!==g&&g,m=r.minMatchCharLength,_=void 0===m?1:m,b=r.includeMatches,x=void 0!==b&&b;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.options={location:n,distance:s,threshold:u,maxPatternLength:h,isCaseSensitive:f,tokenSeparator:y,findAllMatches:v,includeMatches:x,minMatchCharLength:_},this.pattern=f?e:e.toLowerCase(),this.pattern.length<=h&&(this.patternAlphabet=o(this.pattern))}var e;return(e=[{key:"search",value:function(t){var e=this.options,r=e.isCaseSensitive,o=e.includeMatches;if(r||(t=t.toLowerCase()),this.pattern===t){var a={isMatch:!0,score:0};return o&&(a.matchedIndices=[[0,t.length-1]]),a}var s=this.options,l=s.maxPatternLength,u=s.tokenSeparator;if(this.pattern.length>l)return i(t,this.pattern,u);var c=this.options,h=c.location,p=c.distance,f=c.threshold,d=c.findAllMatches,y=c.minMatchCharLength;return n(t,this.pattern,this.patternAlphabet,{location:h,distance:p,threshold:f,findAllMatches:d,minMatchCharLength:y,includeMatches:o})}}])&&function(t,e){for(var r=0;r<e.length;r++){var i=e[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}(t.prototype,e),t}();t.exports=a},function(t,e){var r=/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g;t.exports=function(t,e){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:/ +/g,n=new RegExp(e.replace(r,"\\$&").replace(i,"|")),o=t.match(n),a=!!o,s=[];if(a)for(var l=0,u=o.length;l<u;l+=1){var c=o[l];s.push([t.indexOf(c),c.length-1])}return{score:a?.5:1,isMatch:a,matchedIndices:s}}},function(t,e,r){var i=r(4),n=r(5);t.exports=function(t,e,r,o){for(var a=o.location,s=void 0===a?0:a,l=o.distance,u=void 0===l?100:l,c=o.threshold,h=void 0===c?.6:c,p=o.findAllMatches,f=void 0!==p&&p,d=o.minMatchCharLength,y=void 0===d?1:d,g=o.includeMatches,v=void 0!==g&&g,m=s,_=t.length,b=h,x=t.indexOf(e,m),w=e.length,E=[],T=0;T<_;T+=1)E[T]=0;if(-1!==x){var A=i(e,{errors:0,currentLocation:x,expectedLocation:m,distance:u});if(b=Math.min(A,b),-1!==(x=t.lastIndexOf(e,m+w))){var S=i(e,{errors:0,currentLocation:x,expectedLocation:m,distance:u});b=Math.min(S,b)}}x=-1;for(var k=[],I=1,P=w+_,O=1<<(w<=31?w-1:30),L=0;L<w;L+=1){for(var C=0,R=P;C<R;)i(e,{errors:L,currentLocation:m+R,expectedLocation:m,distance:u})<=b?C=R:P=R,R=Math.floor((P-C)/2+C);P=R;var M=Math.max(1,m-R+1),N=f?_:Math.min(m+R,_)+w,j=Array(N+2);j[N+1]=(1<<L)-1;for(var D=N;D>=M;D-=1){var B=D-1,z=r[t.charAt(B)];if(z&&(E[B]=1),j[D]=(j[D+1]<<1|1)&z,0!==L&&(j[D]|=(k[D+1]|k[D])<<1|1|k[D+1]),j[D]&O&&(I=i(e,{errors:L,currentLocation:B,expectedLocation:m,distance:u}))<=b){if(b=I,(x=B)<=m)break;M=Math.max(1,2*m-x)}}if(i(e,{errors:L+1,currentLocation:m,expectedLocation:m,distance:u})>b)break;k=j}var U={isMatch:x>=0,score:0===I?.001:I};return v&&(U.matchedIndices=n(E,y)),U}},function(t,e){t.exports=function(t,e){var r=e.errors,i=void 0===r?0:r,n=e.currentLocation,o=void 0===n?0:n,a=e.expectedLocation,s=void 0===a?0:a,l=e.distance,u=void 0===l?100:l,c=i/t.length,h=Math.abs(s-o);return u?c+h/u:h?1:c}},function(t,e){t.exports=function(){for(var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,r=[],i=-1,n=-1,o=0,a=t.length;o<a;o+=1){var s=t[o];s&&-1===i?i=o:s||-1===i||((n=o-1)-i+1>=e&&r.push([i,n]),i=-1)}return t[o-1]&&o-i>=e&&r.push([i,o-1]),r}},function(t,e){t.exports=function(t){for(var e={},r=t.length,i=0;i<r;i+=1)e[t.charAt(i)]=0;for(var n=0;n<r;n+=1)e[t.charAt(n)]|=1<<r-n-1;return e}},function(t,e){var r=function(t){return Array.isArray?Array.isArray(t):"[object Array]"===Object.prototype.toString.call(t)},i=function(t){return null==t?"":function(t){if("string"==typeof t)return t;var e=t+"";return"0"==e&&1/t==-1/0?"-0":e}(t)},n=function(t){return"string"==typeof t},o=function(t){return"number"==typeof t};t.exports={get:function(t,e){var a=[];return function t(e,s){if(s){var l=s.indexOf("."),u=s,c=null;-1!==l&&(u=s.slice(0,l),c=s.slice(l+1));var h=e[u];if(null!=h)if(c||!n(h)&&!o(h))if(r(h))for(var p=0,f=h.length;p<f;p+=1)t(h[p],c);else c&&t(h,c);else a.push(i(h))}else a.push(e)}(t,e),a},isArray:r,isString:n,isNum:o,toString:i}}])},ft(dt={exports:{}}),dt.exports),vt=(yt=gt)&&yt.__esModule&&Object.prototype.hasOwnProperty.call(yt,"default")?yt.default:yt;gt.Fuse;var mt,_t=f((function t(e){var r=e.addressList,i=void 0===r?[]:r,n=e.geometries,o=void 0===n?[]:n,a=e.entity,s=void 0===a?null:a,l=e.name,u=void 0===l?"":l,c=e.icon,p=void 0===c?"":c;h(this,t),this.addressList=i,this.geometries=o,this.icon=p,this.entity=s,this.name=u})),bt={keys:[{name:"name",weight:.6},{name:"addressList",weight:.4}],threshold:.2},xt=f((function t(e){h(this,t),this.fuseSearch=null,this.levels_=null,this.searchListEntities_=[],this.searchListIcons_=[],this.searchList_=[],this.venueModel=e,this.init()}),[{key:"init",value:function(){var t=this.venueModel.getGeometries().reduce((function(t,e){var r=t;return r[e.getId()]=e,r}),{});this.initEntityList(this.venueModel.getOccupant()),this.initIconList(t),this.levels_=this.venueModel.getLevels().map((function(t){return{levelId:t.getId(),levelName:t.getName(),drawingId:t.getDrawing().getId(),drawingName:t.getDrawing().getName()}}));var e=[].concat(b(this.searchListEntities_),b(this.searchListIcons_));this.searchList_=e.sort((function(t,e){return t.name.localeCompare(e.name)})),this.fuseSearch_=new vt(this.searchList_,bt)}},{key:"initEntityList",value:function(){var t=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:[]).map((function(t){return t.spaceIds?new _t({geometries:t.space,addressList:t.spaceIds||[],name:t.properties.name||"",entity:t}):null})).filter((function(t){return null!==t}));this.searchListEntities_=t}},{key:"initIconList",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.searchListIcons_=Object.values(t).filter((function(t){return t.isIcon()})).map((function(t){var e=t.getIcon();return new _t({geometries:[t],icon:e,name:t.properties.name||""})}))}},{key:"all",value:function(){return this.searchList_}},{key:"allIconTypes",value:function(){var t=this.searchListIcons_.reduce((function(t,e){var r=t;return r[e.name]=e.name,r}),{});return Object.keys(t)}},{key:"find",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return""===t?this.searchList_:this.fuseSearch_.search(t)}}]),wt=Object.freeze({SITE:"SITE",IMAGES:"IMAGES",THEME:"THEME"}),Et={SITE:"indoor.Site",STRUCTURE:"indoor.Structure",OCCUPANT:"indoor.Occupant",SPACE:"indoor.Space",SPACEGROUPS:"indoor.SpaceGroups",TOPOLOGY:"Topology",ADDRESS:"Address",LEVEL:"indoor.Level",LEVELCONNECTOR:"indoor.LevelConnector",ENTRANCE:"indoor.Entrance"},Tt="SPACE_TYPE_NAME",At="SPACE_CATEGORY_NAME",St="Point",kt="LineString",It="Polygon",Pt="MultiPoint",Ot="MultiLineString",Lt="MultiPolygon",Ct=Object.freeze({STANDARD:"STANDARD",FLATTEN:"FLATTEN",OUTDOOR_MAIN:"OUTDOOR_MAIN",INDOOR_MAIN:"INDOOR_MAIN",NO_OUTDOORS:"NO_OUTDOORS",FLATTEN_INDOOR_MAIN:"FLATTEN_INDOOR_MAIN",FLATTEN_OUTDOOR_COPY:"FLATTEN_OUTDOOR_COPY"}),Rt="9999999999999",Mt="https://interactive.data.api.platform.here.com/interactive/v1/catalogs",Nt=Object.freeze({THEME:"THEME",THEME_MAP:"THEME_MAP",PRESETS:"PRESETS",SDK_STRINGS:"SDK_STRINGS",ICON_FILE:"ICON_FILE",INPUT_COLORS:"INPUT_COLORS",BASE_MAP_INFO:"BASE_MAP_INFO",CONFIG_PROFILE:"CONFIG_PROFILE",NAV_THEME:"NAV_THEME",NAV_NAME_THEME:"NAV_NAME_THEME",NAV_PROP_MAP:"NAV_PROP_MAP",NAV_STRINGS:"NAV_STRINGS",NAV_THEME_MAP:"NAV_THEME_MAP",NAV_NAME_THEME_MAP:"NAV_NAME_THEME_MAP",V4_THEME_FAMILY:"V4_THEME_FAMILY",V4_MAPTYPE_THEME:"V4_MAPTYPE_THEME",ICON:"ICON",MARKER:"MARKER",PERMISSIONS:"PERMISSIONS",NAICS_ARRAY:"NAICS_ARRAY",NAICS_MAP:"NAICS_MAP"});Object.freeze(d(d(d(d({},Nt.THEME,"themeUrls"),Nt.THEME_MAP,"themeMapUrl"),Nt.PRESETS,"presetsUrl"),Nt.SDK_STRINGS,"stringsUrl")),Object.freeze(d(d(d(d(d({},Nt.THEME,"themeOverrides"),Nt.THEME_MAP,"themeMapOverrides"),Nt.PRESETS,"presetOverrides"),Nt.SDK_STRINGS,"stringsOverrides"),Nt.INPUT_COLORS,"inputColorOverrides")),Object.freeze(d(d(d(d(d(d({},Nt.THEME,["Modern","Standard","Factory","Navteq","TheBase","Westfield_noLabels","Westfield","TDM_noLabel"]),Nt.SDK_STRINGS,["Standard","SDK","sdk/standard"]),Nt.V4_THEME_FAMILY,["modern","standard"]),Nt.V4_MAPTYPE_THEME,["Airport Terminal","Airport","Casino","College Building","College Campus","Convention","General","Hospital","Outdoor","Retail","School Building","School Campus","Shopping Mall","Traffic","Train Station"]),Nt.NAV_THEME,["Factory","MapEditor"]),Nt.ICON,["Multicolor","Standard","TheBase","Factory"])),Object.freeze((d(d(d(d(d(d(d(d(d(d(mt={},Nt.THEME,"Modern"),Nt.THEME_MAP,"Standard"),Nt.PRESETS,"Standard"),Nt.SDK_STRINGS,"Standard"),Nt.ICON_FILE,"Standard"),Nt.INPUT_COLORS,"Standard"),Nt.BASE_MAP_INFO,"Standard"),Nt.CONFIG_PROFILE,"factory"),Nt.NAV_THEME,"Factory"),Nt.NAV_NAME_THEME,"FactoryName"),d(d(d(d(d(d(d(d(mt,Nt.NAV_PROP_MAP,"Standard"),Nt.NAV_STRINGS,"Standard"),Nt.NAV_THEME_MAP,"Standard"),Nt.NAV_NAME_THEME_MAP,"StandardName"),Nt.V4_THEME_FAMILY,"Standard"),Nt.V4_MAPTYPE_THEME,"Standard"),Nt.ICON,"Multicolor"),Nt.MARKER,"Standard")));var jt=Object.freeze({GEO_JSON:"GEO_JSON",V5_MAP:"V5_MAP",V5_NAV:"V5_NAV",V5_INFO:"V5_INFO",KML:"KML",SVG:"SVG",PNG:"PNG"});Object.freeze(d({},jt.GEO_JSON,{COMMUNITY_MAP:"COMMUNITY_MAP",COMMUNITY_ENTITY:"COMMUNITY_ENTITY",PATH_LEVEL_GEOMETRY:"PATH_LEVEL_GEOMETRY",GEOJSON_LEVEL_GEOMETRY:"GEOJSON_LEVEL_GEOMETRY"}));var Dt=Object.freeze({ACCOUNT_API:"ACCOUNT_API",DEFAULT_COLLECTION:"DEFAULT_COLLECTION",CATALOG_LAYER:"CATALOG_LAYER"}),Bt=Object.freeze(d(d(d({},Dt.ACCOUNT_API,{BASE_URL:"https://account.api.here.com/authorization/v1.1/projects/me"}),Dt.DEFAULT_COLLECTION,{BASE_URL:"https://config.data.api.platform.here.com/config/v1/catalogs",PARAMS:{CREATED_BY:"created",COLLECTION:"-collection"}}),Dt.CATALOG_LAYER,{BASE_URL:"https://interactive.data.api.platform.here.com/interactive/v1/catalogs",MOMDATA_LAYER:"9999999999999",ICON_LAYER:"icons",THEMERULE_LAYER:"config",COLLECTION_LAYER:"layers/9999999999999/search",PARAMS:{FEATURE_TYPE:{KEY:"p.featureType",VALUE:"indoor.Site"}}})),zt=Object.freeze({isIconsEnabled:!0,isMetaEnabled:!0,metaOptions:{},iconOptions:{}}),Ut=Object.freeze({GET:"GET",POST:"POST",PUT:"PUT",DELETE:"DELETE",PATCH:"PATCH",OPTIONS:"OPTIONS",HEAD:"HEAD"});function Ft(){}function Gt(){Gt.init.call(this)}function $t(t){return void 0===t._maxListeners?Gt.defaultMaxListeners:t._maxListeners}function qt(t,e,r,i){var n,o,a,s;if("function"!=typeof r)throw new TypeError('"listener" argument must be a function');if((o=t._events)?(o.newListener&&(t.emit("newListener",e,r.listener?r.listener:r),o=t._events),a=o[e]):(o=t._events=new Ft,t._eventsCount=0),a){if("function"==typeof a?a=o[e]=i?[r,a]:[a,r]:i?a.unshift(r):a.push(r),!a.warned&&(n=$t(t))&&n>0&&a.length>n){a.warned=!0;var l=new Error("Possible EventEmitter memory leak detected. "+a.length+" "+e+" listeners added. Use emitter.setMaxListeners() to increase limit");l.name="MaxListenersExceededWarning",l.emitter=t,l.type=e,l.count=a.length,s=l,"function"==typeof console.warn?console.warn(s):console.log(s)}}else a=o[e]=r,++t._eventsCount;return t}function Ht(t,e,r){var i=!1;function n(){t.removeListener(e,n),i||(i=!0,r.apply(t,arguments))}return n.listener=r,n}function Vt(t){var e=this._events;if(e){var r=e[t];if("function"==typeof r)return 1;if(r)return r.length}return 0}function Yt(t,e){for(var r=new Array(e);e--;)r[e]=t[e];return r}Ft.prototype=Object.create(null),Gt.EventEmitter=Gt,Gt.usingDomains=!1,Gt.prototype.domain=void 0,Gt.prototype._events=void 0,Gt.prototype._maxListeners=void 0,Gt.defaultMaxListeners=10,Gt.init=function(){this.domain=null,Gt.usingDomains&&(void 0).active,this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=new Ft,this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},Gt.prototype.setMaxListeners=function(t){if("number"!=typeof t||t<0||isNaN(t))throw new TypeError('"n" argument must be a positive number');return this._maxListeners=t,this},Gt.prototype.getMaxListeners=function(){return $t(this)},Gt.prototype.emit=function(t){var e,r,i,n,o,a,s,l="error"===t;if(a=this._events)l=l&&null==a.error;else if(!l)return!1;if(s=this.domain,l){if(e=arguments[1],!s){if(e instanceof Error)throw e;var u=new Error('Uncaught, unspecified "error" event. ('+e+")");throw u.context=e,u}return e||(e=new Error('Uncaught, unspecified "error" event')),e.domainEmitter=this,e.domain=s,e.domainThrown=!1,s.emit("error",e),!1}if(!(r=a[t]))return!1;var c="function"==typeof r;switch(i=arguments.length){case 1:!function(t,e,r){if(e)t.call(r);else for(var i=t.length,n=Yt(t,i),o=0;o<i;++o)n[o].call(r)}(r,c,this);break;case 2:!function(t,e,r,i){if(e)t.call(r,i);else for(var n=t.length,o=Yt(t,n),a=0;a<n;++a)o[a].call(r,i)}(r,c,this,arguments[1]);break;case 3:!function(t,e,r,i,n){if(e)t.call(r,i,n);else for(var o=t.length,a=Yt(t,o),s=0;s<o;++s)a[s].call(r,i,n)}(r,c,this,arguments[1],arguments[2]);break;case 4:!function(t,e,r,i,n,o){if(e)t.call(r,i,n,o);else for(var a=t.length,s=Yt(t,a),l=0;l<a;++l)s[l].call(r,i,n,o)}(r,c,this,arguments[1],arguments[2],arguments[3]);break;default:for(n=new Array(i-1),o=1;o<i;o++)n[o-1]=arguments[o];!function(t,e,r,i){if(e)t.apply(r,i);else for(var n=t.length,o=Yt(t,n),a=0;a<n;++a)o[a].apply(r,i)}(r,c,this,n)}return!0},Gt.prototype.addListener=function(t,e){return qt(this,t,e,!1)},Gt.prototype.on=Gt.prototype.addListener,Gt.prototype.prependListener=function(t,e){return qt(this,t,e,!0)},Gt.prototype.once=function(t,e){if("function"!=typeof e)throw new TypeError('"listener" argument must be a function');return this.on(t,Ht(this,t,e)),this},Gt.prototype.prependOnceListener=function(t,e){if("function"!=typeof e)throw new TypeError('"listener" argument must be a function');return this.prependListener(t,Ht(this,t,e)),this},Gt.prototype.removeListener=function(t,e){var r,i,n,o,a;if("function"!=typeof e)throw new TypeError('"listener" argument must be a function');if(!(i=this._events))return this;if(!(r=i[t]))return this;if(r===e||r.listener&&r.listener===e)0==--this._eventsCount?this._events=new Ft:(delete i[t],i.removeListener&&this.emit("removeListener",t,r.listener||e));else if("function"!=typeof r){for(n=-1,o=r.length;o-- >0;)if(r[o]===e||r[o].listener&&r[o].listener===e){a=r[o].listener,n=o;break}if(n<0)return this;if(1===r.length){if(r[0]=void 0,0==--this._eventsCount)return this._events=new Ft,this;delete i[t]}else!function(t,e){for(var r=e,i=r+1,n=t.length;i<n;r+=1,i+=1)t[r]=t[i];t.pop()}(r,n);i.removeListener&&this.emit("removeListener",t,a||e)}return this},Gt.prototype.removeAllListeners=function(t){var e,r;if(!(r=this._events))return this;if(!r.removeListener)return 0===arguments.length?(this._events=new Ft,this._eventsCount=0):r[t]&&(0==--this._eventsCount?this._events=new Ft:delete r[t]),this;if(0===arguments.length){for(var i,n=Object.keys(r),o=0;o<n.length;++o)"removeListener"!==(i=n[o])&&this.removeAllListeners(i);return this.removeAllListeners("removeListener"),this._events=new Ft,this._eventsCount=0,this}if("function"==typeof(e=r[t]))this.removeListener(t,e);else if(e)do{this.removeListener(t,e[e.length-1])}while(e[0]);return this},Gt.prototype.listeners=function(t){var e,r=this._events;return r&&(e=r[t])?"function"==typeof e?[e.listener||e]:function(t){for(var e=new Array(t.length),r=0;r<e.length;++r)e[r]=t[r].listener||t[r];return e}(e):[]},Gt.listenerCount=function(t,e){return"function"==typeof t.listenerCount?t.listenerCount(e):Vt.call(t,e)},Gt.prototype.listenerCount=Vt,Gt.prototype.eventNames=function(){return this._eventsCount>0?Reflect.ownKeys(this._events):[]};var Wt="venues-ui-button--active",Xt="venues-ui-button",Kt="venues-ui__drawings",Zt="data-drawing",Jt=f((function t(e,r,i){var n=this;h(this,t),this.clickHandler=i,this.containerDiv=document.createElement("div"),this.containerDiv.setAttribute("class",Kt);var o=document.createElement("div");o.setAttribute("class","trigger ".concat(Xt));var a=document.createElement("div");a.setAttribute("class","arrow arrow--down"),o.appendChild(a),o.addEventListener("click",(function(){o.classList.toggle(Wt),n.containerButtons.classList.toggle("drawings--open")})),this.containerDiv.appendChild(o),this.containerButtons=document.createElement("div"),this.containerButtons.setAttribute("class","drawings"),this.containerDiv.appendChild(this.containerButtons),r&&this.update(r),e.appendChild(this.containerDiv)}),[{key:"drawButton",value:function(t,e,r){var i=this,n=document.createElement("div"),o=Number(r)===Number(t);n.setAttribute("class",o?"".concat(Xt," ").concat(Wt):Xt),n.innerHTML=e,n.setAttribute(Zt,t),n.addEventListener("click",(function(){i.switch(t),i.clickHandler(t)})),this.containerButtons.appendChild(n)}},{key:"switch",value:function(t){this.containerButtons.querySelectorAll(".".concat(Kt," .").concat(Wt)).forEach((function(t){return t.setAttribute("class",Xt)}));var e=this.containerButtons.querySelector("[".concat(Zt,"='").concat(t,"']"));e&&e.setAttribute("class","".concat(Xt," ").concat(Wt))}},{key:"update",value:function(t){var e=this;this.containerButtons.innerHTML="";var r=function(t){var e=t.getDrawings();return new Map(e.map((function(t){var e=t.getDisplayName()||t.getName();return[t.getId(),e]})))}(t);r.size>0&&r.forEach((function(r,i){return e.drawButton(i,r,t.getRootDrawing().getId())}))}}]),Qt="venues-ui-button--active",te="venues-ui-button",ee="data-level",re="venues-ui__levels",ie=f((function t(e,r,i,n){var o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:4;h(this,t),this.clickHandler=n,this.levelButtonCount=o,this.currentScrollIndex=0,this.containerUI=document.createElement("div"),this.containerUI.setAttribute("class","".concat(re)),this.containerButtons=document.createElement("div"),this.containerButtons.setAttribute("class","levels"),this.containerUI.appendChild(this.containerButtons),r&&this.update(r,i),e.appendChild(this.containerUI)}),[{key:"clear",value:function(){this.containerButtons.innerHTML="",this.buttonScrollUp&&(this.containerUI.removeChild(this.buttonScrollUp),this.buttonScrollUp=null),this.buttonScrollDown&&(this.containerUI.removeChild(this.buttonScrollDown),this.buttonScrollDown=null)}},{key:"drawLevelButton",value:function(t,e){var r=this,i=document.createElement("div");i.innerHTML=e,i.style.fontSize="".concat(Math.max(Math.min(28.8/e.length,11.52),10),"px"),i.style.display="block",i.setAttribute("class",te),i.setAttribute(ee,t),i.addEventListener("click",(function(){r.switch(t),r.clickHandler(t)})),this.containerButtons.appendChild(i)}},{key:"drawScrollButtons",value:function(){var t=this;this.buttonScrollUp=document.createElement("div"),this.buttonScrollUp.setAttribute("class","".concat(te," ").concat(te,"--up"));var e=document.createElement("div");e.setAttribute("class","arrow arrow--up"),this.buttonScrollUp.appendChild(e),this.buttonScrollUp.addEventListener("click",(function(){return t.scroll(1)})),this.containerUI.insertBefore(this.buttonScrollUp,this.containerButtons),this.buttonScrollDown=document.createElement("div"),this.buttonScrollDown.setAttribute("class","".concat(te," ").concat(te,"--down"));var r=document.createElement("div");r.setAttribute("class","arrow arrow--down"),this.buttonScrollDown.appendChild(r),this.buttonScrollDown.addEventListener("click",(function(){return t.scroll(-1)})),this.containerUI.appendChild(this.buttonScrollDown)}},{key:"scroll",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=Array.from(this.containerButtons.querySelectorAll(".".concat(te))).reverse(),r=[];if(t>=0){this.currentScrollIndex=Math.min(this.currentScrollIndex+t,e.length-this.levelButtonCount);var i=Math.min(this.currentScrollIndex,e.length-this.levelButtonCount),n=Math.min(this.currentScrollIndex+this.levelButtonCount,e.length);r=e.slice(i,n)}else if(t<0){this.currentScrollIndex=Math.max(this.currentScrollIndex+t,0);var o=Math.max(0,this.currentScrollIndex),a=Math.min(e.length,this.currentScrollIndex+this.levelButtonCount);r=e.slice(o,a)}e.forEach((function(t){-1!==r.indexOf(t)?t.style.display="block":t.style.display="none"})),this.buttonScrollDown&&(0===this.currentScrollIndex?this.buttonScrollDown.setAttribute("disabled","disabled"):this.buttonScrollDown.removeAttribute("disabled")),this.buttonScrollUp&&(this.currentScrollIndex===e.length-this.levelButtonCount?this.buttonScrollUp.setAttribute("disabled","disabled"):this.buttonScrollUp.removeAttribute("disabled"))}},{key:"switch",value:function(t){this.containerButtons.querySelectorAll(".".concat(Qt)).forEach((function(t){return t.setAttribute("class",te)}));var e=this.containerButtons.querySelector(".".concat(re," [").concat(ee,"='").concat(t,"']"));if(e){var r=Array.from(this.containerButtons.querySelectorAll(".".concat(te))).reverse();e.setAttribute("class","".concat(te," ").concat(Qt));var i=r.indexOf(e);(i<this.currentScrollIndex||i>=this.currentScrollIndex+4)&&this.scroll(i-this.currentScrollIndex)}}},{key:"update",value:function(t,e){var r=this,i=function(){return new Map((arguments.length>0&&void 0!==arguments[0]?arguments[0]:[]).map((function(t){return[t.getZIndex(),t.getShortName()||t.getDisplayName()||t.getName()]})))}(function(t,e){if(e===Ct.FLATTEN){var r=t.getVenueModel().getLevelMapFlattenedByZIndex_();return Object.values(r).map((function(t){return t[0]}))}return t.getLevels()}(t,e).sort((function(t,e){return e.getZIndex()-t.getZIndex()}))),n=t.getMainLevel().getZIndex();this.clear(),i.forEach((function(t,e){return r.drawLevelButton(e,t)})),i.size>this.levelButtonCount&&(i.size>this.levelButtonCount+1?this.currentScrollIndex=Math.min(Array.from(i).reverse().findIndex((function(t){return t[0]===n})),i.size-this.levelButtonCount):this.currentScrollIndex=0,this.drawScrollButtons(),this.scroll(0)),this.switch(n)}}]),ne=f((function t(e,r){h(this,t),this.baseTheme=e,this.metaInformation=r,this.labelStyleMap={},this.styleMap={},this.setStyleMap()}),[{key:"setStyleMap",value:function(){this.styleMap.ENTRANCE=this.baseTheme.entranceRules.default.styleProperties,this.labelStyleMap.ENTRANCE=this.baseTheme.entranceRules.default.textLabelStyleProperties;for(var t=0,e=Object.entries(this.baseTheme.spaceRules);t<e.length;t++){var r=_(e[t],2),i=r[0],n=r[1],o=n.properties.behavioralAppearance.default.styleProperties,a=n.properties.behavioralAppearance.default.textLabelStyleProperties;if(this.styleMap[i]=o,this.labelStyleMap[i]=a,n.spaceTypes)for(var s=0,l=Object.entries(n.spaceTypes);s<l.length;s++){var u=_(l[s],2),c=u[0],h=u[1],p=h.behavioralAppearance.default.styleProperties,f=h.behavioralAppearance.default.textLabelStyleProperties;this.styleMap["".concat(i,"_").concat(c)]=p&&0!==Object.keys(p)?p:o,this.labelStyleMap["".concat(i,"_").concat(c)]=f&&0!==Object.keys(f)?f:a}}}},{key:"getBaseTheme",value:function(){return this.baseTheme}},{key:"getStyleMap",value:function(){return this.styleMap}},{key:"getGeometryStyle",value:function(t){return this.styleMap&&Object.getOwnPropertyNames(this.styleMap)?this.styleMap[t]:null}},{key:"getLabelStyle",value:function(t){return this.labelStyleMap&&Object.getOwnPropertyNames(this.labelStyleMap)?this.labelStyleMap[t]:null}}],[{key:"getGeometryDefaultStyle",value:function(){return{fill:"#e5e5e5",fillOpacity:1,stroke:"#6c7a89",strokeOpacity:1,strokeWidth:2}}},{key:"getLabelDefaultStyle",value:function(){return{stroke:"#6c7a89",zmin:15}}}]),oe=f((function t(){h(this,t),this.config=Object.seal({emitEventOnOverrideUpdate:!0}),this.imageCache={},this.releaseSettings_={displayOptions:{},mom:[]},this.theme={}}),[{key:"getMomData",value:function(){return this.releaseSettings_.mom}},{key:"getTheme",value:function(){return this.theme||{}}},{key:"getStyle",value:function(t){var e,r=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=this.getTheme(),n=ne.getGeometryDefaultStyle(),o=t.properties.spaceType,a=t.properties.spaceCategory,s=a;return o&&(s="".concat(a,"_").concat(o)),(e=i.getGeometryStyle(s))&&!r||(e=n),{m:e.fill&&e.fill.toLowerCase()||"#fff",w:e.strokeWidth/10||.1,o:e.stroke&&e.stroke.toLowerCase()||"#fff",l:"Dark"}||void 0}},{key:"getLabelStyle",value:function(t){this.getTheme();var e=ne.getLabelDefaultStyle();return{fill:e.stroke,zmin:e.zmin}}}]),ae=Math.PI/180,se=180/Math.PI,le=function(){function t(){h(this,t)}return f(t,null,[{key:"toRadians",value:function(t){return t*ae}},{key:"toDegrees",value:function(t){return t*se}},{key:"getBoundingBox",value:function(e,r){var i=[];switch(e){case St:i=[r,r];break;case Pt:case kt:i=r;break;case Ot:case It:i=r.reduce((function(t,e){return t.concat(e)}),[]);break;case Lt:i=r.reduce((function(t,e){return t.concat(e)}),[]).reduce((function(t,e){return t.concat(e)}),[])}return t.getBoundingBoxVertices(i)}},{key:"getInverseTransform",value:function(t){var e=t[0]*t[3]-t[1]*t[2],r=[t[3]/e,-t[1]/e,-t[2]/e,t[0]/e,0,0];return r[4]=-(r[0]*t[4]+r[2]*t[5]),r[5]=-(r[1]*t[4]+r[3]*t[5]),r}},{key:"applyTransformToPoint",value:function(t,e){return[e[0]*t[0]+e[1]*t[2]+t[4],e[0]*t[1]+e[1]*t[3]+t[5]]}},{key:"transformProduct",value:function(t,e){var r=[0,0,0,0,0,0];return r[0]=e[0]*t[0]+e[2]*t[1],r[1]=e[1]*t[0]+e[3]*t[1],r[2]=e[0]*t[2]+e[2]*t[3],r[3]=e[1]*t[2]+e[3]*t[3],r[4]=e[0]*t[4]+e[2]*t[5]+e[4],r[5]=e[1]*t[4]+e[3]*t[5]+e[5],r}},{key:"convertLonLatToMerc",value:function(t){var e=t[0]*ae,r=t[1]*ae,i=Math.sin(r);return[.5+e/(2*Math.PI),.5-Math.log((1+i)/(1-i))/(4*Math.PI)]}},{key:"convertMercToLatLon",value:function(t){var e=2*Math.PI*(t[0]-.5),r=Math.atan(Math.sinh(2*Math.PI*(.5-t[1])));return[e/ae,r/ae]}},{key:"getTransformScale",value:function(t){return Math.sqrt(t[0]*t[3]-t[1]*t[2])}},{key:"getLonLatToMercTransform",value:function(e){var r=[1/360,0,0,-1/(360*Math.cos(e[1]*ae)),0,0],i=t.applyTransformToPoint(r,e),n=t.convertLonLatToMerc(e);return r[4]=n[0]-i[0],r[5]=n[1]-i[1],r}},{key:"getNatToMercTransform",value:function(e){var r=[e[4],e[5]],i=t.getLonLatToMercTransform(r);return t.transformProduct(e,i)}},{key:"convertMxMy2LonLat",value:function(e,r){return e.length&&r.length?t.applyTransformToPoint(e,r):[]}},{key:"convertLonLat2MxMy",value:function(e,r){if(!e.length||!r.length)return[];var i=t.getInverseTransform(e);return t.applyTransformToPoint(i,r)}},{key:"getFlattenedQuadraticBezierCurve",value:function(t,e,r){var i=[],n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:10;n<1&&(n=6);for(var o=0;o<=n;o+=1){var a=o/n,s=(1-a)*(1-a),l=2*a*(1-a),u=a*a,c=s*t[0]+l*e[0]+u*r[0],h=s*t[1]+l*e[1]+u*r[1];i.push([c,h])}return i}},{key:"getFlattenedCubicBezierCurve",value:function(t,e,r,i){var n=[],o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:10;o<1&&(o=6);for(var a=0;a<=o;a+=1){var s=a/o,l=(1-s)*(1-s)*(1-s),u=3*s*(1-s)*(1-s),c=3*s*s*(1-s),h=s*s*s,p=l*t[0]+u*e[0]+c*r[0]+h*i[0],f=l*t[1]+u*e[1]+c*r[1]+h*i[1];n.push([p,f])}return n}},{key:"getRectangularCoordinatesOfLabelArea",value:function(e,r){var i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],n=_(e,6),o=n[0],a=n[1],s=n[2],l=n[3],u=n[5],c=t.getDeltaLonLatForMeterAtGivenLonLat(o,a),h=e[4];return i?(u&&(h*=-1),null!=r&&(h=(h+=r<0?2*Math.PI+r:r)<0?2*Math.PI+h:h)):h=0,t.getRectVerticesFromSignatureRectRepresentation([o,a],{xLength:s,yLength:l},h,c)}},{key:"getRotatedPoint",value:function(t,e){var r,i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[0,0],o=Math.cos(e),a=Math.sin(e),s=t[0]-n[0],l=t[1]-n[1];return[(r=i?[s*o+l*a,l*o-s*a]:[s*o-l*a,l*o+s*a])[0]+n[0],r[1]+n[1]]}},{key:"getRectVerticesFromSignatureRectRepresentation",value:function(e,r,i,n){var o=r.xLength,a=r.yLength,s=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],l=_(e,2),u=l[0],c=l[1],h=o/2,p=a/2,f=_(n,2),d=f[0],y=f[1];return[[1,1],[-1,1],[-1,-1],[1,-1]].map((function(t){return[t[0]*h,t[1]*p]})).map((function(e){return t.getRotatedPoint(e,i,s)})).map((function(t){return[t[0]*d,t[1]*y]})).map((function(t){return[t[0]+u,t[1]+c]}))}},{key:"getScaleFactorForRectInSpace",value:function(t,e,r,i){var n=t/r,o=e/i;return n>o?o:n}},{key:"getDeltaLonLatForMeterAtGivenLonLat",value:function(t,e){var r=6371e3;return[1/r*(180/Math.PI)/Math.cos(e*Math.PI/180),1/r*(180/Math.PI)]}},{key:"getBoundingBoxVertices",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],e=[[Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY],[Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY]];return t.reduce((function(t,e){return[[Math.min(e[0],t[0][0]),Math.min(e[1],t[0][1])],[Math.max(e[0],t[1][0]),Math.max(e[1],t[1][1])]]}),e)}},{key:"isPointInBoundingBox",value:function(t,e){if(t&&e){var r=_(t,2),i=r[0],n=r[1],o=_(e,2),a=_(o[0],2),s=a[0],l=a[1],u=_(o[1],2),c=u[0],h=u[1];return i<=c&&i>=s&&n<=h&&n>=l}}},{key:"isPointOnLineSegment",value:function(t,e,r){var i=_(t,2),n=i[0],o=i[1],a=_(e,2),s=a[0],l=a[1],u=_(r,2),c=u[0],h=u[1],p=(l-o)*(h-o)<=0;return s===c?s===n&&p:!(o-h!=(h-l)/(c-s)*(n-c)||!p)}},{key:"rayIntersectLineSegment",value:function(t,e,r){var i=_(t,2),n=i[0],o=i[1],a=_(e,2),s=a[0],l=a[1],u=_(r,2),c=u[0],h=u[1];if(s===c)return!1;var p=(n-s)/(c-s);return p>=0&&p<1&&(h-l)*p+l>o}},{key:"isPointInPolygon",value:function(e,r){var i=_(e,2),n=i[0],o=i[1],a=r.length;if(a<3)return!1;var s=0,l=r[a-1];return r.forEach((function(e){t.rayIntersectLineSegment([n,o],l,e)&&(s+=1),l=e})),s%2!=0}},{key:"isPointOnLineString",value:function(e,r){var i=_(e,2),n=i[0],o=i[1],a=r.length;if(a<2)return!1;for(var s=r[a-1],l=0;l<a;l+=1){var u=r[l];if(t.isPointOnLineSegment([n,o],s,u))return!0;s=r[l]}return!1}},{key:"getAreaOfPolygon",value:function(t){var e=t.length;if(e<3)return null;var r=0,i=t[e-1];return t.forEach((function(t){var e,n,o,a,s,l;r+=.5*(e=t,o=(n=_(i,2))[0],a=n[1],l=(s=_(e,2))[0],o*s[1]-a*l),i=t})),r}},{key:"getDistanceBetweenPoints",value:function(t,e){var r=_(t,2),i=r[0],n=r[1],o=_(e,2),a=i-o[0],s=n-o[1];return Math.sqrt(a*a+s*s)}}])}(),ue=f((function t(){h(this,t),this.spaceRules={}}),null,[{key:"getDataEntriesOne",value:function(t,e){var r=[t,""];if(null!==e&&Array.isArray(e))r[1]=e.toString();else if(null!==e&&"object"===u(e)){var i=Object.entries(e);if(i.length>0){var n=this.getDataEntriesOne(i[0][0],i[0][1]);r[0]="".concat(r[0],".").concat(n[0]),r[1]=n[1]}}else r[1]=e;return r}},{key:"getDataEntriesAll",value:function(t){for(var e=[],r=0,i=Object.entries(t);r<i.length;r++){var n=_(i[r],2),o=n[0],a=n[1],s=this.getDataEntriesOne(o,a);e.push(s)}return e}},{key:"doFindComboMatch",value:function(t,e){var r="";if(t&&t.configuration&&t.configuration.combinations)for(var i=this.getDataEntriesAll(e),n=Object.entries(t.configuration.combinations),o=0,a=function(){var t=l[s],e=Object.keys(t[1]).filter((function(e){return i.some((function(r){return e===r[0]&&t[1][e]===r[1]}))}));e.length===Object.keys(t[1]).length&&e.length>o&&(r=t[0],o=e.length)},s=0,l=n;s<l.length;s++)a();return r}},{key:"getIconFromCombinations",value:function(t,e){if(t&&t.configuration.combinations&&e&&Object.keys(e).length>0&&t.behavioralAppearance.combinations&&Object.keys(t.behavioralAppearance.combinations).length>0){var r=this.doFindComboMatch(t,e);if(""===r||!t.behavioralAppearance.combinations[r].labelIcon)return"";if(t.behavioralAppearance.combinations&&t.behavioralAppearance.combinations[r]&&t.behavioralAppearance.combinations[r].labelIcon)return t.behavioralAppearance.combinations[r].labelIcon.referenceUri}return""}},{key:"findSpace",value:function(t,e){if(e.spaceTypes&&e.spaceTypes[t])return e.spaceTypes[t]}},{key:"findCategory",value:function(t){if(this.spaceRules[t])return this.spaceRules[t]}},{key:"setSpaceRules",value:function(t){this.spaceRules=t}},{key:"getSpaceIcon",value:function(t,e,r){var i="",n=this.findCategory(e);if(n){var o=this.findSpace(t,n);if(o){var a="";r&&(a=this.getIconFromCombinations(o,r)),a&&""!==a?i=a:o.behavioralAppearance.default.labelIcon?i=o.behavioralAppearance.default.labelIcon.referenceUri:n.properties.behavioralAppearance.default.labelIcon&&(i=n.properties.behavioralAppearance.default.labelIcon.referenceUri)}}return i}}]),ce=f((function t(){h(this,t)}),null,[{key:"getFormattedIndoorMapId",value:function(t){var e=/^\d{5}$/.test(t),r="string"==typeof t&&t.includes("indoormap");return e||!r?"indoormap-00000000-0000-4000-a000-".concat(t.toString().padStart(12,"0")):t}},{key:"validateIsMicelloId",value:function(t){return new RegExp(/^indoormap-00000000-0000-4000-[a-f]000-[0-9]{12}$/).test(t)}}]),he=f((function t(){h(this,t),this.themeRule={},this.svgList={},this.defaultLang="ENG"}),null,[{key:"getNumberFromAlphaNumeric",value:function(t){try{var e=t.split("").reverse().join("").replace(/[^0-9]/g,"").substr(0,6);return parseInt(e,10)}catch(t){return null}}},{key:"extractNumFromSting",value:function(t){try{var e=t.replace(/[^0-9]/g,"");return parseInt(e,10)}catch(e){return console.warn("Exception in converting string to Id"),this.getNumberFromAlphaNumeric(t)}}},{key:"getVenueId",value:function(t){if("number"!=typeof t){var e=t.substr(t.length-6);return parseInt(e,10)}return t}},{key:"setSite",value:function(t,e){var r=this.getName(t),i={id:ce.getFormattedIndoorMapId(e),location:t.referencePoint,properties:t.properties,geometry:t.geometry,identifier:this.getVenueId(e),obj_type:"CommunityMap"};return ce.validateIsMicelloId(e)&&(i.map_version=t.properties.indoorSiteMetadata.legacyVersion.mapVersion),i.properties.name=r,i.properties.display_name=r,i}},{key:"setEntrance",value:function(t){var e=this.themeRule.entranceRules.default.labelIcon.referenceUri,r=this.extractNumFromSting(t.id),i=this.getName(t),n=t.properties;return n.icon=!0,n.svg=this.svgList[e.toLowerCase()],n.name=i||"entrance",n.display_name=i||"entrance",n.level={id:t.properties.level.id},{id:t.id,levelId:t.properties.level.id,momType:Et.ENTRANCE,geometry:t.geometry,location:t.geometry,properties:n,identifier:r,label_area:[t.referencePoint.coordinates[0],t.referencePoint.coordinates[1],50,50,180]}}},{key:"setStructure",value:function(t){var e=this.extractNumFromSting(t.id),r=this.getName(t),i=t.properties;return i.is_root=0===t.properties.drawOrder,i.display_name=r,i.map_type=t.properties.structureType,i.name=r,{id:t.id,obj_type:"Drawing",identifier:e,properties:i}}},{key:"getNameByPriority",value:function(t,e){for(var r=this,i="",n=function(t){return"OFFICIAL"===t.nameType&&t.languageCode&&t.languageCode===r.defaultLang||"OFFICIAL"===t.nameType},o=0;o<t.length;o++){var a=t[o];if(n(a)&&(e&&e===a.nameType||!e)){i=a.name;break}if("ABBREVIATION"===a.nameType&&(e&&e===a.nameType||!e)){i=a.name;break}if("UNCLASSIFIED"===a.nameType&&(e&&e===a.nameType||!e)){i=a.name;break}if(!a.nameType&&a.name){i=a.name;break}}return i}},{key:"getName",value:function(t,e){return t.properties&&t.properties.names?this.getNameByPriority(t.properties.names,e):t.properties.placeProperties&&t.properties.placeProperties&&t.properties.placeProperties.names?this.getNameByPriority(t.properties.placeProperties.names,e):t.properties.locationDetails&&t.properties.locationDetails[0]&&t.properties.locationDetails[0].names?this.getNameByPriority(t.properties.locationDetails[0].names,e):""}},{key:"setLevel",value:function(t){var e=this.extractNumFromSting(t.id),r=t.properties.names,i=t.properties,n=t.geometry;return i["short name"]=this.getNameByPriority(r,r&&1!==r.length?"ABBREVIATION":""),i.name=this.getNameByPriority(r,r&&1!==r.length?"ABBREVIATION":""),{id:t.id,obj_type:"Level",identifier:e,properties:i,geometry:n}}},{key:"setLevelConnector",value:function(t){var e=this.extractNumFromSting(t.id);return{id:t.id,obj_type:"LevelConnector",properties:t.properties,geometry:t.geometry,identifier:e,location:t.geometry}}},{key:"setOccupant",value:function(t){var e=this.getName(t),r=this.extractNumFromSting(t.id),i=t.properties;return i.occupantName=e,i.email=t.properties.placeProperties&&t.properties.placeProperties.contacts&&t.properties.placeProperties.contacts.find((function(t){return"EMAIL"===t.contactType}))&&t.properties.placeProperties.contacts.find((function(t){return"EMAIL"===t.contactType})).value,i.name=e,i.tags=t.properties.attributes&&t.properties.attributes.tags,{geometry:t.geometry,id:t.id,obj_type:"Geometry",properties:i,identifier:r,spaceIds:t.properties.spaces?t.properties.spaces:[],type:"Feature",momType:Et.OCCUPANT}}},{key:"getIcon",value:function(t){var e=!1,r="";return this.svgList[t]&&(e=!0,r=this.svgList[t]),{icon:e,svg:r}}},{key:"setSpace",value:function(t){var e=ue.getSpaceIcon(t.properties.spaceType,t.properties.spaceCategory,t.properties.spaceTypeProperties),r=this.getName(t),i=this.getIcon(e),n=i.icon,o=i.svg,a=this.extractNumFromSting(t.id),s=t.properties.level.id,l=t.properties;l.spaceName=r,l[t.properties.spaceCategory]=t.properties.spaceType,l.spaceType=t.properties.spaceType,l.spaceCategory=t.properties.spaceCategory,l.icon=n,l.svg=o;var u={geometry:t.geometry,id:t.id,levelId:s,label_area:[t.referencePoint.coordinates[0],t.referencePoint.coordinates[1],50,50,180],location:t.referencePoint,obj_type:"Geometry",identifier:a,properties:l,momType:Et.SPACE,type:"Feature"};return t.properties.spaceAddress&&t.properties.spaceAddress.id&&(u.addressId=t.properties.spaceAddress.id),u}},{key:"setSpaceGroups",value:function(t){var e=this.extractNumFromSting(t.id);return{id:t.id,obj_type:"SpaceGroups",properties:t.properties,geometry:t.geometry,location:t.referencePoint,identifier:e}}},{key:"setTopology",value:function(t){var e=this.extractNumFromSting(t.id);return{id:t.id,obj_type:"Topology",properties:t.properties,geometry:t.geometry,identifier:e}}},{key:"setAddress",value:function(t){var e=this.extractNumFromSting(t.id),r=this.getName(t),i=t.properties;return i.addressName=r,i.name=r,{id:t.id,properties:i,obj_type:"Address",identifier:e}}},{key:"manageSvgDimensions",value:function(t){for(var e={},r=0,i=Object.entries(t);r<i.length;r++){var n=_(i[r],2),o=n[0],a=n[1];if("string"==typeof a){var s=-1!==a.indexOf("<g")&&a.indexOf("<g")||a.indexOf("<p"),l=a.indexOf("</s");if(s&&l){var u=a.substring(s-1,l-1);e[o]="<svg width='64' height='64' viewBox='0 0 24 32' fill='none' xmlns='http://www.w3.org/2000/svg'>".concat(u,"</svg>")}}}return e}},{key:"getSiteBoundingBox",value:function(t){if(t){var e=_(le.getBoundingBox(t.geometry.type,t.geometry.coordinates),2),r=e[0],i=e[1];if(r)return"".concat(r[0],",").concat(r[1],",").concat(i[0],",").concat(i[1])}return"null, null, null, null"}}]),pe=f((function t(){h(this,t)}),null,[{key:"get",value:function(t){return fetch(t,arguments.length>1&&void 0!==arguments[1]?arguments[1]:{method:"GET"}).then((function(e){return e.ok?e.json():Promise.reject(new Error("Call failed for ".concat(t," : ").concat(e.status," ").concat(e.statusText)))}))}},{key:"getConfigUrl",value:function(t,e,r){var i=r.apiKey,n=r.url,o=r.token,a=r.hrn,s={method:"GET",mode:"cors",cache:"default"},l="".concat(n||Mt,"/").concat(a),u="";return e===wt.SITE&&(u="".concat(l,"/layers/").concat(Rt,"/search?p.featureType=indoor.Site&p.indoorMapId='").concat(ce.getFormattedIndoorMapId(t),"'")),e===wt.IMAGES&&(u="".concat(l,"/layers/").concat("icons","/features/svg")),e===wt.Theme&&(u="".concat(l,"/layers/").concat("config","/features/indoorMapRules")),o?s.headers={Authorization:"Bearer ".concat(o)}:u=u.concat("".concat(e===wt.SITE?"&":"?","apiKey=").concat(i)),this.get(u,s)}},{key:"getMomData",value:function(t,e){var r=e.apiKey,i=e.url,n=e.token,o=e.hrn,a={method:"GET",mode:"cors",cache:"default"},s="".concat(i||Mt,"/").concat(o),l=t&&t.features&&t.features.find((function(t){return t.momType===Et.SITE})),u=he.getSiteBoundingBox(l),c=[Et.TOPOLOGY,Et.LEVELCONNECTOR],h=Object.values(Et).filter((function(t){return!c.includes(t)})).join(),p="".concat(s,"/layers/").concat(Rt,"/bbox?bbox=").concat(u,"&limit=100000&f.momType=").concat(h);return n?a.headers={Authorization:"Bearer ".concat(n)}:p=p.concat("&apiKey=".concat(r)),{mom:this.get(p,a),site:l}}},{key:"getDefaultCollection",value:function(t){var e=t.token,r=Bt[Dt.DEFAULT_COLLECTION],i=r.PARAMS,n=r.BASE_URL,o=encodeURI("".concat(n,"?sortBy=").concat(i.CREATED_BY,"&q=").concat(i.COLLECTION));if(e){var a={method:"GET",headers:{Authorization:"Bearer ".concat(e)}};return this.get(o,a)}return Promise.reject(new Error("Please provide valid token"))}},{key:"getProjectAccountDetails",value:function(t){var e=t.token,r=Bt[Dt.ACCOUNT_API].BASE_URL;if(e){var i={method:"GET",mode:"cors",headers:{Authorization:"Bearer ".concat(e)}};return this.get(r,i)}return Promise.reject(new Error("Please provide valid token"))}},{key:"fetchIndoorMapList",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=t.hrn,r=t.url,i=Bt[Dt.CATALOG_LAYER],n=i.PARAMS,o=i.COLLECTION_LAYER;if(e){var a=encodeURI("".concat(r||Mt,"/").concat(e,"/").concat(o,"?").concat(n.FEATURE_TYPE.KEY,"=").concat(n.FEATURE_TYPE.VALUE)),s=this.createBaseUrl(a,Ut.GET,{},t),l=s.URL,u=s.options;return this.get(l,u)}return Promise.reject(new Error("Please provide valid hrn"))}},{key:"createBaseUrl",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Ut.GET,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},n=i.token,o=i.apiKey,s=t,l={method:e,mode:"cors"};return n?l.headers=a({Authorization:"Bearer ".concat(n)},r):s=t.concat("&apiKey=".concat(o)),{URL:s,options:l}}}]),fe=function(){function t(){h(this,t)}return f(t,null,[{key:"isPointOnGeoJSONLineString",value:function(t,e){var r=!1;if(e&&e.length>1)for(var i=0,n=0,o=1;o<e.length;o+=1)if(i=e[o-1],n=e[o],le.isPointOnLineSegment(t,i,n)){r=!0;break}return r}},{key:"isPointOnGeoJSONMultiLineString",value:function(e,r){for(var i=!1,n=0;n<r.length;n+=1)if(t.isPointOnGeoJSONLineString(e,r[n])){i=!0;break}return i}},{key:"isPointInsideGeoJSONPolygon",value:function(t,e){var r=!1;if(le.isPointInPolygon(t,e[0])&&(r=!0),r)for(var i=1;i<e.length;i+=1)if(le.isPointInPolygon(t,e[i])){r=!1;break}return r}},{key:"isPointInsideGeoJSONMultiPolygon",value:function(e,r){for(var i=r.length,n=0;n<i;n+=1)if(t.isPointInsideGeoJSONPolygon(e,r[n]))return!0;return!1}},{key:"getGeometriesByLonLat",value:function(t,e){for(var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=[],n=e.filter((function(e){return le.isPointInBoundingBox(t,e.getBoundingBox())})),o=0;o<n.length;o+=1){var a=n[o];if(a.isPointInsideGeometry(t,!0)&&(i.push(a),!r))break}return i.sort((function(t,e){return e.getZIndex()-t.getZIndex()}))}}])}(),de=f((function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=arguments.length>1?arguments[1]:void 0,i=arguments.length>2?arguments[2]:void 0;h(this,t),this.id=e.id,this.properties=e.properties||{},this.labelArea=e.label_area||[],this.geometry=e.geometry||{},this.location=e.location||{},this.address=e.address||{},this.level=r,this.zIndex=i,this.spaceId=e.spaceId,this.state_={isHighlighted:!1,highlightedStyle:{}},this.geometryData=e}),[{key:"getId",value:function(){return this.geometryData&&this.geometryData.identifier}},{key:"getIdentifier",value:function(){return this.id}},{key:"getProperties",value:function(){return this.properties}},{key:"getInternalAddress",value:function(){return this.address?this.address.properties&&this.address.properties.name:null}},{key:"getCenter",value:function(){return this.location.coordinates||[]}},{key:"getCoordinates",value:function(){return this.geometry.coordinates||[]}},{key:"getDisplayName",value:function(){return this.properties.display_name||""}},{key:"getName",value:function(){return this.properties.name||""}},{key:"getStyle",value:function(){return this.getMetaInformation_().getStyle(this)}},{key:"getIcon",value:function(){return this.properties.svg}},{key:"getLabelArea",value:function(){return this.labelArea||[]}},{key:"getLabelStyle",value:function(){return this.getMetaInformation_().getLabelStyle(this)||null}},{key:"getLevel",value:function(){return this.level}},{key:"getType",value:function(){return this.geometry.type}},{key:"getZIndex",value:function(){return this.zIndex}},{key:"getBoundingBox",value:function(){var t=this.getType(),e=this.getCoordinates(),r=[];switch(t){case St:r=[e,e];break;case Pt:case kt:r=e;break;case Ot:case It:r=e.reduce((function(t,e){return t.concat(e)}),[]);break;case Lt:r=e.reduce((function(t,e){return t.concat(e)}),[]).reduce((function(t,e){return t.concat(e)}),[])}return le.getBoundingBoxVertices(r)}},{key:"isIcon",value:function(){return!!this.properties.icon}},{key:"isPointInsideGeometry",value:function(t){var e,r=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=!1;switch(this.getType()){case St:e=this.getLabelArea()&&le.getRectangularCoordinatesOfLabelArea(this.getLabelArea()),i=le.isPointInPolygon(t,e);break;case Pt:break;case kt:i=r&&fe.isPointOnGeoJSONLineString(t,this.getCoordinates());break;case Ot:i=r&&fe.isPointOnGeoJSONMultiLineString(t,this.getCoordinates());break;case It:i=fe.isPointInsideGeoJSONPolygon(t,this.getCoordinates());break;case Lt:i=fe.isPointInsideGeoJSONMultiPolygon(t,this.getCoordinates())}return i}},{key:"highlight",value:function(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],e=arguments.length>1?arguments[1]:void 0;this.state_.isHighlighted=t,this.state_.highlightedStyle=t?e:{}}},{key:"isHighlighted",value:function(){return Boolean(this.state_.isHighlighted)}},{key:"getHighlightedStyle",value:function(){return this.state_.highlightedStyle||{}}},{key:"toJSON",value:function(){return a({},this.geometry)}},{key:"getMetaInformation_",value:function(){return this.getLevel()?this.getLevel().getDrawing().getVenueModel().metaInformation_:null}}]),ye=f((function t(e,r){var i=this;h(this,t),this.id=e&&e.id,this.properties=e&&e.properties,this.zIndexCount=0,this.geometries=e&&e.features&&Object.values(e.features).reduce((function(t,e){return t[[e.id]]=new de(e,i,e.properties.drawOrder),t}),{}),this.drawing=r,this.levelData=e}),[{key:"getId",value:function(){return this.levelData&&this.levelData.identifier}},{key:"getIdentifier",value:function(){return this.id}},{key:"getProperties",value:function(){return this.properties}},{key:"getName",value:function(){return this.properties&&this.properties.name||""}},{key:"getDisplayName",value:function(){return this.properties&&this.properties.display_name||""}},{key:"getDrawing",value:function(){return this.drawing}},{key:"getShortName",value:function(){return this.properties&&this.properties["short name"]||""}},{key:"getZIndex",value:function(){return this.properties&&this.properties.zLevel}},{key:"getFeatureCollectionArray",value:function(){return this.getGeometries().map((function(t){return t.toJSON()}))}},{key:"getGeometryById",value:function(t){return this.geometries[t]}},{key:"getGeometries",value:function(){return arguments.length>0&&void 0!==arguments[0]&&arguments[0]?this.geometries&&Object.values(this.geometries).sort((function(t,e){return e.getZIndex()-t.getZIndex()})):this.geometries&&Object.values(this.geometries).sort((function(t,e){return t.getZIndex()-e.getZIndex()}))}},{key:"getGeometriesByAddress",value:function(t){return Object.values(this.geometries).filter((function(e){return e.address&&e.address.properties&&e.address.properties.name&&e.address.properties.name===t}))}},{key:"isMain",value:function(){return Boolean(this.properties.isMain)}}]),ge=f((function t(e){var r=this,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],o=arguments.length>3?arguments[3]:void 0;h(this,t),this.venueModel=o,this.levels=n.map((function(t){return new ye(t,r)})),this.structure=e,this.id=e&&e.id,this.properties=i}),[{key:"getId",value:function(){return this.structure&&this.structure&&this.structure.identifier}},{key:"getIdentifier",value:function(){return this.id}},{key:"getProperties",value:function(){return this.properties}},{key:"isRoot",value:function(){return Boolean(this.properties.is_root)}},{key:"getDisplayName",value:function(){return this.properties.display_name||""}},{key:"getName",value:function(){return this.properties.name||""}},{key:"getBoundingBox",value:function(){if(this.structure&&this.structure.geometry){var t=_(le.getBoundingBox(this.structure.geometry.type,this.structure.geometry.coordinates),2),e=t[0],r=t[1];if(e)return[r[1],e[0],e[1],r[0]]}return[null,null,null,null]}},{key:"getCenter",value:function(){return this.structure&&this.structure.location&&this.structure.location.coordinates}},{key:"getGeometryById",value:function(t){return this.getGeometries().find((function(e){return e.getId()===t||e.getIdentifier()===t}))}},{key:"getGeometries",value:function(){return this.levels.flatMap((function(t){return t.getGeometries()}))}},{key:"getLevelById",value:function(t){return this.levels.find((function(e){return e.getId()===t||e.getIdentifier()===t}))}},{key:"getLevelByZIndex",value:function(t){return this.levels.find((function(e){return e.getZIndex()===t}))}},{key:"getLevels",value:function(){return this.levels}},{key:"getMainLevel",value:function(){return this.levels.find((function(t){return t.isMain()}))}},{key:"getVenueModel",value:function(){return this.venueModel}}]),ve=Ct.STANDARD,me=f((function t(e){var r=this,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new oe;h(this,t),this.metaInformation_=i,this.momStructure=e,this.id=e&&e.site&&e.site.id,this.location=e&&e.site&&e.site.location||{},this.properties=e&&e.site&&a({},e.site.properties),this.drawings=e&&e.structure&&Object.values(e.structure).map((function(t){var i=e.getStructureWiseGeometry(t.id);return new ge(t,t.properties,Object.values(i),r)}))}),[{key:"getDisplaySettings",value:function(){return(this.metaInformation_.releaseSettings_?this.metaInformation_.releaseSettings_.displayOptions:"").display||ve}},{key:"getId",value:function(){return this.momStructure&&this.momStructure.site&&this.momStructure.site.identifier}},{key:"getIdentifier",value:function(){return this.id}},{key:"getName",value:function(){return this.properties.name}},{key:"getBoundingBox",value:function(){if(this.momStructure){var t=_(le.getBoundingBox(this.momStructure.site.geometry.type,this.momStructure.site.geometry.coordinates),2),e=t[0],r=t[1];if(e)return[r[1],e[0],e[1],r[0]]}return[null,null,null,null]}},{key:"getCenter",value:function(){return this.location.coordinates}},{key:"getGeometryById",value:function(t){return this.getGeometries().find((function(e){return e.getId()===t||e.getIdentifier()===t}))}},{key:"getGeometries",value:function(){return this.getLevels().sort((function(t,e){return t.getZIndex()-e.getZIndex()})).flatMap((function(t){return t.getGeometries()}))}},{key:"getGeometriesByLonLat",value:function(t){var e=this,r=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],i=(arguments.length>1&&void 0!==arguments[1]?arguments[1]:[]).map((function(t){return e.getLevelById(t)}));return 0===i.length&&(i=this.drawings.filter((function(e){var r=e.getBoundingBox();return le.isPointInBoundingBox(t,r)})).flatMap((function(t){return t.getLevels()}))),fe.getGeometriesByLonLat(t,i.flatMap((function(t){return t.getGeometries(!0)})),r)}},{key:"getDrawingById",value:function(t){return this.drawings.find((function(e){return e.getId()===t||e.getIdentifier()===t}))}},{key:"getDrawings",value:function(){return this.drawings}},{key:"getRootDrawing",value:function(){return this.drawings.find((function(t){return t.isRoot()}))}},{key:"getLevelById",value:function(t){return this.getLevels().find((function(e){return e.getId()===t||e.getIdentifier()===t}))}},{key:"getLevelsByZIndex",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this.getLevels().filter((function(e){return Number(e.getZIndex())===Number(t)}))}},{key:"getLevels",value:function(){return this.drawings.flatMap((function(t){return t.getLevels()}))}},{key:"getMomStructure",value:function(){return this.momStructure}},{key:"getLevelMapFlattenedByZIndex_",value:function(){var t=this.getLevels().reduce((function(t,e){var r=e.getZIndex(),i=t;return i[r]||(i[r]=[]),i[r].push(e),i}),{});return t}},{key:"getOccupant",value:function(){var t=this.momStructure.occupant;return Object.values(t)}}]),_e=f((function t(e){h(this,t),this.theme=e&&e.theme,this.level=e&&e.level,this.site=e&&e.site,this.spaces=e&&e.spaces,this.address=e&&e.address,this.levelConnector=e&&e.levelConnector,this.topology=e&&e.topology,this.entrance=e&&e.entrance,this.occupant=e&&e.occupant,this.structure=e&&e.structure,this.spaceGroups=e&&e.spaceGroups,this.levelWiseGeometry={},this.levelStructureMapping=e&&e.levelStructureMapping,this.outdoorLevelMapping=e&&e.outdoorLevelMapping||{},this.labelTextPreference=e&&e.labelTextPreference||null}),[{key:"setSpaceWithLevel",value:function(){var t=this;this.spaces&&Object.values(this.spaces).forEach((function(e){var r="";e.addressId&&(r=t.address&&t.address[e.addressId]&&t.address[e.addressId].properties.addressName);var i=e.properties;i.addressName=r;var n=t.getLabelAsPerPreference(a(a({},e),{},{properties:i})),o=e.properties;o.name=n,o.display_name=n,e.properties.icon&&(o.name=e.id,o.display_name=e.id);var s=e;s.properties=o,s.address=t.address[e.addressId],t.spaces[e.id]=e;var l=e.levelId;t.outdoorLevelMapping[l]&&(l=t.outdoorLevelMapping[l]),t.levelWiseGeometry[l]||(t.levelWiseGeometry[l]={}),t.levelWiseGeometry[l][s.id]=s}))}},{key:"setOccupantWithLevel",value:function(){var t=this;this.occupant&&Object.values(this.occupant).forEach((function(e){if(e.spaceIds&&e.properties.occupantName){var r=[],i=[];e.spaceIds.forEach((function(n){var o=n.id,a=t.spaces[o],s=null;t.spaceGroups&&Object.values(t.spaceGroups).forEach((function(t){t.properties.spaceGroups&&t.properties.spaceGroups&&t.properties.spaceGroups.forEach((function(t){t.mainSpace&&t.mainSpace.id===n.id&&(s=t.spaces.map((function(t){return t.id})))}))}));var l=function(n){var o=!1;t.labelTextPreference&&t.labelTextPreference.length&&(o=-1!==t.labelTextPreference.indexOf("OCCUPANT_NAMES"));var a=null===t.labelTextPreference||o,s=n,l=n.properties;l.name=n.properties.icon||!a?n.properties.name:e.properties.occupantName,l.display_name=n.properties.icon||!a?n.properties.display_name:e.properties.occupantName,l.address=n.address,l.occupantName=e.properties.occupantName;var u=n.levelId;t.outdoorLevelMapping[u]&&(u=t.outdoorLevelMapping[u]),t.levelWiseGeometry[u]||(t.levelWiseGeometry[u]={}),t.levelWiseGeometry[u][n.id]=s,r.push(s),i.push(n.id)};s&&s.length>0&&s.forEach((function(e){l(t.spaces[e])})),a&&l(a)})),t.occupant[e.id]=e,t.occupant[e.id].space=r,t.occupant[e.id].spaceIds=i}}))}},{key:"setEntrance",value:function(){var t=this;this.entrance&&Object.values(this.entrance).forEach((function(e){var r=e.properties.level.id;t.levelWiseGeometry[r]||(t.levelWiseGeometry[e.properties.level.id]={}),t.outdoorLevelMapping[r]&&(r=t.outdoorLevelMapping[r]),t.levelWiseGeometry[r][e.id]=e}))}},{key:"setLevelWiseGeometry",value:function(){var t=this;this.level&&Object.keys(this.level).forEach((function(e){t.levelWiseGeometry[e]={}})),this.setSpaceWithLevel(),this.setOccupantWithLevel(),this.setEntrance()}},{key:"getStructureWiseGeometry",value:function(t){for(var e={},r=0,i=Object.entries(this.levelWiseGeometry);r<i.length;r++){var n=_(i[r],2),o=n[0],a=n[1];t===this.levelStructureMapping[o]&&(e[o]=this.level[o],e[o].features=a)}return e}},{key:"getLabelAsPerPreference",value:function(t){var e=t.properties,r=e.spaceType,i=e.occupantName,n=e.spaceName,o=e.addressName,a=e.spaceCategory,s=d(d(d(d(d(d(d({},"OCCUPANT_NAMES",i),"SPACE_NAME",n),Tt,r?r.charAt(0).toUpperCase()+r.slice(1).toLowerCase():""),At,a?a.charAt(0).toUpperCase()+a.slice(1).toLowerCase():""),"INTERNAL_ADDRESS_SHORT",o),"INTERNAL_ADDRESS",o),"INTERNAL_ADDRESS_LONG",o),l=this.theme.spaceRules,u="",c=a&&r&&l[a]&&l[a].spaceTypes&&l[a].spaceTypes[r].behavioralAppearance.default.labelType;if("NONE"===c){if(!this.labelTextPreference)return"";s[Tt]=""}var h=a&&r&&l[a]&&l[a].properties&&l[a].properties.behavioralAppearance&&l[a].properties.behavioralAppearance.default&&l[a].properties.behavioralAppearance.default.labelType;if(("NONE"===h||void 0===h)&&void 0===c){if(!this.labelTextPreference)return"";s[Tt]="",s[At]=""}var p=a&&r&&l[a]&&l[a].properties&&l[a].properties.behavioralAppearance&&l[a].properties.behavioralAppearance.default&&l[a].properties.behavioralAppearance.default.labelTextPreference,f=p&&this.labelTextPreference?this.labelTextPreference:p;if(f)for(var y=0;y<f.length;y++)if(s[f[y]]){u=s[f[y]];break}return u}}]),be=function(){return f((function t(e){var r=e.apiKey,i=e.baseUrl,n=e.token,o=e.hrn;h(this,t);var a={apiKey:r,url:i,token:n,hrn:o};this.hostOptions_=a,this.momData=[],this.theme={},this.loadOptions={}}),[{key:"setHostOptions",value:function(t){0===Object.keys(t).length||(this.hostOptions_=a(a({},this.hostOptions_),t))}},{key:"getToken",value:function(){return this.hostOptions_.token}},{key:"getHrn",value:function(){return this.hostOptions_.hrn}},{key:"load",value:function(t){var e=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.loadOptions=a(a(a({},zt),r),{},{venueId:t}),this.hostOptions_.mapData=r.mapData,this.hostOptions_.themeRule=r.themeRule,this.hostOptions_.svgList=r.svgList,this.hostOptions_.labelTextPreference=r.labelTextPreferenceOverride,this.getHrn()?this.getVenueModalInstance():this.getToken()?this.getDefaultCollectionWithToken().then((function(){return e.getVenueModalInstance()})).catch((function(){return Promise.reject(new Error("Unable to find indoor map collection. Please contact your administrator"))})):Promise.reject(new Error("In order to load indoor map, Please provide either hrn or token"))}},{key:"getVenueModalInstance",value:function(){var t=this;return Promise.resolve().then((function(){return t.loadOptions.isMetaEnabled?t.getMeta_(t.loadOptions.isIconsEnabled).catch((function(t){return console.warn(t),Promise.resolve()})):Promise.reject()})).then((function(e){return t.getVenue_(e)})).then((function(t){return t})).catch((function(t){console.debug("Captured event VENUE_ERROR_STATE",t)}))}},{key:"createMomStructure",value:function(){var t=this,e={site:{},structure:{},level:{},levelConnector:{},occupant:{},spaces:{},spaceGroups:{},topology:{},address:{},outdoorLevelMapping:{},entrance:{},levelStructureMapping:{}};return this.momData.forEach((function(r){var i=ce.getFormattedIndoorMapId(t.loadOptions.venueId),n=r.id;(r.momType===Et.ADDRESS||t.hostOptions_.mapData||r.properties.indoorMapId==t.loadOptions.venueId||r.properties.indoorMapId===i)&&(r.momType===Et.SITE?e.site=he.setSite(r,t.loadOptions.venueId):r.momType===Et.STRUCTURE?e.structure[n]=he.setStructure(r):r.momType!==Et.LEVEL||r.properties.isOutdoor&&(!r.properties.isOutdoor||r.properties.parentIndoorLevel)?r.momType===Et.LEVEL&&r.properties.isOutdoor&&r.properties.parentIndoorLevel?e.outdoorLevelMapping[r.id]=r.properties.parentIndoorLevel.id:r.momType===Et.ENTRANCE?e.entrance[n]=he.setEntrance(r):r.momType===Et.OCCUPANT?e.occupant[n]=he.setOccupant(r):r.momType===Et.SPACE?e.spaces[n]=he.setSpace(r):r.momType===Et.SPACEGROUPS?e.spaceGroups[n]=he.setSpaceGroups(r):r.momType===Et.ADDRESS&&(e.address[n]=he.setAddress(r)):(e.level[n]=he.setLevel(r),e.levelStructureMapping[n]=r.properties.structure.id))})),e.theme=this.theme,e.labelTextPreference=this.hostOptions_.labelTextPreference,new _e(e)}},{key:"getVenue_",value:function(t){this.momData=t.getMomData();var e=this.createMomStructure();return e.setLevelWiseGeometry(),new me(e,t)}},{key:"setConfigData",value:function(t){var e=t.themeRule,r=t.svgList,i=t.defaultLang;ue.setSpaceRules(e.spaceRules),he.svgList=r,he.themeRule=e,he.defaultLang=i,this.theme=e}},{key:"getMeta_",value:function(){var t=this,e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],r=new oe,i=this.hostOptions_.mapData?{}:this.getMetaConfig_(this.loadOptions.venueId,wt.SITE),n=this.hostOptions_.themeRule||this.getMetaConfig_(this.loadOptions.venueId,wt.Theme),o=[];return e&&(o=this.hostOptions_.svgList||this.getMetaConfig_(this.loadOptions.venueId,wt.IMAGES)),new Promise((function(a){Promise.all([i,n,o]).then((function(i){var n=_(i,3),o=n[0],s=n[1],l=n[2],u=t.hostOptions_.mapData?{mom:new Promise((function(e){return e(t.hostOptions_.mapData)})),site:t.hostOptions_.mapData.features.find((function(t){return t.momType===Et.SITE}))}:pe.getMomData(o,t.hostOptions_);u.mom.then((function(i){var n=s.properties;r.imageCache=e?he.manageSvgDimensions(l.properties):[],t.setConfigData({themeRule:n,svgList:r.imageCache,defaultLang:u&&u.site&&u.site.properties.defaultLanguageCode}),r.releaseSettings_={displayOptions:{display:n.entranceRules.default.displayName||Ct.STANDARD},mom:i.features},r.theme=new ne(n,r),a(r)}))}))}))}},{key:"getMetaConfig_",value:function(t,e){return pe.getConfigUrl(t,e,this.hostOptions_)}},{key:"fetchCollections",value:function(){return pe.getDefaultCollection(this.hostOptions_)}},{key:"fetchUserProjects",value:function(){return pe.getProjectAccountDetails(this.hostOptions_)}},{key:"getDefaultCollectionWithToken",value:(t=function(t){return function(){var e=this,r=arguments;return new Promise((function(i,n){var o=t.apply(e,r);function a(t){c(o,i,n,a,s,"next",t)}function s(t){c(o,i,n,a,s,"throw",t)}a(void 0)}))}}(s().mark((function t(){var e=this;return s().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",Promise.all([this.fetchCollections(),this.fetchUserProjects()]).then((function(t){var r=_(t,2),i=r[0],n=r[1],o=e.getHrnFromDefaultCollection(i,n);if(o.hrn){var a={hrn:o.hrn};return e.setHostOptions(a),Promise.resolve()}return Promise.reject()})).catch((function(t){return Promise.reject(t)})));case 1:case"end":return t.stop()}}),t,this)}))),function(){return t.apply(this,arguments)})},{key:"getHrnFromDefaultCollection",value:function(t,e){var r=t.results.items;if(Array.isArray(r)&&r.length){var i=this.getProjectRealm(e);return r.find((function(t){return t.hrn.includes(i)}))}return Promise.reject(new Error("Error while accessing default collection"))}},{key:"getProjectRealm",value:function(t){if(Array.isArray(t.items)&&t.items.length&&t.items[0].id.includes("indoor-")){var e=t.items[0].hrn;return this.getRealmNameFromHrn(e)}return""}},{key:"getRealmNameFromHrn",value:function(t){if(t){var e=t.split(":");return e.length&&e[4]}return""}},{key:"getSupportedMapList",value:function(){var t=this,e=this.hostOptions_,r=e.hrn,i=e.token;return r?this.fetchMapInfoList():i?this.getDefaultCollectionWithToken().then((function(){return t.fetchMapInfoList()})).catch((function(){return Promise.reject(new Error("Unable to find indoor map collection. Please contact your administrator"))})):Promise.reject(new Error("In order to load map list, Please provide either hrn or token"))}},{key:"fetchMapInfoList",value:function(){var t=this;return pe.fetchIndoorMapList(this.hostOptions_).then((function(e){var r=e.features;return r.length>0?r.map((function(e){var r=e.properties,i=r.placeProperties,n=r.indoorMapId,o=n;if(ce.validateIsMicelloId(n)){var a=n.split("-").pop();o=parseInt(a.substring(a.length-Math.min(a.length,5)),10).toString()}return{mapIdentifier:n,mapName:t.getMapName(i.names).name,mapId:o}})):[]})).catch((function(t){Promise.reject(new Error("".concat(t,": Error while fetching map list")))}))}},{key:"getMapName",value:function(t){return Array.isArray(t)&&t.length>0?t.find((function(t){return"OFFICIAL"===t.nameType})):{}}}]);var t}(),xe=["origin","destination"],we=f((function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(h(this,t),!e.apiKey&&!e.token)throw new Error("API key or Token is missing");this.config_=a({baseUrl:"https://meta-indoor-routing.api-gateway.ls.hereapi.com"},e)}),[{key:"calculateRoute",value:function(t){var e=t.origin,r=void 0===e?{}:e,i=t.destination,n=void 0===i?{}:i,o=function(t,e){if(null==t)return{};var r,i,n=function(t,e){if(null==t)return{};var r,i,n={},o=Object.keys(t);for(i=0;i<o.length;i++)r=o[i],e.indexOf(r)>=0||(n[r]=t[r]);return n}(t,e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);for(i=0;i<o.length;i++)r=o[i],e.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(t,r)&&(n[r]=t[r])}return n}(t,xe);if(!r.coordinates||!n.coordinates)throw new Error("Waypoint coordinates are missing");var a=function(t){var e=t.coordinates,r=t.venueId,i=t.levelId,n=e.join(",");return r&&i?n.concat(";indoorMapId=",r,";levelId=",i):n},s=new URL("".concat(this.config_.baseUrl,"/v1/routes")),l=new URLSearchParams({origin:a(r),destination:a(n),apiKey:this.config_.apiKey});return Object.entries(o).forEach((function(t){var e=_(t,2),r=e[0],i=e[1];l.append(r,"object"===u(i)?JSON.stringify(i):i)})),s.search=l,fetch(s,{headers:{"X-Api-Key":this.config_.apiKey}}).then((function(t){return t.json()}))}}]),Ee={VENUE_DATA_LOADED:"VENUE_DATA_LOADED",VENUE_THEME_LOADED:"VENUE_THEME_LOADED",VENUE_ICONS_LOADED:"VENUE_ICONS_LOADED",VENUE_MOM_DATA_LOADED:"VENUE_MOM_DATA_LOADED",VENUE_ERROR_STATE:"VENUE_ERROR_STATE",VENUE_MAP_DATA_LOADED:"VENUE_MAP_DATA_LOADED",VENUE_ENTITY_DATA_LOADED:"VENUE_ENTITY_DATA_LOADED",VENUE_DATA_MODEL_LOADED:"VENUE_DATA_MODEL_LOADED",VENUE_NAV_DATA_LOADED:"VENUE_NAV_DATA_LOADED",META_DATA_LOADED:"META_DATA_LOADED",META_DATA_MODEL_LOADED:"META_DATA_MODEL_LOADED",META_DATA_MODEL_UPDATED:"META_DATA_MODEL_UPDATED"};Object.freeze(d(d(d(d(d(d(d(d(d({},Ee.VENUE_DATA_LOADED,{description:"event fired when all requested files along with metadata & overrides are loaded",emitTemplate:{}}),Ee.VENUE_MAP_DATA_LOADED,{description:"event fired when requested levels, drawings & community files are loaded",emitTemplate:{}}),Ee.VENUE_ENTITY_DATA_LOADED,{description:"event fired when requested entity data is loaded",emitTemplate:{}}),Ee.VENUE_DATA_MODEL_LOADED,{description:"event fired when a map file is loaded",emitTemplate:{}}),Ee.VENUE_NAV_DATA_LOADED,{description:"event fired when requested navigation product is loaded",emitTemplate:{}}),Ee.META_DATA_LOADED,{description:"event fired when all requested meta files are loaded except icon & marker",emitTemplate:{}}),Ee.META_DATA_MODEL_LOADED,{description:"event fired when a specific model is loaded except icon & marker",emitTemplate:{}}),Ee.META_DATA_MODEL_UPDATED,{description:"event fired when a specific meta override is added or removed",emitTemplate:{}}),Ee.VENUE_ICONS_LOADED,{description:"event fired when all icons of venue are loaded",emitTemplate:{}}));var Te=new Gt;Te.EVENT_NAME=Ee,Te.on("newListener",(function(t){Ee[t]||console.warn("subscribing for un-registered/documented event")}));var Ae=function(){function t(e){var i;if(h(this,t),i=r(this,t),!(e instanceof me))throw new Error("It is mandatory to provide valid instance of venueModel");return i.venueModel=e,i.search_=new xt(e),i.status_={activeDrawingId:e.getRootDrawing().getIdentifier(),activeLevelIndex:e.getRootDrawing().getMainLevel().getZIndex()},i.mapObjectStore_=i.getDefaultMapObjectsStore_(),i.drawings=e.getDrawings().map((function(t){var e=new T(t);return e.setParentEventTarget(i),e})),i.levels=e.getLevels().map((function(t){var e=new A(t);return e.setParentEventTarget(i.drawings.find((function(t){return t.getIdentifier()===e.getData().getDrawing().getIdentifier()}))),e})),i.geometries=e.getGeometries().map((function(t){var e=new E(t);return e.setParentEventTarget(i.levels.find((function(t){return t.getIdentifier()===e.getData().getLevel().getIdentifier()}))),e})),i.mutualExclusiveHighlight_=!1,i}return y(t,H.map.Feature),f(t,[{key:"getData",value:function(){return this.venueModel}},{key:"getBoundingBox",value:function(){return i(H.geo.Rect,b(this.venueModel.getBoundingBox()))}},{key:"getCenter",value:function(){var t=_(this.venueModel.getCenter(),2),e=t[0],r=t[1];return new H.geo.Point(r,e)}},{key:"getId",value:function(){return this.venueModel.getId()}},{key:"getIdentifier",value:function(){return this.venueModel.getIdentifier()}},{key:"getName",value:function(){return this.venueModel.getName()}},{key:"getDrawing",value:function(t){return this.drawings.find((function(e){return e.getIdentifier()===t}))}},{key:"getDrawings",value:function(){return this.drawings}},{key:"getLevel",value:function(t){return this.levels.find((function(e){return e.getIdentifier()===t}))}},{key:"getLevels",value:function(){return this.levels}},{key:"getGeometry",value:function(t){return this.getGeometries().find((function(e){return e.getIdentifier()===t}))}},{key:"getGeometries",value:function(){return this.geometries}},{key:"getActiveLevels",value:function(){var t=this;return this.getData().getDisplaySettings()===Ct.FLATTEN?this.venueModel.getLevelsByZIndex(this.status_.activeLevelIndex).map((function(e){return t.getLevel(e.getIdentifier())})):[this.venueModel.getDrawingById(this.status_.activeDrawingId).getLevelByZIndex(this.status_.activeLevelIndex)].map((function(e){return t.getLevel(e.getIdentifier())}))}},{key:"getActiveDrawing",value:function(){return this.getDrawing(this.status_.activeDrawingId)}},{key:"setActiveDrawing",value:function(e){if(this.status_.activeDrawingId!==e){var r=this.venueModel.getDrawingById(e);if(!r)throw new Error("Drawing ".concat(e," was not found"));var i=this.status_.activeDrawingId;this.status_.activeDrawingId=r.id,this.setActiveLevelIndex(r.getMainLevel().getZIndex()),this.dispatchEvent(new H.util.ChangeEvent(t.EVENTS.DRAWING_CHANGE,e,i))}}},{key:"getActiveLevelIndex",value:function(){return this.status_.activeLevelIndex}},{key:"setActiveLevelIndex",value:function(e){if(this.venueModel.getLevelsByZIndex(e)){var r=this.status_.activeLevelIndex;this.status_.activeLevelIndex=e,this.dispatchEvent(new H.util.ChangeEvent(t.EVENTS.LEVEL_CHANGE,e,r))}}},{key:"isActive",value:function(){var t=this.getParentEventTarget();return!!t&&this===t.activeVenue}},{key:"getHighlightedGeometries",value:function(){var t=this;return this.venueModel.getGeometries().filter((function(t){return t.isHighlighted()})).map((function(e){return t.getGeometry(e.getIdentifier())}))}},{key:"setHighlightedGeometries",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},n=arguments.length>3&&void 0!==arguments[3]&&arguments[3],o=a(a({},st),i),s=o.fillColor,l=o.outlineColor,u=o.outlineWidth;this.mutualExclusiveHighlight_=!!n,this.mutualExclusiveHighlight_&&this.getHighlightedGeometries().forEach((function(t){t.getData().highlight(!1)})),r.forEach((function(t){t.getData().highlight(e,{m:s,o:l,w:u})})),this.dispatchEvent(t.EVENTS.GEOMETRY_HIGHLIGHT)}},{key:"getMapObjects",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.getActiveLevelIndex(),e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.getActiveDrawing();return this.mapObjectStore_[t][e.getIdentifier()]}},{key:"setMapObjects",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.getActiveLevelIndex(),r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.getActiveDrawing();this.mapObjectStore_[e]&&this.mapObjectStore_[e][r.getIdentifier()]&&(this.mapObjectStore_[e][r.getIdentifier()]=b(t)),this.updateMapObjectsVisibility_()}},{key:"search",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return this.search_.find(e).flatMap((function(e){return e.geometries.map((function(e){return t.getGeometry(e.id)}))}))}},{key:"updateMapObjectsVisibility_",value:function(){Object.values(this.mapObjectStore_).forEach((function(t){Object.values(t).forEach((function(t){return t.forEach((function(t){return t.setVisibility(!1)}))}))})),this.isActive()&&this.mapObjectStore_[this.getActiveLevelIndex()][this.getActiveDrawing().getIdentifier()].forEach((function(t){return t.setVisibility(!0)}))}},{key:"getDefaultMapObjectsStore_",value:function(){var t=this,e=this.getData().getDisplaySettings()===Ct.FLATTEN;return this.venueModel.getLevels().reduce((function(r,i){var n=i.getZIndex(),o=a({},r);return o[n]||(o[n]={}),o[n][i.getDrawing().getIdentifier()]=[],e&&(o[n][t.venueModel.getRootDrawing().getIdentifier()]=[]),o}),{})}}])}();Ae.EVENTS={ACTIVE_VENUE_CHANGE:"activevenuechange",DRAWING_CHANGE:"drawingchange",LEVEL_CHANGE:"levelchange",GEOMETRY_HIGHLIGHT:"geometryhighlight"};var Se=f((function t(){h(this,t)}),null,[{key:"getIconLayer",value:function(){return{type:"FeatureCollection",features:(arguments.length>0&&void 0!==arguments[0]?arguments[0]:[]).flatMap((function(t){return t.getData().getGeometries()})).filter((function(t){return t.isIcon()&&t.getIcon()})).map((function(t){var e=_(t.getLabelArea(),2),r=e[0],i=e[1],n=t.getLevel(),o=t.getIcon(),a=t.properties.spaceType||t.properties.spaceCategory||t.getDisplayName();return{type:"Feature",properties:{id:t.getIdentifier(),geometryId:t.getIdentifier(),levelId:n.getIdentifier(),name:a,venueId:n.getDrawing().getVenueModel().getIdentifier(),url:o?"data:image/svg+xml;utf8,".concat(encodeURIComponent(o)):""},geometry:{type:tt,coordinates:[r,i]}}}))}}},{key:"getLabelLayer",value:function(){return{type:"FeatureCollection",features:(arguments.length>0&&void 0!==arguments[0]?arguments[0]:[]).flatMap((function(t){return t.getData().getGeometries()})).filter((function(t){return t.getDisplayName()&&!t.isIcon()})).map((function(t){var e=_(t.getLabelArea(),2),r=e[0],i=e[1],n=t.getLabelStyle(),o=n.fill,a=n.zmin,s=t.getLevel();return{type:"Feature",properties:{id:t.getIdentifier(),geometryId:t.getIdentifier(),levelId:s.getIdentifier(),venueId:s.getDrawing().getVenueModel().getIdentifier(),name:t.getDisplayName(),minZoom:a||15,textFillColor:o.toLowerCase()},geometry:{type:tt,coordinates:[r,i]}}}))}}},{key:"getGeometryLayer",value:function(){return{type:"FeatureCollection",features:(arguments.length>0&&void 0!==arguments[0]?arguments[0]:[]).flatMap((function(t){return t.getData().getGeometries()})).filter((function(t){return t.getType()!==tt})).map((function(t){var e=t.getHighlightedStyle()||{},r=e.m,i=e.o,n=e.w,o=a({},t.getStyle()),s=o.m,l=o.o,u=o.w,c=nt,h=ot,p=at,f=t.getLevel();return{type:"Feature",properties:{id:t.getIdentifier(),fillColor:(r||s||c).toLowerCase(),geometryId:t.getIdentifier(),levelId:f.getIdentifier(),venueId:f.getDrawing().getVenueModel().getIdentifier(),outlineColor:(i||l||h).toLowerCase(),outlineWidth:Number(((n||u||p)/3).toFixed(2)),zIndex:t.getZIndex()},geometry:{type:t.getType(),coordinates:t.getCoordinates()}}}))}}},{key:"getFootprintLayer",value:function(t){return{type:"FeatureCollection",features:t.flatMap((function(t){return t.getData().getLevels().map((function(e){var r=e.getIdentifier(),i=t.getLevel(r).getData().levelData.geometry;return{type:"Feature",properties:{isFootprint:!0,levelId:r,venueId:t.getIdentifier(),zIndex:1},geometry:{type:"MultiPolygon",coordinates:i.coordinates}}}))}))}}}]),ke=f((function t(){h(this,t)}),null,[{key:"getStyle",value:function(){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],e={styles:[{dataLayer:lt.FOOTPRINT,when:["==",["geometry-type"],"Polygon"],technique:"solid-line",color:"#4E5663",width:["interpolate",["linear"],["zoom"],0,"1px",6,"1px",7,"2px",18,"2px",19,"4px",24,"4px"],renderOrder:1},{dataLayer:lt.FOOTPRINT,when:["==",["geometry-type"],"Point"],technique:"text",color:"black",size:16,text:["get","venueName"],priority:61},{dataLayer:lt.VECTOR,when:["==",["geometry-type"],"Polygon"],technique:"polygon",color:["get","fillColor"],renderOrder:["get","zIndex"]},{dataLayer:lt.VECTOR,technique:"solid-line",color:["get","outlineColor"],width:["get","outlineWidth"],renderOrder:["get","zIndex"]},{dataLayer:lt.TEXT,minZoomLevel:["get","minZoom"],technique:"text",color:["get","textFillColor"],size:13,text:["get","name"],priority:60},{dataLayer:lt.ICON,minZoomLevel:16,when:["==",["geometry-type"],"Point"],technique:"labeled-icon",textIsOptional:!0,size:0,text:["get","name"],imageTexture:["concat","texture",["get","name"]],screenWidth:["interpolate",["linear"],["zoom"],15,3,21,70],screenHeight:["interpolate",["linear"],["zoom"],15,3,21,70],priority:61}],images:{},imageTextures:[]};return(arguments.length>0&&void 0!==arguments[0]?arguments[0]:[]).forEach((function(t){var r="texture"+t.properties.name;e.images[r]||(e.images[r]={url:t.properties.url,preload:!0},e.imageTextures.push({name:r,image:r}))})),t.forEach((function(t){var r,i=t.getData().getHighlightedStyle(),n=i.m,o=i.o,a=i.w;(r=e.styles).push.apply(r,[{dataLayer:lt.VECTOR,when:["==",["get","id"],t.id],technique:"polygon",color:n,renderOrder:["get","zIndex"]},{dataLayer:lt.VECTOR,when:["==",["get","id"],t.id],technique:"solid-line",color:o,width:a,renderOrder:["get","zIndex"]}])})),new H.map.render.harp.Style(e)}}]),Ie=function(){function t(){h(this,t)}return f(t,null,[{key:"getIconsTextures",value:function(){var t={},e={},r=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:[]).reduce((function(t,e){var r=e.properties.name;return t[r]||(t[r]=[]),t[r].push(e),t}),{});return Object.keys(r).forEach((function(i){var n="texture".concat(i),o="sprite".concat(i),a=r[i][0].properties.url;t[n]={url:a,sprites:d({},o,[0,0,50,50])},r[i].forEach((function(t){var r=t.properties;e["icon".concat(r.name)]={filter:{name:r.name,$zoom:{min:16}},draw:{points:{interactive:!0,priority:1,size:[[15,"50%"],[16,"55%"],[17,"60%"],[18,"65%"],[19,"75%"],[20,"80%"],[21,"100%"]],texture:n,sprite:o}}}}))})),{textures:t,iconLayers:e}}},{key:"getFootprintLayer",value:function(){return{data:{source:"venues",layer:lt.FOOTPRINT},draw:{lines:{color:"#4E5663",width:[[0,"1px"],[6,"1px"],[7,"2px"],[18,"2px"],[19,"4px"],[24,"4px"]],order:1},points:{color:"[0, 0, 0, 0]",size:"0px",order:3,priority:1,text:{anchor:"center",collide:!1,font:{fill:"black",size:"16px"},text_source:"function() { return feature.venueName }"}}}}}},{key:"getGeometryLayer",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],e={};if(t.length){var r=t[0].getData().getHighlightedStyle(),i=r.m,n=r.o,o=r.w;e={filter:{id:t.map((function(t){return t.id}))},draw:{polygons:{interactive:!0,color:i},lines:{color:n,width:o}}}}return{data:{source:"venues",layer:lt.VECTOR},draw:{polygons:{interactive:!0,color:"function() { return feature.fillColor }",order:"function() { return feature.zIndex }"},lines:{color:"function() { return feature.outlineColor }",order:"function() { return feature.zIndex }",width:"function() { return feature.outlineWidth }"}},highlighted:e}}},{key:"getTextLayer",value:function(){return{filter:{$zoom:{min:18}},data:{source:"venues",layer:lt.TEXT},draw:{points:{filter:"function() { return $zoom > feature.minZoom }",color:"[0, 0, 0, 0]",size:"0px",offset:["0px","-10px"],priority:2,text:{font:{fill:"function() { return feature.textFillColor }",size:13},text_source:"function() { return feature.name }"}}}}}},{key:"getIconLayer",value:function(t){return a({data:{source:"venues",layer:lt.ICON}},t)}},{key:"getStyle",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],i=t.getIconsTextures(e),n=i.textures,o=i.iconLayers,a={venue_footprints:t.getFootprintLayer(),venue_geometries:t.getGeometryLayer(r),venue_labels:t.getTextLayer(),venue_icons:t.getIconLayer(o)},s=H.gl.yaml.dump({sources:{venues:{max_zoom:24,type:"GeoJSONTileSource"}},layers:a,textures:n});return new H.map.render.webgl.Style(s)}}])}(),Pe={type:"FeatureCollection",features:[]},Oe={extent:4096,indexMaxZoom:0,maxZoom:24,tolerance:3},Le=function(){function t(e){var i;return h(this,t),(i=r(this,t,[e])).venues=[],i.activeVenue=null,i.dataLayers_={},i.tileIndexes_={},i.addEventListener(Ae.EVENTS.ACTIVE_VENUE_CHANGE,i.activeVenueChangeHandler_,void 0,i),i}return y(t,H.map.provider.RemoteTileProvider),f(t,[{key:"setStyle",value:function(t){return this.setStyleInternal(t)}},{key:"getStyle",value:function(){return this.getStyleInternal()}},{key:"isFeatureVisible_",value:function(t){var e=t.properties;return!!this.activeVenue.getActiveLevels().some((function(t){return t.id===e.levelId}))}},{key:"requestInternal",value:function(t,e,r,i){var n=this,o=function(i){for(var n=0;n<i.length;n+=1)i[n]=i[n].map((function(i){return pt(i,r,t,e,Oe.extent)}))},a={};return Object.keys(this.tileIndexes_).forEach((function(i){var s=n.tileIndexes_[i].getTile(r,t,e);a[i]=s?function(t){var e=[],r=t&&t.features;if(r)for(var i=0,n=r.length;i<n;i+=1){var o=r[i],a=o.type,s=void 0,l=!1;switch(a){case 1:s={type:"MultiPoint",coordinates:o.geometry.map((function(t){return t.slice()}))};break;case 2:case 3:s={type:rt,coordinates:o.geometry.map((function(t){return t.map((function(t){return t.slice()}))}))},3===a&&null==(s=ht(s))&&(l=!0);break;default:l=!0}l||e.push({geometry:s,id:o.id,properties:o.tags,type:"Feature"})}return{type:"FeatureCollection",features:e}}(s):Pe,a[i].features=a[i].features.filter((function(t){return n.isFeatureVisible_(t)}));for(var l=0;l<a[i].features.length;l+=1){var u=a[i].features[l],c=u.geometry.type;if(c===et||c===rt)o(u.geometry.coordinates);else if(c===it)u.geometry.coordinates.map(o);else for(var h=u.geometry.coordinates,p=0;p<h.length;p+=1)h[p]=pt(h[p],r,t,e,Oe.extent)}})),i(a),{cancel:function(){}}}},{key:"getActiveVenue",value:function(){return this.activeVenue}},{key:"getVenue",value:function(t){return t?this.venues.find((function(e){return e.getIdentifier()===t})):this.activeVenue}},{key:"setActiveVenue",value:function(t){var e=this.activeVenue;this.activeVenue=t,this.dispatchEvent(new H.util.ChangeEvent(Ae.EVENTS.ACTIVE_VENUE_CHANGE,t,e)),this.reload()}},{key:"addVenue",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!(t instanceof Ae))throw new Error("Invalid argument");var r=t.getIdentifier();if(this.getVenue(r))throw new Error("Please invoke provider.removeVenue to remove old instance of venue ".concat(r," before adding new"));t.setParentEventTarget(this),this.venues.push(t),e||(this.reloadData_(),this.reloadStyle_())}},{key:"addVenues",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];e.length>0&&(e.forEach((function(e){e instanceof Ae&&t.addVenue(e,!0)})),this.reloadData_(),this.reloadStyle_())}},{key:"removeVenue",value:function(t){if(t instanceof Ae&&this.venues.indexOf(t)>-1){var e=t.getIdentifier();this.activeVenue&&this.activeVenue.getIdentifier()===e&&this.setActiveVenue(null),this.venues.splice(this.venues.indexOf(t),1),this.reloadData_(),this.reloadStyle_(),this.reload()}}},{key:"getFeatureProxy",value:function(t,e,r){var i=t.geometryId,n=t.venueId,o=this.getVenue(n);return i?r(o.getGeometries().find((function(t){return t.id===i}))):o&&r(o),!0}},{key:"addVenueEventListeners_",value:function(t){t&&(t.addEventListener(Ae.EVENTS.GEOMETRY_HIGHLIGHT,this.geometryHighlightHandler_,void 0,this),t.addEventListener(Ae.EVENTS.LEVEL_CHANGE,this.levelChangeHandler_,void 0,this),t.addEventListener(Ae.EVENTS.DRAWING_CHANGE,this.drawingChangeHandler_,void 0,this))}},{key:"removeVenueEventListeners_",value:function(t){t&&(t.removeEventListener(Ae.EVENTS.GEOMETRY_HIGHLIGHT,this.geometryHighlightHandler_,void 0,this),t.removeEventListener(Ae.EVENTS.LEVEL_CHANGE,this.levelChangeHandler_,void 0,this),t.removeEventListener(Ae.EVENTS.DRAWING_CHANGE,this.drawingChangeHandler_,void 0,this))}},{key:"activeVenueChangeHandler_",value:function(t){var e=t.oldValue,r=t.newValue;e&&(this.removeVenueEventListeners_(e),e.updateMapObjectsVisibility_()),r&&(this.addVenueEventListeners_(r),r.updateMapObjectsVisibility_())}},{key:"drawingChangeHandler_",value:function(){this.reload()}},{key:"levelChangeHandler_",value:function(){this.activeVenue&&(this.activeVenue.updateMapObjectsVisibility_(),this.reload())}},{key:"geometryHighlightHandler_",value:function(){this.reloadStyle_(this.activeVenue.getHighlightedGeometries())}},{key:"createDataLayers_",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Object.keys(lt),r=lt.FOOTPRINT,i=lt.ICON,n=lt.TEXT,o=lt.VECTOR;e.forEach((function(e){switch(e){case o:t.dataLayers_[o]=Se.getGeometryLayer(t.venues);break;case r:t.dataLayers_[r]=Se.getFootprintLayer(t.venues);break;case i:t.dataLayers_[i]=Se.getIconLayer(t.venues);break;case n:t.dataLayers_[n]=Se.getLabelLayer(t.venues);break;default:throw new Error("Unsupported Layer ".concat(e))}}))}},{key:"createTileIndexes_",value:function(){var t=this;(arguments.length>0&&void 0!==arguments[0]?arguments[0]:Object.keys(lt)).forEach((function(e){t.tileIndexes_[e]=new J(t.dataLayers_[e],Oe)}))}},{key:"reloadData_",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Object.keys(lt);this.createDataLayers_(t),this.createTileIndexes_(t)}},{key:"reloadStyle_",value:function(t){var e=this.dataLayers_[lt.ICON]?this.dataLayers_[lt.ICON].features:[];this.getEngineType()===H.Map.EngineType.WEBGL?this.setStyle(Ie.getStyle(e,t)):this.getEngineType()===H.Map.EngineType.HARP&&this.setStyle(ke.getStyle(e,t))}},{key:"providesGeoJSON",value:function(){return!0}}])}(),Ce=new H.map.SpatialStyle({strokeColor:"#1ab4bf",lineWidth:3}),Re=new H.map.SpatialStyle({strokeColor:"#1ab4bf",lineWidth:3}),Me=new H.map.Icon("data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI0MCIgaGVpZ2h0PSI1MCIgdmlld0JveD0iMCAwIDQwIDUwIiB4bWxuczp4bGluaz0iaHR0cDovL3d3dy53My5vcmcvMTk5OS94bGluayI+PGRlZnM+PHBhdGggaWQ9ImIiIGQ9Ik0zNC4yNSAzMS42NTJBMTkuMDE1IDE5LjAxNSAwIDAgMCAzOSAxOS4wNkMzOSA4LjU0OSAzMC40NzggMCAyMCAwUzEgOC41NSAxIDE5LjA1OWMwIDQuODIzIDEuNzk1IDkuMjMzIDQuNzUgMTIuNTkzTDE5Ljk3NSA0NiAzNC4yNSAzMS42NTJ6Ii8+PHBhdGggaWQ9ImEiIGQ9Ik0zNC4yNSAzMS42NTJBMTkuMDE1IDE5LjAxNSAwIDAgMCAzOSAxOS4wNkMzOSA4LjU0OSAzMC40NzggMCAyMCAwUzEgOC41NSAxIDE5LjA1OWMwIDQuODIzIDEuNzk1IDkuMjMzIDQuNzUgMTIuNTkzTDE5Ljk3NSA0NiAzNC4yNSAzMS42NTJ6Ii8+PG1hc2sgaWQ9ImMiIHdpZHRoPSIzOCIgaGVpZ2h0PSI0NiIgeD0iMCIgeT0iMCIgZmlsbD0iI2ZmZiI+PHVzZSB4bGluazpocmVmPSIjYSIvPjwvbWFzaz48L2RlZnM+PGcgZmlsbD0ibm9uZSIgZmlsbC1ydWxlPSJldmVub2RkIj48ZWxsaXBzZSBjeD0iMjAiIGN5PSI0NS4xNiIgZmlsbD0iI0ZGRiIgc3Ryb2tlPSIjOTc5Nzk3IiBzdHJva2Utd2lkdGg9Ii4yNSIgcng9IjMuNSIgcnk9IjMuNSIvPjx1c2UgZmlsbD0iIzAxQjZCMiIgeGxpbms6aHJlZj0iI2IiLz48cGF0aCBmaWxsPSIjMzIzMjMyIiBmaWxsLW9wYWNpdHk9Ii41IiBkPSJNMTEuODEgMzcuNjZoMTYuMzhsLTguMiA4eiIvPjx1c2Ugc3Ryb2tlPSIjNDE2QTg2IiBzdHJva2Utd2lkdGg9Ii41IiBtYXNrPSJ1cmwoI2MpIiB4bGluazpocmVmPSIjYSIvPjxlbGxpcHNlIGN4PSIxOS44MSIgY3k9IjE5LjE5IiBmaWxsPSIjRkZGIiByeD0iNC44MSIgcnk9IjQuODEiLz48L2c+PC9zdmc+"),Ne=new H.map.Icon("data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI0MCIgaGVpZ2h0PSI1MCIgdmlld0JveD0iMCAwIDQwIDUwIiB4bWxuczp4bGluaz0iaHR0cDovL3d3dy53My5vcmcvMTk5OS94bGluayI+PGRlZnM+PHBhdGggaWQ9ImEiIGQ9Ik0zNC4yNSAzMS42NTJBMTkuMDE1IDE5LjAxNSAwIDAgMCAzOSAxOS4wNkMzOSA4LjU0OSAzMC40NzggMCAyMCAwUzEgOC41NSAxIDE5LjA1OWMwIDQuODIzIDEuNzk1IDkuMjMzIDQuNzUgMTIuNTkzTDE5Ljk3NSA0NiAzMi44MyAzMy4xMDRjLjQwNy0uMzc0IDEuNDE5LTEuNDUyIDEuNDE5LTEuNDUyeiIvPjxtYXNrIGlkPSJjIiB3aWR0aD0iMzgiIGhlaWdodD0iNDYiIHg9IjAiIHk9IjAiIGZpbGw9IiNmZmYiPjx1c2UgeGxpbms6aHJlZj0iI2EiLz48L21hc2s+PGVsbGlwc2UgaWQ9ImIiIGN4PSIxOS44MDciIGN5PSIxOS4xNjgiIHJ4PSIxMi4zNjMiIHJ5PSIxMi4xOTciLz48bWFzayBpZD0iZCIgd2lkdGg9IjI1LjcyNSIgaGVpZ2h0PSIyNS4zOTQiIHg9Ii0uNSIgeT0iLS41Ij48cGF0aCBmaWxsPSIjZmZmIiBkPSJNNi45NDQgNi40NzFoMjUuNzI1djI1LjM5NEg2Ljk0NHoiLz48dXNlIHhsaW5rOmhyZWY9IiNiIi8+PC9tYXNrPjwvZGVmcz48ZyBmaWxsPSJub25lIiBmaWxsLXJ1bGU9ImV2ZW5vZGQiPjxlbGxpcHNlIGN4PSIyMCIgY3k9IjQ1LjE2IiBmaWxsPSIjRkZGIiBzdHJva2U9IiM5Nzk3OTciIHN0cm9rZS13aWR0aD0iLjI1IiByeD0iMy41IiByeT0iMy41Ii8+PHVzZSBmaWxsPSIjMzIzMjMyIiB4bGluazpocmVmPSIjYSIvPjxwYXRoIGZpbGw9IiM3RDdEN0QiIGQ9Ik0xMi4wMTEgMzcuODA1aDE1Ljk3OGwtNy45MTYgOHoiLz48dXNlIHN0cm9rZT0iIzdDN0M3QyIgc3Ryb2tlLXdpZHRoPSIuNSIgbWFzaz0idXJsKCNlKSIgeGxpbms6aHJlZj0iI2EiLz48dXNlIHN0cm9rZT0iI0ZGRiIgc3Ryb2tlLXdpZHRoPSIuNSIgbWFzaz0idXJsKCNjKSIgeGxpbms6aHJlZj0iI2EiLz48ZWxsaXBzZSBmaWxsPSIjRkZGIiBjeD0iMTkuODA3IiBjeT0iMTkuMTY4IiByeD0iMTIuMzYzIiByeT0iMTIuMTk3Ii8+PHBhdGggZmlsbD0iIzMyMzIzMiIgZD0iTTYuODEyIDYuOTQ4aDYuNDV2Ni4zNjRoLTYuNDV6bTAgMTIuNzI3aDYuNDV2Ni4zNjRoLTYuNDV6bTYuNDUtNi4zNjNoNi40NXY2LjM2NGgtNi40NXptMCAxMi43MjdoNi40NXY2LjM2NGgtNi40NXptNi40NS0xOS4wOTFoNi40NXY2LjM2NGgtNi40NXptMCAxMi43MjdoNi40NXY2LjM2NGgtNi40NXptNi40NS02LjM2M2g2LjQ1djYuMzY0aC02LjQ1em0wIDEyLjcyN2g2LjQ1djYuMzY0aC02LjQ1eiIvPjx1c2Ugc3Ryb2tlPSIjRkZGIiBtYXNrPSJ1cmwoI2QpIiB4bGluazpocmVmPSIjYiIgc3Ryb2tlLWxpbmVjYXA9InNxdWFyZSIvPjwvZz48L3N2Zz4="),je=function(t,e,r){return r===De.ObjectType.SEGMENT_START_MARKER?0===t?Me:null:r===De.ObjectType.SEGMENT_FINISH_MARKER?1===e.length||t===e.length-1?Ne:null:"indoor"===e[t].departure.place.type?Ce:Re},De=function(){function t(e,r){h(this,t),this.indoorMapObjects_=null,this.outdoorMapObjects_=null,this.createRouteObjects_(e,r)}return f(t,[{key:"createRouteObjects_",value:function(e){var r=this,i=e.sections,n=void 0===i?[]:i,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:je;this.indoorMapObjects_={},this.outdoorMapObjects_=new H.map.Group;for(var s=function(){var e,i,s=n[l],u=s.departure.place,c=u.id,h=u.type,p=H.util.flexiblePolyline.decode(s.polyline).polyline,f=o(l,n,t.ObjectType.SEGMENT_START_MARKER);f&&(e=new H.map.Marker(s.departure.place.location,{icon:f}));var d=o(l,n,t.ObjectType.SEGMENT_FINISH_MARKER);d&&(i=new H.map.Marker(s.arrival.place.location,{icon:d}));var y=o(l,n,t.ObjectType.SEGMENT_POLYLINE);if("indoor"===h){var g=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],e=new Map,r=new H.geo.LineString,i=_(t[0],3)[2];return e.set(i,[r]),t.forEach((function(t){var n;t[2]!==i&&(i=t[2],r=new H.geo.LineString,e.has(i)?e.get(i).push(r):e.set(i,[r])),(n=r).pushLatLngAlt.apply(n,b(t))})),e}(p),v=Array.from(g.keys()).reduce((function(t,e){return t[e]||(t[e]=new H.map.Group),t}),{});y&&g.forEach((function(t,e){t.forEach((function(t){if(t.getPointCount()>1){var r=new H.map.Polyline(t,{style:y});v[e].addObject(r)}}))})),e&&v[s.departure.place.location.lvl].addObject(e),i&&v[s.arrival.place.location.lvl].addObject(i),r.indoorMapObjects_[c]=a(a({},r.indoorMapObjects_[c]||{}),v)}else{if(y){var m=new H.geo.LineString(p.flatMap((function(t){return[t[0],t[1],0]}))),x=new H.map.Polyline(m,{style:y});r.outdoorMapObjects_.addObject(x)}e&&r.outdoorMapObjects_.addObject(e),i&&r.outdoorMapObjects_.addObject(i)}},l=0;l<n.length;l++)s()}},{key:"getIndoorObjects",value:function(){return this.indoorMapObjects_}},{key:"getOutdoorObjects",value:function(){return this.outdoorMapObjects_}}])}();De.ObjectType={SEGMENT_START_MARKER:1,SEGMENT_FINISH_MARKER:2,SEGMENT_POLYLINE:3};var Be=function(){function t(e){var i;h(this,t),i=r(this,t,[t,a(a({},e),{},{baseUrl:void 0})]);var n={apiKey:e.apikey,baseUrl:e.baseUrl,token:e.token},o={apiKey:n.apiKey,token:n.token};n.apiKey||(n.apiKey=i.getUrl().getQuery().apikey);var s=e.useLegacy||!1;return i.venueService_=new be(n,s),o.apiKey||(o.apiKey=i.getUrl().getQuery().apikey),e.routingBaseUrl&&(o.baseUrl=e.routingBaseUrl),i.routingService_=new we(o),i}return y(t,H.service.Service),f(t,[{key:"loadVenue",value:function(t){return console.warn("Venue service version 1 is no longer supported hence "+t+" could not be loaded"),Promise.resolve()}},{key:"calculateRoute",value:function(t){return console.warn("HERE Indoor Routing is deprecated and will be removed soon."),this.routingService_.calculateRoute(t)}}])}();Be.CONFIG_KEY="venues";var ze=function(){function t(e){var i;h(this,t),i=r(this,t,[t,a(a({},e),{},{baseUrl:void 0})]);var n={apiKey:e.apikey,baseUrl:e.baseUrl,token:e.token,hrn:e.hrn};n.apiKey||(n.apiKey=i.getUrl().getQuery().apikey);var o=e.useLegacy||!1;return i.venueService_=new be(n,o),i}return y(t,H.service.Service),f(t,[{key:"loadVenue",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.venueService_.load(t,e).then((function(t){return new Ae(t)}))}},{key:"getMapInfoList",value:function(){return this.venueService_.getSupportedMapList()}}])}();ze.CONFIG_KEY="indoorMaps",H.service.Platform.prototype.getVenuesService=function(t,e){var r=ze;return 1!==e&&e?e!==ut.v2||t.token||(t.hrn?t.apikey||console.error("Venue Service version 2 requires either apikey or token"):console.error("Token is mandatory when Hrn is not provided in Venue Service version 2")):(console.warn("Venue service version 1 is no longer supported"),r=Be),this.createService(r,t)},ze.LABEL_TEXT_PREFERENCE_OVERRIDE={OCCUPANT_NAMES:"OCCUPANT_NAMES",SPACE_NAME:"SPACE_NAME",SPACE_TYPE_NAME:"SPACE_TYPE_NAME",SPACE_CATEGORY_NAME:"SPACE_CATEGORY_NAME",INTERNAL_ADDRESS:"INTERNAL_ADDRESS"};var Ue=function(){function t(e){var i,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return h(this,t),(i=r(this,t)).provider_=null,i.levelSelectorUI_=null,i.setAlignment(n&&n.alignment||H.ui.LayoutAlignment.RIGHT_BOTTOM),i.addClass("venues-ui"),e instanceof Ae&&i.setVenue(e),i}return y(t,H.ui.Control),f(t,[{key:"renderInternal",value:function(e,r){m(g(t.prototype),"renderInternal",this).call(this,e,r),this.createLevelSelectorUI_(e),this.venue&&this.setVenue(this.venue)}},{key:"setVenue",value:function(t){t instanceof Ae&&(this.removeEventListeners_(),this.venue=t,this.provider_=t.getParentEventTarget(),this.update_(),this.addEventListeners_())}},{key:"createLevelSelectorUI_",value:function(t){var e=this;t.innerHTML="",this.levelSelectorUI_=null,this.levelSelectorUI_=new ie(t,null,null,(function(t){return e.venue.setActiveLevelIndex(t)}))}},{key:"update_",value:function(){if(this.levelSelectorUI_){var t=this.venue.getActiveDrawing().getData(),e=this.venue.getData().getDisplaySettings();this.levelSelectorUI_.update(t,e),this.levelChangeHandler_()}}},{key:"addEventListeners_",value:function(){this.venue&&(this.venue.addEventListener(Ae.EVENTS.LEVEL_CHANGE,this.levelChangeHandler_,void 0,this),this.venue.addEventListener(Ae.EVENTS.DRAWING_CHANGE,this.drawingChangeHandler_,void 0,this)),this.provider_&&this.provider_.addEventListener(Ae.EVENTS.ACTIVE_VENUE_CHANGE,this.activeVenueChangeHandler_,void 0,this)}},{key:"removeEventListeners_",value:function(){this.venue&&(this.venue.removeEventListener(Ae.EVENTS.LEVEL_CHANGE,this.levelChangeHandler_,void 0,this),this.venue.removeEventListener(Ae.EVENTS.DRAWING_CHANGE,this.drawingChangeHandler_,void 0,this)),this.provider_&&this.provider_.removeEventListener(Ae.EVENTS.ACTIVE_VENUE_CHANGE,this.activeVenueChangeHandler_,void 0,this)}},{key:"levelChangeHandler_",value:function(){this.levelSelectorUI_.switch(this.venue.getActiveLevelIndex())}},{key:"drawingChangeHandler_",value:function(){this.update_()}},{key:"activeVenueChangeHandler_",value:function(t){this.setVenue(t.newValue)}}])}(),Fe=function(){function t(e){var i,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return h(this,t),(i=r(this,t)).provider_=null,i.drawingSelectorUI_=null,i.addClass("venues-ui"),i.setAlignment(n&&n.alignment||H.ui.LayoutAlignment.RIGHT_BOTTOM),e instanceof Ae&&i.setVenue(e),i}return y(t,H.ui.Control),f(t,[{key:"renderInternal",value:function(e,r){m(g(t.prototype),"renderInternal",this).call(this,e,r),this.createDrawingSelectorUI_(e),this.venue&&this.setVenue(this.venue)}},{key:"setVenue",value:function(t){t instanceof Ae&&(this.removeEventListeners_(),this.venue=t,this.provider_=t.getParentEventTarget(),this.drawingSelectorUI_&&this.drawingSelectorUI_.update(t.getData()),this.addEventListeners_())}},{key:"createDrawingSelectorUI_",value:function(t){var e=this;t.innerHTML="",this.drawingSelectorUI_=null,this.drawingSelectorUI_=new Jt(t,null,(function(t){return e.venue.setActiveDrawing(t)}))}},{key:"addEventListeners_",value:function(){this.venue&&this.venue.addEventListener(Ae.EVENTS.DRAWING_CHANGE,this.drawingChangeHandler_,void 0,this),this.provider_&&this.provider_.addEventListener(Ae.EVENTS.ACTIVE_VENUE_CHANGE,this.activeVenueChangeHandler_,void 0,this)}},{key:"removeEventListeners_",value:function(){this.venue&&this.venue.removeEventListener(Ae.EVENTS.DRAWING_CHANGE,this.drawingChangeHandler_,void 0,this),this.provider_&&this.provider_.removeEventListener(Ae.EVENTS.ACTIVE_VENUE_CHANGE,this.activeVenueChangeHandler_,void 0,this)}},{key:"drawingChangeHandler_",value:function(){this.drawingSelectorUI_.switch(this.venue.getActiveDrawing().id)}},{key:"activeVenueChangeHandler_",value:function(t){this.setVenue(t.newValue)}}])}(),Ge=Object.freeze({__proto__:null,DrawingControl:Fe,LevelControl:Ue});return e(".venues-ui * {\n  font-family: \"Fira Sans\", \"Helvetica Neue\", Helvetica, sans-serif;\n  color: #0F1621;\n}\n.venues-ui .arrow {\n  display: block;\n  width: 100%;\n  height: 100%;\n  background-repeat: no-repeat;\n  background-position: center;\n}\n.venues-ui .arrow--up {\n  background-image: url(\"data:image/svg+xml,%0A%3Csvg width='13px' height='9px' viewBox='0 0 13 9' version='1.1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink'%3E%3Cg id='VenueMap_Facilities_Detail' stroke='none' stroke-width='1' fill='none' fill-rule='evenodd'%3E%3Cg id='Floorplan-Switcher' transform='translate(-426.000000, -584.000000)' fill='%23383C45'%3E%3Cg id='Map-Controls-Copy' transform='translate(417.753906, 572.000000)'%3E%3Cg id='Chevron,-Dark' transform='translate(15.000000, 16.499023) rotate(-180.000000) translate(-15.000000, -16.499023) translate(9.000000, 12.749023)'%3E%3Cpath d='M6.0105,7.5 L4.1895,5.76404817 L0.1695,1.90510321 C0.057,1.79759174 0,1.68291284 0,1.56106651 C0,1.44065367 0.057,1.32597477 0.1695,1.2184633 L1.2465,0.16771789 C1.347,0.0587729358 1.47,0.00430045872 1.617,0.00430045872 C1.764,0.00430045872 1.887,0.0587729358 1.986,0.166284404 L6.009,3.98365826 L10.023,0.161983945 C10.122,0.0530389908 10.236,0 10.3695,0 C10.503,0 10.62,0.0530389908 10.7205,0.161983945 L11.841,1.21129587 C12.0525,1.43922018 12.0525,1.67144495 11.8425,1.89793578 L7.827,5.76118119 L6.0105,7.5 Z' id='Fill-3'%3E%3C/path%3E%3C/g%3E%3C/g%3E%3C/g%3E%3C/g%3E%3C/svg%3E\");\n}\n.venues-ui .arrow--down {\n  background-image: url(\"data:image/svg+xml,%0A%3Csvg width='13px' height='9px' viewBox='0 0 13 9' version='1.1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink'%3E%3Cg id='VenueMap_Facilities_Detail' stroke='none' stroke-width='1' fill='none' fill-rule='evenodd'%3E%3Cg id='Floorplan-Switcher' transform='translate(-347.000000, -704.000000)' fill='%23383C45'%3E%3Cg id='Map-Controls' transform='translate(338.251953, 572.000000)'%3E%3Cg id='Chevron,-Dark' transform='translate(9.000000, 132.746094)'%3E%3Cpath d='M6.0105,7.5 L4.1895,5.76404817 L0.1695,1.90510321 C0.057,1.79759174 0,1.68291284 0,1.56106651 C0,1.44065367 0.057,1.32597477 0.1695,1.2184633 L1.2465,0.16771789 C1.347,0.0587729358 1.47,0.00430045872 1.617,0.00430045872 C1.764,0.00430045872 1.887,0.0587729358 1.986,0.166284404 L6.009,3.98365826 L10.023,0.161983945 C10.122,0.0530389908 10.236,0 10.3695,0 C10.503,0 10.62,0.0530389908 10.7205,0.161983945 L11.841,1.21129587 C12.0525,1.43922018 12.0525,1.67144495 11.8425,1.89793578 L7.827,5.76118119 L6.0105,7.5 Z' id='Fill-3'%3E%3C/path%3E%3C/g%3E%3C/g%3E%3C/g%3E%3C/g%3E%3C/svg%3E\");\n}\n.venues-ui .venues-ui-button {\n  display: block;\n  width: 40px;\n  height: 40px;\n  line-height: 40px;\n  font-size: 16px;\n  font-weight: 600;\n  background-color: #fff;\n  border: none;\n  border-bottom: 1px solid #9FA2A6;\n  cursor: pointer;\n  overflow: hidden;\n  color: #6e737a;\n  text-align: center;\n  text-overflow: ellipsis;\n  white-space: nowrap;\n}\n.venues-ui .venues-ui-button:hover, .venues-ui .venues-ui-button--active {\n  background-color: #f0f0f0;\n  color: #0F1621;\n}\n@keyframes fade {\n  0% {\n    opacity: 0;\n  }\n  100% {\n    opacity: 1;\n  }\n}\n.venues-ui__drawings .drawings {\n  position: absolute;\n  top: 0;\n  right: 45px;\n  display: none;\n  opacity: 0;\n  border-radius: 5px;\n  box-shadow: 0 0 0.4em 0 rgba(15, 22, 33, 0.6);\n}\n.venues-ui__drawings .drawings--open {\n  display: block;\n  opacity: 1;\n  animation: fade 1s;\n  overflow-y: auto;\n  max-height: 250px;\n}\n.venues-ui__drawings .drawings .venues-ui-button {\n  width: auto;\n  padding: 0 10px;\n}\n.venues-ui__drawings .drawings .venues-ui-button:first-of-type {\n  border-top-left-radius: 5px;\n  border-top-right-radius: 5px;\n}\n.venues-ui__drawings .drawings .venues-ui-button:last-of-type {\n  border-bottom-left-radius: 5px;\n  border-bottom-right-radius: 5px;\n}\n.venues-ui__drawings .trigger {\n  border-radius: 5px;\n  box-shadow: 0 0 0.4em 0 rgba(15, 22, 33, 0.6);\n}\n.venues-ui__drawings .trigger .arrow {\n  transform: rotate(0);\n  transition: 0.4s;\n}\n.venues-ui__drawings .trigger.venues-ui-button--active .arrow {\n  transform: rotate(90deg);\n  transition: 0.4s;\n}\n.venues-ui__levels {\n  border-radius: 5px;\n  box-shadow: 0 0 0.4em 0 rgba(15, 22, 33, 0.6);\n}\n.venues-ui__levels .levels {\n  overflow: hidden;\n}\n.venues-ui__levels .venues-ui-button--up + .levels .venues-ui-button {\n  border-radius: 0;\n}\n.venues-ui__levels .venues-ui-button:first-of-type {\n  border-top-left-radius: 5px;\n  border-top-right-radius: 5px;\n}\n.venues-ui__levels .venues-ui-button:last-of-type {\n  border-bottom-left-radius: 5px;\n  border-bottom-right-radius: 5px;\n}\n.venues-ui__levels .venues-ui-button[disabled=disabled] .arrow {\n  opacity: 0.5;\n}\n.venues-ui__directory {\n  position: absolute;\n  top: 10px;\n  right: 60px;\n  bottom: calc(100% - 45px);\n  width: 350px;\n  overflow: hidden;\n  background: white;\n  border-radius: 5px;\n  box-shadow: 0 0 0.4em 0 rgba(15, 22, 33, 0.6);\n}\n.venues-ui__directory.active {\n  bottom: 10px;\n}\n.venues-ui__directory .directory__list {\n  top: 80px;\n  bottom: 20px;\n  position: absolute;\n  overflow-y: scroll;\n  right: 10px;\n  left: 10px;\n  font-size: 12px;\n}\n.venues-ui__directory .directory__list svg {\n  width: 25px;\n  height: 25px;\n}\n.venues-ui__directory .directory__heading {\n  margin: 8px;\n  font-size: 15px;\n  font-weight: normal;\n  cursor: pointer;\n}\n.venues-ui__directory .directory__input {\n  margin: 10px;\n}\n.venues-ui__directory .directory__input input {\n  width: 100%;\n  padding: 5px 0;\n}\n.venues-ui__directory .directory__trigger {\n  position: absolute;\n  right: 10px;\n  top: 15px;\n  width: 10px;\n  height: 10px;\n}\n.venues-ui__directory .directory__trigger .arrow {\n  transform: rotate(0);\n  transition: 0.4s;\n}\n.venues-ui__directory .directory__trigger--active .arrow {\n  transform: rotate(-180deg);\n  transition: 0.4s;\n}"),t.Drawing=T,t.Geometry=E,t.Level=A,t.Provider=Le,t.Route=De,t.Service=Be,t.Service2=ze,t.Venue=Ae,t.ui=Ge,Object.defineProperty(t,"__esModule",{value:!0}),t}({})}.call(self);var __WEBPACK_DEFAULT_EXPORT__=H}},__webpack_module_cache__={};function __webpack_require__(t){var e=__webpack_module_cache__[t];if(void 0!==e)return e.exports;var r=__webpack_module_cache__[t]={id:t,loaded:!1,exports:{}};return __webpack_modules__[t](r,r.exports,__webpack_require__),r.loaded=!0,r.exports}__webpack_require__.hmd=t=>((t=Object.create(t)).children||(t.children=[]),Object.defineProperty(t,"exports",{enumerable:!0,set:()=>{throw new Error("ES Modules may not assign module.exports or exports.*, Use ESM export syntax, instead: "+t.id)}}),t);var _here_maps_api_for_javascript__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(606),platform=new H.service.Platform({apikey:"cynCdVQhgemw3arLVJp4Mp-zV3WJuEkO4q6vDFpcv9A"}),maptypes=platform.createDefaultLayers({ppi:250}),map=new H.Map(document.getElementById("mapContainer"),maptypes.vector.normal.map,{pixelRatio:2,zoom:11,center:{lng:14.3279,lat:40.8352}});new H.mapevents.Behavior(new H.mapevents.MapEvents(map))})();